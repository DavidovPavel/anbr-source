"use strict";define("PDFJS",["/js/dist/pdf/shared/util.js"],function(){return PDFJS}),require.config({paths:{"@":"@wall",async:"dist/requirejs-plugins/src/async"}}),define(["app","access","global.view.headerView","mainView","global.radio.loader"],function(e,t,i,n){return{init:function(){function a(){Backbone.history.navigate("",{trigger:!0})}$.ajaxSetup({headers:{key:$.ajaxSettings.url}}),e.access=t.data.Points,$("header .logo").on("click",a),$("header .logo").on("touchstart",a);var o=Mn.AppRouter.extend({routes:{"":function(){r.getView().showFirst("my"),$("head meta[name=viewport]").attr("content","width=device-width, initial-scale=1.0")},demo:function(){r.getView().showFirst("shared"),$("head meta[name=viewport]").attr("content","width=device-width, initial-scale=1.0")},new:function(){r.getView().options.uid=null,r.getView().onShow(),$("head meta[name=viewport]").attr("content","width=device-width, initial-scale=1.0")},":uid":function(e){r.getView().options.uid=e,r.getView().onShow()}}}),s=Mn.Application.extend({region:"main",onStart:function(){this.showView(new n),(new i).render(),Backbone.history.start()}});new o;var r=new s;r.start()}}}),define("sendModel",[],function(){return Backbone.Model.extend({defaults:{id:null,page:1,pagesize:30,pars:[],ts:"",useDefParams:!0,action:"send"},url:function(){return"/api/extsrv/"+this.get("action")},sync:function(e,t,i){$.ajax({url:t.url(),method:"POST",data:JSON.stringify(t.toJSON()),contentType:"application/json; charset=utf-8"}).done(function(){i.success.apply(this,arguments)}).fail(function(){i.error.apply(this,arguments)})}})}),define("WidgetModel",[],function(){return Backbone.Model.extend({defaults:function(){return{id:null,title:"",update:!1,timeUpdate:36e4,timeStampForUpdate:"",Characteristics:[],width:400,height:460,top:100,left:100,zIndex:1,typeName:"",requestParameters:{},publishers:[],Decoration:{CaptionBackground:"rgba(200, 188, 162, 1)",CaptionForeground:"rgba(51, 51, 51, 1)",ContainerBackground:"rgba(255, 255, 255, 1)",ContainerForeground:"rgba(51, 51, 51, 1)",LinkBackground:"rgba(255, 255, 255, 0)",LinkForeground:"rgba(55,141,218,1)",CaptionIsVisible:!0,BorderIsVisible:!0,ContainerIsTransparent:!1},Visualization:null,Legend:null,isMarkSelectedItem:!1,SNLevel:null,SNLayout:null,SNStruct:null,SNX:0,SNY:0,SNZoom:0}},url:function(){return this.collection.url()+"/widget/"+(this.id||"")},validate:function(e){function t(e,t){return""===e||new RegExp(t).test(e)}var i=[],n="^[\\d]+$";if(e.title||i.push({name:"title"}),e.typeName||i.push({name:"typeName"}),-1!==["WidgetSource","WidgetHtml","WidgetReporting","WidgetSemNet"].indexOf(this.get("typeName"))||e.requestParameters.requestid||i.push({name:"requestParameters"}),t(e.timeUpdate,n)||i.push({name:"timeUpdate"}),t(e.width,n)||i.push({name:"width"}),t(e.height,n)||i.push({name:"height"}),i.length)return i}})}),define("radio.characteristic",[],function(){var e=Backbone.Model.extend({idAttribute:"WidgetParamUID",defaults:{WidgetParamUID:null,WidgetParamName:"",WidgetParamValue:null}}),t=Backbone.Collection.extend({model:e,sync:function(e,t,i){Backbone.Model.prototype.sync.apply(this,["create",t,i])}});return new(Mn.Object.extend({channelName:"chW",radioRequests:{"get:param:model":function(t,i){var n=_.findWhere(t,{WidgetParamName:i}),a=new e({WidgetParamName:i});return n&&a.set(n),a},"get:params:collection":function(e){var i=new t;return i.url="/api/widget/"+e+"/params",i}}}))}),define("radio.matrixChain",[],function(){return new(Mn.Object.extend({channelName:"matrixChain",initialize:function(){this.collection=new Backbone.Collection},radioRequests:{"check:chain":function(e){return!this.collection.get(e.id)}},radioEvents:{"start:chain":function(e){this.collection.reset(e)},"add:chain":function(e){this.collection.add(e)}}}))}),define("sett0",["i18n!nls/resources.min","global.behaviors.input"],function(e,t){return Mn.View.extend({behaviors:{input:t},className:"g-form--input",template:"#dashboard-settings0",templateContext:{Resources:e},ui:{title:'input[name="title"]'},onSave:function(){this.model.save({title:this.ui.title.val()})},onCancel:function(){},modelEvents:{invalid:function(){this.ui.title.addClass("error"),setTimeout(function(){this.ui.title.removeClass("error")}.bind(this),3e3)}}})}),define("sett1",["i18n!nls/resources.min","g/ImageGalleryView","RU","syncfusion"],function(e,t){return Mn.View.extend({template:"#dashboard-settings1",templateContext:{Resources:e},ui:{bgColor:"input[name=BackgroundColor]",position:'input[name="BackgroundPosition"]',link:'input[name="BackgroundImageLink"]'},events:{"click @ui.position":function(){this.sender.set("BackgroundPosition",parseInt(this.$("input[name=BackgroundPosition]:checked").val()))}},regions:{gallery:{el:".image-gallery",replaceElement:!0}},initialize:function(){this.sender=new Backbone.Model(this.model.get("Decoration")||{BackgroundColor:"rgba(255, 255, 255, 1)",BackgroundImageLink:"none",BackgroundPosition:3}),this.sender.on("change",function(e,t){if(this.ui.position.filter("[value='"+t+"']").prop("checked",!0),3===t){this.sender.set("BackgroundImageLink","none");var i=this.getChildView("gallery").collection.findWhere({select:!0});i&&i.set("select",!1)}this.model.trigger("change:Decoration",this.model,this.sender.toJSON())},this)},onRender:function(){this.showChildView("gallery",new t({selectedImgPath:this.sender.get("BackgroundImageLink")}));var i={},n=this.sender.get("BackgroundColor")||"rgba(255, 255, 255, 1)",a=n.substr(n.indexOf("("),n.indexOf(")")).replace("(","").replace(")","").split(",");_.each(["r","g","b"],function(e,t){i[e]=parseInt(a[t])}),this.ui.bgColor.ejColorPicker({cssClass:"g-cp",locale:e.Lang}),this.ui.bgColor.ejColorPicker({value:this.ui.bgColor.data("ejColorPicker").RGBToHEX(i),opacityValue:a[3]?100*parseFloat(a[3]):100,close:function(e){var t=this.ui.bgColor.data("ejColorPicker").getColor();this.sender.set("BackgroundColor","rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")")}.bind(this)})},onChildviewChangeItem:function(e){this.sender.set({BackgroundImageLink:e.get("FileUrl"),BackgroundPosition:3===this.sender.get("BackgroundPosition")?1:this.sender.get("BackgroundPosition")})},onSave:function(){this.model.save({Decoration:this.sender.toJSON()},{success:function(e){this.sender.url="/api/wall/"+e.id+"/decoration",this.sender.save({id:e.id})}.bind(this)})},onCancel:function(){this.sender=new Backbone.Model(this.model.get("Decoration")||{BackgroundColor:"rgba(255, 255, 255, 1)",BackgroundImageLink:"none",BackgroundPosition:3}),this.model.trigger("change:Decoration",this.model,this.sender.toJSON()),this.render()}})}),define("sett2",["i18n!nls/resources.min"],function(e){var t=Mn.View.extend({tagName:"span",className:"g-form--input",template:_.template('<input type="text" value="" id="uniname" class="g-form--input" placeholder="<%= Resources.alias %>" /><label for="uniname"><%= Resources.alias %></label><i class="add rtl-1"></i>'),templateContext:{Resources:e},triggers:{"click .add":"user:check"}}),i=Mn.CollectionView.extend({tagName:"tbody",emptyView:Mn.View.extend({tagName:"tr",template:_.template('<td colspan="4">'+e.N+"</td>")}),childView:Mn.View.extend({tagName:"tr",template:_.template('<td><%- UserTitle %></td><td><%= UserUID %></td><td><%- Access? Resources.rw : Resources.ro %></td><td><span class="clear" data-icon="icon-trash"></span></td>'),templateContext:{Resources:e},triggers:{"click .clear":"clear:item"}}),childViewTriggers:{"clear:item":"clear:item"}}),n=Mn.View.extend({tagName:"table",template:_.template("<thead><tr><th><%- Resources.dname %></th><th><%- Resources.login %></th><th><%- Resources.scope %></th><th></th></tr></thead><tbody></tbody><tfoot></tfoot>"),templateContext:{Resources:e},regions:{tbody:{el:"tbody",replaceElement:!0}},onRender:function(){this.showChildView("tbody",new i({collection:this.collection}))},childViewTriggers:{"clear:item":"clear:item"}}),a=Mn.View.extend({tagName:"tr",template:_.template('<td><%- UserTitle %></td><td><%= UserUID %></td><td><select name="Access"><option value="0"><%- Resources.ro %></option><option value="1"><%- Resources.rw %></option></select></td><td><span class="add" data-icon="icon-round-add"></span></td>'),templateContext:{Resources:e},triggers:{"click .add":"user:add"},onUserAdd:function(){this.model.set("Access",parseInt(this.$("select[name=Access]").val()))}});return Mn.View.extend({template:"#dashboard-settings2",regions:{tools:{el:"div",replaceElement:!0},check:{el:".checked-user",replaceElement:!0},list:{el:".list",replaceElement:!0}},initialize:function(){this.collection=new Backbone.Collection([],{model:Backbone.Model.extend({idAttribute:"UserID",defaults:{UserID:null,UserUID:"",UserTitle:"",Access:0}})}),this.collection.url="/api/wall/"+this.model.id+"/users"},collectionEvents:{add:function(e){$.post("/api/wall/"+this.model.id+"/sharewith",e.toJSON())}},onRender:function(){this.showChildView("tools",new t),this.showChildView("list",new n({collection:this.collection})),this.collection.fetch({reset:!0})},childViewEvents:{"user:add":function(e){this.getRegion("check").reset(),this.collection.add(e.model.toJSON())},"user:check":function(){var t=this.getRegion("tools").currentView.$("input");if($.trim(t.val())){var i=new Backbone.Model;i.url="/api/users/checkname?name="+t.val(),i.fetch({success:function(i){i&&i.get("UserID")?(this.showChildView("check",new a({model:i})),t.val("").removeClass("error")):(t.addClass("error").val(e.nf),setTimeout(function(){t.removeClass("error").val("")},5e3))}.bind(this)})}else t.addClass("error");setTimeout(function(){t.removeClass("error")},5e3)},"clear:item":function(t){this.triggerMethod("show:message:confirm",{text:e.askyousure,fx:function(){t.model.destroy()},ctx:this})}},onSave:function(){},onCancel:function(){}})}),define("sett3",["baseurl","i18n!nls/resources.min","g/ImageGalleryView"],function(e,t,i){return Mn.View.extend({template:"#dashboard-settings3",templateContext:{Resources:t},ui:{pre:".thumb-image"},regions:{gallery:".thumb-gallery"},events:{"change input[name=thumb]":function(i){switch(this.kind=$(i.target).val(),"3"!==this.kind&&this.hideGallery(),this.kind){case"0":this.image="",this.ui.pre.css("background","none");break;case"1":this.ui.pre.append($('<i class="loading" size="l" speed="slow"></i>')),require(["/js/dist/html2canvas.min.js"],function(){html2canvas(this.options.content).then(function(e){this.image=e.toDataURL(),this.ui.pre.css({"background-image":"url("+this.image+")"}),this.ui.pre.find("i").remove()}.bind(this))}.bind(this));break;case"2":this.model.get("Decoration")&&this.model.get("Decoration").BackgroundImageLink?(this.image=this.model.get("Decoration").BackgroundImageLink,this.ui.pre.css({"background-image":"url("+e+"/Files/ImageTransform?path="+this.image+"&width=220&height=160)"})):this.triggerMethod("show:message",t.noselect);break;case"3":this.image="",this.getRegion("gallery").$el.show()}}},initialize:function(){this.kind="0",this.image=""},onRender:function(){var t=!!this.model.get("Screen")&&-1===this.model.get("Screen").indexOf("data:image");t?this.ui.pre.css({"background-image":"url("+e+"/Files/ImageTransform?path="+this.model.get("Screen")+"&width=220&height=160)"}):this.ui.pre.css({"background-image":"url("+this.model.get("Screen")+")"}),this.showChildView("gallery",new i({selectedImgPath:t?this.model.get("Screen"):""})),t&&this.model.get("Screen")!==this.model.get("Decoration").BackgroundImageLink&&this.getRegion("gallery").$el.show()},hideGallery:function(){var e=this.getChildView("gallery").collection.findWhere({select:!0});e&&e.set("select",!1),this.getRegion("gallery").$el.hide()},onChildviewChangeItem:function(t){this.image=t.get("FileUrl"),this.ui.pre.css("background-image","url("+e+"/Files/ImageTransform?path="+t.get("FileUrl")+"&width=220&height=160)")},onSave:function(e){"3"!==this.kind||this.image?this.model.save({Screen:this.image}):this.triggerMethod("show:message",t.noselect)},onCancel:function(){this.render()}})}),define("@DashboardsView",["i18n!nls/resources.min","WidgetModel","@widget.WidgetView","global.view.dialog"],function(e,t,i,n){var a=(Backbone.Radio.channel("selectWidget"),[{id:"sett0",title:e.msd0,icon:"gear"},{id:"sett1",title:e.msd1,icon:"appearance"},{id:"sett2",title:e.msd2,icon:"permission"},{id:"sett3",title:e.msd3,icon:"thumb"}]);return Mn.CollectionView.extend({className:"main-container",onRenderChildren:function(){this.triggerMethod("dashboards:container:full")},childView:Mn.CollectionView.extend({className:"content",initialize:function(){this.collection=new Backbone.Collection([],{model:t}),this.collection.url=function(){return"/api/wall/"+this.model.id}.bind(this)},events:{touchstart:"onEmpty",click:"onEmpty"},onEmpty:function(t){$(t.target).closest(".anbr-widget").get(0)||(this.triggerMethod("select:one"),Backbone.Radio.channel("sidebar").request("open",{nameView:this.model.get("title"),view:this,title:e.dbs},a))},showSideBar:function(){Backbone.Radio.channel("sidebar").trigger("show"),Backbone.Radio.channel("sidebar").request("open",{nameView:this.model.get("title"),view:this,title:e.dbs},a)},sideBarTrigger:function(t){var i="sett2"===t.id?[]:[{id:"onSave",title:e.save,className:"right blue nest-right"},{id:"onCancel",title:e.cancel,className:"right"}];require([t.id],function(n){var a={icon:"gear",className:"settings",title:this.model.id?t.get("title"):e.addVitrin,content:new n({model:this.model,content:this.$el}),footer:i};Backbone.Radio.channel("Notify").request("show:overlay");var o=Backbone.Radio.channel("Notify").request("once:dialog",a);this.listenTo(o,"footer:button:click",function(e){"onSave"===e.model.id&&(o.$el.hide(),Backbone.Radio.channel("Notify").request("hide:overlay")),"onCancel"===e.model.id&&(Backbone.Radio.channel("Notify").request("hide:overlay"),this.removeNew(o))}),this.listenTo(o,"dialog:closed",function(){this.removeNew(o)},this),this.listenTo(o,"detach",function(){Backbone.Radio.channel("Notify").request("hide:overlay")})}.bind(this))},removeNew:function(e){this.model.id||(this.model.set("current",!1),this.model.collection.remove(this.model),Backbone.history.navigate("",{trigger:!0}))},onRenderChildren:function(){this._loadWidgets(0)},onRender:function(){Backbone.on("window:resizeend",function(){},this)},_loadWidgets:function(t){if(this.children.length>t){var i=this.children.findByIndex(t);t++,this.listenToOnce(i,"load:end",function(){this._loadWidgets(t)});i.model.get("requestParameters").IsInvalid?(i.ui.load.html('<p><i style="color:red;">'+e.irdb+"</i></p>"),i.trigger("load:end")):i.onLoad()}else Backbone.Radio.channel("Mode").request("enabled",!0)},show:function(){Backbone.Radio.channel("Mode").request("show",!this.model.get("IsShared")),Backbone.Radio.channel("Mode").request("left:init:model",this),this.model.trigger("change:Decoration",this.model,this.model.get("Decoration")),this.model.id?this.isFetch?Backbone.Radio.channel("Mode").request("enabled",!0):(Backbone.Radio.channel("Mode").request("enabled",!1),Backbone.trigger("message:modal"),this.collection.fetch({reset:!0}),this.isFetch=!0):(this.showSideBar(),this.sideBarTrigger(a[0])),this.$el.show();var e=$(window).width()/this.$el.width();$("head meta[name=viewport]").attr("content","width=device-width, initial-scale="+(e<1?e:"1.0"))},collectionEvents:{update:function(t,i){if(i.add){var n=i.changes.added[0],a=this.children.findByModel(n);a.switchMode(!0).onLoad(),this.triggerMethod("select:one",n),a._addSettings(),Backbone.Radio.channel("sidebar").request("open",{nameView:a.model.get("title"),view:a.getChildView("settings"),title:e.wst},a.getChildView("settings").getMenu())}},destroy:function(){Backbone.Radio.channel("sidebar").request("open",{nameView:this.model.get("title"),view:this,title:e.dbs},a)},reset:function(){Backbone.Radio.channel("Mode").request("enabled",!0),Backbone.trigger("message:hide")},error:function(){Backbone.trigger("message:hide")}},modelEvents:{"change:id":function(e,t){t&&(Backbone.history.navigate(t,{trigger:!1}),Backbone.Radio.channel("Mode").request("enabled",!0),Backbone.Radio.channel("Mode").request("turn:switch",!0))},"change:current":function(e,t){t?(Backbone.Radio.channel("Mode").request("turn:switch",!1),$(window).scrollTop(0),Backbone.history.navigate(e.id||"new",{trigger:!e.id}),this.show()):this.$el.removeClass("edit-mode").hide()},"change:Decoration":function(e,t){if(t){var i={"background-color":t.BackgroundColor,"background-image":t.BackgroundImageLink?"url('"+t.BackgroundImageLink+"')":"none","background-attachment":"fixed","background-repeat":"no-repeat","background-position":"50% 50%","background-size":"auto"};1===t.BackgroundPosition?i["background-size"]="cover":2===t.BackgroundPosition?i["background-repeat"]="repeat":3===t.BackgroundPosition&&(i["background-image"]="none"),this.$el.css(i)}else e.set("Decoration",{BackgroundColor:"rgba(255, 255, 255, 1)",BackgroundImageLink:"none",BackgroundPosition:3})}},childView:i,childViewEvents:{"widget:drag":function(e,t,i,n){this.children.each(function(a){if(a.$el.hasClass("widget-editing")&&a.model.id!==e.id){var o=a.$el.position().top,s=a.$el.position().left;o<0&&(o=3),s<0&&(s=3),a.model.set({top:o+i,left:s+t}),n&&a.position.save()}},this)},"fix:size":function(e){if(this.$el.width()<e.get("left")+e.get("width")){this.$el.width(e.get("left")+e.get("width"));var t=$(window).width()/this.$el.width();$("head meta[name=viewport]").attr("content","width=device-width, initial-scale="+(t<1?t:"1.0"))}this.$el.height()<e.get("top")+e.get("height")&&this.$el.height(e.get("top")+e.get("height"))}},childViewTriggers:{"select:more":"select:more","select:one":"select:one"}}),childViewTriggers:{"select:more":"select:more:widget","select:one":"select:one:widget"}})}),define("DecorationView",["i18n!nls/resources.min","g/ImageGalleryView","spectrumColorView"],function(e,t,i){return Mn.View.extend({className:"VitrinDecoration",template:"#decoration-board",templateContext:{Resources:e},ui:{bgColor:"input[name=BackgroundColor]",position:'input[name="BackgroundPosition"]',link:'input[name="BackgroundImageLink"]'},events:{"click @ui.position":function(){this.model.set("BackgroundPosition",parseInt(this.$("input[name=BackgroundPosition]:checked").val()))},"click .icon-clear":function(){this.ui.link.val("")}},regions:{gallery:{el:".image-gallery",replaceElement:!0}},onRender:function(){this.showChildView("gallery",new t({selectedImgPath:this.model.get("BackgroundImageLink")})),this.color=new i({el:this.$("input.Decoration")}),this.listenTo(this.color,"change:color",function(e,t,i){this.model.set("BackgroundColor",t)})},onChildviewChangeItem:function(e){this.model.set({BackgroundImageLink:e.get("FileUrl"),BackgroundPosition:3===this.model.get("BackgroundPosition")?1:this.model.get("BackgroundPosition")})},modelEvents:{"change:BackgroundPosition":function(e,t){if(this.ui.position.find("[value='"+t+"']").prop("checked",!0),3===t){this.model.set("BackgroundImageLink","none");var e=this.getChildView("gallery").collection.findWhere({select:!0});e&&e.set("select",!1)}},"change:BackgroundColor":function(e,t){this.color.$el.spectrum("set",t)}}})}),define("@FirstView",["i18n!nls/resources.min","baseurl"],function(e,t){var i=Mn.CollectionView.extend({className:"list",emptyView:Mn.View.extend({className:"create",getTemplate:function(){return"my"===this.options.flag?_.template('<section><span class="font-icon font-icon-add"></span><span><%- Resources.addVitrin %></span></section>'):_.template("")},templateContext:{Resources:e},events:{click:function(){Backbone.history.navigate(v.model.id||"new",{trigger:!0})}}}),childView:Mn.View.extend({template:"#first-item-template",templateContext:{baseurl:t},triggers:{click:"click:item"},events:{"click i.remove":function(t){t.stopPropagation(),Backbone.trigger("message:confirm",{title:e.askyousure,message:$.Format(e.deltext,e.todashboard,this.model.get("title")),fx:function(){this.model.destroy()},ctx:this})}},modelEvents:{"change:Screen":function(e,t){this.render()}}}),childViewTriggers:{"click:item":"click:item"},childViewOptions:function(){return{flag:this.options.flag}},filter:function(e){return"my"===this.options.flag?!e.get("IsShared"):e.get("IsShared")},onRenderChildren:function(){if("my"===this.options.flag){var t=Mn.View.extend({className:"create",template:_.template('<section><span class="font-icon font-icon-add"></span><span><%- Resources.addVitrin %></span></section>'),templateContext:{Resources:e}});this.addChildView(new t({model:new Backbone.Model({id:"create"})}),0)}else this.$("i.remove").hide()},onRender:function(){this.$el.sortable({placeholder:"placeholder-class",items:"div:not(.create)",stop:function(e,t){}.bind(this)}).disableSelection()}});return Mn.View.extend({template:"#first-page-template",templateContext:{Resources:e},ui:{title:"h1"},regions:{list:{el:".list",replaceElement:!0}},events:{"touchstart button":"tabNav","click button":"tabNav","click .create":function(){Backbone.history.navigate("new",{trigger:!0})}},tabNav:function(e){var t=$(e.target).closest("button").attr("data-link");Backbone.history.navigate("shared"===t?"demo":"",{trigger:!0})},onBeforeRender:function(){this.$el.attr("id","first-page")},onRender:function(){this.showChildView("list",new i({collection:this.collection,flag:this.options.filter}));var t={my:e.myDashboard,shared:e.shareDashboard};this.$("button[data-link='"+this.options.filter+"']").addClass("pressed"),this.ui.title.text(t[this.options.filter])},onChildviewClickItem:function(e){Backbone.history.navigate(e.model.id||"new",{trigger:!0})}})}),define("mainView",["i18n!nls/resources.min","@FirstView","@SliderView","@DashboardsView","leftPanel","topPanel","radio.matrixChain","global.radio.sideBar"],function(e,t,i,n,a,o){new(Mn.Object.extend({channelName:"Mode"})),new(Mn.Object.extend({channelName:"selectWidget"}));var s=Backbone.Model.extend({defaults:{id:null,title:e.title,IsShared:!1,current:!1,isInit:!1,Screen:"",Decoration:{BackgroundColor:"rgba(255, 255, 255, 1)",BackgroundImageLink:"none",BackgroundPosition:3},CDate:(new Date).toISOString()},validate:function(e,t){var i=[];if($.trim(e.title)||i.push({name:"title"}),i.length)return i}}),r=Backbone.Collection.extend({model:s,url:function(){return"/api/wall/"}});return Mn.View.extend({template:"#main-template",templateContext:{Resources:e},ui:{mode:".mode-info",sw:".g-form--switch"},regions:{first:{el:"#first",replaceElement:!0},container:{el:"#container",replaceElement:!0},top:{el:".Shna",replaceElement:!0},left:{el:"#left-property",replaceElement:!0},slider:{el:"#slider",replaceElement:!0},dialog:{el:"#dialog",replaceElement:!0}},triggers:{"click @ui.mode:not(.disabled) button":"click:mode"},onClickMode:function(){Backbone.Radio.channel("Mode").request("turn:switch","on"!==this.ui.sw.attr("mode"))},initialize:function(){this.collection=new r,this.collection.comparator=function(e){return-new Date(e.get("CDate"))};var e=Backbone.Radio.channel("Mode");e.reply("show",function(e){e?this.ui.mode.show():this.ui.mode.hide()}.bind(this)),e.reply("enabled",function(e){e?this.ui.mode.removeClass("disabled"):this.ui.mode.addClass("disabled")}.bind(this)),e.reply("turn:switch",this.switchMode.bind(this)),Backbone.Radio.channel("Notify").reply("add:dialog",function(e){if(this.getRegion("dialog").hasView()){this.getChildView("dialog").$el.is(":visible")||this.showChildView("dialog",e)}else this.showChildView("dialog",e)}.bind(this))},onBeforeRender:function(){Backbone.trigger("message:modal"),this.collection.fetch({reset:!0})},onRender:function(){this.showChildView("top",new o),this.showChildView("left",new a),this.showChildView("slider",new i({collection:this.collection})),this.showChildView("container",new n({collection:this.collection}))},childViewEvents:{"render:vitrin:after:clone:widget":function(e){var t=this.getChildView("container").children.findByModel(e);t.isFetch&&t.collection.fetch({reset:!0})},"select:more:widget":function(e){this.getChildView("top").getChildView("position").collection.add(e)},"select:one:widget":function(e){var t=this.getChildView("top").getChildView("position");t.collection.reset(),e&&t.collection.add(e)},"dashboards:container:full":function(){this.isWaitShow&&this.show()},"slider:new:dashboard":function(){this.options.uid=null,this.show()},"show:left:panel":function(){this.getChildView("left").onShow()}},showFirst:function(e){this.getRegion("dialog").empty(),Backbone.Radio.channel("Mode").request("show",!1),this.getRegion("first").hasView()?this.getChildView("first").options.filter!==e?(this.getChildView("first").options.filter=e,this.getChildView("first").render(),this.getChildView("first").$el.show()):this.getChildView("first").$el.slideDown():this.showChildView("first",new t({collection:this.collection,filter:e}))},onShow:function(){this.getRegion("first").hasView()&&this.getChildView("first").$el.slideUp(),this.collection.length?this.show():this.isWaitShow=!0},show:function(){if(this.options.uid){this.clearCurrent();var t=this.collection.get(this.options.uid);t?t.set("current",!0):(Backbone.trigger("message:warning",{message:e.dnvu}),Backbone.history.navigate("",{trigger:!0}))}else{this.getRegion("dialog").empty(),Backbone.Radio.channel("Mode").request("enabled",!1),this.getChildView("left").$el.removeClass("show"),this.getChildView("top").getChildView("position").collection.reset();var i=this.collection.findWhere({id:null})||new s;i.collection=this.collection,this.collection.add(i),this.clearCurrent(),i.set("current",!0);var n=this.getChildView("container").children.findByModel(i);this.getChildView("top").onShow(n)}},collectionEvents:{remove:function(){this.collection.length||(this.options.uid=null,this.show())},reset:function(){this.collection.length||(this.options.uid=null,this.show()),Backbone.trigger("message:hide")},error:function(){Backbone.trigger("message:hide")}},clearCurrent:function(){var e=this.collection.findWhere({current:!0});e&&e.set("current",!1)},switchMode:function(e){var t=this.collection.findWhere({current:!0}),i=this.getChildView("container").children.findByModel(t);e?(this.ui.sw.attr("mode","on"),i.$el.addClass("edit-mode"),this.getChildView("top").onShow(i),i.showSideBar(),this.getChildView("slider").getChildView("list").children.each(function(e){e.model.get("IsShared")||e.$("span").css("display","inline-block")}),i.children.each(function(e){e.switchMode(!0)})):(this.ui.sw.attr("mode","off"),i.$el.removeClass("edit-mode"),this.getChildView("top").$el.hide(),this.getChildView("left").$el.removeClass("show"),Backbone.Radio.channel("sidebar").trigger("hide"),this.getRegion("dialog").empty(),this.getChildView("slider").getChildView("list").children.each(function(e){e.model.id&&e.$("span").hide()}),i.children.each(function(e){e.switchMode(!1)}))}})}),define("@SliderView",["baseurl","i18n!nls/resources.min"],function(e,t){var i=Mn.CollectionView.extend({className:"slider",childView:Mn.View.extend({className:"vitrina",template:"#slider-item-template",templateContext:{baseurl:e},events:{"click .panel-vitrin":"setCurrent","click .delete-vitrina":function(){Backbone.trigger("message:confirm",{title:t.askyousure,message:$.Format(t.deltext,t.todashboard,this.model.get("title")),fx:function(){this.model.get("current")&&this.model.set("current",!1),this.model.destroy(),Backbone.history.navigate("",{trigger:!0})},ctx:this})}},setCurrent:function(){var e=this.model.collection.findWhere({current:!0});e?this.model.id!==e.id&&(e.set("current",!1),this.model.set("current",!0)):this.model.set("current",!0)},modelEvents:{"change:current":function(e,t){t?(this.$el.addClass("current"),this.triggerMethod("slider:render",this.$el.index())):this.$el.removeClass("current")},"change:Screen":function(e,t){this.render()},"change:title":function(e,t){this.$(".name-vitrina").text(t)}},onDetach:function(){this.triggerMethod("slider:board:detached",this)}}),calcStep:function(){var e=this.$el.closest(".items-wrap").width(),t=273*this.collection.length,i=t>e;this.maxStep=i?Math.ceil((t-e)/273):0,this.step>=this.maxStep&&(i=!1),this.triggerMethod("show:more",i)},slideLine:function(e){var t=e>=this.maxStep;this.step=t?this.maxStep:e,0!==this.step&&(this.step-=1),this.$el.animate({left:"-"+273*this.step}),this.triggerMethod("show:more",!t)},initialize:function(){this.step=0,this.maxStep=0,Backbone.on("window:resizeend",this.calcStep,this)},onRenderChildren:function(){var e=273*this.collection.length;this.$el.width(e),this.calcStep();var t=this.collection.findWhere({current:!0});if(t){var i=this.children.findByModel(t);i.$el.addClass("current"),this.slideLine(i.$el.index())}},onChildviewSliderRender:function(e){this.slideLine(e)}});return Mn.View.extend({template:"#slider-template",templateContext:{Resources:t},triggers:{"click .show-add-vitrin":"slider:new:dashboard"},events:{"click .bolt-lug":"top","click .le":"left","click .ri":"right","touchstart .bolt-lug":"top","touchstart .le":"left","touchstart .ri":"right"},ui:{more:".continue"},regions:{list:".items-wrap"},onRender:function(){this.$el.attr("id","vitrin-list"),this.showChildView("list",new i({collection:this.collection}))},collectionEvents:{update:function(e,t){this.getChildView("list").calcStep()},reset:function(){setTimeout(function(){this.top()}.bind(this),8e3)}},top:function(){this.$el.toggleClass("abs").find(".arrow").toggleClass("nord")},left:function(){var e=this.getChildView("list");e.step>0&&(e.step--,e.$el.animate({left:"+=273"}),this.ui.more.show())},right:function(){var e=this.getChildView("list");e.step<e.maxStep?(e.step++,e.$el.animate({left:"-=273"}),e.step===e.maxStep&&this.ui.more.hide()):this.ui.more.hide()},onChildviewShowMore:function(e){e?this.ui.more.show():this.ui.more.hide()}})}),define("d3:histogram",["global.charts.settingsmodel"],function(e){return Mn.View.extend({template:_.template(""),initialize:function(){this.flag=!1,this.isGrouped=!1,this.Grops={};var t=this.options.items.variations[1].flow[0].points;this.dx=[],this.collection=new Backbone.Collection;var i=this.model.get("typeName")+".GhaphSubSettings",n=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:i});this.subSettings=new e,n&&this.subSettings.set(n.WidgetParamValue),_.each(t,function(e){var t={id:e.elId,x:e.x,y:parseFloat(e.y),title:e.text},i=this.collection.get(t.id),n=new Date(t.x),a=t.x;if("Invalid Date"!==n.toString()&&(a=n,this.flag=!0),-1===this.dx.indexOf(a)&&this.dx.push(a),i){var o=i.get("y");o.push(t.y),i.set("y",o)}else t.y=[t.y],this.collection.add(t)},this)},onBeforeRender:function(){this.$el.css({position:"absolute",top:0,left:0,bottom:0,right:0})},onRender:function(){var e=[];this.collection.each(function(t,i){var n=t.get("y"),a=t.get("GroupName");-1===this.dx.indexOf("x")&&this.dx.unshift("x"),1!==n.length?(e.push(this.dx),n.unshift(t.get("title"))):n.unshift(t.get("x")),e.push(n),a&&(this.isGrouped=!0,this.Grops[a]?this.Grops[a].push(t.get("x")):this.Grops[a]=[t.get("x")])},this);var t={columns:e,type:this.options.chart||"bar"},i={y:{label:this.subSettings.get("primaryYAxisTitle")}},n=[],a=[];if(this.flag&&(t.x="x",i.x={type:"timeseries",tick:{format:"%Y-%m-%d"}}),this.isGrouped){for(var o in this.Grops)n.push(this.Grops[o]),a.push(o),a.length>=2&&_.each(e,function(e){_.each(n,function(t,i){_.contains(t,e[0])&&e.splice(i+1,0,0)})});i.x={type:"category",categories:a},t.groups=n}try{c3.generate({bindto:this.el,data:t,tooltip:{grouped:!1,format:{title:function(e){return this.title}}},axis:i,bar:{width:{ratio:.5}}})}catch(e){console.error(e.message,t)}}})}),define("requestView",["bdid","i18n!nls/resources.min","services.library.libraryView","global.view.dialog","global.view.connect"],function(e,t,i,n,a){var o=Backbone.Collection.extend({model:Backbone.Model.extend({idAttribute:"rid",defaults:{rid:0,domain:"",dbase:parseInt(e),requestid:null,param:[],page:1,pagesize:10}}),url:function(){return"/api/interactive/getparamsforwall/"}}),s=Mn.View.extend({className:"item",
template:_.template('<input type="radio" id="<%- rid %>_<%- prefix %>" class="g-form--radio" name="radio_MasterCreate"><label for="<%- rid %>_<%- prefix %>"><%- title %></label><svg class="svg-icon icon-close"><use xlink:href="#icon-close" /></svg>'),triggers:{"click input":{event:"click:item",stopPropagation:!1,preventDefault:!1},"click .icon-close":"close"},onClose:function(){Backbone.trigger("message:confirm",{title:t.askyousure,message:t.crn,fx:function(){this.model.destroy({wait:!0})},ctx:this})}}),r=Mn.CollectionView.extend({className:"list-area",childView:s,emptyView:Mn.View.extend({template:_.template('<div class="item">'+t.N+"</div>")}),onRenderChildren:function(){if(this.requestAddedID){var e=this.collection.findWhere({requestid:parseInt(this.requestAddedID)});e&&(this.children.findByModel(e).$("input").prop("checked",!0),this.requestAddedID=null)}this.model.get("requestParameters")&&this.model.get("requestParameters").rid&&(e=this.collection.get(this.model.get("requestParameters").rid),this.children.findByModel(e).$("input").prop("checked",!0))},childViewOptions:function(e){e.set("prefix",this.model.get("widgetID"))},childViewTriggers:{"click:item":"child:click:item"}});return Mn.View.extend({template:templates["requests-template"],templateContext:{Resources:t},ui:{description:".description",t:".title2"},regions:{list:{el:".list-area",replaceElement:!0}},events:{"click .refresh":function(){this.collection.fetch({reset:!0}),this.model.set({requestParameters:{}})},"click .library":function(e){var o=new a,s=new n({color:"blue",icon:"gear",modal:!0,size:"full",title:t.titleReqLib,footer:new Backbone.Collection([{id:"cancel",title:t.cancel},{id:"connect",title:t.Connect,className:"right blue disabled"}]),content:o});this.listenTo(s,"footer:button:click",function(e){var n="";switch(e.model.id){case"cancel":s.close();break;case"connect":n=o.collection.at(0).id,$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.url,{db:"db"+n}),s.model.get("footer").set([{id:"cancel",title:t.cancel},{id:"add",title:t.add,className:"right blue"}]),s.model.set("content",new i({widgetType:this.model.get("typeName"),dbase:n}));break;case"add":var a=s.model.get("content");if(a.requestID){var r=a.getChildView("params").collection.toJSON(),l={domain:window.location.host,dbase:n,requestid:a.requestID,parameters:r};$.ajax({url:"/api/interactive/paramsforwall",data:$.param(l),type:"POST"}).done(function(e,i){this.getChildView("list").requestAddedID=a.requestID,this.collection.fetch({reset:!0,success:function(e){var i=this.collection.findWhere({requestid:parseInt(a.requestID)});i?(this.model.set({requestParameters:i.toJSON()}),s.close()):Backbone.trigger("message:warning",{message:t.error+" "+t.N})}.bind(this)})}.bind(this))}else a.triggerMethod("show:message",t.noselect)}}),this.listenTo(o,"connect:made",function(){s.getChildView("footer").children.findByIndex(1).$("button").removeClass("disabled")}),Backbone.Radio.channel("Notify").request("add:dialog",s)}},initialize:function(){this.collection=new o},onAttach:function(){-1===["WidgetSource","WidgetReporting","WidgetHtml","WidgetSemNet"].indexOf(this.model.get("typeName"))?(this.showChildView("list",new r({collection:this.collection,model:this.model})),this.collection.url="/api/interactive/getparamsforwall/"+this.model.get("typeName"),this.collection.fetch({reset:!0})):this.$el.hide()},collectionEvents:{request:function(){Backbone.Radio.channel("loader").trigger("show",this.ui.t,{size:"",speed:"fast"})},sync:function(){Backbone.Radio.channel("loader").trigger("hide")},update:function(e,t){t.changes.removed.length&&this.model.get("requestParameters")&&this.model.get("requestParameters").rid===t.changes.removed[0].id&&this.model.set({requestParameters:{}}),Backbone.Radio.channel("loader").trigger("hide")}},onChildviewChildClickItem:function(e){this.model.set({requestParameters:e.model.toJSON()})}})}),define("leftPanel",["WidgetModel","MasterCreateView"],function(e,t){return Mn.View.extend({className:"side-panel",template:_.template('<svg class="svg-icon icon-close"><use xlink:href="#icon-close" /></svg><section id="master-create"></section>'),events:{"click .icon-close":function(){this.$(".step-panel").hide(),this.$el.removeClass("big").removeClass("show")}},regions:{master:"#master-create"},initialize:function(){this.model=new e,Backbone.Radio.channel("Mode").reply("left:init:model",function(e){this.collection=e.collection}.bind(this))},onRender:function(){this.$el.attr("id","left-property")},onShow:function(){this.model=new e,this.model.collection=this.collection,this.$el.hasClass("show")||(this.$el.addClass("show"),this.showChildView("master",new t({model:this.model})))},onChildviewCloseLeft:function(){this.$el.removeClass("show"),this.getRegion("master").empty()}})}),define("topPanel",["i18n!nls/resources.min","global.view.dropDown","global.view.dialog","settings.decorationWidget"],function(e,t,i,n){var a=Mn.View.extend({template:"#clone-widget-dialog-template",templateContext:{Resources:e},ui:{nd:"#newDBName"},regions:{dd:{el:"#dashboards-list",replaceElement:!0}},events:{"change select.profile":"selectVitrina"},onRender:function(){var i=new Backbone.Collection(this.model.collection.models);i.add({id:0,title:e.wall_toPanelView_newVitrina},{at:0});var n=new t({collection:i,current:"0"});this.showChildView("dd",n),this.listenTo(n,"dropdown:select",function(e){this.selectClonningVitrina(e.id)}),this.getChildView("dd").getChildView("container").setFilter(function(e){return!e.get("IsShared")}.bind(this))},selectClonningVitrina:function(e){e?$(this.ui.nd).parent().parent().hide():$(this.ui.nd).parent().parent().show()}}),o=Mn.View.extend({tagName:"div",className:"position-buttons",template:"#position-btns-template",templateContext:{Resources:e},ui:{dx:"input[name='PositonPadding-x']",dy:"input[name='PositonPadding-y']",width:'input[name="width"]',height:'input[name="height"]'},regions:{mo:{el:"#multi-operation",replaceElement:!0},dialog:{el:"#dialog",replaceElement:!0}},events:{"click button:not([disabled])":"fixed","keyup @ui.dx":function(e){13===e.keyCode&&this.fixed(e,"dispose-x")},"keyup @ui.dy":function(e){13===e.keyCode&&this.fixed(e,"dispose-y")},"keyup @ui.width":function(e){13===e.keyCode&&this._setProp(parseInt(this.ui.width.val()),"width")},"keyup @ui.height":function(e){13===e.keyCode&&this._setProp(parseInt(this.ui.height.val()),"height")}},_setProp:function(e,t){var i=this.currentDashboard.children;this.collection.each(function(n){isNaN(e)||e<150?this.ui[t].val(n.get(t)):(n.set(t,e),i.findByModel(n).position.save())},this)},fixed:function(e,t){var t=$(e.target).closest("button").attr("name")||t,i=parseInt(this.ui.dx.val()),n=parseInt(this.ui.dy.val()),a=t;if("front"===t)return void this.calcPosition(!0);if("back"===t)return void this.calcPosition(!1);if(this.collection.length>1){this.firstModel=this.collection.at(0);var o=[],s=this.firstModel.get(a),r={left:this.firstModel.get("left"),top:this.firstModel.get("top")};this.collection.each(function(e){switch(t){case"dispose-x":if(a="left",s=r.left,isNaN(i))return this.ui.dx.css("border-color","red"),void setTimeout(function(){this.ui.dx.css("border-color","")}.bind(this),2e3);this.ui.dx.css("border-color",""),r.left+=e.get("width")+i;break;case"dispose-y":if(a="top",s=r.top,isNaN(n))return this.ui.dy.css("border-color","red"),void setTimeout(function(){this.ui.dy.css("border-color","")}.bind(this),2e3);this.ui.dx.css("border-color",""),r.top+=e.get("height")+n;break;case"size":s={},s.width=this.firstModel.get("width"),s.height=this.firstModel.get("height"),a="size";break;case"middle":a="top",s=this.firstModel.get("top")+this.firstModel.get("height")/2-e.get("height")/2,s<0&&(s=5);break;case"bottom":a="top",s=this.firstModel.get("top")+this.firstModel.get("height")-e.get("height"),s<0&&(s=5);break;case"center":a="left",s=this.firstModel.get("left")+this.firstModel.get("width")/2-e.get("width")/2,s<0&&(s=5);break;case"right":a="left",s=this.firstModel.get("left")+this.firstModel.get("width")-e.get("width"),s<0&&(s=5)}o.push({WidgetUid:e.id,PlacementWidth:"size"===t?s.width:"width"===t?s:e.get("width"),PlacementHeight:"size"===t?s.height:"height"===t?s:e.get("height"),PlacementTop:"top"===a?s:e.get("top"),PlacementLeft:"left"===a?s:e.get("left"),ZIndex:"zIndex"===t?s:e.get("zIndex")}),"size"!==t?e.set(a,s):e.set({width:s.width,height:s.height})},this),this.onSave(o)}},calcPosition:function(e){var t=this.collection.at(0),i=this.currentDashboard.children,n=1;if(e){var a=this.currentDashboard.collection.max(function(e){return e.get("zIndex")});if(a){if(t.id===a.id)return;n=parseInt(a.get("zIndex"))+1}}else{var o=[];this.currentDashboard.collection.each(function(e){if(1===parseInt(e.get("zIndex"))){var t=i.findByModel(e);e.set("zIndex",e.get("zIndex")+1),o.push(t.position.toJSON())}}),this.onSave(o)}t.set("zIndex",n);var s=i.findByModel(t);s.position.save(),s.$el.removeClass("widget-editing")},onSave:function(e){$.ajax({method:"POST",contentType:"application/json; charset=utf-8",url:"/api/wall/"+this.model.id+"/positions",data:JSON.stringify(e)})},collectionEvents:{destroy:function(e){this.$("#count").text(this.collection.length)},add:function(t){if(this.currentDashboard.children.findByModel(t).$el.addClass("widget-editing"),this.$("button[name=front], button[name=back], button[name=resize]").removeAttr("disabled","disabled"),this.collection.length>1){this.$("button").removeAttr("disabled"),this.ui.width.val(""),this.ui.height.val("");var i=[{id:"decoration",title:e.m3,icon:"appearance"},{id:"clear",title:e.del,icon:"trash"}];Backbone.Radio.channel("sidebar").request("open",{titleView:"",view:this,name:e.dbs},i)}else this.ui.width.val(t.get("width")),this.ui.height.val(t.get("height"));this.getChildView("mo").$el.removeClass("disabled"),this.$("#count").text(this.collection.length)},reset:function(e,t){this.currentDashboard&&(this.currentDashboard.children.each(function(e){e.$el.removeClass("widget-editing"),e.getRegion("settings").hasView()&&e.getChildView("settings").hide()}),this.$("#count").text(this.collection.length),this.$("button").attr("disabled","disabled"),this.getChildView("mo").$el.addClass("disabled"))}},initialize:function(){this.collection=new Backbone.Collection},onRender:function(){this.$("button").attr("disabled","disabled"),this.showChildView("mo",new t({placeholder:'<div class="item"><span><svg><use xlink:href="#selected-widgets" /></svg></span><span>'+e.selectedWidgets+'</span><span id="count">0</span></div>',collection:new Backbone.Collection([{id:"clone",title:e.cloneTo,icon:"icon-clone"},{id:"clear",title:e.deleteItem,icon:"icon-trash"}])})),this.getChildView("mo").$el.addClass("disabled")},childViewEvents:{"dropdown:select":function(t,n){switch(t.id){case"clone":var o=new i({content:new a({model:this.model}),title:e.cloneTo,icon:"clone",footer:new Backbone.Collection([{id:"clone",title:e.save,className:"blue right"}])});this.listenTo(o,"footer:button:click",function(t){var i=o.model.get("content").getChildView("dd").current.id;if(i)this._cloneWidgets(i,o),o.destroy();else{var n=$.trim(o.model.get("content").ui.nd.val());n?(this.model.collection.create({title:n},{wait:!0}),this.listenToOnce(this.model.collection,"sync",function(e){this._cloneWidgets(e.id,o),o.destroy()}.bind(this))):o.getChildView("notify").showNotify(e.newDBName+" - "+e.isEmpty.toLowerCase())}}),Backbone.Radio.channel("Notify").request("add:dialog",o);break;case"clear":this._clearWidgets()}}},sideBarTrigger:function(t){switch(t.id){case"decoration":var a=this.collection.at(0),o=new i({content:new n({model:a}),title:e.m3,icon:"appearance",footer:new Backbone.Collection([{id:"decor",title:e.save,className:"blue right"}])});this.listenTo(a,"change",function(){this.collection.each(function(e){e.set("Decoration",a.get("Decoration"))})}),this.listenTo(o,"footer:button:click",function(t){this.collection.each(function(e){e.save()}),o.getChildView("notify").showNotify(e.success)}),Backbone.Radio.channel("Notify").request("add:dialog",o);break;case"clear":this._clearWidgets()}},_cloneWidgets:function(e,t){var i={widgets:this.collection.pluck("id"),vitrins:[e]};if(!i.widgets||!i.widgets.length)return void this.collection.reset();$.ajax({url:"/api/wall/service/widgetclonning",data:i,type:"POST"}).done(function(){var e=this.model.collection.get(i.vitrins[0]);this.triggerMethod("render:vitrin:after:clone:widget",e),Backbone.Radio.channel("Mode").request("turn:switch",!1),this.collection.reset()}.bind(this)).fail(function(){t.getChildView("notify").showNotify("Internal Error")})},_clearWidgets:function(){Backbone.trigger("message:confirm",{title:e.askyousure,message:$.Format(e.deltext,e.widget,this.collection.pluck("title").join(", ")),fx:function(){Array.from(this.collection.models).map(function(e){e.destroy()})},ctx:this})}});return Mn.View.extend({className:"Shna",template:"#top-buttons-template",templateContext:{Resources:e},triggers:{"click .show-add-widget-btn":"show:left:panel"},events:{"mouseenter .show-add-widget-btn":function(e){$(e.target).closest("button").find(".anbr-tooltip").show()},"mouseleave .show-add-widget-btn":function(e){$(e.target).closest("button").find(".anbr-tooltip").fadeOut()}},regions:{position:{el:"#position-buttons",replaceElement:!0}},onRender:function(){this.showChildView("position",new o)},onShow:function(e){this.getChildView("position").currentDashboard=e,this.getChildView("position").model=e.model,this.$el.show(),e.collection.length||this.$(".show-add-widget-btn").find(".anbr-tooltip").show()},childViewTriggers:{"render:vitrin:after:clone:widget":"render:vitrin:after:clone:widget"}})}),define("settings.colorRow",["i18n!nls/resources.min","RU"],function(e){var t=Mn.CollectionView.extend({childView:Mn.View.extend({template:_.template('<span style="cursor:pointer;line-height:28px;padding-left:6px;"><%- display_name %></span><span class="reload" style="float:right;display:block;margin-top:9px;" data-icon="icon-reload"></span><span class="picker" style="display:inline-block;width:40px;height:16px;margin-top:6px;float:right;cursor:pointer;background-color:<%- color %>;border:solid 1px gray;"></span>'),ui:{picker:".picker"},triggers:{"click @ui.picker":"click:item"},events:{"click .reload":function(e){e.stopPropagation(),this.model.set("color","none")}},modelEvents:{"change:color":function(e,t){this.ui.picker.css("background",t)}}}),childViewOptions:function(e){e.has("color")||e.set("color","none")},childViewTriggers:{"click:item":"click:item"}});return Mn.View.extend({template:_.template('<div class="right" style="height:0px;overflow:hidden;"><input type="text" class="color-items-diagram" /></div><div class="list" style="clear:both;"></div>'),templateContext:{Resources:e},regions:{list:".list"},onRender:function(){this.$(".color-items-diagram").ejColorPicker({enableOpacity:!1,locale:e.Lang}),this._prepareCollection()},collectionEvents:{reset:function(){this._prepareCollection()}},_prepareCollection:function(){var e=this.collection,i=new Backbone.Collection,n=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"PaletteByChart"}),a=n?n.WidgetParamValue:void 0;if(1===e.length){var o=e.at(0);o.set({object_id:null,display_name:""}),o.get("points").map(function(e){var t="none";if(a){var n=_.findWhere(a,{object_id:e.elId});n&&(t=n.color)}i.add(new Backbone.Model({object_id:e.elId,display_name:e.x,color:t}))})}else e.map(function(e){var t=new Backbone.Model({object_id:e.get("elId"),display_name:e.get("name")||_.pluck(e.get("points"),"x").join(",")});if(a){var n=_.findWhere(a,{object_id:e.get("elId")});n&&t.set("color",n.color)}i.add(t)});this.showChildView("list",new t({collection:i}))},onChildviewClickItem:function(e){this.$(".color-items-diagram").ejColorPicker("hide"),this.$(".color-items-diagram").ejColorPicker({open:function(t){this.option("value",e.model.get("color"))},select:function(t){e.model.set("color",t.value)}}),this.$(".color-items-diagram").ejColorPicker("show")}})}),define("settings.htmlEditor",["requestView","g/ejRTEView"],function(e,t){return Mn.View.extend({template:_.template('<div class="list" style="display:none;height:196px;margin-bottom:10px;"></div><div class="editor"></div>'),regions:{reqArea:".list",editor:".editor"},onAttach:function(){if(!this.getRegion("editor").hasView()){var i=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"WidgetRunDirection"})||{WidgetParamValue:{Right:!1}};this.showChildView("editor",new t({value:this.model.get("contentHtml"),enableRTL:i.WidgetParamValue.Right}))}this.getRegion("reqArea").show(new e({model:new Backbone.Model({typeName:"All",widgetID:this.model.id})})),this.getChildView("reqArea").ui.description.hide(),this.getChildView("reqArea").model.on("change:requestParameters",function(e){var t=e.get("requestParameters");if(t.rid){this.model.set({requestParameters:t});var i=this.getChildView("editor").ejRTE.getSelectedHtml();$.trim(i)||(i='<svg style="fill:#666666; width:24px; height:24px;"><path d="M15,0.279C14.704,0.106,14.365,0,14,0h-1H4C2.9,0,2,0.9,2,2v10c-0.735,0-1.373,0.406-1.721,1C0.106,13.296,0,13.635,0,14s0.106,0.704,0.279,1C0.627,15.594,1.265,16,2,16h1h6h1h1c1.1,0,2-0.9,2-2v-1v-2V6V4h2h1V3V2 C16,1.265,15.594,0.627,15,0.279z M7.279,15H7H3H2c-0.552,0-1-0.449-1-1s0.448-1,1-1h1h4h0.279C7.106,13.296,7,13.635,7,14 S7.106,14.704,7.279,15z M12,6v5v2v1c0,0.551-0.449,1-1,1h-1H9c-0.552,0-1-0.449-1-1s0.448-1,1-1h1v-1H9H3V2c0-0.551,0.448-1,1-1 h8.279C12.106,1.296,12,1.635,12,2v1v1V6z M13,3V2c0-0.551,0.449-1,1-1s1,0.449,1,1v1H13z"></path></svg>'),this.getChildView("editor").ejRTE.executeCommand("inserthtml","<span data-oknd='4' data-oid='"+t.rid+"' title='"+t.title+"'>"+i+"</span>")}else this.model.set({requestParameters:{}})},this)},toolsButtonShowRequests:function(){this.getRegion("reqArea").$el.toggle()},onSave:function(){this.model.get("requestParameters")&&this.model.get("requestParameters").rid&&($.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.headers.key,{RID:this.model.get("requestParameters").rid})),this.model.save({contentHtml:this.getChildView("editor").ejRTE.getHtml()})},onReset:function(){this.getRegion("reqArea").collection&&this.getRegion("reqArea").collection.fetch({reset:!0}),this.model.set({requestParameters:{}})}})}),define("settings.reqparams",["i18n!nls/resources.min","global.request.param"],function(e,t){var i=Mn.CollectionView.extend({className:"list",childView:t,childViewOptions:function(){return{rid:this.options.rid,dbase:this.options.dbase}}});return Mn.View.extend({template:_.template('<span class="request-title"><%- Resources.settingsView_reqparams_requestTitle %></span><span class="request-data"><%- reqTitle %></span><br>\n            <span class="request-title"><%- Resources.settingsView_reqparams_dbTitle %></span><span class="request-data"><%- dbTitle %></span><br>\n            <span class="g-form--input">\n                <input class="g-form--checkbox" type="checkbox" name="useDefParams" id="<%- prefix %>_useDefParams" />\n                <label for="<%- prefix %>_useDefParams"><%- Resources.default %></label>\n            </span>\n            <div class="list"></div>'),id:"request-params-container",templateContext:function(){return{Resources:e,prefix:this.model.id,reqTitle:this.model.get("requestParameters").requestTitle,dbTitle:this.model.get("requestParameters").dbTitle}},regions:{area:{el:".list",replaceElement:!0}},ui:{use:"input[name=useDefParams]"},events:{"change @ui.use":function(e){this.ui.use.is(":checked")?this.getChildView("area").$el.hide():this.getChildView("area").$el.show()}},onRender:function(){this.showChildView("area",new i({collection:new Backbone.Collection(this.model.get("requestParameters").parameters),rid:this.model.get("requestParameters").rid,dbase:this.model.get("requestParameters").dbase,use:this.model.get("requestParameters").useDefParams}));var e=this.model.get("requestParameters").useDefParams;this.ui.use.prop("checked",e),e&&this.getChildView("area").$el.hide()},onSave:function(){var e=this.model.get("requestParameters"),t=[];this.getChildView("area").children.each(function(e){t.push(e.model.toJSON())});t.filter(function(e){return!e.Value.length||!$.trim(e.Value[0])});e.parameters=t,e.useDefParams=this.ui.use.is(":checked"),this.model.set({requestParameters:e}),$.ajax({url:this.model.url(),method:"PUT",data:JSON.stringify(this.model.toJSON()),contentType:"application/json; charset=utf-8"}).always(function(){this.model.trigger("sync")}.bind(this))}})}),define("settingsView",["i18n!nls/resources.min","settings.legendMap","settings.reportingView","settings.baseOptions","settings.visualization.chart","settings.decorationWidget","settings.reqparams","settings.chain","settings.htmlEditor","settings.subscribe","settings.visualization.cloud","settings.visualization.table","settings.visualization.semnet","global.view.dialog"],function(e,t,i,n,a,o,s,r,l,c,d,h,u,g){return Mn.View.extend({className:"settings",template:_.template("<div></div>"),events:{mousedown:function(e){e.stopPropagation()}},regions:{dialog:{el:"div",replaceElement:!0}},initialize:function(){},onRender:function(){this.showChildView("dialog",new g({autoOpen:!1,header:{manage:[{id:"close"}]},footer:new Backbone.Collection([{id:"onSave",title:e.apply,className:"blue right"},{id:"onReset",title:e.reset,className:"right nest-left"}])}))},modelEvents:{invalid:function(t,i){this.getChildView("dialog").getChildView("notify").showNotify(e.error),_.each(i,function(e){this.currentView.$("[name="+e.name+"]").addClass("error")},this),setTimeout(function(){this.currentView.$(".error").removeClass("error")}.bind(this),3e3)}},childViewEvents:{"dialog:closed":function(){this.getRegion("dialog").hasView()&&this.getChildView("dialog").model.has("content")&&this.getChildView("dialog").model.get("content").$("input.Decoration").each(function(e,t){$(t).ejColorPicker("hide")})}},getMenu:function(){var g=this.model.get("typeName"),p=[],f=this.options.subscibeCollection;this.menu={baseOptions:{id:"baseOptions",title:e.m1,icon:"gear",content:n},visualizationTable:{id:"visualizationTable",title:e.m2,icon:"eye",content:h},visualizationChart:{id:"visualizationChart",title:e.m2,icon:"eye",content:a},visualizationCloud:{id:"visualizationCloud",title:e.m2,icon:"eye",content:d},visualizationLegendMap:{id:"visualizationLegendMap",title:e.m7,icon:"legend",content:t},visualizationSemnet:{id:"visualizationSemnet",title:e.m2,icon:"eye",content:u},requestParams:{id:"requestParams",title:e.m12,icon:"script-settings",content:s},chainDependencies:{id:"chainDependencies",title:e.m13,icon:"anchor",content:r},decoration:{id:"decoration",title:e.m3,icon:"appearance",content:o},htmlEditor:{id:"htmlEditor",title:e.m6,icon:"pen",content:l,toolbar:[{id:"toolsButtonShowRequests",title:e.selectRequest,className:"script-create"}]},subscribe:{id:"subscribe",title:e.m4,icon:"new-mail",content:c,args:{model:this.model,collection:f}},reportingSettings:{id:"reportingSettings",title:e.m10,icon:"reports",content:i,args:{wid:this.model.id,publishers:f}},clearWidget:{id:"clearWidget",title:e.del,icon:"trash"}};var m=this.menu;switch(g){case"WidgetTable":p=[m.baseOptions,m.visualizationTable,m.requestParams,m.chainDependencies,m.decoration,m.clearWidget];break;case"WidgetRunning":p=[m.baseOptions,m.requestParams,m.chainDependencies,m.decoration,m.clearWidget];break;case"WidgetGraph":p=[m.baseOptions,m.visualizationChart,m.requestParams,m.chainDependencies,m.decoration,m.clearWidget];break;case"WidgetCloud":p=[m.baseOptions,m.visualizationCloud,m.requestParams,m.chainDependencies,m.decoration,m.clearWidget];break;case"WidgetMap":p=[m.baseOptions,m.visualizationLegendMap,m.requestParams,m.chainDependencies,m.decoration,m.clearWidget];break;case"WidgetHtml":p=[m.baseOptions,m.htmlEditor,m.requestParams,m.chainDependencies,m.decoration,m.clearWidget];break;case"WidgetSource":p=[m.baseOptions,m.subscribe,m.decoration,m.clearWidget];break;case"WidgetReporting":p=[m.baseOptions,m.reportingSettings,m.subscribe,m.decoration,m.clearWidget];break;case"WidgetSemNet":p=[m.baseOptions,m.visualizationSemnet,m.subscribe,m.decoration,m.clearWidget]}return p},hide:function(e){this.getRegion("dialog")&&this.getRegion("dialog").hasView()&&this.getChildView("dialog").close()},_setDialog:function(e){var t=this.getChildView("dialog").model,i=this.menu[e],n=i.content;if(n){i.toolbar?t.get("toolbar").reset(i.toolbar):t.get("toolbar").reset();var a={model:this.model,collection:this.collection};i.args&&(a=i.args);var o=new n(a);return t.set({title:i.title,icon:i.icon,content:o}),o}return null},sideBarTrigger:function(e){var t=this._setDialog(e.id);if(t){t.model.get("requestParameters")&&t.model.get("requestParameters").rid&&($.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.headers.key,{RID:t.model.get("requestParameters").rid})),t.onBeforeShow&&t.onBeforeShow();var i=$("main"),n=this.getChildView("dialog").$el,a=i.height()/2-n.height()/2;n.css({top:a<90?100:a,left:i.width()/2-n.width()/2}),this.getChildView("dialog").$el.show(function(){t.onShow&&t.onShow()})}else this[e.id].call(this)},clearWidget:function(){Backbone.trigger("message:confirm",{title:e.askyousure,message:$.Format(e.deltext,e.widget,this.model.get("title")),fx:function(){this.model.destroy()},ctx:this})}})}),define("@widget.WidgetCloud",["i18n!nls/resources.min"],function(e){return Mn.View.extend({template:_.template("<div></div>"),templateContext:{Resources:e},regions:{graph:{el:"div",replaceElement:!0}},onAttach:function(){this.data=this.model.get("feed").variations[0].flow[0].points.map(function(e){return{text:e.text,weight:parseInt(e.y),html:{"data-oid":this.model.id+"_"+e.elId,dir:"auto"},handlers:{click:function(){var t=new Backbone.Model({object_id:e.elId});t.set(e),this.model.trigger("click:item",t)}.bind(this)}}},this),this.$el.height(this.$el.parent().height()),this.$el.jQCloud(this.data),this._apply()},onChildviewClickItem:function(e){this.model.trigger("click:item",e.model)},modelEvents:{"change:width":function(){this._fitSize()},"change:height":function(){this._fitSize()}},_apply:function(){var e=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"PaletteByChart"}),t=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"WidgetCloud.SubSettings"});if(t&&t.WidgetParamValue&&this.$el.css("font-size",t.WidgetParamValue.minFontSizeCloud+"px"),e){var i=e.WidgetParamValue,n=this.model.id+"_";setTimeout(function(){_.each(i,function(e){"none"!==e.color&&this.$("[data-oid="+n+e.object_id+"]").css("color",e.color)},this)}.bind(this),100)}},_fitSize:function(){this.st&&clearTimeout(this.st),this.st=setTimeout(function(){this.$el.css({width:this.$el.parent().width(),height:this.$el.parent().height()}),this.$el.empty().jQCloud(this.data),this._apply()}.bind(this),500)}})}),define("@widget.WidgetGraph",["i18n!nls/resources.min","ejChartView","d3:histogram","chartsRepository"],function(e,t,i,n){return Mn.View.extend({template:_.template('<div class="graph"></div>'),templateContext:{Resources:e},regions:{graph:{el:".graph",replaceElement:!0}},onAttach:function(){var e=this.model.get("Visualization")||"bar",a=e.split("_"),o=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"WidgetGraph.GhaphSubSettings"});if(o&&(o=o.WidgetParamValue,o.enableRTL?this.$el.closest(".anbr_list").removeAttr("dir"):this.$el.closest(".anbr_list").attr("dir","auto")),a.length&&"d3"===a[1])this.showChildView("graph",new i({items:this.model.get("feed"),model:this.model,chart:a[0]}));else if("tagCloud"!==a[0]){var s=_.findWhere(n,{type:e})||{type:e},r=this.model.get("feed").variations[0],l=new Backbone.Model(_.extend(s,r));l.set({height:this.$el.parent().height().toString(),width:this.$el.parent().width().toString()}),this.showChildView("graph",new t({model:l,subset:o,palette:_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"PaletteByChart"})}))}},modelEvents:{"change:width":function(){this._fitSize()},"change:height":function(){this._fitSize()}},childViewEvents:{"chart:selected":function(e){}},_fitSize:function(){var e=this.model.get("Visualization")||"bar",i=e.split("_");if(i.length&&"d3"===i[1]);else if("tagCloud"!==i[0]){var n=this.getChildView("graph").model,a=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"WidgetGraph.GhaphSubSettings"});a&&(a=a.WidgetParamValue),n.set({height:this.$el.parent().height().toString(),width:this.$el.parent().width().toString()}),this.showChildView("graph",new t({model:n,subset:a,palette:_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"PaletteByChart"})}))}}})}),define("@widget.WidgetHtml",[],function(){return Mn.View.extend({template:_.template('<div dir="auto"><%= contentHtml %></div>'),ui:{oid:"span[data-oid]"},onRender:function(){var e="";1===this.collection.length?e=this.collection.at(0).get("display_name"):(e="<table>",this.collection.each(function(t){e+="<tr>",_.each(t.attributes,function(t){_.isObject(t)||(e+='<td dir="auto">'+(t||"")+"</td>")},this),e+="</tr>"},this),e+="</table>"),this.ui.oid.html(e);var t=this.model.get("Decoration");this.$el.css({color:t.ContainerForeground}),this.$el.find("a").css({"background-color":t.LinkBackground,color:t.LinkForeground})}})}),define("@widget.WidgetMap",["global:maps:GeoMapGoogleView","widget:map:legendView"],function(e,t){return Mn.View.extend({template:_.template('<div class="legend"></div><div class="map"></div>'),regions:{legend:{el:".legend",replaceElement:!0},map:{el:".map",replaceElement:!0}},onRender:function(){this.showChildView("map",new e({model:this.model,collection:this.collection}));var i=this.model.get("Legend");i&&i.LegendIsVisible&&this.showChildView("legend",new t({model:new Backbone.Model(i)}))}})}),define("@widget.WidgetRunning",[],function(){return Mn.CollectionView.extend({className:"RunningText",childView:Mn.View.extend({tagName:"span",getTemplate:function(){return _.template(this.options.templ)},triggers:{click:"table:row:handler"}}),childViewOptions:function(){return{templ:this.templ}},initialize:function(){this.templ="";var e=this.model.get("ColumnCustomizations");e?_.chain(e).filter(function(e){return e.ColumnIsVisible}).sortBy(function(e){return e.SerialNum}).map(function(e){this.templ+="&nbsp;<%= "+e.ColumnSystemName.toLowerCase()+" %>&nbsp;"},this):_.chain(this.model.get("feed").head).filter(function(e){return e.isVisible}).map(function(e){this.templ+="&nbsp;<%= "+e.systemName+" %>&nbsp;"},this),this.templ+="&nbsp;&nbsp;***&nbsp;&nbsp;"},onAttach:function(){var e=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"WidgetRunDirection"}),t=e&&e.WidgetParamValue.Right?"right":"left";this.$el.liMarquee({direction:t})},childViewEvents:{"table:row:handler":function(e){this.model.trigger("click:item",e.model)}}})}),define("@widget.WidgetTable",["i18n!nls/resources.min","widgetTableCard","widgetTableGrid"],function(e,t,i){return Mn.View.extend({template:_.template("<div></div>"),regions:{wrap:{el:"div",replaceElement:!0}},onRender:function(){switch(this.model.get("Visualization")||"table"){case"table":this.showChildView("wrap",new i({model:this.model,collection:this.collection,editMode:this.options.editMode}));break;case"card":case"card2":this.showChildView("wrap",new t({model:this.model,collection:this.collection}))}},modelEvents:{"change:Visualization":function(){this.render()}},childViewTriggers:{"table:add:rubrics:filter":"table:add:rubrics:filter"}})}),define("@widget.WidgetView",["i18n!nls/resources.min","sendModel","settingsView","widget.reportView","widget.content.contentView","widget.semnet.semnetView","widget.table.filter"],function(e,t,i,n,a,o,s){var r=["WidgetTable","WidgetMap","WidgetGraph","WidgetRunning","WidgetHtml","WidgetCloud"],l=Backbone.Model.extend({idAttribute:"WidgetUid",defaults:{WidgetUid:null,PlacementWidth:0,PlacementHeight:0,PlacementTop:0,PlacementLeft:0,ZIndex:0},url:function(){return"/api/widget/"+this.id+"/position"}}),c=Mn.Object.extend({initialize:function(){this.collection=new Backbone.Collection,
this.collection.url="/api/widget/"+this.options.widgetID+"/subscribed"}});return Mn.View.extend({className:"anbr-widget",template:templates["widget-template"],ui:{head:".anbr_head",container:".widget-container",title:".widget-title",load:".anbr_list",loader:".anbr_head .Preloader",settings:".settings",trash:".icon-trash",filter:".font-icon-filter"},regions:{load:"@ui.load",settings:{el:"@ui.settings",replaceElement:!0},filter:{el:".filter-panel",replaceElement:!0}},events:{"click .font-icon-filter":function(){var e=this.getChildView("filter"),t=this.ui.container.height()-e.$el.height()+20;e.$el.is(":hidden")?this.ui.container.css({height:t}):this.ui.container.css({height:this.ui.load.height()+20}),e.$el.toggle()},"click .anbr_head @ui.trash":function(){Backbone.trigger("message:confirm",{title:e.sure,message:$.Format(e.deltext,e.widget,this.model.get("title")),fx:function(){this.model.destroy()},ctx:this})},mousedown:function(t){this.Mode&&(this._addSettings(),Backbone.Radio.channel("sidebar").request("open",{nameView:this.model.get("title"),view:this.getChildView("settings"),title:e.wst},this.getChildView("settings").getMenu()),t.shiftKey||t.ctrlKey?this.triggerMethod("select:more",this.model):this.triggerMethod("select:one",this.model))}},_addSettings:function(){this.getRegion("settings").hasView()||this.showChildView("settings",new i({model:this.model,collection:this.collection,subscibeCollection:this.subscibeObject.collection}))},initialize:function(){this.scrollTop=0,this.model.set("ReadOnly",!0),this.collection=new Backbone.Collection([],{model:Backbone.Model.extend({idAttribute:"object_id"})}),this.subscibeObject=new c({widgetID:this.model.id});var e=this.model.get("requestParameters");this.sendModel=new t({id:e.rid,pars:e.parameters}),this.sendModel.on("change:ts",function(e,t){t&&this.model.set("timeStampForUpdate",t)},this),this.position=new l({WidgetUid:this.model.id,PlacementTop:parseInt(this.model.get("top"))<0?5:parseInt(this.model.get("top")),PlacementLeft:parseInt(this.model.get("left"))<0?5:parseInt(this.model.get("left")),PlacementWidth:parseInt(this.model.get("width")),PlacementHeight:parseInt(this.model.get("height")),ZIndex:parseInt(this.model.get("zIndex"))}),this.listenTo(this.position,"request",this._sizeAndPosition.bind(this))},onBeforeRender:function(){this.model.get("Decoration")&&!this.model.get("Decoration").BorderIsVisible&&this.$el.addClass("noshadow"),this._sizeAndPosition()},onRender:function(){this._decoration(),"WidgetTable"!==this.model.get("typeName")?this.ui.filter.hide():this.showChildView("filter",new s({model:this.model}))},onAttach:function(){var e=this.model.get("Decoration").CaptionIsVisible;this.ui.container.css({height:this.model.get("height")-(e?this.ui.head.outerHeight():0)}),this.ui.load.css("height",this.ui.container.height()),this.triggerMethod("fix:size",this.model),this.ui.container.on("scroll",function(e){if(this.sendModel.get("feed")&&this.sendModel.get("feed").pagination){var t=this.sendModel.get("feed").pagination;if(!(e.target.scrollTop-this.scrollTop>0))return;if(this.stopScroll)return;this.scrollTop=e.target.scrollTop,t.totalItems>t.pageSize*t.currentPage-t.pageSize&&e.target.scrollTop>=e.target.scrollHeight-e.target.offsetHeight-100&&(this.stopScroll=!0,this.sendModel.set({ts:this.model.get("timeStampForUpdate"),page:++t.currentPage}),this.onLoad({add:!0}),console.log("scrolling table"))}}.bind(this))},modelEvents:{sync:function(){this.sendModel.set("ts",""),this._decoration(),this.onLoad()},"click:item":function(e){Backbone.Radio.channel("matrixChain").trigger("start:chain",this.model),this.model.collection.each(function(t){this.model.id!==t.id&&(t.trigger("check:subscribers",this.model.id,e.get("requestID")||this.model.get("requestParameters").rid,e.get("object_id")),this._startChain(t,e))},this)},"check:subscribers":function(e,t,i){var n=this.subscibeObject.collection;n.length?this._callSubscribers(e,i,t):-1!==r.indexOf(this.model.get("typeName"))||this.subscibeObject.isFetch||n.fetch({reset:!0,success:function(n){this.subscibeObject.isFetch=!0,this._callSubscribers(e,i,t)}.bind(this)})},"load:chain":function(){this._loadChain()},"visual:update":function(e){this._successLoad(e)},"change:ColumnCustomizations":function(){this._successLoad()},"change:Decoration":function(){this._decoration(),this.ui.container.css({height:this.model.get("height")-(this.model.get("Decoration").CaptionIsVisible?this.ui.head.outerHeight():0)}),this.ui.load.css("height",this.ui.container.height())},"change:title":function(e,t){this.ui.title.text(t)},"change:left":function(e,t){this.position.set("PlacementLeft",t),this._sizeAndPosition()},"change:top":function(e,t){this.position.set("PlacementTop",t),this._sizeAndPosition()},"change:width":function(e,t){this.position.set("PlacementWidth",t),this._sizeAndPosition()},"change:height":function(e,t){this.ui.container.css({height:t-this.ui.head.outerHeight()}),this.position.set("PlacementHeight",t),this._sizeAndPosition()},"change:zIndex":function(e,t){this.position.set("ZIndex",t),this._sizeAndPosition()}},onLoad:function(e){this.loadOptions=e||{};var t=this.model.get("typeName"),i=this.model.get("requestParameters");return new Promise(function(e,s){if(i&&i.rid)i.useDefParams||(this.loadOptions.notUseDefParams=!0),this.sendModel.set({widget:{uid:this.model.id,name:this.model.get("title"),type:this.model.get("typeName"),Visualization:this.model.get("Visualization")},id:i.rid,pars:i.parameters,useDefParams:!this.loadOptions.notUseDefParams}),this.ui.loader.show(),this.sendModel.fetch({success:function(){this._successLoad(),e()}.bind(this),error:function(){this._endload.bind(this),e()}.bind(this)}),this.model.get("update")&&setInterval(function(){this.ui.loader.show(),this.sendModel.fetch({success:function(){this._successLoad(),e()}.bind(this),error:function(){this._endload.bind(this),e()}.bind(this)})}.bind(this),this.model.get("timeUpdate"));else{if("WidgetHtml"===t&&this.ui.load.html(this.model.get("contentHtml")),this.objectID&&this.requestID)switch(this.model.get("typeName")){case"WidgetSource":this.showChildView("load",new a({model:this.model,requestID:this.requestID,objectID:this.objectID}));break;case"WidgetSemNet":this.showChildView("load",new o({objectID:this.objectID,RID:this.requestID,container:this.ui.container,widget:this.model}));break;case"WidgetReporting":Backbone.Radio.channel("loader").trigger("show",this.ui.load,{speed:"fast"}),$.get("/api/widget/listen/"+this.requestID+"/reporting/"+this.model.id+"/"+this.objectID).done(function(e){this.showChildView("load",new n({url:e,model:this.model}))}.bind(this)).always(function(){Backbone.Radio.channel("loader").trigger("hide"),this.ui.loader.hide(),this.loadSourceProc=!1}.bind(this));break;case"WidgetHtml":Backbone.Radio.channel("loader").trigger("show",this.ui.load,{speed:"fast"}),$.get("/api/widget/listen/"+this.requestID+"/uiwidget/"+this.model.id+"/"+this.objectID).done(function(e){e&&(this.model.set("contentHtml",e),this.ui.load.html(this.model.get("contentHtml")))}.bind(this)).always(function(){Backbone.Radio.channel("loader").trigger("hide"),this.ui.loader.hide(),this.loadSourceProc=!1}.bind(this))}this._endload(),e()}}.bind(this))},_startChain:function(e,t){_.each(e.get("publishersSubscriberMap"),function(i,n){n===this.model.id&&_.each(i,function(i){if(i.QueryID===this.model.get("requestParameters").rid){var n=_.findWhere(e.get("requestParameters").parameters,{id:i.QueryParamID});_.each(t.attributes,function(e,t){t.toLowerCase()===i.ColumnSystemName.toLowerCase()&&(n.Value=[e])}),e.trigger("load:chain")}},this)},this)},_loadChain:function(){this.sendModel.set("ts",""),Backbone.Radio.channel("matrixChain").request("check:chain",this.model)&&this.onLoad({notUseDefParams:!0}).then(function(){if(Backbone.Radio.channel("matrixChain").trigger("add:chain",this.model),this.collection.length){var e=this.collection.at(0);this.model.collection.each(function(t){this.model.id!==t.id&&(this._startChain(t,e),setTimeout(function(){return e.trigger("set:current",!0)},1))},this)}}.bind(this)),this.model.get("timeStampForUpdate")&&this.sendModel.set("ts",this.model.get("timeStampForUpdate"))},_callSubscribers:function(e,t,i){this.subscibeObject.collection.each(function(n){n.id===e&&this._loadSource(t,i)},this)},_loadSource:function(e,t){this.objectID=parseInt(e),this.requestID=parseInt(t),this.loadSourceProc||(this.ui.loader.show(),this.loadSourceProc=!0,this.onLoad())},_successLoad:function(e){this.sendModel.get("msg")&&Backbone.trigger("message:warning",{message:this.sendModel.get("msg")}),this.model.set("feed",this.sendModel.get("feed")||this.sendModel.get("data"));var t=this.model.get("typeName");this.loadOptions.add?this._endload():require(["@widget."+t],function(e){this.showChildView("load",new e({model:this.model,collection:this.collection,load:this.loadOptions,editMode:this.Mode})),this._endload()}.bind(this));var i=this.model.get("feed")?this.model.get("feed").items?$.prepare(this.model.get("feed").items):this.model.get("feed").variations[0].flow:[];this.loadOptions.add?this.collection.add(i):this.collection.reset(i),this.stopScroll=!1},_endload:function(){this.ui.loader.hide(),"WidgetTable"===this.model.get("typeName")&&this.ui.filter.show(),this.loadSourceProc=!1,this.trigger("load:end"),this.model.has("feed")||this.model.set("feed",{});var e=this.model.get("Decoration"),t=this.model.get("isMarkSelectedItem");this.$("table.widget-table td").css({color:e.ContainerForeground,"background-color":e.ContainerBackground}),this.$(".rubrics").css("opacity","0.5"),this.$("table.widget-table tr").hover(function(){$(this).find("td").css({color:e.ContainerForegroundHover,"background-color":e.ContainerBackgroundHover})},function(){var i=$(this).hasClass("viewed"),n=$(this).hasClass("current");$(this).find("td").css({color:n?e.ContainerForegroundActive:t&&i?e.ContainerForegroundVisited:e.ContainerForeground,"background-color":n?e.ContainerBackgroundActive:t&&i?e.ContainerBackgroundVisited:e.ContainerBackground})}),this.$el.find("a").css({"background-color":e.LinkBackground,color:e.LinkForeground})},_sizeAndPosition:function(){this.$el.css({width:this.position.get("PlacementWidth"),height:this.position.get("PlacementHeight"),top:this.position.get("PlacementTop"),left:this.position.get("PlacementLeft"),"z-index":this.position.get("ZIndex")})},_decoration:function(){var e=this.model.get("Decoration"),t="",i="padding:10px 10px 0;font-size: 18px;",n="font-size:1em;cursor:default;text-decoration:none;",a="font-size:13px;overflow:auto;clear:both;"+("WidgetTable"!==this.model.get("typeName")?"padding:20px;":"");e&&(e.CaptionIsVisible?(e.CaptionBackground&&(i+="background:"+e.CaptionBackground+";"),e.BorderIsVisible&&(i+="border:solid 1px "+e.CaptionBackground+";border-bottom:0;"),e.CaptionForeground&&(n+="color:"+e.CaptionForeground+";")):i+="display:none;",e.ContainerIsTransparent?this.$el.addClass("transparent"):e.ContainerBackground&&(this.$el.removeClass("transparent"),t="background:"+e.ContainerBackground+";"),e.ContainerForeground&&(a+="color:"+e.ContainerForeground+";"),e.BorderIsVisible?a+="border:solid 10px "+e.CaptionBackground+";":i+="padding-bottom:10px;"),this.ui.head.attr("style",i),this.ui.container.attr("style",a+t),this.ui.title.attr("style",n),this.ui.trash.css("fill",this.model.get("Decoration").CaptionForeground),this.ui.filter.css("color",this.model.get("Decoration").CaptionForeground)},switchMode:function(e){return e?(this.ui.head.css({cursor:"move"}),this.$el.draggable({handle:this.ui.head,cancel:this.ui.settings,drag:function(e,t){this.triggerMethod("widget:drag",this.model,t.position.left-this.$el.position().left,t.position.top-this.$el.position().top)}.bind(this),stop:function(e,t){var i=parseInt(t.position.top),n=parseInt(t.position.left);i<0&&(i=3),n<0&&(n=3),this.model.set({top:i,left:n}),this.position.save(),this.triggerMethod("widget:drag",this.model,n-this.$el.position().left,i-this.$el.position().top,!0)}.bind(this)}),this.$el.resizable({resize:function(e,t){this.ui.container.css({height:t.size.height-this.ui.head.outerHeight()})}.bind(this),stop:function(e,t){this.ui.load.css("height",this.ui.container.height()),this.model.set({width:parseInt(t.size.width),height:parseInt(t.size.height)}),this.position.save(),this.triggerMethod("select:one",this.model)}.bind(this)})):(this.ui.head.css({cursor:"default"}),this.$el.draggable().draggable("destroy").resizable().resizable("destroy").removeClass("widget-editing")),this.Mode=e,this.model.set("ReadOnly",!e),this},childViewEvents:{"content:loaded":function(){this._endload()},"subscribers:reflect":function(e){this.model.trigger("click:item",e)},"table:add:rubrics:filter":function(e){this.getChildView("filter").collection.add(e),e.length?this.getChildView("filter").showRubrics():this.getChildView("filter").hideRubrics()},"filter:search":function(e){this.$("tbody>tr>td .Mark").removeClass("Mark");var t=new RegExp(e,"ig");this.$("tbody>tr").each(function(i,n){var a=$(n).find("td:first"),o=a.html(),s=o.search(t);if(-1===s)$(n).hide();else{var r='<i class="Mark">'+o.match(t)[0]+"</i>",l=o.substring(0,s),c=o.substring(s+e.length),d=l+r+c;a.html(d),$(n).show()}})},"filter:apply":function(e){this.getChildView("load").getChildView("wrap").getChildView("table").getChildView("body").children.each(function(e){e.$el.show();var t=_.groupBy(e.model.get("links"),"rel"),i=t.rubric_id;i&&_.each(i,function(t){this.getChildView("filter").collection.get(t.id).get("hide")&&e.$el.hide()},this)},this),this.$("tbody>tr>td .Mark").removeClass("Mark")}},childViewTriggers:{"table:row:handler":"table:row:handler"}})}),define("settings.baseOptions",["i18n!nls/resources.min","global.request.param"],function(e,t){return Mn.CollectionView.extend({childView:Mn.View.extend({template:"#base-setting-template",regions:{params:{el:"#params",replaceElement:!0}},onBeforeRender:function(){this.model.has("type")||this.model.set("type","")},onRender:function(){}}),initialize:function(){if(this.collection=new Backbone.Collection([{displayName:e.title,name:"title",value:this.model.get("title"),type:"text"},{displayName:e.updatingContent,name:"update",value:this.model.get("update"),type:"checkbox"},{displayName:e.timeoutUpdate,name:"timeUpdate",value:this.model.get("timeUpdate"),type:"text"}]),"WidgetSource"===this.model.get("typeName")){var t=Backbone.Radio.channel("chW").request("get:param:model",this.model.get("Characteristics"),"WidgetSource.Options");t.has("WidgetParamValue")||t.set("WidgetParamValue",{hideRubrics:!1}),this.collection.add([{displayName:e.hideRubrics,name:"hideRubrics",value:!!t.get("WidgetParamValue").hideRubrics,type:"checkbox"},{displayName:e["contain-html"],name:"isHtmlContent",value:!!this.model.get("isHtmlContent"),type:"checkbox"},{displayName:e.highlightMentionObj,name:"highlightMentionObj",value:!!this.model.get("highlightMentionObj"),type:"checkbox"},{displayName:e.contentProp,type:"select",name:"contentProp",value:[{value:"",title:"..."},{value:"TextSource",title:"TextSource",checked:"TextSource"===this.model.get("contentProp")},{value:"WebFile",title:"WebFile",checked:"WebFile"===this.model.get("contentProp")}]},{displayName:e.emc,name:"extractOnlyMedia",value:!!this.model.get("extractOnlyMedia"),type:"checkbox"}])}if("WidgetTable"===this.model.get("typeName")&&this.collection.add([{displayName:e.markAfSel,name:"isMarkSelectedItem",value:!!this.model.get("isMarkSelectedItem"),type:"checkbox"}]),"WidgetRunning"===this.model.get("typeName")||"WidgetHtml"===this.model.get("typeName")){var i=Backbone.Radio.channel("chW").request("get:param:model",this.model.get("Characteristics"),"WidgetRunDirection");i.has("WidgetParamValue")||i.set("WidgetParamValue",{Right:!1}),this.collection.add([{displayName:e.dire+" ( "+e.toright+" )",name:"WidgetRunDirection",value:!!i.get("WidgetParamValue").Right,type:"checkbox"}])}if("WidgetSemNet"===this.model.get("typeName")){var n=Backbone.Radio.channel("chW").request("get:param:model",this.model.get("Characteristics"),"WidgetSource.Options").WidgetParamValue||{DisplayValue:"",Value:[]};this.collection.add([{displayName:e.bsno,name:"MainEntity",value:n}])}},childViewOptions:function(e){e.set("prefix",this.model.id)},onSave:function(){var e=$.GetData(this.$el),t=Backbone.Radio.channel("chW").request("get:param:model",this.model.get("Characteristics"),"WidgetSource.Options");t.set("WidgetParamValue",{hideRubrics:e.hideRubrics});var i=Backbone.Radio.channel("chW").request("get:param:model",this.model.get("Characteristics"),"WidgetRunDirection");i.set("WidgetParamValue",{Right:e.WidgetRunDirection});var n=Backbone.Radio.channel("chW").request("get:params:collection",this.model.id);n.add([t,i]),n.fetch({success:function(t){e.Characteristics=t.toJSON(),this.model.save(e)}.bind(this)})}})}),define("settings.decorationWidget",["i18n!nls/resources.min"],function(e){function t(e){return e&&(e=e.replace("rgba(","").replace(")","").split(",")),e&&4===e.length?{hex:"#"+("0"+parseInt(e[0],10).toString(16)).slice(-2)+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2),a:100*parseFloat(e[3]).toFixed(2)}:{hex:"#ffffff",a:100}}var i=Mn.View.extend({className:"pattern",template:"#maket-template",onRender:function(){this.model.get("BorderIsVisible")?this.$el.css("background-color",this.model.get("CaptionBackground")):this.$el.css("background-color","transparent"),this.model.get("ContainerIsTransparent")&&this.$el.css("background-color","transparent")}}),n=Mn.View.extend({className:"decoration",template:"#decoration-settings-template",templateContext:{Resources:e},regions:{maket:{el:"#maket",replaceElement:!0}},events:{'click input[type="checkbox"]':function(e){var t=$(e.target);this.model.set(t.attr("name"),t.prop("checked"))}},onRender:function(){this.showChildView("maket",new i({model:this.model}))},onAttach:function(){this.$("input.Decoration").each(function(i,n){var a=t(this.model.get(n.getAttribute("name")));$(n).ejColorPicker({locale:e.Lang,modelType:"palette",presetType:"webcolors",htmlAttributes:{style:"display:inline-block;"},value:a.hex,opacityValue:a.a,close:function(e){var t=$(n).data("ejColorPicker").rgb;this.model.set($(n).attr("name"),"rgba("+t.r+","+t.g+","+t.b+","+t.a+")")}.bind(this)})}.bind(this))},modelEvents:{change:function(e){this.getChildView("maket").render()}}});return Mn.View.extend({template:_.template("<div></div>"),regions:{c:{el:"div",replaceElement:!0}},onRender:function(){var e=this.model.get("Decoration");e.prefix=this.model.id||(new Date).valueOf();var t=new Backbone.Model(e);this.showChildView("c",new n({model:t})),this.listenTo(t,"change",function(){this.model.set("Decoration",t.toJSON())})},onSave:function(){this.model.save()}})}),define("settings.chain",["i18n!nls/resources.min"],function(e){var t=Backbone.Collection.extend({model:Backbone.Model.extend({idAttribute:"QueryParamsMapID",defaults:{QueryParamsMapID:null,QueryParamID:0,QueryID:0,ColumnSystemName:""}})}),i=Mn.CollectionView.extend({tagName:"ul",childView:Mn.View.extend({tagName:"li",template:_.template('<input type="radio" id="id<%- id %>" class="g-form--radio" name="widgets" value="<%- id %>"><label for="id<%- id %>"><%- title %></label>'),triggers:{"click input":{event:"widget:select",stopPropagation:!1,preventDefault:!1}}}),childViewTriggers:{"widget:select":"widget:select"}}),n=Mn.CollectionView.extend({tagName:"select",childView:Mn.View.extend({tagName:"option",getTemplate:function(){return this.model.has("displayName")?_.template("<%- displayName %> (<%- systemName %>)"):_.template("<%- Caption %> (<%- Name %>)")},onRender:function(){this.model.has("systemName")?this.$el.attr("value",this.model.get("systemName")):this.$el.attr("value",this.model.id)}})}),a=Mn.CollectionView.extend({tagName:"ul",className:"list-area",childView:Mn.View.extend({tagName:"li",className:"item",template:_.template('<%- Title %>&nbsp;<span data-icon="icon-trash"></span>'),triggers:{'click span[data-icon="icon-trash"]':"rel:remove"}}),childViewTriggers:{"rel:remove":"rel:remove"}});return Mn.View.extend({template:"#relations-settings-template",templateContext:{Resources:e},events:{'click span[data-icon="icon-anchor"]':function(){var t=this.selectWidget.get("title"),i=this.getChildView("params"),n=this.getChildView("select"),a=new this.collection.model({Title:t+" : "+n.$(":checked").text()+" - "+i.$(":checked").text(),wID:this.selectWidget.id,QueryParamID:i.$(":checked").val(),QueryID:this.selectWidget.get("requestParameters").rid,ColumnSystemName:n.$(":checked").val()});a.collection=this.collection,a.save({},{success:function(e){this.collection.add(e);var t=this.model.get("publishersSubscriberMap")||{};t[e.get("wID")]||(t[e.get("wID")]=[]),t[e.get("wID")].push(e.toJSON()),this.model.set("publishersSubscriberMap",t)}.bind(this),error:function(){this.triggerMethod("show:message",e.error)}.bind(this)})}},regions:{list:{el:"#widgets",replaceElement:!0},params:{el:"#params",replaceElement:!0},select:{el:"#select-param",replaceElement:!0},result:{el:"#result",replaceElement:!0}},initialize:function(){this.collection=new t},onRender:function(){this.showChildView("list",new i({collection:new Backbone.Collection})),this.showChildView("select",new n({collection:new Backbone.Collection})),this.showChildView("result",new a({collection:this.collection})),this.showChildView("params",new n({collection:this.model.get("requestParameters")&&this.model.get("requestParameters").parameters?new Backbone.Collection(this.model.get("requestParameters").parameters):new Backbone.Collection}))},onBeforeShow:function(){if(this.model.get("requestParameters")&&this.model.get("requestParameters").rid){if(this.hasRegion("notify")){var t=this.getRegions();_.each(t,function(e,t){e.$el.show()}),this.$("table").show(),this.removeRegion("notify")}this.getChildView("params").collection.length||this.getChildView("params").collection.reset(this.model.get("requestParameters").parameters);var i=this.model.id,n=this.model.collection?this.model.collection.filter(function(e){if(e.get("feed")&&i!==e.id)return e}):[];this.getChildView("list").collection.reset(n);var a=this.model.get("publishersSubscriberMap"),o=(this.getChildView("list").collection,this.getChildView("params").collection);this.getChildView("select").collection;_.each(a,function(e,t){var i=this.model.collection.get(t);if(i){var n=i.get("title"),a=i.has("feed")?i.get("feed").head?i.get("feed").head:[{systemName:"argId",displayName:"argId"},{systemName:"fnId",displayName:"fnId"}]:[];_.each(e,function(e){var i=o.get(e.QueryParamID),s=_.findWhere(a,{systemName:e.ColumnSystemName}),r=i.get("Caption")+" ( "+i.get("Name")+" )",l=s?s.displayName+" ( "+s.systemName+" )":"";e.Title=n+" : "+l+" - "+r,e.wID=t;var c=new this.collection.model(e);c.url="/api/widget/"+this.model.id+"/qparammaps/"+t+"/"+e.QueryParamsMapID,this.collection.add(c)},this)}},this)}else{t=this.getRegions(),_.each(t,function(e,t){e.$el.hide()}),this.$("table").hide(),this.addRegion("notify",".notify");var s=Mn.View.extend({template:_.template(e.rsw3)});this.showChildView("notify",new s)}},collectionEvents:{update:function(e,t){if(t.changes.removed.length){var i=t.changes.removed[0],n=this.model.get("publishersSubscriberMap"),a=n[i.get("wID")].filter(function(e){return e.QueryParamsMapID!==i.get("QueryParamsMapID")});n[i.get("wID")]=a,this.model.set("publishersSubscriberMap",n)}},request:function(){},reset:function(){this.getChildView("result").collection.reset(this.collection.models)}},childViewEvents:{"rel:remove":function(t){this.triggerMethod("show:message:confirm",{text:e.sure,fx:function(){t.model.destroy()}})},"widget:select":function(e){this.selectWidget=e.model;var t=this.selectWidget.get("feed").head||[{systemName:"argId",displayName:"argId"},{systemName:"fnId",displayName:"fnId"}];t?(this.getChildView("select").collection.reset(t),this.collection.url="/api/widget/"+this.model.id+"/qparammaps/"+this.selectWidget.id):this.getChildView("select").collection.reset()}}})}),define("settings.legendMap",["i18n!nls/resources.min","global.behaviors.input"],function(e,t){var i=Backbone.Model.extend({idAttribute:"LegendItemUID",defaults:{LegendItemUID:null,MarkerColor:"",MarkerDescription:"",MarkerUrl:""}}),n=Backbone.Model.extend({defaults:{id:null,Title:"",LegendIsVisible:!1,LegendPosition:"",WidgetsLegendItems:[]}}),a=Mn.CollectionView.extend({tagName:"table",className:"items-legend-settings",childView:Mn.View.extend({tagName:"tr",template:"#legend-item-template",templateContext:{Resources:e},ui:{name:"input[name=MarkerDescription]"},events:{"blur @ui.name":function(){$.trim(this.ui.name.val())&&this.model.set("MarkerDescription",this.ui.name.val())},'click button[data-icon="icon-trash"]':function(){Backbone.trigger("message:confirm",{title:e.askyousure,fx:function(){this.model.destroy()},ctx:this})}}}),collectionEvents:{update:function(e,t){t.changes.removed.length&&this.triggerMethod("reset:default",t.changes.removed[0])}}}),o=Mn.View.extend({behaviors:{input:t},template:"#legend-settings-template",templateContext:{Resources:e},ui:{title:"input[name=Title]",position:".RbtnSet input",show:"input[name=LegendIsVisible]"},events:{"blur @ui.title":function(){this.model.set("Title",this.ui.title.val())},"click @ui.position":function(){this.model.set("LegendPosition",this.ui.position.filter(":checked").val())},"click @ui.show":function(){this.model.set("LegendIsVisible",this.ui.show.prop("checked"))}},modelEvents:{invalid:function(){this.ui.title.addClass("Alarm")}},onRender:function(){this.ui.position.filter('[value="'+this.model.get("LegendPosition")+'"]').prop("checked",!0)}});return Mn.View.extend({template:_.template('<div id="main"></div><div id="list"></div>'),regions:{main:{el:"#main",replaceElement:!0},list:{el:"#list",replaceElement:!0}},onRender:function(){var e=new n(this.model.get("Legend"));e.set("id",this.model.id),e.url="/api/widget/"+this.model.id+"/legend",this.showChildView("main",new o({model:e}));var t=new Backbone.Collection(this.model.get("WidgetsLegendItems"),{model:i});t.url="/api/widget/"+this.model.id+"/legenditem",this.showChildView("list",new a({collection:t}))},collectionEvents:{reset:function(){this.model.get("Legend")&&this.model.get("Legend").WidgetsLegendItems.length?this.getChildView("list").collection.reset(this.model.get("Legend").WidgetsLegendItems):this.setDefaultList()}},onChildviewResetDefault:function(e){this.getChildView("list").collection.add(new i({MarkerUrl:e.get("MarkerUrl")}))},onSave:function(){$.ajax({method:"POST",contentType:"application/json; charset=utf-8",url:"/api/widget/"+this.model.id+"/legenditems",data:JSON.stringify(this.getChildView("list").collection.toJSON())}).done(function(e){this.getChildView("main").model.save({WidgetsLegendItems:this.getChildView("list").collection.toJSON()}),this.model.save({Legend:this.getChildView("main").model.toJSON()})}.bind(this))},onReset:function(){this.getChildView("list").collection.reset(),this.setDefaultList()},setDefaultList:function(){var e=this.collection.groupBy("markerurl");_.each(e,function(e,t){"undefined"!==t&&this.getChildView("list").collection.add(new i({MarkerUrl:t}))},this)}})}),define("settings.reportingView",["i18n!nls/resources.min","g/tree"],function(e,t){var i=Backbone.Model.extend({idAttribute:"UID",defaults:{UID:null,ReportSysName:"",TypeSysName:""}}),n=Mn.CollectionView.extend({className:"list-report",tagName:"section",childView:Mn.View.extend({className:"item",template:"#item-report-template",templateContext:{Resources:e},triggers:{"click .font-icon-delete":"report:clear"}}),childViewTriggers:{"report:clear":"report:clear"}}),a=Mn.View.extend({tagName:"option",template:_.template("<%- title %>"),onRender:function(){this.$el.attr("value",this.model.id)}}),o=Mn.CollectionView.extend({tagName:"select",childView:a,onRender:function(){this.addChildView(new a({model:new Backbone.Model({id:"0",title:"..."})}),0),this.$el.val("0")},triggers:{change:"change:publish"}});return Mn.View.extend({className:"type-reporting anbr-tabs",template:"#type-reporting-settings",templateContext:{Resources:e},events:{"click nav>span":function(e){this.activeTab($(e.target).closest("span[data-name]").attr("data-name"))}},onChildviewChangePublish:function(e){var i=e.$el.val();if("0"!==i)if("publishers"===e.options.name){this.getChildView("rep").collection.reset();var n=e.collection.get(i);if(n.has("requestParameters")){var a=n.get("requestParameters").rid;this.$(".load-tree").show();var o=new Backbone.Collection;o.url="/api/Tree/ByWidgetQ/"+a,this.showChildView("tree",new t({collection:o,node:{checkbox:!1}})),o.fetch({reset:!0}),this.listenTo(this.getChildView("tree"),"container:select:item",function(e){this.model.set("TypeSysName",e.model.get("sysName")),$.get("/api/Reporting/ByWidgetQ/"+a+"/"+e.model.id).done(function(e){this.getChildView("rep").collection.reset(_.map(e,function(e){return{id:e.ReportSysName,title:e.ReportDescription}}))}.bind(this))})}else this.getRegion("tree").empty()}else"reports"===e.options.name&&this.model.set("ReportSysName",i);else this.getRegion("tree").empty()},childViewEvents:{},onChildviewReportClear:function(t){this.triggerMethod("show:message:confirm",{text:e.sure,fx:function(){t.model.destroy()},ctx:this})},activeTab:function(e){this.$("nav>span").removeClass("active"),this.$("nav>span[data-name='"+e+"']").addClass("active"),this.$("section").hide(),this.$("."+e).show()},regions:{list:{el:".list-report",replaceElement:!0},publ:{el:".list-publishers",replaceElement:!0},rep:{el:".type-rep",replaceElement:!0},tree:{el:".load-tree",replaceElement:!0}},onRender:function(){this.showChildView("publ",new o({collection:new Backbone.Collection,name:"publishers"})),this.showChildView("rep",new o({collection:new Backbone.Collection,name:"reports"}));var e=new Backbone.Collection;e.model=i,e.url="/api/widget/"+this.options.wid+"/reportitems",this.model=new i,this.model.collection=e,this.showChildView("list",new n({collection:e})),this.activeTab("list-report")},onBeforeShow:function(){this.options.publishers.length?(this.$(".notice").empty(),this.getChildView("publ").collection.reset(this.options.publishers.models),this.getChildView("list").collection.fetch({reset:!0})):this.options.publishers.fetch({reset:!0,success:function(t){t.length?(this.$(".notice").empty(),this.getChildView("publ").collection.reset(this.options.publishers.models),this.getChildView("list").collection.fetch({reset:!0})):this.$(".notice").html(e.subscrNote)}.bind(this)})},onSave:function(){this.model.save({},{success:function(e){this.getChildView("list").collection.add(e)}.bind(this)})}})}),define("settings.subscribeList",["i18n!nls/resources.min"],function(e){var t=["WidgetTable","WidgetMap","WidgetGraph","WidgetRunning","WidgetHtml","WidgetCloud","WidgetSemNet"];return Mn.CollectionView.extend({className:"list-area",emptyView:Mn.View.extend({template:_.template('<i style="color:red;font-style:italic;"><%- Resources.subsnotfound %></i>'),templateContext:{Resources:e}}),childView:Mn.View.extend({className:"item",template:_.template("<input type='checkbox' class='g-form--checkbox' id='<%- id %>' name='<%- id %>' /><label for='<%- id %>'><%= title %>&nbsp;(<%= typeName %>)</label>"),triggers:{click:"click:item"},onBeforeRender:function(){-1===t.indexOf(this.model.get("typeName"))&&this.$el.hide()}}),isEmpty:function(){return!this.collection||!this.collection.filter(function(e){return-1!==t.indexOf(e.get("typeName"))}).length},childViewTriggers:{"click:item":"click:item:subscribe"}})}),define("settings.subscribe",["settings.subscribeList"],function(e){return Mn.View.extend({template:_.template("<div></div>"),regions:{area:"div"},onRender:function(){var t=new e({collection:this.model.collection});this.showChildView("area",t),t.setFilter(function(e,t,i){return e.id!==this.model.id}.bind(this)),this._check()},onChildviewClickItemSubscribe:function(e){
e.$("input").is(":checked")?this.collection.get(e.model.id).destroy():this.collection.create(new Backbone.Model({id:e.model.id,title:e.model.get("title"),requestParameters:e.model.get("requestParameters")}))},collectionEvents:{update:function(){this._check()},reset:function(){this._check()}},_check:function(){this.getChildView("area").children.each(function(e){this.collection.findWhere({id:e.model.id})?e.$("input").prop("checked",!0):e.$("input").prop("checked",!1)},this)},onShow:function(){this.collection.length||this.collection.fetch({reset:!0})}})}),define("MasterCreateView",["i18n!nls/resources.min","settings.subscribeList","requestView","settings.visualisation.chart.choice","g/ejRTEView","settings.decorationWidget","syncfusion"],function(e,t,i,n,a,o){return Mn.View.extend({template:"#widget-create-template",templateContext:{Resources:e},ui:{next:"#next",back:"#back"},regions:{reqArea:".requestParam>section",subscrArea:"#Subscribe",editor:".htmlEditor",visual:".visualization",decoration:{el:"#decoration",replaceElement:!0}},initialize:function(){this.panels={Default:["one","requestParam","decoration"],WidgetGraph:["one","requestParam","visualization","decoration"],WidgetSource:["one","requestParam","decoration","subscribe"],WidgetSemNet:["one","requestParam","decoration","subscribe"],WidgetReporting:["one","requestParam","decoration","subscribe"],WidgetHtml:["one","requestParam","decoration","htmlEditor"]},this.step=new Backbone.Model({step:0}),this.step.on("change:step",this.checkStep,this),this.publishers=new Backbone.Collection},onRender:function(){this.step.set("step",1)},events:{"keyup #titleWidget":"checkTitle","blur #titleWidget":"checkTitle","mouseover .types-widget span":function(t){var i=$(t.target).closest("span").attr("id"),n={WidgetTable:e.WidgetTable,WidgetRunning:e.WidgetRunning,WidgetMap:e.WidgetMap,WidgetGraph:e.WidgetGraph,WidgetCloud:e.WidgetCloud,WidgetSource:e.WidgetSource,WidgetReporting:e.WidgetReporting,WidgetHtml:e.WidgetHtml,WidgetSemNet:e.WidgetSemNet};1===this.step.get("step")&&this.$(".one>.description").html(n[i]).fadeIn()},"mouseleave .types-widget span":function(){this.$(".one>.description").hide()},"click .types-widget span":function(e){var t=$(e.target).closest("span");this.model.set("typeName",t.attr("id")),this.isInitRequest=!1,this.next()},"click @ui.back":function(){var e=this.step.get("step");e>1&&(e--,this.step.set("step",e))},"click @ui.next":"next","click nav>div":function(e){this.$("nav>div").toggleClass("ac"),this.$(".tab-content").toggleClass("show")},"click #decor-chbx span.font-icon-checkbox":function(e){var t=$(e.target).closest("span"),i=t.find("input").get(0);t.toggleClass("checked"),i.checked=!i.checked}},modelEvents:{change:function(){this.ui.next.attr("disabled",!this.model.isValid())},"change:width":function(e,t){this.$('input[name="width"]').val(t)},"change:height":function(e,t){this.$('input[name="height"]').val(t)}},childViewEvents:{"chart:selected":function(e){this.ui.next.attr("disabled",!1)}},next:function(){var e=this.step.get("step");e++,this.step.set("step",e)},checkTitle:function(){this.model.set("title",$.trim(this.$("#titleWidget").val()))},checkStep:function(){this.$el.closest(".side-panel").removeClass("big");var s=this.step.get("step"),r=this.panels[this.model.get("typeName")]||this.panels.Default;if(-1!==r.indexOf("htmlEditor")&&this.getRegion("editor").hasView()&&this.model.set("contentHtml",this.getChildView("editor").ejRTE.getHtml()),s>=0&&s<=r.length){this.ui.next.text(s===r.length?e.createdWidget:e.next).attr("disabled",!this.model.isValid()),this.ui.back.attr("disabled",1===s),this.$(".step-panel").hide();var l=r[s-1];switch(this.$("."+l).show(),1===s?this.$(".cmd").hide():this.$(".cmd").show(),l){case"requestParam":this.showChildView("reqArea",new i({model:this.model}));break;case"visualization":this.$el.closest(".side-panel").addClass("big"),this.ui.next.attr("disabled",!0),this.showChildView("visual",new n({model:this.model}));break;case"subscribe":if(!this.getRegion("subscrArea").hasView()){var c=new t({collection:this.model.collection});this.getRegion("subscrArea").show(c),this.listenTo(c,"click:item:subscribe",function(e){e.$("input").is(":checked")?(e.$("input").prop("checked",!1),this.publishers.remove(this.publishers.get(e.model.id))):(e.$("input").prop("checked",!0),this.publishers.add(new Backbone.Model({id:e.model.id,title:e.model.get("title")})))})}break;case"htmlEditor":this.getRegion("editor").hasView()||this.showChildView("editor",new a);break;case"decoration":this.getRegion("decoration").hasView()||this.showChildView("decoration",new o({model:this.model}))}}else if(s>r.length){this.publishers.length&&this.model.set("publishers",this.publishers.pluck("id")),this.getDecoration();var d=$("main");this.model.set({top:d.height()/2-this.model.get("height")/2+d.scrollTop(),left:d.width()/2-this.model.get("width")/2+d.scrollLeft()}),this.model.collection.create(this.model,{wait:!0}),this.getRegion("reqArea").empty(),this.getRegion("subscrArea").empty(),this.triggerMethod("close:left",this.model)}},getDecoration:function(){var e=(this.model.get("Decoration"),parseInt(this.$('input[name="width"]').val())),t=parseInt(this.$('input[name="height"]').val());this.model.set({width:isNaN(e)?this.model.get("width"):e<50?50:e,height:isNaN(t)?this.model.get("height"):t<50?50:t})}})}),define("widget:map:legendView",[],function(){return Mn.View.extend({template:"#widget-map-legend-template",ui:{container:".LegendContainer"},onRender:function(){this.model.get("LegendIsVisible")||this.$el.hide(),this.setPosition()},modelEvents:{change:function(){this.render()}},setPosition:function(){var e=this.model.get("LegendPosition")||"top-right",t=e.split("-"),i=t[1],n={};n[t[0]]="1px",n[i]="top"===i?"36px":"1px",this.ui.container.fadeTo("hide",.8).css(n)}})}),define("widget.reportView",["i18n!nls/resources.min","PDFJS"],function(e){return Mn.View.extend({template:!1,modelEvents:{change:function(){this.$el.empty(),this.renderPage(this.pdf)}},onRender:function(){this.options.url||this.$el.html("<p>"+e.setreport+"</p>")},onAttach:function(){this.options.url&&require(["/js/dist/pdf/display/api.js","/js/dist/pdf/display/metadata.js","/js/dist/pdf/display/canvas.js","/js/dist/pdf/display/webgl.js","/js/dist/pdf/display/pattern_helper.js","/js/dist/pdf/display/font_loader.js","/js/dist/pdf/display/annotation_helper.js"],function(){PDFJS.workerSrc="/js/dist/pdf/worker_loader.js",PDFJS.getDocument(this.options.url).then(function(e){this.pdf=e,this.renderPage(e)}.bind(this))}.bind(this))},renderPage:function(e){function t(e,t,i,a){t.getPage(i).then(function(t){var i=t.getViewport(1);i=t.getViewport(n/i.width);var o=i.width,s=i.height,r=document.createElement("div");r.className="pdfpage",r.style.width=o+5+"px",r.style.height=s+5+"px",e.appendChild(r);var l=document.createElement("canvas"),c=l.getContext("2d");l.width=o,l.height=s,r.appendChild(l);var d={canvasContext:c,viewport:i};t.render(d).promise.then(a)})}var i=this.$el.get(0),n=this.$el.width()-40,a=1;t(i,e,a++,function n(){a>e.numPages||t(i,e,a++,n)})},fitSize:function(){}})}),define("widget.semnet.semnetView",[],function(){var e=Backbone.Model.extend({defaults:{astree:0,eparam:[0,0,0],filter:null,filterName:null,filterValue:null,height:0,html:"",level:0,snid:-1,title:"",width:0}});return Mn.View.extend({template:_.template('<svg><g class="wrap"></g></svg>'),events:{"mouseover g.node[data-objectid]":function(e){var t=$(e.currentTarget),i=parseInt(t.attr("data-objectid"));!isNaN(i)&&i&&t.css("cursor","pointer")},"mouseout g.node[data-objectid]":function(e){$(e.currentTarget).css("cursor","default")},"click g.node[data-objectid]":function(e){var t=$(e.currentTarget),i=parseInt(t.attr("data-objectid"));!isNaN(i)&&i&&this.trigger("subscribers:reflect",new Backbone.Model({object_id:i,requestID:this.options.RID}))}},initialize:function(){this.model=new e,this.model.url="/api/SemNet/"+this.options.objectID+"/?semnetid=-1&layout="+this.options.widget.get("SNLayout")+"&level="+this.options.widget.get("SNLevel")+"&astree="+this.options.widget.get("SNStruct"),this.listenTo(this.options.widget,"change:width",function(e){this._fitSize(e)}),this.listenTo(this.options.widget,"change:height",function(e){this._fitSize(e)})},onRender:function(){this.options.RID||console.error("!Not requestID!"),$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.headers.key,{RID:this.options.RID}),this.model.fetch()},modelEvents:{"change:html":function(e,t){var i=this.options.container.width(),n=this.options.container.height();this.$("g.wrap").html($(t).html());var a=d3.select(this.$("svg").get(0)),o=a.select("g.wrap"),s=d3.zoom().scaleExtent([.125,6]).on("zoom",function(){o.attr("transform",d3.event.transform)}).on("end",function(){}.bind(this)),r=this.model.get("width"),l=this.model.get("height"),c=r/2,d=l/2,h=Math.max(.125,Math.min(6,.9/Math.max(r/i,l/n))),u=[i/2-h*c,n/2-h*d];a.attr("width",i).attr("height",n).call(s).transition().duration(750).call(s.transform,d3.zoomIdentity.translate(u[0],u[1]).scale(h))},request:function(){Backbone.Radio.channel("loader").trigger("show",this.$el,{speed:"fast"})},sync:function(){Backbone.Radio.channel("loader").trigger("hide")},error:function(){Backbone.Radio.channel("loader").trigger("hide")}},_fitSize:function(e){},_setCenter:function(e,t,i){var n={name:this.options.widget.get("title"),type:this.options.widget.get("typeName"),uid:this.options.widget.id,Visualization:this.options.widget.get("Visualization")},a=new Backbone.Model({widget:n,objectID:this.model.id,SNX:e,SNY:t,SNZoom:i});a.url="/api/widget/"+this.options.widget.id+"/setstate",a.save()}})}),define("widget.content.contentView",["i18n!nls/resources.min","/js/dist/video-js/video.js","/js/dist/jquery.mCustomScrollbar.concat.min.js"],function(e){var t=(Backbone.Model.extend({idAttribute:"object_id"}),Mn.CollectionView.extend({className:"accordion",onAttach:function(){this.$el.css({position:"relative",overflow:"hidden"})},childView:Mn.View.extend({className:"item-content",template:templates["widget-source-content"],templateContext:{Resources:e},ui:{head:".head-content",load:".load",rubrics:".card-rubric",url:".card-link",play:".play-button"},events:{"click @ui.play":function(e){var t=$(e.target),i=(parseInt(this.model.get("playingat")),parseInt(this.model.get("playinguntil"))),n=videojs(this.$("video").get(0));this.ui.play.text("pause"),n.ready(function(){!i||this.currentTime()<i?this.paused()?(t.text("pause"),this.play()):this.pause():(this.load(),this.play())}),n.on("waiting",function(){t.attr("disabled")}),n.on("loadeddata",function(){t.removeAttr("disabled")}),n.on("pause",function(){t.text("play")}),Backbone.trigger("storage:addPlayer",n,this.model.get("object_id"))}},initialize:function(){this.lightPos=[]},onBeforeRender:function(){this.model.has("webfile")||this.model.set("webfile","")},onRender:function(){if(this.model.has("contentcollection_rubrics")&&$.trim(this.model.get("contentcollection_rubrics"))&&!this.model.get("hideRubrics")){var e=this.model.get("contentcollection_rubrics");_.isArray(e)&&e.length?this.ui.rubrics.find("p").html(e.join(" | ")):this.ui.rubrics.find("p").text(e)}else this.ui.rubrics.hide();this.model.get("url_источника")&&this.ui.url.html('<span class="card-link-icon"><svg class="link-icon"><use xlink:href="#link-icon"></use></svg></span>\n                        <a href="'+this.model.get("url_источника")+'" target="_blank">'+(this.model.get("massmedia")||this.model.get("url_источника"))+"</a>")},onAttach:function(){var e=this.model.get("systemtypename");if("Audiosource"===e||"VideoSource"===e){var t=videojs(this.$("video").get(0)),i=0,n=0,a="VideoSource"===this.model.get("systemtypename"),o=this.$el.width();a?t.height((this.$el.width()-80)/3,!0):t.height(128,!0),t.on("loadeddata",function(){if(i=this.L.videoWidth,n=this.L.videoHeight,a){if(o<i){var e=i/n;i=o-30,n=i/e}this.width(i,!0),this.height(n,!0)}})}else this._toLightPosition()},_toLightPosition:function(){var e=this;this.ui.load.css({width:this.$el.closest(".widget-container").width(),height:this.$el.closest(".widget-container").height()-this.ui.head.height(),overflow:"auto"}),this.ui.load.find("span[data-oid]").each(function(t,i){$(i).addClass("Mark"),e.lightPos.push($(i).position().top)});var t=this.lightPos,i=0;this.ui.load.mCustomScrollbar(),t.length&&i!==t.length?(this.ui.load.mCustomScrollbar("scrollTo",t[i]-this.ui.load.position().top-3),this.ui.load.find("span[data-oknd=2].C").removeClass("C"),this.ui.load.find("span[data-oknd=2]").eq(i).addClass("C"),i===t.length-1?i=0:i++):this.ui.load.mCustomScrollbar("scrollTo",0)}})}));return Mn.View.extend({template:_.template("<div></div>"),regions:{items:{el:"div",replaceElement:!0}},initialize:function(){Backbone.trigger("storage:clearPlayers"),this.collection=new Backbone.Collection,this.collection.url="/api/widget/listen/"+this.options.requestID+"/source/"+this.model.id+"/"+this.options.objectID},onRender:function(){this.showChildView("items",new t({collection:new Backbone.Collection}))},onAttach:function(){this.collection.fetch({reset:!0})},modelEvents:{"change:height":function(){this.getChildView("items").render()}},collectionEvents:{request:function(){Backbone.Radio.channel("loader").trigger("show",this.$el,{speed:"fast"})},reset:function(){var e=Backbone.Radio.channel("chW").request("get:param:model",this.model.get("Characteristics"),"WidgetSource.Options"),t=!1;e.has("WidgetParamValue")&&(t=e.get("WidgetParamValue").hideRubrics);var i=this.collection.at(0),n=i.get("items"),a=[];_.each(n,function(e){var i=_.chain(e.data).map(function(e){return[e.systemName,e.value]}).object().value();i.links=e.links,i.textsource||(i.textsource=""),i.hideRubrics=t,a.push(i)},this),this.getChildView("items").collection.reset(a),Backbone.Radio.channel("loader").trigger("hide"),this.triggerMethod("content:loaded")},error:function(){Backbone.Radio.channel("loader").trigger("hide"),this.triggerMethod("content:loaded")}}})}),define("chartsRepository",["i18n!nls/resources.min"],function(e){return[{id:1,name:e.gn1,type:"column",family:"Syncfusion_G"},{id:3,name:e.gn2,type:"bar",family:"Syncfusion_G"},{id:5,name:e.gn3,type:"stackingcolumn",family:"Syncfusion_G"},{id:7,name:e.gn6,type:"line",family:"Syncfusion_G"},{id:16,name:e.gn7,type:"stackingcolumn100",family:"Syncfusion_G"},{id:11,name:e.gn8,type:"area",family:"Syncfusion_G"},{id:15,name:e.gn9,type:"stackingarea100",family:"Syncfusion_G"},{id:6,name:e.gn5,type:"pie",family:"Syncfusion_P"},{id:22,name:e.gn4,type:"bubble",family:"Syncfusion_W"},{id:4,name:e.gn10,type:"bar_d3",family:"C3"},{id:9,name:e.gn11,type:"area_d3",family:"C3"}]}),define("settings.visualisation.chart.choice",["i18n!nls/resources.min","sendModel","ejChartView","chartsRepository"],function(e,t,i,n){var a=Mn.CollectionView.extend({className:"graph-panel-grid",childView:i,childViewOptions:function(e){e.set({width:"300",height:"300"})},childViewEvents:{"chart:selected":function(e){this.children.each(function(e){e.$el.removeClass("selected")}),e.$el.addClass("selected"),this.trigger("chart:selected",e)}}});return Mn.View.extend({className:"graph-panel show",template:"#choice-chart-template",templateContext:{Resources:e},regions:{wrap:{el:"div.graph-panel-grid",replaceElement:!0}},onRender:function(){var e=this.model.get("requestParameters");this.sendModel=new t({id:e.rid,pars:e.parameters,useDefParams:e.useDefParams,widget:{uid:this.model.id,name:this.model.get("title"),type:this.model.get("typeName"),Visualization:this.model.get("Visualization")}}),this.options.ruleCode&&this.sendModel.set("ruleCode",this.options.ruleCode),Backbone.Radio.channel("loader").trigger("show",this.$el),this.sendModel.fetch({success:this._successLoad.bind(this)})},_successLoad:function(e){var t=e.get("data").variations,i=new Backbone.Collection;_.each(t,function(e){var t=e.family;_.chain(n).filter(function(e){return e.family===t}).each(function(t){i.add(new Backbone.Model(_.extend(t,e)))})},this),this.showChildView("wrap",new a({collection:i})),Backbone.Radio.channel("loader").trigger("hide")},childViewEvents:{"chart:selected":function(e){this.model.get("requestParameters").ruleCode=e.model.get("ruleCode"),this.model.set({Visualization:e.model.get("type")}),this.trigger("chart:selected",e)}}})}),define("settings.visualization.chart",["i18n!nls/resources","global.view.dropDown","global.charts.settingsmodel","global.behaviors.input","settings.colorRow","settings.visualisation.chart.choice","radio.characteristic","RU"],function(e,t,i,n,a,o){var s=(e.gn1,e.gn2,e.gn3,e.gn4,e.gn5,e.gn6,e.gn7,e.gn8,e.gn9,e.gn10,e.gn11,Mn.View.extend({behaviors:{input:n},template:"#visual-settings-template",templateContext:{Resources:e},ui:{colw:"#columnWidth",cols:"#columnSpacing",psize:"#pieSize"},regions:{legendPosition:{el:"#legendPosition",replaceElement:!0},axesXlabelAction:{el:"#axesXlabelAction",replaceElement:!0}},events:{"change @ui.colw":function(){this.ui.colw.next("label").find("span").text(this.ui.colw.val())},"change @ui.cols":function(){this.ui.cols.next("label").find("span").text(this.ui.cols.val())},"change @ui.psize":function(){this.ui.psize.next("label").find("span").text(this.ui.psize.val())}},onRender:function(){this.showChildView("legendPosition",new t({collection:new Backbone.Collection([{id:"Left",title:e.vs33left},{id:"Top",title:e.vs33top},{id:"Right",title:e.vs33right},{id:"Bottom",title:e.vs33bottom}])})),this.getChildView("legendPosition").setCurrent(this.model.get("legendPosition")).$el.css("display","block"),"pie"!==this.model.get("chart")&&(this.showChildView("axesXlabelAction",new t({collection:new Backbone.Collection([{id:"none",title:"None - "+e.lpa1},{id:"rotate90",title:"Rotate 90 - "+e.lpa2},{id:"rotate45",title:"Rotate 45 - "+e.lpa3},{id:"wrap",title:"Wrap - "+e.lpa4},{id:"wrapByWord",title:"Wrap by word - "+e.lpa5},{id:"trim",title:"Trim - "+e.lpa6},{id:"hide",title:"Hide - "+e.lpa7},{id:"multipleRows",title:"MultipleRows - "+e.lpa8}])})),this.getChildView("axesXlabelAction").setCurrent(this.model.get("primaryXAxislabelIntrsectAction")).$el.css("display","block")),this.$("#"+this.model.get("prefix")+"_legendBorderColor").ejColorPicker({locale:e.Lang,modelType:"palette",presetType:"webcolors",enableOpacity:!1})},modelEvents:{"change:chart":function(){this.render()}}}));return Mn.View.extend({template:_.template('<h3 class="link" id="change-face"><%- Resources.ctd %></h3><br/><div class="face-choose" style="display:none;"></div><div class="face-form"><div class="form"></div><h3><%- Resources.vs8 %></h3><div id="color-settings"></div></div>'),templateContext:{Resources:e},ui:{face:"#change-face",choose:".face-choose",form:".face-form"},regions:{form:{el:".form",replaceElement:!0},color:{el:"#color-settings",replaceElement:!0},face:".face-choose"},events:{"click @ui.face":function(){this.ui.choose.is(":hidden")?(this.ui.face.text(e.back),this.ui.form.hide(),this.ui.choose.show(),this.getRegion("face").hasView()||(this.showChildView("face",new o({model:this.model,ruleCode:"any"})),this.getChildView("face").$el.removeClass("show").addClass("visualisation"))):(this.ui.face.text(e.ctd),this.ui.form.show(),this.ui.choose.hide())}},onRender:function(){var e=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:this.model.get("typeName")+".GhaphSubSettings"}),t=new i;e&&t.set(e.WidgetParamValue),t.set({prefix:this.model.id,chart:this.model.get("Visualization")}),this.showChildView("form",new s({model:t})),this.showChildView("color",new a({model:this.model,collection:this.collection}))},onShow:function(){},childViewEvents:{"chart:selected":function(e){var t=e.model.get("type");this.model.set("Visualization",t),this.getChildView("form").model.set("chart",t)}},onSave:function(){var e=$.GetData(this.$el);this.getChildView("form").getRegion("axesXlabelAction").hasView()&&(e.primaryXAxislabelIntrsectAction=this.getChildView("form").getChildView("axesXlabelAction").current.id),e.legendPosition=this.getChildView("form").getChildView("legendPosition").current.id;var t=Backbone.Radio.channel("chW"),i=t.request("get:param:model",this.model.get("Characteristics"),"WidgetGraph.GhaphSubSettings"),n=t.request("get:param:model",this.model.get("Characteristics"),"PaletteByChart");i.set("WidgetParamValue",e),n.set("WidgetParamValue",this.getChildView("color").getChildView("list").collection.toJSON());var a=Backbone.Radio.channel("chW").request("get:params:collection",this.model.id);a.add([i,n]),a.fetch({success:function(e){this.model.save({Characteristics:e.toJSON()})}.bind(this)})}})}),define("settings.visualization.cloud",["i18n!nls/resources.min","settings.colorRow","global.view.dropDown","global.behaviors.input"],function(e,t,i,n){var a=Mn.View.extend({behaviors:{input:n},template:"#cloud-form-template",templateContext:{Resources:e},regions:{shape:{el:"#cloud-shape",replaceElement:!0}},onBeforeRender:function(){this.model.has("shapeCloud")||this.model.set("shapeCloud","elliptic")},onRender:function(){this.showChildView("shape",new i({collection:new Backbone.Collection([{id:"elliptic",title:e.cse},{id:"rectangular",title:e.csr}])})),this.getChildView("shape").setCurrent(this.model.get("shapeCloud")).$el.css("display","block")}});return Mn.View.extend({template:"#cloud-settings-template",regions:{color:{el:"#color-rows",replaceElement:!0},form:{el:"#form-settings",replaceElement:!0}},onRender:function(){var e=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"WidgetCloud.SubSettings"})||{},i=new Backbone.Model({minFontSizeCloud:10,maxFontSizeCloud:null,shapeCloud:"elliptic"});e&&i.set(e.WidgetParamValue),this.showChildView("form",new a({model:i})),this.showChildView("color",new t({model:this.model,collection:this.collection}))},collectionEvents:{reset:function(){this.onReset()}},onSave:function(){var e=Backbone.Radio.channel("chW"),t=e.request("get:param:model",this.model.get("Characteristics"),"WidgetCloud.SubSettings"),i=e.request("get:param:model",this.model.get("Characteristics"),"PaletteByChart"),n=$.GetData(this.getChildView("form").$el);n.shapeCloud=this.getChildView("form").getChildView("shape").current.id,t.set("WidgetParamValue",n),i.set("WidgetParamValue",this.getChildView("color").getChildView("list").collection.toJSON());var a=Backbone.Radio.channel("chW").request("get:params:collection",this.model.id);a.add([t,i]),a.fetch({success:function(e){this.model.save({Characteristics:e.toJSON()})}.bind(this)})},onReset:function(){var e=_.findWhere(this.model.get("Characteristics"),{WidgetParamName:"PaletteByChart"});e&&_.each(e.WidgetParamValue,function(e){var t=this.collection.findWhere({object_id:e.object_id});t&&t.set("color",e.color)},this)}})}),define("settings.visualization.semnet",["i18n!nls/resources.min","global.view.dropDown"],function(e,t){return Mn.View.extend({template:"#semnet-settings-template",templateContext:{Resources:e},regions:{ddlevel:"#level",ddtree:"#astree",ddlayout:"#layout"},onRender:function(){this.showChildView("ddlayout",new t({collection:new Backbone.Collection([{title:e.snl1,id:0},{title:e.snl2,id:1},{title:e.snl3,id:2},{title:e.snl4,id:3},{title:e.snl5,id:4},{title:e.snl6,id:5},{title:e.snl7,id:6}]),current:this.model.get("layout"),name:"layout"})),this.showChildView("ddtree",new t({collection:new Backbone.Collection([{title:e.ss1,id:0},{title:e.ss2,id:1},{title:e.ss3,id:2}]),current:this.model.get("astree"),name:"astree"})),this.showChildView("ddlevel",new t({collection:new Backbone.Collection([{title:"level 1",id:1},{title:"level 2",id:2},{title:"level 3",id:3}]),current:this.model.get("level"),name:"level"})),this.model.has("SNLevel")&&this.getChildView("ddlevel").setCurrent(this.model.get("SNLevel")),this.model.has("SNLayout")&&this.getChildView("ddlayout").setCurrent(this.model.get("SNLayout")),this.model.has("SNStruct")&&this.getChildView("ddtree").setCurrent(this.model.get("SNStruct"))},onSave:function(){this.model.set($.GetData(this.$el)),this.model.save({SNLevel:this.getChildView("ddlevel").current.id,SNLayout:this.getChildView("ddlayout").current.id,SNStruct:this.getChildView("ddtree").current.id})},onReset:function(){}})}),define("settings.visualisation.table.column",["i18n!nls/resources.min"],function(e){var t=Backbone.Collection.extend({model:Backbone.Model.extend({idAttribute:"ColumnSystemName",defaults:{QueryCustomizationUID:null,QueryID:0,ColumnSystemName:null,ColumnTitle:"",ColumnWidth:null,ColumnIsVisible:!0,SerialNum:""}})});return Mn.CollectionView.extend({className:"list-area",events:{click:function(e){e.stopPropagation()}},childView:Mn.View.extend({className:"row",template:templates["column-settings-template"],templateContext:{Resources:e},onRender:function(){this.$el.attr("id",this.model.id)}}),childViewOptions:function(e){e.set({QueryID:this.model.get("requestParameters").rid,prefix:this.model.id})},initialize:function(e){this.collection=new t,this.collection.comparator="SerialNum"},onBeforeRender:function(){var e=this.model.has("feed")?this.model.get("feed").head:[],t=this.model.get("requestParameters")?this.model.get("requestParameters").rid:null,i=this.model.get("ColumnCustomizations"),n=_.map(e,function(e,n){var a={};return i&&(a=_.findWhere(i,{ColumnSystemName:e.systemName})||{}),new this.collection.model({QueryCustomizationUID:a.QueryCustomizationUID||null,QueryID:t,ColumnSystemName:e.systemName,ColumnTitle:a.ColumnTitle||e.displayName,ColumnIsVisible:void 0===a.ColumnIsVisible?e.isVisible:a.ColumnIsVisible,SerialNum:a.SerialNum||n,ColumnWidth:a.ColumnWidth||"auto"})},this);this.collection.set(n)},onAddChild:function(){this.$el.sortable({items:".row",axis:"y",stop:function(e,t){this.$(".row").each(function(e,t){var i=$(t);this.collection.get(i.attr("id")).set("SerialNum",i.index()),i.find("input[name=SerialNum]").val(i.index())}.bind(this))}.bind(this)})},onSave:function(e){var t=[];this.$(".row").each(function(){t.push($.GetData($(this)))}),$.ajax({method:"POST",contentType:"application/json; charset=utf-8",url:"/api/widget/"+this.model.get("requestParameters").rid+"/colscustomization",data:JSON.stringify(t)}).done(function(t){e.call(this,t)}.bind(this))},onReset:function(e){this.collection.reset(),$.get("/api/widget/"+this.model.get("requestParameters").rid+"/colscustomization/flush").done(function(t){e.call(this)}.bind(this))}})}),define("settings.visualisation.table.fields",[],function(){return Mn.View.extend({template:_.template('<img  class = "card-example" src = "" />'),onRender:function(){this.$el.addClass("container-example"),"card"===this.model.get("Visualization")?this.$("img").attr("src","../../Images/vertical_card.png"):this.$("img").attr("src","../../Images/horizontal_card.png")},onSave:function(e){e.call(this)}})}),define("settings.visualization.table",["i18n!nls/resources.min","settings.visualisation.table.column","settings.visualisation.table.fields","global.behaviors.input"],function(e,t,i,n){var a={table:t,card:i,card2:i};return Mn.View.extend({behaviors:[n],template:templates["table-visualisation-template"],templateContext:function(){return{Resources:e,prefix:this.model.id}},regions:{content:{el:"#content",replaceElement:!0}},events:{"click input":function(e,t){var i=this.$('input[name="Visualization"]:checked').attr("id").split("_")[1];this.model.set("Visualization",i),this.getRegion("content").show(new a[i]({model:this.model}))}},onShow:function(){var e=this.model.get("Visualization")||"table";this.$("#"+this.model.id+"_"+e).prop("checked",!0),this.getRegion("content").show(new a[e]({model:this.model}))},onSave:function(){this.getChildView("content").onSave(function(e){this.model.save({ColumnCustomizations:e})})},onReset:function(){this.getChildView("content").onReset(function(){this.model.set("ColumnCustomizations",null)})},modelEvents:{"change:feed":function(e,t){var i=this.model.get("Visualization")||"table";this.getRegion("content").show(new a[i]({model:this.model}))}}})}),define("widget.table.filter",["i18n!nls/resources.min"],function(e){var t=Mn.CollectionView.extend({emptyView:Mn.View.extend({template:_.template("<p><%- Resources.norubric %></p>"),templateContext:{Resources:e}}),childView:Mn.View.extend({tagName:"span",className:"g-form--input",template:_.template('<input class="g-form--checkbox" type="checkbox" checked id="<%- prefix %><%- value.replace(/ /g, \'\') %>" name="<%- prefix %><%- value.replace(/ /g, \'\') %>" /><label for="<%- prefix %><%- value.replace(/ /g, \'\') %>"><%- value %></label>'),templateContext:function(){return{prefix:this.options.prefix}},ui:{chbx:"input"},triggers:{"click input":{event:"click:item",preventDefault:!1,stopPropagation:!0}}}),childViewOptions:function(){return{prefix:this.options.prefix}},childViewTriggers:{"click:item":"filter:apply"}});return Mn.View.extend({className:"filter-panel anbr-tabs",template:templates["filter-panel"],templateContext:{Resources:e},ui:{input:'input[name="searchInWidget"]',rTab:'span[data-name="rubrics-panel"]',sTab:'span[data-name="search-panel"]',rPan:"#rubrics-panel",sPan:"#search-panel"},regions:{list:".list-area"},initialize:function(){this.collection=new Backbone.Collection},onRender:function(){this.showChildView("list",new t({collection:this.collection,prefix:this.model.id}))},childViewEvents:{"filter:apply":function(e){e.model.set("hide",!e.ui.chbx.prop("checked"))}},childViewTriggers:{"filter:apply":"filter:apply"},events:{"click nav span:not(.right)":function(e){var t=$(e.target).closest("span");this.$("nav span").removeClass("active"),this.$("section").hide(),t.addClass("active"),this.$("section#"+t.attr("data-name")).show()},"click nav span.right":function(){this.$el.slideToggle()},"click button.search":function(){var e=this.ui.input.val();$.trim(e)?this.triggerMethod("filter:search",e):this.triggerMethod("filter:apply")},"click button.cancel":function(){this.ui.input.val(""),this.triggerMethod("filter:apply")}},hideRubrics:function(){this.ui.rTab.hide(),this.ui.rPan.hide(),this.ui.sTab.addClass("active"),this.ui.sPan.show()},showRubrics:function(){this.ui.rTab.addClass("active"),this.ui.rPan.show()}})}),define("widgetTableGrid",["i18n!nls/resources.min"],function(e){var t=Mn.CollectionView.extend({className:"tools",events:{mouseleave:function(){this.$el.hide()}},childView:Mn.View.extend({tagName:"span",className:"btn",events:{"mouseenter svg":function(){this.$el.find(".anbr-tooltip").fadeIn()},"mouseleave svg":function(){this.$el.find(".anbr-tooltip").fadeOut()}},triggers:{touchstart:"action",click:"action"},onAction:function(t){"action"===this.model.get("render")&&$.ajax({method:this.model.get("verb"),url:this.model.get("href")}).done(function(){Backbone.trigger("message:success",{title:e.alert,message:e.success})}).fail(function(t){Backbone.trigger("message:warning",{title:e.error,message:t.status})})},getTemplate:function(){return"open"===this.model.get("render")?_.template('<a dir="auto" href="<%- href %>" target="_blank"><span class="anbr-tooltip"><span position="bottom"></span><%- prompt %></span><svg class="svg-icon"><use xlink:href="#<%- id %>" /></svg></a>'):_.template('<span dir="auto" class="anbr-tooltip"><span position="bottom"></span><%- prompt %></span><svg class="svg-icon"><use xlink:href="#<%- id %>" /></svg>')}}),onRenderChildren:function(){this.$el.width(52*this.collection.length).delay(100).slideDown()}}),i=(Mn.View.extend({className:"preblu",template:_.template('<div class="arrow"></div><div class="tools"></div>'),regions:{tools:{el:".tools",replaceElement:!0}},triggers:{touchstart:"prepare",click:"prepare"},onPrepare:function(){var e=_.groupBy(this.model.get("links"),"rel").tools||[];this.showChildView("tools",new t({collection:new Backbone.Collection(e)}))},show:function(e){this.model=e.model,this.$el.css("top",e.$el.position().top+e.$el.outerHeight()/2-10),this.$el.show()}}),Mn.View.extend({tagName:"tr",getTemplate:function(){return _.template(this.options.templ)},templateContext:function(){return{parse:this.parseType}},events:{"click a":function(e){e.stopPropagation()},
"touchstart a":function(e){e.stopPropagation()}},triggers:{mouseenter:"mouse:enter:row",mouseleave:"mouse:leave:row",touchstart:"table:row:handler",click:"table:row:handler"},onRender:function(){if(this.model.has("links")){var e=_.groupBy(this.model.get("links"),"rel");if(_.has(e,"rubric_id")){this.$('td[data-column="display_name"]').append('<div class="rubrics"></div>');var t=_.pluck(e.rubric_id,"value");this.$(".rubrics").append(t.join("; "))}_.has(e,"url_источника")&&_.chain(e["url_источника"]).map(function(e){this.$('td[data-column="display_name"]').append('<a title="'+e.prompt+'" href="'+e.href+'" target="_blank">\n\t\t\t\t\t\t\t\t<span><svg class="link-icon"><use xlink: href="#link-icon" /></svg></span>\n\t\t\t\t\t\t\t</a>')},this)}},modelEvents:{"set:current":function(e,t){this.$el.addClass("current").removeClass("new-post"),this.$el.find("td").each(function(e,t){$(t).css({color:this.options.decoration.ContainerForegroundActive,"background-color":this.options.decoration.ContainerBackgroundActive})}.bind(this))}},parseType:function(e,t){if(!t)return"";var i;switch(t){case 0:i=parseInt(e);break;case 2:i=$.parseDate(e);break;case 4:i=parseFloat(e);break;case 7:case 1:case 3:case 5:case 6:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:i="<span>"+e+"</span>"}return i}})),n=Mn.CollectionView.extend({tagName:"tbody",childView:i,childViewOptions:function(){return{templ:this.options.templ,cols:this.options.cols,decoration:this.options.decoration}},emptyView:Mn.View.extend({tagName:"tr",template:_.template('<td dir="auto" colspan="<%- colspan %>"><%- Resources.N %></td>'),templateContext:function(){return{Resources:e,colspan:this.options.cols}}}),onChildviewTableRowHandler:function(e){var t=this.$el.find("tr.current"),i=this.options.isMarkSelectedItem;t.removeClass("current").addClass("viewed"),t.find("td").each(function(e,t){$(t).css({color:i?this.options.decoration.ContainerForegroundVisited:this.options.decoration.ContainerForeground,"background-color":i?this.options.decoration.ContainerBackgroundVisited:this.options.decoration.ContainerBackground})}.bind(this)),e.$el.addClass("current").removeClass("new-post"),e.$el.find("td").each(function(e,t){$(t).css({color:this.options.decoration.ContainerForegroundActive,"background-color":this.options.decoration.ContainerBackgroundActive})}.bind(this))},childViewTriggers:{"mouse:enter:row":"mouse:enter:row","mouse:leave:row":"mouse:leave:row","table:row:handler":"table:row:handler"}}),a=Mn.CollectionView.extend({tagName:"tr",childView:Mn.View.extend({tagName:"th",template:_.template("<%- displayName %>"),onRender:function(){this.$el.attr("data-column",this.model.get("systemName")),this.$el.attr("dir","auto"),this.$el.css("width",this.model.get("columnWidth")||"auto")}})}),o=Mn.View.extend({tagName:"table",className:"widget-table",template:_.template("<thead></thead><tbody></tbody><tfoot></tfoot>"),regions:{head:"thead",body:{el:"tbody",replaceElement:!0}},initialize:function(){this.templ="";var e=this.model.get("ColumnCustomizations");e?this.options.head=_.chain(e).filter(function(e){return e.ColumnIsVisible}).sortBy(function(e){return e.SerialNum}).map(function(e){return this.templ+="<td dir='auto' data-column=\""+e.ColumnSystemName.toLowerCase()+'"><%= parse('+e.ColumnSystemName.toLowerCase()+', propType["'+e.ColumnSystemName.toLowerCase()+'"]) %></td>',{displayName:e.ColumnTitle,systemName:e.ColumnSystemName,columnWidth:e.ColumnWidth||"auto"}},this).value():_.each(this.options.head,function(e){this.templ+="<td dir='auto' data-column=\""+e.systemName+'"><%= parse('+e.systemName+', propType["'+e.systemName+'"]) %></td>'},this)},onRender:function(){this.$el.attr("dir","auto"),this.showChildView("head",new a({collection:new Backbone.Collection(this.options.head)})),this.showChildView("body",new n({collection:this.collection,templ:this.templ,cols:this.options.head.length,isMarkSelectedItem:this.model.get("isMarkSelectedItem"),decoration:this.model.get("Decoration")}))},onAttach:function(){this._initColResizable(!this.options.editMode)},modelEvents:{"change:ReadOnly":function(e,t){this._initColResizable(t)},"change:width":function(){this.$("tbody").height(this.$el.closest(".anbr_list").height()-this.$("thead").height())},"change:height":function(){this.$("tbody").height(this.$el.closest(".anbr_list").height()-this.$("thead").height())}},onChildviewTableRowHandler:function(e){this.model.trigger("click:item",e.model)},childViewTriggers:{"mouse:enter:row":"mouse:enter:row","mouse:leave:row":"mouse:leave:row","table:row:handler":"table:row:handler"},_initColResizable:function(e){this.$el.colResizable({disable:e,liveDrag:!0,onResize:this._colResize.bind(this)})},_colResize:function(e){var t=$(e.currentTarget),i=this.model.get("ColumnCustomizations");if(!i){var n=this.model.get("feed").head,a=this.model.get("requestParameters");i=_.map(n,function(e,t){return{QueryCustomizationUID:null,QueryID:a,ColumnSystemName:e.systemName,ColumnTitle:e.displayName,ColumnIsVisible:e.isVisible,SerialNum:t,ColumnWidth:"auto"}},this)}t.find("th").each(function(e,t){var n=t.getAttribute("data-column"),a=t.clientWidth;_.findWhere(i,{ColumnSystemName:n}).ColumnWidth=a}.bind(this)),$.ajax({method:"POST",contentType:"application/json; charset=utf-8",url:"/api/widget/"+this.model.get("requestParameters").rid+"/colscustomization",data:JSON.stringify(i)}).done(function(e){this.model.save({ColumnCustomizations:e})}.bind(this))}});return Mn.View.extend({template:_.template('<span class="number-update"></span><div class="preblu"></div><table></table>'),ui:{update:".number-update"},regions:{toolsTable:{el:".preblu",replaceElement:!0},table:{el:"table",replaceElement:!0}},onRender:function(){this.showChildView("table",new o({model:this.model,collection:this.collection,head:_.filter(this.model.get("feed").head,function(e){return e.isVisible}),editMode:this.options.editMode}));var e=[];this.collection.each(function(t){var i=_.groupBy(t.get("links"),"rel");_.each(i.rubric_id,function(t){e.push(t)},this)},this),this.triggerMethod("table:add:rubrics:filter",e)},collectionEvents:{update:function(e,t){if(t.add){var e=[];_.each(t.changes.added,function(t){var i=_.groupBy(t.get("links"),"rel");_.each(i.rubric_id,function(t){e.push(t)},this)},this),this.triggerMethod("table:add:rubrics:filter",e)}}},childViewEvents:{"mouse:enter:row":function(e){},"mouse:leave:row":function(e){},"table:row:handler":function(e){}}})}),define("widgetTableCard",["i18n!nls/resources.min"],function(e){var t=Mn.CollectionView.extend({className:"card-newsblock",childView:Mn.View.extend({tagName:"article",className:"card-vertical",getTemplate:function(){return"card2"===this.options.vis?"#card-horizontal-view-template":"#card-vertical-view-template"},templateContext:{Resources:e},events:{"click a":function(e){e.stopPropagation()}},triggers:{touchstart:"table:row:handler",click:"table:row:handler"},onBeforeRender:function(){"card2"===this.options.vis&&this.$el.removeClass("card-vertical").addClass("card-horizontal");var t=this.model.toJSON(),i=Date.parse(t.дата_публикации)?new Date(t.дата_публикации).toLocaleString(e.Lang):"";if(this.model.set({display_name:this.model.get("display_name")||"",image:t.image||"",url:t.url_источника||"",pdate:i,annotation:t.аннотация,massmedia:t.massmedia,rubrics:""}),this.model.has("links")){var n=_.groupBy(this.model.get("links"),"rel");if(_.has(n,"rubric_id")){var a=_.pluck(n.rubric_id,"value");this.model.set("rubrics",a.join(" | "))}if(_.has(n,"url_источника")){var o=n.url_источника[0].href;this.model.set({url:o,massmedia:this.model.get("massmedia")?this.model.get("massmedia"):o})}}}}),onBeforeRender:function(){"card2"===this.options.vis&&this.$el.addClass("horizontal")},childViewOptions:function(){return{vis:this.options.vis}},childViewTriggers:{"table:row:handler":"table:row:handler"}});return Mn.View.extend({template:_.template("<div></div>"),templateContext:{Resources:e},regions:{list:{el:"div",replaceElement:!0}},onRender:function(){this.showChildView("list",new t({collection:this.collection,vis:this.model.get("Visualization")}))},onChildviewTableRowHandler:function(e){this.model.trigger("click:item",e.model)}})});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(i))}function i(t){var i=t.target,n=e(i);if(!n.is("[type=submit],[type=image]")){var a=n.closest("[type=submit]");if(0===a.length)return;i=a[0]}var o=this;if(o.clk=i,"image"==i.type)if(void 0!==t.offsetX)o.clk_x=t.offsetX,o.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var s=n.offset();o.clk_x=t.pageX-s.left,o.clk_y=t.pageY-s.top}else o.clk_x=t.pageX-i.offsetLeft,o.clk_y=t.pageY-i.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function n(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var a={};a.fileapi=void 0!==e("<input type='file'/>").get(0).files,a.formdata=void 0!==window.FormData;var o=!!e.fn.prop;e.fn.attr2=function(){if(!o)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function i(i){var n,a,o=e.param(i,t.traditional).split("&"),s=o.length,r=[];for(n=0;s>n;n++)o[n]=o[n].replace(/\+/g," "),a=o[n].split("="),r.push([decodeURIComponent(a[0]),decodeURIComponent(a[1])]);return r}function s(i){function a(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(e){n("cannot get iframe.contentWindow document: "+e)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(i){n("cannot get iframe.contentDocument: "+i),t=e.document}return t}function s(){function t(){try{var e=a(x).readyState;n("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(e){n("Server abort: ",e," (",e.name,")"),l(V),w&&clearTimeout(w),w=void 0}}var i=d.attr2("target"),o=d.attr2("action");S.setAttribute("target",f),r||S.setAttribute("method","POST"),o!=u.url&&S.setAttribute("action",u.url),u.skipEncodingOverride||r&&!/post/i.test(r)||d.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),u.timeout&&(w=setTimeout(function(){y=!0,l(T)},u.timeout));var s=[];try{if(u.extraData)for(var c in u.extraData)u.extraData.hasOwnProperty(c)&&(e.isPlainObject(u.extraData[c])&&u.extraData[c].hasOwnProperty("name")&&u.extraData[c].hasOwnProperty("value")?s.push(e('<input type="hidden" name="'+u.extraData[c].name+'">').val(u.extraData[c].value).appendTo(S)[0]):s.push(e('<input type="hidden" name="'+c+'">').val(u.extraData[c]).appendTo(S)[0]));u.iframeTarget||(m.appendTo("body"),x.attachEvent?x.attachEvent("onload",l):x.addEventListener("load",l,!1)),setTimeout(t,15);try{S.submit()}catch(e){var h=document.createElement("form").submit;h.apply(S)}}finally{S.setAttribute("action",o),i?S.setAttribute("target",i):d.removeAttr("target"),e(s).remove()}}function l(t){if(!v.aborted&&!R){if(L=a(x),L||(n("cannot access response document"),t=V),t===T&&v)return v.abort("timeout"),void C.reject(v,"timeout");if(t==V&&v)return v.abort("server abort"),void C.reject(v,"error","server abort");if(L&&L.location.href!=u.iframeSrc||y){x.detachEvent?x.detachEvent("onload",l):x.removeEventListener("load",l,!1);var i,o="success";try{if(y)throw"timeout";var s="xml"==u.dataType||L.XMLDocument||e.isXMLDoc(L);if(n("isXml="+s),!s&&window.opera&&(null===L.body||!L.body.innerHTML)&&--I)return n("requeing onLoad callback, DOM not available"),void setTimeout(l,250);var r=L.body?L.body:L.documentElement;v.responseText=r?r.innerHTML:null,v.responseXML=L.XMLDocument?L.XMLDocument:L,s&&(u.dataType="xml"),v.getResponseHeader=function(e){return{"content-type":u.dataType}[e]},r&&(v.status=Number(r.getAttribute("status"))||v.status,v.statusText=r.getAttribute("statusText")||v.statusText);var c=(u.dataType||"").toLowerCase(),d=/(json|script|text)/.test(c);if(d||u.textarea){var h=L.getElementsByTagName("textarea")[0];if(h)v.responseText=h.value,v.status=Number(h.getAttribute("status"))||v.status,v.statusText=h.getAttribute("statusText")||v.statusText;else if(d){var p=L.getElementsByTagName("pre")[0],f=L.getElementsByTagName("body")[0];p?v.responseText=p.textContent?p.textContent:p.innerText:f&&(v.responseText=f.textContent?f.textContent:f.innerText)}}else"xml"==c&&!v.responseXML&&v.responseText&&(v.responseXML=M(v.responseText));try{k=E(v,c,u)}catch(e){o="parsererror",v.error=i=e||o}}catch(e){n("error caught: ",e),o="error",v.error=i=e||o}v.aborted&&(n("upload aborted"),o=null),v.status&&(o=v.status>=200&&300>v.status||304===v.status?"success":"error"),"success"===o?(u.success&&u.success.call(u.context,k,"success",v),C.resolve(v.responseText,"success",v),g&&e.event.trigger("ajaxSuccess",[v,u])):o&&(void 0===i&&(i=v.statusText),u.error&&u.error.call(u.context,v,o,i),C.reject(v,"error",i),g&&e.event.trigger("ajaxError",[v,u,i])),g&&e.event.trigger("ajaxComplete",[v,u]),g&&!--e.active&&e.event.trigger("ajaxStop"),u.complete&&u.complete.call(u.context,v,o),R=!0,u.timeout&&clearTimeout(w),setTimeout(function(){u.iframeTarget||m.remove(),v.responseXML=null},100)}}}var c,h,u,g,f,m,x,v,_,b,y,w,S=d[0],C=e.Deferred();if(i)for(h=0;p.length>h;h++)c=e(p[h]),o?c.prop("disabled",!1):c.removeAttr("disabled");if(u=e.extend(!0,{},e.ajaxSettings,t),u.context=u.context||u,f="jqFormIO"+(new Date).getTime(),u.iframeTarget?(m=e(u.iframeTarget),b=m.attr2("name"),b?f=b:m.attr2("name",f)):(m=e('<iframe name="'+f+'" src="'+u.iframeSrc+'" />'),m.css({position:"absolute",top:"-1000px",left:"-1000px"})),x=m[0],v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var i="timeout"===t?"timeout":"aborted";n("aborting upload... "+i),this.aborted=1;try{x.contentWindow.document.execCommand&&x.contentWindow.document.execCommand("Stop")}catch(e){}m.attr("src",u.iframeSrc),v.error=i,u.error&&u.error.call(u.context,v,i,t),g&&e.event.trigger("ajaxError",[v,u,i]),u.complete&&u.complete.call(u.context,v,i)}},g=u.global,g&&0==e.active++&&e.event.trigger("ajaxStart"),g&&e.event.trigger("ajaxSend",[v,u]),u.beforeSend&&!1===u.beforeSend.call(u.context,v,u))return u.global&&e.active--,C.reject(),C;if(v.aborted)return C.reject(),C;(_=S.clk)&&(b=_.name)&&!_.disabled&&(u.extraData=u.extraData||{},u.extraData[b]=_.value,"image"==_.type&&(u.extraData[b+".x"]=S.clk_x,u.extraData[b+".y"]=S.clk_y));var T=1,V=2,A=e("meta[name=csrf-token]").attr("content"),P=e("meta[name=csrf-param]").attr("content");P&&A&&(u.extraData=u.extraData||{},u.extraData[P]=A),u.forceSync?s():setTimeout(s,10);var k,L,R,I=50,M=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},G=e.parseJSON||function(e){return window.eval("("+e+")")},E=function(t,i,n){var a=t.getResponseHeader("content-type")||"",o="xml"===i||!i&&a.indexOf("xml")>=0,s=o?t.responseXML:t.responseText;return o&&"parsererror"===s.documentElement.nodeName&&e.error&&e.error("parsererror"),n&&n.dataFilter&&(s=n.dataFilter(s,i)),"string"==typeof s&&("json"===i||!i&&a.indexOf("json")>=0?s=G(s):("script"===i||!i&&a.indexOf("javascript")>=0)&&e.globalEval(s)),s};return C}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var r,l,c,d=this;"function"==typeof t&&(t={success:t}),r=t.type||this.attr2("method"),l=t.url||this.attr2("action"),c="string"==typeof l?e.trim(l):"",c=c||window.location.href||"",c&&(c=(c.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:c,success:e.ajaxSettings.success,type:r||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var h={};if(this.trigger("form-pre-serialize",[this,t,h]),h.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&!1===t.beforeSerialize(this,t))return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var u=t.traditional;void 0===u&&(u=e.ajaxSettings.traditional);var g,p=[],f=this.formToArray(t.semantic,p);if(t.data&&(t.extraData=t.data,g=e.param(t.data,u)),t.beforeSubmit&&!1===t.beforeSubmit(f,this,t))return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[f,this,t,h]),h.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var m=e.param(f,u);g&&(m=m?m+"&"+g:g),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+m,t.data=null):t.data=m;var x=[];if(t.resetForm&&x.push(function(){d.resetForm()}),t.clearForm&&x.push(function(){d.clearForm(t.includeHidden)}),!t.dataType&&t.target){var v=t.success||function(){};x.push(function(i){var n=t.replaceTarget?"replaceWith":"html";e(t.target)[n](i).each(v,arguments)})}else t.success&&x.push(t.success);if(t.success=function(e,i,n){for(var a=t.context||this,o=0,s=x.length;s>o;o++)x[o].apply(a,[e,i,n||d,d])},t.error){var _=t.error;t.error=function(e,i,n){var a=t.context||this;_.apply(a,[e,i,n,d])}}if(t.complete){var b=t.complete;t.complete=function(e,i){var n=t.context||this;b.apply(n,[e,i,d])}}var y=e('input[type=file]:enabled[value!=""]',this),w=y.length>0,S="multipart/form-data",C=d.attr("enctype")==S||d.attr("encoding")==S,T=a.fileapi&&a.formdata;n("fileAPI :"+T);var V,A=(w||C)&&!T;!1!==t.iframe&&(t.iframe||A)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){V=s(f)}):V=s(f):V=(w||C)&&T?function(n){for(var a=new FormData,o=0;n.length>o;o++)a.append(n[o].name,n[o].value);if(t.extraData){var s=i(t.extraData);for(o=0;s.length>o;o++)s[o]&&a.append(s[o][0],s[o][1])}t.data=null;var l=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:r||"POST"});t.uploadProgress&&(l.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var i=0,n=e.loaded||e.position,a=e.total;e.lengthComputable&&(i=Math.ceil(n/a*100)),t.uploadProgress(e,n,a,i)},!1),e}),l.data=null;var c=l.beforeSend;return l.beforeSend=function(e,t){t.data=a,c&&c.call(this,e,t)},e.ajax(l)}(f):e.ajax(t),d.removeData("jqxhr").data("jqxhr",V);for(var P=0;p.length>P;P++)p[P]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(a){if(a=a||{},a.delegation=a.delegation&&e.isFunction(e.fn.on),!a.delegation&&0===this.length){var o={s:this.selector,c:this.context};return!e.isReady&&o.s?(n("DOM not ready, queuing ajaxForm"),e(function(){e(o.s,o.c).ajaxForm(a)}),this):(n("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return a.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,a,t).on("click.form-plugin",this.selector,a,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",a,t).bind("click.form-plugin",a,i)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,i){var n=[];if(0===this.length)return n;var o=this[0],s=t?o.getElementsByTagName("*"):o.elements;if(!s)return n;var r,l,c,d,h,u,g;for(r=0,u=s.length;u>r;r++)if(h=s[r],(c=h.name)&&!h.disabled)if(t&&o.clk&&"image"==h.type)o.clk==h&&(n.push({name:c,value:e(h).val(),type:h.type}),n.push({name:c+".x",value:o.clk_x},{name:c+".y",value:o.clk_y}));else if((d=e.fieldValue(h,!0))&&d.constructor==Array)for(i&&i.push(h),l=0,g=d.length;g>l;l++)n.push({name:c,value:d[l]});else if(a.fileapi&&"file"==h.type){i&&i.push(h);var p=h.files;if(p.length)for(l=0;p.length>l;l++)n.push({name:c,value:p[l],type:h.type});else n.push({name:c,value:"",type:h.type})}else null!==d&&void 0!==d&&(i&&i.push(h),n.push({name:c,value:d,type:h.type,required:h.required}));if(!t&&o.clk){var f=e(o.clk),m=f[0];(c=m.name)&&!m.disabled&&"image"==m.type&&(n.push({name:c,value:f.val()}),n.push({name:c+".x",value:o.clk_x},{name:c+".y",value:o.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var n=this.name;if(n){var a=e.fieldValue(this,t);if(a&&a.constructor==Array)for(var o=0,s=a.length;s>o;o++)i.push({name:n,value:a[o]});else null!==a&&void 0!==a&&i.push({name:this.name,value:a})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],n=0,a=this.length;a>n;n++){var o=this[n],s=e.fieldValue(o,t);null===s||void 0===s||s.constructor==Array&&!s.length||(s.constructor==Array?e.merge(i,s):i.push(s))}return i},e.fieldValue=function(t,i){var n=t.name,a=t.type,o=t.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||t.disabled||"reset"==a||"button"==a||("checkbox"==a||"radio"==a)&&!t.checked||("submit"==a||"image"==a)&&t.form&&t.form.clk!=t||"select"==o&&-1==t.selectedIndex))return null;if("select"==o){var s=t.selectedIndex;if(0>s)return null;for(var r=[],l=t.options,c="select-one"==a,d=c?s+1:l.length,h=c?s:0;d>h;h++){var u=l[h];if(u.selected){var g=u.value;if(g||(g=u.attributes&&u.attributes.value&&!u.attributes.value.specified?u.text:u.value),c)return g;r.push(g)}}return r}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,a=this.tagName.toLowerCase();i.test(n)||"textarea"==a?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==a?this.selectedIndex=-1:"file"==n?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(!0===t&&/hidden/.test(n)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==_typeof(this.reset)&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var n=e(this).parent("select");t&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(e){this.owner=e}function i(e){var t=this.internal=new n(this);t.loadConfig(e),t.beforeInit(e),t.init(),t.afterInit(e),function e(t,i,n){Object.keys(t).forEach(function(a){i[a]=t[a].bind(n),Object.keys(t[a]).length>0&&e(t[a],i[a],n)})}(s,this,this)}function n(t){var i=this;i.d3=e.d3?e.d3:"undefined"!=typeof require?require("d3"):void 0,i.api=t,i.config=i.getDefaultConfig(),i.data={},i.cache={},i.axes={}}function a(e){t.call(this,e)}function o(e,t){function i(e,t){e.attr("transform",function(e){return"translate("+Math.ceil(t(e)+b)+", 0)"})}function n(e,t){e.attr("transform",function(e){return"translate(0,"+Math.ceil(t(e))+")"})}function a(e){var t=e[0],i=e[e.length-1];return t<i?[t,i]:[i,t]}function o(e){var t,i,n=[];if(e.ticks)return e.ticks.apply(e,g);for(i=e.domain(),t=Math.ceil(i[0]);t<i[1];t++)n.push(t);return n.length>0&&n[0]>0&&n.unshift(n[0]-(n[1]-n[0])),n}function s(){var e,i=f.copy();return t.isCategory&&(e=f.domain(),i.domain([e[0],e[1]-1])),i}function r(e){var t=u?u(e):e;return void 0!==t?t:""}function l(e){if(C)return C;var t={h:11.5,w:5.5};return e.select("text").text(r).each(function(e){var i=this.getBoundingClientRect(),n=r(e),a=i.height,o=n?i.width/n.length:void 0;a&&o&&(t.h=a,t.w=o)}).text(""),C=t,t}function c(i){return t.withoutTransition?i:e.transition(i)}function d(u){u.each(function(){function u(e,i){function n(e,t){o=void 0;for(var r=1;r<t.length;r++)if(" "===t.charAt(r)&&(o=r),a=t.substr(0,r+1),s=W.w*a.length,i<s)return n(e.concat(t.substr(0,o||r)),t.slice(o?o+1:r));return e.concat(t)}var a,o,s,l=r(e),c=[];return"[object Array]"===Object.prototype.toString.call(l)?l:((!i||i<=0)&&(i=j?95:t.isCategory?Math.ceil(A(P[1])-A(P[0]))-12:110),n(c,l+""))}function g(e,t){var i=W.h;return 0===t&&(i="left"===m||"right"===m?-(($[e.index]-1)*(W.h/2)-3):".71em"),i}function y(e){var t=f(e)+(p?0:b);return M[0]<t&&t<M[1]?x:0}var w,S,C,T=d.g=e.select(this),V=this.__chart__||f,A=this.__chart__=s(),P=_||o(A),k=T.selectAll(".tick").data(P,A),L=k.enter().insert("g",".domain").attr("class","tick").style("opacity",1e-6),R=k.exit().remove(),I=c(k).style("opacity",1),M=f.rangeExtent?f.rangeExtent():a(f.range()),G=T.selectAll(".domain").data([0]),E=(G.enter().append("path").attr("class","domain"),c(G));L.append("line"),L.append("text");var O=L.select("line"),D=I.select("line"),B=L.select("text"),N=I.select("text");t.isCategory?(b=Math.ceil((A(1)-A(0))/2),S=p?0:b,C=p?b:0):b=S=0;var z,F,W=l(T.select(".tick")),$=[],X=Math.max(x,0)+v,j="left"===m||"right"===m;z=k.select("text"),F=z.selectAll("tspan").data(function(e,i){var n=t.tickMultiline?u(e,t.tickWidth):[].concat(r(e));return $[i]=n.length,n.map(function(e){return{index:i,splitted:e}})}),F.enter().append("tspan"),F.exit().remove(),F.text(function(e){return e.splitted});var H=t.tickTextRotate;switch(m){case"bottom":w=i,O.attr("y2",x),B.attr("y",X),D.attr("x1",S).attr("x2",S).attr("y2",y),N.attr("x",0).attr("y",function(e){return e?11.5-e/15*2.5*(e>0?1:-1):X}(H)).style("text-anchor",function(e){return e?e>0?"start":"end":"middle"}(H)).attr("transform",function(e){return e?"rotate("+e+")":""}(H)),F.attr("x",0).attr("dy",g).attr("dx",function(e){return e?8*Math.sin(Math.PI*(e/180)):0}(H)),E.attr("d","M"+M[0]+","+h+"V0H"+M[1]+"V"+h);break;case"top":w=i,O.attr("y2",-x),B.attr("y",-X),D.attr("x2",0).attr("y2",-x),N.attr("x",0).attr("y",-X),z.style("text-anchor","middle"),F.attr("x",0).attr("dy","0em"),E.attr("d","M"+M[0]+","+-h+"V0H"+M[1]+"V"+-h);break;case"left":w=n,O.attr("x2",-x),B.attr("x",-X),D.attr("x2",-x).attr("y1",C).attr("y2",C),N.attr("x",-X).attr("y",b),z.style("text-anchor","end"),F.attr("x",-X).attr("dy",g),E.attr("d","M"+-h+","+M[0]+"H0V"+M[1]+"H"+-h);break;case"right":w=n,O.attr("x2",x),B.attr("x",X),D.attr("x2",x).attr("y2",0),N.attr("x",X).attr("y",0),z.style("text-anchor","start"),F.attr("x",X).attr("dy",g),E.attr("d","M"+h+","+M[0]+"H0V"+M[1]+"H"+h)}if(A.rangeBand){var q=A,Y=q.rangeBand()/2;V=A=function(e){return q(e)+Y}}else V.rangeBand?V=A:R.call(w,A);L.call(w,V),I.call(w,A)})}var h,u,g,p,f=e.scale.linear(),m="bottom",x=6,v=3,_=null,b=0,y=!0;return t=t||{},h=t.withOuterTick?6:0,d.scale=function(e){return arguments.length?(f=e,d):f},d.orient=function(e){return arguments.length?(m=e in{top:1,right:1,bottom:1,left:1}?e+"":"bottom",d):m},d.tickFormat=function(e){return arguments.length?(u=e,d):u},d.tickCentered=function(e){return arguments.length?(p=e,d):p},d.tickOffset=function(){return b},d.tickInterval=function(){var e,i;return t.isCategory?e=2*b:(i=d.g.select("path.domain").node().getTotalLength()-2*h,e=i/d.g.selectAll("line").size()),e===1/0?0:e},d.ticks=function(){return arguments.length?(g=arguments,d):g},d.tickCulling=function(e){return arguments.length?(y=e,d):y},d.tickValues=function(e){if("function"==typeof e)_=function(){return e(f.domain())};else{if(!arguments.length)return _;_=e}return d},d}var s,r,l={version:"0.4.11"};l.generate=function(e){return new i(e)},l.chart={fn:i.prototype,internal:{fn:n.prototype,axis:{fn:a.prototype}}},s=l.chart.fn,r=l.chart.internal.fn,l.chart.internal.axis.fn,r.beforeInit=function(){},r.afterInit=function(){},r.init=function(){var e=this,t=e.config;if(e.initParams(),t.data_url)e.convertUrlToData(t.data_url,t.data_mimeType,t.data_headers,t.data_keys,e.initWithData);else if(t.data_json)e.initWithData(e.convertJsonToData(t.data_json,t.data_keys));else if(t.data_rows)e.initWithData(e.convertRowsToData(t.data_rows));else{if(!t.data_columns)throw Error("url or json or rows or columns is required.");e.initWithData(e.convertColumnsToData(t.data_columns))}},r.initParams=function(){var e=this,t=e.d3,i=e.config;e.clipId="c3-"+ +new Date+"-clip",e.clipIdForXAxis=e.clipId+"-xaxis",e.clipIdForYAxis=e.clipId+"-yaxis",e.clipIdForGrid=e.clipId+"-grid",e.clipIdForSubchart=e.clipId+"-subchart",e.clipPath=e.getClipPath(e.clipId),e.clipPathForXAxis=e.getClipPath(e.clipIdForXAxis),e.clipPathForYAxis=e.getClipPath(e.clipIdForYAxis),e.clipPathForGrid=e.getClipPath(e.clipIdForGrid),e.clipPathForSubchart=e.getClipPath(e.clipIdForSubchart),e.dragStart=null,e.dragging=!1,e.flowing=!1,e.cancelClick=!1,e.mouseover=!1,e.transiting=!1,e.color=e.generateColor(),e.levelColor=e.generateLevelColor(),e.dataTimeFormat=i.data_xLocaltime?t.time.format:t.time.format.utc,e.axisTimeFormat=i.axis_x_localtime?t.time.format:t.time.format.utc,e.defaultAxisTimeFormat=e.axisTimeFormat.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%-m/%-d",function(e){return e.getDay()&&1!==e.getDate()}],["%-m/%-d",function(e){return 1!==e.getDate()}],["%-m/%-d",function(e){return e.getMonth()}],["%Y/%-m/%-d",function(){return!0}]]),e.hiddenTargetIds=[],e.hiddenLegendIds=[],e.focusedTargetIds=[],e.defocusedTargetIds=[],e.xOrient=i.axis_rotated?"left":"bottom",e.yOrient=i.axis_rotated?i.axis_y_inner?"top":"bottom":i.axis_y_inner?"right":"left",e.y2Orient=i.axis_rotated?i.axis_y2_inner?"bottom":"top":i.axis_y2_inner?"left":"right",e.subXOrient=i.axis_rotated?"left":"bottom",e.isLegendRight="right"===i.legend_position,e.isLegendInset="inset"===i.legend_position,e.isLegendTop="top-left"===i.legend_inset_anchor||"top-right"===i.legend_inset_anchor,e.isLegendLeft="top-left"===i.legend_inset_anchor||"bottom-left"===i.legend_inset_anchor,e.legendStep=0,e.legendItemWidth=0,e.legendItemHeight=0,e.currentMaxTickWidths={x:0,y:0,y2:0},e.rotated_padding_left=30,e.rotated_padding_right=i.axis_rotated&&!i.axis_x_show?0:30,e.rotated_padding_top=5,e.withoutFadeIn={},e.intervalForObserveInserted=void 0,e.axes.subx=t.selectAll([])},r.initChartElements=function(){this.initBar&&this.initBar(),this.initLine&&this.initLine(),this.initArc&&this.initArc(),this.initGauge&&this.initGauge(),this.initText&&this.initText()},r.initWithData=function(e){var t,i,n=this,o=n.d3,s=n.config,r=!0;n.axis=new a(n),n.initPie&&n.initPie(),n.initBrush&&n.initBrush(),n.initZoom&&n.initZoom(),s.bindto?"function"==typeof s.bindto.node?n.selectChart=s.bindto:n.selectChart=o.select(s.bindto):n.selectChart=o.selectAll([]),n.selectChart.empty()&&(n.selectChart=o.select(document.createElement("div")).style("opacity",0),n.observeInserted(n.selectChart),r=!1),n.selectChart.html("").classed("c3",!0),n.data.xs={},n.data.targets=n.convertDataToTargets(e),s.data_filter&&(n.data.targets=n.data.targets.filter(s.data_filter)),s.data_hide&&n.addHiddenTargetIds(!0===s.data_hide?n.mapToIds(n.data.targets):s.data_hide),s.legend_hide&&n.addHiddenLegendIds(!0===s.legend_hide?n.mapToIds(n.data.targets):s.legend_hide),n.hasType("gauge")&&(s.legend_show=!1),n.updateSizes(),n.updateScales(),n.x.domain(o.extent(n.getXDomain(n.data.targets))),n.y.domain(n.getYDomain(n.data.targets,"y")),n.y2.domain(n.getYDomain(n.data.targets,"y2")),n.subX.domain(n.x.domain()),n.subY.domain(n.y.domain()),n.subY2.domain(n.y2.domain()),n.orgXDomain=n.x.domain(),n.brush&&n.brush.scale(n.subX),s.zoom_enabled&&n.zoom.scale(n.x),
n.svg=n.selectChart.append("svg").style("overflow","hidden").on("mouseenter",function(){return s.onmouseover.call(n)}).on("mouseleave",function(){return s.onmouseout.call(n)}),n.config.svg_classname&&n.svg.attr("class",n.config.svg_classname),t=n.svg.append("defs"),n.clipChart=n.appendClip(t,n.clipId),n.clipXAxis=n.appendClip(t,n.clipIdForXAxis),n.clipYAxis=n.appendClip(t,n.clipIdForYAxis),n.clipGrid=n.appendClip(t,n.clipIdForGrid),n.clipSubchart=n.appendClip(t,n.clipIdForSubchart),n.updateSvgSize(),i=n.main=n.svg.append("g").attr("transform",n.getTranslate("main")),n.initSubchart&&n.initSubchart(),n.initTooltip&&n.initTooltip(),n.initLegend&&n.initLegend(),n.initTitle&&n.initTitle(),i.append("text").attr("class",c.text+" "+c.empty).attr("text-anchor","middle").attr("dominant-baseline","middle"),n.initRegion(),n.initGrid(),i.append("g").attr("clip-path",n.clipPath).attr("class",c.chart),s.grid_lines_front&&n.initGridLines(),n.initEventRect(),n.initChartElements(),i.insert("rect",s.zoom_privileged?null:"g."+c.regions).attr("class",c.zoomRect).attr("width",n.width).attr("height",n.height).style("opacity",0).on("dblclick.zoom",null),s.axis_x_extent&&n.brush.extent(n.getDefaultExtent()),n.axis.init(),n.updateTargets(n.data.targets),r&&(n.updateDimension(),n.config.oninit.call(n),n.redraw({withTransition:!1,withTransform:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withTransitionForAxis:!1})),n.bindResize(),n.api.element=n.selectChart.node()},r.smoothLines=function(e,t){var i=this;"grid"===t&&e.each(function(){var e=i.d3.select(this),t=e.attr("x1"),n=e.attr("x2"),a=e.attr("y1"),o=e.attr("y2");e.attr({x1:Math.ceil(t),x2:Math.ceil(n),y1:Math.ceil(a),y2:Math.ceil(o)})})},r.updateSizes=function(){var e=this,t=e.config,i=e.legend?e.getLegendHeight():0,n=e.legend?e.getLegendWidth():0,a=e.isLegendRight||e.isLegendInset?0:i,o=e.hasArcType(),s=t.axis_rotated||o?0:e.getHorizontalAxisHeight("x"),r=t.subchart_show&&!o?t.subchart_size_height+s:0;e.currentWidth=e.getCurrentWidth(),e.currentHeight=e.getCurrentHeight(),e.margin=t.axis_rotated?{top:e.getHorizontalAxisHeight("y2")+e.getCurrentPaddingTop(),right:o?0:e.getCurrentPaddingRight(),bottom:e.getHorizontalAxisHeight("y")+a+e.getCurrentPaddingBottom(),left:r+(o?0:e.getCurrentPaddingLeft())}:{top:4+e.getCurrentPaddingTop(),right:o?0:e.getCurrentPaddingRight(),bottom:s+r+a+e.getCurrentPaddingBottom(),left:o?0:e.getCurrentPaddingLeft()},e.margin2=t.axis_rotated?{top:e.margin.top,right:NaN,bottom:20+a,left:e.rotated_padding_left}:{top:e.currentHeight-r-a,right:NaN,bottom:s+a,left:e.margin.left},e.margin3={top:0,right:NaN,bottom:0,left:0},e.updateSizeForLegend&&e.updateSizeForLegend(i,n),e.width=e.currentWidth-e.margin.left-e.margin.right,e.height=e.currentHeight-e.margin.top-e.margin.bottom,e.width<0&&(e.width=0),e.height<0&&(e.height=0),e.width2=t.axis_rotated?e.margin.left-e.rotated_padding_left-e.rotated_padding_right:e.width,e.height2=t.axis_rotated?e.height:e.currentHeight-e.margin2.top-e.margin2.bottom,e.width2<0&&(e.width2=0),e.height2<0&&(e.height2=0),e.arcWidth=e.width-(e.isLegendRight?n+10:0),e.arcHeight=e.height-(e.isLegendRight?0:10),e.hasType("gauge")&&!t.gauge_fullCircle&&(e.arcHeight+=e.height-e.getGaugeLabelHeight()),e.updateRadius&&e.updateRadius(),e.isLegendRight&&o&&(e.margin3.left=e.arcWidth/2+1.1*e.radiusExpanded)},r.updateTargets=function(e){var t=this;t.updateTargetsForText(e),t.updateTargetsForBar(e),t.updateTargetsForLine(e),t.hasArcType()&&t.updateTargetsForArc&&t.updateTargetsForArc(e),t.updateTargetsForSubchart&&t.updateTargetsForSubchart(e),t.showTargets()},r.showTargets=function(){var e=this;e.svg.selectAll("."+c.target).filter(function(t){return e.isTargetToShow(t.id)}).transition().duration(e.config.transition_duration).style("opacity",1)},r.redraw=function(e,t){var i,n,a,o,s,r,l,d,h,u,g,p,f,m,x,v,_,y,w,S,C,T,V,A,P,k,L,R,I,M=this,G=M.main,E=M.d3,O=M.config,D=M.getShapeIndices(M.isAreaType),B=M.getShapeIndices(M.isBarType),N=M.getShapeIndices(M.isLineType),z=M.hasArcType(),F=M.filterTargetsToShow(M.data.targets),W=M.xv.bind(M);if(e=e||{},i=b(e,"withY",!0),n=b(e,"withSubchart",!0),a=b(e,"withTransition",!0),r=b(e,"withTransform",!1),l=b(e,"withUpdateXDomain",!1),d=b(e,"withUpdateOrgXDomain",!1),h=b(e,"withTrimXDomain",!0),f=b(e,"withUpdateXAxis",l),u=b(e,"withLegend",!1),g=b(e,"withEventRect",!0),p=b(e,"withDimension",!0),o=b(e,"withTransitionForExit",a),s=b(e,"withTransitionForAxis",a),w=a?O.transition_duration:0,S=o?w:0,C=s?w:0,t=t||M.axis.generateTransitions(C),u&&O.legend_show?M.updateLegend(M.mapToIds(M.data.targets),e,t):p&&M.updateDimension(!0),M.isCategorized()&&0===F.length&&M.x.domain([0,M.axes.x.selectAll(".tick").size()]),F.length?(M.updateXDomain(F,l,d,h),O.axis_x_tick_values||(A=M.axis.updateXAxisTickValues(F))):(M.xAxis.tickValues([]),M.subXAxis.tickValues([])),O.zoom_rescale&&!e.flow&&(L=M.x.orgDomain()),M.y.domain(M.getYDomain(F,"y",L)),M.y2.domain(M.getYDomain(F,"y2",L)),!O.axis_y_tick_values&&O.axis_y_tick_count&&M.yAxis.tickValues(M.axis.generateTickValues(M.y.domain(),O.axis_y_tick_count)),!O.axis_y2_tick_values&&O.axis_y2_tick_count&&M.y2Axis.tickValues(M.axis.generateTickValues(M.y2.domain(),O.axis_y2_tick_count)),M.axis.redraw(t,z),M.axis.updateLabels(a),(l||f)&&F.length)if(O.axis_x_tick_culling&&A){for(P=1;P<A.length;P++)if(A.length/P<O.axis_x_tick_culling_max){k=P;break}M.svg.selectAll("."+c.axisX+" .tick text").each(function(e){var t=A.indexOf(e);t>=0&&E.select(this).style("display",t%k?"none":"block")})}else M.svg.selectAll("."+c.axisX+" .tick text").style("display","block");m=M.generateDrawArea?M.generateDrawArea(D,!1):void 0,x=M.generateDrawBar?M.generateDrawBar(B):void 0,v=M.generateDrawLine?M.generateDrawLine(N,!1):void 0,_=M.generateXYForText(D,B,N,!0),y=M.generateXYForText(D,B,N,!1),i&&(M.subY.domain(M.getYDomain(F,"y")),M.subY2.domain(M.getYDomain(F,"y2"))),M.updateXgridFocus(),G.select("text."+c.text+"."+c.empty).attr("x",M.width/2).attr("y",M.height/2).text(O.data_empty_label_text).transition().style("opacity",F.length?0:1),M.updateGrid(w),M.updateRegion(w),M.updateBar(S),M.updateLine(S),M.updateArea(S),M.updateCircle(),M.hasDataLabel()&&M.updateText(S),M.redrawTitle&&M.redrawTitle(),M.redrawArc&&M.redrawArc(w,S,r),M.redrawSubchart&&M.redrawSubchart(n,t,w,S,D,B,N),G.selectAll("."+c.selectedCircles).filter(M.isBarType.bind(M)).selectAll("circle").remove(),O.interaction_enabled&&!e.flow&&g&&(M.redrawEventRect(),M.updateZoom&&M.updateZoom()),M.updateCircleY(),R=(M.config.axis_rotated?M.circleY:M.circleX).bind(M),I=(M.config.axis_rotated?M.circleX:M.circleY).bind(M),e.flow&&(V=M.generateFlow({targets:F,flow:e.flow,duration:e.flow.duration,drawBar:x,drawLine:v,drawArea:m,cx:R,cy:I,xv:W,xForText:_,yForText:y})),(w||V)&&M.isTabVisible()?E.transition().duration(w).each(function(){var t=[];[M.redrawBar(x,!0),M.redrawLine(v,!0),M.redrawArea(m,!0),M.redrawCircle(R,I,!0),M.redrawText(_,y,e.flow,!0),M.redrawRegion(!0),M.redrawGrid(!0)].forEach(function(e){e.forEach(function(e){t.push(e)})}),T=M.generateWait(),t.forEach(function(e){T.add(e)})}).call(T,function(){V&&V(),O.onrendered&&O.onrendered.call(M)}):(M.redrawBar(x),M.redrawLine(v),M.redrawArea(m),M.redrawCircle(R,I),M.redrawText(_,y,e.flow),M.redrawRegion(),M.redrawGrid(),O.onrendered&&O.onrendered.call(M)),M.mapToIds(M.data.targets).forEach(function(e){M.withoutFadeIn[e]=!0})},r.updateAndRedraw=function(e){var t,i=this,n=i.config;e=e||{},e.withTransition=b(e,"withTransition",!0),e.withTransform=b(e,"withTransform",!1),e.withLegend=b(e,"withLegend",!1),e.withUpdateXDomain=!0,e.withUpdateOrgXDomain=!0,e.withTransitionForExit=!1,e.withTransitionForTransform=b(e,"withTransitionForTransform",e.withTransition),i.updateSizes(),e.withLegend&&n.legend_show||(t=i.axis.generateTransitions(e.withTransitionForAxis?n.transition_duration:0),i.updateScales(),i.updateSvgSize(),i.transformAll(e.withTransitionForTransform,t)),i.redraw(e,t)},r.redrawWithoutRescale=function(){this.redraw({withY:!1,withSubchart:!1,withEventRect:!1,withTransitionForAxis:!1})},r.isTimeSeries=function(){return"timeseries"===this.config.axis_x_type},r.isCategorized=function(){return this.config.axis_x_type.indexOf("categor")>=0},r.isCustomX=function(){var e=this,t=e.config;return!e.isTimeSeries()&&(t.data_x||_(t.data_xs))},r.isTimeSeriesY=function(){return"timeseries"===this.config.axis_y_type},r.getTranslate=function(e){var t,i,n=this,a=n.config;return"main"===e?(t=m(n.margin.left),i=m(n.margin.top)):"context"===e?(t=m(n.margin2.left),i=m(n.margin2.top)):"legend"===e?(t=n.margin3.left,i=n.margin3.top):"x"===e?(t=0,i=a.axis_rotated?0:n.height):"y"===e?(t=0,i=a.axis_rotated?n.height:0):"y2"===e?(t=a.axis_rotated?0:n.width,i=a.axis_rotated?1:0):"subx"===e?(t=0,i=a.axis_rotated?0:n.height2):"arc"===e&&(t=n.arcWidth/2,i=n.arcHeight/2),"translate("+t+","+i+")"},r.initialOpacity=function(e){return null!==e.value&&this.withoutFadeIn[e.id]?1:0},r.initialOpacityForCircle=function(e){return null!==e.value&&this.withoutFadeIn[e.id]?this.opacityForCircle(e):0},r.opacityForCircle=function(e){var t=this.config.point_show?1:0;return d(e.value)?this.isScatterType(e)?.5:t:0},r.opacityForText=function(){return this.hasDataLabel()?1:0},r.xx=function(e){return e?this.x(e.x):null},r.xv=function(e){var t=this,i=e.value;return t.isTimeSeries()?i=t.parseDate(e.value):t.isCategorized()&&"string"==typeof e.value&&(i=t.config.axis_x_categories.indexOf(e.value)),Math.ceil(t.x(i))},r.yv=function(e){var t=this,i=e.axis&&"y2"===e.axis?t.y2:t.y;return Math.ceil(i(e.value))},r.subxx=function(e){return e?this.subX(e.x):null},r.transformMain=function(e,t){var i,n,a,o=this;t&&t.axisX?i=t.axisX:(i=o.main.select("."+c.axisX),e&&(i=i.transition())),t&&t.axisY?n=t.axisY:(n=o.main.select("."+c.axisY),e&&(n=n.transition())),t&&t.axisY2?a=t.axisY2:(a=o.main.select("."+c.axisY2),e&&(a=a.transition())),(e?o.main.transition():o.main).attr("transform",o.getTranslate("main")),i.attr("transform",o.getTranslate("x")),n.attr("transform",o.getTranslate("y")),a.attr("transform",o.getTranslate("y2")),o.main.select("."+c.chartArcs).attr("transform",o.getTranslate("arc"))},r.transformAll=function(e,t){var i=this;i.transformMain(e,t),i.config.subchart_show&&i.transformContext(e,t),i.legend&&i.transformLegend(e)},r.updateSvgSize=function(){var e=this,t=e.svg.select(".c3-brush .background");e.svg.attr("width",e.currentWidth).attr("height",e.currentHeight),e.svg.selectAll(["#"+e.clipId,"#"+e.clipIdForGrid]).select("rect").attr("width",e.width).attr("height",e.height),e.svg.select("#"+e.clipIdForXAxis).select("rect").attr("x",e.getXAxisClipX.bind(e)).attr("y",e.getXAxisClipY.bind(e)).attr("width",e.getXAxisClipWidth.bind(e)).attr("height",e.getXAxisClipHeight.bind(e)),e.svg.select("#"+e.clipIdForYAxis).select("rect").attr("x",e.getYAxisClipX.bind(e)).attr("y",e.getYAxisClipY.bind(e)).attr("width",e.getYAxisClipWidth.bind(e)).attr("height",e.getYAxisClipHeight.bind(e)),e.svg.select("#"+e.clipIdForSubchart).select("rect").attr("width",e.width).attr("height",t.size()?t.attr("height"):0),e.svg.select("."+c.zoomRect).attr("width",e.width).attr("height",e.height),e.selectChart.style("max-height",e.currentHeight+"px")},r.updateDimension=function(e){var t=this;e||(t.config.axis_rotated?(t.axes.x.call(t.xAxis),t.axes.subx.call(t.subXAxis)):(t.axes.y.call(t.yAxis),t.axes.y2.call(t.y2Axis))),t.updateSizes(),t.updateScales(),t.updateSvgSize(),t.transformAll(!1)},r.observeInserted=function(t){var i,n=this;if("undefined"==typeof MutationObserver)return void e.console.error("MutationObserver not defined.");i=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&a.previousSibling&&(i.disconnect(),n.intervalForObserveInserted=e.setInterval(function(){t.node().parentNode&&(e.clearInterval(n.intervalForObserveInserted),n.updateDimension(),n.brush&&n.brush.update(),n.config.oninit.call(n),n.redraw({withTransform:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withTransition:!1,withTransitionForTransform:!1,withLegend:!0}),t.transition().style("opacity",1))},10))})}),i.observe(t.node(),{attributes:!0,childList:!0,characterData:!0})},r.bindResize=function(){var t=this,i=t.config;if(t.resizeFunction=t.generateResize(),t.resizeFunction.add(function(){i.onresize.call(t)}),i.resize_auto&&t.resizeFunction.add(function(){void 0!==t.resizeTimeout&&e.clearTimeout(t.resizeTimeout),t.resizeTimeout=e.setTimeout(function(){delete t.resizeTimeout,t.api.flush()},100)}),t.resizeFunction.add(function(){i.onresized.call(t)}),e.attachEvent)e.attachEvent("onresize",t.resizeFunction);else if(e.addEventListener)e.addEventListener("resize",t.resizeFunction,!1);else{var n=e.onresize;n?n.add&&n.remove||(n=t.generateResize(),n.add(e.onresize)):n=t.generateResize(),n.add(t.resizeFunction),e.onresize=n}},r.generateResize=function(){function e(){t.forEach(function(e){e()})}var t=[];return e.add=function(e){t.push(e)},e.remove=function(e){for(var i=0;i<t.length;i++)if(t[i]===e){t.splice(i,1);break}},e},r.endall=function(e,t){var i=0;e.each(function(){++i}).each("end",function(){--i||t.apply(this,arguments)})},r.generateWait=function(){var e=[],t=function(t,i){var n=setInterval(function(){var t=0;e.forEach(function(e){if(e.empty())return void(t+=1);try{e.transition()}catch(e){t+=1}}),t===e.length&&(clearInterval(n),i&&i())},10)};return t.add=function(t){e.push(t)},t},r.parseDate=function(t){var i,n=this;return t instanceof Date?i=t:"string"==typeof t?i=n.dataTimeFormat(n.config.data_xFormat).parse(t):"number"!=typeof t||isNaN(t)||(i=new Date(+t)),i&&!isNaN(+i)||e.console.error("Failed to parse x '"+t+"' to Date object"),i},r.isTabVisible=function(){var e;return void 0!==document.hidden?e="hidden":void 0!==document.mozHidden?e="mozHidden":void 0!==document.msHidden?e="msHidden":void 0!==document.webkitHidden&&(e="webkitHidden"),!document[e]},r.getDefaultConfig=function(){var e={bindto:"#chart",svg_classname:void 0,size_width:void 0,size_height:void 0,padding_left:void 0,padding_right:void 0,padding_top:void 0,padding_bottom:void 0,resize_auto:!0,zoom_enabled:!1,zoom_extent:void 0,zoom_privileged:!1,zoom_rescale:!1,zoom_onzoom:function(){},zoom_onzoomstart:function(){},zoom_onzoomend:function(){},zoom_x_min:void 0,zoom_x_max:void 0,interaction_brighten:!0,interaction_enabled:!0,onmouseover:function(){},onmouseout:function(){},onresize:function(){},onresized:function(){},oninit:function(){},onrendered:function(){},transition_duration:350,data_x:void 0,data_xs:{},data_xFormat:"%Y-%m-%d",data_xLocaltime:!0,data_xSort:!0,data_idConverter:function(e){return e},data_names:{},data_classes:{},data_groups:[],data_axes:{},data_type:void 0,data_types:{},data_labels:{},data_order:"desc",data_regions:{},data_color:void 0,data_colors:{},data_hide:!1,data_filter:void 0,data_selection_enabled:!1,data_selection_grouped:!1,data_selection_isselectable:function(){return!0},data_selection_multiple:!0,data_selection_draggable:!1,data_onclick:function(){},data_onmouseover:function(){},data_onmouseout:function(){},data_onselected:function(){},data_onunselected:function(){},data_url:void 0,data_headers:void 0,data_json:void 0,data_rows:void 0,data_columns:void 0,data_mimeType:void 0,data_keys:void 0,data_empty_label_text:"",subchart_show:!1,subchart_size_height:60,subchart_axis_x_show:!0,subchart_onbrush:function(){},color_pattern:[],color_threshold:{},legend_show:!0,legend_hide:!1,legend_position:"bottom",legend_inset_anchor:"top-left",legend_inset_x:10,legend_inset_y:0,legend_inset_step:void 0,legend_item_onclick:void 0,legend_item_onmouseover:void 0,legend_item_onmouseout:void 0,legend_equally:!1,legend_padding:0,legend_item_tile_width:10,legend_item_tile_height:10,axis_rotated:!1,axis_x_show:!0,axis_x_type:"indexed",axis_x_localtime:!0,axis_x_categories:[],axis_x_tick_centered:!1,axis_x_tick_format:void 0,axis_x_tick_culling:{},axis_x_tick_culling_max:10,axis_x_tick_count:void 0,axis_x_tick_fit:!0,axis_x_tick_values:null,axis_x_tick_rotate:0,axis_x_tick_outer:!0,axis_x_tick_multiline:!0,axis_x_tick_width:null,axis_x_max:void 0,axis_x_min:void 0,axis_x_padding:{},axis_x_height:void 0,axis_x_extent:void 0,axis_x_label:{},axis_y_show:!0,axis_y_type:void 0,axis_y_max:void 0,axis_y_min:void 0,axis_y_inverted:!1,axis_y_center:void 0,axis_y_inner:void 0,axis_y_label:{},axis_y_tick_format:void 0,axis_y_tick_outer:!0,axis_y_tick_values:null,axis_y_tick_rotate:0,axis_y_tick_count:void 0,axis_y_tick_time_value:void 0,axis_y_tick_time_interval:void 0,axis_y_padding:{},axis_y_default:void 0,axis_y2_show:!1,axis_y2_max:void 0,axis_y2_min:void 0,axis_y2_inverted:!1,axis_y2_center:void 0,axis_y2_inner:void 0,axis_y2_label:{},axis_y2_tick_format:void 0,axis_y2_tick_outer:!0,axis_y2_tick_values:null,axis_y2_tick_count:void 0,axis_y2_padding:{},axis_y2_default:void 0,grid_x_show:!1,grid_x_type:"tick",grid_x_lines:[],grid_y_show:!1,grid_y_lines:[],grid_y_ticks:10,grid_focus_show:!0,grid_lines_front:!0,point_show:!0,point_r:2.5,point_sensitivity:10,point_focus_expand_enabled:!0,point_focus_expand_r:void 0,point_select_r:void 0,line_connectNull:!1,line_step_type:"step",bar_width:void 0,bar_width_ratio:.6,bar_width_max:void 0,bar_zerobased:!0,area_zerobased:!0,area_above:!1,pie_label_show:!0,pie_label_format:void 0,pie_label_threshold:.05,pie_label_ratio:void 0,pie_expand:{},pie_expand_duration:50,gauge_fullCircle:!1,gauge_label_show:!0,gauge_label_format:void 0,gauge_min:0,gauge_max:100,gauge_startingAngle:-1*Math.PI/2,gauge_units:void 0,gauge_width:void 0,gauge_expand:{},gauge_expand_duration:50,donut_label_show:!0,donut_label_format:void 0,donut_label_threshold:.05,donut_label_ratio:void 0,donut_width:void 0,donut_title:"",donut_expand:{},donut_expand_duration:50,spline_interpolation_type:"cardinal",regions:[],tooltip_show:!0,tooltip_grouped:!0,tooltip_format_title:void 0,tooltip_format_name:void 0,tooltip_format_value:void 0,tooltip_position:void 0,tooltip_contents:function(e,t,i,n){return this.getTooltipContent?this.getTooltipContent(e,t,i,n):""},tooltip_init_show:!1,tooltip_init_x:0,tooltip_init_position:{top:"0px",left:"50px"},tooltip_onshow:function(){},tooltip_onhide:function(){},title_text:void 0,title_padding:{top:0,right:0,bottom:0,left:0},title_position:"top-center"};return Object.keys(this.additionalConfig).forEach(function(t){e[t]=this.additionalConfig[t]},this),e},r.additionalConfig={},r.loadConfig=function(e){function t(){var e=n.shift();return e&&i&&"object"===(void 0===i?"undefined":_typeof(i))&&e in i?(i=i[e],t()):e?void 0:i}var i,n,a,o=this.config;Object.keys(o).forEach(function(s){i=e,n=s.split("_"),a=t(),p(a)&&(o[s]=a)})},r.getScale=function(e,t,i){return(i?this.d3.time.scale():this.d3.scale.linear()).range([e,t])},r.getX=function(e,t,i,n){var a,o=this,s=o.getScale(e,t,o.isTimeSeries()),r=i?s.domain(i):s;o.isCategorized()?(n=n||function(){return 0},s=function(e,t){var i=r(e)+n(e);return t?i:Math.ceil(i)}):s=function(e,t){var i=r(e);return t?i:Math.ceil(i)};for(a in r)s[a]=r[a];return s.orgDomain=function(){return r.domain()},o.isCategorized()&&(s.domain=function(e){return arguments.length?(r.domain(e),s):(e=this.orgDomain(),[e[0],e[1]+1])}),s},r.getY=function(e,t,i){var n=this.getScale(e,t,this.isTimeSeriesY());return i&&n.domain(i),n},r.getYScale=function(e){return"y2"===this.axis.getId(e)?this.y2:this.y},r.getSubYScale=function(e){return"y2"===this.axis.getId(e)?this.subY2:this.subY},r.updateScales=function(){var e=this,t=e.config,i=!e.x;e.xMin=t.axis_rotated?1:0,e.xMax=t.axis_rotated?e.height:e.width,e.yMin=t.axis_rotated?0:e.height,e.yMax=t.axis_rotated?e.width:1,e.subXMin=e.xMin,e.subXMax=e.xMax,e.subYMin=t.axis_rotated?0:e.height2,e.subYMax=t.axis_rotated?e.width2:1,e.x=e.getX(e.xMin,e.xMax,i?void 0:e.x.orgDomain(),function(){return e.xAxis.tickOffset()}),e.y=e.getY(e.yMin,e.yMax,i?t.axis_y_default:e.y.domain()),e.y2=e.getY(e.yMin,e.yMax,i?t.axis_y2_default:e.y2.domain()),e.subX=e.getX(e.xMin,e.xMax,e.orgXDomain,function(t){return t%1?0:e.subXAxis.tickOffset()}),e.subY=e.getY(e.subYMin,e.subYMax,i?t.axis_y_default:e.subY.domain()),e.subY2=e.getY(e.subYMin,e.subYMax,i?t.axis_y2_default:e.subY2.domain()),e.xAxisTickFormat=e.axis.getXAxisTickFormat(),e.xAxisTickValues=e.axis.getXAxisTickValues(),e.yAxisTickValues=e.axis.getYAxisTickValues(),e.y2AxisTickValues=e.axis.getY2AxisTickValues(),e.xAxis=e.axis.getXAxis(e.x,e.xOrient,e.xAxisTickFormat,e.xAxisTickValues,t.axis_x_tick_outer),e.subXAxis=e.axis.getXAxis(e.subX,e.subXOrient,e.xAxisTickFormat,e.xAxisTickValues,t.axis_x_tick_outer),e.yAxis=e.axis.getYAxis(e.y,e.yOrient,t.axis_y_tick_format,e.yAxisTickValues,t.axis_y_tick_outer),e.y2Axis=e.axis.getYAxis(e.y2,e.y2Orient,t.axis_y2_tick_format,e.y2AxisTickValues,t.axis_y2_tick_outer),i||(e.brush&&e.brush.scale(e.subX),t.zoom_enabled&&e.zoom.scale(e.x)),e.updateArc&&e.updateArc()},r.getYDomainMin=function(e){var t,i,n,a,o,s,r=this,l=r.config,c=r.mapToIds(e),d=r.getValuesAsIdKeyed(e);if(l.data_groups.length>0)for(s=r.hasNegativeValueInTargets(e),t=0;t<l.data_groups.length;t++)if(a=l.data_groups[t].filter(function(e){return c.indexOf(e)>=0}),0!==a.length)for(n=a[0],s&&d[n]&&d[n].forEach(function(e,t){d[n][t]=e<0?e:0}),i=1;i<a.length;i++)o=a[i],d[o]&&d[o].forEach(function(e,t){r.axis.getId(o)!==r.axis.getId(n)||!d[n]||s&&+e>0||(d[n][t]+=+e)});return r.d3.min(Object.keys(d).map(function(e){return r.d3.min(d[e])}))},r.getYDomainMax=function(e){var t,i,n,a,o,s,r=this,l=r.config,c=r.mapToIds(e),d=r.getValuesAsIdKeyed(e);if(l.data_groups.length>0)for(s=r.hasPositiveValueInTargets(e),t=0;t<l.data_groups.length;t++)if(a=l.data_groups[t].filter(function(e){return c.indexOf(e)>=0}),0!==a.length)for(n=a[0],s&&d[n]&&d[n].forEach(function(e,t){d[n][t]=e>0?e:0}),i=1;i<a.length;i++)o=a[i],d[o]&&d[o].forEach(function(e,t){r.axis.getId(o)!==r.axis.getId(n)||!d[n]||s&&+e<0||(d[n][t]+=+e)});return r.d3.max(Object.keys(d).map(function(e){return r.d3.max(d[e])}))},r.getYDomain=function(e,t,i){var n,a,o,s,r,l,c,h,u,g,p=this,f=p.config,m=e.filter(function(e){return p.axis.getId(e.id)===t}),v=i?p.filterByXDomain(m,i):m,b="y2"===t?f.axis_y2_min:f.axis_y_min,y="y2"===t?f.axis_y2_max:f.axis_y_max,w=p.getYDomainMin(v),S=p.getYDomainMax(v),C="y2"===t?f.axis_y2_center:f.axis_y_center,T=p.hasType("bar",v)&&f.bar_zerobased||p.hasType("area",v)&&f.area_zerobased,V="y2"===t?f.axis_y2_inverted:f.axis_y_inverted,A=p.hasDataLabel()&&f.axis_rotated,P=p.hasDataLabel()&&!f.axis_rotated;return w=d(b)?b:d(y)?w<y?w:y-10:w,S=d(y)?y:d(b)?b<S?S:b+10:S,0===v.length?"y2"===t?p.y2.domain():p.y.domain():(isNaN(w)&&(w=0),isNaN(S)&&(S=w),w===S&&(w<0?S=0:w=0),u=w>=0&&S>=0,g=w<=0&&S<=0,(d(b)&&u||d(y)&&g)&&(T=!1),T&&(u&&(w=0),g&&(S=0)),a=Math.abs(S-w),o=s=.1*a,void 0!==C&&(r=Math.max(Math.abs(w),Math.abs(S)),S=C+r,w=C-r),A?(l=p.getDataLabelLength(w,S,"width"),c=x(p.y.range()),h=[l[0]/c,l[1]/c],o+=a*(h[1]/(1-h[0]-h[1])),s+=a*(h[0]/(1-h[0]-h[1]))):P&&(l=p.getDataLabelLength(w,S,"height"),o+=p.axis.convertPixelsToAxisPadding(l[1],a),s+=p.axis.convertPixelsToAxisPadding(l[0],a)),"y"===t&&_(f.axis_y_padding)&&(o=p.axis.getPadding(f.axis_y_padding,"top",o,a),s=p.axis.getPadding(f.axis_y_padding,"bottom",s,a)),"y2"===t&&_(f.axis_y2_padding)&&(o=p.axis.getPadding(f.axis_y2_padding,"top",o,a),s=p.axis.getPadding(f.axis_y2_padding,"bottom",s,a)),T&&(u&&(s=w),g&&(o=-S)),n=[w-s,S+o],V?n.reverse():n)},r.getXDomainMin=function(e){var t=this,i=t.config;return p(i.axis_x_min)?t.isTimeSeries()?this.parseDate(i.axis_x_min):i.axis_x_min:t.d3.min(e,function(e){return t.d3.min(e.values,function(e){return e.x})})},r.getXDomainMax=function(e){var t=this,i=t.config;return p(i.axis_x_max)?t.isTimeSeries()?this.parseDate(i.axis_x_max):i.axis_x_max:t.d3.max(e,function(e){return t.d3.max(e.values,function(e){return e.x})})},r.getXDomainPadding=function(e){var t,i,n,a,o=this,s=o.config,r=e[1]-e[0];return o.isCategorized()?i=0:o.hasType("bar")?(t=o.getMaxDataCount(),i=t>1?r/(t-1)/2:.5):i=.01*r,"object"===_typeof(s.axis_x_padding)&&_(s.axis_x_padding)?(n=d(s.axis_x_padding.left)?s.axis_x_padding.left:i,a=d(s.axis_x_padding.right)?s.axis_x_padding.right:i):n=a="number"==typeof s.axis_x_padding?s.axis_x_padding:i,{left:n,right:a}},r.getXDomain=function(e){var t=this,i=[t.getXDomainMin(e),t.getXDomainMax(e)],n=i[0],a=i[1],o=t.getXDomainPadding(i),s=0,r=0;return n-a!=0||t.isCategorized()||(t.isTimeSeries()?(n=new Date(.5*n.getTime()),a=new Date(1.5*a.getTime())):(n=0===n?1:.5*n,a=0===a?-1:1.5*a)),(n||0===n)&&(s=t.isTimeSeries()?new Date(n.getTime()-o.left):n-o.left),(a||0===a)&&(r=t.isTimeSeries()?new Date(a.getTime()+o.right):a+o.right),[s,r]},r.updateXDomain=function(e,t,i,n,a){var o=this,s=o.config;return i&&(o.x.domain(a||o.d3.extent(o.getXDomain(e))),o.orgXDomain=o.x.domain(),s.zoom_enabled&&o.zoom.scale(o.x).updateScaleExtent(),o.subX.domain(o.x.domain()),o.brush&&o.brush.scale(o.subX)),t&&(o.x.domain(a||(!o.brush||o.brush.empty()?o.orgXDomain:o.brush.extent())),s.zoom_enabled&&o.zoom.scale(o.x).updateScaleExtent()),n&&o.x.domain(o.trimXDomain(o.x.orgDomain())),o.x.domain()},r.trimXDomain=function(e){var t=this.getZoomDomain(),i=t[0],n=t[1];return e[0]<=i&&(e[1]=+e[1]+(i-e[0]),e[0]=i),n<=e[1]&&(e[0]=+e[0]-(e[1]-n),e[1]=n),e},r.isX=function(e){var t=this,i=t.config;return i.data_x&&e===i.data_x||_(i.data_xs)&&y(i.data_xs,e)},r.isNotX=function(e){return!this.isX(e)},r.getXKey=function(e){var t=this,i=t.config;return i.data_x?i.data_x:_(i.data_xs)?i.data_xs[e]:null},r.getXValuesOfXKey=function(e,t){var i,n=this;return(t&&_(t)?n.mapToIds(t):[]).forEach(function(t){n.getXKey(t)===e&&(i=n.data.xs[t])}),i},r.getIndexByX=function(e){var t=this,i=t.filterByX(t.data.targets,e);return i.length?i[0].index:null},r.getXValue=function(e,t){var i=this;return e in i.data.xs&&i.data.xs[e]&&d(i.data.xs[e][t])?i.data.xs[e][t]:t},r.getOtherTargetXs=function(){var e=this,t=Object.keys(e.data.xs);return t.length?e.data.xs[t[0]]:null},r.getOtherTargetX=function(e){var t=this.getOtherTargetXs();return t&&e<t.length?t[e]:null},r.addXs=function(e){var t=this;Object.keys(e).forEach(function(i){t.config.data_xs[i]=e[i]})},r.hasMultipleX=function(e){return this.d3.set(Object.keys(e).map(function(t){return e[t]})).size()>1},r.isMultipleX=function(){return _(this.config.data_xs)||!this.config.data_xSort||this.hasType("scatter")},r.addName=function(e){var t,i=this;return e&&(t=i.config.data_names[e.id],e.name=void 0!==t?t:e.id),e},r.getValueOnIndex=function(e,t){var i=e.filter(function(e){return e.index===t});return i.length?i[0]:null},r.updateTargetX=function(e,t){var i=this;e.forEach(function(e){e.values.forEach(function(n,a){n.x=i.generateTargetX(t[a],e.id,a)}),i.data.xs[e.id]=t})},r.updateTargetXs=function(e,t){var i=this;e.forEach(function(e){t[e.id]&&i.updateTargetX([e],t[e.id])})},r.generateTargetX=function(e,t,i){var n=this;return n.isTimeSeries()?e?n.parseDate(e):n.parseDate(n.getXValue(t,i)):n.isCustomX()&&!n.isCategorized()?d(e)?+e:n.getXValue(t,i):i},r.cloneTarget=function(e){return{id:e.id,id_org:e.id_org,values:e.values.map(function(e){return{x:e.x,value:e.value,id:e.id}})}},r.updateXs=function(){var e=this;e.data.targets.length&&(e.xs=[],e.data.targets[0].values.forEach(function(t){e.xs[t.index]=t.x}))},r.getPrevX=function(e){var t=this.xs[e-1];return void 0!==t?t:null},r.getNextX=function(e){var t=this.xs[e+1];return void 0!==t?t:null},r.getMaxDataCount=function(){var e=this;return e.d3.max(e.data.targets,function(e){return e.values.length})},r.getMaxDataCountTarget=function(e){var t,i=e.length,n=0;return i>1?e.forEach(function(e){e.values.length>n&&(t=e,n=e.values.length)}):t=i?e[0]:null,t},r.getEdgeX=function(e){var t=this;return e.length?[t.d3.min(e,function(e){return e.values[0].x}),t.d3.max(e,function(e){return e.values[e.values.length-1].x})]:[0,0]},r.mapToIds=function(e){return e.map(function(e){return e.id})},r.mapToTargetIds=function(e){var t=this;return e?[].concat(e):t.mapToIds(t.data.targets)},r.hasTarget=function(e,t){var i,n=this.mapToIds(e);for(i=0;i<n.length;i++)if(n[i]===t)return!0;return!1},r.isTargetToShow=function(e){return this.hiddenTargetIds.indexOf(e)<0},r.isLegendToShow=function(e){return this.hiddenLegendIds.indexOf(e)<0},r.filterTargetsToShow=function(e){var t=this;return e.filter(function(e){return t.isTargetToShow(e.id)})},r.mapTargetsToUniqueXs=function(e){var t=this,i=t.d3.set(t.d3.merge(e.map(function(e){return e.values.map(function(e){return+e.x})}))).values();return i=t.isTimeSeries()?i.map(function(e){return new Date(+e)}):i.map(function(e){return+e}),i.sort(function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN})},r.addHiddenTargetIds=function(e){this.hiddenTargetIds=this.hiddenTargetIds.concat(e)},r.removeHiddenTargetIds=function(e){this.hiddenTargetIds=this.hiddenTargetIds.filter(function(t){return e.indexOf(t)<0})},r.addHiddenLegendIds=function(e){this.hiddenLegendIds=this.hiddenLegendIds.concat(e)},r.removeHiddenLegendIds=function(e){this.hiddenLegendIds=this.hiddenLegendIds.filter(function(t){return e.indexOf(t)<0})},r.getValuesAsIdKeyed=function(e){var t={};return e.forEach(function(e){t[e.id]=[],e.values.forEach(function(i){t[e.id].push(i.value)})}),t},r.checkValueInTargets=function(e,t){var i,n,a,o=Object.keys(e);for(i=0;i<o.length;i++)for(a=e[o[i]].values,n=0;n<a.length;n++)if(t(a[n].value))return!0;return!1},r.hasNegativeValueInTargets=function(e){return this.checkValueInTargets(e,function(e){return e<0})},r.hasPositiveValueInTargets=function(e){return this.checkValueInTargets(e,function(e){return e>0})},r.isOrderDesc=function(){var e=this.config;return"string"==typeof e.data_order&&"desc"===e.data_order.toLowerCase()},r.isOrderAsc=function(){var e=this.config;return"string"==typeof e.data_order&&"asc"===e.data_order.toLowerCase()},r.orderTargets=function(e){var t=this,i=t.config,n=t.isOrderAsc(),a=t.isOrderDesc();return n||a?e.sort(function(e,t){var i=function(e,t){return e+Math.abs(t.value)},a=e.values.reduce(i,0),o=t.values.reduce(i,0);return n?o-a:a-o}):h(i.data_order)&&e.sort(i.data_order),e},r.filterByX=function(e,t){return this.d3.merge(e.map(function(e){return e.values})).filter(function(e){return e.x-t==0})},r.filterRemoveNull=function(e){return e.filter(function(e){return d(e.value)})},r.filterByXDomain=function(e,t){return e.map(function(e){return{id:e.id,id_org:e.id_org,values:e.values.filter(function(e){return t[0]<=e.x&&e.x<=t[1]})}})},r.hasDataLabel=function(){var e=this.config;return!("boolean"!=typeof e.data_labels||!e.data_labels)||!("object"!==_typeof(e.data_labels)||!_(e.data_labels))},r.getDataLabelLength=function(e,t,i){var n=this,a=[0,0];return n.selectChart.select("svg").selectAll(".dummy").data([e,t]).enter().append("text").text(function(e){return n.dataLabelFormat(e.id)(e)}).each(function(e,t){a[t]=1.3*this.getBoundingClientRect()[i]}).remove(),a},r.isNoneArc=function(e){return this.hasTarget(this.data.targets,e.id)},r.isArc=function(e){return"data"in e&&this.hasTarget(this.data.targets,e.data.id)},r.findSameXOfValues=function(e,t){var i,n=e[t].x,a=[];for(i=t-1;i>=0&&n===e[i].x;i--)a.push(e[i]);for(i=t;i<e.length&&n===e[i].x;i++)a.push(e[i]);return a},r.findClosestFromTargets=function(e,t){var i,n=this;return i=e.map(function(e){return n.findClosest(e.values,t)}),n.findClosest(i,t)},r.findClosest=function(e,t){var i,n=this,a=n.config.point_sensitivity;return e.filter(function(e){return e&&n.isBarType(e.id)}).forEach(function(e){var t=n.main.select("."+c.bars+n.getTargetSelectorSuffix(e.id)+" ."+c.bar+"-"+e.index).node();!i&&n.isWithinBar(t)&&(i=e)}),e.filter(function(e){return e&&!n.isBarType(e.id)}).forEach(function(e){var o=n.dist(e,t);o<a&&(a=o,i=e)}),i},r.dist=function(e,t){var i=this,n=i.config,a=n.axis_rotated?1:0,o=n.axis_rotated?0:1,s=i.circleY(e,e.index),r=i.x(e.x);return Math.sqrt(Math.pow(r-t[a],2)+Math.pow(s-t[o],2))},r.convertValuesToStep=function(e){var t,i=[].concat(e);if(!this.isCategorized())return e;for(t=e.length+1;0<t;t--)i[t]=i[t-1];return i[0]={x:i[0].x-1,value:i[0].value,id:i[0].id},i[e.length+1]={x:i[e.length].x+1,value:i[e.length].value,id:i[e.length].id},i},r.updateDataAttributes=function(e,t){
var i=this,n=i.config,a=n["data_"+e];return void 0===t?a:(Object.keys(t).forEach(function(e){a[e]=t[e]}),i.redraw({withLegend:!0}),a)},r.convertUrlToData=function(e,t,i,n,a){var o=this,s=t||"csv",r=o.d3.xhr(e);i&&Object.keys(i).forEach(function(e){r.header(e,i[e])}),r.get(function(e,t){var i;if(!t)throw new Error(e.responseURL+" "+e.status+" ("+e.statusText+")");i="json"===s?o.convertJsonToData(JSON.parse(t.response),n):"tsv"===s?o.convertTsvToData(t.response):o.convertCsvToData(t.response),a.call(o,i)})},r.convertXsvToData=function(e,t){var i,n=t.parseRows(e);return 1===n.length?(i=[{}],n[0].forEach(function(e){i[0][e]=null})):i=t.parse(e),i},r.convertCsvToData=function(e){return this.convertXsvToData(e,this.d3.csv)},r.convertTsvToData=function(e){return this.convertXsvToData(e,this.d3.tsv)},r.convertJsonToData=function(e,t){var i,n,a=this,o=[];return t?(t.x?(i=t.value.concat(t.x),a.config.data_x=t.x):i=t.value,o.push(i),e.forEach(function(e){var t=[];i.forEach(function(i){var n=a.findValueInJson(e,i);g(n)&&(n=null),t.push(n)}),o.push(t)}),n=a.convertRowsToData(o)):(Object.keys(e).forEach(function(t){o.push([t].concat(e[t]))}),n=a.convertColumnsToData(o)),n},r.findValueInJson=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");for(var i=t.split("."),n=0;n<i.length;++n){var a=i[n];if(!(a in e))return;e=e[a]}return e},r.convertRowsToData=function(e){var t,i,n=e[0],a={},o=[];for(t=1;t<e.length;t++){for(a={},i=0;i<e[t].length;i++){if(g(e[t][i]))throw new Error("Source data is missing a component at ("+t+","+i+")!");a[n[i]]=e[t][i]}o.push(a)}return o},r.convertColumnsToData=function(e){var t,i,n,a=[];for(t=0;t<e.length;t++)for(n=e[t][0],i=1;i<e[t].length;i++){if(g(a[i-1])&&(a[i-1]={}),g(e[t][i]))throw new Error("Source data is missing a component at ("+t+","+i+")!");a[i-1][n]=e[t][i]}return a},r.convertDataToTargets=function(e,t){var i,n=this,a=n.config,o=n.d3.keys(e[0]).filter(n.isNotX,n),s=n.d3.keys(e[0]).filter(n.isX,n);return o.forEach(function(i){var o=n.getXKey(i);n.isCustomX()||n.isTimeSeries()?s.indexOf(o)>=0?n.data.xs[i]=(t&&n.data.xs[i]?n.data.xs[i]:[]).concat(e.map(function(e){return e[o]}).filter(d).map(function(e,t){return n.generateTargetX(e,i,t)})):a.data_x?n.data.xs[i]=n.getOtherTargetXs():_(a.data_xs)&&(n.data.xs[i]=n.getXValuesOfXKey(o,n.data.targets)):n.data.xs[i]=e.map(function(e,t){return t})}),o.forEach(function(e){if(!n.data.xs[e])throw new Error('x is not defined for id = "'+e+'".')}),i=o.map(function(t,i){var o=a.data_idConverter(t);return{id:o,id_org:t,values:e.map(function(e,s){var r,l=n.getXKey(t),c=e[l],d=null===e[t]||isNaN(e[t])?null:+e[t];return n.isCustomX()&&n.isCategorized()&&0===i&&!g(c)?(0===i&&0===s&&(a.axis_x_categories=[]),-1===(r=a.axis_x_categories.indexOf(c))&&(r=a.axis_x_categories.length,a.axis_x_categories.push(c))):r=n.generateTargetX(c,t,s),(g(e[t])||n.data.xs[t].length<=s)&&(r=void 0),{x:r,value:d,id:o}}).filter(function(e){return p(e.x)})}}),i.forEach(function(e){var t;a.data_xSort&&(e.values=e.values.sort(function(e,t){return(e.x||0===e.x?e.x:1/0)-(t.x||0===t.x?t.x:1/0)})),t=0,e.values.forEach(function(e){e.index=t++}),n.data.xs[e.id].sort(function(e,t){return e-t})}),n.hasNegativeValue=n.hasNegativeValueInTargets(i),n.hasPositiveValue=n.hasPositiveValueInTargets(i),a.data_type&&n.setTargetType(n.mapToIds(i).filter(function(e){return!(e in a.data_types)}),a.data_type),i.forEach(function(e){n.addCache(e.id_org,e)}),i},r.load=function(e,t){var i=this;e&&(t.filter&&(e=e.filter(t.filter)),(t.type||t.types)&&e.forEach(function(e){var n=t.types&&t.types[e.id]?t.types[e.id]:t.type;i.setTargetType(e.id,n)}),i.data.targets.forEach(function(t){for(var i=0;i<e.length;i++)if(t.id===e[i].id){t.values=e[i].values,e.splice(i,1);break}}),i.data.targets=i.data.targets.concat(e)),i.updateTargets(i.data.targets),i.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),t.done&&t.done()},r.loadFromArgs=function(e){var t=this;e.data?t.load(t.convertDataToTargets(e.data),e):e.url?t.convertUrlToData(e.url,e.mimeType,e.headers,e.keys,function(i){t.load(t.convertDataToTargets(i),e)}):e.json?t.load(t.convertDataToTargets(t.convertJsonToData(e.json,e.keys)),e):e.rows?t.load(t.convertDataToTargets(t.convertRowsToData(e.rows)),e):e.columns?t.load(t.convertDataToTargets(t.convertColumnsToData(e.columns)),e):t.load(null,e)},r.unload=function(e,t){var i=this;if(t||(t=function(){}),!(e=e.filter(function(e){return i.hasTarget(i.data.targets,e)}))||0===e.length)return void t();i.svg.selectAll(e.map(function(e){return i.selectorTarget(e)})).transition().style("opacity",0).remove().call(i.endall,t),e.forEach(function(e){i.withoutFadeIn[e]=!1,i.legend&&i.legend.selectAll("."+c.legendItem+i.getTargetSelectorSuffix(e)).remove(),i.data.targets=i.data.targets.filter(function(t){return t.id!==e})})},r.categoryName=function(e){var t=this.config;return e<t.axis_x_categories.length?t.axis_x_categories[e]:e},r.initEventRect=function(){this.main.select("."+c.chart).append("g").attr("class",c.eventRects).style("fill-opacity",0)},r.redrawEventRect=function(){var e,t,i=this,n=i.config,a=i.isMultipleX(),o=i.main.select("."+c.eventRects).style("cursor",n.zoom_enabled?n.axis_rotated?"ns-resize":"ew-resize":null).classed(c.eventRectsMultiple,a).classed(c.eventRectsSingle,!a);o.selectAll("."+c.eventRect).remove(),i.eventRect=o.selectAll("."+c.eventRect),a?(e=i.eventRect.data([0]),i.generateEventRectsForMultipleXs(e.enter()),i.updateEventRect(e)):(t=i.getMaxDataCountTarget(i.data.targets),o.datum(t?t.values:[]),i.eventRect=o.selectAll("."+c.eventRect),e=i.eventRect.data(function(e){return e}),i.generateEventRectsForSingleX(e.enter()),i.updateEventRect(e),e.exit().remove())},r.updateEventRect=function(e){var t,i,n,a,o,s,r=this,l=r.config;e=e||r.eventRect.data(function(e){return e}),r.isMultipleX()?(t=0,i=0,n=r.width,a=r.height):(!r.isCustomX()&&!r.isTimeSeries()||r.isCategorized()?(o=r.getEventRectWidth(),s=function(e){return r.x(e.x)-o/2}):(r.updateXs(),o=function(e){var t=r.getPrevX(e.index),i=r.getNextX(e.index);return null===t&&null===i?l.axis_rotated?r.height:r.width:(null===t&&(t=r.x.domain()[0]),null===i&&(i=r.x.domain()[1]),Math.max(0,(r.x(i)-r.x(t))/2))},s=function(e){var t=r.getPrevX(e.index),i=r.getNextX(e.index),n=r.data.xs[e.id][e.index];return null===t&&null===i?0:(null===t&&(t=r.x.domain()[0]),(r.x(n)+r.x(t))/2)}),t=l.axis_rotated?0:s,i=l.axis_rotated?s:0,n=l.axis_rotated?r.width:o,a=l.axis_rotated?o:r.height),e.attr("class",r.classEvent.bind(r)).attr("x",t).attr("y",i).attr("width",n).attr("height",a)},r.generateEventRectsForSingleX=function(e){var t=this,i=t.d3,n=t.config;e.append("rect").attr("class",t.classEvent.bind(t)).style("cursor",n.data_selection_enabled&&n.data_selection_grouped?"pointer":null).on("mouseover",function(e){var i=e.index;t.dragging||t.flowing||t.hasArcType()||(n.point_focus_expand_enabled&&t.expandCircles(i,null,!0),t.expandBars(i,null,!0),t.main.selectAll("."+c.shape+"-"+i).each(function(e){n.data_onmouseover.call(t.api,e)}))}).on("mouseout",function(e){var i=e.index;t.config&&(t.hasArcType()||(t.hideXGridFocus(),t.hideTooltip(),t.unexpandCircles(),t.unexpandBars(),t.main.selectAll("."+c.shape+"-"+i).each(function(e){n.data_onmouseout.call(t.api,e)})))}).on("mousemove",function(e){var a,o=e.index,s=t.svg.select("."+c.eventRect+"-"+o);t.dragging||t.flowing||t.hasArcType()||(t.isStepType(e)&&"step-after"===t.config.line_step_type&&i.mouse(this)[0]<t.x(t.getXValue(e.id,o))&&(o-=1),a=t.filterTargetsToShow(t.data.targets).map(function(e){return t.addName(t.getValueOnIndex(e.values,o))}),n.tooltip_grouped&&(t.showTooltip(a,this),t.showXGridFocus(a)),(!n.tooltip_grouped||n.data_selection_enabled&&!n.data_selection_grouped)&&t.main.selectAll("."+c.shape+"-"+o).each(function(){i.select(this).classed(c.EXPANDED,!0),n.data_selection_enabled&&s.style("cursor",n.data_selection_grouped?"pointer":null),n.tooltip_grouped||(t.hideXGridFocus(),t.hideTooltip(),n.data_selection_grouped||(t.unexpandCircles(o),t.unexpandBars(o)))}).filter(function(e){return t.isWithinShape(this,e)}).each(function(e){n.data_selection_enabled&&(n.data_selection_grouped||n.data_selection_isselectable(e))&&s.style("cursor","pointer"),n.tooltip_grouped||(t.showTooltip([e],this),t.showXGridFocus([e]),n.point_focus_expand_enabled&&t.expandCircles(o,e.id,!0),t.expandBars(o,e.id,!0))}))}).on("click",function(e){var a=e.index;if(!t.hasArcType()&&t.toggleShape){if(t.cancelClick)return void(t.cancelClick=!1);t.isStepType(e)&&"step-after"===n.line_step_type&&i.mouse(this)[0]<t.x(t.getXValue(e.id,a))&&(a-=1),t.main.selectAll("."+c.shape+"-"+a).each(function(e){(n.data_selection_grouped||t.isWithinShape(this,e))&&(t.toggleShape(this,e,a),t.config.data_onclick.call(t.api,e,this))})}}).call(n.data_selection_draggable&&t.drag?i.behavior.drag().origin(Object).on("drag",function(){t.drag(i.mouse(this))}).on("dragstart",function(){t.dragstart(i.mouse(this))}).on("dragend",function(){t.dragend()}):function(){})},r.generateEventRectsForMultipleXs=function(e){function t(){i.svg.select("."+c.eventRect).style("cursor",null),i.hideXGridFocus(),i.hideTooltip(),i.unexpandCircles(),i.unexpandBars()}var i=this,n=i.d3,a=i.config;e.append("rect").attr("x",0).attr("y",0).attr("width",i.width).attr("height",i.height).attr("class",c.eventRect).on("mouseout",function(){i.config&&(i.hasArcType()||t())}).on("mousemove",function(){var e,o,s,r,l=i.filterTargetsToShow(i.data.targets);if(!i.dragging&&!i.hasArcType(l)){if(e=n.mouse(this),o=i.findClosestFromTargets(l,e),!i.mouseover||o&&o.id===i.mouseover.id||(a.data_onmouseout.call(i.api,i.mouseover),i.mouseover=void 0),!o)return void t();s=i.isScatterType(o)||!a.tooltip_grouped?[o]:i.filterByX(l,o.x),r=s.map(function(e){return i.addName(e)}),i.showTooltip(r,this),a.point_focus_expand_enabled&&i.expandCircles(o.index,o.id,!0),i.expandBars(o.index,o.id,!0),i.showXGridFocus(r),(i.isBarType(o.id)||i.dist(o,e)<a.point_sensitivity)&&(i.svg.select("."+c.eventRect).style("cursor","pointer"),i.mouseover||(a.data_onmouseover.call(i.api,o),i.mouseover=o))}}).on("click",function(){var e,t,o=i.filterTargetsToShow(i.data.targets);i.hasArcType(o)||(e=n.mouse(this),(t=i.findClosestFromTargets(o,e))&&(i.isBarType(t.id)||i.dist(t,e)<a.point_sensitivity)&&i.main.selectAll("."+c.shapes+i.getTargetSelectorSuffix(t.id)).selectAll("."+c.shape+"-"+t.index).each(function(){(a.data_selection_grouped||i.isWithinShape(this,t))&&(i.toggleShape(this,t,t.index),i.config.data_onclick.call(i.api,t,this))}))}).call(a.data_selection_draggable&&i.drag?n.behavior.drag().origin(Object).on("drag",function(){i.drag(n.mouse(this))}).on("dragstart",function(){i.dragstart(n.mouse(this))}).on("dragend",function(){i.dragend()}):function(){})},r.dispatchEvent=function(t,i,n){var a=this,o="."+c.eventRect+(a.isMultipleX()?"":"-"+i),s=a.main.select(o).node(),r=s.getBoundingClientRect(),l=r.left+(n?n[0]:0),d=r.top+(n?n[1]:0),h=document.createEvent("MouseEvents");h.initMouseEvent(t,!0,!0,e,0,l,d,l,d,!1,!1,!1,!1,0,null),s.dispatchEvent(h)},r.getCurrentWidth=function(){var e=this,t=e.config;return t.size_width?t.size_width:e.getParentWidth()},r.getCurrentHeight=function(){var e=this,t=e.config,i=t.size_height?t.size_height:e.getParentHeight();return i>0?i:320/(e.hasType("gauge")&&!t.gauge_fullCircle?2:1)},r.getCurrentPaddingTop=function(){var e=this,t=e.config,i=d(t.padding_top)?t.padding_top:0;return e.title&&e.title.node()&&(i+=e.getTitlePadding()),i},r.getCurrentPaddingBottom=function(){var e=this.config;return d(e.padding_bottom)?e.padding_bottom:0},r.getCurrentPaddingLeft=function(e){var t=this,i=t.config;return d(i.padding_left)?i.padding_left:i.axis_rotated?i.axis_x_show?Math.max(f(t.getAxisWidthByAxisId("x",e)),40):1:!i.axis_y_show||i.axis_y_inner?t.axis.getYAxisLabelPosition().isOuter?30:1:f(t.getAxisWidthByAxisId("y",e))},r.getCurrentPaddingRight=function(){var e=this,t=e.config,i=e.isLegendRight?e.getLegendWidth()+20:0;return d(t.padding_right)?t.padding_right+1:t.axis_rotated?10+i:!t.axis_y2_show||t.axis_y2_inner?2+i+(e.axis.getY2AxisLabelPosition().isOuter?20:0):f(e.getAxisWidthByAxisId("y2"))+i},r.getParentRectValue=function(e){for(var t,i=this.selectChart.node();i&&"BODY"!==i.tagName;){try{t=i.getBoundingClientRect()[e]}catch(n){"width"===e&&(t=i.offsetWidth)}if(t)break;i=i.parentNode}return t},r.getParentWidth=function(){return this.getParentRectValue("width")},r.getParentHeight=function(){var e=this.selectChart.style("height");return e.indexOf("px")>0?+e.replace("px",""):0},r.getSvgLeft=function(e){var t=this,i=t.config,n=i.axis_rotated||!i.axis_rotated&&!i.axis_y_inner,a=i.axis_rotated?c.axisX:c.axisY,o=t.main.select("."+a).node(),s=o&&n?o.getBoundingClientRect():{right:0},r=t.selectChart.node().getBoundingClientRect(),l=t.hasArcType(),d=s.right-r.left-(l?0:t.getCurrentPaddingLeft(e));return d>0?d:0},r.getAxisWidthByAxisId=function(e,t){var i=this,n=i.axis.getLabelPositionById(e);return i.axis.getMaxTickWidth(e,t)+(n.isInner?20:40)},r.getHorizontalAxisHeight=function(e){var t=this,i=t.config,n=30;return"x"!==e||i.axis_x_show?"x"===e&&i.axis_x_height?i.axis_x_height:"y"!==e||i.axis_y_show?"y2"!==e||i.axis_y2_show?("x"===e&&!i.axis_rotated&&i.axis_x_tick_rotate&&(n=30+t.axis.getMaxTickWidth(e)*Math.cos(Math.PI*(90-i.axis_x_tick_rotate)/180)),"y"===e&&i.axis_rotated&&i.axis_y_tick_rotate&&(n=30+t.axis.getMaxTickWidth(e)*Math.cos(Math.PI*(90-i.axis_y_tick_rotate)/180)),n+(t.axis.getLabelPositionById(e).isInner?0:10)+("y2"===e?-10:0)):t.rotated_padding_top:!i.legend_show||t.isLegendRight||t.isLegendInset?1:10:8},r.getEventRectWidth=function(){return Math.max(0,this.xAxis.tickInterval())},r.getShapeIndices=function(e){var t,i,n=this,a=n.config,o={},s=0;return n.filterTargetsToShow(n.data.targets.filter(e,n)).forEach(function(e){for(t=0;t<a.data_groups.length;t++)if(!(a.data_groups[t].indexOf(e.id)<0))for(i=0;i<a.data_groups[t].length;i++)if(a.data_groups[t][i]in o){o[e.id]=o[a.data_groups[t][i]];break}g(o[e.id])&&(o[e.id]=s++)}),o.__max__=s-1,o},r.getShapeX=function(e,t,i,n){var a=this,o=n?a.subX:a.x;return function(n){var a=n.id in i?i[n.id]:0;return n.x||0===n.x?o(n.x)-e*(t/2-a):0}},r.getShapeY=function(e){var t=this;return function(i){return(e?t.getSubYScale(i.id):t.getYScale(i.id))(i.value)}},r.getShapeOffset=function(e,t,i){var n=this,a=n.orderTargets(n.filterTargetsToShow(n.data.targets.filter(e,n))),o=a.map(function(e){return e.id});return function(e,s){var r=i?n.getSubYScale(e.id):n.getYScale(e.id),l=r(0),c=l;return a.forEach(function(i){var a=n.isStepType(e)?n.convertValuesToStep(i.values):i.values;i.id!==e.id&&t[i.id]===t[e.id]&&o.indexOf(i.id)<o.indexOf(e.id)&&(void 0!==a[s]&&+a[s].x==+e.x||(s=-1,a.forEach(function(t,i){t.x===e.x&&(s=i)})),s in a&&a[s].value*e.value>=0&&(c+=r(a[s].value)-l))}),c}},r.isWithinShape=function(e,t){var i,n=this,a=n.d3.select(e);return n.isTargetToShow(t.id)?"circle"===e.nodeName?i=n.isStepType(t)?n.isWithinStep(e,n.getYScale(t.id)(t.value)):n.isWithinCircle(e,1.5*n.pointSelectR(t)):"path"===e.nodeName&&(i=!a.classed(c.bar)||n.isWithinBar(e)):i=!1,i},r.getInterpolate=function(e){var t=this,i=t.isInterpolationType(t.config.spline_interpolation_type)?t.config.spline_interpolation_type:"cardinal";return t.isSplineType(e)?i:t.isStepType(e)?t.config.line_step_type:"linear"},r.initLine=function(){this.main.select("."+c.chart).append("g").attr("class",c.chartLines)},r.updateTargetsForLine=function(e){var t,i,n=this,a=n.config,o=n.classChartLine.bind(n),s=n.classLines.bind(n),r=n.classAreas.bind(n),l=n.classCircles.bind(n),d=n.classFocus.bind(n);t=n.main.select("."+c.chartLines).selectAll("."+c.chartLine).data(e).attr("class",function(e){return o(e)+d(e)}),i=t.enter().append("g").attr("class",o).style("opacity",0).style("pointer-events","none"),i.append("g").attr("class",s),i.append("g").attr("class",r),i.append("g").attr("class",function(e){return n.generateClass(c.selectedCircles,e.id)}),i.append("g").attr("class",l).style("cursor",function(e){return a.data_selection_isselectable(e)?"pointer":null}),e.forEach(function(e){n.main.selectAll("."+c.selectedCircles+n.getTargetSelectorSuffix(e.id)).selectAll("."+c.selectedCircle).each(function(t){t.value=e.values[t.index].value})})},r.updateLine=function(e){var t=this;t.mainLine=t.main.selectAll("."+c.lines).selectAll("."+c.line).data(t.lineData.bind(t)),t.mainLine.enter().append("path").attr("class",t.classLine.bind(t)).style("stroke",t.color),t.mainLine.style("opacity",t.initialOpacity.bind(t)).style("shape-rendering",function(e){return t.isStepType(e)?"crispEdges":""}).attr("transform",null),t.mainLine.exit().transition().duration(e).style("opacity",0).remove()},r.redrawLine=function(e,t){return[(t?this.mainLine.transition(Math.random().toString()):this.mainLine).attr("d",e).style("stroke",this.color).style("opacity",1)]},r.generateDrawLine=function(e,t){var i=this,n=i.config,a=i.d3.svg.line(),o=i.generateGetLinePoints(e,t),s=t?i.getSubYScale:i.getYScale,r=function(e){return(t?i.subxx:i.xx).call(i,e)},l=function(e,t){return n.data_groups.length>0?o(e,t)[0][1]:s.call(i,e.id)(e.value)};return a=n.axis_rotated?a.x(l).y(r):a.x(r).y(l),n.line_connectNull||(a=a.defined(function(e){return null!=e.value})),function(e){var o,r=n.line_connectNull?i.filterRemoveNull(e.values):e.values,l=t?i.x:i.subX,c=s.call(i,e.id),d=0,h=0;return i.isLineType(e)?n.data_regions[e.id]?o=i.lineWithRegions(r,l,c,n.data_regions[e.id]):(i.isStepType(e)&&(r=i.convertValuesToStep(r)),o=a.interpolate(i.getInterpolate(e))(r)):(r[0]&&(d=l(r[0].x),h=c(r[0].value)),o=n.axis_rotated?"M "+h+" "+d:"M "+d+" "+h),o||"M 0 0"}},r.generateGetLinePoints=function(e,t){var i=this,n=i.config,a=e.__max__+1,o=i.getShapeX(0,a,e,!!t),s=i.getShapeY(!!t),r=i.getShapeOffset(i.isLineType,e,!!t),l=t?i.getSubYScale:i.getYScale;return function(e,t){var a=l.call(i,e.id)(0),c=r(e,t)||a,d=o(e),h=s(e);return n.axis_rotated&&(0<e.value&&h<a||e.value<0&&a<h)&&(h=a),[[d,h-(a-c)],[d,h-(a-c)],[d,h-(a-c)],[d,h-(a-c)]]}},r.lineWithRegions=function(e,t,i,n){function a(e){return"M"+e[0][0]+" "+e[0][1]+" "+e[1][0]+" "+e[1][1]}var o,s,r,l,c,d,h,u,f,m,x,v,_=this,b=_.config,y="M",w=_.isCategorized()?.5:0,S=[];if(p(n))for(o=0;o<n.length;o++)S[o]={},g(n[o].start)?S[o].start=e[0].x:S[o].start=_.isTimeSeries()?_.parseDate(n[o].start):n[o].start,g(n[o].end)?S[o].end=e[e.length-1].x:S[o].end=_.isTimeSeries()?_.parseDate(n[o].end):n[o].end;for(x=b.axis_rotated?function(e){return i(e.value)}:function(e){return t(e.x)},v=b.axis_rotated?function(e){return t(e.x)}:function(e){return i(e.value)},r=_.isTimeSeries()?function(e,n,o,s){var r,l=e.x.getTime(),d=n.x-e.x,h=new Date(l+d*o),u=new Date(l+d*(o+s));return r=b.axis_rotated?[[i(c(o)),t(h)],[i(c(o+s)),t(u)]]:[[t(h),i(c(o))],[t(u),i(c(o+s))]],a(r)}:function(e,n,o,s){var r;return r=b.axis_rotated?[[i(c(o),!0),t(l(o))],[i(c(o+s),!0),t(l(o+s))]]:[[t(l(o),!0),i(c(o))],[t(l(o+s),!0),i(c(o+s))]],a(r)},o=0;o<e.length;o++){if(g(S)||!function(e,t){var i;for(i=0;i<t.length;i++)if(t[i].start<e&&e<=t[i].end)return!0;return!1}(e[o].x,S))y+=" "+x(e[o])+" "+v(e[o]);else for(l=_.getScale(e[o-1].x+w,e[o].x+w,_.isTimeSeries()),c=_.getScale(e[o-1].value,e[o].value),d=t(e[o].x)-t(e[o-1].x),h=i(e[o].value)-i(e[o-1].value),u=Math.sqrt(Math.pow(d,2)+Math.pow(h,2)),f=2/u,m=2*f,s=f;s<=1;s+=m)y+=r(e[o-1],e[o],s,f);e[o].x}return y},r.updateArea=function(e){var t=this,i=t.d3;t.mainArea=t.main.selectAll("."+c.areas).selectAll("."+c.area).data(t.lineData.bind(t)),t.mainArea.enter().append("path").attr("class",t.classArea.bind(t)).style("fill",t.color).style("opacity",function(){return t.orgAreaOpacity=+i.select(this).style("opacity"),0}),t.mainArea.style("opacity",t.orgAreaOpacity),t.mainArea.exit().transition().duration(e).style("opacity",0).remove()},r.redrawArea=function(e,t){return[(t?this.mainArea.transition(Math.random().toString()):this.mainArea).attr("d",e).style("fill",this.color).style("opacity",this.orgAreaOpacity)]},r.generateDrawArea=function(e,t){var i=this,n=i.config,a=i.d3.svg.area(),o=i.generateGetAreaPoints(e,t),s=t?i.getSubYScale:i.getYScale,r=function(e){return(t?i.subxx:i.xx).call(i,e)},l=function(e,t){return n.data_groups.length>0?o(e,t)[0][1]:s.call(i,e.id)(i.getAreaBaseValue(e.id))},c=function(e,t){return n.data_groups.length>0?o(e,t)[1][1]:s.call(i,e.id)(e.value)};return a=n.axis_rotated?a.x0(l).x1(c).y(r):a.x(r).y0(n.area_above?0:l).y1(c),n.line_connectNull||(a=a.defined(function(e){return null!==e.value})),function(e){var t,o=n.line_connectNull?i.filterRemoveNull(e.values):e.values,s=0,r=0;return i.isAreaType(e)?(i.isStepType(e)&&(o=i.convertValuesToStep(o)),t=a.interpolate(i.getInterpolate(e))(o)):(o[0]&&(s=i.x(o[0].x),r=i.getYScale(e.id)(o[0].value)),t=n.axis_rotated?"M "+r+" "+s:"M "+s+" "+r),t||"M 0 0"}},r.getAreaBaseValue=function(){return 0},r.generateGetAreaPoints=function(e,t){var i=this,n=i.config,a=e.__max__+1,o=i.getShapeX(0,a,e,!!t),s=i.getShapeY(!!t),r=i.getShapeOffset(i.isAreaType,e,!!t),l=t?i.getSubYScale:i.getYScale;return function(e,t){var a=l.call(i,e.id)(0),c=r(e,t)||a,d=o(e),h=s(e);return n.axis_rotated&&(0<e.value&&h<a||e.value<0&&a<h)&&(h=a),[[d,c],[d,h-(a-c)],[d,h-(a-c)],[d,c]]}},r.updateCircle=function(){var e=this;e.mainCircle=e.main.selectAll("."+c.circles).selectAll("."+c.circle).data(e.lineOrScatterData.bind(e)),e.mainCircle.enter().append("circle").attr("class",e.classCircle.bind(e)).attr("r",e.pointR.bind(e)).style("fill",e.color),e.mainCircle.style("opacity",e.initialOpacityForCircle.bind(e)),e.mainCircle.exit().remove()},r.redrawCircle=function(e,t,i){var n=this.main.selectAll("."+c.selectedCircle);return[(i?this.mainCircle.transition(Math.random().toString()):this.mainCircle).style("opacity",this.opacityForCircle.bind(this)).style("fill",this.color).attr("cx",e).attr("cy",t),(i?n.transition(Math.random().toString()):n).attr("cx",e).attr("cy",t)]},r.circleX=function(e){return e.x||0===e.x?this.x(e.x):null},r.updateCircleY=function(){var e,t,i=this;i.config.data_groups.length>0?(e=i.getShapeIndices(i.isLineType),t=i.generateGetLinePoints(e),i.circleY=function(e,i){return t(e,i)[0][1]}):i.circleY=function(e){return i.getYScale(e.id)(e.value)}},r.getCircles=function(e,t){var i=this;return(t?i.main.selectAll("."+c.circles+i.getTargetSelectorSuffix(t)):i.main).selectAll("."+c.circle+(d(e)?"-"+e:""))},r.expandCircles=function(e,t,i){var n=this,a=n.pointExpandedR.bind(n);i&&n.unexpandCircles(),n.getCircles(e,t).classed(c.EXPANDED,!0).attr("r",a)},r.unexpandCircles=function(e){var t=this,i=t.pointR.bind(t);t.getCircles(e).filter(function(){return t.d3.select(this).classed(c.EXPANDED)}).classed(c.EXPANDED,!1).attr("r",i)},r.pointR=function(e){var t=this,i=t.config;return t.isStepType(e)?0:h(i.point_r)?i.point_r(e):i.point_r},r.pointExpandedR=function(e){var t=this,i=t.config;return i.point_focus_expand_enabled?i.point_focus_expand_r?i.point_focus_expand_r:1.75*t.pointR(e):t.pointR(e)},r.pointSelectR=function(e){var t=this,i=t.config;return h(i.point_select_r)?i.point_select_r(e):i.point_select_r?i.point_select_r:4*t.pointR(e)},r.isWithinCircle=function(e,t){var i=this.d3,n=i.mouse(e),a=i.select(e),o=+a.attr("cx"),s=+a.attr("cy");return Math.sqrt(Math.pow(o-n[0],2)+Math.pow(s-n[1],2))<t},r.isWithinStep=function(e,t){return Math.abs(t-this.d3.mouse(e)[1])<30},r.initBar=function(){this.main.select("."+c.chart).append("g").attr("class",c.chartBars)},r.updateTargetsForBar=function(e){var t,i,n=this,a=n.config,o=n.classChartBar.bind(n),s=n.classBars.bind(n),r=n.classFocus.bind(n);t=n.main.select("."+c.chartBars).selectAll("."+c.chartBar).data(e).attr("class",function(e){return o(e)+r(e)}),i=t.enter().append("g").attr("class",o).style("opacity",0).style("pointer-events","none"),i.append("g").attr("class",s).style("cursor",function(e){return a.data_selection_isselectable(e)?"pointer":null})},r.updateBar=function(e){var t=this,i=t.barData.bind(t),n=t.classBar.bind(t),a=t.initialOpacity.bind(t),o=function(e){return t.color(e.id)};t.mainBar=t.main.selectAll("."+c.bars).selectAll("."+c.bar).data(i),t.mainBar.enter().append("path").attr("class",n).style("stroke",o).style("fill",o),t.mainBar.style("opacity",a),t.mainBar.exit().transition().duration(e).style("opacity",0).remove()},r.redrawBar=function(e,t){return[(t?this.mainBar.transition(Math.random().toString()):this.mainBar).attr("d",e).style("fill",this.color).style("opacity",1)]},r.getBarW=function(e,t){var i=this,n=i.config,a="number"==typeof n.bar_width?n.bar_width:t?e.tickInterval()*n.bar_width_ratio/t:0;return n.bar_width_max&&a>n.bar_width_max?n.bar_width_max:a},r.getBars=function(e,t){var i=this;return(t?i.main.selectAll("."+c.bars+i.getTargetSelectorSuffix(t)):i.main).selectAll("."+c.bar+(d(e)?"-"+e:""))},r.expandBars=function(e,t,i){var n=this;i&&n.unexpandBars(),n.getBars(e,t).classed(c.EXPANDED,!0)},r.unexpandBars=function(e){this.getBars(e).classed(c.EXPANDED,!1)},r.generateDrawBar=function(e,t){var i=this,n=i.config,a=i.generateGetBarPoints(e,t);return function(e,t){var i=a(e,t),o=n.axis_rotated?1:0,s=n.axis_rotated?0:1;return"M "+i[0][o]+","+i[0][s]+" L"+i[1][o]+","+i[1][s]+" L"+i[2][o]+","+i[2][s]+" L"+i[3][o]+","+i[3][s]+" z"}},r.generateGetBarPoints=function(e,t){var i=this,n=t?i.subXAxis:i.xAxis,a=e.__max__+1,o=i.getBarW(n,a),s=i.getShapeX(o,a,e,!!t),r=i.getShapeY(!!t),l=i.getShapeOffset(i.isBarType,e,!!t),c=t?i.getSubYScale:i.getYScale;return function(e,t){var n=c.call(i,e.id)(0),a=l(e,t)||n,d=s(e),h=r(e);return i.config.axis_rotated&&(0<e.value&&h<n||e.value<0&&n<h)&&(h=n),[[d,a],[d,h-(n-a)],[d+o,h-(n-a)],[d+o,a]]}},r.isWithinBar=function(e){var t=this.d3.mouse(e),i=e.getBoundingClientRect(),n=e.pathSegList.getItem(0),a=e.pathSegList.getItem(1),o=Math.min(n.x,a.x),s=Math.min(n.y,a.y),r=i.width,l=i.height,c=o-2,d=o+r+2,h=s+l+2,u=s-2;return c<t[0]&&t[0]<d&&u<t[1]&&t[1]<h},r.initText=function(){var e=this;e.main.select("."+c.chart).append("g").attr("class",c.chartTexts),e.mainText=e.d3.selectAll([])},r.updateTargetsForText=function(e){var t,i,n=this,a=n.classChartText.bind(n),o=n.classTexts.bind(n),s=n.classFocus.bind(n);t=n.main.select("."+c.chartTexts).selectAll("."+c.chartText).data(e).attr("class",function(e){return a(e)+s(e)}),i=t.enter().append("g").attr("class",a).style("opacity",0).style("pointer-events","none"),i.append("g").attr("class",o)},r.updateText=function(e){var t=this,i=t.config,n=t.barOrLineData.bind(t),a=t.classText.bind(t);t.mainText=t.main.selectAll("."+c.texts).selectAll("."+c.text).data(n),t.mainText.enter().append("text").attr("class",a).attr("text-anchor",function(e){return i.axis_rotated?e.value<0?"end":"start":"middle"}).style("stroke","none").style("fill",function(e){return t.color(e)}).style("fill-opacity",0),t.mainText.text(function(e,i,n){return t.dataLabelFormat(e.id)(e.value,e.id,i,n)}),t.mainText.exit().transition().duration(e).style("fill-opacity",0).remove()},r.redrawText=function(e,t,i,n){return[(n?this.mainText.transition():this.mainText).attr("x",e).attr("y",t).style("fill",this.color).style("fill-opacity",i?0:this.opacityForText.bind(this))]},r.getTextRect=function(e,t,i){var n,a=this.d3.select("body").append("div").classed("c3",!0),o=a.append("svg").style("visibility","hidden").style("position","fixed").style("top",0).style("left",0),s=this.d3.select(i).style("font");return o.selectAll(".dummy").data([e]).enter().append("text").classed(t||"",!0).style("font",s).text(e).each(function(){n=this.getBoundingClientRect()}),a.remove(),n},r.generateXYForText=function(e,t,i,n){var a=this,o=a.generateGetAreaPoints(e,!1),s=a.generateGetBarPoints(t,!1),r=a.generateGetLinePoints(i,!1),l=n?a.getXForText:a.getYForText;return function(e,t){var i=a.isAreaType(e)?o:a.isBarType(e)?s:r;return l.call(a,i(e,t),e,this)}},r.getXForText=function(e,t,i){var n,a,o=this,s=i.getBoundingClientRect();return o.config.axis_rotated?(a=o.isBarType(t)?4:6,n=e[2][1]+a*(t.value<0?-1:1)):n=o.hasType("bar")?(e[2][0]+e[0][0])/2:e[0][0],null===t.value&&(n>o.width?n=o.width-s.width:n<0&&(n=4)),n},r.getYForText=function(e,t,i){var n,a=this,o=i.getBoundingClientRect();return a.config.axis_rotated?n=(e[0][0]+e[2][0]+.6*o.height)/2:(n=e[2][1],t.value<0||0===t.value&&!a.hasPositiveValue?(n+=o.height,a.isBarType(t)&&a.isSafari()?n-=3:!a.isBarType(t)&&a.isChrome()&&(n+=3)):n+=a.isBarType(t)?-3:-6),null!==t.value||a.config.axis_rotated||(n<o.height?n=o.height:n>this.height&&(n=this.height-4)),n},r.setTargetType=function(e,t){var i=this,n=i.config;i.mapToTargetIds(e).forEach(function(e){i.withoutFadeIn[e]=t===n.data_types[e],n.data_types[e]=t}),e||(n.data_type=t)},r.hasType=function(e,t){var i=this,n=i.config.data_types,a=!1;return t=t||i.data.targets,t&&t.length?t.forEach(function(t){var i=n[t.id];(i&&i.indexOf(e)>=0||!i&&"line"===e)&&(a=!0)}):Object.keys(n).length?Object.keys(n).forEach(function(t){n[t]===e&&(a=!0)}):a=i.config.data_type===e,a},r.hasArcType=function(e){return this.hasType("pie",e)||this.hasType("donut",e)||this.hasType("gauge",e)},r.isLineType=function(e){var t=this.config,i=u(e)?e:e.id;return!t.data_types[i]||["line","spline","area","area-spline","step","area-step"].indexOf(t.data_types[i])>=0},r.isStepType=function(e){var t=u(e)?e:e.id;return["step","area-step"].indexOf(this.config.data_types[t])>=0},r.isSplineType=function(e){var t=u(e)?e:e.id;return["spline","area-spline"].indexOf(this.config.data_types[t])>=0},r.isAreaType=function(e){var t=u(e)?e:e.id;return["area","area-spline","area-step"].indexOf(this.config.data_types[t])>=0},r.isBarType=function(e){var t=u(e)?e:e.id;return"bar"===this.config.data_types[t]},r.isScatterType=function(e){var t=u(e)?e:e.id;return"scatter"===this.config.data_types[t]},r.isPieType=function(e){var t=u(e)?e:e.id;return"pie"===this.config.data_types[t]},r.isGaugeType=function(e){var t=u(e)?e:e.id;return"gauge"===this.config.data_types[t]},r.isDonutType=function(e){var t=u(e)?e:e.id;return"donut"===this.config.data_types[t]},r.isArcType=function(e){return this.isPieType(e)||this.isDonutType(e)||this.isGaugeType(e)},r.lineData=function(e){return this.isLineType(e)?[e]:[]},r.arcData=function(e){return this.isArcType(e.data)?[e]:[]},r.barData=function(e){return this.isBarType(e)?e.values:[]},r.lineOrScatterData=function(e){return this.isLineType(e)||this.isScatterType(e)?e.values:[]},r.barOrLineData=function(e){return this.isBarType(e)||this.isLineType(e)?e.values:[]},r.isInterpolationType=function(e){return["linear","linear-closed","basis","basis-open","basis-closed","bundle","cardinal","cardinal-open","cardinal-closed","monotone"].indexOf(e)>=0},r.initGrid=function(){var e=this,t=e.config,i=e.d3;e.grid=e.main.append("g").attr("clip-path",e.clipPathForGrid).attr("class",c.grid),t.grid_x_show&&e.grid.append("g").attr("class",c.xgrids),t.grid_y_show&&e.grid.append("g").attr("class",c.ygrids),t.grid_focus_show&&e.grid.append("g").attr("class",c.xgridFocus).append("line").attr("class",c.xgridFocus),e.xgrid=i.selectAll([]),t.grid_lines_front||e.initGridLines()},r.initGridLines=function(){var e=this,t=e.d3;e.gridLines=e.main.append("g").attr("clip-path",e.clipPathForGrid).attr("class",c.grid+" "+c.gridLines),e.gridLines.append("g").attr("class",c.xgridLines),e.gridLines.append("g").attr("class",c.ygridLines),e.xgridLines=t.selectAll([])},r.updateXGrid=function(e){var t=this,i=t.config,n=t.d3,a=t.generateGridData(i.grid_x_type,t.x),o=t.isCategorized()?t.xAxis.tickOffset():0;t.xgridAttr=i.axis_rotated?{x1:0,x2:t.width,y1:function(e){return t.x(e)-o},y2:function(e){return t.x(e)-o}}:{x1:function(e){return t.x(e)+o},x2:function(e){return t.x(e)+o},y1:0,y2:t.height},t.xgrid=t.main.select("."+c.xgrids).selectAll("."+c.xgrid).data(a),t.xgrid.enter().append("line").attr("class",c.xgrid),e||t.xgrid.attr(t.xgridAttr).style("opacity",function(){return+n.select(this).attr(i.axis_rotated?"y1":"x1")===(i.axis_rotated?t.height:0)?0:1}),t.xgrid.exit().remove()},r.updateYGrid=function(){var e=this,t=e.config,i=e.yAxis.tickValues()||e.y.ticks(t.grid_y_ticks);e.ygrid=e.main.select("."+c.ygrids).selectAll("."+c.ygrid).data(i),
e.ygrid.enter().append("line").attr("class",c.ygrid),e.ygrid.attr("x1",t.axis_rotated?e.y:0).attr("x2",t.axis_rotated?e.y:e.width).attr("y1",t.axis_rotated?0:e.y).attr("y2",t.axis_rotated?e.height:e.y),e.ygrid.exit().remove(),e.smoothLines(e.ygrid,"grid")},r.gridTextAnchor=function(e){return e.position?e.position:"end"},r.gridTextDx=function(e){return"start"===e.position?4:"middle"===e.position?0:-4},r.xGridTextX=function(e){return"start"===e.position?-this.height:"middle"===e.position?-this.height/2:0},r.yGridTextX=function(e){return"start"===e.position?0:"middle"===e.position?this.width/2:this.width},r.updateGrid=function(e){var t,i,n,a=this,o=a.main,s=a.config;a.grid.style("visibility",a.hasArcType()?"hidden":"visible"),o.select("line."+c.xgridFocus).style("visibility","hidden"),s.grid_x_show&&a.updateXGrid(),a.xgridLines=o.select("."+c.xgridLines).selectAll("."+c.xgridLine).data(s.grid_x_lines),t=a.xgridLines.enter().append("g").attr("class",function(e){return c.xgridLine+(e.class?" "+e.class:"")}),t.append("line").style("opacity",0),t.append("text").attr("text-anchor",a.gridTextAnchor).attr("transform",s.axis_rotated?"":"rotate(-90)").attr("dx",a.gridTextDx).attr("dy",-5).style("opacity",0),a.xgridLines.exit().transition().duration(e).style("opacity",0).remove(),s.grid_y_show&&a.updateYGrid(),a.ygridLines=o.select("."+c.ygridLines).selectAll("."+c.ygridLine).data(s.grid_y_lines),i=a.ygridLines.enter().append("g").attr("class",function(e){return c.ygridLine+(e.class?" "+e.class:"")}),i.append("line").style("opacity",0),i.append("text").attr("text-anchor",a.gridTextAnchor).attr("transform",s.axis_rotated?"rotate(-90)":"").attr("dx",a.gridTextDx).attr("dy",-5).style("opacity",0),n=a.yv.bind(a),a.ygridLines.select("line").transition().duration(e).attr("x1",s.axis_rotated?n:0).attr("x2",s.axis_rotated?n:a.width).attr("y1",s.axis_rotated?0:n).attr("y2",s.axis_rotated?a.height:n).style("opacity",1),a.ygridLines.select("text").transition().duration(e).attr("x",s.axis_rotated?a.xGridTextX.bind(a):a.yGridTextX.bind(a)).attr("y",n).text(function(e){return e.text}).style("opacity",1),a.ygridLines.exit().transition().duration(e).style("opacity",0).remove()},r.redrawGrid=function(e){var t=this,i=t.config,n=t.xv.bind(t),a=t.xgridLines.select("line"),o=t.xgridLines.select("text");return[(e?a.transition():a).attr("x1",i.axis_rotated?0:n).attr("x2",i.axis_rotated?t.width:n).attr("y1",i.axis_rotated?n:0).attr("y2",i.axis_rotated?n:t.height).style("opacity",1),(e?o.transition():o).attr("x",i.axis_rotated?t.yGridTextX.bind(t):t.xGridTextX.bind(t)).attr("y",n).text(function(e){return e.text}).style("opacity",1)]},r.showXGridFocus=function(e){var t=this,i=t.config,n=e.filter(function(e){return e&&d(e.value)}),a=t.main.selectAll("line."+c.xgridFocus),o=t.xx.bind(t);i.tooltip_show&&(t.hasType("scatter")||t.hasArcType()||(a.style("visibility","visible").data([n[0]]).attr(i.axis_rotated?"y1":"x1",o).attr(i.axis_rotated?"y2":"x2",o),t.smoothLines(a,"grid")))},r.hideXGridFocus=function(){this.main.select("line."+c.xgridFocus).style("visibility","hidden")},r.updateXgridFocus=function(){var e=this,t=e.config;e.main.select("line."+c.xgridFocus).attr("x1",t.axis_rotated?0:-10).attr("x2",t.axis_rotated?e.width:-10).attr("y1",t.axis_rotated?-10:0).attr("y2",t.axis_rotated?-10:e.height)},r.generateGridData=function(e,t){var i,n,a,o,s=this,r=[],l=s.main.select("."+c.axisX).selectAll(".tick").size();if("year"===e)for(i=s.getXDomain(),n=i[0].getFullYear(),a=i[1].getFullYear(),o=n;o<=a;o++)r.push(new Date(o+"-01-01 00:00:00"));else r=t.ticks(10),r.length>l&&(r=r.filter(function(e){return(""+e).indexOf(".")<0}));return r},r.getGridFilterToRemove=function(e){return e?function(t){var i=!1;return[].concat(e).forEach(function(e){("value"in e&&t.value===e.value||"class"in e&&t.class===e.class)&&(i=!0)}),i}:function(){return!0}},r.removeGridLines=function(e,t){var i=this,n=i.config,a=i.getGridFilterToRemove(e),o=function(e){return!a(e)},s=t?c.xgridLines:c.ygridLines,r=t?c.xgridLine:c.ygridLine;i.main.select("."+s).selectAll("."+r).filter(a).transition().duration(n.transition_duration).style("opacity",0).remove(),t?n.grid_x_lines=n.grid_x_lines.filter(o):n.grid_y_lines=n.grid_y_lines.filter(o)},r.initTooltip=function(){var e,t=this,i=t.config;if(t.tooltip=t.selectChart.style("position","relative").append("div").attr("class",c.tooltipContainer).style("position","absolute").style("pointer-events","none").style("display","none"),i.tooltip_init_show){if(t.isTimeSeries()&&u(i.tooltip_init_x)){for(i.tooltip_init_x=t.parseDate(i.tooltip_init_x),e=0;e<t.data.targets[0].values.length&&t.data.targets[0].values[e].x-i.tooltip_init_x!=0;e++);i.tooltip_init_x=e}t.tooltip.html(i.tooltip_contents.call(t,t.data.targets.map(function(e){return t.addName(e.values[i.tooltip_init_x])}),t.axis.getXAxisTickFormat(),t.getYFormat(t.hasArcType()),t.color)),t.tooltip.style("top",i.tooltip_init_position.top).style("left",i.tooltip_init_position.left).style("display","block")}},r.getTooltipContent=function(e,t,i,n){var a,o,s,r,l,c,d=this,h=d.config,u=h.tooltip_format_title||t,g=h.tooltip_format_name||function(e){return e},p=h.tooltip_format_value||i,f=d.isOrderAsc();if(0===h.data_groups.length)e.sort(function(e,t){var i=e?e.value:null,n=t?t.value:null;return f?i-n:n-i});else{var m=d.orderTargets(d.data.targets).map(function(e){return e.id});e.sort(function(e,t){var i=e?e.value:null,n=t?t.value:null;return i>0&&n>0&&(i=e?m.indexOf(e.id):null,n=t?m.indexOf(t.id):null),f?i-n:n-i})}for(o=0;o<e.length;o++)if(e[o]&&(e[o].value||0===e[o].value)&&(a||(s=w(u?u(e[o].x):e[o].x),a="<table class='"+d.CLASS.tooltip+"'>"+(s||0===s?"<tr><th colspan='2'>"+s+"</th></tr>":"")),void 0!==(r=w(p(e[o].value,e[o].ratio,e[o].id,e[o].index,e))))){if(null===e[o].name)continue;l=w(g(e[o].name,e[o].ratio,e[o].id,e[o].index)),c=d.levelColor?d.levelColor(e[o].value):n(e[o].id),a+="<tr class='"+d.CLASS.tooltipName+"-"+d.getTargetSelectorSuffix(e[o].id)+"'>",a+="<td class='name'><span style='background-color:"+c+"'></span>"+l+"</td>",a+="<td class='value'>"+r+"</td>",a+="</tr>"}return a+"</table>"},r.tooltipPosition=function(e,t,i,n){var a,o,s,r,l,c=this,d=c.config,h=c.d3,u=c.hasArcType(),g=h.mouse(n);return u?(o=(c.width-(c.isLegendRight?c.getLegendWidth():0))/2+g[0],r=c.height/2+g[1]+20):(a=c.getSvgLeft(!0),d.axis_rotated?(o=a+g[0]+100,s=o+t,l=c.currentWidth-c.getCurrentPaddingRight(),r=c.x(e[0].x)+20):(o=a+c.getCurrentPaddingLeft(!0)+c.x(e[0].x)+20,s=o+t,l=a+c.currentWidth-c.getCurrentPaddingRight(),r=g[1]+15),s>l&&(o-=s-l+20),r+i>c.currentHeight&&(r-=i+30)),r<0&&(r=0),{top:r,left:o}},r.showTooltip=function(e,t){var i,n,a,o=this,s=o.config,l=o.hasArcType(),c=e.filter(function(e){return e&&d(e.value)}),h=s.tooltip_position||r.tooltipPosition;0!==c.length&&s.tooltip_show&&(o.tooltip.html(s.tooltip_contents.call(o,e,o.axis.getXAxisTickFormat(),o.getYFormat(l),o.color)).style("display","block"),i=o.tooltip.property("offsetWidth"),n=o.tooltip.property("offsetHeight"),a=h.call(this,c,i,n,t),o.tooltip.style("top",a.top+"px").style("left",a.left+"px"))},r.hideTooltip=function(){this.tooltip.style("display","none")},r.initLegend=function(){var e=this;if(e.legendItemTextBox={},e.legendHasRendered=!1,e.legend=e.svg.append("g").attr("transform",e.getTranslate("legend")),!e.config.legend_show)return e.legend.style("visibility","hidden"),void(e.hiddenLegendIds=e.mapToIds(e.data.targets));e.updateLegendWithDefaults()},r.updateLegendWithDefaults=function(){var e=this;e.updateLegend(e.mapToIds(e.data.targets),{withTransform:!1,withTransitionForTransform:!1,withTransition:!1})},r.updateSizeForLegend=function(e,t){var i=this,n=i.config,a={top:i.isLegendTop?i.getCurrentPaddingTop()+n.legend_inset_y+5.5:i.currentHeight-e-i.getCurrentPaddingBottom()-n.legend_inset_y,left:i.isLegendLeft?i.getCurrentPaddingLeft()+n.legend_inset_x+.5:i.currentWidth-t-i.getCurrentPaddingRight()-n.legend_inset_x+.5};i.margin3={top:i.isLegendRight?0:i.isLegendInset?a.top:i.currentHeight-e,right:NaN,bottom:0,left:i.isLegendRight?i.currentWidth-t:i.isLegendInset?a.left:0}},r.transformLegend=function(e){var t=this;(e?t.legend.transition():t.legend).attr("transform",t.getTranslate("legend"))},r.updateLegendStep=function(e){this.legendStep=e},r.updateLegendItemWidth=function(e){this.legendItemWidth=e},r.updateLegendItemHeight=function(e){this.legendItemHeight=e},r.getLegendWidth=function(){var e=this;return e.config.legend_show?e.isLegendRight||e.isLegendInset?e.legendItemWidth*(e.legendStep+1):e.currentWidth:0},r.getLegendHeight=function(){var e=this,t=0;return e.config.legend_show&&(t=e.isLegendRight?e.currentHeight:Math.max(20,e.legendItemHeight)*(e.legendStep+1)),t},r.opacityForLegend=function(e){return e.classed(c.legendItemHidden)?null:1},r.opacityForUnfocusedLegend=function(e){return e.classed(c.legendItemHidden)?null:.3},r.toggleFocusLegend=function(e,t){var i=this;e=i.mapToTargetIds(e),i.legend.selectAll("."+c.legendItem).filter(function(t){return e.indexOf(t)>=0}).classed(c.legendItemFocused,t).transition().duration(100).style("opacity",function(){return(t?i.opacityForLegend:i.opacityForUnfocusedLegend).call(i,i.d3.select(this))})},r.revertLegend=function(){var e=this,t=e.d3;e.legend.selectAll("."+c.legendItem).classed(c.legendItemFocused,!1).transition().duration(100).style("opacity",function(){return e.opacityForLegend(t.select(this))})},r.showLegend=function(e){var t=this,i=t.config;i.legend_show||(i.legend_show=!0,t.legend.style("visibility","visible"),t.legendHasRendered||t.updateLegendWithDefaults()),t.removeHiddenLegendIds(e),t.legend.selectAll(t.selectorLegends(e)).style("visibility","visible").transition().style("opacity",function(){return t.opacityForLegend(t.d3.select(this))})},r.hideLegend=function(e){var t=this,i=t.config;i.legend_show&&v(e)&&(i.legend_show=!1,t.legend.style("visibility","hidden")),t.addHiddenLegendIds(e),t.legend.selectAll(t.selectorLegends(e)).style("opacity",0).style("visibility","hidden")},r.clearLegendItemTextBoxCache=function(){this.legendItemTextBox={}},r.updateLegend=function(e,t,i){function n(e,t){return C.legendItemTextBox[t]||(C.legendItemTextBox[t]=C.getTextRect(e.textContent,c.legendItem,e)),C.legendItemTextBox[t]}function a(t,i,a){function o(e,t){t||(s=(p-I-g)/2)<L&&(s=(p-g)/2,I=0,B++),D[e]=B,O[B]=C.isLegendInset?10:s,M[e]=I,I+=g}var s,r,l=0===a,c=a===e.length-1,d=n(t,i),h=d.width+R+(!c||C.isLegendRight||C.isLegendInset?A:0)+T.legend_padding,u=d.height+V,g=C.isLegendRight||C.isLegendInset?u:h,p=C.isLegendRight||C.isLegendInset?C.getLegendHeight():C.getLegendWidth();if(l&&(I=0,B=0,P=0,k=0),T.legend_show&&!C.isLegendToShow(i))return void(G[i]=E[i]=D[i]=M[i]=0);G[i]=h,E[i]=u,(!P||h>=P)&&(P=h),(!k||u>=k)&&(k=u),r=C.isLegendRight||C.isLegendInset?k:P,T.legend_equally?(Object.keys(G).forEach(function(e){G[e]=P}),Object.keys(E).forEach(function(e){E[e]=k}),s=(p-r*e.length)/2,s<L?(I=0,B=0,e.forEach(function(e){o(e)})):o(i,!0)):o(i)}var o,s,r,l,d,h,u,g,f,m,x,v,_,y,w,S,C=this,T=C.config,V=4,A=10,P=0,k=0,L=10,R=T.legend_item_tile_width+5,I=0,M={},G={},E={},O=[0],D={},B=0;e=e.filter(function(e){return!p(T.data_names[e])||null!==T.data_names[e]}),t=t||{},x=b(t,"withTransition",!0),v=b(t,"withTransitionForTransform",!0),C.isLegendInset&&(B=T.legend_inset_step?T.legend_inset_step:e.length,C.updateLegendStep(B)),C.isLegendRight?(o=function(e){return P*D[e]},l=function(e){return O[D[e]]+M[e]}):C.isLegendInset?(o=function(e){return P*D[e]+10},l=function(e){return O[D[e]]+M[e]}):(o=function(e){return O[D[e]]+M[e]},l=function(e){return k*D[e]}),s=function(e,t){return o(e,t)+4+T.legend_item_tile_width},d=function(e,t){return l(e,t)+9},r=function(e,t){return o(e,t)},h=function(e,t){return l(e,t)-5},u=function(e,t){return o(e,t)-2},g=function(e,t){return o(e,t)-2+T.legend_item_tile_width},f=function(e,t){return l(e,t)+4},m=C.legend.selectAll("."+c.legendItem).data(e).enter().append("g").attr("class",function(e){return C.generateClass(c.legendItem,e)}).style("visibility",function(e){return C.isLegendToShow(e)?"visible":"hidden"}).style("cursor","pointer").on("click",function(e){T.legend_item_onclick?T.legend_item_onclick.call(C,e):C.d3.event.altKey?(C.api.hide(),C.api.show(e)):(C.api.toggle(e),C.isTargetToShow(e)?C.api.focus(e):C.api.revert())}).on("mouseover",function(e){T.legend_item_onmouseover?T.legend_item_onmouseover.call(C,e):(C.d3.select(this).classed(c.legendItemFocused,!0),!C.transiting&&C.isTargetToShow(e)&&C.api.focus(e))}).on("mouseout",function(e){T.legend_item_onmouseout?T.legend_item_onmouseout.call(C,e):(C.d3.select(this).classed(c.legendItemFocused,!1),C.api.revert())}),m.append("text").text(function(e){return p(T.data_names[e])?T.data_names[e]:e}).each(function(e,t){a(this,e,t)}).style("pointer-events","none").attr("x",C.isLegendRight||C.isLegendInset?s:-200).attr("y",C.isLegendRight||C.isLegendInset?-200:d),m.append("rect").attr("class",c.legendItemEvent).style("fill-opacity",0).attr("x",C.isLegendRight||C.isLegendInset?r:-200).attr("y",C.isLegendRight||C.isLegendInset?-200:h),m.append("line").attr("class",c.legendItemTile).style("stroke",C.color).style("pointer-events","none").attr("x1",C.isLegendRight||C.isLegendInset?u:-200).attr("y1",C.isLegendRight||C.isLegendInset?-200:f).attr("x2",C.isLegendRight||C.isLegendInset?g:-200).attr("y2",C.isLegendRight||C.isLegendInset?-200:f).attr("stroke-width",T.legend_item_tile_height),S=C.legend.select("."+c.legendBackground+" rect"),C.isLegendInset&&P>0&&0===S.size()&&(S=C.legend.insert("g","."+c.legendItem).attr("class",c.legendBackground).append("rect")),_=C.legend.selectAll("text").data(e).text(function(e){return p(T.data_names[e])?T.data_names[e]:e}).each(function(e,t){a(this,e,t)}),(x?_.transition():_).attr("x",s).attr("y",d),y=C.legend.selectAll("rect."+c.legendItemEvent).data(e),(x?y.transition():y).attr("width",function(e){return G[e]}).attr("height",function(e){return E[e]}).attr("x",r).attr("y",h),w=C.legend.selectAll("line."+c.legendItemTile).data(e),(x?w.transition():w).style("stroke",C.color).attr("x1",u).attr("y1",f).attr("x2",g).attr("y2",f),S&&(x?S.transition():S).attr("height",C.getLegendHeight()-12).attr("width",P*(B+1)+10),C.legend.selectAll("."+c.legendItem).classed(c.legendItemHidden,function(e){return!C.isTargetToShow(e)}),C.updateLegendItemWidth(P),C.updateLegendItemHeight(k),C.updateLegendStep(B),C.updateSizes(),C.updateScales(),C.updateSvgSize(),C.transformAll(v,i),C.legendHasRendered=!0},r.initTitle=function(){var e=this;e.title=e.svg.append("text").text(e.config.title_text).attr("class",e.CLASS.title)},r.redrawTitle=function(){var e=this;e.title.attr("x",e.xForTitle.bind(e)).attr("y",e.yForTitle.bind(e))},r.xForTitle=function(){var e=this,t=e.config,i=t.title_position||"left";return i.indexOf("right")>=0?e.currentWidth-e.getTextRect(e.title.node().textContent,e.CLASS.title,e.title.node()).width-t.title_padding.right:i.indexOf("center")>=0?(e.currentWidth-e.getTextRect(e.title.node().textContent,e.CLASS.title,e.title.node()).width)/2:t.title_padding.left},r.yForTitle=function(){var e=this;return e.config.title_padding.top+e.getTextRect(e.title.node().textContent,e.CLASS.title,e.title.node()).height},r.getTitlePadding=function(){var e=this;return e.yForTitle()+e.config.title_padding.bottom},function(e,t){if(Object.create)t.prototype=Object.create(e.prototype);else{var i=function(){};i.prototype=e.prototype,t.prototype=new i}t.prototype.constructor=t}(t,a),a.prototype.init=function(){var e=this.owner,t=e.config,i=e.main;e.axes.x=i.append("g").attr("class",c.axis+" "+c.axisX).attr("clip-path",e.clipPathForXAxis).attr("transform",e.getTranslate("x")).style("visibility",t.axis_x_show?"visible":"hidden"),e.axes.x.append("text").attr("class",c.axisXLabel).attr("transform",t.axis_rotated?"rotate(-90)":"").style("text-anchor",this.textAnchorForXAxisLabel.bind(this)),e.axes.y=i.append("g").attr("class",c.axis+" "+c.axisY).attr("clip-path",t.axis_y_inner?"":e.clipPathForYAxis).attr("transform",e.getTranslate("y")).style("visibility",t.axis_y_show?"visible":"hidden"),e.axes.y.append("text").attr("class",c.axisYLabel).attr("transform",t.axis_rotated?"":"rotate(-90)").style("text-anchor",this.textAnchorForYAxisLabel.bind(this)),e.axes.y2=i.append("g").attr("class",c.axis+" "+c.axisY2).attr("transform",e.getTranslate("y2")).style("visibility",t.axis_y2_show?"visible":"hidden"),e.axes.y2.append("text").attr("class",c.axisY2Label).attr("transform",t.axis_rotated?"":"rotate(-90)").style("text-anchor",this.textAnchorForY2AxisLabel.bind(this))},a.prototype.getXAxis=function(e,t,i,n,a,s,r){var l=this.owner,c=l.config,d={isCategory:l.isCategorized(),withOuterTick:a,tickMultiline:c.axis_x_tick_multiline,tickWidth:c.axis_x_tick_width,tickTextRotate:r?0:c.axis_x_tick_rotate,withoutTransition:s},h=o(l.d3,d).scale(e).orient(t);return l.isTimeSeries()&&n&&"function"!=typeof n&&(n=n.map(function(e){return l.parseDate(e)})),h.tickFormat(i).tickValues(n),l.isCategorized()&&(h.tickCentered(c.axis_x_tick_centered),v(c.axis_x_tick_culling)&&(c.axis_x_tick_culling=!1)),h},a.prototype.updateXAxisTickValues=function(e,t){var i,n=this.owner,a=n.config;return(a.axis_x_tick_fit||a.axis_x_tick_count)&&(i=this.generateTickValues(n.mapTargetsToUniqueXs(e),a.axis_x_tick_count,n.isTimeSeries())),t?t.tickValues(i):(n.xAxis.tickValues(i),n.subXAxis.tickValues(i)),i},a.prototype.getYAxis=function(e,t,i,n,a,s,r){var l=this.owner,c=l.config,d={withOuterTick:a,withoutTransition:s,tickTextRotate:r?0:c.axis_y_tick_rotate},h=o(l.d3,d).scale(e).orient(t).tickFormat(i);return l.isTimeSeriesY()?h.ticks(l.d3.time[c.axis_y_tick_time_value],c.axis_y_tick_time_interval):h.tickValues(n),h},a.prototype.getId=function(e){var t=this.owner.config;return e in t.data_axes?t.data_axes[e]:"y"},a.prototype.getXAxisTickFormat=function(){var e=this.owner,t=e.config,i=e.isTimeSeries()?e.defaultAxisTimeFormat:e.isCategorized()?e.categoryName:function(e){return e<0?e.toFixed(0):e};return t.axis_x_tick_format&&(h(t.axis_x_tick_format)?i=t.axis_x_tick_format:e.isTimeSeries()&&(i=function(i){return i?e.axisTimeFormat(t.axis_x_tick_format)(i):""})),h(i)?function(t){return i.call(e,t)}:i},a.prototype.getTickValues=function(e,t){return e||(t?t.tickValues():void 0)},a.prototype.getXAxisTickValues=function(){return this.getTickValues(this.owner.config.axis_x_tick_values,this.owner.xAxis)},a.prototype.getYAxisTickValues=function(){return this.getTickValues(this.owner.config.axis_y_tick_values,this.owner.yAxis)},a.prototype.getY2AxisTickValues=function(){return this.getTickValues(this.owner.config.axis_y2_tick_values,this.owner.y2Axis)},a.prototype.getLabelOptionByAxisId=function(e){var t,i=this.owner,n=i.config;return"y"===e?t=n.axis_y_label:"y2"===e?t=n.axis_y2_label:"x"===e&&(t=n.axis_x_label),t},a.prototype.getLabelText=function(e){var t=this.getLabelOptionByAxisId(e);return u(t)?t:t?t.text:null},a.prototype.setLabelText=function(e,t){var i=this.owner,n=i.config,a=this.getLabelOptionByAxisId(e);u(a)?"y"===e?n.axis_y_label=t:"y2"===e?n.axis_y2_label=t:"x"===e&&(n.axis_x_label=t):a&&(a.text=t)},a.prototype.getLabelPosition=function(e,t){var i=this.getLabelOptionByAxisId(e),n=i&&"object"===(void 0===i?"undefined":_typeof(i))&&i.position?i.position:t;return{isInner:n.indexOf("inner")>=0,isOuter:n.indexOf("outer")>=0,isLeft:n.indexOf("left")>=0,isCenter:n.indexOf("center")>=0,isRight:n.indexOf("right")>=0,isTop:n.indexOf("top")>=0,isMiddle:n.indexOf("middle")>=0,isBottom:n.indexOf("bottom")>=0}},a.prototype.getXAxisLabelPosition=function(){return this.getLabelPosition("x",this.owner.config.axis_rotated?"inner-top":"inner-right")},a.prototype.getYAxisLabelPosition=function(){return this.getLabelPosition("y",this.owner.config.axis_rotated?"inner-right":"inner-top")},a.prototype.getY2AxisLabelPosition=function(){return this.getLabelPosition("y2",this.owner.config.axis_rotated?"inner-right":"inner-top")},a.prototype.getLabelPositionById=function(e){return"y2"===e?this.getY2AxisLabelPosition():"y"===e?this.getYAxisLabelPosition():this.getXAxisLabelPosition()},a.prototype.textForXAxisLabel=function(){return this.getLabelText("x")},a.prototype.textForYAxisLabel=function(){return this.getLabelText("y")},a.prototype.textForY2AxisLabel=function(){return this.getLabelText("y2")},a.prototype.xForAxisLabel=function(e,t){var i=this.owner;return e?t.isLeft?0:t.isCenter?i.width/2:i.width:t.isBottom?-i.height:t.isMiddle?-i.height/2:0},a.prototype.dxForAxisLabel=function(e,t){return e?t.isLeft?"0.5em":t.isRight?"-0.5em":"0":t.isTop?"-0.5em":t.isBottom?"0.5em":"0"},a.prototype.textAnchorForAxisLabel=function(e,t){return e?t.isLeft?"start":t.isCenter?"middle":"end":t.isBottom?"start":t.isMiddle?"middle":"end"},a.prototype.xForXAxisLabel=function(){return this.xForAxisLabel(!this.owner.config.axis_rotated,this.getXAxisLabelPosition())},a.prototype.xForYAxisLabel=function(){return this.xForAxisLabel(this.owner.config.axis_rotated,this.getYAxisLabelPosition())},a.prototype.xForY2AxisLabel=function(){return this.xForAxisLabel(this.owner.config.axis_rotated,this.getY2AxisLabelPosition())},a.prototype.dxForXAxisLabel=function(){return this.dxForAxisLabel(!this.owner.config.axis_rotated,this.getXAxisLabelPosition())},a.prototype.dxForYAxisLabel=function(){return this.dxForAxisLabel(this.owner.config.axis_rotated,this.getYAxisLabelPosition())},a.prototype.dxForY2AxisLabel=function(){return this.dxForAxisLabel(this.owner.config.axis_rotated,this.getY2AxisLabelPosition())},a.prototype.dyForXAxisLabel=function(){var e=this.owner,t=e.config,i=this.getXAxisLabelPosition();return t.axis_rotated?i.isInner?"1.2em":-25-this.getMaxTickWidth("x"):i.isInner?"-0.5em":t.axis_x_height?t.axis_x_height-10:"3em"},a.prototype.dyForYAxisLabel=function(){var e=this.owner,t=this.getYAxisLabelPosition();return e.config.axis_rotated?t.isInner?"-0.5em":"3em":t.isInner?"1.2em":-10-(e.config.axis_y_inner?0:this.getMaxTickWidth("y")+10)},a.prototype.dyForY2AxisLabel=function(){var e=this.owner,t=this.getY2AxisLabelPosition();return e.config.axis_rotated?t.isInner?"1.2em":"-2.2em":t.isInner?"-0.5em":15+(e.config.axis_y2_inner?0:this.getMaxTickWidth("y2")+15)},a.prototype.textAnchorForXAxisLabel=function(){var e=this.owner;return this.textAnchorForAxisLabel(!e.config.axis_rotated,this.getXAxisLabelPosition())},a.prototype.textAnchorForYAxisLabel=function(){var e=this.owner;return this.textAnchorForAxisLabel(e.config.axis_rotated,this.getYAxisLabelPosition())},a.prototype.textAnchorForY2AxisLabel=function(){var e=this.owner;return this.textAnchorForAxisLabel(e.config.axis_rotated,this.getY2AxisLabelPosition())},a.prototype.getMaxTickWidth=function(e,t){var i,n,a,o,s,r=this.owner,l=r.config,c=0;return t&&r.currentMaxTickWidths[e]?r.currentMaxTickWidths[e]:(r.svg&&(i=r.filterTargetsToShow(r.data.targets),"y"===e?(n=r.y.copy().domain(r.getYDomain(i,"y")),a=this.getYAxis(n,r.yOrient,l.axis_y_tick_format,r.yAxisTickValues,!1,!0,!0)):"y2"===e?(n=r.y2.copy().domain(r.getYDomain(i,"y2")),a=this.getYAxis(n,r.y2Orient,l.axis_y2_tick_format,r.y2AxisTickValues,!1,!0,!0)):(n=r.x.copy().domain(r.getXDomain(i)),a=this.getXAxis(n,r.xOrient,r.xAxisTickFormat,r.xAxisTickValues,!1,!0,!0),this.updateXAxisTickValues(i,a)),o=r.d3.select("body").append("div").classed("c3",!0),s=o.append("svg").style("visibility","hidden").style("position","fixed").style("top",0).style("left",0),s.append("g").call(a).each(function(){r.d3.select(this).selectAll("text").each(function(){var e=this.getBoundingClientRect();c<e.width&&(c=e.width)}),o.remove()})),r.currentMaxTickWidths[e]=c<=0?r.currentMaxTickWidths[e]:c,r.currentMaxTickWidths[e])},a.prototype.updateLabels=function(e){var t=this.owner,i=t.main.select("."+c.axisX+" ."+c.axisXLabel),n=t.main.select("."+c.axisY+" ."+c.axisYLabel),a=t.main.select("."+c.axisY2+" ."+c.axisY2Label);(e?i.transition():i).attr("x",this.xForXAxisLabel.bind(this)).attr("dx",this.dxForXAxisLabel.bind(this)).attr("dy",this.dyForXAxisLabel.bind(this)).text(this.textForXAxisLabel.bind(this)),(e?n.transition():n).attr("x",this.xForYAxisLabel.bind(this)).attr("dx",this.dxForYAxisLabel.bind(this)).attr("dy",this.dyForYAxisLabel.bind(this)).text(this.textForYAxisLabel.bind(this)),(e?a.transition():a).attr("x",this.xForY2AxisLabel.bind(this)).attr("dx",this.dxForY2AxisLabel.bind(this)).attr("dy",this.dyForY2AxisLabel.bind(this)).text(this.textForY2AxisLabel.bind(this))},a.prototype.getPadding=function(e,t,i,n){var a="number"==typeof e?e:e[t];return d(a)?"ratio"===e.unit?e[t]*n:this.convertPixelsToAxisPadding(a,n):i},a.prototype.convertPixelsToAxisPadding=function(e,t){var i=this.owner;return t*(e/(i.config.axis_rotated?i.width:i.height))},a.prototype.generateTickValues=function(e,t,i){var n,a,o,s,r,l,c,d=e;if(t)if(1===(n=h(t)?t():t))d=[e[0]];else if(2===n)d=[e[0],e[e.length-1]];else if(n>2){for(s=n-2,a=e[0],o=e[e.length-1],r=(o-a)/(s+1),d=[a],l=0;l<s;l++)c=+a+r*(l+1),d.push(i?new Date(c):c);d.push(o)}return i||(d=d.sort(function(e,t){return e-t})),d},a.prototype.generateTransitions=function(e){var t=this.owner,i=t.axes;return{axisX:e?i.x.transition().duration(e):i.x,axisY:e?i.y.transition().duration(e):i.y,axisY2:e?i.y2.transition().duration(e):i.y2,axisSubX:e?i.subx.transition().duration(e):i.subx}},a.prototype.redraw=function(e,t){var i=this.owner;i.axes.x.style("opacity",t?0:1),i.axes.y.style("opacity",t?0:1),i.axes.y2.style("opacity",t?0:1),i.axes.subx.style("opacity",t?0:1),e.axisX.call(i.xAxis),e.axisY.call(i.yAxis),e.axisY2.call(i.y2Axis),e.axisSubX.call(i.subXAxis)},r.getClipPath=function(t){return"url("+(e.navigator.appVersion.toLowerCase().indexOf("msie 9.")>=0?"":document.URL.split("#")[0])+"#"+t+")"},r.appendClip=function(e,t){return e.append("clipPath").attr("id",t).append("rect")},r.getAxisClipX=function(e){var t=Math.max(30,this.margin.left);return e?-(1+t):-(t-1)},r.getAxisClipY=function(e){return e?-20:-this.margin.top},r.getXAxisClipX=function(){var e=this;return e.getAxisClipX(!e.config.axis_rotated)},r.getXAxisClipY=function(){var e=this;return e.getAxisClipY(!e.config.axis_rotated)},r.getYAxisClipX=function(){var e=this;return e.config.axis_y_inner?-1:e.getAxisClipX(e.config.axis_rotated)},r.getYAxisClipY=function(){var e=this;return e.getAxisClipY(e.config.axis_rotated)},r.getAxisClipWidth=function(e){var t=this,i=Math.max(30,t.margin.left),n=Math.max(30,t.margin.right);return e?t.width+2+i+n:t.margin.left+20},r.getAxisClipHeight=function(e){return(e?this.margin.bottom:this.margin.top+this.height)+20},r.getXAxisClipWidth=function(){var e=this;return e.getAxisClipWidth(!e.config.axis_rotated)},r.getXAxisClipHeight=function(){var e=this;return e.getAxisClipHeight(!e.config.axis_rotated)},r.getYAxisClipWidth=function(){var e=this;return e.getAxisClipWidth(e.config.axis_rotated)+(e.config.axis_y_inner?20:0)},r.getYAxisClipHeight=function(){var e=this;return e.getAxisClipHeight(e.config.axis_rotated)},r.initPie=function(){var e=this,t=e.d3,i=e.config;e.pie=t.layout.pie().value(function(e){return e.values.reduce(function(e,t){return e+t.value},0)}),i.data_order||e.pie.sort(null)},r.updateRadius=function(){var e=this,t=e.config,i=t.gauge_width||t.donut_width;e.radiusExpanded=Math.min(e.arcWidth,e.arcHeight)/2,e.radius=.95*e.radiusExpanded,e.innerRadiusRatio=i?(e.radius-i)/e.radius:.6,e.innerRadius=e.hasType("donut")||e.hasType("gauge")?e.radius*e.innerRadiusRatio:0},r.updateArc=function(){var e=this;e.svgArc=e.getSvgArc(),e.svgArcExpanded=e.getSvgArcExpanded(),e.svgArcExpandedSub=e.getSvgArcExpanded(.98)},r.updateAngle=function(e){var t,i,n,a,o=this,s=o.config,r=!1,l=0;return s?(o.pie(o.filterTargetsToShow(o.data.targets)).forEach(function(t){r||t.data.id!==e.data.id||(r=!0,e=t,e.index=l),l++}),isNaN(e.startAngle)&&(e.startAngle=0),isNaN(e.endAngle)&&(e.endAngle=e.startAngle),o.isGaugeType(e.data)&&(t=s.gauge_min,i=s.gauge_max,n=Math.PI*(s.gauge_fullCircle?2:1)/(i-t),a=e.value<t?0:e.value<i?e.value-t:i-t,e.startAngle=s.gauge_startingAngle,e.endAngle=e.startAngle+n*a),r?e:null):null},r.getSvgArc=function(){var e=this,t=e.d3.svg.arc().outerRadius(e.radius).innerRadius(e.innerRadius),i=function(i,n){var a;return n?t(i):(a=e.updateAngle(i),a?t(a):"M 0 0")};return i.centroid=t.centroid,i},r.getSvgArcExpanded=function(e){var t=this,i=t.d3.svg.arc().outerRadius(t.radiusExpanded*(e||1)).innerRadius(t.innerRadius);return function(e){var n=t.updateAngle(e);return n?i(n):"M 0 0"}},r.getArc=function(e,t,i){return i||this.isArcType(e.data)?this.svgArc(e,t):"M 0 0"},r.transformForArcLabel=function(e){var t,i,n,a,o,s=this,r=s.config,l=s.updateAngle(e),c="";return l&&!s.hasType("gauge")&&(t=this.svgArc.centroid(l),i=isNaN(t[0])?0:t[0],n=isNaN(t[1])?0:t[1],a=Math.sqrt(i*i+n*n),o=s.hasType("donut")&&r.donut_label_ratio?h(r.donut_label_ratio)?r.donut_label_ratio(e,s.radius,a):r.donut_label_ratio:s.hasType("pie")&&r.pie_label_ratio?h(r.pie_label_ratio)?r.pie_label_ratio(e,s.radius,a):r.pie_label_ratio:s.radius&&a?(36/s.radius>.375?1.175-36/s.radius:.8)*s.radius/a:0,c="translate("+i*o+","+n*o+")"),c},r.getArcRatio=function(e){var t=this,i=t.config,n=Math.PI*(t.hasType("gauge")&&!i.gauge_fullCircle?1:2);return e?(e.endAngle-e.startAngle)/n:null},r.convertToArcData=function(e){return this.addName({id:e.data.id,value:e.value,ratio:this.getArcRatio(e),index:e.index})},r.textForArcLabel=function(e){var t,i,n,a,o,s=this;return s.shouldShowArcLabel()?(t=s.updateAngle(e),i=t?t.value:null,n=s.getArcRatio(t),a=e.data.id,s.hasType("gauge")||s.meetsArcLabelThreshold(n)?(o=s.getArcLabelFormat(),o?o(i,n,a):s.defaultArcValueFormat(i,n)):""):""},r.expandArc=function(t){var i,n=this;if(n.transiting)return void(i=e.setInterval(function(){n.transiting||(e.clearInterval(i),n.legend.selectAll(".c3-legend-item-focused").size()>0&&n.expandArc(t))},10));t=n.mapToTargetIds(t),n.svg.selectAll(n.selectorTargets(t,"."+c.chartArc)).each(function(e){n.shouldExpand(e.data.id)&&n.d3.select(this).selectAll("path").transition().duration(n.expandDuration(e.data.id)).attr("d",n.svgArcExpanded).transition().duration(2*n.expandDuration(e.data.id)).attr("d",n.svgArcExpandedSub).each(function(e){n.isDonutType(e.data)})})},r.unexpandArc=function(e){var t=this;t.transiting||(e=t.mapToTargetIds(e),t.svg.selectAll(t.selectorTargets(e,"."+c.chartArc)).selectAll("path").transition().duration(function(e){return t.expandDuration(e.data.id)}).attr("d",t.svgArc),t.svg.selectAll("."+c.arc).style("opacity",1))},r.expandDuration=function(e){var t=this,i=t.config;return t.isDonutType(e)?i.donut_expand_duration:t.isGaugeType(e)?i.gauge_expand_duration:t.isPieType(e)?i.pie_expand_duration:50},r.shouldExpand=function(e){var t=this,i=t.config;return t.isDonutType(e)&&i.donut_expand||t.isGaugeType(e)&&i.gauge_expand||t.isPieType(e)&&i.pie_expand},r.shouldShowArcLabel=function(){var e=this,t=e.config,i=!0;return e.hasType("donut")?i=t.donut_label_show:e.hasType("pie")&&(i=t.pie_label_show),i},r.meetsArcLabelThreshold=function(e){var t=this,i=t.config;return e>=(t.hasType("donut")?i.donut_label_threshold:i.pie_label_threshold)},r.getArcLabelFormat=function(){var e=this,t=e.config,i=t.pie_label_format;return e.hasType("gauge")?i=t.gauge_label_format:e.hasType("donut")&&(i=t.donut_label_format),i},r.getArcTitle=function(){var e=this;return e.hasType("donut")?e.config.donut_title:""},r.updateTargetsForArc=function(e){var t,i,n=this,a=n.main,o=n.classChartArc.bind(n),s=n.classArcs.bind(n),r=n.classFocus.bind(n);t=a.select("."+c.chartArcs).selectAll("."+c.chartArc).data(n.pie(e)).attr("class",function(e){return o(e)+r(e.data)}),i=t.enter().append("g").attr("class",o),i.append("g").attr("class",s),i.append("text").attr("dy",n.hasType("gauge")?"-.1em":".35em").style("opacity",0).style("text-anchor","middle").style("pointer-events","none")},r.initArc=function(){var e=this;e.arcs=e.main.select("."+c.chart).append("g").attr("class",c.chartArcs).attr("transform",e.getTranslate("arc")),e.arcs.append("text").attr("class",c.chartArcsTitle).style("text-anchor","middle").text(e.getArcTitle())},r.redrawArc=function(e,t,i){
var n,a=this,o=a.d3,s=a.config,r=a.main;n=r.selectAll("."+c.arcs).selectAll("."+c.arc).data(a.arcData.bind(a)),n.enter().append("path").attr("class",a.classArc.bind(a)).style("fill",function(e){return a.color(e.data)}).style("cursor",function(e){return s.interaction_enabled&&s.data_selection_isselectable(e)?"pointer":null}).style("opacity",0).each(function(e){a.isGaugeType(e.data)&&(e.startAngle=e.endAngle=s.gauge_startingAngle),this._current=e}),n.attr("transform",function(e){return!a.isGaugeType(e.data)&&i?"scale(0)":""}).style("opacity",function(e){return e===this._current?0:1}).on("mouseover",s.interaction_enabled?function(e){var t,i;a.transiting||(t=a.updateAngle(e))&&(i=a.convertToArcData(t),a.expandArc(t.data.id),a.api.focus(t.data.id),a.toggleFocusLegend(t.data.id,!0),a.config.data_onmouseover(i,this))}:null).on("mousemove",s.interaction_enabled?function(e){var t,i,n=a.updateAngle(e);n&&(t=a.convertToArcData(n),i=[t],a.showTooltip(i,this))}:null).on("mouseout",s.interaction_enabled?function(e){var t,i;a.transiting||(t=a.updateAngle(e))&&(i=a.convertToArcData(t),a.unexpandArc(t.data.id),a.api.revert(),a.revertLegend(),a.hideTooltip(),a.config.data_onmouseout(i,this))}:null).on("click",s.interaction_enabled?function(e,t){var i,n=a.updateAngle(e);n&&(i=a.convertToArcData(n),a.toggleShape&&a.toggleShape(this,i,t),a.config.data_onclick.call(a.api,i,this))}:null).each(function(){a.transiting=!0}).transition().duration(e).attrTween("d",function(e){var t,i=a.updateAngle(e);return i?(isNaN(this._current.startAngle)&&(this._current.startAngle=0),isNaN(this._current.endAngle)&&(this._current.endAngle=this._current.startAngle),t=o.interpolate(this._current,i),this._current=t(0),function(i){var n=t(i);return n.data=e.data,a.getArc(n,!0)}):function(){return"M 0 0"}}).attr("transform",i?"scale(1)":"").style("fill",function(e){return a.levelColor?a.levelColor(e.data.values[0].value):a.color(e.data.id)}).style("opacity",1).call(a.endall,function(){a.transiting=!1}),n.exit().transition().duration(t).style("opacity",0).remove(),r.selectAll("."+c.chartArc).select("text").style("opacity",0).attr("class",function(e){return a.isGaugeType(e.data)?c.gaugeValue:""}).text(a.textForArcLabel.bind(a)).attr("transform",a.transformForArcLabel.bind(a)).style("font-size",function(e){return a.isGaugeType(e.data)?Math.round(a.radius/5)+"px":""}).transition().duration(e).style("opacity",function(e){return a.isTargetToShow(e.data.id)&&a.isArcType(e.data)?1:0}),r.select("."+c.chartArcsTitle).style("opacity",a.hasType("donut")||a.hasType("gauge")?1:0),a.hasType("gauge")&&(a.arcs.select("."+c.chartArcsBackground).attr("d",function(){var e={data:[{value:s.gauge_max}],startAngle:s.gauge_startingAngle,endAngle:-1*s.gauge_startingAngle};return a.getArc(e,!0,!0)}),a.arcs.select("."+c.chartArcsGaugeUnit).attr("dy",".75em").text(s.gauge_label_show?s.gauge_units:""),a.arcs.select("."+c.chartArcsGaugeMin).attr("dx",-1*(a.innerRadius+(a.radius-a.innerRadius)/(s.gauge_fullCircle?1:2))+"px").attr("dy","1.2em").text(s.gauge_label_show?s.gauge_min:""),a.arcs.select("."+c.chartArcsGaugeMax).attr("dx",a.innerRadius+(a.radius-a.innerRadius)/(s.gauge_fullCircle?1:2)+"px").attr("dy","1.2em").text(s.gauge_label_show?s.gauge_max:""))},r.initGauge=function(){var e=this.arcs;this.hasType("gauge")&&(e.append("path").attr("class",c.chartArcsBackground),e.append("text").attr("class",c.chartArcsGaugeUnit).style("text-anchor","middle").style("pointer-events","none"),e.append("text").attr("class",c.chartArcsGaugeMin).style("text-anchor","middle").style("pointer-events","none"),e.append("text").attr("class",c.chartArcsGaugeMax).style("text-anchor","middle").style("pointer-events","none"))},r.getGaugeLabelHeight=function(){return this.config.gauge_label_show?20:0},r.initRegion=function(){var e=this;e.region=e.main.append("g").attr("clip-path",e.clipPath).attr("class",c.regions)},r.updateRegion=function(e){var t=this,i=t.config;t.region.style("visibility",t.hasArcType()?"hidden":"visible"),t.mainRegion=t.main.select("."+c.regions).selectAll("."+c.region).data(i.regions),t.mainRegion.enter().append("g").append("rect").style("fill-opacity",0),t.mainRegion.attr("class",t.classRegion.bind(t)),t.mainRegion.exit().transition().duration(e).style("opacity",0).remove()},r.redrawRegion=function(e){var t=this,i=t.mainRegion.selectAll("rect").each(function(){var e=t.d3.select(this.parentNode).datum();t.d3.select(this).datum(e)}),n=t.regionX.bind(t),a=t.regionY.bind(t),o=t.regionWidth.bind(t),s=t.regionHeight.bind(t);return[(e?i.transition():i).attr("x",n).attr("y",a).attr("width",o).attr("height",s).style("fill-opacity",function(e){return d(e.opacity)?e.opacity:.1})]},r.regionX=function(e){var t=this,i=t.config,n="y"===e.axis?t.y:t.y2;return"y"===e.axis||"y2"===e.axis?i.axis_rotated&&"start"in e?n(e.start):0:i.axis_rotated?0:"start"in e?t.x(t.isTimeSeries()?t.parseDate(e.start):e.start):0},r.regionY=function(e){var t=this,i=t.config,n="y"===e.axis?t.y:t.y2;return"y"===e.axis||"y2"===e.axis?i.axis_rotated?0:"end"in e?n(e.end):0:i.axis_rotated&&"start"in e?t.x(t.isTimeSeries()?t.parseDate(e.start):e.start):0},r.regionWidth=function(e){var t,i=this,n=i.config,a=i.regionX(e),o="y"===e.axis?i.y:i.y2;return t="y"===e.axis||"y2"===e.axis?n.axis_rotated&&"end"in e?o(e.end):i.width:n.axis_rotated?i.width:"end"in e?i.x(i.isTimeSeries()?i.parseDate(e.end):e.end):i.width,t<a?0:t-a},r.regionHeight=function(e){var t,i=this,n=i.config,a=this.regionY(e),o="y"===e.axis?i.y:i.y2;return t="y"===e.axis||"y2"===e.axis?n.axis_rotated?i.height:"start"in e?o(e.start):i.height:n.axis_rotated&&"end"in e?i.x(i.isTimeSeries()?i.parseDate(e.end):e.end):i.height,t<a?0:t-a},r.isRegionOnX=function(e){return!e.axis||"x"===e.axis},r.drag=function(e){var t,i,n,a,o,s,r,l,d=this,h=d.config,u=d.main,g=d.d3;d.hasArcType()||h.data_selection_enabled&&(h.zoom_enabled&&!d.zoom.altDomain||h.data_selection_multiple&&(t=d.dragStart[0],i=d.dragStart[1],n=e[0],a=e[1],o=Math.min(t,n),s=Math.max(t,n),r=h.data_selection_grouped?d.margin.top:Math.min(i,a),l=h.data_selection_grouped?d.height:Math.max(i,a),u.select("."+c.dragarea).attr("x",o).attr("y",r).attr("width",s-o).attr("height",l-r),u.selectAll("."+c.shapes).selectAll("."+c.shape).filter(function(e){return h.data_selection_isselectable(e)}).each(function(e,t){var i,n,a,h,u,p,f=g.select(this),m=f.classed(c.SELECTED),x=f.classed(c.INCLUDED),v=!1;if(f.classed(c.circle))i=1*f.attr("cx"),n=1*f.attr("cy"),u=d.togglePoint,v=o<i&&i<s&&r<n&&n<l;else{if(!f.classed(c.bar))return;p=S(this),i=p.x,n=p.y,a=p.width,h=p.height,u=d.togglePath,v=!(s<i||i+a<o||l<n||n+h<r)}v^x&&(f.classed(c.INCLUDED,!x),f.classed(c.SELECTED,!m),u.call(d,!m,f,e,t))})))},r.dragstart=function(e){var t=this,i=t.config;t.hasArcType()||i.data_selection_enabled&&(t.dragStart=e,t.main.select("."+c.chart).append("rect").attr("class",c.dragarea).style("opacity",.1),t.dragging=!0)},r.dragend=function(){var e=this,t=e.config;e.hasArcType()||t.data_selection_enabled&&(e.main.select("."+c.dragarea).transition().duration(100).style("opacity",0).remove(),e.main.selectAll("."+c.shape).classed(c.INCLUDED,!1),e.dragging=!1)},r.selectPoint=function(e,t,i){var n=this,a=n.config,o=(a.axis_rotated?n.circleY:n.circleX).bind(n),s=(a.axis_rotated?n.circleX:n.circleY).bind(n),r=n.pointSelectR.bind(n);a.data_onselected.call(n.api,t,e.node()),n.main.select("."+c.selectedCircles+n.getTargetSelectorSuffix(t.id)).selectAll("."+c.selectedCircle+"-"+i).data([t]).enter().append("circle").attr("class",function(){return n.generateClass(c.selectedCircle,i)}).attr("cx",o).attr("cy",s).attr("stroke",function(){return n.color(t)}).attr("r",function(e){return 1.4*n.pointSelectR(e)}).transition().duration(100).attr("r",r)},r.unselectPoint=function(e,t,i){var n=this;n.config.data_onunselected.call(n.api,t,e.node()),n.main.select("."+c.selectedCircles+n.getTargetSelectorSuffix(t.id)).selectAll("."+c.selectedCircle+"-"+i).transition().duration(100).attr("r",0).remove()},r.togglePoint=function(e,t,i,n){e?this.selectPoint(t,i,n):this.unselectPoint(t,i,n)},r.selectPath=function(e,t){var i=this;i.config.data_onselected.call(i,t,e.node()),i.config.interaction_brighten&&e.transition().duration(100).style("fill",function(){return i.d3.rgb(i.color(t)).brighter(.75)})},r.unselectPath=function(e,t){var i=this;i.config.data_onunselected.call(i,t,e.node()),i.config.interaction_brighten&&e.transition().duration(100).style("fill",function(){return i.color(t)})},r.togglePath=function(e,t,i,n){e?this.selectPath(t,i,n):this.unselectPath(t,i,n)},r.getToggle=function(e,t){var i,n=this;return"circle"===e.nodeName?i=n.isStepType(t)?function(){}:n.togglePoint:"path"===e.nodeName&&(i=n.togglePath),i},r.toggleShape=function(e,t,i){var n=this,a=n.d3,o=n.config,s=a.select(e),r=s.classed(c.SELECTED),l=n.getToggle(e,t).bind(n);o.data_selection_enabled&&o.data_selection_isselectable(t)&&(o.data_selection_multiple||n.main.selectAll("."+c.shapes+(o.data_selection_grouped?n.getTargetSelectorSuffix(t.id):"")).selectAll("."+c.shape).each(function(e,t){var i=a.select(this);i.classed(c.SELECTED)&&l(!1,i.classed(c.SELECTED,!1),e,t)}),s.classed(c.SELECTED,!r),l(!r,s,t,i))},r.initBrush=function(){var e=this,t=e.d3;e.brush=t.svg.brush().on("brush",function(){e.redrawForBrush()}),e.brush.update=function(){return e.context&&e.context.select("."+c.brush).call(this),this},e.brush.scale=function(t){return e.config.axis_rotated?this.y(t):this.x(t)}},r.initSubchart=function(){var e=this,t=e.config,i=e.context=e.svg.append("g").attr("transform",e.getTranslate("context")),n=t.subchart_show?"visible":"hidden";i.style("visibility",n),i.append("g").attr("clip-path",e.clipPathForSubchart).attr("class",c.chart),i.select("."+c.chart).append("g").attr("class",c.chartBars),i.select("."+c.chart).append("g").attr("class",c.chartLines),i.append("g").attr("clip-path",e.clipPath).attr("class",c.brush).call(e.brush),e.axes.subx=i.append("g").attr("class",c.axisX).attr("transform",e.getTranslate("subx")).attr("clip-path",t.axis_rotated?"":e.clipPathForXAxis).style("visibility",t.subchart_axis_x_show?n:"hidden")},r.updateTargetsForSubchart=function(e){var t,i,n,a,o=this,s=o.context,r=o.config,l=o.classChartBar.bind(o),d=o.classBars.bind(o),h=o.classChartLine.bind(o),u=o.classLines.bind(o),g=o.classAreas.bind(o);r.subchart_show&&(a=s.select("."+c.chartBars).selectAll("."+c.chartBar).data(e).attr("class",l),n=a.enter().append("g").style("opacity",0).attr("class",l),n.append("g").attr("class",d),i=s.select("."+c.chartLines).selectAll("."+c.chartLine).data(e).attr("class",h),t=i.enter().append("g").style("opacity",0).attr("class",h),t.append("g").attr("class",u),t.append("g").attr("class",g),s.selectAll("."+c.brush+" rect").attr(r.axis_rotated?"width":"height",r.axis_rotated?o.width2:o.height2))},r.updateBarForSubchart=function(e){var t=this;t.contextBar=t.context.selectAll("."+c.bars).selectAll("."+c.bar).data(t.barData.bind(t)),t.contextBar.enter().append("path").attr("class",t.classBar.bind(t)).style("stroke","none").style("fill",t.color),t.contextBar.style("opacity",t.initialOpacity.bind(t)),t.contextBar.exit().transition().duration(e).style("opacity",0).remove()},r.redrawBarForSubchart=function(e,t,i){(t?this.contextBar.transition(Math.random().toString()).duration(i):this.contextBar).attr("d",e).style("opacity",1)},r.updateLineForSubchart=function(e){var t=this;t.contextLine=t.context.selectAll("."+c.lines).selectAll("."+c.line).data(t.lineData.bind(t)),t.contextLine.enter().append("path").attr("class",t.classLine.bind(t)).style("stroke",t.color),t.contextLine.style("opacity",t.initialOpacity.bind(t)),t.contextLine.exit().transition().duration(e).style("opacity",0).remove()},r.redrawLineForSubchart=function(e,t,i){(t?this.contextLine.transition(Math.random().toString()).duration(i):this.contextLine).attr("d",e).style("opacity",1)},r.updateAreaForSubchart=function(e){var t=this,i=t.d3;t.contextArea=t.context.selectAll("."+c.areas).selectAll("."+c.area).data(t.lineData.bind(t)),t.contextArea.enter().append("path").attr("class",t.classArea.bind(t)).style("fill",t.color).style("opacity",function(){return t.orgAreaOpacity=+i.select(this).style("opacity"),0}),t.contextArea.style("opacity",0),t.contextArea.exit().transition().duration(e).style("opacity",0).remove()},r.redrawAreaForSubchart=function(e,t,i){(t?this.contextArea.transition(Math.random().toString()).duration(i):this.contextArea).attr("d",e).style("fill",this.color).style("opacity",this.orgAreaOpacity)},r.redrawSubchart=function(e,t,i,n,a,o,s){var r,l,c,d=this,h=d.d3,u=d.config;d.context.style("visibility",u.subchart_show?"visible":"hidden"),u.subchart_show&&(h.event&&"zoom"===h.event.type&&d.brush.extent(d.x.orgDomain()).update(),e&&(d.brush.empty()||d.brush.extent(d.x.orgDomain()).update(),r=d.generateDrawArea(a,!0),l=d.generateDrawBar(o,!0),c=d.generateDrawLine(s,!0),d.updateBarForSubchart(i),d.updateLineForSubchart(i),d.updateAreaForSubchart(i),d.redrawBarForSubchart(l,i,i),d.redrawLineForSubchart(c,i,i),d.redrawAreaForSubchart(r,i,i)))},r.redrawForBrush=function(){var e=this,t=e.x;e.redraw({withTransition:!1,withY:e.config.zoom_rescale,withSubchart:!1,withUpdateXDomain:!0,withDimension:!1}),e.config.subchart_onbrush.call(e.api,t.orgDomain())},r.transformContext=function(e,t){var i,n=this;t&&t.axisSubX?i=t.axisSubX:(i=n.context.select("."+c.axisX),e&&(i=i.transition())),n.context.attr("transform",n.getTranslate("context")),i.attr("transform",n.getTranslate("subx"))},r.getDefaultExtent=function(){var e=this,t=e.config,i=h(t.axis_x_extent)?t.axis_x_extent(e.getXDomain(e.data.targets)):t.axis_x_extent;return e.isTimeSeries()&&(i=[e.parseDate(i[0]),e.parseDate(i[1])]),i},r.initZoom=function(){var e,t=this,i=t.d3,n=t.config;t.zoom=i.behavior.zoom().on("zoomstart",function(){e=i.event.sourceEvent,t.zoom.altDomain=i.event.sourceEvent.altKey?t.x.orgDomain():null,n.zoom_onzoomstart.call(t.api,i.event.sourceEvent)}).on("zoom",function(){t.redrawForZoom.call(t)}).on("zoomend",function(){var a=i.event.sourceEvent;a&&e.clientX===a.clientX&&e.clientY===a.clientY||(t.redrawEventRect(),t.updateZoom(),n.zoom_onzoomend.call(t.api,t.x.orgDomain()))}),t.zoom.scale=function(e){return n.axis_rotated?this.y(e):this.x(e)},t.zoom.orgScaleExtent=function(){var e=n.zoom_extent?n.zoom_extent:[1,10];return[e[0],Math.max(t.getMaxDataCount()/e[1],e[1])]},t.zoom.updateScaleExtent=function(){var e=x(t.x.orgDomain())/x(t.getZoomDomain()),i=this.orgScaleExtent();return this.scaleExtent([i[0]*e,i[1]*e]),this}},r.getZoomDomain=function(){var e=this,t=e.config,i=e.d3;return[i.min([e.orgXDomain[0],t.zoom_x_min]),i.max([e.orgXDomain[1],t.zoom_x_max])]},r.updateZoom=function(){var e=this,t=e.config.zoom_enabled?e.zoom:function(){};e.main.select("."+c.zoomRect).call(t).on("dblclick.zoom",null),e.main.selectAll("."+c.eventRect).call(t).on("dblclick.zoom",null)},r.redrawForZoom=function(){var e=this,t=e.d3,i=e.config,n=e.zoom,a=e.x;if(i.zoom_enabled&&0!==e.filterTargetsToShow(e.data.targets).length){if("mousemove"===t.event.sourceEvent.type&&n.altDomain)return a.domain(n.altDomain),void n.scale(a).updateScaleExtent();e.isCategorized()&&a.orgDomain()[0]===e.orgXDomain[0]&&a.domain([e.orgXDomain[0]-1e-10,a.orgDomain()[1]]),e.redraw({withTransition:!1,withY:i.zoom_rescale,withSubchart:!1,withEventRect:!1,withDimension:!1}),"mousemove"===t.event.sourceEvent.type&&(e.cancelClick=!0),i.zoom_onzoom.call(e.api,a.orgDomain())}},r.generateColor=function(){var e=this,t=e.config,i=e.d3,n=t.data_colors,a=_(t.color_pattern)?t.color_pattern:i.scale.category10().range(),o=t.data_color,s=[];return function(e){var t,i=e.id||e.data&&e.data.id||e;return n[i]instanceof Function?t=n[i](e):n[i]?t=n[i]:(s.indexOf(i)<0&&s.push(i),t=a[s.indexOf(i)%a.length],n[i]=t),o instanceof Function?o(t,e):t}},r.generateLevelColor=function(){var e=this,t=e.config,i=t.color_pattern,n=t.color_threshold,a="value"===n.unit,o=n.values&&n.values.length?n.values:[],s=n.max||100;return _(t.color_threshold)?function(e){var t,n=i[i.length-1];for(t=0;t<o.length;t++)if((a?e:100*e/s)<o[t]){n=i[t];break}return n}:null},r.getYFormat=function(e){var t=this,i=e&&!t.hasType("gauge")?t.defaultArcValueFormat:t.yFormat,n=e&&!t.hasType("gauge")?t.defaultArcValueFormat:t.y2Format;return function(e,a,o){return("y2"===t.axis.getId(o)?n:i).call(t,e,a)}},r.yFormat=function(e){var t=this,i=t.config;return(i.axis_y_tick_format?i.axis_y_tick_format:t.defaultValueFormat)(e)},r.y2Format=function(e){var t=this,i=t.config;return(i.axis_y2_tick_format?i.axis_y2_tick_format:t.defaultValueFormat)(e)},r.defaultValueFormat=function(e){return d(e)?+e:""},r.defaultArcValueFormat=function(e,t){return(100*t).toFixed(1)+"%"},r.dataLabelFormat=function(e){var t=this,i=t.config.data_labels,n=function(e){return d(e)?+e:""};return"function"==typeof i.format?i.format:"object"===_typeof(i.format)?i.format[e]?!0===i.format[e]?n:i.format[e]:function(){return""}:n},r.hasCaches=function(e){for(var t=0;t<e.length;t++)if(!(e[t]in this.cache))return!1;return!0},r.addCache=function(e,t){this.cache[e]=this.cloneTarget(t)},r.getCaches=function(e){var t,i=[];for(t=0;t<e.length;t++)e[t]in this.cache&&i.push(this.cloneTarget(this.cache[e[t]]));return i};var c=r.CLASS={target:"c3-target",chart:"c3-chart",chartLine:"c3-chart-line",chartLines:"c3-chart-lines",chartBar:"c3-chart-bar",chartBars:"c3-chart-bars",chartText:"c3-chart-text",chartTexts:"c3-chart-texts",chartArc:"c3-chart-arc",chartArcs:"c3-chart-arcs",chartArcsTitle:"c3-chart-arcs-title",chartArcsBackground:"c3-chart-arcs-background",chartArcsGaugeUnit:"c3-chart-arcs-gauge-unit",chartArcsGaugeMax:"c3-chart-arcs-gauge-max",chartArcsGaugeMin:"c3-chart-arcs-gauge-min",selectedCircle:"c3-selected-circle",selectedCircles:"c3-selected-circles",eventRect:"c3-event-rect",eventRects:"c3-event-rects",eventRectsSingle:"c3-event-rects-single",eventRectsMultiple:"c3-event-rects-multiple",zoomRect:"c3-zoom-rect",brush:"c3-brush",focused:"c3-focused",defocused:"c3-defocused",region:"c3-region",regions:"c3-regions",title:"c3-title",tooltipContainer:"c3-tooltip-container",tooltip:"c3-tooltip",tooltipName:"c3-tooltip-name",shape:"c3-shape",shapes:"c3-shapes",line:"c3-line",lines:"c3-lines",bar:"c3-bar",bars:"c3-bars",circle:"c3-circle",circles:"c3-circles",arc:"c3-arc",arcs:"c3-arcs",area:"c3-area",areas:"c3-areas",empty:"c3-empty",text:"c3-text",texts:"c3-texts",gaugeValue:"c3-gauge-value",grid:"c3-grid",gridLines:"c3-grid-lines",xgrid:"c3-xgrid",xgrids:"c3-xgrids",xgridLine:"c3-xgrid-line",xgridLines:"c3-xgrid-lines",xgridFocus:"c3-xgrid-focus",ygrid:"c3-ygrid",ygrids:"c3-ygrids",ygridLine:"c3-ygrid-line",ygridLines:"c3-ygrid-lines",axis:"c3-axis",axisX:"c3-axis-x",axisXLabel:"c3-axis-x-label",axisY:"c3-axis-y",axisYLabel:"c3-axis-y-label",axisY2:"c3-axis-y2",axisY2Label:"c3-axis-y2-label",legendBackground:"c3-legend-background",legendItem:"c3-legend-item",legendItemEvent:"c3-legend-item-event",legendItemTile:"c3-legend-item-tile",legendItemHidden:"c3-legend-item-hidden",legendItemFocused:"c3-legend-item-focused",dragarea:"c3-dragarea",EXPANDED:"_expanded_",SELECTED:"_selected_",INCLUDED:"_included_"};r.generateClass=function(e,t){return" "+e+" "+e+this.getTargetSelectorSuffix(t)},r.classText=function(e){return this.generateClass(c.text,e.index)},r.classTexts=function(e){return this.generateClass(c.texts,e.id)},r.classShape=function(e){return this.generateClass(c.shape,e.index)},r.classShapes=function(e){return this.generateClass(c.shapes,e.id)},r.classLine=function(e){return this.classShape(e)+this.generateClass(c.line,e.id)},r.classLines=function(e){return this.classShapes(e)+this.generateClass(c.lines,e.id)},r.classCircle=function(e){return this.classShape(e)+this.generateClass(c.circle,e.index)},r.classCircles=function(e){return this.classShapes(e)+this.generateClass(c.circles,e.id)},r.classBar=function(e){return this.classShape(e)+this.generateClass(c.bar,e.index)},r.classBars=function(e){return this.classShapes(e)+this.generateClass(c.bars,e.id)},r.classArc=function(e){return this.classShape(e.data)+this.generateClass(c.arc,e.data.id)},r.classArcs=function(e){return this.classShapes(e.data)+this.generateClass(c.arcs,e.data.id)},r.classArea=function(e){return this.classShape(e)+this.generateClass(c.area,e.id)},r.classAreas=function(e){return this.classShapes(e)+this.generateClass(c.areas,e.id)},r.classRegion=function(e,t){return this.generateClass(c.region,t)+" "+("class"in e?e.class:"")},r.classEvent=function(e){return this.generateClass(c.eventRect,e.index)},r.classTarget=function(e){var t=this,i=t.config.data_classes[e],n="";return i&&(n=" "+c.target+"-"+i),t.generateClass(c.target,e)+n},r.classFocus=function(e){return this.classFocused(e)+this.classDefocused(e)},r.classFocused=function(e){return" "+(this.focusedTargetIds.indexOf(e.id)>=0?c.focused:"")},r.classDefocused=function(e){return" "+(this.defocusedTargetIds.indexOf(e.id)>=0?c.defocused:"")},r.classChartText=function(e){return c.chartText+this.classTarget(e.id)},r.classChartLine=function(e){return c.chartLine+this.classTarget(e.id)},r.classChartBar=function(e){return c.chartBar+this.classTarget(e.id)},r.classChartArc=function(e){return c.chartArc+this.classTarget(e.data.id)},r.getTargetSelectorSuffix=function(e){return e||0===e?("-"+e).replace(/[\s?!@#$%^&*()_=+,.<>'":;\[\]\/|~`{}\\]/g,"-"):""},r.selectorTarget=function(e,t){return(t||"")+"."+c.target+this.getTargetSelectorSuffix(e)},r.selectorTargets=function(e,t){var i=this;return e=e||[],e.length?e.map(function(e){return i.selectorTarget(e,t)}):null},r.selectorLegend=function(e){return"."+c.legendItem+this.getTargetSelectorSuffix(e)},r.selectorLegends=function(e){var t=this;return e&&e.length?e.map(function(e){return t.selectorLegend(e)}):null};var d=r.isValue=function(e){return e||0===e},h=r.isFunction=function(e){return"function"==typeof e},u=r.isString=function(e){return"string"==typeof e},g=r.isUndefined=function(e){return void 0===e},p=r.isDefined=function(e){return void 0!==e},f=r.ceil10=function(e){return 10*Math.ceil(e/10)},m=r.asHalfPixel=function(e){return Math.ceil(e)+.5},x=r.diffDomain=function(e){return e[1]-e[0]},v=r.isEmpty=function(e){return void 0===e||null===e||u(e)&&0===e.length||"object"===(void 0===e?"undefined":_typeof(e))&&0===Object.keys(e).length},_=r.notEmpty=function(e){return!r.isEmpty(e)},b=r.getOption=function(e,t,i){return p(e[t])?e[t]:i},y=r.hasValue=function(e,t){var i=!1;return Object.keys(e).forEach(function(n){e[n]===t&&(i=!0)}),i},w=r.sanitise=function(e){return"string"==typeof e?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},S=r.getPathBox=function(e){var t=e.getBoundingClientRect(),i=[e.pathSegList.getItem(0),e.pathSegList.getItem(1)];return{x:i[0].x,y:Math.min(i[0].y,i[1].y),width:t.width,height:t.height}};s.focus=function(e){var t,i=this.internal;e=i.mapToTargetIds(e),t=i.svg.selectAll(i.selectorTargets(e.filter(i.isTargetToShow,i))),this.revert(),this.defocus(),t.classed(c.focused,!0).classed(c.defocused,!1),i.hasArcType()&&i.expandArc(e),i.toggleFocusLegend(e,!0),i.focusedTargetIds=e,i.defocusedTargetIds=i.defocusedTargetIds.filter(function(t){return e.indexOf(t)<0})},s.defocus=function(e){var t,i=this.internal;e=i.mapToTargetIds(e),t=i.svg.selectAll(i.selectorTargets(e.filter(i.isTargetToShow,i))),t.classed(c.focused,!1).classed(c.defocused,!0),i.hasArcType()&&i.unexpandArc(e),i.toggleFocusLegend(e,!1),i.focusedTargetIds=i.focusedTargetIds.filter(function(t){return e.indexOf(t)<0}),i.defocusedTargetIds=e},s.revert=function(e){var t,i=this.internal;e=i.mapToTargetIds(e),t=i.svg.selectAll(i.selectorTargets(e)),t.classed(c.focused,!1).classed(c.defocused,!1),i.hasArcType()&&i.unexpandArc(e),i.config.legend_show&&(i.showLegend(e.filter(i.isLegendToShow.bind(i))),i.legend.selectAll(i.selectorLegends(e)).filter(function(){return i.d3.select(this).classed(c.legendItemFocused)}).classed(c.legendItemFocused,!1)),i.focusedTargetIds=[],i.defocusedTargetIds=[]},s.show=function(e,t){var i,n=this.internal;e=n.mapToTargetIds(e),t=t||{},n.removeHiddenTargetIds(e),i=n.svg.selectAll(n.selectorTargets(e)),i.transition().style("opacity",1,"important").call(n.endall,function(){i.style("opacity",null).style("opacity",1)}),t.withLegend&&n.showLegend(e),n.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0})},s.hide=function(e,t){var i,n=this.internal;e=n.mapToTargetIds(e),t=t||{},n.addHiddenTargetIds(e),i=n.svg.selectAll(n.selectorTargets(e)),i.transition().style("opacity",0,"important").call(n.endall,function(){i.style("opacity",null).style("opacity",0)}),t.withLegend&&n.hideLegend(e),n.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0})},s.toggle=function(e,t){var i=this,n=this.internal;n.mapToTargetIds(e).forEach(function(e){n.isTargetToShow(e)?i.hide(e,t):i.show(e,t)})},s.zoom=function(e){var t=this.internal;return e&&(t.isTimeSeries()&&(e=e.map(function(e){return t.parseDate(e)})),t.brush.extent(e),t.redraw({withUpdateXDomain:!0,withY:t.config.zoom_rescale}),t.config.zoom_onzoom.call(this,t.x.orgDomain())),t.brush.extent()},s.zoom.enable=function(e){var t=this.internal;t.config.zoom_enabled=e,t.updateAndRedraw()},s.unzoom=function(){var e=this.internal;e.brush.clear().update(),e.redraw({withUpdateXDomain:!0})},s.zoom.max=function(e){var t=this.internal,i=t.config,n=t.d3;if(0!==e&&!e)return i.zoom_x_max;i.zoom_x_max=n.max([t.orgXDomain[1],e])},s.zoom.min=function(e){var t=this.internal,i=t.config,n=t.d3;if(0!==e&&!e)return i.zoom_x_min;i.zoom_x_min=n.min([t.orgXDomain[0],e])},s.zoom.range=function(e){if(!arguments.length)return{max:this.domain.max(),min:this.domain.min()};p(e.max)&&this.domain.max(e.max),p(e.min)&&this.domain.min(e.min)},s.load=function(e){var t=this.internal,i=t.config;if(e.xs&&t.addXs(e.xs),"names"in e&&s.data.names.bind(this)(e.names),"classes"in e&&Object.keys(e.classes).forEach(function(t){i.data_classes[t]=e.classes[t]}),"categories"in e&&t.isCategorized()&&(i.axis_x_categories=e.categories),"axes"in e&&Object.keys(e.axes).forEach(function(t){i.data_axes[t]=e.axes[t]}),"colors"in e&&Object.keys(e.colors).forEach(function(t){i.data_colors[t]=e.colors[t]}),"cacheIds"in e&&t.hasCaches(e.cacheIds))return void t.load(t.getCaches(e.cacheIds),e.done);"unload"in e?t.unload(t.mapToTargetIds("boolean"==typeof e.unload&&e.unload?null:e.unload),function(){t.loadFromArgs(e)}):t.loadFromArgs(e)},s.unload=function(e){var t=this.internal;e=e||{},e instanceof Array?e={ids:e}:"string"==typeof e&&(e={ids:[e]}),t.unload(t.mapToTargetIds(e.ids),function(){t.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),e.done&&e.done()})},s.flow=function(e){var t,i,n,a,o,s,r,l=this.internal,c=[],h=l.getMaxDataCount(),u=0,g=0;if(e.json)i=l.convertJsonToData(e.json,e.keys);else if(e.rows)i=l.convertRowsToData(e.rows);else{if(!e.columns)return;i=l.convertColumnsToData(e.columns)}t=l.convertDataToTargets(i,!0),l.data.targets.forEach(function(e){var i,n,a=!1;for(i=0;i<t.length;i++)if(e.id===t[i].id){for(a=!0,e.values[e.values.length-1]&&(g=e.values[e.values.length-1].index+1),u=t[i].values.length,n=0;n<u;n++)t[i].values[n].index=g+n,l.isTimeSeries()||(t[i].values[n].x=g+n);e.values=e.values.concat(t[i].values),t.splice(i,1);break}a||c.push(e.id)}),l.data.targets.forEach(function(e){var t,i;for(t=0;t<c.length;t++)if(e.id===c[t])for(g=e.values[e.values.length-1].index+1,i=0;i<u;i++)e.values.push({id:e.id,index:g+i,x:l.isTimeSeries()?l.getOtherTargetX(g+i):g+i,value:null})}),l.data.targets.length&&t.forEach(function(e){var t,i=[];for(t=l.data.targets[0].values[0].index;t<g;t++)i.push({id:e.id,index:t,x:l.isTimeSeries()?l.getOtherTargetX(t):t,value:null});e.values.forEach(function(e){e.index+=g,l.isTimeSeries()||(e.x+=g)}),e.values=i.concat(e.values)}),l.data.targets=l.data.targets.concat(t),l.getMaxDataCount(),a=l.data.targets[0],o=a.values[0],p(e.to)?(u=0,r=l.isTimeSeries()?l.parseDate(e.to):e.to,a.values.forEach(function(e){e.x<r&&u++})):p(e.length)&&(u=e.length),h?1===h&&l.isTimeSeries()&&(s=(a.values[a.values.length-1].x-o.x)/2,n=[new Date(+o.x-s),new Date(+o.x+s)],l.updateXDomain(null,!0,!0,!1,n)):(s=l.isTimeSeries()?a.values.length>1?a.values[a.values.length-1].x-o.x:o.x-l.getXDomain(l.data.targets)[0]:1,n=[o.x-s,o.x],l.updateXDomain(null,!0,!0,!1,n)),l.updateTargets(l.data.targets),l.redraw({flow:{index:o.index,length:u,duration:d(e.duration)?e.duration:l.config.transition_duration,done:e.done,orgDataCount:h},withLegend:!0,withTransition:h>1,withTrimXDomain:!1,withUpdateXAxis:!0})},r.generateFlow=function(e){var t=this,i=t.config,n=t.d3;return function(){var a,o,s,r=e.targets,l=e.flow,d=e.drawBar,h=e.drawLine,u=e.drawArea,g=e.cx,p=e.cy,f=e.xv,m=e.xForText,v=e.yForText,_=e.duration,b=1,y=l.index,w=l.length,S=t.getValueOnIndex(t.data.targets[0].values,y),C=t.getValueOnIndex(t.data.targets[0].values,y+w),T=t.x.domain(),V=l.duration||_,A=l.done||function(){},P=t.generateWait(),k=t.xgrid||n.selectAll([]),L=t.xgridLines||n.selectAll([]),R=t.mainRegion||n.selectAll([]),I=t.mainText||n.selectAll([]),M=t.mainBar||n.selectAll([]),G=t.mainLine||n.selectAll([]),E=t.mainArea||n.selectAll([]),O=t.mainCircle||n.selectAll([]);t.flowing=!0,t.data.targets.forEach(function(e){e.values.splice(0,w)}),s=t.updateXDomain(r,!0,!0),t.updateXGrid&&t.updateXGrid(!0),l.orgDataCount?a=1===l.orgDataCount||(S&&S.x)===(C&&C.x)?t.x(T[0])-t.x(s[0]):t.isTimeSeries()?t.x(T[0])-t.x(s[0]):t.x(S.x)-t.x(C.x):1!==t.data.targets[0].values.length?a=t.x(T[0])-t.x(s[0]):t.isTimeSeries()?(S=t.getValueOnIndex(t.data.targets[0].values,0),C=t.getValueOnIndex(t.data.targets[0].values,t.data.targets[0].values.length-1),a=t.x(S.x)-t.x(C.x)):a=x(s)/2,b=x(T)/x(s),o="translate("+a+",0) scale("+b+",1)",t.hideXGridFocus(),n.transition().ease("linear").duration(V).each(function(){P.add(t.axes.x.transition().call(t.xAxis)),P.add(M.transition().attr("transform",o)),P.add(G.transition().attr("transform",o)),P.add(E.transition().attr("transform",o)),P.add(O.transition().attr("transform",o)),P.add(I.transition().attr("transform",o)),P.add(R.filter(t.isRegionOnX).transition().attr("transform",o)),P.add(k.transition().attr("transform",o)),P.add(L.transition().attr("transform",o))}).call(P,function(){var e,n=[],a=[],o=[];if(w){for(e=0;e<w;e++)n.push("."+c.shape+"-"+(y+e)),a.push("."+c.text+"-"+(y+e)),o.push("."+c.eventRect+"-"+(y+e));t.svg.selectAll("."+c.shapes).selectAll(n).remove(),t.svg.selectAll("."+c.texts).selectAll(a).remove(),t.svg.selectAll("."+c.eventRects).selectAll(o).remove(),t.svg.select("."+c.xgrid).remove()}k.attr("transform",null).attr(t.xgridAttr),L.attr("transform",null),L.select("line").attr("x1",i.axis_rotated?0:f).attr("x2",i.axis_rotated?t.width:f),L.select("text").attr("x",i.axis_rotated?t.width:0).attr("y",f),M.attr("transform",null).attr("d",d),G.attr("transform",null).attr("d",h),E.attr("transform",null).attr("d",u),O.attr("transform",null).attr("cx",g).attr("cy",p),I.attr("transform",null).attr("x",m).attr("y",v).style("fill-opacity",t.opacityForText.bind(t)),R.attr("transform",null),R.select("rect").filter(t.isRegionOnX).attr("x",t.regionX.bind(t)).attr("width",t.regionWidth.bind(t)),i.interaction_enabled&&t.redrawEventRect(),A(),t.flowing=!1})}},s.selected=function(e){var t=this.internal,i=t.d3;return i.merge(t.main.selectAll("."+c.shapes+t.getTargetSelectorSuffix(e)).selectAll("."+c.shape).filter(function(){return i.select(this).classed(c.SELECTED)}).map(function(e){return e.map(function(e){var t=e.__data__;return t.data?t.data:t})}))},s.select=function(e,t,i){var n=this.internal,a=n.d3,o=n.config;o.data_selection_enabled&&n.main.selectAll("."+c.shapes).selectAll("."+c.shape).each(function(s,r){var l=a.select(this),d=s.data?s.data.id:s.id,h=n.getToggle(this,s).bind(n),u=o.data_selection_grouped||!e||e.indexOf(d)>=0,g=!t||t.indexOf(r)>=0,f=l.classed(c.SELECTED);l.classed(c.line)||l.classed(c.area)||(u&&g?o.data_selection_isselectable(s)&&!f&&h(!0,l.classed(c.SELECTED,!0),s,r):p(i)&&i&&f&&h(!1,l.classed(c.SELECTED,!1),s,r))})},s.unselect=function(e,t){var i=this.internal,n=i.d3,a=i.config
;a.data_selection_enabled&&i.main.selectAll("."+c.shapes).selectAll("."+c.shape).each(function(o,s){var r=n.select(this),l=o.data?o.data.id:o.id,d=i.getToggle(this,o).bind(i),h=a.data_selection_grouped||!e||e.indexOf(l)>=0,u=!t||t.indexOf(s)>=0,g=r.classed(c.SELECTED);r.classed(c.line)||r.classed(c.area)||h&&u&&a.data_selection_isselectable(o)&&g&&d(!1,r.classed(c.SELECTED,!1),o,s)})},s.transform=function(e,t){var i=this.internal,n=["pie","donut"].indexOf(e)>=0?{withTransform:!0}:null;i.transformTo(t,e,n)},r.transformTo=function(e,t,i){var n=this,a=!n.hasArcType(),o=i||{withTransitionForAxis:a};o.withTransitionForTransform=!1,n.transiting=!1,n.setTargetType(e,t),n.updateTargets(n.data.targets),n.updateAndRedraw(o)},s.groups=function(e){var t=this.internal,i=t.config;return g(e)?i.data_groups:(i.data_groups=e,t.redraw(),i.data_groups)},s.xgrids=function(e){var t=this.internal,i=t.config;return e?(i.grid_x_lines=e,t.redrawWithoutRescale(),i.grid_x_lines):i.grid_x_lines},s.xgrids.add=function(e){var t=this.internal;return this.xgrids(t.config.grid_x_lines.concat(e||[]))},s.xgrids.remove=function(e){this.internal.removeGridLines(e,!0)},s.ygrids=function(e){var t=this.internal,i=t.config;return e?(i.grid_y_lines=e,t.redrawWithoutRescale(),i.grid_y_lines):i.grid_y_lines},s.ygrids.add=function(e){var t=this.internal;return this.ygrids(t.config.grid_y_lines.concat(e||[]))},s.ygrids.remove=function(e){this.internal.removeGridLines(e,!1)},s.regions=function(e){var t=this.internal,i=t.config;return e?(i.regions=e,t.redrawWithoutRescale(),i.regions):i.regions},s.regions.add=function(e){var t=this.internal,i=t.config;return e?(i.regions=i.regions.concat(e),t.redrawWithoutRescale(),i.regions):i.regions},s.regions.remove=function(e){var t,i,n,a=this.internal,o=a.config;return e=e||{},t=a.getOption(e,"duration",o.transition_duration),i=a.getOption(e,"classes",[c.region]),n=a.main.select("."+c.regions).selectAll(i.map(function(e){return"."+e})),(t?n.transition().duration(t):n).style("opacity",0).remove(),o.regions=o.regions.filter(function(e){var t=!1;return!e.class||(e.class.split(" ").forEach(function(e){i.indexOf(e)>=0&&(t=!0)}),!t)}),o.regions},s.data=function(e){var t=this.internal.data.targets;return void 0===e?t:t.filter(function(t){return[].concat(e).indexOf(t.id)>=0})},s.data.shown=function(e){return this.internal.filterTargetsToShow(this.data(e))},s.data.values=function(e){var t,i=null;return e&&(t=this.data(e),i=t[0]?t[0].values.map(function(e){return e.value}):null),i},s.data.names=function(e){return this.internal.clearLegendItemTextBoxCache(),this.internal.updateDataAttributes("names",e)},s.data.colors=function(e){return this.internal.updateDataAttributes("colors",e)},s.data.axes=function(e){return this.internal.updateDataAttributes("axes",e)},s.category=function(e,t){var i=this.internal,n=i.config;return arguments.length>1&&(n.axis_x_categories[e]=t,i.redraw()),n.axis_x_categories[e]},s.categories=function(e){var t=this.internal,i=t.config;return arguments.length?(i.axis_x_categories=e,t.redraw(),i.axis_x_categories):i.axis_x_categories},s.color=function(e){return this.internal.color(e)},s.x=function(e){var t=this.internal;return arguments.length&&(t.updateTargetX(t.data.targets,e),t.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})),t.data.xs},s.xs=function(e){var t=this.internal;return arguments.length&&(t.updateTargetXs(t.data.targets,e),t.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})),t.data.xs},s.axis=function(){},s.axis.labels=function(e){var t=this.internal;arguments.length&&(Object.keys(e).forEach(function(i){t.axis.setLabelText(i,e[i])}),t.axis.updateLabels())},s.axis.max=function(e){var t=this.internal,i=t.config;if(!arguments.length)return{x:i.axis_x_max,y:i.axis_y_max,y2:i.axis_y2_max};"object"===(void 0===e?"undefined":_typeof(e))?(d(e.x)&&(i.axis_x_max=e.x),d(e.y)&&(i.axis_y_max=e.y),d(e.y2)&&(i.axis_y2_max=e.y2)):i.axis_y_max=i.axis_y2_max=e,t.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})},s.axis.min=function(e){var t=this.internal,i=t.config;if(!arguments.length)return{x:i.axis_x_min,y:i.axis_y_min,y2:i.axis_y2_min};"object"===(void 0===e?"undefined":_typeof(e))?(d(e.x)&&(i.axis_x_min=e.x),d(e.y)&&(i.axis_y_min=e.y),d(e.y2)&&(i.axis_y2_min=e.y2)):i.axis_y_min=i.axis_y2_min=e,t.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})},s.axis.range=function(e){if(!arguments.length)return{max:this.axis.max(),min:this.axis.min()};p(e.max)&&this.axis.max(e.max),p(e.min)&&this.axis.min(e.min)},s.legend=function(){},s.legend.show=function(e){var t=this.internal;t.showLegend(t.mapToTargetIds(e)),t.updateAndRedraw({withLegend:!0})},s.legend.hide=function(e){var t=this.internal;t.hideLegend(t.mapToTargetIds(e)),t.updateAndRedraw({withLegend:!0})},s.resize=function(e){var t=this.internal,i=t.config;i.size_width=e?e.width:null,i.size_height=e?e.height:null,this.flush()},s.flush=function(){this.internal.updateAndRedraw({withLegend:!0,withTransition:!1,withTransitionForTransform:!1})},s.destroy=function(){var t=this.internal;if(e.clearInterval(t.intervalForObserveInserted),void 0!==t.resizeTimeout&&e.clearTimeout(t.resizeTimeout),e.detachEvent)e.detachEvent("onresize",t.resizeFunction);else if(e.removeEventListener)e.removeEventListener("resize",t.resizeFunction);else{var i=e.onresize;i&&i.add&&i.remove&&i.remove(t.resizeFunction)}return t.selectChart.classed("c3",!1).html(""),Object.keys(t).forEach(function(e){t[e]=null}),null},s.tooltip=function(){},s.tooltip.show=function(e){var t,i,n=this.internal;e.mouse&&(i=e.mouse),e.data?n.isMultipleX()?(i=[n.x(e.data.x),n.getYScale(e.data.id)(e.data.value)],t=null):t=d(e.data.index)?e.data.index:n.getIndexByX(e.data.x):void 0!==e.x?t=n.getIndexByX(e.x):void 0!==e.index&&(t=e.index),n.dispatchEvent("mouseover",t,i),n.dispatchEvent("mousemove",t,i),n.config.tooltip_onshow.call(n,e.data)},s.tooltip.hide=function(){this.internal.dispatchEvent("mouseout",0),this.internal.config.tooltip_onhide.call(this)};var C;r.isSafari=function(){var t=e.navigator.userAgent;return t.indexOf("Safari")>=0&&t.indexOf("Chrome")<0},r.isChrome=function(){return e.navigator.userAgent.indexOf("Chrome")>=0},Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),i=this,n=function(){},a=function(){return i.apply(this instanceof n?this:e,t.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,a.prototype=new n,a}),function(){"SVGPathSeg"in e||(e.SVGPathSeg=function(e,t,i){this.pathSegType=e,this.pathSegTypeAsLetter=t,this._owningPathSegList=i},SVGPathSeg.PATHSEG_UNKNOWN=0,SVGPathSeg.PATHSEG_CLOSEPATH=1,SVGPathSeg.PATHSEG_MOVETO_ABS=2,SVGPathSeg.PATHSEG_MOVETO_REL=3,SVGPathSeg.PATHSEG_LINETO_ABS=4,SVGPathSeg.PATHSEG_LINETO_REL=5,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9,SVGPathSeg.PATHSEG_ARC_ABS=10,SVGPathSeg.PATHSEG_ARC_REL=11,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19,SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)},e.SVGPathSegClosePath=function(e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CLOSEPATH,"z",e)},SVGPathSegClosePath.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"},SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter},SVGPathSegClosePath.prototype.clone=function(){return new SVGPathSegClosePath(void 0)},e.SVGPathSegMovetoAbs=function(e,t,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_ABS,"M",e),this._x=t,this._y=i},SVGPathSegMovetoAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"},SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegMovetoAbs.prototype.clone=function(){return new SVGPathSegMovetoAbs(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegMovetoRel=function(e,t,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_REL,"m",e),this._x=t,this._y=i},SVGPathSegMovetoRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"},SVGPathSegMovetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegMovetoRel.prototype.clone=function(){return new SVGPathSegMovetoRel(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegLinetoAbs=function(e,t,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_ABS,"L",e),this._x=t,this._y=i},SVGPathSegLinetoAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"},SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegLinetoAbs.prototype.clone=function(){return new SVGPathSegLinetoAbs(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegLinetoAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegLinetoRel=function(e,t,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_REL,"l",e),this._x=t,this._y=i},SVGPathSegLinetoRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"},SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegLinetoRel.prototype.clone=function(){return new SVGPathSegLinetoRel(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegCurvetoCubicAbs=function(e,t,i,n,a,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",e),this._x=t,this._y=i,this._x1=n,this._y1=a,this._x2=o,this._y2=s},SVGPathSegCurvetoCubicAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"},SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicAbs(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegCurvetoCubicRel=function(e,t,i,n,a,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",e),this._x=t,this._y=i,this._x1=n,this._y1=a,this._x2=o,this._y2=s},SVGPathSegCurvetoCubicRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"},SVGPathSegCurvetoCubicRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicRel(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegCurvetoQuadraticAbs=function(e,t,i,n,a){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",e),this._x=t,this._y=i,this._x1=n,this._y1=a},SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoQuadraticAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticAbs]"},SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticAbs(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegCurvetoQuadraticRel=function(e,t,i,n,a){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",e),this._x=t,this._y=i,this._x1=n,this._y1=a},SVGPathSegCurvetoQuadraticRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"},SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticRel(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x1",{get:function(){return this._x1},set:function(e){this._x1=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(e){this._y1=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegArcAbs=function(e,t,i,n,a,o,s,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_ABS,"A",e),this._x=t,this._y=i,this._r1=n,this._r2=a,this._angle=o,this._largeArcFlag=s,this._sweepFlag=r},SVGPathSegArcAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"},SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},SVGPathSegArcAbs.prototype.clone=function(){return new SVGPathSegArcAbs(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(SVGPathSegArcAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(e){this._r1=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(e){this._r2=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegArcRel=function(e,t,i,n,a,o,s,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_REL,"a",e),this._x=t,this._y=i,this._r1=n,this._r2=a,this._angle=o,this._largeArcFlag=s,this._sweepFlag=r},SVGPathSegArcRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"},SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},SVGPathSegArcRel.prototype.clone=function(){return new SVGPathSegArcRel(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(e){this._r1=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(e){this._r2=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegLinetoHorizontalAbs=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,"H",e),this._x=t},SVGPathSegLinetoHorizontalAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"},SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new SVGPathSegLinetoHorizontalAbs(void 0,this._x)},Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegLinetoHorizontalRel=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",e),this._x=t},SVGPathSegLinetoHorizontalRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"},SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},SVGPathSegLinetoHorizontalRel.prototype.clone=function(){return new SVGPathSegLinetoHorizontalRel(void 0,this._x)},Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegLinetoVerticalAbs=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",e),this._y=t},SVGPathSegLinetoVerticalAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"},SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new SVGPathSegLinetoVerticalAbs(void 0,this._y)},Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegLinetoVerticalRel=function(e,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",e),this._y=t},SVGPathSegLinetoVerticalRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"},SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new SVGPathSegLinetoVerticalRel(void 0,this._y)},Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegCurvetoCubicSmoothAbs=function(e,t,i,n,a){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",e),this._x=t,this._y=i,this._x2=n,this._y2=a},SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"},SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegCurvetoCubicSmoothRel=function(e,t,i,n,a){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",e),this._x=t,this._y=i,this._x2=n,this._y2=a},SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"},SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothRel(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(e){this._x2=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(e){this._y2=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegCurvetoQuadraticSmoothAbs=function(e,t,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",e),this._x=t,this._y=i},SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"},SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),e.SVGPathSegCurvetoQuadraticSmoothRel=function(e,t,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",e),this._x=t,this._y=i},SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"},SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}),SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new SVGPathSegClosePath(void 0)},SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(e,t){return new SVGPathSegMovetoAbs(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegMovetoRel=function(e,t){return new SVGPathSegMovetoRel(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(e,t){return new SVGPathSegLinetoAbs(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegLinetoRel=function(e,t){return new SVGPathSegLinetoRel(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(e,t,i,n,a,o){return new SVGPathSegCurvetoCubicAbs(void 0,e,t,i,n,a,o)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(e,t,i,n,a,o){return new SVGPathSegCurvetoCubicRel(void 0,e,t,i,n,a,o)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(e,t,i,n){return new SVGPathSegCurvetoQuadraticAbs(void 0,e,t,i,n)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(e,t,i,n){return new SVGPathSegCurvetoQuadraticRel(void 0,e,t,i,n)},SVGPathElement.prototype.createSVGPathSegArcAbs=function(e,t,i,n,a,o,s){return new SVGPathSegArcAbs(void 0,e,t,i,n,a,o,s)},SVGPathElement.prototype.createSVGPathSegArcRel=function(e,t,i,n,a,o,s){return new SVGPathSegArcRel(void 0,e,t,i,n,a,o,s)},SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(e){return new SVGPathSegLinetoHorizontalAbs(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(e){return new SVGPathSegLinetoHorizontalRel(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(e){return new SVGPathSegLinetoVerticalAbs(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(e){return new SVGPathSegLinetoVerticalRel(void 0,e)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(e,t,i,n){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,e,t,i,n)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(e,t,i,n){return new SVGPathSegCurvetoCubicSmoothRel(void 0,e,t,i,n)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(e,t){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(e,t){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,e,t)}),"SVGPathSegList"in e||(e.SVGPathSegList=function(e){this._pathElement=e,this._list=this._parsePath(this._pathElement.getAttribute("d")),this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]},this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},Object.defineProperty(SVGPathSegList.prototype,"numberOfItems",{get:function(){return this._checkPathSynchronizedToList(),this._list.length},enumerable:!0}),Object.defineProperty(SVGPathElement.prototype,"pathSegList",{get:function(){return this._pathSegList||(this._pathSegList=new SVGPathSegList(this)),this._pathSegList},enumerable:!0}),Object.defineProperty(SVGPathElement.prototype,"normalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),Object.defineProperty(SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),Object.defineProperty(SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())},SVGPathSegList.prototype._updateListFromPathMutations=function(e){if(this._pathElement){var t=!1;e.forEach(function(e){"d"==e.attributeName&&(t=!0)}),t&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}},
SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect(),this._pathElement.setAttribute("d",SVGPathSegList._pathSegArrayAsString(this._list)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},SVGPathSegList.prototype.segmentChanged=function(e){this._writeListToPath()},SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList(),this._list.forEach(function(e){e._owningPathSegList=null}),this._list=[],this._writeListToPath()},SVGPathSegList.prototype.initialize=function(e){return this._checkPathSynchronizedToList(),this._list=[e],e._owningPathSegList=this,this._writeListToPath(),e},SVGPathSegList.prototype._checkValidIndex=function(e){if(isNaN(e)||e<0||e>=this.numberOfItems)throw"INDEX_SIZE_ERR"},SVGPathSegList.prototype.getItem=function(e){return this._checkPathSynchronizedToList(),this._checkValidIndex(e),this._list[e]},SVGPathSegList.prototype.insertItemBefore=function(e,t){return this._checkPathSynchronizedToList(),t>this.numberOfItems&&(t=this.numberOfItems),e._owningPathSegList&&(e=e.clone()),this._list.splice(t,0,e),e._owningPathSegList=this,this._writeListToPath(),e},SVGPathSegList.prototype.replaceItem=function(e,t){return this._checkPathSynchronizedToList(),e._owningPathSegList&&(e=e.clone()),this._checkValidIndex(t),this._list[t]=e,e._owningPathSegList=this,this._writeListToPath(),e},SVGPathSegList.prototype.removeItem=function(e){this._checkPathSynchronizedToList(),this._checkValidIndex(e);var t=this._list[e];return this._list.splice(e,1),this._writeListToPath(),t},SVGPathSegList.prototype.appendItem=function(e){return this._checkPathSynchronizedToList(),e._owningPathSegList&&(e=e.clone()),this._list.push(e),e._owningPathSegList=this,this._writeListToPath(),e},SVGPathSegList._pathSegArrayAsString=function(e){var t="",i=!0;return e.forEach(function(e){i?(i=!1,t+=e._asPathString()):t+=" "+e._asPathString()}),t},SVGPathSegList.prototype._parsePath=function(e){if(!e||0==e.length)return[];var t=this,i=function(){this.pathSegList=[]};i.prototype.appendSegment=function(e){this.pathSegList.push(e)};var n=function(e){this._string=e,this._currentIndex=0,this._endIndex=this._string.length,this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN,this._skipOptionalSpaces()};n.prototype._isCurrentSpace=function(){var e=this._string[this._currentIndex];return e<=" "&&(" "==e||"\n"==e||"\t"==e||"\r"==e||"\f"==e)},n.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex},n.prototype._skipOptionalSpacesOrDelimiter=function(){return!(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!=this._string.charAt(this._currentIndex))&&(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","==this._string.charAt(this._currentIndex)&&(this._currentIndex++,this._skipOptionalSpaces()),this._currentIndex<this._endIndex)},n.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex},n.prototype.peekSegmentType=function(){var e=this._string[this._currentIndex];return this._pathSegTypeFromChar(e)},n.prototype._pathSegTypeFromChar=function(e){switch(e){case"Z":case"z":return SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return SVGPathSeg.PATHSEG_LINETO_REL;case"C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return SVGPathSeg.PATHSEG_ARC_ABS;case"a":return SVGPathSeg.PATHSEG_ARC_REL;case"H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}},n.prototype._nextCommandHelper=function(e,t){return("+"==e||"-"==e||"."==e||e>="0"&&e<="9")&&t!=SVGPathSeg.PATHSEG_CLOSEPATH?t==SVGPathSeg.PATHSEG_MOVETO_ABS?SVGPathSeg.PATHSEG_LINETO_ABS:t==SVGPathSeg.PATHSEG_MOVETO_REL?SVGPathSeg.PATHSEG_LINETO_REL:t:SVGPathSeg.PATHSEG_UNKNOWN},n.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return!0;var e=this.peekSegmentType();return e==SVGPathSeg.PATHSEG_MOVETO_ABS||e==SVGPathSeg.PATHSEG_MOVETO_REL},n.prototype._parseNumber=function(){var e=0,t=0,i=1,n=0,a=1,o=1,s=this._currentIndex;if(this._skipOptionalSpaces(),this._currentIndex<this._endIndex&&"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:this._currentIndex<this._endIndex&&"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,a=-1),!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&"."!=this._string.charAt(this._currentIndex))){for(var r=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!=r)for(var l=this._currentIndex-1,c=1;l>=r;)t+=c*(this._string.charAt(l--)-"0"),c*=10;if(this._currentIndex<this._endIndex&&"."==this._string.charAt(this._currentIndex)){if(++this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)n+=(this._string.charAt(this._currentIndex++)-"0")*(i*=.1)}if(this._currentIndex!=s&&this._currentIndex+1<this._endIndex&&("e"==this._string.charAt(this._currentIndex)||"E"==this._string.charAt(this._currentIndex))&&"x"!=this._string.charAt(this._currentIndex+1)&&"m"!=this._string.charAt(this._currentIndex+1)){if(this._currentIndex++,"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,o=-1),this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)e*=10,e+=this._string.charAt(this._currentIndex)-"0",this._currentIndex++}var d=t+n;if(d*=a,e&&(d*=Math.pow(10,o*e)),s!=this._currentIndex)return this._skipOptionalSpacesOrDelimiter(),d}},n.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var e=!1,t=this._string.charAt(this._currentIndex++);if("0"==t)e=!1;else{if("1"!=t)return;e=!0}return this._skipOptionalSpacesOrDelimiter(),e}},n.prototype.parseSegment=function(){var e=this._string[this._currentIndex],i=this._pathSegTypeFromChar(e);if(i==SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==SVGPathSeg.PATHSEG_UNKNOWN)return null;if((i=this._nextCommandHelper(e,this._previousCommand))==SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;switch(this._previousCommand=i,i){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:return this._skipOptionalSpaces(),new SVGPathSegClosePath(t);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(t,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(t,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(t,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(t,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(t,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(t,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_ARC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(t,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);case SVGPathSeg.PATHSEG_ARC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcAbs(t,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);default:throw"Unknown path seg type."}};var a=new i,o=new n(e);if(!o.initialCommandIsMoveTo())return[];for(;o.hasMoreData();){var s=o.parseSegment();if(!s)return[];a.appendSegment(s)}return a.pathSegList})}(),"function"==typeof define&&define.amd?define("c3",["d3"],function(){return l}):"undefined"!=typeof exports&&"undefined"!=typeof module?module.exports=l:e.c3=l}(window);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t={init:function(t){var i={direction:"left",loop:-1,scrolldelay:0,scrollamount:50,circular:!0,drag:!0,runshort:!0,hoverstop:!0,inverthover:!1,xml:!1};return t&&e.extend(i,t),this.each(function(){var t="mouseenter",n="mouseleave";i.inverthover&&(t="mouseleave",n="mouseenter");var a=i.loop,o=e(this).addClass("str_wrap").data({scrollamount:i.scrollamount}),s=!1,r=o.attr("style");if(r)for(var l=r.split(";"),c=!1,d=0;d<l.length;d++){var h=e.trim(l[d]),u=h.search(/^height/g);-1!=u&&(c=parseFloat(o.css("height")))}var g=function(){o.off("mouseleave"),o.off("mouseenter"),o.off("mousemove"),o.off("mousedown"),o.off("mouseup"),e(".str_move",o).length||o.wrapInner(e("<div>").addClass("str_move"));var r=e(".str_move",o).addClass("str_origin"),l=r.clone().removeClass("str_origin").addClass("str_move_clone"),c=0;i.hoverstop||o.addClass("noStop");var d=function(){l.clone().css({left:"100%",right:"auto",width:r.width()}).appendTo(r),l.css({right:"100%",left:"auto",width:r.width()}).appendTo(r)},h=function(){l.clone().css({top:"100%",bottom:"auto",height:r.height()}).appendTo(r),l.css({bottom:"100%",top:"auto",height:r.height()}).appendTo(r)};if("left"==i.direction)if(o.height(r.outerHeight()),r.width()>o.width()){var u=-r.width();i.circular&&(i.xml||(d(),u=-(r.width()+(r.width()-o.width())))),i.xml&&r.css({left:o.width()});var g=o.width(),p=0,f=function(){var e=Math.abs(u),t=e/o.data("scrollamount")*1e3;return 0!=parseFloat(r.css("left"))&&(e+=o.width(),t=(e-(o.width()-parseFloat(r.css("left"))))/o.data("scrollamount")*1e3),t},m=!1,x=function t(){0!=a&&r.stop(!0).animate({left:u},f(),"linear",function(){e(this).css({left:o.width()}),-1==a?m=setTimeout(t,i.scrolldelay):(a--,m=setTimeout(t,i.scrolldelay))})};o.data({moveId:m,moveF:x}),i.inverthover||x(),i.hoverstop&&(o.on(t,function(){e(this).addClass("str_active"),clearTimeout(m),r.stop(!0)}).on(n,function(){e(this).removeClass("str_active"),e(this).off("mousemove"),x()}),i.drag?o.on("mousedown",function(t){i.inverthover&&r.stop(!0);var n,a,l=1,c=t.clientX;return g=r.position().left,p=g-(t.clientX-o.offset().left),e(this).on("mousemove",function(e){s=!0,a=e.clientX,l=a>c?1:-1,c=a,n=p+(e.clientX-o.offset().left),i.circular?(n<-r.width()&&l<0&&(n=0,g=r.position().left,p=g-(e.clientX-o.offset().left)),n>0&&l>0&&(n=-r.width(),g=r.position().left,p=g-(e.clientX-o.offset().left))):(n<-r.width()&&l<0&&(n=o.width(),g=r.position().left,p=g-(e.clientX-o.offset().left)),n>o.width()&&l>0&&(n=-r.width(),g=r.position().left,p=g-(e.clientX-o.offset().left))),r.stop(!0).css({left:n})}).on("mouseup",function(){e(this).off("mousemove"),i.inverthover&&r.trigger("mouseenter"),setTimeout(function(){s=!1},50)}),!1}).on("click",function(){if(s)return!1}):o.addClass("no_drag"))}else if(i.runshort){r.css({left:o.width()});var g=o.width(),p=0,v=function(){return c=(r.width()+r.position().left)/o.data("scrollamount")*1e3},_=function t(){var n=-r.width();r.animate({left:n},v(),"linear",function(){e(this).css({left:o.width()}),-1==a?setTimeout(t,i.scrolldelay):(a--,setTimeout(t,i.scrolldelay))})};o.data({moveF:_}),i.inverthover||_(),i.hoverstop&&(o.on(t,function(){e(this).addClass("str_active"),r.stop(!0)}).on(n,function(){e(this).removeClass("str_active"),e(this).off("mousemove"),_()}),i.drag?o.on("mousedown",function(t){i.inverthover&&r.stop(!0);var n,a,l=1,c=t.clientX;return g=r.position().left,p=g-(t.clientX-o.offset().left),e(this).on("mousemove",function(e){s=!0,a=e.clientX,l=a>c?1:-1,c=a,n=p+(e.clientX-o.offset().left),n<-r.width()&&l<0&&(n=o.width(),g=r.position().left,p=g-(e.clientX-o.offset().left)),n>o.width()&&l>0&&(n=-r.width(),g=r.position().left,p=g-(e.clientX-o.offset().left)),r.stop(!0).css({left:n})}).on("mouseup",function(){i.inverthover&&r.trigger("mouseenter"),e(this).off("mousemove"),setTimeout(function(){s=!1},50)}),!1}).on("click",function(){if(s)return!1}):o.addClass("no_drag"))}else o.addClass("str_static");if("right"==i.direction)if(o.height(r.outerHeight()),o.addClass("str_right"),r.css({left:-r.width(),right:"auto"}),r.width()>o.width()){var u=o.width();r.css({left:0}),i.circular&&(i.xml||(d(),u=r.width()));var b=0;v=function(){var e=o.width(),t=e/o.data("scrollamount")*1e3;return 0!=parseFloat(r.css("left"))&&(e=r.width()+o.width(),t=(e-(r.width()+parseFloat(r.css("left"))))/o.data("scrollamount")*1e3),t};var _=function t(){0!=a&&r.animate({left:u},v(),"linear",function(){e(this).css({left:-r.width()}),-1==a?setTimeout(t,i.scrolldelay):(a--,setTimeout(t,i.scrolldelay))})};o.data({moveF:_}),i.inverthover||_(),i.hoverstop&&(o.on(t,function(){e(this).addClass("str_active"),r.stop(!0)}).on(n,function(){e(this).removeClass("str_active"),e(this).off("mousemove"),_()}),i.drag?o.on("mousedown",function(t){i.inverthover&&r.stop(!0);var n,a,l=1,c=t.clientX;return g=r.position().left,b=g-(t.clientX-o.offset().left),e(this).on("mousemove",function(e){s=!0,a=e.clientX,l=a>c?1:-1,c=a,n=b+(e.clientX-o.offset().left),i.circular?(n<-r.width()&&l<0&&(n=0,g=r.position().left,b=g-(e.clientX-o.offset().left)),n>0&&l>0&&(n=-r.width(),g=r.position().left,b=g-(e.clientX-o.offset().left))):(n<-r.width()&&l<0&&(n=o.width(),g=r.position().left,b=g-(e.clientX-o.offset().left)),n>o.width()&&l>0&&(n=-r.width(),g=r.position().left,b=g-(e.clientX-o.offset().left))),r.stop(!0).css({left:n})}).on("mouseup",function(){i.inverthover&&r.trigger("mouseenter"),e(this).off("mousemove"),setTimeout(function(){s=!1},50)}),!1}).on("click",function(){if(s)return!1}):o.addClass("no_drag"))}else if(i.runshort){var b=0,v=function(){return c=(o.width()-r.position().left)/o.data("scrollamount")*1e3},_=function t(){var n=o.width();r.animate({left:n},v(),"linear",function(){e(this).css({left:-r.width()}),-1==a?setTimeout(t,i.scrolldelay):(a--,setTimeout(t,i.scrolldelay))})};o.data({moveF:_}),i.inverthover||_(),i.hoverstop&&(o.on(t,function(){e(this).addClass("str_active"),r.stop(!0)}).on(n,function(){e(this).removeClass("str_active"),e(this).off("mousemove"),_()}),i.drag?o.on("mousedown",function(t){i.inverthover&&r.stop(!0);var n,a,l=1,c=t.clientX;return g=r.position().left,b=g-(t.clientX-o.offset().left),e(this).on("mousemove",function(e){s=!0,a=e.clientX,l=a>c?1:-1,c=a,n=b+(e.clientX-o.offset().left),n<-r.width()&&l<0&&(n=o.width(),g=r.position().left,b=g-(e.clientX-o.offset().left)),n>o.width()&&l>0&&(n=-r.width(),g=r.position().left,b=g-(e.clientX-o.offset().left)),r.stop(!0).css({left:n})}).on("mouseup",function(){i.inverthover&&r.trigger("mouseenter"),e(this).off("mousemove"),setTimeout(function(){s=!1},50)}),!1}).on("click",function(){if(s)return!1}):o.addClass("no_drag"))}else o.addClass("str_static");if("up"==i.direction)if(o.addClass("str_vertical"),r.height()>o.height()){var y=-r.height();i.circular&&(i.xml||(h(),y=-(r.height()+(r.height()-o.height())))),i.xml&&r.css({top:o.height()});var b=0;v=function(){var e=Math.abs(y),t=e/o.data("scrollamount")*1e3;return 0!=parseFloat(r.css("top"))&&(e+=o.height(),t=(e-(o.height()-parseFloat(r.css("top"))))/o.data("scrollamount")*1e3),t};var _=function t(){0!=a&&r.animate({top:y},v(),"linear",function(){e(this).css({top:o.height()}),-1==a?setTimeout(t,i.scrolldelay):(a--,setTimeout(t,i.scrolldelay))})};o.data({moveF:_}),i.inverthover||_(),i.hoverstop&&(o.on(t,function(){e(this).addClass("str_active"),r.stop(!0)}).on(n,function(){e(this).removeClass("str_active"),e(this).off("mousemove"),_()}),i.drag?o.on("mousedown",function(t){i.inverthover&&r.stop(!0);var n,a,l=1,c=t.clientY;return strMoveTop=r.position().top,b=strMoveTop-(t.clientY-o.offset().top),e(this).on("mousemove",function(e){s=!0,a=e.clientY,a>c?l=1:a<c&&(l=-1),c=a,n=b+e.clientY-o.offset().top,i.circular?(n<-r.height()&&l<0&&(n=0,strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top)),n>0&&l>0&&(n=-r.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top))):(n<-r.height()&&l<0&&(n=o.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top)),n>o.height()&&l>0&&(n=-r.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top))),r.stop(!0).css({top:n})}).on("mouseup",function(){i.inverthover&&r.trigger("mouseenter"),e(this).off("mousemove"),setTimeout(function(){s=!1},50)}),!1}).on("click",function(){if(s)return!1}):o.addClass("no_drag"))}else if(i.runshort){r.css({top:o.height()});var b=0,v=function(){return c=(r.height()+r.position().top)/o.data("scrollamount")*1e3},_=function t(){var n=-r.height();r.animate({top:n},v(),"linear",function(){e(this).css({top:o.height()}),-1==a?setTimeout(t,i.scrolldelay):(a--,setTimeout(t,i.scrolldelay))})};o.data({moveF:_}),i.inverthover||_(),i.hoverstop&&(o.on(t,function(){e(this).addClass("str_active"),r.stop(!0)}).on(n,function(){e(this).removeClass("str_active"),e(this).off("mousemove"),_()}),i.drag?o.on("mousedown",function(t){i.inverthover&&r.stop(!0);var n,a,l=1,c=t.clientY;return strMoveTop=r.position().top,b=strMoveTop-(t.clientY-o.offset().top),e(this).on("mousemove",function(e){s=!0,a=e.clientY,a>c?l=1:a<c&&(l=-1),c=a,n=b+e.clientY-o.offset().top,n<-r.height()&&l<0&&(n=o.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top)),n>o.height()&&l>0&&(n=-r.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top)),r.stop(!0).css({top:n})}).on("mouseup",function(){i.inverthover&&r.trigger("mouseenter"),e(this).off("mousemove"),setTimeout(function(){s=!1},50)}),!1}).on("click",function(){if(s)return!1}):o.addClass("no_drag"))}else o.addClass("str_static");if("down"==i.direction)if(o.addClass("str_vertical").addClass("str_down"),r.css({top:-r.height(),bottom:"auto"}),r.height()>o.height()){var y=o.height();i.circular&&(i.xml||(h(),y=r.height())),i.xml&&r.css({top:-r.height()});var b=0;v=function(){var e=o.height(),t=e/o.data("scrollamount")*1e3;return 0!=parseFloat(r.css("top"))&&(e=r.height()+o.height(),t=(e-(r.height()+parseFloat(r.css("top"))))/o.data("scrollamount")*1e3),t};var _=function t(){0!=a&&r.animate({top:y},v(),"linear",function(){e(this).css({top:-r.height()}),-1==a?setTimeout(t,i.scrolldelay):(a--,setTimeout(t,i.scrolldelay))})};o.data({moveF:_}),i.inverthover||_(),i.hoverstop&&(o.on(t,function(){e(this).addClass("str_active"),r.stop(!0)}).on(n,function(){e(this).removeClass("str_active"),e(this).off("mousemove"),_()}),i.drag?o.on("mousedown",function(t){i.inverthover&&r.stop(!0);var n,a,l=1,c=t.clientY;return strMoveTop=r.position().top,b=strMoveTop-(t.clientY-o.offset().top),e(this).on("mousemove",function(e){s=!0,a=e.clientY,a>c?l=1:a<c&&(l=-1),c=a,n=b+e.clientY-o.offset().top,i.circular?(n<-r.height()&&l<0&&(n=0,strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top)),n>0&&l>0&&(n=-r.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top))):(n<-r.height()&&l<0&&(n=o.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top)),n>o.height()&&l>0&&(n=-r.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top))),r.stop(!0).css({top:n})}).on("mouseup",function(){i.inverthover&&r.trigger("mouseenter"),e(this).off("mousemove"),setTimeout(function(){s=!1},50)}),!1}).on("click",function(){if(s)return!1}):o.addClass("no_drag"))}else if(i.runshort){var b=0,v=function(){return c=(o.height()-r.position().top)/o.data("scrollamount")*1e3},_=function t(){var n=o.height();r.animate({top:n},v(),"linear",function(){e(this).css({top:-r.height()}),-1==a?setTimeout(t,i.scrolldelay):(a--,setTimeout(t,i.scrolldelay))})};o.data({moveF:_}),i.inverthover||_(),i.hoverstop&&(o.on(t,function(){e(this).addClass("str_active"),r.stop(!0)}).on(n,function(){e(this).removeClass("str_active"),e(this).off("mousemove"),_()}),i.drag?o.on("mousedown",function(t){i.inverthover&&r.stop(!0);var n,a,l=1,c=t.clientY;return strMoveTop=r.position().top,b=strMoveTop-(t.clientY-o.offset().top),e(this).on("mousemove",function(e){s=!0,a=e.clientY,a>c?l=1:a<c&&(l=-1),c=a,n=b+e.clientY-o.offset().top,n<-r.height()&&l<0&&(n=o.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top)),n>o.height()&&l>0&&(n=-r.height(),strMoveTop=r.position().top,b=strMoveTop-(e.clientY-o.offset().top)),r.stop(!0).css({top:n})}).on("mouseup",function(){i.inverthover&&r.trigger("mouseenter"),e(this).off("mousemove"),setTimeout(function(){s=!1},50)}),!1}).on("click",function(){if(s)return!1}):o.addClass("no_drag"))}else o.addClass("str_static")};i.xml?e.ajax({url:i.xml,dataType:"xml",success:function(t){for(var n=e(t).find("text"),a=n.length,s=0;s<a;s++){var r=n.eq(s),l=r.text(),c=e("<span>").text(l).appendTo(o);"left"!=i.direction&&"right"!=i.direction||(c.css({display:"inline-block",textAlign:"right"}),s>0&&c.css({width:o.width()+c.width()})),"down"!=i.direction&&"up"!=i.direction||(c.css({display:"block",textAlign:"left"}),s>0&&c.css({paddingTop:o.height()}))}g()}}):g(),o.data({ini:g,startheight:c})})},update:function(){var t=e(this),i=e(".str_origin",t),n=e(".str_move_clone",t);i.stop(!0),n.remove(),t.data("ini")()},destroy:function(){var t=e(this),i=e(".str_move",t),n=t.data("startheight");e(".str_move_clone",t).remove(),t.off("mouseenter"),t.off("mousedown"),t.off("mouseup"),t.off("mouseleave"),t.off("mousemove"),t.removeClass("noStop").removeClass("str_vertical").removeClass("str_active").removeClass("no_drag").removeClass("str_static").removeClass("str_right").removeClass("str_down");var a=t.attr("style");if(a){for(var o=a.split(";"),s=0;s<o.length;s++){-1!=e.trim(o[s]).search(/^height/g)&&(o[s]="")}var r=o.join(";"),l=r.replace(/;+/g,";");";"==l?t.removeAttr("style"):t.attr("style",l),n&&t.css({height:n})}if(i.stop(!0),i.length){var c=i.html();i.remove(),t.html(c)}},pause:function(){var t=e(this);e(".str_move",t).stop(!0)},play:function(){var t=e(this);e(this).off("mousemove"),t.data("moveF")()}};e.fn.liMarquee=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==(void 0===i?"undefined":_typeof(i))&&i?void e.error("Метод "+i+" в jQuery.liMarquee не существует"):t.init.apply(this,arguments)}}(jQuery),function(e){e.fn.jQCloud=function(t,i){var n=this,a=n.attr("id")||Math.floor(1e6*Math.random()).toString(36),o={width:n.width(),height:n.height(),center:{x:(i&&i.width?i.width:n.width())/2,y:(i&&i.height?i.height:n.height())/2},delayedMode:t.length>50,shape:!1,encodeURI:!0,removeOverflowing:!0};i=e.extend(o,i||{}),n.addClass("jqcloud").width(i.width).height(i.height),"static"===n.css("position")&&n.css("position","relative");var s=function(){for(var o=function(e,t){var i=0;for(i=0;i<t.length;i++)if(function(e,t){return Math.abs(2*e.offsetLeft+e.offsetWidth-2*t.offsetLeft-t.offsetWidth)<e.offsetWidth+t.offsetWidth&&Math.abs(2*e.offsetTop+e.offsetHeight-2*t.offsetTop-t.offsetHeight)<e.offsetHeight+t.offsetHeight}(e,t[i]))return!0;return!1},s=0;s<t.length;s++)t[s].weight=parseFloat(t[s].weight,10);t.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0});var r="rectangular"===i.shape?18:2,l=[],c=i.width/i.height,d=function(s,d){var h,u=a+"_word_"+s,g=6.28*Math.random(),p=0,f=0,m=0,x=5,v="",_="";if(d.html=e.extend(d.html,{id:u}),d.html&&d.html.class&&(v=d.html.class,delete d.html.class),t[0].weight>t[t.length-1].weight&&(x=Math.round((d.weight-t[t.length-1].weight)/(t[0].weight-t[t.length-1].weight)*9)+1),h=e("<span>").attr(d.html).addClass("w"+x+" "+v),d.link?("string"==typeof d.link&&(d.link={href:d.link}),i.encodeURI&&(d.link=e.extend(d.link,{href:encodeURI(d.link.href).replace(/'/g,"%27")})),_=e("<a>").attr(d.link).text(d.text)):_=d.text,h.append(_),d.handlers)for(var b in d.handlers)d.handlers.hasOwnProperty(b)&&"function"==typeof d.handlers[b]&&e(h).bind(b,d.handlers[b]);n.append(h);var y=h.width(),w=h.height(),S=i.center.x-y/2,C=i.center.y-w/2,T=h[0].style;for(T.position="absolute",T.left=S+"px",T.top=C+"px";o(h[0],l);){if("rectangular"===i.shape)switch(f++,f*r>(1+Math.floor(m/2))*r*(m%4%2==0?1:c)&&(f=0,m++),m%4){case 1:S+=r*c+2*Math.random();break;case 2:C-=r+2*Math.random();break;case 3:S-=r*c+2*Math.random();break;case 0:C+=r+2*Math.random()}else p+=r,g+=(s%2==0?1:-1)*r,S=i.center.x-y/2+p*Math.cos(g)*c,C=i.center.y+p*Math.sin(g)-w/2;T.left=S+"px",T.top=C+"px"}if(i.removeOverflowing&&(S<0||C<0||S+y>i.width||C+w>i.height))return void h.remove();l.push(h[0]),e.isFunction(d.afterWordRender)&&d.afterWordRender.call(h)};i.delayedMode?function a(o){if(o=o||0,!n.is(":visible"))return void setTimeout(function(){a(o)},10);o<t.length?(d(o,t[o]),setTimeout(function(){a(o+1)},10)):e.isFunction(i.afterCloudRender)&&i.afterCloudRender.call(n)}():(e.each(t,d),e.isFunction(i.afterCloudRender)&&i.afterCloudRender.call(n))};return setTimeout(function(){s()},10),n}}(jQuery),function(e){var t,i=e(document),n=e("head"),a=null,o={},s=0,r="px",l="JColResizer",c="JCLRFlex",d=parseInt,h=Math,u=navigator.userAgent.indexOf("Trident/4.0")>0;try{t=sessionStorage}catch(e){}n.append("<style type='text/css'>  .JColResizer{table-layout:fixed;} .JColResizer > tbody > tr > td, .JColResizer > tbody > tr > th{overflow:hidden;padding-left:0!important; padding-right:0!important;}  .JCLRgrips{ height:0px; position:relative;} .JCLRgrip{margin-left:-5px; position:absolute; z-index:5; } .JCLRgrip .JColResizer{position:absolute;background-color:red;filter:alpha(opacity=1);opacity:0;width:10px;height:100%;cursor: e-resize;top:0px} .JCLRLastGrip{position:absolute; width:1px; } .JCLRgripDrag{ border-left:1px dotted black;\t} .JCLRFlex{width:auto!important;} .JCLRgrip.JCLRdisabledGrip .JColResizer{cursor:default; display:none;}</style>");var g=function(t,i){var a=e(t);if(a.opt=i,a.mode=i.resizeMode,a.dc=a.opt.disabledColumns,a.opt.disable)return p(a);var r=a.id=a.attr("id")||l+s++;a.p=a.opt.postbackSafe,!a.is("table")||o[r]&&!a.opt.partialRefresh||("e-resize"!==a.opt.hoverCursor&&n.append("<style type='text/css'>.JCLRgrip .JColResizer:hover{cursor:"+a.opt.hoverCursor+"!important}</style>"),a.addClass(l).attr("id",r).before('<div class="JCLRgrips"/>'),a.g=[],a.c=[],a.w=a.width(),a.gc=a.prev(),a.f=a.opt.fixed,i.marginLeft&&a.gc.css("marginLeft",i.marginLeft),i.marginRight&&a.gc.css("marginRight",i.marginRight),a.cs=d(u?t.cellSpacing||t.currentStyle.borderSpacing:a.css("border-spacing"))||2,a.b=d(u?t.border||t.currentStyle.borderLeftWidth:a.css("border-left-width"))||1,o[r]=a,f(a))},p=function(e){var t=e.attr("id"),e=o[t];e&&e.is("table")&&(e.removeClass(l+" "+c).gc.remove(),delete o[t])},f=function(i){var n=i.find(">thead>tr:first>th,>thead>tr:first>td");n.length||(n=i.find(">tbody>tr:first>th,>tr:first>th,>tbody>tr:first>td, >tr:first>td")),n=n.filter(":visible"),i.cg=i.find("col"),i.ln=n.length,i.p&&t&&t[i.id]&&m(i,n),n.each(function(t){var n=e(this),a=-1!=i.dc.indexOf(t),o=e(i.gc.append('<div class="JCLRgrip"></div>')[0].lastChild);o.append(a?"":i.opt.gripInnerHtml).append('<div class="JColResizer"></div>'),t==i.ln-1&&(o.addClass("JCLRLastGrip"),i.f&&o.html("")),o.bind("touchstart mousedown",w),a?o.addClass("JCLRdisabledGrip"):o.removeClass("JCLRdisabledGrip").bind("touchstart mousedown",w),o.t=i,o.i=t,o.c=n,n.w=n.width(),i.g.push(o),i.c.push(n),n.width(n.w).removeAttr("width"),o.data(l,{i:t,t:i.attr("id"),last:t==i.ln-1})}),i.cg.removeAttr("width"),i.find("td, th").not(n).not("table th, table td").each(function(){e(this).removeAttr("width")}),i.f||i.removeAttr("width").addClass(c),x(i)},m=function(e,i){var n,a,o=0,s=0,l=[];if(i){if(e.cg.removeAttr("width"),e.opt.flush)return void(t[e.id]="");for(n=t[e.id].split(";"),a=n[e.ln+1],!e.f&&a&&(e.width(a*=1),e.opt.overflow&&(e.css("min-width",a+r),e.w=a));s<e.ln;s++)l.push(100*n[s]/n[e.ln]+"%"),i.eq(s).css("width",l[s]);for(s=0;s<e.ln;s++)e.cg.eq(s).css("width",l[s])}else{for(t[e.id]="";s<e.c.length;s++)n=e.c[s].width(),t[e.id]+=n+";",o+=n;t[e.id]+=o,e.f||(t[e.id]+=";"+e.width())}},x=function(e){e.gc.width(e.w);for(var t=0;t<e.ln;t++){var i=e.c[t];e.g[t].css({left:i.offset().left-e.offset().left+i.outerWidth(!1)+e.cs/2+r,height:e.opt.headerOnly?e.c[0].outerHeight(!1):e.outerHeight(!1)})}},v=function(e,t,i){var n=a.x-a.l,o=e.c[t],s=e.c[t+1],l=o.w+n,c=s.w-n;o.width(l+r),e.cg.eq(t).width(l+r),e.f?(s.width(c+r),e.cg.eq(t+1).width(c+r)):e.opt.overflow&&e.css("min-width",e.w+n),i&&(o.w=l,s.w=e.f?c:s.w)},_=function(t){var i=e.map(t.c,function(e){return e.width()});t.width(t.w=t.width()).removeClass(c),e.each(t.c,function(e,t){t.width(i[e]).w=i[e]}),t.addClass(c)},b=function(e){if(a){var t=a.t,i=e.originalEvent.touches,n=i?i[0].pageX:e.pageX,o=n-a.ox+a.l,s=t.opt.minWidth,l=a.i,c=1.5*t.cs+s+t.b,d=l==t.ln-1,u=l?t.g[l-1].position().left+t.cs+s:c,g=t.f?l==t.ln-1?t.w-c:t.g[l+1].position().left-t.cs-s:1/0;if(o=h.max(u,h.min(g,o)),a.x=o,a.css("left",o+r),d){var p=t.c[a.i];a.w=p.w+o-a.l}if(t.opt.liveDrag){d?(p.width(a.w),!t.f&&t.opt.overflow?t.css("min-width",t.w+o-a.l):t.w=t.width()):v(t,l),x(t);var f=t.opt.onDrag;f&&(e.currentTarget=t[0],f(e))}return!1}},y=function(n){
if(i.unbind("touchend.JColResizer mouseup."+l).unbind("touchmove.JColResizer mousemove."+l),e("head :last-child").remove(),a){if(a.removeClass(a.t.opt.draggingClass),a.x-a.l!=0){var o=a.t,s=o.opt.onResize,r=a.i,c=r==o.ln-1,d=o.g[r].c;c?(d.width(a.w),d.w=a.w):v(o,r,!0),o.f||_(o),x(o),s&&(n.currentTarget=o[0],s(n)),o.p&&t&&m(o)}a=null}},w=function(t){var s=e(this).data(l),r=o[s.t],c=r.g[s.i],d=t.originalEvent.touches;if(c.ox=d?d[0].pageX:t.pageX,c.l=c.position().left,c.x=c.l,i.bind("touchmove.JColResizer mousemove."+l,b).bind("touchend.JColResizer mouseup."+l,y),n.append("<style type='text/css'>*{cursor:"+r.opt.dragCursor+"!important}</style>"),c.addClass(r.opt.draggingClass),a=c,r.c[s.i].l)for(var h,u=0;u<r.ln;u++)h=r.c[u],h.l=!1,h.w=h.width();return!1},S=function(){for(var e in o)if(o.hasOwnProperty(e)){e=o[e];var i,n=0;if(e.removeClass(l),e.f){for(e.w=e.width(),i=0;i<e.ln;i++)n+=e.c[i].w;for(i=0;i<e.ln;i++)e.c[i].css("width",h.round(1e3*e.c[i].w/n)/10+"%").l=!0}else _(e),"flex"==e.mode&&e.p&&t&&m(e);x(e.addClass(l))}};e(window).bind("resize."+l,S),e.fn.extend({colResizable:function(t){var i={resizeMode:"fit",draggingClass:"JCLRgripDrag",gripInnerHtml:"",liveDrag:!1,minWidth:15,headerOnly:!1,hoverCursor:"e-resize",dragCursor:"e-resize",postbackSafe:!1,flush:!1,marginLeft:null,marginRight:null,disable:!1,partialRefresh:!1,disabledColumns:[],onDrag:null,onResize:null},t=e.extend(i,t);switch(t.fixed=!0,t.overflow=!1,t.resizeMode){case"flex":t.fixed=!1;break;case"overflow":t.fixed=!1,t.overflow=!0}return this.each(function(){g(this,t)})}})}(jQuery),define("global:maps:GeoMapGoogleView",["async!http://maps.google.com/maps/api/js?v=3.22&key=AIzaSyD2WhtWvymVvaSFTjqufGtxBgdEaDQbpEw"],function(){return Mn.View.extend({template:!1,onRender:function(){this.$el.css({position:"absolute",top:0,left:0,bottom:0,right:0,margin:"-20px"})},onAttach:function(){function e(){var e=r.getZoom(),t=r.getCenter();if(!this.model.get("ReadOnly")){var i=new Backbone.Model({widget:{name:this.model.get("title"),type:this.model.get("type"),uid:this.model.id,Visualization:this.model.get("Visualization")},CenterLat:t.lat(),CenterLong:t.lng(),Zoom:e});i.url="/api/widget/"+this.model.id+"/setstate",i.save()}}var t=this.model.get("Zoom"),i=this.model.get("CenterLat"),n=this.model.get("CenterLong"),a=t&&i&&n,o=new google.maps.LatLngBounds,s={center:new google.maps.LatLng(i||55.76,n||37.64),zoom:t||10,mapTypeId:google.maps.MapTypeId.ROADMAP},r=new google.maps.Map(this.el,s);google.maps.event.addListener(r,"dragend",e.bind(this)),google.maps.event.addListener(r,"zoom_changed",e.bind(this));var l={coords:[1,1,1,20,18,20,18,1],type:"poly"},c=new google.maps.InfoWindow,d=this.model;this.collection.each(function(e){if(e.get("latitude")&&e.get("longitude")){var t={url:e.get("markerurl"),size:new google.maps.Size(17,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,32)},i=new google.maps.LatLng(parseFloat(e.get("latitude").replace(",",".")),parseFloat(e.get("longitude").replace(",",".")));o.extend(i);var n=new google.maps.Marker({position:i,map:r,icon:t,shape:l,title:e.get("display_name"),zIndex:1});google.maps.event.addListener(n,"click",function(t,i){return function(){d.trigger("click:item",e),c.setContent(e.get("display_name")),c.open(r,t)}}(n))}},this),a||r.fitBounds(o)}})}),define("ejChartView",["i18n!nls/resources.min","global.charts.settingsmodel","RU"],function(e,t){return Mn.View.extend({className:"g--chart",template:_.template(""),initialize:function(){this.subModel=new t,this.options.subset&&this.subModel.set(this.options.subset)},onBeforeRender:function(){this.$el.attr("id",(Date.now().toString(36)+Math.random().toString(36).substr(2,5)).toUpperCase())},onRender:function(){var t=this.subModel;this.$el.css("display","inline-block"),this._getColor(),this.ejOptions={series:this.model.get("flow"),load:"loadTheme",locale:e.Lang,enableRTL:!0,title:{text:t.get("chartTitle")||this.model.get("name")||"",enableTrim:!0},size:{width:this.model.get("width"),height:this.model.get("height")},zooming:{enable:!0,type:"x,y",enableMouseWheel:!0,enableScrollbar:!0,enableDeferredZoom:!0},legend:{visible:t.get("legendVisible"),title:{text:t.get("legendTitle")},enableScrollbar:!1,position:t.get("legendPosition"),rowCount:isNaN(parseInt(t.get("legendRowCount")))?null:parseInt(t.get("legendRowCount")),border:{color:t.get("legendBorderColor"),width:isNaN(parseInt(t.get("legendBorderSize")))?1:parseInt(t.get("legendBorderSize"))}},chartClick:function(e){this.triggerMethod("chart:selected",this)}.bind(this)},"pie"===this.model.get("type")?this.ejOptions.commonSeriesOptions={type:this.model.get("type"),enableAnimation:!0,tooltip:{visible:t.get("tooltipVisible"),format:t.get("tooltipFormat")},border:{width:1,color:"white"},marker:{dataLabel:{visible:t.get("dataLabelVisible"),shape:"none",connectorLine:{type:"bezier",color:"black"},font:{size:"14px"},enableContrastColor:!0}},labelPosition:"outsideExtended",enableSmartLabels:!0,startAngle:145,pieCoefficient:parseFloat(t.get("pieSize")),explodeAll:t.get("explodeAllSegments"),explode:t.get("explodeOnMouseOver")}:(this.ejOptions.primaryXAxis={visible:t.get("primaryXAxisVisible"),title:{text:t.get("primaryXAxisTitle")},majorGridLines:{visible:!0,color:"#a9a9a9",opacity:.12},labelIntersectAction:t.get("primaryXAxislabelIntrsectAction"),valueType:this.model.get("xAxisType").toLowerCase()},this.ejOptions.primaryYAxis={visible:t.get("primaryYAxisVisible"),title:{text:t.get("primaryYAxisTitle")},majorGridLines:{visible:!0,color:"#a9a9a9",opacity:.12},labelIntersectAction:t.get("primaryYAxislabelIntrsectAction"),valueType:this.model.get("yAxisType").toLowerCase()},this.ejOptions.commonSeriesOptions={type:this.model.get("type"),enableAnimation:!0,tooltip:{visible:t.get("tooltipVisible"),format:t.get("tooltipFormat")},marker:{shape:t.get("markerShape"),size:{height:t.get("markerHeight"),width:t.get("markerWidth")},visible:t.get("markerVisible"),dataLabel:{opacity:t.get("dataLabelOpacity"),textPosition:t.get("dataLabelPosition"),visible:t.get("dataLabelVisible")}},columnWidth:parseFloat(t.get("columnWidth")),width:parseInt(t.get("lineWidth"))}),this.model.get("type").indexOf("area")>=0&&(this.ejOptions.commonSeriesOptions.opacity=.5)},onAttach:function(){try{this.$el.ejChart(this.ejOptions)}catch(e){console.error(e.message,"chart name - "+this.model.get("type"))}},_getColor:function(){var e=this.options.palette,t=e?e.WidgetParamValue:void 0;if(t){this.model.get("flow").map(function(e){if(e.fnId&&-1!==e.fnId){var i=_.findWhere(t,{object_id:e.elId});i&&"none"!==i.color&&(e.fill=i.color,e.points.map(function(e){e.fill=i.color}))}else{var n=e.points;_.map(n,function(e){var i=_.findWhere(t,{object_id:e.elId});i&&"none"!==i.color&&(e.fill=i.color)})}})}}})}),define("global.charts.settingsmodel",[],function(){return Backbone.Model.extend({defaults:function(){return{chartTitle:"",enableRTL:!1,tooltipVisible:!0,tooltipFormat:"#series.name# : #point.y#",markerVisible:!0,markerShape:"circle",markerHeight:10,markerWidth:10,dataLabelVisible:!1,dataLabelPosition:"top",dataLabelOpacity:.5,legendVisible:!1,legendTitle:"",legendPosition:"Bottom",legendRowCount:null,legendBorderSize:0,legendBorderColor:"transparent",primaryXAxisVisible:!0,primaryXAxisTitle:"",primaryXAxislabelIntrsectAction:"Trim",primaryYAxisVisible:!0,primaryYAxisTitle:"",primaryYAxislabelIntrsectAction:"Trim",columnWidth:.7,columnSpacing:0,lineWidth:2,pieSize:.8,explodeAllSegments:!1,explodeOnMouseOver:!1,colorSettings:!1}}})}),define("services.library.libraryView",["i18n!nls/resources.min","global.request.param","g/tree","global.grid.dataItemsView"],function(e,t,i,n){var a=new Backbone.Model,o=Backbone.Collection.extend({url:"/api/Request/ExecuteV2?page=1",sync:function(e,t,i){var n=a;n.set("page",this.url.split("?")[1].split("=")[1]),n.url=this.url,Backbone.Collection.prototype.sync.apply(this,["create",n,i])}}),s=Mn.CollectionView.extend({className:"params-container",childView:t,childViewOptions:function(){return{rid:this.options.rid,dbase:this.options.dbase}},emptyView:Mn.View.extend({template:_.template(e.N),templateContext:{Resources:e}})});return Mn.View.extend({className:"request-library",template:templates["services-request-library"],templateContext:{Resources:e},events:{"click .run:not([data-icon='icon-loader'])":function(){this.ui.run.attr("data-icon","icon-loader");var t=this.getChildView("params").collection.toJSON();a.set({id:parseInt(this.requestID),pars:t});var i=new o;this.showChildView("result",new n({collection:i,hideButton:!0})),i.fetch({reset:!0,success:function(){this.ui.run.attr("data-icon","icon-next"),this.getChildView("result").getChildView("table").getChildView("body").$(".btn-link").remove()}.bind(this),error:function(t,i){var n=i.responseJSON?i.responseJSON.msg:null;n?this.getChildView("result").$el.html('<i style="color:red">'+e.rer+": <br/>{ "+n+" }</i>"):this.getChildView("result").$el.html('<i style="color:red">'+i.statusText+"</i>"),this.ui.run.attr("data-icon","icon-next")}.bind(this)})}},ui:{run:"button.run",result:".result",main:".main"},regions:{tree:".left",params:{el:".params",replaceElement:!0},result:{el:"@ui.result",replaceElement:!0}},onRender:function(){this.ui.run.hide();var e=new Backbone.Collection;e.url="/api/request"+(this.options.widgetType?"?widgetType="+this.options.widgetType:""),this.showChildView("tree",new i({collection:e,node:{checkbox:!1}})),e.fetch({reset:!0})},onChildviewContainerSelectItem:function(e){var t=e.model.get("parameters")||[];this.getRegion("result").hasView()&&this.getChildView("result").$el.hide(),e.model.get("isdoc")?(this.requestID=e.model.id,this.showChildView("params",new s({collection:new Backbone.Collection(t),dbase:this.options.dbase})),this.ui.run.show()):(this.getRegion("params").hasView()&&this.getChildView("params").collection.reset(),this.ui.run.hide())},onChildviewAuthorizeEnd:function(){}})});