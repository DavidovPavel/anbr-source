'use strict';

define('PDFJS', ['/js/dist/pdf/shared/util.js'], function () {
    return PDFJS;
});

require.config({
    paths: {
        '@': "@wall",
        async: 'dist/requirejs-plugins/src/async'
    }
});

define(['app', 'access', 'global.view.headerView', 'mainView', 'global.radio.loader'], function (App, acc, Header, mainView) {

    var init = function init() {

        $.ajaxSetup({

            headers: {
                'key': $.ajaxSettings.url
            }
        });

        App.access = acc.data.Points;

        function handler() {
            Backbone.history.navigate('', { trigger: true });
        }

        $("header .logo").on("click", handler);
        $("header .logo").on("touchstart", handler);

        var appRouter = Mn.AppRouter.extend({
            routes: {

                '': function _() {
                    dashboards.getView().showFirst('my');
                    $('head meta[name=viewport]').attr('content', 'width=device-width, initial-scale=1.0');
                },

                'demo': function demo() {
                    dashboards.getView().showFirst('shared');
                    $('head meta[name=viewport]').attr('content', 'width=device-width, initial-scale=1.0');
                },

                'new': function _new() {
                    dashboards.getView().options.uid = null;
                    dashboards.getView().onShow();
                    $('head meta[name=viewport]').attr('content', 'width=device-width, initial-scale=1.0');
                },

                ':uid': function uid(_uid) {
                    dashboards.getView().options.uid = _uid;
                    dashboards.getView().onShow();
                }

            }
        });

        var app = Mn.Application.extend({

            region: 'main',

            onStart: function onStart() {

                this.showView(new mainView());

                new Header().render();

                Backbone.history.start();
            }

        });

        new appRouter();
        var dashboards = new app();
        dashboards.start();
    };

    return {
        init: init
    };
});
'use strict';

define('sendModel', [], function () {

    return Backbone.Model.extend({

        defaults: {
            id: null,
            page: 1,
            pagesize: 30,
            pars: [],
            ts: '',
            useDefParams: true,
            action: 'send'
        },

        url: function url() {
            return '/api/extsrv/' + this.get('action');
        },

        sync: function sync(method, model, options) {

            //Backbone.Model.prototype.sync.apply(this, ['create', model, options]);

            $.ajax({ url: model.url(), method: 'POST', data: JSON.stringify(model.toJSON()), contentType: 'application/json; charset=utf-8' }).done(function () {

                options.success.apply(this, arguments);
            }).fail(function () {

                options.error.apply(this, arguments);
            });
        }
    });
});
'use strict';

define('WidgetModel', [], function () {

    return Backbone.Model.extend({

        defaults: function defaults() {
            return {
                id: null,
                title: "",

                update: false,

                timeUpdate: 360000,

                // метка времени для получения новых данных после момента загрузки
                // конфликт при создании цепочек - sendModel не должна содержать св-во ts
                timeStampForUpdate: '',

                Characteristics: [],
                width: 400,
                height: 460,
                top: 100,
                left: 100,
                zIndex: 1,
                typeName: "",
                requestParameters: {},
                publishers: [],
                Decoration: {
                    CaptionBackground: 'rgba(200, 188, 162, 1)',
                    CaptionForeground: 'rgba(51, 51, 51, 1)',
                    ContainerBackground: 'rgba(255, 255, 255, 1)',
                    ContainerForeground: 'rgba(51, 51, 51, 1)',
                    LinkBackground: 'rgba(255, 255, 255, 1)',
                    LinkForeground: 'rgba(55,141,218,1)',
                    CaptionIsVisible: true,
                    BorderIsVisible: true,
                    ContainerIsTransparent: false
                },
                Visualization: null,
                Legend: null,
                isMarkSelectedItem: false,

                // int?
                SNLevel: null,
                SNLayout: null,
                SNStruct: null,
                SNX: 0,
                SNY: 0,
                SNZoom: 0
            };
        },

        url: function url() {
            return this.collection.url() + "/widget/" + (this.id || "");
        },

        validate: function validate(attr) {

            var output = [],
                dp = '^[\\d]+$';

            function test(s, p) {
                return s === "" || new RegExp(p).test(s);
            }

            if (!attr.title) {
                output.push({ name: "title" });
            }

            if (!attr.typeName) {
                output.push({ name: "typeName" });
            }

            // TODO: убрать костыли
            var types = ["WidgetSource", "WidgetHtml", "WidgetReporting", "WidgetSemNet"];

            if (types.indexOf(this.get("typeName")) === -1 && !attr.requestParameters.requestid) output.push({ name: "requestParameters" });

            if (!test(attr.timeUpdate, dp)) {
                output.push({ name: "timeUpdate" });
            }

            if (!test(attr.width, dp)) {
                output.push({ name: "width" });
            }

            if (!test(attr.height, dp)) {
                output.push({ name: "height" });
            }

            if (output.length) return output;
        }
    });
});
'use strict';

define('radio.characteristic', [], function () {

    var paramModel = Backbone.Model.extend({
        idAttribute: 'WidgetParamUID',
        defaults: {
            WidgetParamUID: null,
            WidgetParamName: '',
            WidgetParamValue: null
        }
    });

    var collectionsParams = Backbone.Collection.extend({

        model: paramModel,

        sync: function sync(method, model, options) {

            Backbone.Model.prototype.sync.apply(this, ['create', model, options]);
        }
    });

    var chW = Mn.Object.extend({

        channelName: 'chW',

        radioRequests: {

            'get:param:model': function getParamModel(a, n) {

                var p = _.findWhere(a, { WidgetParamName: n });

                var m = new paramModel({ WidgetParamName: n });

                if (p) m.set(p);

                return m;
            },

            'get:params:collection': function getParamsCollection(uid) {

                var c = new collectionsParams();
                c.url = '/api/widget/' + uid + '/params';

                return c;
            }

        }

    });

    return new chW();
});
'use strict';

define('sett0', ['i18n!nls/resources.min', 'global.behaviors.input'], function (Resources, InputBehavior) {

    return Mn.View.extend({

        behaviors: {
            input: InputBehavior
        },

        className: 'g-form--input',
        template: '#dashboard-settings0',
        templateContext: { Resources: Resources },

        ui: {
            title: 'input[name="title"]'
        },

        onSave: function onSave() {
            this.model.save({ 'title': this.ui.title.val() });
        },

        onCancel: function onCancel() {},

        modelEvents: {

            invalid: function invalid() {
                this.ui.title.addClass('error');
                setTimeout(function () {
                    this.ui.title.removeClass('error');
                }.bind(this), 3000);
            }
        }

    });
});

define('sett1', ['i18n!nls/resources.min', 'g/ImageGalleryView', 'RU', 'syncfusion'], function (Resources, Gallery) {

    return Mn.View.extend({

        template: '#dashboard-settings1',
        templateContext: { Resources: Resources },

        ui: {
            bgColor: 'input[name=BackgroundColor]',
            position: 'input[name="BackgroundPosition"]',
            link: 'input[name="BackgroundImageLink"]'
        },

        events: {

            "click @ui.position": function clickUiPosition() {
                this.sender.set('BackgroundPosition', parseInt(this.$('input[name=BackgroundPosition]:checked').val()));
            }
        },

        regions: {
            gallery: { el: '.image-gallery', replaceElement: true }
        },

        initialize: function initialize() {

            this.sender = new Backbone.Model(this.model.get('Decoration') || {
                BackgroundColor: 'rgba(255, 255, 255, 1)',
                BackgroundImageLink: 'none',
                BackgroundPosition: 3
            });

            this.sender.on('change', function (m, v) {

                this.ui.position.filter("[value='" + v + "']").prop("checked", true);

                if (v === 3) {
                    this.sender.set('BackgroundImageLink', 'none');
                    var mo = this.getChildView('gallery').collection.findWhere({ select: true });
                    if (mo) mo.set('select', false);
                }

                this.model.trigger('change:Decoration', this.model, this.sender.toJSON());
            }, this);
        },

        onRender: function onRender() {

            this.showChildView('gallery', new Gallery({ selectedImgPath: this.sender.get('BackgroundImageLink') }));

            var rgb = {},
                val = this.sender.get('BackgroundColor') || 'rgba(255, 255, 255, 1)',
                arr = val.substr(val.indexOf('('), val.indexOf(')')).replace('(', '').replace(')', '').split(',');

            _.each(['r', 'g', 'b'], function (l, i) {
                rgb[l] = parseInt(arr[i]);
            });

            this.ui.bgColor.ejColorPicker({
                cssClass: 'g-cp',
                locale: Resources.Lang
            });

            this.ui.bgColor.ejColorPicker({

                value: this.ui.bgColor.data('ejColorPicker').RGBToHEX(rgb),
                opacityValue: arr[3] ? parseFloat(arr[3]) * 100 : 100,

                close: function (args) {

                    var c = this.ui.bgColor.data('ejColorPicker').getColor();
                    this.sender.set('BackgroundColor', 'rgba(' + c.r + ', ' + c.g + ', ' + c.b + ', ' + c.a + ')');
                    //this.model.trigger('change:Decoration', this.model, this.sender.toJSON());
                }.bind(this)

            });
        },

        onChildviewChangeItem: function onChildviewChangeItem(model) {

            this.sender.set({
                BackgroundImageLink: model.get('FileUrl'),
                BackgroundPosition: this.sender.get('BackgroundPosition') === 3 ? 1 : this.sender.get('BackgroundPosition')
            });
        },

        onSave: function onSave() {

            this.model.save({ Decoration: this.sender.toJSON() }, {
                success: function (r) {

                    this.sender.url = '/api/wall/' + r.id + '/decoration';
                    this.sender.save({ id: r.id });
                }.bind(this)
            });
        },

        onCancel: function onCancel() {

            this.sender = new Backbone.Model(this.model.get('Decoration') || {
                BackgroundColor: 'rgba(255, 255, 255, 1)',
                BackgroundImageLink: 'none',
                BackgroundPosition: 3
            });

            this.model.trigger('change:Decoration', this.model, this.sender.toJSON());
            this.render();
        }

    });
});

define('sett2', ['i18n!nls/resources.min'], function (Resources) {

    var toolsForUsers = Mn.View.extend({

        tagName: 'span',
        className: 'g-form--input',

        template: _.template('<input type="text" value="" id="uniname" class="g-form--input" placeholder="<%= Resources.alias %>" /><label for="uniname"><%= Resources.alias %></label><i class="add rtl-1"></i>'),

        templateContext: {
            Resources: Resources
        },

        triggers: {
            'click .add': 'user:check'
        }
    });

    var userCollection = Mn.CollectionView.extend({

        tagName: 'tbody',

        emptyView: Mn.View.extend({
            tagName: 'tr',
            template: _.template('<td colspan="4">' + Resources.N + '</td>')
        }),

        childView: Mn.View.extend({

            tagName: 'tr',

            template: _.template('<td><%- UserTitle %></td><td><%= UserUID %></td><td><%- Access? Resources.rw : Resources.ro %></td><td><span class="clear" data-icon="icon-trash"></span></td>'),
            templateContext: { Resources: Resources },

            triggers: {
                'click .clear': 'clear:item'
            }
        }),

        childViewTriggers: {
            'clear:item': 'clear:item'
        }

    });

    var listUsers = Mn.View.extend({

        tagName: 'table',
        template: _.template('<thead><tr><th><%- Resources.dname %></th><th><%- Resources.login %></th><th><%- Resources.scope %></th><th></th></tr></thead><tbody></tbody><tfoot></tfoot>'),
        templateContext: { Resources: Resources },

        regions: {
            tbody: { el: 'tbody', replaceElement: true }
        },

        onRender: function onRender() {
            this.showChildView('tbody', new userCollection({ collection: this.collection }));
        },

        childViewTriggers: {
            'clear:item': 'clear:item'
        }

    });

    var checkedUser = Mn.View.extend({
        tagName: 'tr',

        template: _.template('<td><%- UserTitle %></td><td><%= UserUID %></td><td><select name="Access"><option value="0"><%- Resources.ro %></option><option value="1"><%- Resources.rw %></option></select></td><td><span class="add" data-icon="icon-round-add"></span></td>'),
        templateContext: { Resources: Resources },

        triggers: {
            'click .add': 'user:add'
        },

        onUserAdd: function onUserAdd() {
            this.model.set('Access', parseInt(this.$('select[name=Access]').val()));
        }
    });

    return Mn.View.extend({

        template: '#dashboard-settings2',

        regions: {
            tools: { el: 'div', replaceElement: true },
            check: { el: '.checked-user', replaceElement: true },
            list: { el: '.list', replaceElement: true }
        },

        initialize: function initialize() {

            this.collection = new Backbone.Collection([], {
                model: Backbone.Model.extend({
                    idAttribute: 'UserID',
                    defaults: {
                        UserID: null,
                        UserUID: '',
                        UserTitle: '',
                        Access: 0
                    }
                })
            });

            this.collection.url = '/api/wall/' + this.model.id + '/users';
        },

        collectionEvents: {
            add: function add(m) {
                $.post('/api/wall/' + this.model.id + '/sharewith', m.toJSON());
            }
        },

        onRender: function onRender() {
            this.showChildView('tools', new toolsForUsers());
            this.showChildView('list', new listUsers({ collection: this.collection }));
            this.collection.fetch({ reset: true });
        },

        childViewEvents: {

            'user:add': function userAdd(v) {
                this.getRegion('check').reset();
                this.collection.add(v.model.toJSON());
            },

            'user:check': function userCheck() {

                var $v = this.getRegion('tools').currentView.$('input');

                if ($.trim($v.val())) {
                    var m = new Backbone.Model();
                    m.url = '/api/users/checkname?name=' + $v.val();
                    m.fetch({
                        success: function (m) {
                            if (m && m.get('UserID')) {
                                this.showChildView('check', new checkedUser({ model: m }));
                                $v.val('').removeClass('error');
                            } else {
                                $v.addClass('error').val(Resources.nf);
                                setTimeout(function () {
                                    $v.removeClass('error').val('');
                                }, 5000);
                            }
                        }.bind(this)
                    });
                } else $v.addClass('error');

                setTimeout(function () {
                    $v.removeClass('error');
                }, 5000);
            },

            'clear:item': function clearItem(v) {

                this.triggerMethod('show:message:confirm', {
                    text: Resources.askyousure,
                    fx: function fx() {
                        v.model.destroy();
                    },
                    ctx: this
                });
            }

        },

        onSave: function onSave() {},

        onCancel: function onCancel() {}

    });
});

define('sett3', ['baseurl', 'i18n!nls/resources.min', 'g/ImageGalleryView'], function (baseurl, Resources, Gallery) {

    return Mn.View.extend({

        template: '#dashboard-settings3',
        templateContext: { Resources: Resources },

        ui: {
            pre: '.thumb-image'
        },

        regions: {
            gallery: '.thumb-gallery'
        },

        events: {

            'change input[name=thumb]': function changeInputNameThumb(e) {

                this.kind = $(e.target).val();

                if (this.kind !== '3') this.hideGallery();

                switch (this.kind) {

                    case '0':
                        this.image = '';
                        this.ui.pre.css('background', 'none');
                        break;

                    case '1':

                        this.ui.pre.append($('<i class="loading" size="l" speed="slow"></i>'));

                        require(['/js/dist/html2canvas.min.js'], function () {
                            html2canvas(this.options.content).then(function (canvas) {

                                //var w = 220, h = 160;
                                //var img = new Image(w, h);
                                //img.src = canvas.toDataURL();

                                //var ca = document.createElement('canvas');
                                //ca.width = w;
                                //ca.height = h;
                                //ca.getContext("2d").drawImage(img, 0, 0, w, h);

                                this.image = canvas.toDataURL();
                                this.ui.pre.css({ 'background-image': 'url(' + this.image + ')' });

                                this.ui.pre.find('i').remove();
                            }.bind(this));
                        }.bind(this));
                        break;

                    case '2':
                        if (this.model.get('Decoration') && this.model.get('Decoration').BackgroundImageLink) {
                            this.image = this.model.get('Decoration').BackgroundImageLink;
                            this.ui.pre.css({ 'background-image': 'url(' + baseurl + '/Files/ImageTransform?path=' + this.image + '&width=220&height=160)' });
                        } else this.triggerMethod('show:message', Resources.noselect);
                        break;

                    case '3':
                        this.image = '';
                        this.getRegion('gallery').$el.show();
                        break;
                }
            }

        },

        initialize: function initialize() {
            this.kind = '0';
            this.image = '';
        },

        onRender: function onRender() {

            var flag = !!this.model.get('Screen') && this.model.get('Screen').indexOf('data:image') === -1;

            if (flag) this.ui.pre.css({ 'background-image': 'url(' + baseurl + '/Files/ImageTransform?path=' + this.model.get('Screen') + '&width=220&height=160)' });else this.ui.pre.css({ 'background-image': 'url(' + this.model.get('Screen') + ')' });

            this.showChildView('gallery', new Gallery({
                selectedImgPath: flag ? this.model.get('Screen') : ''
            }));

            if (flag && this.model.get('Screen') !== this.model.get('Decoration').BackgroundImageLink) this.getRegion('gallery').$el.show();
        },

        hideGallery: function hideGallery() {

            var m = this.getChildView('gallery').collection.findWhere({ select: true });
            if (m) m.set('select', false);

            this.getRegion('gallery').$el.hide();
        },

        onChildviewChangeItem: function onChildviewChangeItem(model) {
            this.image = model.get('FileUrl');
            this.ui.pre.css('background-image', 'url(' + baseurl + '/Files/ImageTransform?path=' + model.get('FileUrl') + '&width=220&height=160)');
        },

        onSave: function onSave(dialog) {

            if (this.kind === '3' && !this.image) this.triggerMethod('show:message', Resources.noselect);else this.model.save({ "Screen": this.image });
        },

        onCancel: function onCancel() {
            this.render();
        }

    });
});

define('@DashboardsView', ['i18n!nls/resources.min', 'WidgetModel', '@widget.WidgetView', 'global.view.dialog'], function (Resources, widgetModel, widgetView, dialog) {

    var channelSelect = Backbone.Radio.channel('selectWidget');

    var sideBarCollection = [{ id: 'sett0', title: Resources.msd0, icon: 'gear' }, { id: 'sett1', title: Resources.msd1, icon: 'appearance' }, { id: 'sett2', title: Resources.msd2, icon: 'permission' }, { id: 'sett3', title: Resources.msd3, icon: 'thumb' }];

    return Mn.CollectionView.extend({

        className: 'main-container',

        onRenderChildren: function onRenderChildren() {

            this.triggerMethod('dashboards:container:full');
        },

        childView: Mn.CollectionView.extend({

            className: 'content',

            initialize: function initialize() {

                this.collection = new Backbone.Collection([], { model: widgetModel });
                //this.collection.comparator = function (w) { return w.get("top") * 100 + w.get("left"); };
                this.collection.url = function () {
                    return '/api/wall/' + this.model.id;
                }.bind(this);
            },

            events: {
                'touchstart': 'onEmpty',
                'click': 'onEmpty'
            },

            onEmpty: function onEmpty(e) {

                if (!$(e.target).closest('.anbr-widget').get(0)) {

                    this.triggerMethod('select:one');

                    Backbone.Radio.channel('sidebar').request('open', { nameView: this.model.get('title'), view: this, title: Resources.dbs }, sideBarCollection);
                }
            },

            showSideBar: function showSideBar() {

                Backbone.Radio.channel('sidebar').trigger('show');
                Backbone.Radio.channel('sidebar').request('open', { nameView: this.model.get('title'), view: this, title: Resources.dbs }, sideBarCollection);
            },

            sideBarTrigger: function sideBarTrigger(m) {

                var controls = m.id === 'sett2' ? [] : [{ id: 'onSave', title: Resources.save, className: 'right blue nest-right' }, { id: 'onCancel', title: Resources.cancel, className: 'right' }];

                require([m.id], function (setView) {

                    var dialogOptions = {
                        icon: 'gear',
                        className: 'settings',
                        title: this.model.id ? m.get('title') : Resources.addVitrin,
                        content: new setView({ model: this.model, content: this.$el }),
                        footer: controls
                    };

                    Backbone.Radio.channel('Notify').request('show:overlay');
                    var dialog = Backbone.Radio.channel('Notify').request('once:dialog', dialogOptions);

                    this.listenTo(dialog, 'footer:button:click', function (a) {

                        if (a.model.id === 'onSave') {
                            //dialogOptions.content.onSave();

                            dialog.$el.hide();
                            Backbone.Radio.channel('Notify').request('hide:overlay');
                        }

                        if (a.model.id === 'onCancel') {
                            //dialogOptions.content.onCancel();
                            Backbone.Radio.channel('Notify').request('hide:overlay');
                            this.removeNew(dialog);
                        }
                    });

                    this.listenTo(dialog, 'dialog:closed', function () {
                        this.removeNew(dialog);
                    }, this);

                    this.listenTo(dialog, 'detach', function () {
                        Backbone.Radio.channel('Notify').request('hide:overlay');
                    });
                }.bind(this));
            },

            removeNew: function removeNew(dialog) {

                if (!this.model.id) {

                    //dialog.$el.hide();
                    //Backbone.Radio.channel('Notify').request('hide:overlay');

                    this.model.set('current', false);
                    this.model.collection.remove(this.model);

                    Backbone.history.navigate('', { trigger: true });
                }
            },

            onRenderChildren: function onRenderChildren() {

                this._loadWidgets(0);
            },

            onRender: function onRender() {

                Backbone.on("window:resizeend", function () {}, this);
            },

            _loadWidgets: function _loadWidgets(count) {

                if (this.children.length > count) {

                    var v = this.children.findByIndex(count);
                    count++;

                    this.listenToOnce(v, 'load:end', function () {
                        this._loadWidgets(count);
                    });

                    var p = v.model.get('requestParameters');

                    if (p.IsInvalid) {

                        v.ui.load.html('<p><i style="color:red;">' + Resources.irdb + '</i></p>');
                        v.trigger('load:end');
                    } else v.onLoad();
                } else Backbone.Radio.channel('Mode').request('enabled', true);
            },

            show: function show() {

                Backbone.Radio.channel('Mode').request('show', !this.model.get("IsShared"));
                Backbone.Radio.channel('Mode').request('left:init:model', this);

                this.model.trigger('change:Decoration', this.model, this.model.get('Decoration'));

                if (this.model.id) {

                    if (!this.isFetch) {

                        Backbone.Radio.channel('Mode').request('enabled', false);
                        Backbone.trigger('message:modal');
                        this.collection.fetch({ reset: true });
                        this.isFetch = true;
                    } else Backbone.Radio.channel('Mode').request('enabled', true);
                } else {
                    this.showSideBar();
                    this.sideBarTrigger(sideBarCollection[0]);
                }

                this.$el.show();

                var ratio = $(window).width() / this.$el.width();
                $('head meta[name=viewport]').attr('content', 'width=device-width, initial-scale=' + (ratio < 1 ? ratio : '1.0'));
            },

            collectionEvents: {

                update: function update(c, o) {

                    if (o.add) {

                        var m = o.changes.added[0],
                            v = this.children.findByModel(m);

                        v.switchMode(true).onLoad();
                        this.triggerMethod('select:one', m);

                        v._addSettings();

                        Backbone.Radio.channel('sidebar').request('open', { nameView: v.model.get('title'), view: v.getChildView('settings'), title: Resources.wst }, v.getChildView('settings').getMenu());
                    }
                },

                destroy: function destroy() {

                    Backbone.Radio.channel('sidebar').request('open', { nameView: this.model.get('title'), view: this, title: Resources.dbs }, sideBarCollection);
                },

                reset: function reset() {

                    Backbone.Radio.channel('Mode').request('enabled', true);
                    Backbone.trigger('message:hide');
                },

                error: function error() {
                    Backbone.trigger('message:hide');
                }
            },

            modelEvents: {

                'change:id': function changeId(m, id) {

                    if (id) {
                        Backbone.history.navigate(id, { trigger: false });
                        Backbone.Radio.channel('Mode').request('enabled', true);
                        Backbone.Radio.channel('Mode').request('turn:switch', true);
                    }
                },

                'change:current': function changeCurrent(m, v) {

                    if (v) {

                        Backbone.Radio.channel('Mode').request('turn:switch', false);
                        $(window).scrollTop(0);

                        Backbone.history.navigate(m.id || 'new', { trigger: !m.id });

                        this.show();
                    } else {
                        this.$el.removeClass('edit-mode').hide();
                    }
                },

                'change:Decoration': function changeDecoration(m, d) {

                    if (d) {
                        var css = {
                            "background-color": d.BackgroundColor,
                            "background-image": d.BackgroundImageLink ? "url('" + d.BackgroundImageLink + "')" : "none",
                            "background-attachment": "fixed",
                            "background-repeat": "no-repeat",
                            "background-position": "50% 50%",
                            "background-size": "auto"
                        };

                        if (d.BackgroundPosition === 1) css["background-size"] = "cover";else if (d.BackgroundPosition === 2) css["background-repeat"] = "repeat";else if (d.BackgroundPosition === 3) css["background-image"] = "none";

                        this.$el.css(css);
                    } else {
                        m.set('Decoration', {
                            BackgroundColor: 'rgba(255, 255, 255, 1)',
                            BackgroundImageLink: 'none',
                            BackgroundPosition: 3
                        });
                    }
                }
            },

            childView: widgetView,

            childViewEvents: {

                'widget:drag': function widgetDrag(m, left, top, isSave) {

                    this.children.each(function (v) {

                        if (v.$el.hasClass("widget-editing") && v.model.id !== m.id) {

                            var t = v.$el.position().top,
                                l = v.$el.position().left;

                            if (t < 0) t = 3;
                            if (l < 0) l = 3;

                            v.model.set({ top: t + top, left: l + left });

                            if (isSave) v.position.save();
                        }
                    }, this);
                },

                'fix:size': function fixSize(m) {

                    if (this.$el.width() < m.get('left') + m.get('width')) {

                        this.$el.width(m.get('left') + m.get('width'));

                        var ratio = $(window).width() / this.$el.width();
                        $('head meta[name=viewport]').attr('content', 'width=device-width, initial-scale=' + (ratio < 1 ? ratio : '1.0'));
                    }

                    if (this.$el.height() < m.get('top') + m.get('height')) {
                        this.$el.height(m.get('top') + m.get('height'));
                    }
                }

            },

            childViewTriggers: {
                'select:more': 'select:more',
                'select:one': 'select:one'
            }
        }),

        childViewTriggers: {
            'select:more': 'select:more:widget',
            'select:one': 'select:one:widget'
        }

    });
});
'use strict';

define('DecorationView', ['i18n!nls/resources.min', 'g/ImageGalleryView', 'spectrumColorView'], function (Resources, Gallery, SpectrumColor) {

    return Mn.View.extend({

        className: "VitrinDecoration",

        template: '#decoration-board',

        templateContext: {
            Resources: Resources
        },

        ui: {
            bgColor: 'input[name=BackgroundColor]',
            position: 'input[name="BackgroundPosition"]',
            link: 'input[name="BackgroundImageLink"]'
        },

        events: {

            "click @ui.position": function clickUiPosition() {
                this.model.set('BackgroundPosition', parseInt(this.$('input[name=BackgroundPosition]:checked').val()));
            },

            "click .icon-clear": function clickIconClear() {
                this.ui.link.val("");
            }
        },

        regions: {
            gallery: { el: '.image-gallery', replaceElement: true }
        },

        onRender: function onRender() {

            this.showChildView('gallery', new Gallery({ selectedImgPath: this.model.get('BackgroundImageLink') }));

            this.color = new SpectrumColor({ el: this.$('input.Decoration') });

            this.listenTo(this.color, "change:color", function ($elm, vrgba, a) {
                this.model.set('BackgroundColor', vrgba);
            });
        },

        onChildviewChangeItem: function onChildviewChangeItem(model) {
            this.model.set({
                BackgroundImageLink: model.get('FileUrl'),
                BackgroundPosition: this.model.get('BackgroundPosition') === 3 ? 1 : this.model.get('BackgroundPosition')
            });
        },

        modelEvents: {

            'change:BackgroundPosition': function changeBackgroundPosition(m, v) {

                this.ui.position.find("[value='" + v + "']").prop("checked", true);

                if (v === 3) {
                    this.model.set('BackgroundImageLink', 'none');
                    var m = this.getChildView('gallery').collection.findWhere({ select: true });
                    if (m) m.set('select', false);
                }
            },

            'change:BackgroundColor': function changeBackgroundColor(m, v) {
                this.color.$el.spectrum("set", v);
            }
        }
    });
});
'use strict';

define('@FirstView', ['i18n!nls/resources.min', 'baseurl'], function (Resources, baseurl) {

    var listView = Mn.CollectionView.extend({

        className: 'list',

        emptyView: Mn.View.extend({

            className: 'create',

            getTemplate: function getTemplate() {

                if (this.options.flag === 'my') return _.template('<section><span class="font-icon font-icon-add"></span><span><%- Resources.addVitrin %></span></section>');else return _.template('');
            },

            templateContext: {
                Resources: Resources
            },

            events: {

                'click': function click() {
                    Backbone.history.navigate(v.model.id || 'new', { trigger: true });
                }

            }

        }),

        childView: Mn.View.extend({

            template: '#first-item-template',
            templateContext: {
                baseurl: baseurl
            },

            triggers: {
                //'touchend': 'click:item',
                'click': 'click:item'
            },

            events: {

                'click i.remove': function clickIRemove(e) {

                    e.stopPropagation();

                    Backbone.trigger("message:confirm", {
                        title: Resources.askyousure, message: $.Format(Resources.deltext, Resources.todashboard, this.model.get("title")),
                        fx: function fx() {
                            this.model.destroy();
                        },
                        ctx: this
                    });
                }

            },

            modelEvents: {

                'change:Screen': function changeScreen(m, v) {
                    this.render();
                }
            }
        }),

        childViewTriggers: {
            'click:item': 'click:item'
        },

        childViewOptions: function childViewOptions() {
            return { flag: this.options.flag };
        },

        filter: function filter(m) {
            return this.options.flag === 'my' ? !m.get('IsShared') : m.get('IsShared');
        },

        onRenderChildren: function onRenderChildren() {

            if (this.options.flag === 'my') {

                var addView = Mn.View.extend({
                    className: 'create',
                    template: _.template('<section><span class="font-icon font-icon-add"></span><span><%- Resources.addVitrin %></span></section>'),
                    templateContext: {
                        Resources: Resources
                    }
                });

                this.addChildView(new addView({ model: new Backbone.Model({ id: 'create' }) }), 0);
            } else this.$('i.remove').hide();
        },

        onRender: function onRender() {

            this.$el.sortable({

                placeholder: "placeholder-class",
                items: "div:not(.create)",
                stop: function (e, ui) {

                    //console.log('sort:stop', args, this);

                }.bind(this)

            }).disableSelection();
        }

    });

    return Mn.View.extend({

        template: '#first-page-template',
        templateContext: {
            Resources: Resources
        },

        ui: {
            title: 'h1'
        },

        regions: {
            list: { el: '.list', replaceElement: true }
        },

        events: {

            'touchstart button': 'tabNav',
            'click button': 'tabNav',

            'click .create': function clickCreate() {
                Backbone.history.navigate('new', { trigger: true });
            }

        },

        tabNav: function tabNav(e) {

            var link = $(e.target).closest('button').attr('data-link');
            Backbone.history.navigate(link === 'shared' ? 'demo' : '', { trigger: true });
        },

        onBeforeRender: function onBeforeRender() {
            this.$el.attr('id', 'first-page');
        },

        onRender: function onRender() {

            this.showChildView('list', new listView({ collection: this.collection, flag: this.options.filter }));

            var res = {
                my: Resources.myDashboard,
                shared: Resources.shareDashboard
            };

            this.$("button[data-link='" + this.options.filter + "']").addClass("pressed");

            this.ui.title.text(res[this.options.filter]);
        },

        onChildviewClickItem: function onChildviewClickItem(v) {

            Backbone.history.navigate(v.model.id || 'new', { trigger: true });
        }

    });
});
'use strict';

define('mainView', ['i18n!nls/resources.min', '@FirstView', '@SliderView', '@DashboardsView', 'leftPanel', 'topPanel', 'global.radio.sideBar'], function (Resources, firstView, sliderView, dashboardsView, leftPanel, topPanel) {

    var modeChannel = Mn.Object.extend({
        channelName: 'Mode'
    });

    new modeChannel();

    var selectWidget = Mn.Object.extend({
        channelName: 'selectWidget'
    });

    new selectWidget();

    var boardModel = Backbone.Model.extend({
        defaults: {
            id: null,
            title: Resources.title,
            IsShared: false,
            current: false,
            isInit: false,
            Screen: '',
            Decoration: {
                BackgroundColor: 'rgba(255, 255, 255, 1)',
                BackgroundImageLink: 'none',
                BackgroundPosition: 3
            },
            CDate: new Date().toISOString()
        },
        validate: function validate(attr, o) {
            var output = [];

            if (!$.trim(attr.title)) output.push({ name: "title" });

            if (output.length) return output;
        }
    });

    var boardCollection = Backbone.Collection.extend({
        model: boardModel,
        url: function url() {
            return '/api/wall/';
        }
    });

    return Mn.View.extend({

        template: '#main-template',
        templateContext: {
            Resources: Resources
        },

        ui: {
            mode: '.mode-info',
            sw: '.g-form--switch'
        },

        regions: {
            first: { el: '#first', replaceElement: true },
            container: { el: '#container', replaceElement: true },
            top: { el: '.Shna', replaceElement: true },
            left: { el: '#left-property', replaceElement: true },
            slider: { el: '#slider', replaceElement: true },
            dialog: { el: '#dialog', replaceElement: true }
        },

        triggers: {

            'click @ui.mode:not(.disabled) button': 'click:mode'

        },

        onClickMode: function onClickMode() {
            Backbone.Radio.channel('Mode').request('turn:switch', this.ui.sw.attr("mode") !== "on");
        },

        initialize: function initialize() {

            this.collection = new boardCollection();
            this.collection.comparator = function (m) {
                return -new Date(m.get('CDate'));
            };

            var channelMode = Backbone.Radio.channel('Mode');

            channelMode.reply('show', function (flag) {
                if (flag) this.ui.mode.show();else this.ui.mode.hide();
            }.bind(this));

            channelMode.reply('enabled', function (flag) {
                if (flag) this.ui.mode.removeClass('disabled');else this.ui.mode.addClass('disabled');
            }.bind(this));

            // switch-mode
            channelMode.reply('turn:switch', this.switchMode.bind(this));

            // render dialog
            Backbone.Radio.channel('Notify').reply('add:dialog', function (dialog) {

                if (this.getRegion('dialog').hasView()) {

                    var f = this.getChildView('dialog').$el.is(':visible');

                    if (f) {

                        //

                    } else this.showChildView('dialog', dialog);
                } else this.showChildView('dialog', dialog);
            }.bind(this));
        },

        onBeforeRender: function onBeforeRender() {

            Backbone.trigger('message:modal');
            this.collection.fetch({ reset: true });
        },

        onRender: function onRender() {

            this.showChildView('top', new topPanel());
            this.showChildView('left', new leftPanel());

            this.showChildView('slider', new sliderView({ collection: this.collection }));

            this.showChildView('container', new dashboardsView({ collection: this.collection }));
        },

        childViewEvents: {

            'render:vitrin:after:clone:widget': function renderVitrinAfterCloneWidget(m) {

                var v = this.getChildView('container').children.findByModel(m);

                if (v.isFetch) v.collection.fetch({ reset: true });
            },

            'select:more:widget': function selectMoreWidget(m) {

                this.getChildView('top').getChildView('position').collection.add(m);
            },

            'select:one:widget': function selectOneWidget(m) {

                var pos = this.getChildView('top').getChildView('position');

                pos.collection.reset();
                if (m) pos.collection.add(m);
            },

            'dashboards:container:full': function dashboardsContainerFull() {

                if (this.isWaitShow) this.show();
            },

            'slider:new:dashboard': function sliderNewDashboard() {
                this.options.uid = null;
                this.show();
            },

            'show:left:panel': function showLeftPanel() {

                this.getChildView('left').onShow();
            }

        },

        showFirst: function showFirst(filter) {

            this.getRegion('dialog').empty();

            Backbone.Radio.channel('Mode').request('show', false);

            if (this.getRegion('first').hasView()) {

                if (this.getChildView('first').options.filter !== filter) {
                    this.getChildView('first').options.filter = filter;
                    this.getChildView('first').render();
                    this.getChildView('first').$el.show();
                } else this.getChildView('first').$el.slideDown();
            } else this.showChildView('first', new firstView({ collection: this.collection, filter: filter }));
        },

        onShow: function onShow() {

            if (this.getRegion('first').hasView()) this.getChildView('first').$el.slideUp();

            if (this.collection.length) this.show();else this.isWaitShow = true;
        },

        show: function show() {

            if (this.options.uid) {

                this.clearCurrent();
                var m = this.collection.get(this.options.uid);

                if (m) m.set('current', true);else {
                    Backbone.trigger('message:warning', { message: Resources.dnvu });
                    Backbone.history.navigate('', { trigger: true });
                }
            } else {

                this.getRegion('dialog').empty();
                Backbone.Radio.channel('Mode').request('enabled', false);
                this.getChildView('left').$el.removeClass('show');
                this.getChildView('top').getChildView('position').collection.reset();

                var model = this.collection.findWhere({ id: null }) || new boardModel();
                model.collection = this.collection;

                this.collection.add(model);

                this.clearCurrent();
                model.set('current', true);

                var v = this.getChildView('container').children.findByModel(model);
                this.getChildView('top').onShow(v);
            }
        },

        collectionEvents: {

            remove: function remove() {

                if (!this.collection.length) {
                    this.options.uid = null;
                    this.show();
                }
            },

            reset: function reset() {

                if (!this.collection.length) {
                    this.options.uid = null;
                    this.show();
                }

                Backbone.trigger('message:hide');
            },

            error: function error() {
                Backbone.trigger('message:hide');
            }
        },

        clearCurrent: function clearCurrent() {

            var c = this.collection.findWhere({ current: true });
            if (c) c.set('current', false);
        },

        switchMode: function switchMode(flag) {

            var m = this.collection.findWhere({ current: true }),
                v = this.getChildView('container').children.findByModel(m);

            if (flag) {

                this.ui.sw.attr("mode", "on");
                v.$el.addClass('edit-mode');

                this.getChildView('top').onShow(v);

                v.showSideBar();

                // show edit buttons
                this.getChildView('slider').getChildView('list').children.each(function (v) {
                    if (!v.model.get('IsShared')) v.$('span').css("display", "inline-block");
                });

                v.children.each(function (w) {
                    w.switchMode(true);
                });
            } else {

                this.ui.sw.attr("mode", "off");
                v.$el.removeClass('edit-mode');

                this.getChildView('top').$el.hide();
                this.getChildView('left').$el.removeClass('show');
                //this.getChildView('right').$el.removeClass('show');

                Backbone.Radio.channel('sidebar').trigger('hide');

                this.getRegion('dialog').empty();

                // hide edit buttons                    
                this.getChildView('slider').getChildView('list').children.each(function (v) {
                    if (v.model.id) v.$('span').hide();
                });

                v.children.each(function (w) {
                    w.switchMode(false);
                });
            }
        }

    });
});
'use strict';

define('@SliderView', ['baseurl', 'i18n!nls/resources.min'], function (baseurl, Resources) {

    var VITRINA_ITEM_WIDTH = 273;

    var sliderList = Mn.CollectionView.extend({

        className: 'slider',

        childView: Mn.View.extend({

            className: "vitrina",

            template: '#slider-item-template',
            templateContext: {
                baseurl: baseurl
            },

            events: {

                //'touchstart .panel-vitrin': 'setCurrent',
                'click .panel-vitrin': 'setCurrent',

                'click .delete-vitrina': function clickDeleteVitrina() {

                    Backbone.trigger("message:confirm", {
                        title: Resources.askyousure, message: $.Format(Resources.deltext, Resources.todashboard, this.model.get("title")),
                        fx: function fx() {

                            if (this.model.get('current')) this.model.set('current', false);

                            this.model.destroy();
                            Backbone.history.navigate('', { trigger: true });
                        },
                        ctx: this
                    });
                }
            },

            setCurrent: function setCurrent() {

                var c = this.model.collection.findWhere({ current: true });

                if (c) {

                    if (this.model.id !== c.id) {
                        c.set('current', false);
                        this.model.set('current', true);
                    }
                } else this.model.set('current', true);
            },

            modelEvents: {

                'change:current': function changeCurrent(m, v) {

                    if (v) {

                        this.$el.addClass('current');
                        this.triggerMethod('slider:render', this.$el.index());
                    } else this.$el.removeClass('current');
                },

                'change:Screen': function changeScreen(m, v) {

                    this.render();
                },

                'change:title': function changeTitle(m, v) {
                    this.$('.name-vitrina').text(v);
                }

            },

            onDetach: function onDetach() {
                this.triggerMethod('slider:board:detached', this);
            }

        }),

        calcStep: function calcStep() {

            var dw = this.$el.closest('.items-wrap').width(),
                sw = this.collection.length * VITRINA_ITEM_WIDTH,
                flag = sw > dw;

            if (flag) this.maxStep = Math.ceil((sw - dw) / VITRINA_ITEM_WIDTH);else this.maxStep = 0;

            if (this.step >= this.maxStep) flag = false;

            this.triggerMethod('show:more', flag);
        },

        slideLine: function slideLine(p) {

            var flag = p >= this.maxStep;
            if (flag) this.step = this.maxStep;else this.step = p;

            if (this.step !== 0) this.step -= 1;

            this.$el.animate({ "left": '-' + this.step * VITRINA_ITEM_WIDTH });
            this.triggerMethod('show:more', !flag);
        },

        initialize: function initialize() {

            this.step = 0;
            this.maxStep = 0;
            Backbone.on("window:resizeend", this.calcStep, this);
        },

        onRenderChildren: function onRenderChildren() {

            var w = this.collection.length * VITRINA_ITEM_WIDTH;
            this.$el.width(w);

            this.calcStep();

            var cm = this.collection.findWhere({ current: true });

            if (cm) {
                var v = this.children.findByModel(cm);
                v.$el.addClass('current');
                this.slideLine(v.$el.index());
            }
        },

        onChildviewSliderRender: function onChildviewSliderRender(p) {
            this.slideLine(p);
        }
    });

    return Mn.View.extend({

        template: '#slider-template',
        templateContext: {
            Resources: Resources
        },

        triggers: {
            'click .show-add-vitrin': 'slider:new:dashboard'
        },

        events: {

            'click .bolt-lug': 'top',
            "click .le": 'left',
            "click .ri": 'right',

            'touchstart .bolt-lug': 'top',
            "touchstart .le": 'left',
            "touchstart .ri": 'right'
        },

        ui: {
            more: '.continue'
        },

        regions: {
            list: '.items-wrap'
        },

        onRender: function onRender() {

            this.$el.attr('id', 'vitrin-list');
            this.showChildView('list', new sliderList({ collection: this.collection }));
        },

        collectionEvents: {

            update: function update(c, o) {

                this.getChildView('list').calcStep();
            },

            reset: function reset() {

                setTimeout(function () {
                    this.top();
                }.bind(this), 8000);
            }
        },

        top: function top() {
            this.$el.toggleClass("abs").find(".arrow").toggleClass("nord");
        },

        left: function left() {
            var list = this.getChildView('list');
            if (list.step > 0) {
                list.step--;
                list.$el.animate({ "left": "+=" + VITRINA_ITEM_WIDTH });
                this.ui.more.show();
            }
        },

        right: function right() {
            var list = this.getChildView('list');
            if (list.step < list.maxStep) {
                list.step++;
                list.$el.animate({ "left": "-=" + VITRINA_ITEM_WIDTH });
                if (list.step === list.maxStep) this.ui.more.hide();
            } else this.ui.more.hide();
        },

        onChildviewShowMore: function onChildviewShowMore(flag) {
            if (flag) this.ui.more.show();else this.ui.more.hide();
        }

    });
});
'use strict';

define('d3:histogram', ['global.charts.settingsmodel'], function (subSettings) {

    return Mn.View.extend({

        template: _.template(''),

        initialize: function initialize() {

            this.flag = false;
            this.isGrouped = false;
            this.Grops = {};
            var items = this.options.items.variations[1].flow[0].points;
            this.dx = [];
            this.collection = new Backbone.Collection();

            var name = this.model.get('typeName') + ".GhaphSubSettings";
            var p = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: name });

            this.subSettings = new subSettings();

            if (p) this.subSettings.set(p.WidgetParamValue);

            _.each(items, function (m) {

                var z = {
                    id: m.elId,
                    x: m.x,
                    y: parseFloat(m.y),
                    title: m.text //_.findWhere(this.model.get('feed').head, { systemName: 'yval' }).displayName
                };

                var e = this.collection.get(z.id),
                    date = new Date(z.x),
                    xout = z.x;

                if (date.toString() !== "Invalid Date") {
                    xout = date;
                    this.flag = true;
                }

                if (this.dx.indexOf(xout) === -1) this.dx.push(xout);

                if (e) {
                    var ys = e.get("y");
                    ys.push(z.y);
                    e.set("y", ys);
                } else {
                    z.y = [z.y];
                    this.collection.add(z);
                }
            }, this);
        },

        onBeforeRender: function onBeforeRender() {

            this.$el.css({ position: 'absolute', top: 0, left: 0, bottom: 0, right: 0 });
        },

        onRender: function onRender() {

            var columns = [];

            this.collection.each(function (m, i) {

                var ay = m.get("y"),
                    gid = m.get("GroupName");

                if (this.dx.indexOf("x") === -1) this.dx.unshift("x");

                if (ay.length !== 1) {
                    columns.push(this.dx);
                    ay.unshift(m.get("title"));
                } else ay.unshift(m.get("x"));

                columns.push(ay);

                if (gid) {
                    this.isGrouped = true;
                    if (!this.Grops[gid]) this.Grops[gid] = [m.get("x")];else {
                        this.Grops[gid].push(m.get("x"));
                    }
                }
            }, this);

            var data = {
                columns: columns,
                type: this.options.chart || 'bar'
            },
                axis = {
                y: {
                    label: this.subSettings.get('primaryYAxisTitle')
                }
            },
                groups = [],
                category = [];

            if (this.flag) {
                data.x = "x";
                axis.x = {
                    type: 'timeseries',
                    tick: {
                        format: '%Y-%m-%d'
                    }
                };
            }

            if (this.isGrouped) {
                for (var a in this.Grops) {
                    groups.push(this.Grops[a]);
                    category.push(a);
                    if (category.length >= 2) {
                        _.each(columns, function (a) {
                            _.each(groups, function (g, i) {
                                if (_.contains(g, a[0])) a.splice(i + 1, 0, 0);
                            });
                        });
                    }
                }

                axis.x = {
                    type: 'category',
                    categories: category
                };
                data.groups = groups;
            }

            try {

                c3.generate({

                    bindto: this.el,
                    data: data,
                    tooltip: {
                        grouped: false,
                        format: {
                            title: function title(d) {
                                return this.title;
                            }
                        }
                    },
                    axis: axis,
                    bar: {
                        width: {
                            ratio: 0.5
                        }
                    }
                });
            } catch (e) {

                console.error(e.message, data);
            }
        }
    });
});
'use strict';

define('leftPanel', ['WidgetModel', 'MasterCreateView'], function (WidgetModel, MasterCreateView) {

        return Mn.View.extend({

                className: 'side-panel',
                template: _.template('<svg class="svg-icon icon-close"><use xlink:href="#icon-close" /></svg><section id="master-create"></section>'),

                events: {
                        'click .icon-close': function clickIconClose() {
                                this.$('.step-panel').hide();
                                this.$el.removeClass('big').removeClass("show");
                        }
                },

                regions: {
                        master: "#master-create"
                },

                initialize: function initialize() {

                        this.model = new WidgetModel();

                        Backbone.Radio.channel('Mode').reply('left:init:model', function (v) {

                                this.collection = v.collection;
                        }.bind(this));
                },

                onRender: function onRender() {
                        this.$el.attr('id', 'left-property');
                },

                onShow: function onShow() {

                        this.model = new WidgetModel();
                        this.model.collection = this.collection;

                        if (!this.$el.hasClass("show")) {
                                this.$el.addClass("show");
                                this.showChildView('master', new MasterCreateView({ model: this.model }));
                        }
                },

                onChildviewCloseLeft: function onChildviewCloseLeft() {
                        this.$el.removeClass('show');
                        this.getRegion('master').empty();
                }
        });
});
'use strict';

define('topPanel', ['i18n!nls/resources.min', 'global.view.dropDown', 'global.view.dialog', 'settings.decorationWidget'], function (Resources, dropDown, dialog, decorationContent) {

    var MIN_SIZE = 150;

    var cloneDialog = Mn.View.extend({

        template: '#clone-widget-dialog-template',
        templateContext: {
            Resources: Resources
        },

        ui: {
            nd: '#newDBName'
        },

        regions: {
            dd: { el: '#dashboards-list', replaceElement: true }
        },

        events: {
            "change select.profile": "selectVitrina"
        },

        onRender: function onRender() {

            var collection = new Backbone.Collection(this.model.collection.models);
            collection.add({ id: 0, title: Resources.wall_toPanelView_newVitrina }, { at: 0 });

            var dd = new dropDown({ collection: collection, current: "0" });
            this.showChildView('dd', dd);

            this.listenTo(dd, "dropdown:select", function (model) {
                this.selectClonningVitrina(model.id);
            });

            this.getChildView('dd').getChildView('container').setFilter(function (m) {
                return !m.get('IsShared');
            }.bind(this));
        },

        //#4277 Volkov - поле редактирования для ввода имени витриы скрывается, если пользователь клонирует на существующую витрину 
        selectClonningVitrina: function selectClonningVitrina(vitrina) {
            if (vitrina) $(this.ui.nd).parent().parent().hide();else $(this.ui.nd).parent().parent().show();
        }
    });

    var positionView = Mn.View.extend({

        //tagName: 'span',
        tagName: 'div',
        className: 'position-buttons',

        template: '#position-btns-template',
        templateContext: {
            Resources: Resources
        },

        ui: {
            dx: "input[name='PositonPadding-x']",
            dy: "input[name='PositonPadding-y']",
            width: 'input[name="width"]',
            height: 'input[name="height"]'
        },

        regions: {
            mo: { el: '#multi-operation', replaceElement: true },
            dialog: { el: '#dialog', replaceElement: true }
        },

        events: {

            "click button:not([disabled])": "fixed",

            'keyup @ui.dx': function keyupUiDx(e) {
                if (e.keyCode === 13) this.fixed(e, 'dispose-x');
            },

            'keyup @ui.dy': function keyupUiDy(e) {
                if (e.keyCode === 13) this.fixed(e, 'dispose-y');
            },

            'keyup @ui.width': function keyupUiWidth(e) {

                if (e.keyCode === 13) this._setProp(parseInt(this.ui.width.val()), 'width');
            },

            'keyup @ui.height': function keyupUiHeight(e) {

                if (e.keyCode === 13) this._setProp(parseInt(this.ui.height.val()), 'height');
            }

        },

        _setProp: function _setProp(prop, name) {

            //if ( this.keyTimeout )
            //    clearTimeout( this.keyTimeout );

            //this.keyTimeout = setTimeout( function () {

            var ch = this.currentDashboard.children;

            this.collection.each(function (m) {

                if (isNaN(prop) || prop < MIN_SIZE) {
                    this.ui[name].val(m.get(name));
                } else {
                    m.set(name, prop);
                    ch.findByModel(m).position.save();
                }
            }, this);

            //}.bind( this ), 500 );
        },

        fixed: function fixed(e, name) {

            var name = $(e.target).closest("button").attr("name") || name,
                dx = parseInt(this.ui.dx.val()),
                dy = parseInt(this.ui.dy.val()),
                propname = name;

            if (name === "front") {
                this.calcPosition(true);
                return;
            }
            if (name === "back") {
                this.calcPosition(false);
                return;
            }

            if (this.collection.length > 1) {

                this.firstModel = this.collection.at(0);

                var data = [],
                    first = this.firstModel.get(propname),
                    prev = {
                    left: this.firstModel.get("left"),
                    top: this.firstModel.get("top")
                };

                this.collection.each(function (m) {

                    var o = {};

                    switch (name) {

                        case "dispose-x":
                            propname = "left";
                            first = prev.left;
                            if (isNaN(dx)) {
                                this.ui.dx.css('border-color', 'red');
                                setTimeout(function () {
                                    this.ui.dx.css('border-color', '');
                                }.bind(this), 2000);
                                return;
                            } else this.ui.dx.css('border-color', '');

                            prev.left += m.get("width") + dx;
                            break;

                        case "dispose-y":
                            propname = "top";
                            first = prev.top;
                            if (isNaN(dy)) {
                                this.ui.dy.css('border-color', 'red');
                                setTimeout(function () {
                                    this.ui.dy.css('border-color', '');
                                }.bind(this), 2000);
                                return;
                            } else this.ui.dx.css('border-color', '');
                            prev.top += m.get("height") + dy;
                            break;

                        case "size":
                            first = {};
                            first.width = this.firstModel.get("width");
                            first.height = this.firstModel.get("height");
                            propname = "size";
                            break;

                        case "middle":
                            propname = "top";
                            first = this.firstModel.get("top") + this.firstModel.get("height") / 2 - m.get("height") / 2;
                            if (first < 0) first = 5;
                            break;

                        case "bottom":
                            propname = "top";
                            first = this.firstModel.get("top") + this.firstModel.get("height") - m.get("height");
                            if (first < 0) first = 5;
                            break;

                        case "center":
                            propname = "left";
                            first = this.firstModel.get("left") + this.firstModel.get("width") / 2 - m.get("width") / 2;
                            if (first < 0) first = 5;
                            break;

                        case "right":
                            propname = "left";
                            first = this.firstModel.get("left") + this.firstModel.get("width") - m.get("width");
                            if (first < 0) first = 5;
                            break;
                    }

                    data.push({
                        WidgetUid: m.id,
                        PlacementWidth: name === "size" ? first.width : name === "width" ? first : m.get("width"),
                        PlacementHeight: name === "size" ? first.height : name === "height" ? first : m.get("height"),
                        PlacementTop: propname === "top" ? first : m.get('top'),
                        PlacementLeft: propname === "left" ? first : m.get('left'),
                        ZIndex: name === "zIndex" ? first : m.get("zIndex")
                    });

                    if (name !== "size") {
                        m.set(propname, first);
                    } else {
                        m.set({ width: first.width, height: first.height });
                    }
                }, this);

                this.onSave(data);
            }
        },

        calcPosition: function calcPosition(front) {

            var first = this.collection.at(0),
                child = this.currentDashboard.children,
                p = 1;

            if (!front) {

                var data = [];
                this.currentDashboard.collection.each(function (m) {
                    if (parseInt(m.get('zIndex')) === 1) {
                        var v = child.findByModel(m);
                        m.set("zIndex", m.get('zIndex') + 1);
                        data.push(v.position.toJSON());
                    }
                });

                this.onSave(data);
            } else {

                var max = this.currentDashboard.collection.max(function (m) {
                    return m.get("zIndex");
                });

                if (max) if (first.id !== max.id) p = parseInt(max.get("zIndex")) + 1;else return;
            }

            first.set("zIndex", p);
            var fv = child.findByModel(first);
            fv.position.save();
            fv.$el.removeClass('widget-editing');
        },

        onSave: function onSave(data) {

            $.ajax({
                method: "POST",
                contentType: 'application/json; charset=utf-8',
                url: '/api/wall/' + this.model.id + '/positions',
                data: JSON.stringify(data)
            });

            //this.collection.reset();
        },

        collectionEvents: {

            destroy: function destroy(m) {
                this.$('#count').text(this.collection.length);
            },

            add: function add(m) {

                this.currentDashboard.children.findByModel(m).$el.addClass('widget-editing');

                this.$("button[name=front], button[name=back], button[name=resize]").removeAttr("disabled", "disabled");

                if (this.collection.length > 1) {

                    this.$("button").removeAttr("disabled");
                    this.ui.width.val('');
                    this.ui.height.val('');

                    var a = [{ id: 'decoration', title: Resources.m3, icon: 'appearance' }, { id: 'clear', title: Resources.del, icon: 'trash' }];

                    Backbone.Radio.channel('sidebar').request('open', { titleView: '', view: this, name: Resources.dbs }, a);
                } else {
                    this.ui.width.val(m.get('width'));
                    this.ui.height.val(m.get('height'));
                }

                this.getChildView('mo').$el.removeClass('disabled');
                this.$('#count').text(this.collection.length);
            },

            reset: function reset(c, o) {

                if (!this.currentDashboard) return;

                this.currentDashboard.children.each(function (v) {

                    v.$el.removeClass('widget-editing');

                    if (v.getRegion('settings').hasView()) v.getChildView('settings').hide();
                });

                this.$('#count').text(this.collection.length);

                this.$("button").attr("disabled", "disabled");

                this.getChildView('mo').$el.addClass('disabled');
            }
        },

        initialize: function initialize() {

            this.collection = new Backbone.Collection();
        },

        onRender: function onRender() {

            this.$("button").attr("disabled", "disabled");

            this.showChildView('mo', new dropDown({
                placeholder: '<div class="item"><span><svg><use xlink:href="#selected-widgets" /></svg></span><span>' + Resources.selectedWidgets + '</span><span id="count">0</span></div>',
                collection: new Backbone.Collection([{ id: 'clone', title: Resources.cloneTo, icon: 'icon-clone' }, { id: 'clear', title: Resources.deleteItem, icon: 'icon-trash' }])
            }));

            this.getChildView('mo').$el.addClass('disabled');
        },

        childViewEvents: {

            'dropdown:select': function dropdownSelect(m, name) {

                switch (m.id) {

                    case 'clone':

                        var d = new dialog({
                            content: new cloneDialog({ model: this.model }),
                            title: Resources.cloneTo,
                            icon: 'clone',
                            footer: new Backbone.Collection([{ id: 'clone', title: Resources.save, className: 'blue right' }])
                        });

                        this.listenTo(d, 'footer:button:click', function (v) {

                            var did = d.model.get('content').getChildView('dd').current.id;

                            if (!did) {

                                var title = $.trim(d.model.get('content').ui.nd.val());
                                if (title) {

                                    this.model.collection.create({ title: title }, { wait: true });

                                    this.listenToOnce(this.model.collection, 'sync', function (m) {

                                        this._cloneWidgets(m.id, d);
                                        d.destroy();
                                    }.bind(this));
                                } else d.getChildView('notify').showNotify(Resources.newDBName + ' - ' + Resources.isEmpty.toLowerCase());
                            } else {
                                this._cloneWidgets(did, d);
                                d.destroy();
                            }
                        });

                        Backbone.Radio.channel('Notify').request('add:dialog', d);

                        break;

                    case 'clear':
                        this._clearWidgets();
                        break;
                }
            }
        },

        sideBarTrigger: function sideBarTrigger(m) {

            switch (m.id) {

                case 'decoration':

                    var one = this.collection.at(0);

                    var d = new dialog({
                        content: new decorationContent({ model: one }),
                        title: Resources.m3,
                        icon: 'appearance',
                        footer: new Backbone.Collection([{ id: 'decor', title: Resources.save, className: 'blue right' }])
                    });

                    this.listenTo(one, 'change', function () {
                        this.collection.each(function (m) {
                            m.set('Decoration', one.get('Decoration'));
                        });
                    });

                    this.listenTo(d, 'footer:button:click', function (v) {

                        this.collection.each(function (m) {
                            m.save();
                        });

                        d.getChildView('notify').showNotify(Resources.success);
                    });

                    Backbone.Radio.channel('Notify').request('add:dialog', d);

                    break;

                case 'clear':
                    this._clearWidgets();
                    break;
            }
        },

        _cloneWidgets: function _cloneWidgets(id, d) {

            var data = {
                widgets: this.collection.pluck('id'),
                vitrins: [id]
            };

            if (!data.widgets || !data.widgets.length) {
                this.collection.reset();
                return;
            }

            $.ajax({ url: '/api/wall/service/widgetclonning', data: data, type: "POST" }).done(function () {

                // обновить целевую витрину (если она загружена виджеты не появятся)
                var md = this.model.collection.get(data.vitrins[0]);
                this.triggerMethod('render:vitrin:after:clone:widget', md);

                // если клонирование производится в эту же витрину у виджетов пропадает выделение
                Backbone.Radio.channel('Mode').request('turn:switch', false);
                //d.getChildView('notify').showNotify(Resources.success);

                this.collection.reset();
            }.bind(this)).fail(function () {

                d.getChildView('notify').showNotify("Internal Error");
            });
        },

        _clearWidgets: function _clearWidgets() {

            Backbone.trigger("message:confirm", {

                title: Resources.askyousure, message: $.Format(Resources.deltext, Resources.widget, this.collection.pluck("title").join(', ')),

                fx: function fx() {

                    Array.from(this.collection.models).map(function (m) {

                        m.destroy();
                    });
                },

                ctx: this
            });
        }
    });

    return Mn.View.extend({

        className: 'Shna',

        template: '#top-buttons-template',
        templateContext: {
            Resources: Resources
        },

        triggers: {
            'click .show-add-widget-btn': 'show:left:panel'
            //'click .font-icon-repair': 'show:right:panel'
        },

        events: {

            "mouseenter .show-add-widget-btn": function mouseenterShowAddWidgetBtn(e) {
                $(e.target).closest("button").find(".anbr-tooltip").show();
            },

            "mouseleave .show-add-widget-btn": function mouseleaveShowAddWidgetBtn(e) {
                $(e.target).closest("button").find(".anbr-tooltip").fadeOut();
            }
        },

        regions: {
            position: { el: '#position-buttons', replaceElement: true }
        },

        onRender: function onRender() {

            this.showChildView('position', new positionView());
        },

        onShow: function onShow(v) {

            this.getChildView('position').currentDashboard = v;
            this.getChildView('position').model = v.model;

            this.$el.show();

            if (!v.collection.length) this.$(".show-add-widget-btn").find(".anbr-tooltip").show();
        },

        childViewTriggers: {
            'render:vitrin:after:clone:widget': 'render:vitrin:after:clone:widget'
        }

    });
});
'use strict';

define('requestView', ['bdid', 'i18n!nls/resources.min', 'services.library.libraryView', 'global.view.dialog', 'global.view.connect'], function (bdid, Resources, requestLibrary, dialogView, connectView) {

    var collectionRequests = Backbone.Collection.extend({
        model: Backbone.Model.extend({
            idAttribute: "rid",
            defaults: {
                rid: 0,
                domain: "",
                dbase: parseInt(bdid),
                requestid: null,
                param: [],
                page: 1,
                pagesize: 10
            }
        }),
        url: function url() {
            return '/api/interactive/getparamsforwall/';
        }
    });

    var requestView = Mn.View.extend({

        className: 'item',

        template: _.template('<input type="radio" id="<%- rid %>_<%- prefix %>" class="g-form--radio" name="radio_MasterCreate"><label for="<%- rid %>_<%- prefix %>"><%- title %></label><svg class="svg-icon icon-close"><use xlink:href="#icon-close" /></svg>'),

        triggers: {

            "click input": {
                event: 'click:item',
                stopPropagation: false,
                preventDefault: false
            },

            "click .icon-close": 'close'
        },

        onClose: function onClose() {

            Backbone.trigger("message:confirm", {
                title: Resources.askyousure, message: Resources.crn,
                fx: function fx() {
                    this.model.destroy({ wait: true });
                },
                ctx: this
            });
        }
    });

    var listRequests = Mn.CollectionView.extend({

        className: 'list-area',

        childView: requestView,

        emptyView: Mn.View.extend({ template: _.template('<div class="item">' + Resources.N + '</div>') }),

        onRenderChildren: function onRenderChildren() {

            if (this.requestAddedID) {

                var model = this.collection.findWhere({ requestid: parseInt(this.requestAddedID) });
                if (model) {
                    this.children.findByModel(model).$('input').prop('checked', true);
                    this.requestAddedID = null;
                }
            }

            if (this.model.get('requestParameters') && this.model.get('requestParameters').rid) {

                model = this.collection.get(this.model.get('requestParameters').rid);
                this.children.findByModel(model).$('input').prop('checked', true);
            }
        },

        childViewOptions: function childViewOptions(m) {
            m.set('prefix', this.model.get('widgetID'));
        },

        childViewTriggers: {
            'click:item': 'child:click:item'
        }
    });

    return Mn.View.extend({

        template: templates['requests-template'],
        templateContext: {
            Resources: Resources
        },

        ui: {
            description: '.description',
            t: '.title2'
        },

        regions: {
            list: { el: '.list-area', replaceElement: true }
        },

        events: {

            "click .refresh": function clickRefresh() {

                this.collection.fetch({ reset: true });
                this.model.set({ "requestParameters": {} });
            },

            "click .library": function clickLibrary(e) {

                var connect = new connectView();

                var d = new dialogView({
                    color: 'blue',
                    icon: 'gear',
                    modal: true,
                    size: 'full',
                    title: Resources.titleReqLib,
                    footer: new Backbone.Collection([{ id: 'cancel', title: Resources.cancel }, { id: 'connect', title: Resources.Connect, className: 'right blue disabled' }]),
                    content: connect
                });

                this.listenTo(d, 'footer:button:click', function (v) {

                    var dbase = '';

                    switch (v.model.id) {

                        case 'cancel':
                            d.close();break;

                        case 'connect':

                            dbase = connect.collection.at(0).id;

                            $.ajaxSettings.headers.key = $.mergeUrlParam($.ajaxSettings.url, { db: 'db' + dbase });

                            d.model.get('footer').set([{ id: 'cancel', title: Resources.cancel }, { id: 'add', title: Resources.add, className: 'right blue' }]);

                            d.model.set('content', new requestLibrary({ widgetType: this.model.get("typeName"), dbase: dbase }));

                            break;

                        case 'add':

                            var library = d.model.get('content');

                            if (!library.requestID) library.triggerMethod('show:message', Resources.noselect);else {

                                var data = library.getChildView('params').collection.toJSON(),
                                    requestParameters = {
                                    domain: window.location.host,
                                    dbase: dbase,
                                    requestid: library.requestID,
                                    parameters: data
                                };

                                $.ajax({ url: "/api/interactive/paramsforwall", data: $.param(requestParameters), type: "POST" }).done(function (m, n) {

                                    this.getChildView('list').requestAddedID = library.requestID;

                                    this.collection.fetch({
                                        reset: true,
                                        success: function (c) {

                                            var data = this.collection.findWhere({ requestid: parseInt(library.requestID) });

                                            if (data) {
                                                this.model.set({ "requestParameters": data.toJSON() });
                                                d.close();
                                            } else Backbone.trigger('message:warning', { message: Resources.error + ' ' + Resources.N });
                                        }.bind(this)
                                    });
                                }.bind(this));
                            }

                            break;
                    }
                });

                this.listenTo(connect, 'connect:made', function () {
                    d.getChildView('footer').children.findByIndex(1).$('button').removeClass('disabled');
                });

                Backbone.Radio.channel('Notify').request('add:dialog', d);
            }
        },

        initialize: function initialize() {

            this.collection = new collectionRequests();
        },

        onAttach: function onAttach() {

            if (["WidgetSource", "WidgetReporting", "WidgetHtml", "WidgetSemNet"].indexOf(this.model.get("typeName")) === -1) {

                this.showChildView('list', new listRequests({ collection: this.collection, model: this.model }));

                this.collection.url = '/api/interactive/getparamsforwall/' + this.model.get("typeName");

                this.collection.fetch({ reset: true });
            } else this.$el.hide();
        },

        collectionEvents: {

            request: function request() {

                Backbone.Radio.channel('loader').trigger('show', this.ui.t, { size: '', speed: 'fast' });
            },

            sync: function sync() {

                Backbone.Radio.channel('loader').trigger('hide');
            },

            update: function update(c, o) {

                if (o.changes.removed.length && this.model.get('requestParameters') && this.model.get('requestParameters').rid === o.changes.removed[0].id) this.model.set({ "requestParameters": {} });

                Backbone.Radio.channel('loader').trigger('hide');
            }

        },

        onChildviewChildClickItem: function onChildviewChildClickItem(v) {
            this.model.set({ "requestParameters": v.model.toJSON() });
        }

    });
});
'use strict';

define('settings.colorRow', ['i18n!nls/resources.min', 'RU'], function (Resources) {

    var listCollection = Mn.CollectionView.extend({

        childView: Mn.View.extend({

            template: _.template('<span style="cursor:pointer;line-height:28px;padding-left:6px;"><%- display_name %></span><span class="reload" style="float:right;display:block;margin-top:9px;" data-icon="icon-reload"></span><span class="picker" style="display:inline-block;width:40px;height:16px;margin-top:6px;float:right;cursor:pointer;background-color:<%- color %>;border:solid 1px gray;"></span>'),

            ui: {
                picker: '.picker'
            },

            triggers: {
                'click @ui.picker': 'click:item'
            },

            events: {

                'click .reload': function clickReload(e) {
                    e.stopPropagation();
                    this.model.set('color', 'none');
                }
            },

            modelEvents: {

                'change:color': function changeColor(m, c) {
                    this.ui.picker.css('background', c);
                }

            }

        }),

        childViewOptions: function childViewOptions(m) {
            if (!m.has('color')) m.set('color', 'none');
        },

        childViewTriggers: {
            'click:item': 'click:item'
        }

    });

    return Mn.View.extend({

        template: _.template('<div class="right" style="height:0px;overflow:hidden;"><input type="text" class="color-items-diagram" /></div><div class="list" style="clear:both;"></div>'),

        templateContext: {
            Resources: Resources
        },

        regions: {
            list: '.list'
        },

        onRender: function onRender() {

            this.$('.color-items-diagram').ejColorPicker({
                enableOpacity: false,
                locale: Resources.Lang
            });

            this._prepareCollection();
        },

        collectionEvents: {

            reset: function reset() {

                this._prepareCollection();
            }

        },

        _prepareCollection: function _prepareCollection() {

            var ms = this.collection,
                cc = new Backbone.Collection();

            var c = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: 'PaletteByChart' });

            var colorsValue = c ? c.WidgetParamValue : undefined;

            if (ms.length === 1) {
                // 

                var one = ms.at(0);

                one.set({ object_id: null, display_name: '' });

                one.get('points').map(function (m) {

                    var color = 'none';

                    if (colorsValue) {
                        var o = _.findWhere(colorsValue, { 'object_id': m.elId });
                        if (o) color = o.color;
                    }

                    cc.add(new Backbone.Model({
                        object_id: m.elId,
                        display_name: m.x,
                        color: color
                    }));
                });
            } else ms.map(function (m) {

                var n = new Backbone.Model({
                    object_id: m.get('elId'),
                    display_name: m.get('name') || _.pluck(m.get('points'), 'x').join(',')
                });

                if (colorsValue) {
                    var o = _.findWhere(colorsValue, { 'object_id': m.get('elId') });
                    if (o) n.set('color', o.color);
                }

                cc.add(n);
            });

            this.showChildView('list', new listCollection({ collection: cc }));
        },

        onChildviewClickItem: function onChildviewClickItem(v) {

            this.$('.color-items-diagram').ejColorPicker('hide');

            this.$('.color-items-diagram').ejColorPicker({

                open: function open(args) {
                    this.option('value', v.model.get('color'));
                },

                select: function select(args) {
                    v.model.set('color', args.value);
                }
            });

            this.$('.color-items-diagram').ejColorPicker('show');
        }
    });
});
'use strict';

define('settings.htmlEditor', ['requestView', 'g/ejRTEView'], function (requestsList, ejRTEView) {

        return Mn.View.extend({

                template: _.template('<div class="list" style="display:none;height:196px;margin-bottom:10px;"></div><div class="editor"></div>'),

                regions: {
                        reqArea: '.list',
                        editor: '.editor'
                },

                onAttach: function onAttach() {

                        if (!this.getRegion('editor').hasView()) this.showChildView('editor', new ejRTEView({ value: this.model.get('contentHtml') }));

                        this.getRegion('reqArea').show(new requestsList({ model: new Backbone.Model({ typeName: 'All', widgetID: this.model.id }) }));
                        this.getChildView('reqArea').ui.description.hide();

                        this.getChildView('reqArea').model.on('change:requestParameters', function (model) {

                                var data = model.get('requestParameters');

                                if (data.rid) {

                                        this.model.set({ "requestParameters": data });

                                        var text = this.getChildView('editor').ejRTE.getSelectedHtml();

                                        if (!$.trim(text)) text = '<svg style="fill:#666666; width:24px; height:24px;"><path d="M15,0.279C14.704,0.106,14.365,0,14,0h-1H4C2.9,0,2,0.9,2,2v10c-0.735,0-1.373,0.406-1.721,1C0.106,13.296,0,13.635,0,14s0.106,0.704,0.279,1C0.627,15.594,1.265,16,2,16h1h6h1h1c1.1,0,2-0.9,2-2v-1v-2V6V4h2h1V3V2 C16,1.265,15.594,0.627,15,0.279z M7.279,15H7H3H2c-0.552,0-1-0.449-1-1s0.448-1,1-1h1h4h0.279C7.106,13.296,7,13.635,7,14 S7.106,14.704,7.279,15z M12,6v5v2v1c0,0.551-0.449,1-1,1h-1H9c-0.552,0-1-0.449-1-1s0.448-1,1-1h1v-1H9H3V2c0-0.551,0.448-1,1-1 h8.279C12.106,1.296,12,1.635,12,2v1v1V6z M13,3V2c0-0.551,0.449-1,1-1s1,0.449,1,1v1H13z"></path></svg>';

                                        this.getChildView('editor').ejRTE.executeCommand("inserthtml", '<span data-oknd=\'4\' data-oid=\'' + data.rid + '\' title=\'' + data.title + '\'>' + text + '</span>');
                                } else this.model.set({ "requestParameters": {} });
                        }, this);
                },

                toolsButtonShowRequests: function toolsButtonShowRequests() {
                        //this.getRegion('reqArea').currentView.collection.fetch({ reset: true });
                        this.getRegion('reqArea').$el.toggle();
                },

                onSave: function onSave() {

                        if (this.model.get('requestParameters') && this.model.get('requestParameters').rid) $.ajaxSettings.headers.key = $.mergeUrlParam($.ajaxSettings.headers.key, { RID: this.model.get('requestParameters').rid });

                        this.model.save({ "contentHtml": this.getChildView('editor').ejRTE.getHtml() });
                },

                onReset: function onReset() {

                        if (this.getRegion('reqArea').collection) this.getRegion('reqArea').collection.fetch({ reset: true });

                        this.model.set({ "requestParameters": {} });
                }

        });
});
'use strict';

define('settings.reqparams', ['i18n!nls/resources.min', 'global.request.param'], function (Resources, ParamView) {

    var listView = Mn.CollectionView.extend({

        className: 'list',

        childView: ParamView,

        childViewOptions: function childViewOptions() {

            return {
                rid: this.options.rid,
                dbase: this.options.dbase
            };
        }
    });

    return Mn.View.extend({

        template: _.template('<span class="request-title"><%- Resources.settingsView_reqparams_requestTitle %></span><span class="request-data"><%- reqTitle %></span><br>\n            <span class="request-title"><%- Resources.settingsView_reqparams_dbTitle %></span><span class="request-data"><%- dbTitle %></span><br>\n            <span class="g-form--input">\n                <input class="g-form--checkbox" type="checkbox" name="useDefParams" id="<%- prefix %>_useDefParams" />\n                <label for="<%- prefix %>_useDefParams"><%- Resources.default %></label>\n            </span>\n            <div class="list"></div>'),

        id: "request-params-container",

        templateContext: function templateContext() {
            return {
                Resources: Resources,
                prefix: this.model.id,
                reqTitle: this.model.get('requestParameters').requestTitle,
                dbTitle: this.model.get('requestParameters').dbTitle
            };
        },

        regions: {
            area: { el: '.list', replaceElement: true }
        },

        ui: {
            use: 'input[name=useDefParams]'
        },

        events: {

            'change @ui.use': function changeUiUse(e) {
                if (this.ui.use.is(":checked")) this.getChildView('area').$el.hide();else this.getChildView('area').$el.show();
            }
        },

        onRender: function onRender() {

            this.showChildView('area', new listView({
                collection: new Backbone.Collection(this.model.get('requestParameters').parameters),
                rid: this.model.get('requestParameters').rid,
                dbase: this.model.get('requestParameters').dbase,
                use: this.model.get('requestParameters').useDefParams
            }));

            var useDefault = this.model.get('requestParameters').useDefParams;
            this.ui.use.prop('checked', useDefault);

            if (useDefault) {
                this.getChildView('area').$el.hide();
            }
        },

        onSave: function onSave() {

            var data = this.model.get('requestParameters');

            var result = [];
            this.getChildView('area').children.each(function (v) {

                result.push(v.model.toJSON());
            });

            var check = result.filter(function (a) {
                return !a.Value.length || !$.trim(a.Value[0]);
            });

            data.parameters = result;
            data.useDefParams = this.ui.use.is(":checked");

            this.model.set({ requestParameters: data });

            /*  *** проблема с сериализацией данных строка типа ISO трансформируется в дату в зависимости от локали клиента *** */

            $.ajax({ url: this.model.url(), method: 'PUT', data: JSON.stringify(this.model.toJSON()), contentType: 'application/json; charset=utf-8' }).always(function () {
                this.model.trigger('sync');
            }.bind(this));
        }

    });
});
'use strict';

define('settingsView', ['i18n!nls/resources.min', 'settings.legendMap', 'settings.reportingView', 'settings.baseOptions', 'settings.visualization.chart', 'settings.decorationWidget', 'settings.reqparams', 'settings.chain', 'settings.htmlEditor', 'settings.subscribe', 'settings.visualization.cloud', 'settings.visualization.table', 'settings.visualization.semnet', 'global.view.dialog'], function (Resources, legendView, reportingSettings, baseOptions, visualizationChart, decoration, reqparams, chain, htmlEditor, subscribe, cloudSettings, visualizationTable, semnetSettings, dialogView) {

    return Mn.View.extend({

        className: "settings",

        template: _.template('<div></div>'),

        events: {

            "mousedown": function mousedown(e) {
                e.stopPropagation();
            }

        },

        regions: {
            dialog: { el: 'div', replaceElement: true }
        },

        initialize: function initialize() {

            //var decoration = this.model.has("Decoration") ?
            //   this.model.get("Decoration") :
            //    {
            //        CaptionBackground: "rgba(200, 188, 162, 1)", CaptionForeground: "rgba(51, 51, 51, 1)",
            //        ContainerBackground: "rgba(255, 255, 255, 1)", ContainerForeground: "rgba(51, 51, 51, 1)",
            //        LinkBackground: "rgba(0, 0, 0, 0)", LinkForeground: "rgba(70, 127, 212, 1)",
            //        CaptionIsVisible: true, BorderIsVisible: true, ContainerIsTransparent: false
            //    };

            //if (!this.model.has("Decoration"))
            //    this.model.set("Decoration", decoration);

        },

        onRender: function onRender() {

            this.showChildView('dialog', new dialogView({
                autoOpen: false,
                header: { manage: [{ id: 'close' }] },
                footer: new Backbone.Collection([{ id: 'onSave', title: Resources.apply, className: 'blue right' }, { id: 'onReset', title: Resources.reset, className: 'right nest-left' }])
            }));
        },

        modelEvents: {

            invalid: function invalid(m, err) {

                this.getChildView('dialog').getChildView('notify').showNotify(Resources.error);

                _.each(err, function (o) {
                    this.currentView.$('[name=' + o.name + ']').addClass('error');
                }, this);

                setTimeout(function () {
                    this.currentView.$('.error').removeClass('error');
                }.bind(this), 3000);
            }

        },

        getMenu: function getMenu() {

            var typeName = this.model.get('typeName'),
                sm = [];

            var subscibeCollection = this.options.subscibeCollection;

            this.menu = {
                baseOptions: { id: "baseOptions", title: Resources.m1, icon: 'gear', content: baseOptions },
                visualizationTable: { id: 'visualizationTable', title: Resources.m2, icon: 'eye', content: visualizationTable },
                visualizationChart: { id: "visualizationChart", title: Resources.m2, icon: 'eye', content: visualizationChart },
                visualizationCloud: { id: 'visualizationCloud', title: Resources.m2, icon: 'eye', content: cloudSettings },
                visualizationLegendMap: { id: "visualizationLegendMap", title: Resources.m7, icon: 'legend', content: legendView },
                visualizationSemnet: { id: 'visualizationSemnet', title: Resources.m2, icon: 'eye', content: semnetSettings },
                requestParams: { id: 'requestParams', title: Resources.m12, icon: 'script-settings', content: reqparams },
                chainDependencies: { id: 'chainDependencies', title: Resources.m13, icon: 'anchor', content: chain },
                decoration: { id: "decoration", title: Resources.m3, icon: 'appearance', content: decoration },
                htmlEditor: { id: "htmlEditor", title: Resources.m6, icon: 'pen', content: htmlEditor, toolbar: [{ id: 'toolsButtonShowRequests', title: Resources.selectRequest, className: 'script-create' }] },
                subscribe: { id: "subscribe", title: Resources.m4, icon: 'new-mail', content: subscribe, args: { model: this.model, collection: subscibeCollection } },
                reportingSettings: { id: "reportingSettings", title: Resources.m10, icon: 'reports', content: reportingSettings, args: { wid: this.model.id, publishers: subscibeCollection } },
                clearWidget: { id: 'clearWidget', title: Resources.del, icon: 'trash' }
            };

            var menu = this.menu;

            switch (typeName) {

                case 'WidgetTable':
                    sm = [menu.baseOptions, menu.visualizationTable, menu.requestParams, menu.chainDependencies, menu.decoration, menu.clearWidget];
                    break;

                case 'WidgetRunning':
                    sm = [menu.baseOptions, menu.requestParams, menu.chainDependencies, menu.decoration, menu.clearWidget];
                    break;

                case 'WidgetGraph':
                    sm = [menu.baseOptions, menu.visualizationChart, menu.requestParams, menu.chainDependencies, menu.decoration, menu.clearWidget];
                    break;

                case 'WidgetCloud':
                    sm = [menu.baseOptions, menu.visualizationCloud, menu.requestParams, menu.chainDependencies, menu.decoration, menu.clearWidget];
                    break;

                case 'WidgetMap':
                    sm = [menu.baseOptions, menu.visualizationLegendMap, menu.requestParams, menu.chainDependencies, menu.decoration, menu.clearWidget];
                    break;

                case 'WidgetHtml':
                    sm = [menu.baseOptions, menu.htmlEditor, menu.requestParams, menu.chainDependencies, menu.decoration, menu.clearWidget];
                    break;

                case 'WidgetSource':
                    sm = [menu.baseOptions, menu.subscribe, menu.decoration, menu.clearWidget];
                    break;

                case 'WidgetReporting':
                    sm = [menu.baseOptions, menu.reportingSettings, menu.subscribe, menu.decoration, menu.clearWidget];
                    break;

                case 'WidgetSemNet':
                    sm = [menu.baseOptions, menu.visualizationSemnet, menu.subscribe, menu.decoration, menu.clearWidget];
                    break;

            }

            return sm;
        },

        hide: function hide(fx) {

            if (this.getRegion('dialog') && this.getRegion('dialog').hasView()) this.getChildView('dialog').close();

            //else if (fx)
            //    fx.call(this);
        },

        _setDialog: function _setDialog(id) {

            var dm = this.getChildView('dialog').model,
                s = this.menu[id],
                c = s.content;

            if (c) {

                if (s.toolbar) dm.get('toolbar').reset(s.toolbar);else dm.get('toolbar').reset();

                // TODO: привести все аргументы к одному виду убрать это...
                var args = { model: this.model, collection: this.collection };

                if (s.args) args = s.args;

                var view = new c(args);

                dm.set({
                    title: s.title,
                    icon: s.icon,
                    content: view
                });

                return view;
            }

            return null;
        },

        sideBarTrigger: function sideBarTrigger(m) {

            var actView = this._setDialog(m.id);

            if (actView) {

                if (actView.model.get('requestParameters') && actView.model.get('requestParameters').rid) $.ajaxSettings.headers.key = $.mergeUrlParam($.ajaxSettings.headers.key, { RID: actView.model.get('requestParameters').rid });

                if (actView.onBeforeShow) actView.onBeforeShow();

                var win = $('main'),
                    cv = this.getChildView('dialog').$el,
                    top = win.height() / 2 - cv.height() / 2;

                cv.css({
                    top: top < 90 ? 100 : top,
                    left: win.width() / 2 - cv.width() / 2
                });

                this.getChildView('dialog').$el.show(function () {

                    if (actView.onShow) actView.onShow();
                });
            } else this[m.id].call(this);
        },

        clearWidget: function clearWidget() {

            Backbone.trigger("message:confirm", {

                title: Resources.askyousure, message: $.Format(Resources.deltext, Resources.widget, this.model.get("title")),

                fx: function fx() {

                    this.model.destroy();
                },

                ctx: this
            });
        }
    });
});
'use strict';

define('@widget.WidgetCloud', ['i18n!nls/resources.min'], function (Resources) {

            return Mn.View.extend({

                        template: _.template('<div></div>'),
                        templateContext: { Resources: Resources },

                        regions: {
                                    graph: { el: 'div', replaceElement: true }
                        },

                        onAttach: function onAttach() {

                                    this.data = this.model.get('feed').variations[0].flow[0].points.map(function (a) {

                                                return {
                                                            text: a.text,
                                                            weight: parseInt(a.y),
                                                            html: { 'data-oid': this.model.id + '_' + a.elId },
                                                            handlers: {

                                                                        click: function () {

                                                                                    var m = new Backbone.Model({ object_id: a.elId });
                                                                                    m.set(a);

                                                                                    this.model.trigger('click:item', m);
                                                                        }.bind(this)
                                                            }
                                                };
                                    }, this);

                                    this.$el.height(this.$el.parent().height());

                                    this.$el.jQCloud(this.data);

                                    this._apply();
                        },

                        onChildviewClickItem: function onChildviewClickItem(v) {

                                    this.model.trigger('click:item', v.model);
                        },

                        modelEvents: {

                                    'change:width': function changeWidth() {
                                                this._fitSize();
                                    },

                                    'change:height': function changeHeight() {
                                                this._fitSize();
                                    }

                        },

                        _apply: function _apply() {

                                    var pallete = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: 'PaletteByChart' }),
                                        sset = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: 'WidgetCloud.SubSettings' });

                                    if (sset && sset.WidgetParamValue) {
                                                this.$el.css('font-size', sset.WidgetParamValue.minFontSizeCloud + 'px');
                                    }

                                    if (pallete) {
                                                var colors = pallete.WidgetParamValue;

                                                var pref = this.model.id + '_';

                                                setTimeout(function () {

                                                            _.each(colors, function (o) {

                                                                        if (o.color !== "none") this.$('[data-oid=' + pref + o.object_id + ']').css('color', o.color);
                                                            }, this);
                                                }.bind(this), 100);
                                    }
                        },

                        _fitSize: function _fitSize() {

                                    if (this.st) clearTimeout(this.st);

                                    this.st = setTimeout(function () {

                                                this.$el.css({ width: this.$el.parent().width(), height: this.$el.parent().height() });

                                                this.$el.empty().jQCloud(this.data);

                                                this._apply();
                                    }.bind(this), 500);
                        }

            });
});
'use strict';

define('@widget.WidgetGraph', ['i18n!nls/resources.min', 'ejChartView', 'd3:histogram', 'chartsRepository'], function (Resources, chartView, d3Histogram, repository) {

                return Mn.View.extend({

                                template: _.template('<div class="graph"></div>'),
                                templateContext: { Resources: Resources },

                                regions: {
                                                graph: { el: '.graph', replaceElement: true }
                                },

                                onAttach: function onAttach() {

                                                var visualization = this.model.get("Visualization") || "bar",
                                                    name = visualization.split('_');

                                                var p = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: "WidgetGraph.GhaphSubSettings" });

                                                if (p) p = p.WidgetParamValue;

                                                if (name.length && name[1] === 'd3') this.showChildView('graph', new d3Histogram({ items: this.model.get('feed'), model: this.model, chart: name[0] }));else if (name[0] !== 'tagCloud') {

                                                                var s = _.findWhere(repository, { type: visualization }) || { type: visualization },
                                                                    o = this.model.get('feed').variations[0],
                                                                    m = new Backbone.Model(_.extend(s, o));

                                                                m.set({
                                                                                height: this.$el.parent().height().toString(),
                                                                                width: this.$el.parent().width().toString()
                                                                });

                                                                this.showChildView('graph', new chartView({ model: m, subset: p, palette: _.findWhere(this.model.get('Characteristics'), { WidgetParamName: 'PaletteByChart' }) }));
                                                }
                                },

                                modelEvents: {

                                                'change:width': function changeWidth() {
                                                                this._fitSize();
                                                },

                                                'change:height': function changeHeight() {
                                                                this._fitSize();
                                                }

                                },

                                childViewEvents: {

                                                'chart:selected': function chartSelected(v) {}

                                },

                                _fitSize: function _fitSize() {

                                                var visualization = this.model.get("Visualization") || "bar",
                                                    name = visualization.split('_');

                                                if (name.length && name[1] === 'd3') {} else if (name[0] !== 'tagCloud') {

                                                                var m = this.getChildView('graph').model;

                                                                var p = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: "WidgetGraph.GhaphSubSettings" });

                                                                if (p) p = p.WidgetParamValue;

                                                                m.set({
                                                                                height: this.$el.parent().height().toString(),
                                                                                width: this.$el.parent().width().toString()
                                                                });

                                                                this.showChildView('graph', new chartView({ model: m, subset: p, palette: _.findWhere(this.model.get('Characteristics'), { WidgetParamName: 'PaletteByChart' }) }));
                                                }
                                }

                });
});
'use strict';

define('@widget.WidgetHtml', ['app'], function (App) {

            return Mn.View.extend({

                        template: _.template('<div dir="auto"><%= contentHtml %></div>'),

                        ui: {
                                    oid: 'span[data-oid]'
                        },

                        onRender: function onRender() {

                                    var output = '';

                                    if (this.collection.length === 1) {
                                                output = this.collection.at(0).get('display_name');
                                    } else {

                                                output = '<table>';

                                                this.collection.each(function (e) {

                                                            output += '<tr>';

                                                            _.each(e.attributes, function (a) {

                                                                        if (!_.isObject(a)) output += '<td>' + (a ? a : '') + '</a>';
                                                            }, this);

                                                            output += '</tr>';
                                                }, this);

                                                output += '</table>';
                                    }

                                    this.ui.oid.html(output);

                                    var Decoration = this.model.get('Decoration');
                                    this.$el.css({ color: Decoration.ContainerForeground });
                                    this.$el.find("a").css({ "background-color": Decoration.LinkBackground, "color": Decoration.LinkForeground });
                        }

            });
});
'use strict';

define('@widget.WidgetMap', ['global:maps:GeoMapGoogleView', 'widget:map:legendView'], function (GeoMap, legendView) {

    return Mn.View.extend({

        template: _.template('<div class="legend"></div><div class="map"></div>'),

        regions: {
            legend: { el: '.legend', replaceElement: true },
            map: { el: '.map', replaceElement: true }
        },

        onRender: function onRender() {

            this.showChildView('map', new GeoMap({
                model: this.model,
                collection: this.collection
            }));

            var data = this.model.get('Legend');
            if (data && data.LegendIsVisible) this.showChildView('legend', new legendView({ model: new Backbone.Model(data) }));
        }

    });
});
'use strict';

define('@widget.WidgetRunning', [], function () {

        return Mn.CollectionView.extend({

                className: 'RunningText',

                childView: Mn.View.extend({

                        tagName: 'span',

                        getTemplate: function getTemplate() {
                                return _.template(this.options.templ);
                        },

                        triggers: {
                                'click': 'table:row:handler'
                        }
                }),

                childViewOptions: function childViewOptions() {
                        return {
                                templ: this.templ
                        };
                },

                initialize: function initialize() {

                        this.templ = '';

                        var columns = this.model.get('ColumnCustomizations');
                        if (columns) _.chain(columns).filter(function (e) {
                                return e.ColumnIsVisible;
                        }).sortBy(function (e) {
                                return e.SerialNum;
                        }).map(function (e) {

                                this.templ += '&nbsp;<%= ' + e.ColumnSystemName.toLowerCase() + ' %>&nbsp;';
                        }, this);else _.chain(this.model.get('feed').head).filter(function (o) {
                                return o.isVisible;
                        }).map(function (e) {

                                this.templ += '&nbsp;<%= ' + e.systemName + ' %>&nbsp;';
                        }, this);

                        this.templ += '&nbsp;&nbsp;***&nbsp;&nbsp;';
                },

                onAttach: function onAttach() {

                        var p = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: "WidgetRunDirection" }),
                            direction = p ? p.WidgetParamValue.Right ? 'right' : 'left' : 'left';

                        this.$el.liMarquee({
                                direction: direction
                        });
                },

                childViewEvents: {

                        'table:row:handler': function tableRowHandler(v) {

                                this.model.trigger('click:item', v.model);
                        }
                }

        });
});
'use strict';

define('@widget.WidgetTable', ['i18n!nls/resources.min', 'widgetTableCard', 'widgetTableGrid'], function (Resources, cardView, gridView) {

        return Mn.View.extend({

                template: _.template('<div></div>'),

                regions: {
                        wrap: { el: 'div', replaceElement: true }
                },

                onRender: function onRender() {

                        var v = this.model.get('Visualization') || 'table';

                        switch (v) {

                                case 'table':
                                        this.showChildView('wrap', new gridView({
                                                model: this.model,
                                                collection: this.collection
                                        }));
                                        break;

                                case 'card':
                                case 'card2':
                                        this.showChildView('wrap', new cardView({
                                                model: this.model,
                                                collection: this.collection
                                        }));
                                        break;
                        }
                },

                modelEvents: {

                        'change:Visualization': function changeVisualization() {

                                this.render();
                        }

                },

                childViewTriggers: {
                        'table:add:rubrics:filter': 'table:add:rubrics:filter',
                        'scroll:grid': 'scroll:grid'
                }

        });
});
'use strict';

define('@widget.WidgetView', ['i18n!nls/resources.min', 'sendModel', 'settingsView', 'widget.reportView', 'widget.content.contentView', 'widget.semnet.semnetView'], function (Resources, sendModel, settingView, reportLoad, contentView, semnetView) {

                // settings.subscribe.subscribeList 
                var include = ["WidgetTable", "WidgetMap", "WidgetGraph", "WidgetRunning", "WidgetHtml", 'WidgetCloud'];

                var positionModel = Backbone.Model.extend({
                                idAttribute: 'WidgetUid',
                                defaults: {
                                                WidgetUid: null,
                                                PlacementWidth: 0,
                                                PlacementHeight: 0,
                                                PlacementTop: 0,
                                                PlacementLeft: 0,
                                                ZIndex: 0
                                },
                                url: function url() {
                                                return '/api/widget/' + this.id + '/position';
                                }
                });

                var subscibeObject = Mn.Object.extend({

                                initialize: function initialize() {

                                                this.collection = new Backbone.Collection();
                                                this.collection.url = '/api/widget/' + this.options.widgetID + '/subscribed';
                                }
                });

                return Mn.View.extend({

                                className: 'anbr-widget',

                                template: templates['widget-template'],

                                ui: {
                                                head: '.anbr_head',
                                                container: '.widget-container',
                                                title: '.widget-title',
                                                load: '.anbr_list',
                                                loader: '.anbr_head .Preloader',
                                                settings: '.settings',
                                                trash: '.icon-trash',
                                                filter: '.font-icon-filter'
                                },

                                regions: {
                                                load: '@ui.load', // { el: '@ui.load', replaceElement: true },
                                                settings: { el: '@ui.settings', replaceElement: true }
                                },

                                events: {

                                                "click .font-icon-filter": function clickFontIconFilter() {

                                                                this.getChildView('load').getChildView('wrap').getChildView('filter').$el.slideToggle();
                                                },

                                                'click .anbr_head @ui.trash': function clickAnbr_headUiTrash() {

                                                                Backbone.trigger('message:confirm', {
                                                                                title: Resources.sure,
                                                                                message: $.Format(Resources.deltext, Resources.widget, this.model.get('title')),
                                                                                fx: function fx() {
                                                                                                this.model.destroy();
                                                                                },
                                                                                ctx: this
                                                                });
                                                },

                                                "mousedown": function mousedown(e) {

                                                                if (this.Mode) {

                                                                                this._addSettings();

                                                                                Backbone.Radio.channel('sidebar').request('open', { nameView: this.model.get('title'), view: this.getChildView('settings'), title: Resources.wst }, this.getChildView('settings').getMenu());

                                                                                if (e.shiftKey || e.ctrlKey) this.triggerMethod('select:more', this.model);else this.triggerMethod('select:one', this.model);
                                                                }
                                                }
                                },

                                _addSettings: function _addSettings() {

                                                if (!this.getRegion('settings').hasView()) this.showChildView('settings', new settingView({
                                                                model: this.model,
                                                                collection: this.collection,
                                                                subscibeCollection: this.subscibeObject.collection
                                                }));
                                },

                                initialize: function initialize() {

                                                this.model.set('ReadOnly', true);

                                                this.collection = new Backbone.Collection([], { model: Backbone.Model.extend({ idAttribute: 'object_id' }) });

                                                this.subscibeObject = new subscibeObject({ widgetID: this.model.id });

                                                var pa = this.model.get('requestParameters');

                                                this.sendModel = new sendModel({
                                                                id: pa.rid,
                                                                pars: pa.parameters
                                                });

                                                this.sendModel.on('change:ts', function (m, ts) {
                                                                if (ts) this.model.set('timeStampForUpdate', ts);
                                                }, this);

                                                this.position = new positionModel({
                                                                WidgetUid: this.model.id,
                                                                PlacementTop: parseInt(this.model.get("top")) < 0 ? 5 : parseInt(this.model.get("top")),
                                                                PlacementLeft: parseInt(this.model.get("left")) < 0 ? 5 : parseInt(this.model.get("left")),
                                                                PlacementWidth: parseInt(this.model.get("width")),
                                                                PlacementHeight: parseInt(this.model.get("height")),
                                                                ZIndex: parseInt(this.model.get("zIndex"))
                                                });

                                                this.listenTo(this.position, 'request', this._sizeAndPosition.bind(this));

                                                //this.listenTo(this.model, "visual:update", this._successLoad);
                                },

                                onBeforeRender: function onBeforeRender() {

                                                if (this.model.get("Decoration") && !this.model.get("Decoration").BorderIsVisible) this.$el.addClass("noshadow");

                                                this._sizeAndPosition();
                                },

                                onRender: function onRender() {

                                                this._decoration();

                                                if (this.model.get("typeName") !== 'WidgetTable') this.ui.filter.hide();
                                },

                                onAttach: function onAttach() {

                                                var flag = this.model.get('Decoration').CaptionIsVisible;

                                                this.ui.container.css({
                                                                height: this.model.get("height") - (flag ? this.ui.head.outerHeight() : 0)
                                                });

                                                //this.ui.trash.css('fill', this.model.get('Decoration').CaptionForeground);

                                                this.ui.load.css("height", this.ui.container.height());

                                                this.triggerMethod('fix:size', this.model);
                                },

                                modelEvents: {

                                                sync: function sync() {

                                                                this.sendModel.set('ts', '');
                                                                this._decoration();
                                                                this.onLoad();
                                                },

                                                'click:item': function clickItem(itemModel) {

                                                                this.model.collection.each(function (m) {

                                                                                if (this.model.id !== m.id) {

                                                                                                m.trigger('check:subscribers', this.model.id, itemModel.get('requestID') || this.model.get('requestParameters').rid, itemModel.get('object_id'));

                                                                                                _.each(m.get('publishersSubscriberMap'), function (v, k) {

                                                                                                                if (k === this.model.id) {

                                                                                                                                _.each(v, function (p) {

                                                                                                                                                if (p.QueryID === this.model.get('requestParameters').rid) {

                                                                                                                                                                var par = _.findWhere(m.get('requestParameters').parameters, { id: p.QueryParamID });

                                                                                                                                                                _.each(itemModel.attributes, function (v, k) {

                                                                                                                                                                                if (k.toLowerCase() === p.ColumnSystemName.toLowerCase()) par.Value = [v];
                                                                                                                                                                });

                                                                                                                                                                m.trigger('load:chain');
                                                                                                                                                }
                                                                                                                                }, this);
                                                                                                                }
                                                                                                }, this);
                                                                                }
                                                                }, this);
                                                },

                                                'check:subscribers': function checkSubscribers(subscriberID, requestID, objectID) {

                                                                var c = this.subscibeObject.collection;

                                                                if (c.length) this._callSubscribers(subscriberID, objectID, requestID);else if (include.indexOf(this.model.get('typeName')) === -1 && !this.subscibeObject.isFetch) c.fetch({
                                                                                reset: true,
                                                                                success: function (coll) {
                                                                                                this.subscibeObject.isFetch = true;
                                                                                                this._callSubscribers(subscriberID, objectID, requestID);
                                                                                }.bind(this)
                                                                });
                                                },

                                                'load:chain': function loadChain() {

                                                                // цепочки не должны содержать метку времени для обновления
                                                                // значение должно бытьб в this.model.get('timeStampForUpdate')
                                                                this.sendModel.set('ts', '');

                                                                // не использовать параметры по умолчанию в данном случае - цепочка реакций
                                                                this.onLoad({ notUseDefParams: true });

                                                                // по идее это лишнее - send вернет новый ts и он сохранится в timeStampForUpdate
                                                                if (this.model.get('timeStampForUpdate')) this.sendModel.set('ts', this.model.get('timeStampForUpdate'));
                                                },

                                                //
                                                'visual:update': function visualUpdate(feed) {

                                                                this._successLoad(feed);
                                                },

                                                'change:ColumnCustomizations': function changeColumnCustomizations() {
                                                                this._successLoad();
                                                },

                                                'change:Decoration': function changeDecoration() {

                                                                this._decoration();

                                                                this.ui.container.css({
                                                                                height: this.model.get("height") - (this.model.get('Decoration').CaptionIsVisible ? this.ui.head.outerHeight() : 0)
                                                                });

                                                                this.ui.load.css("height", this.ui.container.height());
                                                },

                                                'change:title': function changeTitle(m, v) {
                                                                this.ui.title.text(v);
                                                },

                                                'change:left': function changeLeft(m, v) {
                                                                this.position.set('PlacementLeft', v);
                                                                this._sizeAndPosition();
                                                },

                                                'change:top': function changeTop(m, v) {
                                                                this.position.set('PlacementTop', v);
                                                                this._sizeAndPosition();
                                                },

                                                'change:width': function changeWidth(m, v) {
                                                                this.position.set('PlacementWidth', v);
                                                                this._sizeAndPosition();
                                                },

                                                'change:height': function changeHeight(m, v) {
                                                                this.ui.container.css({ height: v - this.ui.head.outerHeight() });
                                                                this.position.set('PlacementHeight', v);
                                                                this._sizeAndPosition();
                                                },

                                                'change:zIndex': function changeZIndex(m, v) {
                                                                this.position.set('ZIndex', v);
                                                                this._sizeAndPosition();
                                                }

                                },

                                onLoad: function onLoad(o) {

                                                this.loadOptions = o || {};

                                                var typeName = this.model.get("typeName");

                                                var pa = this.model.get('requestParameters');

                                                if (pa && pa.rid) {

                                                                if (!pa.useDefParams) this.loadOptions.notUseDefParams = true;

                                                                this.sendModel.set({
                                                                                widget: {
                                                                                                uid: this.model.id,
                                                                                                name: this.model.get('title'),
                                                                                                type: this.model.get('typeName'),
                                                                                                Visualization: this.model.get('Visualization')
                                                                                },
                                                                                id: pa.rid,
                                                                                pars: pa.parameters,
                                                                                useDefParams: !this.loadOptions.notUseDefParams
                                                                });

                                                                this.ui.loader.show();
                                                                this.sendModel.fetch({
                                                                                success: this._successLoad.bind(this),
                                                                                error: this._endload.bind(this)
                                                                });

                                                                if (this.model.get('update')) setInterval(function () {

                                                                                this.ui.loader.show();
                                                                                this.sendModel.fetch({
                                                                                                success: this._successLoad.bind(this),
                                                                                                error: this._endload.bind(this)
                                                                                });
                                                                }.bind(this), this.model.get('timeUpdate'));
                                                } else {
                                                                // виджеты не имеющие своих запросов

                                                                if (typeName === "WidgetHtml") this.ui.load.html(this.model.get("contentHtml"));

                                                                if (this.objectID && this.requestID) {

                                                                                switch (this.model.get("typeName")) {

                                                                                                case "WidgetSource":

                                                                                                                this.showChildView('load', new contentView({
                                                                                                                                model: this.model,
                                                                                                                                requestID: this.requestID,
                                                                                                                                objectID: this.objectID
                                                                                                                }));

                                                                                                                break;

                                                                                                case "WidgetSemNet":

                                                                                                                this.showChildView('load', new semnetView({
                                                                                                                                objectID: this.objectID,
                                                                                                                                RID: this.requestID,
                                                                                                                                container: this.ui.container,
                                                                                                                                widget: this.model
                                                                                                                }));

                                                                                                                break;

                                                                                                case "WidgetReporting":

                                                                                                                Backbone.Radio.channel('loader').trigger('show', this.ui.load, { speed: 'fast' });

                                                                                                                $.get('/api/widget/listen/' + this.requestID + '/reporting/' + this.model.id + '/' + this.objectID).done(function (url) {

                                                                                                                                this.showChildView('load', new reportLoad({ url: url, model: this.model }));
                                                                                                                }.bind(this)).always(function () {

                                                                                                                                Backbone.Radio.channel('loader').trigger('hide');
                                                                                                                                this.ui.loader.hide();
                                                                                                                                this.loadSourceProc = false;
                                                                                                                }.bind(this));

                                                                                                                break;

                                                                                                case "WidgetHtml":

                                                                                                                Backbone.Radio.channel('loader').trigger('show', this.ui.load, { speed: 'fast' });

                                                                                                                $.get('/api/widget/listen/' + this.requestID + '/uiwidget/' + this.model.id + '/' + this.objectID).done(function (source) {

                                                                                                                                if (source) {
                                                                                                                                                this.model.set('contentHtml', source);
                                                                                                                                                this.ui.load.html(this.model.get("contentHtml"));
                                                                                                                                }
                                                                                                                }.bind(this)).always(function () {

                                                                                                                                Backbone.Radio.channel('loader').trigger('hide');
                                                                                                                                this.ui.loader.hide();
                                                                                                                                this.loadSourceProc = false;
                                                                                                                }.bind(this));

                                                                                                                break;

                                                                                }
                                                                }

                                                                this._endload();
                                                }

                                                return this;
                                },

                                _callSubscribers: function _callSubscribers(subscriberID, objectID, requestID) {

                                                this.subscibeObject.collection.each(function (m) {

                                                                if (m.id === subscriberID) this._loadSource(objectID, requestID);
                                                }, this);
                                },

                                _loadSource: function _loadSource(oID, rID) {

                                                this.objectID = parseInt(oID);
                                                this.requestID = parseInt(rID);

                                                if (!this.loadSourceProc) {

                                                                this.ui.loader.show();
                                                                this.loadSourceProc = true;

                                                                this.onLoad();
                                                }
                                },

                                _successLoad: function _successLoad(feed) {

                                                if (this.sendModel.get('msg')) Backbone.trigger('message:warning', {
                                                                message: this.sendModel.get('msg')
                                                });

                                                this.model.set('feed', this.sendModel.get('feed') || this.sendModel.get('data'));

                                                var typeName = this.model.get("typeName");

                                                require(['@widget.' + typeName], function (typeWidget) {

                                                                this.showChildView('load', new typeWidget({
                                                                                model: this.model,
                                                                                collection: this.collection
                                                                }));

                                                                this._endload();
                                                }.bind(this));

                                                var items = this.model.get('feed') ? this.model.get('feed').items ? $.prepare(this.model.get('feed').items) : this.model.get('feed').variations[0].flow : // diagrams data
                                                [];

                                                if (this.loadOptions.add) this.collection.add(items);else this.collection.reset(items);
                                },

                                _endload: function _endload() {

                                                //this.getChildView( 'settings' ).loadProcess = false;

                                                this.ui.loader.hide();

                                                if (this.model.get('typeName') === 'WidgetTable') this.ui.filter.show();

                                                this.loadSourceProc = false;
                                                this.trigger('load:end');

                                                if (!this.model.has('feed')) this.model.set('feed', {});

                                                var Decoration = this.model.get('Decoration'),
                                                    flag = this.model.get('isMarkSelectedItem');

                                                this.$('table.widget-table td').css({
                                                                color: Decoration.ContainerForeground,
                                                                'background-color': Decoration.ContainerBackground
                                                });

                                                this.$('.rubrics').css('opacity', '0.5');

                                                this.$('table.widget-table tr').hover(function () {
                                                                $(this).find('td').css({
                                                                                color: Decoration.ContainerForegroundHover,
                                                                                'background-color': Decoration.ContainerBackgroundHover
                                                                });
                                                }, function () {

                                                                var isVisited = $(this).hasClass('viewed'),
                                                                    isActive = $(this).hasClass('current');

                                                                $(this).find('td').css({

                                                                                color: isActive ? Decoration.ContainerForegroundActive : flag && isVisited ? Decoration.ContainerForegroundVisited : Decoration.ContainerForeground,

                                                                                'background-color': isActive ? Decoration.ContainerBackgroundActive : flag && isVisited ? Decoration.ContainerBackgroundVisited : Decoration.ContainerBackground

                                                                });
                                                });

                                                this.$el.find("a").css({ "background-color": Decoration.LinkBackground, "color": Decoration.LinkForeground });
                                },

                                _sizeAndPosition: function _sizeAndPosition() {

                                                this.$el.css({
                                                                width: this.position.get("PlacementWidth"),
                                                                height: this.position.get("PlacementHeight"),
                                                                top: this.position.get("PlacementTop"),
                                                                left: this.position.get("PlacementLeft"),
                                                                "z-index": this.position.get("ZIndex")
                                                });
                                },

                                _decoration: function _decoration() {

                                                var Decoration = this.model.get('Decoration'),
                                                    defaultBg = "",
                                                    tcss = "padding:10px 10px 0;font-size: 18px;",
                                                    mtcss = "font-size:1em;cursor:default;text-decoration:none;",
                                                    lcss = 'font-size:13px;overflow:auto;clear:both;' + (this.model.get('typeName') !== "WidgetTable" ? "padding:20px;" : "");

                                                if (Decoration) {

                                                                if (Decoration.CaptionIsVisible) {

                                                                                if (Decoration.CaptionBackground) tcss += "background:" + Decoration.CaptionBackground + ";";

                                                                                if (Decoration.BorderIsVisible) tcss += 'border:solid 1px ' + Decoration.CaptionBackground + ';border-bottom:0;';

                                                                                if (Decoration.CaptionForeground) mtcss += 'color:' + Decoration.CaptionForeground + ';';
                                                                } else tcss += "display:none;";

                                                                if (Decoration.ContainerIsTransparent) {

                                                                                //defaultBg = "background:transparent;";

                                                                                this.$el.addClass('transparent');
                                                                } else if (Decoration.ContainerBackground) {

                                                                                this.$el.removeClass('transparent');

                                                                                defaultBg = 'background:' + Decoration.ContainerBackground + ';';
                                                                }

                                                                if (Decoration.ContainerForeground) lcss += 'color:' + Decoration.ContainerForeground + ';';

                                                                if (Decoration.BorderIsVisible) lcss += 'border:solid 10px ' + Decoration.CaptionBackground + ';';else tcss += "padding-bottom:10px;";
                                                }

                                                this.ui.head.attr("style", tcss);

                                                this.ui.container.attr("style", lcss + defaultBg);

                                                this.ui.title.attr("style", mtcss);

                                                this.ui.trash.css('fill', this.model.get('Decoration').CaptionForeground);
                                                this.ui.filter.css('color', this.model.get('Decoration').CaptionForeground);
                                },

                                switchMode: function switchMode(flag) {

                                                if (flag) {

                                                                this.ui.head.css({ cursor: "move" });

                                                                this.$el.draggable({
                                                                                //helper: "original",
                                                                                handle: this.ui.head,
                                                                                cancel: this.ui.settings,

                                                                                drag: function (el, ui) {

                                                                                                this.triggerMethod('widget:drag', this.model, ui.position.left - this.$el.position().left, ui.position.top - this.$el.position().top);
                                                                                }.bind(this),

                                                                                stop: function (el, ui) {

                                                                                                var top = parseInt(ui.position.top),
                                                                                                    left = parseInt(ui.position.left);

                                                                                                if (top < 0) top = 3;
                                                                                                if (left < 0) left = 3;

                                                                                                this.model.set({ top: top, left: left });

                                                                                                this.position.save();

                                                                                                this.triggerMethod('widget:drag', this.model, left - this.$el.position().left, top - this.$el.position().top, true);
                                                                                }.bind(this)
                                                                });

                                                                this.$el.resizable({

                                                                                resize: function (e, ui) {

                                                                                                this.ui.container.css({
                                                                                                                height: ui.size.height - this.ui.head.outerHeight()
                                                                                                });
                                                                                }.bind(this),

                                                                                stop: function (e, ui) {

                                                                                                this.ui.load.css("height", this.ui.container.height());

                                                                                                this.model.set({
                                                                                                                width: parseInt(ui.size.width),
                                                                                                                height: parseInt(ui.size.height)
                                                                                                });

                                                                                                this.position.save();

                                                                                                this.triggerMethod('select:one', this.model);
                                                                                }.bind(this)
                                                                });
                                                } else {

                                                                this.ui.head.css({ cursor: 'default' });

                                                                this.$el.draggable().draggable("destroy").resizable().resizable("destroy").removeClass("widget-editing");
                                                }

                                                this.Mode = flag;

                                                this.model.set('ReadOnly', !flag);

                                                return this;
                                },

                                childViewEvents: {

                                                'content:loaded': function contentLoaded() {
                                                                this._endload();
                                                },

                                                'subscribers:reflect': function subscribersReflect(m) {

                                                                this.model.trigger('click:item', m);
                                                },

                                                'scroll:grid': function scrollGrid() {

                                                                var saveTop = 0;

                                                                var pon = this.sendModel.get('feed').pagination;

                                                                if (pon.totalItems > pon.pageSize * pon.currentPage - pon.pageSize) {

                                                                                var top = this.ui.container.scrollTop(),
                                                                                    height = this.ui.container.find('.anbr_list>div').height(),
                                                                                    scr = height - this.ui.container.height(),
                                                                                    flag = false;

                                                                                flag = saveTop < top;
                                                                                saveTop = top;

                                                                                console.warn('scroll not relised');

                                                                                if (flag && scr - top <= 80) {

                                                                                                this.sendModel.set({
                                                                                                                ts: this.model.get('timeStampForUpdate'),
                                                                                                                page: pon.currentPage++
                                                                                                });

                                                                                                this.onLoad({ add: true });

                                                                                                console.log('scroll');
                                                                                }
                                                                }
                                                }

                                },

                                childViewTriggers: {

                                                'table:row:handler': 'table:row:handler'
                                }

                });
});
'use strict';

define('settings.baseOptions', ['i18n!nls/resources.min', 'global.request.param'], function (Resources, paramView) {

            return Mn.CollectionView.extend({

                        childView: Mn.View.extend({

                                    template: '#base-setting-template',

                                    regions: {
                                                params: { el: '#params', replaceElement: true }
                                    },

                                    onBeforeRender: function onBeforeRender() {

                                                if (!this.model.has('type')) this.model.set('type', '');
                                    },

                                    onRender: function onRender() {

                                                //if (this.model.get('name') === 'MainEntity')
                                                //    this.showChildView('params', new paramView({
                                                //        attributes: {
                                                //            ParametrType: 'Object',
                                                //            Name: 'MainEntity',
                                                //            DisplayValue: this.model.get('value').DisplayValue,
                                                //            Value: this.model.get('value').Value,
                                                //            Caption: this.model.get('displayName')
                                                //        }}));

                                    }

                        }),

                        initialize: function initialize() {

                                    this.collection = new Backbone.Collection([{ displayName: Resources.title, name: 'title', value: this.model.get('title'), type: 'text' }, { displayName: Resources.updatingContent, name: 'update', value: this.model.get('update'), type: 'checkbox' }, { displayName: Resources.timeoutUpdate, name: 'timeUpdate', value: this.model.get('timeUpdate'), type: 'text' }]);

                                    if (this.model.get('typeName') === 'WidgetSource') {

                                                var o = Backbone.Radio.channel('chW').request('get:param:model', this.model.get('Characteristics'), "WidgetSource.Options");

                                                if (!o.has('WidgetParamValue')) o.set('WidgetParamValue', { hideRubrics: false });

                                                this.collection.add([{ displayName: Resources.hideRubrics, name: 'hideRubrics', value: !!o.get('WidgetParamValue').hideRubrics, type: 'checkbox' }, { displayName: Resources['contain-html'], name: 'isHtmlContent', value: !!this.model.get('isHtmlContent'), type: 'checkbox' }, { displayName: Resources.highlightMentionObj, name: 'highlightMentionObj', value: !!this.model.get('highlightMentionObj'), type: 'checkbox' }, {
                                                            displayName: Resources.contentProp, type: 'select', name: 'contentProp', value: [{ value: '', title: '...' }, { value: 'TextSource', title: 'TextSource', checked: this.model.get('contentProp') === 'TextSource' }, { value: 'WebFile', title: 'WebFile', checked: this.model.get('contentProp') === 'WebFile' }]
                                                }, { displayName: Resources.emc, name: 'extractOnlyMedia', value: !!this.model.get('extractOnlyMedia'), type: 'checkbox' }]);
                                    }

                                    if (this.model.get('typeName') === 'WidgetTable') {

                                                this.collection.add([{ displayName: Resources.markAfSel, name: 'isMarkSelectedItem', value: !!this.model.get('isMarkSelectedItem'), type: 'checkbox' }]);
                                    }

                                    if (this.model.get('typeName') === 'WidgetRunning') {

                                                var _o = Backbone.Radio.channel('chW').request('get:param:model', this.model.get('Characteristics'), "WidgetRunDirection");

                                                if (!_o.has('WidgetParamValue')) _o.set('WidgetParamValue', { Right: false });

                                                this.collection.add([{
                                                            displayName: Resources.dire + ' ( ' + Resources.toright + ' )',
                                                            name: 'WidgetRunDirection',
                                                            value: !!_o.get('WidgetParamValue').Right,
                                                            type: 'checkbox'
                                                }]);
                                    }

                                    if (this.model.get('typeName') === 'WidgetSemNet') {

                                                var value = Backbone.Radio.channel('chW').request('get:param:model', this.model.get('Characteristics'), "WidgetSource.Options").WidgetParamValue || { DisplayValue: '', Value: [] };

                                                this.collection.add([{ displayName: Resources.bsno, name: 'MainEntity', value: value }]);
                                    }
                        },

                        childViewOptions: function childViewOptions(m) {
                                    m.set('prefix', this.model.id);
                        },

                        onSave: function onSave() {

                                    var data = $.GetData(this.$el);

                                    var o = Backbone.Radio.channel('chW').request('get:param:model', this.model.get('Characteristics'), "WidgetSource.Options");
                                    o.set('WidgetParamValue', { hideRubrics: data.hideRubrics });

                                    var a = Backbone.Radio.channel('chW').request('get:param:model', this.model.get('Characteristics'), "WidgetRunDirection");
                                    a.set('WidgetParamValue', { Right: data.WidgetRunDirection });

                                    var saveCollection = Backbone.Radio.channel('chW').request('get:params:collection', this.model.id);
                                    saveCollection.add([o, a]);

                                    saveCollection.fetch({
                                                success: function (res) {

                                                            data.Characteristics = res.toJSON();
                                                            this.model.save(data);
                                                }.bind(this)

                                    });
                        }
            });
});
'use strict';

define('settings.chain', ['i18n!nls/resources.min'], function (Resources) {

    var collectionParams = Backbone.Collection.extend({
        model: Backbone.Model.extend({
            idAttribute: 'QueryParamsMapID',
            defaults: {
                QueryParamsMapID: null,
                QueryParamID: 0,
                QueryID: 0,
                ColumnSystemName: ''
            }
        })
    });

    var listView = Mn.CollectionView.extend({

        tagName: 'ul',

        childView: Mn.View.extend({

            tagName: 'li',

            template: _.template('<input type="radio" id="id<%- id %>" class="g-form--radio" name="widgets" value="<%- id %>"><label for="id<%- id %>"><%- title %></label>'),

            triggers: {

                'click input': {
                    event: 'widget:select',
                    stopPropagation: false,
                    preventDefault: false
                }
            }
        }),

        childViewTriggers: {
            'widget:select': 'widget:select'
        }
    });

    var selectView = Mn.CollectionView.extend({

        tagName: 'select',

        childView: Mn.View.extend({

            tagName: 'option',

            getTemplate: function getTemplate() {

                if (this.model.has('displayName')) return _.template('<%- displayName %> (<%- systemName %>)');else return _.template('<%- Caption %> (<%- Name %>)');
            },

            onRender: function onRender() {

                if (this.model.has('systemName')) this.$el.attr('value', this.model.get('systemName'));else this.$el.attr('value', this.model.id);
            }
        })
    });

    var resultView = Mn.CollectionView.extend({

        tagName: 'ul',
        className: 'list-area',

        childView: Mn.View.extend({

            tagName: 'li',
            className: 'item',

            template: _.template('<%- Title %>&nbsp;<span data-icon="icon-trash"></span>'),

            triggers: {
                'click span[data-icon="icon-trash"]': 'rel:remove'
            }
        }),

        childViewTriggers: {
            'rel:remove': 'rel:remove'
        }
    });

    return Mn.View.extend({

        template: '#relations-settings-template',
        templateContext: {
            Resources: Resources
        },

        events: {

            'click span[data-icon="icon-anchor"]': function clickSpanDataIconIconAnchor() {

                var titleWidget = this.selectWidget.get('title'),
                    paramsThisWidget = this.getChildView('params'),
                    columnsSelectWidget = this.getChildView('select');

                var m = new this.collection.model({
                    Title: titleWidget + " : " + columnsSelectWidget.$(':checked').text() + " - " + paramsThisWidget.$(':checked').text(),
                    wID: this.selectWidget.id,
                    QueryParamID: paramsThisWidget.$(':checked').val(),
                    QueryID: this.selectWidget.get('requestParameters').rid,
                    ColumnSystemName: columnsSelectWidget.$(':checked').val()
                });

                m.collection = this.collection;
                m.save({}, {

                    success: function (model) {

                        this.collection.add(model);

                        var s = this.model.get('publishersSubscriberMap') || {};

                        if (!s[model.get('wID')]) s[model.get('wID')] = [];

                        s[model.get('wID')].push(model.toJSON());

                        this.model.set('publishersSubscriberMap', s);
                    }.bind(this),

                    error: function () {
                        this.triggerMethod('show:message', Resources.error);
                    }.bind(this)

                });
            }
        },

        regions: {
            list: { el: '#widgets', replaceElement: true },
            params: { el: '#params', replaceElement: true },
            select: { el: '#select-param', replaceElement: true },
            result: { el: '#result', replaceElement: true }
        },

        initialize: function initialize() {

            this.collection = new collectionParams();
        },

        onRender: function onRender() {

            this.showChildView('list', new listView({ collection: new Backbone.Collection() }));
            this.showChildView('select', new selectView({ collection: new Backbone.Collection() }));
            this.showChildView('result', new resultView({ collection: this.collection }));

            this.showChildView('params', new selectView({
                collection: this.model.get('requestParameters') && this.model.get('requestParameters').parameters ? new Backbone.Collection(this.model.get('requestParameters').parameters) : new Backbone.Collection()
            }));
        },

        onBeforeShow: function onBeforeShow() {

            if (this.model.get('requestParameters') && this.model.get('requestParameters').rid) {

                if (this.hasRegion('notify')) {

                    var rs = this.getRegions();

                    _.each(rs, function (v, k) {
                        v.$el.show();
                    });

                    this.$('table').show();
                    this.removeRegion('notify');
                }

                if (!this.getChildView('params').collection.length) this.getChildView('params').collection.reset(this.model.get('requestParameters').parameters);

                var mid = this.model.id,
                    models = this.model.collection ? this.model.collection.filter(function (a) {
                    if (a.get('feed') && mid !== a.id) return a;
                }) : [];

                this.getChildView('list').collection.reset(models);

                var pm = this.model.get('publishersSubscriberMap'),
                    listWidgets = this.getChildView('list').collection,
                    paramsThisWidget = this.getChildView('params').collection,
                    columnsSelectWidget = this.getChildView('select').collection;

                _.each(pm, function (v, k) {

                    var w = this.model.collection.get(k);

                    if (!w) return;

                    var titleWidget = w.get('title'),
                        columnsWidget = w.has('feed') ? w.get('feed').head ? w.get('feed').head : [{ systemName: 'argId', displayName: 'argId' }, { systemName: 'fnId', displayName: 'fnId' }] : [];

                    _.each(v, function (o) {

                        var parModel = paramsThisWidget.get(o.QueryParamID),
                            column = _.findWhere(columnsWidget, { systemName: o.ColumnSystemName }),
                            titleParam = parModel.get('Caption') + ' ( ' + parModel.get('Name') + ' )',
                            titleColumn = column ? column.displayName + ' ( ' + column.systemName + ' )' : '';

                        o.Title = titleWidget + " : " + titleColumn + " - " + titleParam;
                        o.wID = k;

                        var model = new this.collection.model(o);
                        model.url = '/api/widget/' + this.model.id + '/qparammaps/' + k + '/' + o.QueryParamsMapID;

                        this.collection.add(model);
                    }, this);
                }, this);
            } else {

                rs = this.getRegions();

                _.each(rs, function (v, k) {
                    v.$el.hide();
                });

                this.$('table').hide();

                this.addRegion('notify', '.notify');

                var notify = Mn.View.extend({
                    template: _.template(Resources.rsw3)
                });

                this.showChildView('notify', new notify());
            }
        },

        collectionEvents: {

            update: function update(c, o) {

                if (o.changes.removed.length) {

                    var d = o.changes.removed[0];

                    var data = this.model.get('publishersSubscriberMap');

                    var p = data[d.get('wID')].filter(function (a) {
                        return a.QueryParamsMapID !== d.get('QueryParamsMapID');
                    });

                    data[d.get('wID')] = p;

                    this.model.set('publishersSubscriberMap', data);
                }
            },

            request: function request() {},

            reset: function reset() {

                this.getChildView('result').collection.reset(this.collection.models);
            }
        },

        childViewEvents: {

            'rel:remove': function relRemove(v) {

                this.triggerMethod('show:message:confirm', {
                    text: Resources.sure,
                    fx: function fx() {
                        v.model.destroy();
                    }
                });
            },

            'widget:select': function widgetSelect(v) {

                this.selectWidget = v.model;

                var o = this.selectWidget.get('feed').head || [{ systemName: 'argId', displayName: 'argId' }, { systemName: 'fnId', displayName: 'fnId' }];

                if (o) {

                    this.getChildView('select').collection.reset(o);

                    this.collection.url = '/api/widget/' + this.model.id + '/qparammaps/' + this.selectWidget.id;
                    //this.collection.fetch({ reset: true });
                } else this.getChildView('select').collection.reset();
            }
        }
    });
});
'use strict';

define('settings.decorationWidget', ['i18n!nls/resources.min'], function (Resources) {

        function rgb2hex(rgb) {

                if (rgb) rgb = rgb.replace('rgba(', '').replace(')', '').split(',');

                return rgb && rgb.length === 4 ? {
                        hex: "#" + ("0" + parseInt(rgb[0], 10).toString(16)).slice(-2) + ("0" + parseInt(rgb[1], 10).toString(16)).slice(-2) + ("0" + parseInt(rgb[2], 10).toString(16)).slice(-2),
                        a: parseFloat(rgb[3]).toFixed(2) * 100
                } : { hex: '#ffffff', a: 100 };
        }

        var maketView = Mn.View.extend({

                className: 'pattern',
                template: '#maket-template',

                onRender: function onRender() {

                        if (this.model.get('BorderIsVisible')) this.$el.css('background-color', this.model.get('CaptionBackground'));else this.$el.css('background-color', 'transparent');

                        if (this.model.get('ContainerIsTransparent')) this.$el.css('background-color', 'transparent');
                }

        });

        var patView = Mn.View.extend({

                className: 'decoration',
                template: '#decoration-settings-template',
                templateContext: {
                        Resources: Resources
                },

                regions: {
                        maket: { el: '#maket', replaceElement: true }
                },

                events: {

                        'click input[type="checkbox"]': function clickInputTypeCheckbox(e) {

                                var $e = $(e.target);
                                this.model.set($e.attr('name'), $e.prop('checked'));
                        }

                },

                onRender: function onRender() {

                        this.showChildView('maket', new maketView({ model: this.model }));
                },

                onAttach: function onAttach() {

                        this.$('input.Decoration').each(function (i, e) {

                                var v = rgb2hex(this.model.get(e.getAttribute('name')));

                                $(e).ejColorPicker({

                                        locale: Resources.Lang,
                                        modelType: "palette",
                                        presetType: "webcolors",

                                        htmlAttributes: { style: "display:inline-block;" },

                                        value: v.hex,
                                        opacityValue: v.a,

                                        close: function (args) {

                                                var rgb = $(e).data('ejColorPicker').rgb;

                                                this.model.set($(e).attr('name'), 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + rgb.a + ')');
                                        }.bind(this)

                                });
                        }.bind(this));
                },

                modelEvents: {

                        change: function change(m) {

                                this.getChildView('maket').render();
                        }

                }

        });

        return Mn.View.extend({

                template: _.template('<div></div>'),

                regions: {
                        c: { el: 'div', replaceElement: true }
                },

                onRender: function onRender() {

                        var o = this.model.get('Decoration');

                        o.prefix = this.model.id || new Date().valueOf();

                        var m = new Backbone.Model(o);

                        this.showChildView('c', new patView({ model: m }));

                        this.listenTo(m, 'change', function () {
                                this.model.set('Decoration', m.toJSON());
                        });
                },

                onSave: function onSave() {

                        this.model.save();
                }

        });
});
'use strict';

define('settings.legendMap', ['i18n!nls/resources.min', 'global.behaviors.input'], function (Resources, inputBehavior) {

    var legendItem = Backbone.Model.extend({
        idAttribute: "LegendItemUID",
        defaults: {
            LegendItemUID: null,
            MarkerColor: "",
            MarkerDescription: "",
            MarkerUrl: ""
        }
    });

    var legendModel = Backbone.Model.extend({
        defaults: {
            id: null,
            Title: '',
            LegendIsVisible: false,
            LegendPosition: '',
            WidgetsLegendItems: []
        }
    });

    var listView = Mn.CollectionView.extend({

        tagName: 'table',
        className: 'items-legend-settings',

        childView: Mn.View.extend({

            tagName: 'tr',
            template: '#legend-item-template',
            templateContext: { Resources: Resources },

            ui: {
                name: 'input[name=MarkerDescription]'
            },

            events: {

                'blur @ui.name': function blurUiName() {

                    if ($.trim(this.ui.name.val())) this.model.set('MarkerDescription', this.ui.name.val());
                },

                'click button[data-icon="icon-trash"]': function clickButtonDataIconIconTrash() {

                    Backbone.trigger('message:confirm', {
                        title: Resources.askyousure,
                        fx: function fx() {
                            this.model.destroy();
                        },
                        ctx: this
                    });
                }
            }
        }),

        collectionEvents: {

            update: function update(c, o) {
                if (o.changes.removed.length) this.triggerMethod('reset:default', o.changes.removed[0]);
            }
        }
    });

    var mainView = Mn.View.extend({

        behaviors: {
            input: inputBehavior
        },

        template: '#legend-settings-template',
        templateContext: {
            Resources: Resources
        },

        ui: {
            title: 'input[name=Title]',
            position: '.RbtnSet input',
            show: 'input[name=LegendIsVisible]'
        },

        events: {

            'blur @ui.title': function blurUiTitle() {
                this.model.set('Title', this.ui.title.val());
            },

            'click @ui.position': function clickUiPosition() {
                this.model.set('LegendPosition', this.ui.position.filter(':checked').val());
            },

            'click @ui.show': function clickUiShow() {
                this.model.set('LegendIsVisible', this.ui.show.prop('checked'));
            }

        },

        modelEvents: {

            invalid: function invalid() {
                this.ui.title.addClass("Alarm");
            }
        },

        onRender: function onRender() {

            this.ui.position.filter('[value="' + this.model.get('LegendPosition') + '"]').prop('checked', true);
        }
    });

    return Mn.View.extend({

        template: _.template('<div id="main"></div><div id="list"></div>'),

        regions: {
            main: { el: '#main', replaceElement: true },
            list: { el: '#list', replaceElement: true }
        },

        onRender: function onRender() {

            var mainModel = new legendModel(this.model.get('Legend'));
            mainModel.set('id', this.model.id);
            mainModel.url = "/api/widget/" + this.model.id + "/legend";

            this.showChildView('main', new mainView({ model: mainModel }));

            var legendItemsCollection = new Backbone.Collection(this.model.get('WidgetsLegendItems'), { model: legendItem });
            legendItemsCollection.url = '/api/widget/' + this.model.id + '/legenditem';

            this.showChildView('list', new listView({ collection: legendItemsCollection }));
        },

        collectionEvents: {

            reset: function reset() {

                if (!this.model.get('Legend') || !this.model.get('Legend').WidgetsLegendItems.length) this.setDefaultList();else this.getChildView('list').collection.reset(this.model.get('Legend').WidgetsLegendItems);
            }

        },

        onChildviewResetDefault: function onChildviewResetDefault(m) {

            this.getChildView('list').collection.add(new legendItem({ MarkerUrl: m.get('MarkerUrl') }));
        },

        onSave: function onSave() {

            $.ajax({
                method: "POST",
                contentType: 'application/json; charset=utf-8',
                url: "/api/widget/" + this.model.id + "/legenditems",
                data: JSON.stringify(this.getChildView('list').collection.toJSON())
            }).done(function (c) {

                this.getChildView('main').model.save({ WidgetsLegendItems: this.getChildView('list').collection.toJSON() });

                this.model.save({ 'Legend': this.getChildView('main').model.toJSON() });
            }.bind(this));
        },

        onReset: function onReset() {

            this.getChildView('list').collection.reset();
            this.setDefaultList();
        },

        setDefaultList: function setDefaultList() {

            var group = this.collection.groupBy('markerurl');

            _.each(group, function (o, k) {

                if (k !== 'undefined') this.getChildView('list').collection.add(new legendItem({ MarkerUrl: k }));
            }, this);
        }

    });
});
'use strict';

define('settings.reportingView', ['i18n!nls/resources.min', 'g/tree'], function (Resources, treeView) {

    var modelReport = Backbone.Model.extend({
        idAttribute: "UID",
        defaults: {
            UID: null,
            ReportSysName: "",
            TypeSysName: ""
        }
    });

    var listReports = Mn.CollectionView.extend({
        className: 'list-report',
        tagName: 'section',

        childView: Mn.View.extend({

            className: 'item',
            template: '#item-report-template',

            templateContext: {
                Resources: Resources
            },

            triggers: {
                "click .font-icon-delete": 'report:clear'
            }
        }),

        childViewTriggers: {
            'report:clear': 'report:clear'
        }

    });

    var optionView = Mn.View.extend({

        tagName: 'option',
        template: _.template('<%- title %>'),

        onRender: function onRender() {
            this.$el.attr('value', this.model.id);
        }

    });

    var selectView = Mn.CollectionView.extend({

        tagName: 'select',

        childView: optionView,

        onRender: function onRender() {

            this.addChildView(new optionView({ model: new Backbone.Model({ id: '0', title: '...' }) }), 0);
            this.$el.val('0');
        },

        triggers: {
            'change': 'change:publish'
        }
    });

    return Mn.View.extend({

        className: 'type-reporting anbr-tabs',
        template: '#type-reporting-settings',
        templateContext: {
            Resources: Resources
        },

        events: {
            "click nav>span": function clickNavSpan(e) {
                this.activeTab($(e.target).closest("span[data-name]").attr("data-name"));
            }
        },

        onChildviewChangePublish: function onChildviewChangePublish(v) {

            var wid = v.$el.val();

            if (wid !== '0') {

                if (v.options.name === 'publishers') {

                    this.getChildView('rep').collection.reset();

                    var w = v.collection.get(wid);

                    if (w.has("requestParameters")) {

                        var queryid = w.get("requestParameters").rid;

                        this.$(".load-tree").show();

                        var col = new Backbone.Collection();
                        col.url = '/api/Tree/ByWidgetQ/' + queryid;

                        this.showChildView('tree', new treeView({ collection: col, node: { checkbox: false } }));
                        col.fetch({ reset: true });

                        this.listenTo(this.getChildView('tree'), 'container:select:item', function (v) {

                            this.model.set('TypeSysName', v.model.get("sysName"));

                            $.get('/api/Reporting/ByWidgetQ/' + queryid + '/' + v.model.id).done(function (a) {

                                this.getChildView('rep').collection.reset(_.map(a, function (b) {
                                    return { id: b.ReportSysName, title: b.ReportDescription };
                                }));
                            }.bind(this));
                        });
                    } else this.getRegion('tree').empty();
                } else if (v.options.name === 'reports') this.model.set('ReportSysName', wid);
            } else this.getRegion('tree').empty();
        },

        childViewEvents: {},

        onChildviewReportClear: function onChildviewReportClear(v) {

            this.triggerMethod('show:message:confirm', {
                text: Resources.sure,
                fx: function fx() {
                    v.model.destroy();
                },
                ctx: this
            });
        },

        activeTab: function activeTab(name) {

            this.$("nav>span").removeClass("active");
            this.$("nav>span[data-name='" + name + "']").addClass("active");
            this.$("section").hide();
            this.$("." + name).show();
        },

        regions: {
            list: { el: '.list-report', replaceElement: true },
            publ: { el: '.list-publishers', replaceElement: true },
            rep: { el: '.type-rep', replaceElement: true },
            tree: { el: '.load-tree', replaceElement: true }
        },

        onRender: function onRender() {

            this.showChildView('publ', new selectView({ collection: new Backbone.Collection(), name: 'publishers' }));
            this.showChildView('rep', new selectView({ collection: new Backbone.Collection(), name: 'reports' }));

            var listCollection = new Backbone.Collection();
            listCollection.model = modelReport;
            listCollection.url = '/api/widget/' + this.options.wid + '/reportitems';

            this.model = new modelReport();
            this.model.collection = listCollection;

            this.showChildView('list', new listReports({ collection: listCollection }));

            this.activeTab("list-report");
        },

        onBeforeShow: function onBeforeShow() {

            if (!this.options.publishers.length) {

                this.options.publishers.fetch({
                    reset: true,
                    success: function (collection) {

                        if (collection.length) {
                            this.$('.notice').empty();
                            this.getChildView('publ').collection.reset(this.options.publishers.models);
                            this.getChildView('list').collection.fetch({ reset: true });
                        } else this.$('.notice').html(Resources.subscrNote);
                    }.bind(this)
                });
            } else {

                this.$('.notice').empty();
                this.getChildView('publ').collection.reset(this.options.publishers.models);
                this.getChildView('list').collection.fetch({ reset: true });
            }
        },

        onSave: function onSave() {

            this.model.save({}, {

                success: function (model) {
                    this.getChildView('list').collection.add(model);
                }.bind(this)

            });
        }

    });
});
'use strict';

define('settings.subscribeList', ['i18n!nls/resources.min'], function (Resources) {

        // см. также widget.widgetView include
        var include = ["WidgetTable", "WidgetMap", "WidgetGraph", "WidgetRunning", "WidgetHtml", 'WidgetCloud', 'WidgetSemNet'];

        return Mn.CollectionView.extend({

                className: "list-area",

                emptyView: Mn.View.extend({

                        template: _.template('<i style="color:red;font-style:italic;"><%- Resources.subsnotfound %></i>'),
                        templateContext: { Resources: Resources }

                }),

                childView: Mn.View.extend({

                        className: 'item',

                        template: _.template("<input type='checkbox' class='g-form--checkbox' id='<%- id %>' name='<%- id %>' /><label for='<%- id %>'><%= title %>&nbsp;(<%= typeName %>)</label>"),

                        triggers: {
                                "click": 'click:item'
                        },

                        onBeforeRender: function onBeforeRender() {

                                if (include.indexOf(this.model.get("typeName")) === -1) this.$el.hide();
                        }

                }),

                isEmpty: function isEmpty() {

                        if (this.collection) return !this.collection.filter(function (m) {

                                return include.indexOf(m.get("typeName")) !== -1;
                        }).length;else return true;
                },

                childViewTriggers: {
                        'click:item': 'click:item:subscribe'
                }

        });
});
'use strict';

define('settings.subscribe', ['settings.subscribeList'], function (subscribeList) {

            return Mn.View.extend({

                        template: _.template('<div></div>'),

                        regions: {
                                    area: 'div'
                        },

                        onRender: function onRender() {

                                    var list = new subscribeList({ collection: this.model.collection });

                                    this.showChildView('area', list);

                                    list.setFilter(function (child, index, collection) {
                                                return child.id !== this.model.id;
                                    }.bind(this));

                                    this._check();
                        },

                        onChildviewClickItemSubscribe: function onChildviewClickItemSubscribe(v) {

                                    if (!v.$('input').is(':checked')) {

                                                this.collection.create(new Backbone.Model({
                                                            id: v.model.id,
                                                            title: v.model.get('title'),
                                                            requestParameters: v.model.get('requestParameters')
                                                }));
                                    } else {

                                                this.collection.get(v.model.id).destroy();
                                    }
                        },

                        collectionEvents: {

                                    update: function update() {

                                                this._check();
                                    },

                                    reset: function reset() {

                                                this._check();
                                    }
                        },

                        _check: function _check() {

                                    this.getChildView('area').children.each(function (v) {

                                                if (this.collection.findWhere({ id: v.model.id })) v.$('input').prop('checked', true);else v.$('input').prop('checked', false);
                                    }, this);
                        },

                        onShow: function onShow() {

                                    if (!this.collection.length) this.collection.fetch({ reset: true });
                        }

            });
});
'use strict';

define('widget.content.contentView', ['i18n!nls/resources.min', '/js/dist/video-js/video.js', '/js/dist/jquery.mCustomScrollbar.concat.min.js'], function (Resources) {

    var ContentModel = Backbone.Model.extend({ idAttribute: "object_id" });

    var itemsView = Mn.CollectionView.extend({

        className: 'accordion',

        onAttach: function onAttach() {

            this.$el.css({ position: 'relative', overflow: 'hidden' });
        },

        childView: Mn.View.extend({

            className: 'item-content',

            template: templates['widget-source-content'],
            templateContext: { Resources: Resources },

            ui: {
                head: '.head-content',
                load: '.load',
                rubrics: '.card-rubric',
                url: '.card-link',
                play: '.play-button'
            },

            events: {

                'click @ui.play': function clickUiPlay(e) {

                    var $e = $(e.target),
                        start = parseInt(this.model.get('playingat')),
                        end = parseInt(this.model.get('playinguntil')),
                        p = videojs(this.$('video').get(0));

                    this.ui.play.text('pause');

                    p.ready(function () {

                        if (!end || this.currentTime() < end) {
                            if (this.paused()) {
                                $e.text('pause');
                                this.play();
                            } else this.pause();
                        } else {
                            this.load();
                            this.play();
                        }
                    });

                    p.on("waiting", function () {
                        $e.attr('disabled');
                    });

                    p.on("loadeddata", function () {
                        $e.removeAttr('disabled');
                    });

                    p.on("pause", function () {
                        $e.text('play');
                    });

                    Backbone.trigger("storage:addPlayer", p, this.model.get("object_id"));
                }

            },

            initialize: function initialize() {

                this.lightPos = [];
            },

            onBeforeRender: function onBeforeRender() {

                if (!this.model.has('webfile')) this.model.set('webfile', '');
            },

            onRender: function onRender() {

                if (this.model.has('contentcollection_rubrics') && $.trim(this.model.get('contentcollection_rubrics')) && !this.model.get('hideRubrics')) {

                    var c = this.model.get('contentcollection_rubrics');

                    if (_.isArray(c) && c.length) this.ui.rubrics.find('p').html(c.join(' | '));else this.ui.rubrics.find('p').text(c);
                } else this.ui.rubrics.hide();

                if (this.model.get('url_источника')) this.ui.url.html('<span class="card-link-icon"><svg class="link-icon"><use xlink:href="#link-icon"></use></svg></span>\n                        <a href="' + this.model.get('url_источника') + '" target="_blank">' + (this.model.get('massmedia') || this.model.get('url_источника')) + '</a>');
            },

            onAttach: function onAttach() {

                var typename = this.model.get('systemtypename');

                if (typename === "Audiosource" || typename === "VideoSource") {

                    var p = videojs(this.$('video').get(0)),
                        videoWidth = 0,
                        videoHeight = 0,
                        isVideo = this.model.get('systemtypename') === "VideoSource",
                        w = this.$el.width();

                    if (!isVideo) p.height(128, true);else p.height((this.$el.width() - 80) / 3, true);

                    p.on("loadeddata", function () {

                        videoWidth = this.L.videoWidth;
                        videoHeight = this.L.videoHeight;

                        if (isVideo) {

                            if (w < videoWidth) {
                                var d = videoWidth / videoHeight;
                                videoWidth = w - 30;
                                videoHeight = videoWidth / d;
                            }

                            this.width(videoWidth, true);
                            this.height(videoHeight, true);
                        }
                    });
                } else this._toLightPosition();
            },

            _toLightPosition: function _toLightPosition() {
                var _this = this;

                this.ui.load.css({ width: this.$el.closest('.widget-container').width(), height: this.$el.closest('.widget-container').height() - this.ui.head.height(), overflow: 'auto' });

                this.ui.load.find("span[data-oid]").each(function (i, e) {
                    $(e).addClass("Mark");
                    _this.lightPos.push($(e).position().top);
                });

                var pd = this.lightPos,
                    sp = 0;

                this.ui.load.mCustomScrollbar();

                if (pd.length && sp !== pd.length) {

                    this.ui.load.mCustomScrollbar("scrollTo", pd[sp] - this.ui.load.position().top - 3);

                    this.ui.load.find("span[data-oknd=2].C").removeClass("C");
                    this.ui.load.find("span[data-oknd=2]").eq(sp).addClass("C");

                    if (sp === pd.length - 1) sp = 0;else sp++;
                } else this.ui.load.mCustomScrollbar("scrollTo", 0);

                //this.$(".gotoresult .total").html(Resources.Total + "&nbsp;" + Resources.matches + ":&nbsp;" + pd.length);
                //if (pd.length)
                //    this.$(".gotoresult").show();
                //else
                //    this.$(".gotoresult").hide();
            }
        })

    });

    return Mn.View.extend({

        template: _.template('<div></div>'),

        regions: {
            items: { el: 'div', replaceElement: true }
        },

        initialize: function initialize() {

            Backbone.trigger("storage:clearPlayers");

            this.collection = new Backbone.Collection();
            this.collection.url = '/api/widget/listen/' + this.options.requestID + '/source/' + this.model.id + '/' + this.options.objectID;
            //'/api/details/ContentV2/' + this.options.objectID;
        },

        onRender: function onRender() {

            this.showChildView('items', new itemsView({ collection: new Backbone.Collection() }));
        },

        onAttach: function onAttach() {

            this.collection.fetch({ reset: true });
        },

        modelEvents: {

            'change:height': function changeHeight() {

                this.getChildView('items').render();
            }

        },

        collectionEvents: {

            request: function request() {

                Backbone.Radio.channel('loader').trigger('show', this.$el, { speed: 'fast' });
            },

            reset: function reset() {

                var o = Backbone.Radio.channel('chW').request('get:param:model', this.model.get('Characteristics'), "WidgetSource.Options"),
                    hideRubrics = false;

                if (o.has('WidgetParamValue')) hideRubrics = o.get('WidgetParamValue').hideRubrics;

                var m = this.collection.at(0),
                    items = m.get('items'),
                    c = [];

                _.each(items, function (item) {

                    var attr = _.chain(item.data).map(function (m) {
                        return [m.systemName, m.value];
                    }).object().value();

                    attr.links = item.links;

                    if (!attr.textsource) attr.textsource = '';

                    attr.hideRubrics = hideRubrics;

                    c.push(attr);
                }, this);

                this.getChildView('items').collection.reset(c);

                Backbone.Radio.channel('loader').trigger('hide');
                this.triggerMethod('content:loaded');
            },

            error: function error() {

                Backbone.Radio.channel('loader').trigger('hide');
                this.triggerMethod('content:loaded');
            }

        }

    });

    //var contentTemplate = '<div class="Tools"></div><div class="gotoresult" data-id="6782E40B-794A-467D-BC8E-21992920317D"><span class="total"></span>&nbsp;<button class="up"><%= Resources.go %></button></div><div class="RubricsLink"></div><div class="contentSnet"></div><div class="Load"></div>',

    //    mediaTemplate = '<% if(systemtypename=="VideoSource"){%><div><video id="videoFact<%= object_id %>" class="video-js vjs-default-skin Videosource" preload="none" poster="/images/Display128x128.png"><source src="<%= MediaUrl %><% if(PlayingAt){ %>#t=<%= PlayingAt %>,<%= PlayingUntil %><% } %>" type="video/mp4"></video><nav><button class ="Play" data-start="<%= PlayingAt %>" data-end="<%= PlayingUntil %>">&nbsp; </button><span class="Duration"></span></nav></div><% } if(systemtypename=="Audiosource"){ %><div><video id="videoFact<%= Object_ID %>" class="video-js vjs-default-skin Audiosource" preload="none" poster="/images/Headphones128x128.png"><source src="<%= mediaurl %><% if(PlayingAt){ %>#t=<%= PlayingAt %>,<%= PlayingUntil %><% } %>" type="audio/mp3"></video><nav><button class ="Play" data-start="<%= PlayingAt %>" data-end="<%= PlayingUntil %>">&nbsp; </button><span class="Duration"></span></nav></div><% } %><%= textsource %><%= webfile %><div><i><%= author %></i><br/><% if(massmedia) { %><a href="<%= url_источника %>" target="_blank"><%= massmedia %>&nbsp; &raquo; </a><br/><% } %></div>',

    //    template = '<p class="buttons"><button id="showOriginalDoc" class="originallink" data-id="0CA650F2-8D85-4C76-8B02-F4080F75B9DE"><%= Resources.originaldoc %></button>&nbsp;&nbsp;'+
    //    '<button id="translate" class="trans" data-id="5C949741-9B72-40EA-AAA6-6FD4419C6E86"><%= Resources.translate %></button>&nbsp;&nbsp;'+
    //    '<button id="toOriginal" class="trans" data-id="5C949741-9B72-40EA-AAA6-6FD4419C6E86"><%= Resources.returnText %></button>&nbsp;&nbsp;'+
    //    '<button id="shortText" data-id="73FCB91F-2E99-4BF7-857F-F3EB59610AFE"><%= Resources.view %></button>&nbsp;&nbsp;'+
    //    '<button class="showSn" data-id="4E38E1F4-38D5-40B5-AAAD-CCE5825100AD"><%= Resources.showSNet %></button>&nbsp;&nbsp;'+
    //    '<span class="modView right"><i><%= Resources.titleView %>: <b id="titleModView"><%= Resources.shortView %></b></i></span></p>';

    //var Dynamo = Backbone.View.extend({

    //    events: {
    //        "click button": "cmd"
    //    },

    //    cmd: function (e) {

    //        e.stopPropagation();

    //        var $b = $(e.target).closest("button");

    //        if ($.trim($b.data("href"))) {

    //            var r = { url: $b.data("href"), data: { }, method: $b.data("verb") };

    //            if ($b.data("name") === "shortText")
    //                this.parent.isMode = !this.parent.isMode;

    //            this.parent.sendRequest(r, this.parent.prepare, this.parent);

    //        } else 
    //            Backbone.trigger('content:'+$b.data("render"), this.parent.data ? new ContentModel(this.parent.data) : this.parent.model);
    //    },

    //    initialize: function(o) {
    //        this.parent = o.parent;
    //    },

    //    render: function () {

    //        this.$el.html(_.template(template)({ Resources: Resources }));

    //        this.$("#titleModView").text(this.parent.isMode ? Resources.fullView : Resources.shortView);

    //        this.collection.each(function (link) {
    //            if (link.get("rel") === "tools") this.addBtn(link.toJSON());
    //        }, this);

    //        //this.$("button").button();

    //        this.$(".buttons").show();

    //        return this;
    //    },

    //    addBtn: function(link) {
    //        var $b = this.$('#'+link.id);
    //        if (!App.check($b))
    //            $b.hide();
    //        else {
    //            _.each(link, function(value, key) {
    //                switch(key) {
    //                    case "id":
    //                        $b.attr("data-name", value);
    //                        if (value === "shortText") this.$(".modView").show();
    //                        break;
    //                    case "prompt":
    //                        $b.attr("title", value);
    //                        $b.button({ label: value });
    //                        break;
    //                    default: $b.attr('data-'+key, value);
    //                        break;
    //                }
    //            },this);
    //            $b.show();
    //        }
    //    },
    //});

    //var Item = Backbone.View.extend({

    //    events: {
    //        "click .gotoresult .up": "toresult",
    //        "click .gotoresult .down": "toresult"
    //    },

    //    toresult: function () {

    //        var pd = this.pd;
    //        if (pd.length && this.sp !== pd.length) {

    //            this.$(".Load").mCustomScrollbar("scrollTo", pd[this.sp] - this.$(".Load").position().top - 3);

    //            this.$(".Load").find("span[data-oknd=2].C").removeClass("C");
    //            this.$(".Load").find("span[data-oknd=2]").eq(this.sp).addClass("C");

    //            if (this.sp === pd.length - 1) this.sp = 0;
    //            else this.sp++;

    //        } else {
    //            this.sp = 0;
    //            this.$("div.Load").mCustomScrollbar("scrollTo", 0);
    //        }
    //        this.$(".gotoresult .total").html(Resources.Total + "&nbsp;" + Resources.matches + ":&nbsp;" + pd.length);
    //        if (pd.length)
    //            this.$(".gotoresult").show();
    //        else
    //            this.$(".gotoresult").hide();
    //    },

    //    initialize: function (o) {
    //        this.options = o;
    //        this.pd = [];
    //        this.sp = 0;
    //        this.isMode = false;

    //        this.model.set("PlayingAt",this.model.get("PlayingAt") || 0);
    //        this.model.set("PlayingUntil", this.model.get("PlayingUntil") || 0);
    //    },

    //    sendRequest: function (o, callback, ctx) {
    //        $.ajax(o).done(function (item) { callback.call(ctx, item) });
    //    },

    //    prepare: function (item) {

    //        var links = item.links;
    //        if ("items" in item) {
    //            this.data = App.prepare(item.items)[0];
    //            links = item.items[0].links;
    //        } else
    //            this.data = App.prepare([item])[0];

    //        this.initTools(new Backbone.Collection(links));

    //        this.data.PlayingAt = this.data.PlayingAt || 0;
    //        this.data.PlayingUntil = this.data.PlayingUntil || 0;


    //        // basic settings select TextSource or WebFile
    //        var field = this.options.parent.widget.get('contentProp');

    //        if (!this.model.has('textsource'))
    //            this.model.set('textsource', '');

    //        if (!this.model.has('webfile'))
    //            this.model.set('webfile', '');

    //        this.$(".Load").html(_.template(mediaTemplate)(this.data));
    //        this.loaded().fitLoad().toresult();
    //    },

    //    fitHeight: function () {
    //        var h = this.$el.parent().parent().height() - this.$el.parent().find("h3").outerHeight(), // accordion - parent
    //            dh = 0;
    //        this.$el.children(":not('.Load')").each(function(i, e) {if ($(e).is(":visible")) dh += parseInt($(e).outerHeight());});
    //        if (h) this.$(".Load").height(h - dh);
    //    },

    //    initTools:function(col) {
    //        if (this.Tools) {
    //            this.Tools.remove();
    //            if (!this.$(".Tools").get(0))
    //                this.$el.prepend('<div class="Tools"></div>');
    //        }
    //        this.Tools = new Dynamo({ collection: col, parent: this, el: this.$(".Tools") }).render();
    //        this.listenTo(this.Tools, "button:click", this.prepare);
    //    },

    //    render: function () {

    //        var links = this.model.get("links"),
    //            flag = _.find(links, function (l) { return l.rel === "sys" && l.id === "Mode" && l.value === "9" });

    //        this.$el.html(_.template(contentTemplate)( { Resources: Resources }));

    //        if (!flag) {

    //            this.initTools(new Backbone.Collection(links));

    //            // basic settings select TextSource or WebFile
    //            var field = this.options.parent.widget.get('contentProp');

    //            if (!this.model.has('textsource'))
    //                this.model.set('textsource', '');

    //            if (!this.model.has('webfile'))
    //                this.model.set('webfile', '');

    //            this.$(".Load").html(_.template(mediaTemplate)(this.model.toJSON()));

    //            //this.$("button.up").button({ label: Resources.go, icons: { primary: "ui-icon-seek-next" }, text: false });

    //            this.linkToRubrics();

    //        } else
    //            this.$(".Load").html(Resources.limit);

    //        return this;
    //    },

    //    fitLoad: function () {
    //        this.$(".Load").mCustomScrollbar("scrollTo", 0);//.scrollTop(0);
    //        this.pd = [];
    //        var s = this;
    //        this.$(".Load").find("span[data-oknd=2]").each(function(i, e){
    //            $(e).addClass("Mark");
    //            s.pd.push($(e).position().top);
    //        });
    //        return this;
    //    },

    //    loaded: function () {

    //        var $s = this.$el,
    //            name = '#videoFact' + this.model.get("object_id");

    //        if (this.$(name).get(0)) {
    //            var s = this;
    //            this.$("button.Play")
    //                .button({ text: false, icons: { primary: "ui-icon-play" } })
    //                .click(function () { s.play() });

    //            var p = videojs(this.$(name).get(0)),
    //                videoWidth = 0,
    //                videoHeight = 0,
    //                $c = this.$(".Load"),
    //                $v = this.$(name);

    //            //p.width(this.$(".Load").width() - 90, true);
    //            if ($v.hasClass("Audiosource"))
    //                p.height(128, true);
    //            else
    //                p.height((this.$(".Load").width() - 80) / 3, true);

    //            p.on("loadeddata", function () {
    //                videoWidth = this.L.videoWidth;
    //                videoHeight = this.L.videoHeight;
    //                if (!$v.hasClass("Audiosource")) {
    //                    if ($s.width() < videoWidth) {
    //                        var d = videoWidth / videoHeight;
    //                        videoWidth = $s.width() - 30;
    //                        videoHeight = videoWidth / d;
    //                    }
    //                    $c.css({ width: videoWidth + 20, height: videoHeight + 50 });
    //                    this.width(videoWidth, true);
    //                    this.height(videoHeight, true);
    //                }
    //            });
    //        }
    //        this.fitHeight();
    //        this.$(".Load").mCustomScrollbar();// { scrollbarPosition:'outside'}
    //        this.$('.mCSB_container').attr('dir', 'auto');
    //        return this;
    //    },

    //    play: function (e) {
    //        var $e = this.$("button.Play"),
    //            start = parseInt($e.data("start")),
    //            end = parseInt($e.data("end")),
    //            p = videojs(this.$("#videoFact" + this.model.get("object_id")).get(0));

    //        $e.button().button("option", "icons", { primary: "ui-icon-pause" });

    //        p.ready(function () {

    //            if (!end || this.currentTime() < end)
    //                if (this.paused()) {
    //                    $e.button("option", "icons", { primary: "ui-icon-pause" });
    //                    this.play();
    //                } else
    //                    this.pause();
    //            else {
    //                this.load();
    //                this.play();
    //            }
    //        });

    //        p.on("waiting", function () {
    //            $e.button("disable");
    //        });
    //        p.on("loadeddata", function () {
    //            $e.button().button("enable");
    //        });
    //        p.on("pause", function () {
    //            $e.button().button("option", "icons", { primary: "ui-icon-play" });
    //        });

    //        Backbone.trigger("storage:addPlayer", p, this.model.get("object_id"));
    //    },

    //    linkToRubrics: function () {
    //        var data = this.model.get("contentcollection_rubrics");
    //        if ($.trim(data))
    //            this.$(".RubricsLink").append('<i>' + Resources.linkToRubricTitle + ':</i>&nbsp;&nbsp;<b>' + data + '</b>');
    //    }
    //});


    // Mn.View.extend({

    //    template: _.template( '<div></div>' ),

    //    regions: {
    //        accordion: { el: 'div', replaceElement: true }
    //    },


    //    onRender: function () {

    //        this.showChildView( 'accordion', new listItems( { collection: this.collection }) );            

    //        //this.searchPhrase = App.Select.get("params") ? App.Select.get("params").phrase : "";
    //        //this.sendRequest({
    //        //    url: this.options.url || '/api/details/ContentV2/' + this.options.objectID,
    //        //    data: this.options.data || (this.searchPhrase ? $.param({ "highlightPhrase": this.searchPhrase }) : [])
    //        //}, this.prepare, this);

    //    },

    //    onAttach: function () {
    //        this.collection.fetch( { reset: true });
    //    },


    //    fitSize: function () {
    //        //_.each(this.items, function (s) { s.fitHeight() });
    //        //return this;
    //    }

    //    //sendRequest: function (o, callback, ctx) {

    //    //    this.$el.showIndicator();

    //    //    $.ajax( o )

    //    //        .done(function (item) {
    //    //            callback.call(ctx, item);
    //    //        })

    //    //        .always(function () {
    //    //            this.$el.hideIndicator();

    //    //            if (this.callback)
    //    //                this.callback.call( this.context, this );

    //    //        }.bind(this));
    //    //},

    //    //prepare: function (item) {

    //    //    this.$el.append("<div id='accordion'></div>");

    //    //    if ("version" in item) {

    //    //        _.each(item.items, this.addOne, this);

    //    //        if ( item.items.length > 1 ) {

    //    //            this.$("#accordion").accordion({
    //    //                heightStyle: "content",
    //    //                collapsible: true,
    //    //                activate: function () {
    //    //                    this.trigger( "action" );
    //    //                }
    //    //            });

    //    //        }
    //    //    } else 
    //    //        this.addOne(item);

    //    //    if (this.callback)
    //    //        this.callback.call(this.context, this);
    //    //},

    //    //addOne: function (item) {

    //    //    var m = new Backbone.Model(App.prepare([item])[0]);

    //    //    m.set("links", item.links);

    //    //    var s = new Item({ model: m, parent: this }).render();

    //    //    if (!(this.widget.has('hideTitle') && this.widget.get('hideTitle')))
    //    //        this.$("#accordion").append('<h3>' + m.get("display_name") || "" + '</h3>');

    //    //    this.$("#accordion").append(s.$el);

    //    //    s.loaded().fitLoad().toresult();
    //    //    this.items.push(s);
    //    //},


    //});
});
'use strict';

define('MasterCreateView', ['i18n!nls/resources.min', 'settings.subscribeList', 'requestView', 'settings.visualisation.chart.choice', 'g/ejRTEView', 'settings.decorationWidget', 'syncfusion'], function (Resources, subscribeList, Requests, visualView, HtmlEditor, decorationView) {

    var MIN_SIZE = 50;

    return Mn.View.extend({

        template: '#widget-create-template',
        templateContext: {
            Resources: Resources
        },

        ui: {
            next: '#next',
            back: '#back'
        },

        regions: {
            reqArea: '.requestParam>section',
            subscrArea: '#Subscribe',
            editor: ".htmlEditor",
            visual: ".visualization",
            decoration: { el: '#decoration', replaceElement: true }
        },

        initialize: function initialize() {

            this.panels = {
                "Default": ["one", "requestParam", "decoration"],
                "WidgetGraph": ["one", "requestParam", "visualization", "decoration"],
                "WidgetSource": ["one", "requestParam", "decoration", "subscribe"],
                "WidgetSemNet": ["one", "requestParam", "decoration", "subscribe"],
                "WidgetReporting": ["one", "requestParam", "decoration", "subscribe"],
                "WidgetHtml": ["one", "requestParam", "decoration", "htmlEditor"]
            };

            this.step = new Backbone.Model({ step: 0 });
            this.step.on("change:step", this.checkStep, this);

            this.publishers = new Backbone.Collection();
        },

        onRender: function onRender() {
            this.step.set("step", 1);
        },

        events: {

            "keyup #titleWidget": "checkTitle",

            "blur #titleWidget": "checkTitle",

            "mouseover .types-widget span": function mouseoverTypesWidgetSpan(e) {

                var name = $(e.target).closest("span").attr("id"),
                    data = {
                    "WidgetTable": Resources.WidgetTable,
                    "WidgetRunning": Resources.WidgetRunning,
                    "WidgetMap": Resources.WidgetMap,
                    "WidgetGraph": Resources.WidgetGraph,
                    "WidgetCloud": Resources.WidgetCloud,
                    "WidgetSource": Resources.WidgetSource,
                    "WidgetReporting": Resources.WidgetReporting,
                    "WidgetHtml": Resources.WidgetHtml,
                    "WidgetSemNet": Resources.WidgetSemNet
                };

                if (this.step.get("step") === 1) this.$(".one>.description").html(data[name]).fadeIn();
            },

            "mouseleave .types-widget span": function mouseleaveTypesWidgetSpan() {
                this.$(".one>.description").hide();
            },

            "click .types-widget span": function clickTypesWidgetSpan(a) {

                var $s = $(a.target).closest("span");

                this.model.set("typeName", $s.attr("id"));
                this.isInitRequest = false;
                this.next();
            },

            "click @ui.back": function clickUiBack() {

                var step = this.step.get("step");

                if (step > 1) {
                    step--;
                    this.step.set("step", step);
                }
            },

            "click @ui.next": 'next',

            "click nav>div": function clickNavDiv(e) {

                this.$("nav>div").toggleClass("ac");
                this.$(".tab-content").toggleClass("show");
            },

            "click #decor-chbx span.font-icon-checkbox": function clickDecorChbxSpanFontIconCheckbox(e) {

                var $c = $(e.target).closest("span"),
                    inpt = $c.find("input").get(0);

                $c.toggleClass("checked");

                inpt.checked = !inpt.checked;
            }
        },

        modelEvents: {

            change: function change() {

                this.ui.next.attr('disabled', !this.model.isValid());
            },

            'change:width': function changeWidth(m, v) {
                this.$('input[name="width"]').val(v);
            },

            'change:height': function changeHeight(m, v) {
                this.$('input[name="height"]').val(v);
            }
        },

        childViewEvents: {

            'chart:selected': function chartSelected(v) {
                this.ui.next.attr('disabled', false);
            }
        },

        next: function next() {

            var step = this.step.get("step");
            step++;
            this.step.set("step", step);
        },

        checkTitle: function checkTitle() {

            this.model.set("title", $.trim(this.$("#titleWidget").val()));
        },

        checkStep: function checkStep() {

            this.$el.closest('.side-panel').removeClass('big');

            var s = this.step.get("step"),
                p = this.panels[this.model.get("typeName")] || this.panels["Default"];

            if (p.indexOf("htmlEditor") !== -1 && this.getRegion('editor').hasView()) this.model.set("contentHtml", this.getChildView('editor').ejRTE.getHtml());

            if (s >= 0 && s <= p.length) {

                this.ui.next.text(s === p.length ? Resources.createdWidget : Resources.next).attr('disabled', !this.model.isValid());

                this.ui.back.attr('disabled', s === 1);

                this.$(".step-panel").hide();
                var panelName = p[s - 1];
                this.$("." + panelName).show();

                if (s === 1) this.$(".cmd").hide();else this.$(".cmd").show();

                switch (panelName) {

                    case "requestParam":

                        this.showChildView('reqArea', new Requests({ model: this.model }));

                        break;

                    case "visualization":

                        this.$el.closest('.side-panel').addClass('big');
                        this.ui.next.attr('disabled', true);
                        this.showChildView('visual', new visualView({ model: this.model }));

                        break;

                    case "subscribe":

                        if (!this.getRegion('subscrArea').hasView()) {

                            var ss = new subscribeList({ collection: this.model.collection });

                            this.getRegion('subscrArea').show(ss);

                            this.listenTo(ss, 'click:item:subscribe', function (v) {

                                if (!v.$('input').is(':checked')) {

                                    v.$('input').prop('checked', true);
                                    this.publishers.add(new Backbone.Model({ id: v.model.id, title: v.model.get('title') }));
                                } else {

                                    v.$('input').prop('checked', false);
                                    this.publishers.remove(this.publishers.get(v.model.id));
                                }
                            });
                        }
                        break;

                    case "htmlEditor":

                        if (!this.getRegion('editor').hasView()) this.showChildView('editor', new HtmlEditor());

                        break;

                    case "decoration":

                        if (!this.getRegion('decoration').hasView()) this.showChildView('decoration', new decorationView({ model: this.model }));

                        break;

                }
            } else if (s > p.length) {

                if (this.publishers.length) this.model.set("publishers", this.publishers.pluck("id"));

                this.getDecoration();

                var win = $('main');

                this.model.set({
                    top: win.height() / 2 - this.model.get('height') / 2 + win.scrollTop(),
                    left: win.width() / 2 - this.model.get('width') / 2 + win.scrollLeft()
                });

                this.model.collection.create(this.model, { wait: true });

                this.getRegion('reqArea').empty();
                this.getRegion('subscrArea').empty();

                this.triggerMethod("close:left", this.model);
            }
        },

        getDecoration: function getDecoration() {

            var output = this.model.get('Decoration') || {},
                w = parseInt(this.$('input[name="width"]').val()),
                h = parseInt(this.$('input[name="height"]').val());

            this.model.set({
                width: isNaN(w) ? this.model.get('width') : w < MIN_SIZE ? MIN_SIZE : w,
                height: isNaN(h) ? this.model.get('height') : h < MIN_SIZE ? MIN_SIZE : h
            });
        }

    });
});
'use strict';

define('widget:map:legendView', [], function () {

    return Mn.View.extend({

        template: '#widget-map-legend-template',

        ui: {
            container: '.LegendContainer'
        },

        onRender: function onRender() {

            if (!this.model.get('LegendIsVisible')) this.$el.hide();

            this.setPosition();
        },

        modelEvents: {

            change: function change() {
                this.render();
            }
        },

        setPosition: function setPosition() {

            var p = this.model.get('LegendPosition') || 'top-right',
                _p = p.split("-"),
                b = _p[1],
                css = {};

            css[_p[0]] = "1px";
            css[b] = b === "top" ? 36 + "px" : "1px";

            this.ui.container.fadeTo("hide", .8).css(css);
        }
    });
});
'use strict';

define('widget.reportView', ['i18n!nls/resources.min', 'PDFJS'], function (Resources) {

    return Mn.View.extend({

        template: false,

        modelEvents: {

            change: function change() {
                this.$el.empty();
                this.renderPage(this.pdf);
            }

        },

        onRender: function onRender() {

            if (!this.options.url) this.$el.html('<p>' + Resources.setreport + '</p>');
        },

        onAttach: function onAttach() {

            if (this.options.url) require(["/js/dist/pdf/display/api.js", "/js/dist/pdf/display/metadata.js", "/js/dist/pdf/display/canvas.js", "/js/dist/pdf/display/webgl.js", "/js/dist/pdf/display/pattern_helper.js", "/js/dist/pdf/display/font_loader.js", "/js/dist/pdf/display/annotation_helper.js"], function () {

                PDFJS.workerSrc = '/js/dist/pdf/worker_loader.js';

                PDFJS.getDocument(this.options.url).then(function (pdf) {
                    this.pdf = pdf;
                    this.renderPage(pdf);
                }.bind(this));
            }.bind(this));
        },

        renderPage: function renderPage(pdf) {

            var viewer = this.$el.get(0),
                width = this.$el.width() - 40;

            function renderPage(div, pdf, pageNumber, callback) {

                pdf.getPage(pageNumber).then(function (page) {

                    var scale = 1.0;
                    var viewport = page.getViewport(scale);

                    viewport = page.getViewport(width / viewport.width);

                    var pageDisplayWidth = viewport.width;
                    var pageDisplayHeight = viewport.height;

                    var pageDivHolder = document.createElement('div');
                    pageDivHolder.className = 'pdfpage';
                    pageDivHolder.style.width = pageDisplayWidth + 5 + 'px';
                    pageDivHolder.style.height = pageDisplayHeight + 5 + 'px';
                    div.appendChild(pageDivHolder);

                    // Prepare canvas using PDF page dimensions
                    var canvas = document.createElement('canvas');
                    var context = canvas.getContext('2d');
                    canvas.width = pageDisplayWidth;
                    canvas.height = pageDisplayHeight;
                    pageDivHolder.appendChild(canvas);

                    // Render PDF page into canvas context
                    var renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    page.render(renderContext).promise.then(callback);
                });
            }

            var pageNumber = 1;
            renderPage(viewer, pdf, pageNumber++, function pageRenderingComplete() {
                if (pageNumber > pdf.numPages) return; // All pages rendered 
                renderPage(viewer, pdf, pageNumber++, pageRenderingComplete);
            });
        },

        fitSize: function fitSize() {}
    });
});
'use strict';

define('widget.semnet.semnetView', [], function () {

    var ZOOM_MIN = 0.125,
        ZOOM_MAX = 6;

    var semnetModel = Backbone.Model.extend({

        defaults: {
            astree: 0,
            eparam: [0, 0, 0],
            filter: null,
            filterName: null,
            filterValue: null,
            height: 0,
            html: '',
            level: 0,
            snid: -1,
            title: '',
            width: 0
        }

    });

    return Mn.View.extend({

        template: _.template('<svg><g class="wrap"></g></svg>'),

        events: {

            'mouseover g.node[data-objectid]': function mouseoverGNodeDataObjectid(e) {

                var $e = $(e.currentTarget),
                    id = parseInt($e.attr('data-objectid'));

                if (!isNaN(id) && id) $e.css('cursor', 'pointer');
            },

            'mouseout g.node[data-objectid]': function mouseoutGNodeDataObjectid(e) {
                $(e.currentTarget).css('cursor', 'default');
            },

            'click g.node[data-objectid]': function clickGNodeDataObjectid(e) {

                var $e = $(e.currentTarget),
                    id = parseInt($e.attr('data-objectid'));

                if (!isNaN(id) && id) this.trigger('subscribers:reflect', new Backbone.Model({ 'object_id': id, requestID: this.options.RID }));
            }
        },

        initialize: function initialize() {

            this.model = new semnetModel();
            this.model.url = '/api/SemNet/' + this.options.objectID + '/?semnetid=-1&layout=' + this.options.widget.get('SNLayout') + '&level=' + this.options.widget.get('SNLevel') + '&astree=' + this.options.widget.get('SNStruct');

            this.listenTo(this.options.widget, 'change:width', function (m) {
                this._fitSize(m);
            });

            this.listenTo(this.options.widget, 'change:height', function (m) {
                this._fitSize(m);
            });
        },

        onRender: function onRender() {

            if (!this.options.RID) console.error('!Not requestID!');

            $.ajaxSettings.headers.key = $.mergeUrlParam($.ajaxSettings.headers.key, { RID: this.options.RID });

            this.model.fetch();
        },

        modelEvents: {

            'change:html': function changeHtml(m, v) {

                var width = this.options.container.width(),
                    height = this.options.container.height();

                this.$('g.wrap').html($(v).html());

                var svg = d3.select(this.$('svg').get(0)),
                    g = svg.select('g.wrap'),
                    zoom = d3.zoom().scaleExtent([ZOOM_MIN, ZOOM_MAX]).on("zoom", function () {
                    g.attr("transform", d3.event.transform);
                }).on("end", function () {
                    //this._setCenter(d3.event.transform);
                }.bind(this)),
                    dx = this.model.get('width'),
                    dy = this.model.get('height'),
                    x = dx / 2,
                    y = dy / 2,
                    scale = Math.max(ZOOM_MIN, Math.min(ZOOM_MAX, 0.9 / Math.max(dx / width, dy / height))),
                    translate = [width / 2 - scale * x, height / 2 - scale * y];

                svg.attr('width', width).attr('height', height).call(zoom).transition().duration(750).call(zoom.transform, d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale));
            },

            request: function request() {
                Backbone.Radio.channel('loader').trigger('show', this.$el, { speed: 'fast' });
            },

            sync: function sync() {
                Backbone.Radio.channel('loader').trigger('hide');
            },

            error: function error() {
                Backbone.Radio.channel('loader').trigger('hide');
            }
        },

        _fitSize: function _fitSize(m) {

            //this.render();
        },

        _setCenter: function _setCenter(x, y, d) {

            // для сохранения позиции и масштаба

            var model = {
                name: this.options.widget.get('title'),
                type: this.options.widget.get('typeName'),
                uid: this.options.widget.id,
                Visualization: this.options.widget.get('Visualization')
            };

            var m = new Backbone.Model({
                widget: model,
                objectID: this.model.id,
                SNX: x,
                SNY: y,
                SNZoom: d
            });

            m.url = "/api/widget/" + this.options.widget.id + "/setstate";
            m.save();
        }

    });
});
'use strict';

define('chartsRepository', ['i18n!nls/resources.min'], function (Resources) {

           return [{ id: 1, name: Resources.gn1, type: "column", family: 'Syncfusion_G' }, { id: 3, name: Resources.gn2, type: "bar", family: 'Syncfusion_G' }, { id: 5, name: Resources.gn3, type: "stackingcolumn", family: 'Syncfusion_G' }, { id: 7, name: Resources.gn6, type: "line", family: 'Syncfusion_G' }, { id: 16, name: Resources.gn7, type: 'stackingcolumn100', family: 'Syncfusion_G' }, { id: 11, name: Resources.gn8, type: 'area', family: 'Syncfusion_G' }, { id: 15, name: Resources.gn9, type: 'stackingarea100', family: 'Syncfusion_G' }, { id: 6, name: Resources.gn5, type: "pie", family: 'Syncfusion_P' }, { id: 22, name: Resources.gn4, type: 'bubble', family: 'Syncfusion_W' }, { id: 4, name: Resources.gn10, type: "bar_d3", family: 'C3' }, { id: 9, name: Resources.gn11, type: 'area_d3', family: 'C3' }];
});
'use strict';

define('settings.visualisation.chart.choice', ['i18n!nls/resources.min', 'sendModel', 'ejChartView', 'chartsRepository'], function (Resources, sendModel, ejChartView, repository) {

    var listView = Mn.CollectionView.extend({

        className: 'graph-panel-grid',

        childView: ejChartView,

        childViewOptions: function childViewOptions(m) {
            m.set({ width: '300', height: '300' });
        },

        childViewEvents: {

            'chart:selected': function chartSelected(v) {

                this.children.each(function (c) {
                    c.$el.removeClass('selected');
                });

                v.$el.addClass('selected');

                this.trigger('chart:selected', v);
            }
        }

    });

    return Mn.View.extend({

        className: 'graph-panel show',

        template: '#choice-chart-template',

        templateContext: {
            Resources: Resources
        },

        regions: {
            wrap: { el: 'div.graph-panel-grid', replaceElement: true }
        },

        onRender: function onRender() {

            var pa = this.model.get('requestParameters');

            this.sendModel = new sendModel({
                id: pa.rid,
                pars: pa.parameters,
                useDefParams: pa.useDefParams,
                widget: {
                    uid: this.model.id,
                    name: this.model.get('title'),
                    type: this.model.get('typeName'),
                    Visualization: this.model.get('Visualization')
                }
            });

            if (this.options.ruleCode) this.sendModel.set('ruleCode', this.options.ruleCode);

            Backbone.Radio.channel('loader').trigger('show', this.$el);

            this.sendModel.fetch({
                success: this._successLoad.bind(this)
            });
        },

        _successLoad: function _successLoad(m) {

            var data = m.get('data').variations,
                charts = new Backbone.Collection();

            _.each(data, function (o) {

                var family = o.family;

                _.chain(repository).filter(function (a) {
                    return a.family === family;
                }).each(function (b) {

                    charts.add(new Backbone.Model(_.extend(b, o)));
                });
            }, this);

            this.showChildView('wrap', new listView({ collection: charts }));

            Backbone.Radio.channel('loader').trigger('hide');
        },

        childViewEvents: {

            'chart:selected': function chartSelected(v) {

                var rp = this.model.get('requestParameters');
                rp.ruleCode = v.model.get('ruleCode');

                this.model.set({ Visualization: v.model.get('type') });

                this.trigger('chart:selected', v);
            }
        }

    });
});
'use strict';

define('settings.visualization.chart', ['i18n!nls/resources.min', 'global.view.dropDown', 'global.charts.settingsmodel', 'global.behaviors.input', 'settings.colorRow', 'settings.visualisation.chart.choice', 'radio.characteristic', 'RU'], function (Resources, dropDown, subSettings, inputBehavior, colorRow, visualView) {

    var items = [{ id: 1, name: Resources.gn1, title: "column" }, { id: 3, name: Resources.gn2, title: "bar" }, { id: 5, name: Resources.gn3, title: "stackingcolumn" }, { id: 22, name: Resources.gn4, title: 'bubble' }, { id: 6, name: Resources.gn5, title: "pie" }, { id: 7, name: Resources.gn6, title: "line" }, { id: 16, name: Resources.gn7, title: 'stackingcolumn100' }, { id: 11, name: Resources.gn8, title: 'area' }, { id: 15, name: Resources.gn9, title: 'stackingarea100' }, { id: 4, name: Resources.gn10, title: "bar_d3" }, { id: 9, name: Resources.gn11, title: 'area_d3'
        //{ id: 0, name: Resources.tc, title: "tagCloud" },
        //{ id: 2, name: Resources.bar2, title: "bar3D" },
        //{ id: 8, name: Resources.area + " (" + Resources.detail + ")", title: 'spline' },
        //{ id: 10, name: 'stepline', title: 'stepline' },
        //{ id: 12, name: 'steparea', title: 'steparea' },
        //{ id: 13, name: 'splinearea', title: 'splinearea' },
        //{ id: 14, name: 'stackingarea', title: 'stackingarea' },          
        //{ id: 17, name: 'stackingbar', title: 'stackingbar' },
        //{ id: 18, name: 'doughnut', title: 'doughnut' },
        //{ id: 20, name: 'pyramid', title: 'pyramid' },
        //{ id: 21, name: 'funnel', title: 'funnel' },
        //{ id: 23, name: 'column3D', title: 'column3D' },
        //{ id: 24, name: 'stackingcolumn3D', title: 'stackingcolumn3D' },
        //{ id: 25, name: 'stackingcolumn1003D', title: 'stackingcolumn1003D' },
        //{ id: 26, name: 'stackingbar3D', title: 'stackingbar3D' },
        //{ id: 27, name: 'stackingbar1003D', title: 'stackingbar1003D' },
        //{ id: 28, name: 'pie3D', title: 'pie3D' },
        //{ id: 29, name: 'doughnut3D', title: 'doughnut3D' }
    }];

    //var listView = Mn.CollectionView.extend({

    //    tagName: 'ul',

    //    childView: Mn.View.extend({

    //        tagName: 'li',

    //        template: _.template('<input data-id="<%- title %>"  id="<%- prefix + "_" + title %>" name="<%- prefix + "_chartView" %>" class="g-form--radio gallery <%- title %>" type="radio" /><label for="<%- prefix + "_" + title %>" title="<%- name %>"></label>'),

    //        triggers: {
    //            'click label': {
    //                event: 'choose:type:chart',
    //                preventDefault: false
    //            }
    //        },

    //        onRender: function () {
    //            this.$el.addClass('gallery_' + this.model.get('title'));
    //            if (this.model.get('checked'))
    //                this.$('input').attr('checked', 'checked');
    //        }
    //    }),

    //    childViewOptions: function (m) {
    //        m.set({
    //            'checked': m.get('title') === (this.options.Visualization || "bar"),
    //            prefix: this.options.prefix
    //        });
    //    },

    //    onRender: function () {
    //        this.$el.width(this.collection.length * 245);
    //    },

    //    childViewTriggers: {
    //        'choose:type:chart': 'choose:type:chart'
    //    }
    //});

    var formView = Mn.View.extend({

        behaviors: {
            input: inputBehavior
        },

        template: '#visual-settings-template',
        templateContext: {
            Resources: Resources
        },

        ui: {
            colw: '#columnWidth',
            cols: '#columnSpacing',
            psize: '#pieSize'
        },

        regions: {
            legendPosition: { el: '#legendPosition', replaceElement: true },
            axesXlabelAction: { el: '#axesXlabelAction', replaceElement: true }
        },

        events: {

            'change @ui.colw': function changeUiColw() {

                this.ui.colw.next('label').find('span').text(this.ui.colw.val());
            },

            'change @ui.cols': function changeUiCols() {

                this.ui.cols.next('label').find('span').text(this.ui.cols.val());
            },

            'change @ui.psize': function changeUiPsize() {

                this.ui.psize.next('label').find('span').text(this.ui.psize.val());
            }
        },

        onRender: function onRender() {

            this.showChildView('legendPosition', new dropDown({
                collection: new Backbone.Collection([{ id: 'Left', title: Resources.vs33left }, { id: 'Top', title: Resources.vs33top }, { id: 'Right', title: Resources.vs33right }, { id: 'Bottom', title: Resources.vs33bottom }])
            }));

            this.getChildView('legendPosition').setCurrent(this.model.get('legendPosition')).$el.css('display', 'block');

            if (this.model.get('chart') !== 'pie') {
                this.showChildView('axesXlabelAction', new dropDown({
                    collection: new Backbone.Collection([{ id: 'none', title: 'None - ' + Resources.lpa1 }, { id: 'rotate90', title: 'Rotate 90 - ' + Resources.lpa2 }, { id: 'rotate45', title: 'Rotate 45 - ' + Resources.lpa3 }, { id: 'wrap', title: 'Wrap - ' + Resources.lpa4 }, { id: 'wrapByWord', title: 'Wrap by word - ' + Resources.lpa5 }, { id: 'trim', title: 'Trim - ' + Resources.lpa6 }, { id: 'hide', title: 'Hide - ' + Resources.lpa7 }, { id: 'multipleRows', title: 'MultipleRows - ' + Resources.lpa8 }])
                }));

                this.getChildView('axesXlabelAction').setCurrent(this.model.get('primaryXAxislabelIntrsectAction')).$el.css('display', 'block');
            }

            this.$('#' + this.model.get('prefix') + '_legendBorderColor').ejColorPicker({
                locale: Resources.Lang,
                modelType: "palette",
                presetType: "webcolors",
                enableOpacity: false
            });
        },

        modelEvents: {

            'change:chart': function changeChart() {
                this.render();
            }

        }

    });

    return Mn.View.extend({

        template: _.template('<h3 class="link" id="change-face"><%- Resources.ctd %></h3><br/><div class="face-choose" style="display:none;"></div><div class="face-form"><div class="form"></div><h3><%- Resources.vs8 %></h3><div id="color-settings"></div></div>'),
        templateContext: {
            Resources: Resources
        },

        ui: {
            face: '#change-face',
            choose: '.face-choose',
            form: '.face-form'
        },

        regions: {
            //list: '.charts-gallery',
            form: { el: '.form', replaceElement: true },
            color: { el: '#color-settings', replaceElement: true },
            face: '.face-choose'
        },

        events: {

            'click @ui.face': function clickUiFace() {

                if (this.ui.choose.is(":hidden")) {

                    this.ui.face.text(Resources.back);
                    this.ui.form.hide();
                    this.ui.choose.show();

                    if (!this.getRegion('face').hasView()) {
                        this.showChildView('face', new visualView({ model: this.model, ruleCode: 'any' }));
                        this.getChildView('face').$el.removeClass('show').addClass('visualisation');
                    }
                } else {

                    this.ui.face.text(Resources.ctd);
                    this.ui.form.show();
                    this.ui.choose.hide();
                }
            }
        },

        onRender: function onRender() {

            var p = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: this.model.get('typeName') + ".GhaphSubSettings" });

            var model = new subSettings();
            if (p) model.set(p.WidgetParamValue);

            model.set({
                prefix: this.model.id,
                chart: this.model.get("Visualization")
            });

            this.showChildView('form', new formView({ model: model }));

            this.showChildView('color', new colorRow({ model: this.model, collection: this.collection }));
        },

        onShow: function onShow() {},

        childViewEvents: {

            'chart:selected': function chartSelected(v) {

                var name = v.model.get('type');
                this.model.set("Visualization", name);
                this.getChildView('form').model.set('chart', name);
            }
        },

        onSave: function onSave() {

            var data = $.GetData(this.$el);

            if (this.getChildView('form').getRegion('axesXlabelAction').hasView()) data.primaryXAxislabelIntrsectAction = this.getChildView('form').getChildView('axesXlabelAction').current.id;

            data.legendPosition = this.getChildView('form').getChildView('legendPosition').current.id;

            var ch = Backbone.Radio.channel('chW'),
                p1 = ch.request('get:param:model', this.model.get('Characteristics'), "WidgetGraph.GhaphSubSettings"),
                p2 = ch.request('get:param:model', this.model.get('Characteristics'), 'PaletteByChart');

            p1.set('WidgetParamValue', data);
            p2.set('WidgetParamValue', this.getChildView('color').getChildView('list').collection.toJSON());

            var saveCollection = Backbone.Radio.channel('chW').request('get:params:collection', this.model.id);
            saveCollection.add([p1, p2]);

            saveCollection.fetch({
                success: function (m) {
                    this.model.save({ Characteristics: m.toJSON() });
                }.bind(this)
            });
        }
    });
});
'use strict';

define('settings.visualization.cloud', ['i18n!nls/resources.min', 'settings.colorRow', 'global.view.dropDown', 'global.behaviors.input'], function (Resources, colorRow, dropDown, inputBehavior) {

        var formView = Mn.View.extend({

                behaviors: {
                        input: inputBehavior
                },

                template: '#cloud-form-template',
                templateContext: {
                        Resources: Resources
                },

                regions: {
                        shape: { el: '#cloud-shape', replaceElement: true }
                },

                onBeforeRender: function onBeforeRender() {

                        if (!this.model.has('shapeCloud')) this.model.set('shapeCloud', 'elliptic');
                },

                onRender: function onRender() {

                        this.showChildView('shape', new dropDown({
                                collection: new Backbone.Collection([{ id: 'elliptic', title: Resources.cse }, { id: 'rectangular', title: Resources.csr }])
                        }));

                        this.getChildView('shape').setCurrent(this.model.get('shapeCloud')).$el.css('display', 'block');
                }

        });

        return Mn.View.extend({

                template: '#cloud-settings-template',

                regions: {
                        color: { el: '#color-rows', replaceElement: true },
                        form: { el: '#form-settings', replaceElement: true }
                },

                onRender: function onRender() {

                        var p = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: "WidgetCloud.SubSettings" }) || {},
                            m = new Backbone.Model({
                                minFontSizeCloud: 10,
                                maxFontSizeCloud: null,
                                shapeCloud: 'elliptic'
                        });

                        if (p) m.set(p.WidgetParamValue);

                        this.showChildView('form', new formView({ model: m }));

                        this.showChildView('color', new colorRow({ model: this.model, collection: this.collection }));
                },

                collectionEvents: {

                        reset: function reset() {
                                this.onReset();
                        }

                },

                onSave: function onSave() {

                        var ch = Backbone.Radio.channel('chW'),
                            p1 = ch.request('get:param:model', this.model.get('Characteristics'), "WidgetCloud.SubSettings"),
                            p2 = ch.request('get:param:model', this.model.get('Characteristics'), 'PaletteByChart');

                        var formData = $.GetData(this.getChildView('form').$el);
                        formData.shapeCloud = this.getChildView('form').getChildView('shape').current.id;

                        p1.set('WidgetParamValue', formData);
                        p2.set('WidgetParamValue', this.getChildView('color').getChildView('list').collection.toJSON());

                        var saveCollection = Backbone.Radio.channel('chW').request('get:params:collection', this.model.id);
                        saveCollection.add([p1, p2]);

                        saveCollection.fetch({
                                success: function (m) {
                                        this.model.save({ Characteristics: m.toJSON() });
                                }.bind(this)
                        });
                },

                onReset: function onReset() {

                        var p = _.findWhere(this.model.get('Characteristics'), { WidgetParamName: 'PaletteByChart' });

                        if (p) _.each(p.WidgetParamValue, function (o) {
                                var e = this.collection.findWhere({ object_id: o.object_id });
                                if (e) e.set('color', o.color);
                        }, this);
                }

        });
});
'use strict';

define('settings.visualisation.table.column', ['i18n!nls/resources.min'], function (Resources) {

        var columnsCollection = Backbone.Collection.extend({
                model: Backbone.Model.extend({
                        idAttribute: "ColumnSystemName",
                        defaults: {
                                QueryCustomizationUID: null,
                                QueryID: 0,
                                ColumnSystemName: null,
                                ColumnTitle: "",
                                ColumnWidth: null,
                                ColumnIsVisible: true,
                                SerialNum: ''
                        }
                })
        });

        return Mn.CollectionView.extend({

                className: 'list-area',

                events: {

                        'click': function click(e) {
                                e.stopPropagation();
                        }
                },

                childView: Mn.View.extend({

                        className: 'row',
                        template: '#column-settings-template',
                        templateContext: {
                                Resources: Resources
                        },

                        onRender: function onRender() {
                                this.$el.attr('id', this.model.id);
                        }

                }),

                childViewOptions: function childViewOptions(m) {

                        m.set({
                                QueryID: this.model.get("requestParameters").rid,
                                prefix: this.model.id
                        });
                },

                initialize: function initialize(o) {

                        this.collection = new columnsCollection();
                        this.collection.comparator = "SerialNum";
                },

                onBeforeRender: function onBeforeRender() {

                        var items = this.model.has('feed') ? this.model.get('feed').head : [],
                            rid = this.model.get("requestParameters") ? this.model.get("requestParameters").rid : null,
                            custom = this.model.get("ColumnCustomizations");

                        var columns = _.map(items, function (e, i) {

                                var ci = {};
                                if (custom) {
                                        ci = _.findWhere(custom, { ColumnSystemName: e.systemName }) || {};
                                }

                                return new this.collection.model({
                                        QueryCustomizationUID: ci.QueryCustomizationUID || null,
                                        QueryID: rid,
                                        ColumnSystemName: e.systemName,
                                        ColumnTitle: ci.ColumnTitle || e.displayName,
                                        ColumnIsVisible: ci.ColumnIsVisible === undefined ? e.isVisible : ci.ColumnIsVisible,
                                        SerialNum: ci.SerialNum || i,
                                        ColumnWidth: ci.ColumnWidth || ''
                                });
                        }, this);

                        this.collection.set(columns);
                },

                onAddChild: function onAddChild() {

                        this.$el.sortable({
                                items: '.row',
                                axis: "y",
                                stop: function (e, ui) {

                                        this.$(".row").each(function (i, e) {

                                                var $e = $(e),
                                                    m = this.collection.get($e.attr('id'));

                                                m.set("SerialNum", $e.index());
                                                $e.find('input[name=SerialNum]').val($e.index());
                                        }.bind(this));
                                }.bind(this)

                        });
                },

                onSave: function onSave(callback) {

                        var data = [];
                        this.$('.row').each(function () {
                                data.push($.GetData($(this)));
                        });

                        $.ajax({

                                method: "POST",
                                contentType: 'application/json; charset=utf-8',
                                url: "/api/widget/" + this.model.get("requestParameters").rid + "/colscustomization",
                                data: JSON.stringify(data)

                        }).done(function (c) {

                                callback.call(this, c);
                        }.bind(this));
                },

                onReset: function onReset(callback) {

                        this.collection.reset();

                        $.get("/api/widget/" + this.model.get("requestParameters").rid + "/colscustomization/flush").done(function (c) {

                                callback.call(this);
                        }.bind(this));
                }

        });
});
'use strict';

define('settings.visualisation.table.fields', [], function () {

        return Mn.View.extend({

                template: _.template('<img  class = "card-example" src = "" />'),
                //if(card) {src = '../../Images/vertical_card.png'}
                //if(card2) {src = '../../Images/horizontal_card.png'}

                onRender: function onRender() {

                        this.$el.addClass('container-example');

                        if (this.model.get('Visualization') === 'card') this.$('img').attr('src', '../../Images/vertical_card.png');else this.$('img').attr('src', '../../Images/horizontal_card.png');
                },

                onSave: function onSave(callback) {

                        callback.call(this);
                }
        });
});
'use strict';

define('settings.visualization.table', ['i18n!nls/resources.min', 'settings.visualisation.table.column', 'settings.visualisation.table.fields', 'global.behaviors.input'], function (Resources, columnsOrg, fieldOrg, input) {

            var content = {
                        table: columnsOrg,
                        card: fieldOrg,
                        card2: fieldOrg
            };

            return Mn.View.extend({

                        behaviors: [input],

                        template: '#table-visualisation-template',
                        templateContext: function templateContext() {
                                    return {
                                                Resources: Resources,
                                                prefix: this.model.id
                                    };
                        },

                        regions: {
                                    content: { el: '#content', replaceElement: true }
                        },

                        events: {

                                    'click input': function clickInput(m, v) {

                                                var name = this.$('input[name="Visualization"]:checked').attr('id').split('_')[1];

                                                this.model.set('Visualization', name);

                                                this.getRegion('content').show(new content[name]({ model: this.model }));
                                    }

                        },

                        onShow: function onShow() {

                                    var name = this.model.get('Visualization') || 'table';
                                    this.$('#' + this.model.id + '_' + name).prop('checked', true);

                                    this.getRegion('content').show(new content[name]({ model: this.model }));
                        },

                        onSave: function onSave() {

                                    this.getChildView('content').onSave(function (c) {

                                                this.model.save({ ColumnCustomizations: c });
                                    });
                        },

                        onReset: function onReset() {

                                    this.getChildView('content').onReset(function () {

                                                this.model.set("ColumnCustomizations", null);
                                    });
                        },

                        modelEvents: {

                                    'change:feed': function changeFeed(m, feed) {

                                                var name = this.model.get('Visualization') || 'table';
                                                this.getRegion('content').show(new content[name]({ model: this.model }));
                                    }
                        }

            });
});
'use strict';

define('settings.visualization.semnet', ['i18n!nls/resources.min', 'global.view.dropDown'], function (Resources, DropDownView) {

    return Mn.View.extend({

        template: '#semnet-settings-template',
        templateContext: {
            Resources: Resources
        },

        regions: {
            ddlevel: '#level',
            ddtree: '#astree',
            ddlayout: '#layout'
        },

        onRender: function onRender() {

            this.showChildView('ddlayout', new DropDownView({
                collection: new Backbone.Collection([{ title: Resources.snl1, id: 0 }, { title: Resources.snl2, id: 1 }, { title: Resources.snl3, id: 2 }, { title: Resources.snl4, id: 3 }, { title: Resources.snl5, id: 4 }, { title: Resources.snl6, id: 5 }, { title: Resources.snl7, id: 6 }]),
                current: this.model.get('layout'), name: 'layout'
            }));

            this.showChildView('ddtree', new DropDownView({
                collection: new Backbone.Collection([{ title: Resources.ss1, id: 0 }, { title: Resources.ss2, id: 1 }, { title: Resources.ss3, id: 2 }]),
                current: this.model.get('astree'), name: 'astree'
            }));

            this.showChildView('ddlevel', new DropDownView({
                collection: new Backbone.Collection([{ title: 'level 1', id: 1 }, { title: 'level 2', id: 2 }, { title: 'level 3', id: 3 }]),
                current: this.model.get('level'), name: 'level'
            }));

            if (this.model.has('SNLevel')) this.getChildView('ddlevel').setCurrent(this.model.get('SNLevel'));

            if (this.model.has('SNLayout')) this.getChildView('ddlayout').setCurrent(this.model.get('SNLayout'));

            if (this.model.has('SNStruct')) this.getChildView('ddtree').setCurrent(this.model.get('SNStruct'));
        },

        onSave: function onSave() {

            this.model.set($.GetData(this.$el));

            this.model.save({
                SNLevel: this.getChildView('ddlevel').current.id,
                SNLayout: this.getChildView('ddlayout').current.id,
                SNStruct: this.getChildView('ddtree').current.id
            });
        },

        onReset: function onReset() {}

    });
});
'use strict';

define('widgetTableCard', ['i18n!nls/resources.min'], function (Resources) {

    var list = Mn.CollectionView.extend({

        className: 'card-newsblock',

        childView: Mn.View.extend({

            tagName: 'article',

            className: 'card-vertical',

            ///*getTemplate: function () {*/
            //    return '#card-vertical-view-template';
            //},
            getTemplate: function getTemplate() {
                if (this.options.vis === 'card2') {
                    return '#card-horizontal-view-template';
                }

                return '#card-vertical-view-template';
            },

            templateContext: {
                Resources: Resources
            },

            events: {

                'click a': function clickA(e) {
                    e.stopPropagation();
                }

            },

            triggers: {
                'touchstart': 'table:row:handler',
                'click': 'table:row:handler'
            },

            onBeforeRender: function onBeforeRender() {

                if (this.options.vis === 'card2') this.$el.removeClass('card-vertical').addClass('card-horizontal');

                var item = this.model.toJSON(),
                    pdate = Date.parse(item.дата_публикации) ? new Date(item.дата_публикации).toLocaleString(Resources.Lang) : '';

                this.model.set({
                    display_name: this.model.get('display_name') || '',
                    image: item.image || '',
                    url: item.url_источника || '',
                    pdate: pdate,
                    annotation: item.аннотация,
                    massmedia: item.massmedia,
                    rubrics: ''
                });

                if (this.model.has('links')) {

                    var a = _.groupBy(this.model.get('links'), 'rel');

                    if (_.has(a, 'rubric_id')) {
                        var vs = _.pluck(a.rubric_id, 'value');
                        this.model.set('rubrics', vs.join(' | '));
                    }

                    if (_.has(a, 'url_источника')) {
                        var href = a.url_источника[0].href;
                        this.model.set({ url: href, massmedia: this.model.get('massmedia') ? this.model.get('massmedia') : href });
                    }
                }
            }
        }),

        onBeforeRender: function onBeforeRender() {
            if (this.options.vis === 'card2') this.$el.addClass('horizontal');
        },

        childViewOptions: function childViewOptions() {
            return {
                vis: this.options.vis
            };
        },

        childViewTriggers: {
            'table:row:handler': 'table:row:handler'
        }

    });

    return Mn.View.extend({

        template: _.template('<div></div>'),
        templateContext: {
            Resources: Resources
        },

        regions: {
            list: { el: 'div', replaceElement: true }
        },

        onRender: function onRender() {

            this.showChildView('list', new list({ collection: this.collection, vis: this.model.get('Visualization') }));
        },

        onChildviewTableRowHandler: function onChildviewTableRowHandler(v) {

            this.model.trigger('click:item', v.model);
        }

    });
});
'use strict';

define('widget.table.filter', ['i18n!nls/resources.min'], function (Resources) {

        var listRubrics = Mn.CollectionView.extend({

                emptyView: Mn.View.extend({
                        template: _.template('<p><%- Resources.norubric %></p>'),
                        templateContext: { Resources: Resources }
                }),

                childView: Mn.View.extend({

                        tagName: 'span',
                        className: 'g-form--input',

                        template: _.template('<input class="g-form--checkbox" type="checkbox" checked id="<%- value %>" name="<%- value %>" /><label for="<%- value %>"><%- value %></label>'),

                        ui: {
                                chbx: 'input'
                        },

                        triggers: {
                                'click': {
                                        event: 'click:item',
                                        preventDefault: false,
                                        stopPropagation: false
                                }
                        }
                }),

                childViewTriggers: {
                        'click:item': 'filter:apply'
                }
        });

        return Mn.View.extend({

                className: 'filter-panel anbr-tabs',

                template: templates['filter-panel'],
                templateContext: { Resources: Resources },

                ui: {
                        input: 'input[name="searchInWidget"]',
                        rTab: 'span[data-name="rubrics-panel"]',
                        sTab: 'span[data-name="search-panel"]',
                        rPan: '#rubrics-panel',
                        sPan: '#search-panel'
                },

                regions: {
                        list: '.list-area'
                },

                initialize: function initialize() {
                        this.collection = new Backbone.Collection();
                },

                onRender: function onRender() {

                        this.showChildView('list', new listRubrics({ collection: this.collection }));
                },

                childViewEvents: {

                        'filter:apply': function filterApply(v) {

                                v.model.set("hide", !v.ui.chbx.prop('checked'));
                        }

                },

                childViewTriggers: {

                        'filter:apply': 'filter:apply'
                },

                events: {

                        "click nav span:not(.right)": function clickNavSpanNotRight(e) {

                                var $p = $(e.target).closest("span");
                                this.$("nav span").removeClass("active");
                                this.$("section").hide();

                                $p.addClass("active");
                                this.$("section#" + $p.attr("data-name")).show();
                        },

                        "click nav span.right": function clickNavSpanRight() {

                                this.$el.slideToggle();
                        },

                        "click button.search": function clickButtonSearch() {

                                var val = this.ui.input.val();
                                if ($.trim(val)) this.triggerMethod("filter:search", val);else this.triggerMethod("filter:apply");
                        },

                        'click button.cancel': function clickButtonCancel() {

                                this.ui.input.val('');

                                this.triggerMethod("filter:apply");

                                this.$el.slideToggle();
                        }
                },

                hideRubrics: function hideRubrics() {

                        this.ui.rTab.hide();
                        this.ui.rPan.hide();
                        this.ui.sTab.addClass('active');
                        this.ui.sPan.show();
                },

                showRubrics: function showRubrics() {

                        this.ui.rTab.addClass('active');
                        this.ui.rPan.show();
                }

        });
});
'use strict';

define('widgetTableGrid', ['i18n!nls/resources.min', 'widget.table.filter'], function (Resources, filterView) {

    var toolsView = Mn.CollectionView.extend({

        className: 'tools',

        events: {

            'mouseleave': function mouseleave() {
                this.$el.hide();
            }
        },

        childView: Mn.View.extend({

            tagName: 'span',
            className: 'btn',

            events: {

                'mouseenter svg': function mouseenterSvg() {
                    this.$el.find(".anbr-tooltip").fadeIn();
                },

                'mouseleave svg': function mouseleaveSvg() {
                    this.$el.find(".anbr-tooltip").fadeOut();
                }
            },

            triggers: {
                'touchstart': 'action',
                'click': 'action'
            },

            onAction: function onAction(e) {

                if (this.model.get('render') === "action") $.ajax({ method: this.model.get('verb'), url: this.model.get('href') }).done(function () {
                    Backbone.trigger("message:success", { title: Resources.alert, message: Resources.success });
                }).fail(function (m) {
                    Backbone.trigger("message:warning", { title: Resources.error, message: m.status });
                });
            },

            getTemplate: function getTemplate() {
                if (this.model.get('render') === 'open') return _.template('<a href="<%- href %>" target="_blank"><span class="anbr-tooltip"><span position="bottom"></span><%- prompt %></span><svg class="svg-icon"><use xlink:href="#<%- id %>" /></svg></a>');else return _.template('<span class="anbr-tooltip"><span position="bottom"></span><%- prompt %></span><svg class="svg-icon"><use xlink:href="#<%- id %>" /></svg>');
            }
        }),

        onRenderChildren: function onRenderChildren() {
            this.$el.width(this.collection.length * 52).delay(100).slideDown();
        }
    });

    var toolsTableView = Mn.View.extend({

        className: 'preblu',
        template: _.template('<div class="arrow"></div><div class="tools"></div>'),

        regions: {
            tools: { el: '.tools', replaceElement: true }
        },

        triggers: {
            'touchstart': 'prepare',
            'click': 'prepare'
        },

        onPrepare: function onPrepare() {

            var data = _.groupBy(this.model.get('links'), 'rel').tools || [];
            this.showChildView('tools', new toolsView({ collection: new Backbone.Collection(data) }));
        },

        show: function show(v) {
            this.model = v.model;
            this.$el.css("top", v.$el.position().top + v.$el.outerHeight() / 2 - 10);
            this.$el.show();
        }
    });

    var rowView = Mn.View.extend({

        tagName: 'tr',

        getTemplate: function getTemplate() {
            return _.template(this.options.templ);
        },
        templateContext: function templateContext() {
            return {
                parse: this.parseType
            };
        },

        events: {

            'click a': function clickA(e) {
                e.stopPropagation();
            },
            'touchstart a': function touchstartA(e) {
                e.stopPropagation();
            }
        },

        triggers: {
            'mouseenter': 'mouse:enter:row',
            'mouseleave': 'mouse:leave:row',

            'touchstart': 'table:row:handler',
            'click': 'table:row:handler'
        },

        onRender: function onRender() {

            if (this.model.has('links')) {

                var a = _.groupBy(this.model.get('links'), 'rel');

                if (_.has(a, 'rubric_id')) {
                    this.$('td[data-column="display_name"]').append('<div class="rubrics"></div>');
                    var vs = _.pluck(a.rubric_id, 'value');
                    this.$('.rubrics').append(vs.join('; '));
                }

                if (_.has(a, 'url_источника')) {
                    _.chain(a['url_источника']).map(function (o) {
                        this.$('td[data-column="display_name"]').append('<a title="' + o.prompt + '" href="' + o.href + '" target="_blank">\n\t\t\t\t\t\t\t\t<span><svg class="link-icon"><use xlink: href="#link-icon" /></svg></span>\n\t\t\t\t\t\t\t</a>');
                    }, this);
                }
            }
        },

        parseType: function parseType(value, s) {
            if (!s) return '';
            var output;
            switch (s) {
                case 0:
                    //целочисленный
                    output = parseInt(value);
                    break;
                case 2:
                    // date-time
                    output = $.parseDate(value);
                    break;
                case 4:
                    // вещественный
                    output = parseFloat(value);
                    break;
                case 7: // image                   
                case 1: // string
                case 3: // dictionary
                case 5: // file name
                case 6: // text              
                case 8: // html
                case 9: // giperlink
                case 10: // data
                case 11: // OLE document
                case 12: // uid
                case 13: // VarBinary
                case 14: // двоичный файл
                case 15: // денежный
                case 16: // bool
                case 17:
                    // geo coordinates
                    output = "<span>" + value + "</span>";
            }

            return output;
        }

    });

    var bodyView = Mn.CollectionView.extend({

        tagName: 'tbody',

        childView: rowView,

        childViewOptions: function childViewOptions() {
            return {
                templ: this.options.templ,
                cols: this.options.cols
            };
        },

        emptyView: Mn.View.extend({
            tagName: 'tr',
            template: _.template('<td colspan="<%- colspan %>"><%- Resources.N %></td>'),
            templateContext: function templateContext() {
                return {
                    Resources: Resources,
                    colspan: this.options.cols
                };
            }
        }),

        onChildviewTableRowHandler: function onChildviewTableRowHandler(v) {

            var currentTr = this.$el.find('tr.current'),
                flag = this.options.isMarkSelectedItem;

            currentTr.removeClass('current').addClass('viewed');

            currentTr.find('td').each(function (i, e) {
                $(e).css({
                    color: flag ? this.options.decoration.ContainerForegroundVisited : this.options.decoration.ContainerForeground,
                    'background-color': flag ? this.options.decoration.ContainerBackgroundVisited : this.options.decoration.ContainerBackground
                });
            }.bind(this));

            v.$el.addClass('current').removeClass("new-post");

            v.$el.find('td').each(function (i, e) {
                $(e).css({
                    color: this.options.decoration.ContainerForegroundActive,
                    'background-color': this.options.decoration.ContainerBackgroundActive
                });
            }.bind(this));
        },

        childViewTriggers: {
            'mouse:enter:row': 'mouse:enter:row',
            'mouse:leave:row': 'mouse:leave:row',
            'table:row:handler': 'table:row:handler'
        }
    });

    var headView = Mn.CollectionView.extend({
        tagName: 'tr',
        childView: Mn.View.extend({
            tagName: 'th',
            template: _.template('<%- displayName %>')
        })
    });

    var tableView = Mn.View.extend({

        tagName: 'table',

        className: 'widget-table',

        template: _.template('<thead></thead><tbody></tbody><tfoot></tfoot>'),

        regions: {
            head: 'thead',
            body: { el: 'tbody', replaceElement: true }
        },

        initialize: function initialize() {

            this.templ = '';

            var columns = this.model.get('ColumnCustomizations');
            if (columns) {

                this.options.head = _.chain(columns).filter(function (e) {
                    return e.ColumnIsVisible;
                }).sortBy(function (e) {
                    return e.SerialNum;
                }).map(function (e) {

                    this.templ += '<td data-column="' + e.ColumnSystemName.toLowerCase() + '"><%= parse(' + e.ColumnSystemName.toLowerCase() + ', propType["' + e.ColumnSystemName.toLowerCase() + '"]) %></td>';

                    return { displayName: e.ColumnTitle };
                }, this).value();
            } else _.each(this.options.head, function (o) {

                this.templ += '<td data-column="' + o.systemName + '"><%= parse(' + o.systemName + ', propType["' + o.systemName + '"]) %></td>';
            }, this);
        },

        onRender: function onRender() {

            this.$el.css({ width: "100%", "table-layout": "auto" });
            this.$el.attr('dir', 'auto');

            //if (this.model.get('ts')) {

            //var items = $.prepare(this.options.feed.get('items'));

            //_.each(feed.data, function (a) {
            //    var id = _.findWhere(a.data, { systemName: "Object_ID" }).value;
            //    if (!_.find(items, function (b) { return id === b.Object_ID; }))
            //        this.feedItems.push(a);
            //}, this);

            //if (this.feedItems.length) {
            //    this.$(".number-update").css("display", "inline-block").text(this.feedItems.length);
            //    this.model.set("Items", this.model.get("Items").concat(this.feedItems));
            //}

            //} else {

            this.showChildView('head', new headView({ collection: new Backbone.Collection(this.options.head) }));

            this.showChildView('body', new bodyView({
                collection: this.collection,
                templ: this.templ,
                cols: this.options.head.length,
                isMarkSelectedItem: this.model.get('isMarkSelectedItem'),
                decoration: this.model.get('Decoration')
            }));

            //}
        },

        onAttach: function onAttach() {

            this.$('tbody').height(this.$el.closest('.anbr_list').height() - this.$('thead').height());
        },

        modelEvents: {

            'change:width': function changeWidth() {
                this.$('tbody').height(this.$el.closest('.anbr_list').height() - this.$('thead').height());
            },

            'change:height': function changeHeight() {
                this.$('tbody').height(this.$el.closest('.anbr_list').height() - this.$('thead').height());
            }

        },

        onChildviewTableRowHandler: function onChildviewTableRowHandler(v) {

            this.model.trigger('click:item', v.model);
        },

        childViewTriggers: {
            'mouse:enter:row': 'mouse:enter:row',
            'mouse:leave:row': 'mouse:leave:row',
            'table:row:handler': 'table:row:handler'
        }

    });

    return Mn.View.extend({

        template: _.template('<div class="filter-panel"></div><span class="number-update"></span><div class="preblu"></div><table></table>'),

        ui: {
            update: '.number-update'
        },

        regions: {
            filter: { el: '.filter-panel', replaceElement: true },
            toolsTable: { el: '.preblu', replaceElement: true },
            table: { el: 'table', replaceElement: true }
        },

        onRender: function onRender() {

            // 21.09.2017 временно скрыто
            //this.showChildView('toolsTable', new toolsTableView);

            this.showChildView('filter', new filterView({ model: this.model }));

            this.showChildView('table', new tableView({
                model: this.model,
                collection: this.collection,
                head: _.filter(this.model.get('feed').head, function (o) {
                    return o.isVisible;
                })
            }));

            var c = [];

            this.collection.each(function (m) {

                var rels = _.groupBy(m.get('links'), "rel");

                _.each(rels.rubric_id, function (a) {
                    c.push(a);
                }, this);
            }, this);

            this.getChildView('filter').collection.add(c);

            if (c.length) this.getChildView('filter').showRubrics();else this.getChildView('filter').hideRubrics();
        },

        onAttach: function onAttach() {

            this.getChildView('table').getChildView('body').$el.on('scroll', function (e) {

                this.triggerMethod('scroll:grid');
            }.bind(this));
        },

        collectionEvents: {

            update: function update(c, a) {

                if (a.add) {

                    var c = [];

                    _.each(a.changes.added, function (m) {

                        var rels = _.groupBy(m.get('links'), "rel");

                        _.each(rels.rubric_id, function (a) {
                            c.push(a);
                        }, this);
                    }, this);

                    this.triggerMethod('table:add:rubrics:filter', c);
                }
            }

        },

        childViewEvents: {

            'mouse:enter:row': function mouseEnterRow(v) {
                //this.getChildView('toolsTable').show(v);
            },

            'mouse:leave:row': function mouseLeaveRow(v) {
                //this.getChildView('toolsTable').hide(v);
            },

            'table:row:handler': function tableRowHandler(v) {

                //this.triggerMethod( 'check:child', this.model, v.model );

            },

            'filter:search': function filterSearch(text) {

                this.$("tbody>tr>td[data-column='display_name'] .Mark").removeClass("Mark");

                var s = new RegExp(text, "ig");

                this.$("tbody>tr").each(function (i, e) {

                    var $a = $(e).find("td[data-column='display_name']"),
                        check = $a.html(),
                        searchIndex = check.search(s);

                    if (searchIndex === -1) $(e).hide();else {

                        var p = '<i class="Mark">' + check.match(s)[0] + '</i>',
                            start = check.substring(0, searchIndex),
                            end = check.substring(searchIndex + text.length),
                            out = start + p + end;

                        $a.html(out);
                        $(e).show();
                    }
                });
            },

            'filter:apply': function filterApply() {

                this.getChildView('table').getChildView('body').children.each(function (v) {

                    v.$el.show();

                    var a = _.groupBy(v.model.get('links'), 'rel');

                    var rubs = a.rubric_id;
                    if (rubs) {

                        _.each(rubs, function (r) {

                            var ex = this.getChildView('filter').collection.get(r.id);
                            if (ex.get('hide')) v.$el.hide();
                        }, this);
                    }
                }, this);

                this.$("tbody>tr>td[data-column='display_name'] .Mark").removeClass("Mark");
            }
        }
    });
});
"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/*
* jQuery Form Plugin; v20130523
* http://jquery.malsup.com/form/
* Copyright (c) 2013 M. Alsup; Dual licensed: MIT/GPL
* https://github.com/malsup/form#copyright-and-license
*/
;(function (e) {
  "use strict";
  function t(t) {
    var r = t.data;t.isDefaultPrevented() || (t.preventDefault(), e(this).ajaxSubmit(r));
  }function r(t) {
    var r = t.target,
        a = e(r);if (!a.is("[type=submit],[type=image]")) {
      var n = a.closest("[type=submit]");if (0 === n.length) return;r = n[0];
    }var i = this;if (i.clk = r, "image" == r.type) if (void 0 !== t.offsetX) i.clk_x = t.offsetX, i.clk_y = t.offsetY;else if ("function" == typeof e.fn.offset) {
      var o = a.offset();i.clk_x = t.pageX - o.left, i.clk_y = t.pageY - o.top;
    } else i.clk_x = t.pageX - r.offsetLeft, i.clk_y = t.pageY - r.offsetTop;setTimeout(function () {
      i.clk = i.clk_x = i.clk_y = null;
    }, 100);
  }function a() {
    if (e.fn.ajaxSubmit.debug) {
      var t = "[jquery.form] " + Array.prototype.join.call(arguments, "");window.console && window.console.log ? window.console.log(t) : window.opera && window.opera.postError && window.opera.postError(t);
    }
  }var n = {};n.fileapi = void 0 !== e("<input type='file'/>").get(0).files, n.formdata = void 0 !== window.FormData;var i = !!e.fn.prop;e.fn.attr2 = function () {
    if (!i) return this.attr.apply(this, arguments);var e = this.prop.apply(this, arguments);return e && e.jquery || "string" == typeof e ? e : this.attr.apply(this, arguments);
  }, e.fn.ajaxSubmit = function (t) {
    function r(r) {
      var a,
          n,
          i = e.param(r, t.traditional).split("&"),
          o = i.length,
          s = [];for (a = 0; o > a; a++) {
        i[a] = i[a].replace(/\+/g, " "), n = i[a].split("="), s.push([decodeURIComponent(n[0]), decodeURIComponent(n[1])]);
      }return s;
    }function o(a) {
      for (var n = new FormData(), i = 0; a.length > i; i++) {
        n.append(a[i].name, a[i].value);
      }if (t.extraData) {
        var o = r(t.extraData);for (i = 0; o.length > i; i++) {
          o[i] && n.append(o[i][0], o[i][1]);
        }
      }t.data = null;var s = e.extend(!0, {}, e.ajaxSettings, t, { contentType: !1, processData: !1, cache: !1, type: u || "POST" });t.uploadProgress && (s.xhr = function () {
        var e = jQuery.ajaxSettings.xhr();return e.upload && e.upload.addEventListener("progress", function (e) {
          var r = 0,
              a = e.loaded || e.position,
              n = e.total;e.lengthComputable && (r = Math.ceil(100 * (a / n))), t.uploadProgress(e, a, n, r);
        }, !1), e;
      }), s.data = null;var l = s.beforeSend;return s.beforeSend = function (e, t) {
        t.data = n, l && l.call(this, e, t);
      }, e.ajax(s);
    }function s(r) {
      function n(e) {
        var t = null;try {
          e.contentWindow && (t = e.contentWindow.document);
        } catch (r) {
          a("cannot get iframe.contentWindow document: " + r);
        }if (t) return t;try {
          t = e.contentDocument ? e.contentDocument : e.document;
        } catch (r) {
          a("cannot get iframe.contentDocument: " + r), t = e.document;
        }return t;
      }function o() {
        function t() {
          try {
            var e = n(g).readyState;a("state = " + e), e && "uninitialized" == e.toLowerCase() && setTimeout(t, 50);
          } catch (r) {
            a("Server abort: ", r, " (", r.name, ")"), s(D), j && clearTimeout(j), j = void 0;
          }
        }var r = f.attr2("target"),
            i = f.attr2("action");w.setAttribute("target", d), u || w.setAttribute("method", "POST"), i != m.url && w.setAttribute("action", m.url), m.skipEncodingOverride || u && !/post/i.test(u) || f.attr({ encoding: "multipart/form-data", enctype: "multipart/form-data" }), m.timeout && (j = setTimeout(function () {
          T = !0, s(k);
        }, m.timeout));var o = [];try {
          if (m.extraData) for (var l in m.extraData) {
            m.extraData.hasOwnProperty(l) && (e.isPlainObject(m.extraData[l]) && m.extraData[l].hasOwnProperty("name") && m.extraData[l].hasOwnProperty("value") ? o.push(e('<input type="hidden" name="' + m.extraData[l].name + '">').val(m.extraData[l].value).appendTo(w)[0]) : o.push(e('<input type="hidden" name="' + l + '">').val(m.extraData[l]).appendTo(w)[0]));
          }m.iframeTarget || (v.appendTo("body"), g.attachEvent ? g.attachEvent("onload", s) : g.addEventListener("load", s, !1)), setTimeout(t, 15);try {
            w.submit();
          } catch (c) {
            var p = document.createElement("form").submit;p.apply(w);
          }
        } finally {
          w.setAttribute("action", i), r ? w.setAttribute("target", r) : f.removeAttr("target"), e(o).remove();
        }
      }function s(t) {
        if (!x.aborted && !F) {
          if (M = n(g), M || (a("cannot access response document"), t = D), t === k && x) return x.abort("timeout"), S.reject(x, "timeout"), void 0;if (t == D && x) return x.abort("server abort"), S.reject(x, "error", "server abort"), void 0;if (M && M.location.href != m.iframeSrc || T) {
            g.detachEvent ? g.detachEvent("onload", s) : g.removeEventListener("load", s, !1);var r,
                i = "success";try {
              if (T) throw "timeout";var o = "xml" == m.dataType || M.XMLDocument || e.isXMLDoc(M);if (a("isXml=" + o), !o && window.opera && (null === M.body || !M.body.innerHTML) && --O) return a("requeing onLoad callback, DOM not available"), setTimeout(s, 250), void 0;var u = M.body ? M.body : M.documentElement;x.responseText = u ? u.innerHTML : null, x.responseXML = M.XMLDocument ? M.XMLDocument : M, o && (m.dataType = "xml"), x.getResponseHeader = function (e) {
                var t = { "content-type": m.dataType };return t[e];
              }, u && (x.status = Number(u.getAttribute("status")) || x.status, x.statusText = u.getAttribute("statusText") || x.statusText);var l = (m.dataType || "").toLowerCase(),
                  c = /(json|script|text)/.test(l);if (c || m.textarea) {
                var f = M.getElementsByTagName("textarea")[0];if (f) x.responseText = f.value, x.status = Number(f.getAttribute("status")) || x.status, x.statusText = f.getAttribute("statusText") || x.statusText;else if (c) {
                  var d = M.getElementsByTagName("pre")[0],
                      h = M.getElementsByTagName("body")[0];d ? x.responseText = d.textContent ? d.textContent : d.innerText : h && (x.responseText = h.textContent ? h.textContent : h.innerText);
                }
              } else "xml" == l && !x.responseXML && x.responseText && (x.responseXML = X(x.responseText));try {
                L = _(x, l, m);
              } catch (b) {
                i = "parsererror", x.error = r = b || i;
              }
            } catch (b) {
              a("error caught: ", b), i = "error", x.error = r = b || i;
            }x.aborted && (a("upload aborted"), i = null), x.status && (i = x.status >= 200 && 300 > x.status || 304 === x.status ? "success" : "error"), "success" === i ? (m.success && m.success.call(m.context, L, "success", x), S.resolve(x.responseText, "success", x), p && e.event.trigger("ajaxSuccess", [x, m])) : i && (void 0 === r && (r = x.statusText), m.error && m.error.call(m.context, x, i, r), S.reject(x, "error", r), p && e.event.trigger("ajaxError", [x, m, r])), p && e.event.trigger("ajaxComplete", [x, m]), p && ! --e.active && e.event.trigger("ajaxStop"), m.complete && m.complete.call(m.context, x, i), F = !0, m.timeout && clearTimeout(j), setTimeout(function () {
              m.iframeTarget || v.remove(), x.responseXML = null;
            }, 100);
          }
        }
      }var l,
          c,
          m,
          p,
          d,
          v,
          g,
          x,
          b,
          y,
          T,
          j,
          w = f[0],
          S = e.Deferred();if (r) for (c = 0; h.length > c; c++) {
        l = e(h[c]), i ? l.prop("disabled", !1) : l.removeAttr("disabled");
      }if (m = e.extend(!0, {}, e.ajaxSettings, t), m.context = m.context || m, d = "jqFormIO" + new Date().getTime(), m.iframeTarget ? (v = e(m.iframeTarget), y = v.attr2("name"), y ? d = y : v.attr2("name", d)) : (v = e('<iframe name="' + d + '" src="' + m.iframeSrc + '" />'), v.css({ position: "absolute", top: "-1000px", left: "-1000px" })), g = v[0], x = { aborted: 0, responseText: null, responseXML: null, status: 0, statusText: "n/a", getAllResponseHeaders: function getAllResponseHeaders() {}, getResponseHeader: function getResponseHeader() {}, setRequestHeader: function setRequestHeader() {}, abort: function abort(t) {
          var r = "timeout" === t ? "timeout" : "aborted";a("aborting upload... " + r), this.aborted = 1;try {
            g.contentWindow.document.execCommand && g.contentWindow.document.execCommand("Stop");
          } catch (n) {}v.attr("src", m.iframeSrc), x.error = r, m.error && m.error.call(m.context, x, r, t), p && e.event.trigger("ajaxError", [x, m, r]), m.complete && m.complete.call(m.context, x, r);
        } }, p = m.global, p && 0 === e.active++ && e.event.trigger("ajaxStart"), p && e.event.trigger("ajaxSend", [x, m]), m.beforeSend && m.beforeSend.call(m.context, x, m) === !1) return m.global && e.active--, S.reject(), S;if (x.aborted) return S.reject(), S;b = w.clk, b && (y = b.name, y && !b.disabled && (m.extraData = m.extraData || {}, m.extraData[y] = b.value, "image" == b.type && (m.extraData[y + ".x"] = w.clk_x, m.extraData[y + ".y"] = w.clk_y)));var k = 1,
          D = 2,
          A = e("meta[name=csrf-token]").attr("content"),
          E = e("meta[name=csrf-param]").attr("content");E && A && (m.extraData = m.extraData || {}, m.extraData[E] = A), m.forceSync ? o() : setTimeout(o, 10);var L,
          M,
          F,
          O = 50,
          X = e.parseXML || function (e, t) {
        return window.ActiveXObject ? (t = new ActiveXObject("Microsoft.XMLDOM"), t.async = "false", t.loadXML(e)) : t = new DOMParser().parseFromString(e, "text/xml"), t && t.documentElement && "parsererror" != t.documentElement.nodeName ? t : null;
      },
          C = e.parseJSON || function (e) {
        return window.eval("(" + e + ")");
      },
          _ = function _(t, r, a) {
        var n = t.getResponseHeader("content-type") || "",
            i = "xml" === r || !r && n.indexOf("xml") >= 0,
            o = i ? t.responseXML : t.responseText;return i && "parsererror" === o.documentElement.nodeName && e.error && e.error("parsererror"), a && a.dataFilter && (o = a.dataFilter(o, r)), "string" == typeof o && ("json" === r || !r && n.indexOf("json") >= 0 ? o = C(o) : ("script" === r || !r && n.indexOf("javascript") >= 0) && e.globalEval(o)), o;
      };return S;
    }if (!this.length) return a("ajaxSubmit: skipping submit process - no element selected"), this;var u,
        l,
        c,
        f = this;"function" == typeof t && (t = { success: t }), u = t.type || this.attr2("method"), l = t.url || this.attr2("action"), c = "string" == typeof l ? e.trim(l) : "", c = c || window.location.href || "", c && (c = (c.match(/^([^#]+)/) || [])[1]), t = e.extend(!0, { url: c, success: e.ajaxSettings.success, type: u || "GET", iframeSrc: /^https/i.test(window.location.href || "") ? "javascript:false" : "about:blank" }, t);var m = {};if (this.trigger("form-pre-serialize", [this, t, m]), m.veto) return a("ajaxSubmit: submit vetoed via form-pre-serialize trigger"), this;if (t.beforeSerialize && t.beforeSerialize(this, t) === !1) return a("ajaxSubmit: submit aborted via beforeSerialize callback"), this;var p = t.traditional;void 0 === p && (p = e.ajaxSettings.traditional);var d,
        h = [],
        v = this.formToArray(t.semantic, h);if (t.data && (t.extraData = t.data, d = e.param(t.data, p)), t.beforeSubmit && t.beforeSubmit(v, this, t) === !1) return a("ajaxSubmit: submit aborted via beforeSubmit callback"), this;if (this.trigger("form-submit-validate", [v, this, t, m]), m.veto) return a("ajaxSubmit: submit vetoed via form-submit-validate trigger"), this;var g = e.param(v, p);d && (g = g ? g + "&" + d : d), "GET" == t.type.toUpperCase() ? (t.url += (t.url.indexOf("?") >= 0 ? "&" : "?") + g, t.data = null) : t.data = g;var x = [];if (t.resetForm && x.push(function () {
      f.resetForm();
    }), t.clearForm && x.push(function () {
      f.clearForm(t.includeHidden);
    }), !t.dataType && t.target) {
      var b = t.success || function () {};x.push(function (r) {
        var a = t.replaceTarget ? "replaceWith" : "html";e(t.target)[a](r).each(b, arguments);
      });
    } else t.success && x.push(t.success);if (t.success = function (e, r, a) {
      for (var n = t.context || this, i = 0, o = x.length; o > i; i++) {
        x[i].apply(n, [e, r, a || f, f]);
      }
    }, t.error) {
      var y = t.error;t.error = function (e, r, a) {
        var n = t.context || this;y.apply(n, [e, r, a, f]);
      };
    }if (t.complete) {
      var T = t.complete;t.complete = function (e, r) {
        var a = t.context || this;T.apply(a, [e, r, f]);
      };
    }var j = e('input[type=file]:enabled[value!=""]', this),
        w = j.length > 0,
        S = "multipart/form-data",
        k = f.attr("enctype") == S || f.attr("encoding") == S,
        D = n.fileapi && n.formdata;a("fileAPI :" + D);var A,
        E = (w || k) && !D;t.iframe !== !1 && (t.iframe || E) ? t.closeKeepAlive ? e.get(t.closeKeepAlive, function () {
      A = s(v);
    }) : A = s(v) : A = (w || k) && D ? o(v) : e.ajax(t), f.removeData("jqxhr").data("jqxhr", A);for (var L = 0; h.length > L; L++) {
      h[L] = null;
    }return this.trigger("form-submit-notify", [this, t]), this;
  }, e.fn.ajaxForm = function (n) {
    if (n = n || {}, n.delegation = n.delegation && e.isFunction(e.fn.on), !n.delegation && 0 === this.length) {
      var i = { s: this.selector, c: this.context };return !e.isReady && i.s ? (a("DOM not ready, queuing ajaxForm"), e(function () {
        e(i.s, i.c).ajaxForm(n);
      }), this) : (a("terminating; zero elements found by selector" + (e.isReady ? "" : " (DOM not ready)")), this);
    }return n.delegation ? (e(document).off("submit.form-plugin", this.selector, t).off("click.form-plugin", this.selector, r).on("submit.form-plugin", this.selector, n, t).on("click.form-plugin", this.selector, n, r), this) : this.ajaxFormUnbind().bind("submit.form-plugin", n, t).bind("click.form-plugin", n, r);
  }, e.fn.ajaxFormUnbind = function () {
    return this.unbind("submit.form-plugin click.form-plugin");
  }, e.fn.formToArray = function (t, r) {
    var a = [];if (0 === this.length) return a;var i = this[0],
        o = t ? i.getElementsByTagName("*") : i.elements;if (!o) return a;var s, u, l, c, f, m, p;for (s = 0, m = o.length; m > s; s++) {
      if (f = o[s], l = f.name, l && !f.disabled) if (t && i.clk && "image" == f.type) i.clk == f && (a.push({ name: l, value: e(f).val(), type: f.type }), a.push({ name: l + ".x", value: i.clk_x }, { name: l + ".y", value: i.clk_y }));else if (c = e.fieldValue(f, !0), c && c.constructor == Array) for (r && r.push(f), u = 0, p = c.length; p > u; u++) {
        a.push({ name: l, value: c[u] });
      } else if (n.fileapi && "file" == f.type) {
        r && r.push(f);var d = f.files;if (d.length) for (u = 0; d.length > u; u++) {
          a.push({ name: l, value: d[u], type: f.type });
        } else a.push({ name: l, value: "", type: f.type });
      } else null !== c && c !== void 0 && (r && r.push(f), a.push({ name: l, value: c, type: f.type, required: f.required }));
    }if (!t && i.clk) {
      var h = e(i.clk),
          v = h[0];l = v.name, l && !v.disabled && "image" == v.type && (a.push({ name: l, value: h.val() }), a.push({ name: l + ".x", value: i.clk_x }, { name: l + ".y", value: i.clk_y }));
    }return a;
  }, e.fn.formSerialize = function (t) {
    return e.param(this.formToArray(t));
  }, e.fn.fieldSerialize = function (t) {
    var r = [];return this.each(function () {
      var a = this.name;if (a) {
        var n = e.fieldValue(this, t);if (n && n.constructor == Array) for (var i = 0, o = n.length; o > i; i++) {
          r.push({ name: a, value: n[i] });
        } else null !== n && n !== void 0 && r.push({ name: this.name, value: n });
      }
    }), e.param(r);
  }, e.fn.fieldValue = function (t) {
    for (var r = [], a = 0, n = this.length; n > a; a++) {
      var i = this[a],
          o = e.fieldValue(i, t);null === o || void 0 === o || o.constructor == Array && !o.length || (o.constructor == Array ? e.merge(r, o) : r.push(o));
    }return r;
  }, e.fieldValue = function (t, r) {
    var a = t.name,
        n = t.type,
        i = t.tagName.toLowerCase();if (void 0 === r && (r = !0), r && (!a || t.disabled || "reset" == n || "button" == n || ("checkbox" == n || "radio" == n) && !t.checked || ("submit" == n || "image" == n) && t.form && t.form.clk != t || "select" == i && -1 == t.selectedIndex)) return null;if ("select" == i) {
      var o = t.selectedIndex;if (0 > o) return null;for (var s = [], u = t.options, l = "select-one" == n, c = l ? o + 1 : u.length, f = l ? o : 0; c > f; f++) {
        var m = u[f];if (m.selected) {
          var p = m.value;if (p || (p = m.attributes && m.attributes.value && !m.attributes.value.specified ? m.text : m.value), l) return p;s.push(p);
        }
      }return s;
    }return e(t).val();
  }, e.fn.clearForm = function (t) {
    return this.each(function () {
      e("input,select,textarea", this).clearFields(t);
    });
  }, e.fn.clearFields = e.fn.clearInputs = function (t) {
    var r = /^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function () {
      var a = this.type,
          n = this.tagName.toLowerCase();r.test(a) || "textarea" == n ? this.value = "" : "checkbox" == a || "radio" == a ? this.checked = !1 : "select" == n ? this.selectedIndex = -1 : "file" == a ? /MSIE/.test(navigator.userAgent) ? e(this).replaceWith(e(this).clone(!0)) : e(this).val("") : t && (t === !0 && /hidden/.test(a) || "string" == typeof t && e(this).is(t)) && (this.value = "");
    });
  }, e.fn.resetForm = function () {
    return this.each(function () {
      ("function" == typeof this.reset || "object" == _typeof(this.reset) && !this.reset.nodeType) && this.reset();
    });
  }, e.fn.enable = function (e) {
    return void 0 === e && (e = !0), this.each(function () {
      this.disabled = !e;
    });
  }, e.fn.selected = function (t) {
    return void 0 === t && (t = !0), this.each(function () {
      var r = this.type;if ("checkbox" == r || "radio" == r) this.checked = t;else if ("option" == this.tagName.toLowerCase()) {
        var a = e(this).parent("select");t && a[0] && "select-one" == a[0].type && a.find("option").selected(!1), this.selected = t;
      }
    });
  }, e.fn.ajaxSubmit.debug = !1;
})(jQuery);
'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

(function (window) {
    'use strict';

    /*global define, module, exports, require */

    var c3 = { version: "0.4.11" };

    var c3_chart_fn, c3_chart_internal_fn, c3_chart_internal_axis_fn;

    function API(owner) {
        this.owner = owner;
    }

    function inherit(base, derived) {

        if (Object.create) {
            derived.prototype = Object.create(base.prototype);
        } else {
            var f = function f() {};
            f.prototype = base.prototype;
            derived.prototype = new f();
        }

        derived.prototype.constructor = derived;

        return derived;
    }

    function Chart(config) {
        var $$ = this.internal = new ChartInternal(this);
        $$.loadConfig(config);

        $$.beforeInit(config);
        $$.init();
        $$.afterInit(config);

        // bind "this" to nested API
        (function bindThis(fn, target, argThis) {
            Object.keys(fn).forEach(function (key) {
                target[key] = fn[key].bind(argThis);
                if (Object.keys(fn[key]).length > 0) {
                    bindThis(fn[key], target[key], argThis);
                }
            });
        })(c3_chart_fn, this, this);
    }

    function ChartInternal(api) {
        var $$ = this;
        $$.d3 = window.d3 ? window.d3 : typeof require !== 'undefined' ? require("d3") : undefined;
        $$.api = api;
        $$.config = $$.getDefaultConfig();
        $$.data = {};
        $$.cache = {};
        $$.axes = {};
    }

    c3.generate = function (config) {
        return new Chart(config);
    };

    c3.chart = {
        fn: Chart.prototype,
        internal: {
            fn: ChartInternal.prototype,
            axis: {
                fn: Axis.prototype
            }
        }
    };
    c3_chart_fn = c3.chart.fn;
    c3_chart_internal_fn = c3.chart.internal.fn;
    c3_chart_internal_axis_fn = c3.chart.internal.axis.fn;

    c3_chart_internal_fn.beforeInit = function () {
        // can do something
    };
    c3_chart_internal_fn.afterInit = function () {
        // can do something
    };
    c3_chart_internal_fn.init = function () {
        var $$ = this,
            config = $$.config;

        $$.initParams();

        if (config.data_url) {
            $$.convertUrlToData(config.data_url, config.data_mimeType, config.data_headers, config.data_keys, $$.initWithData);
        } else if (config.data_json) {
            $$.initWithData($$.convertJsonToData(config.data_json, config.data_keys));
        } else if (config.data_rows) {
            $$.initWithData($$.convertRowsToData(config.data_rows));
        } else if (config.data_columns) {
            $$.initWithData($$.convertColumnsToData(config.data_columns));
        } else {
            throw Error('url or json or rows or columns is required.');
        }
    };

    c3_chart_internal_fn.initParams = function () {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config;

        // MEMO: clipId needs to be unique because it conflicts when multiple charts exist
        $$.clipId = "c3-" + +new Date() + '-clip', $$.clipIdForXAxis = $$.clipId + '-xaxis', $$.clipIdForYAxis = $$.clipId + '-yaxis', $$.clipIdForGrid = $$.clipId + '-grid', $$.clipIdForSubchart = $$.clipId + '-subchart', $$.clipPath = $$.getClipPath($$.clipId), $$.clipPathForXAxis = $$.getClipPath($$.clipIdForXAxis), $$.clipPathForYAxis = $$.getClipPath($$.clipIdForYAxis);
        $$.clipPathForGrid = $$.getClipPath($$.clipIdForGrid), $$.clipPathForSubchart = $$.getClipPath($$.clipIdForSubchart), $$.dragStart = null;
        $$.dragging = false;
        $$.flowing = false;
        $$.cancelClick = false;
        $$.mouseover = false;
        $$.transiting = false;

        $$.color = $$.generateColor();
        $$.levelColor = $$.generateLevelColor();

        $$.dataTimeFormat = config.data_xLocaltime ? d3.time.format : d3.time.format.utc;
        $$.axisTimeFormat = config.axis_x_localtime ? d3.time.format : d3.time.format.utc;
        $$.defaultAxisTimeFormat = $$.axisTimeFormat.multi([[".%L", function (d) {
            return d.getMilliseconds();
        }], [":%S", function (d) {
            return d.getSeconds();
        }], ["%I:%M", function (d) {
            return d.getMinutes();
        }], ["%I %p", function (d) {
            return d.getHours();
        }], ["%-m/%-d", function (d) {
            return d.getDay() && d.getDate() !== 1;
        }], ["%-m/%-d", function (d) {
            return d.getDate() !== 1;
        }], ["%-m/%-d", function (d) {
            return d.getMonth();
        }], ["%Y/%-m/%-d", function () {
            return true;
        }]]);

        $$.hiddenTargetIds = [];
        $$.hiddenLegendIds = [];
        $$.focusedTargetIds = [];
        $$.defocusedTargetIds = [];

        $$.xOrient = config.axis_rotated ? "left" : "bottom";
        $$.yOrient = config.axis_rotated ? config.axis_y_inner ? "top" : "bottom" : config.axis_y_inner ? "right" : "left";
        $$.y2Orient = config.axis_rotated ? config.axis_y2_inner ? "bottom" : "top" : config.axis_y2_inner ? "left" : "right";
        $$.subXOrient = config.axis_rotated ? "left" : "bottom";

        $$.isLegendRight = config.legend_position === 'right';
        $$.isLegendInset = config.legend_position === 'inset';
        $$.isLegendTop = config.legend_inset_anchor === 'top-left' || config.legend_inset_anchor === 'top-right';
        $$.isLegendLeft = config.legend_inset_anchor === 'top-left' || config.legend_inset_anchor === 'bottom-left';
        $$.legendStep = 0;
        $$.legendItemWidth = 0;
        $$.legendItemHeight = 0;

        $$.currentMaxTickWidths = {
            x: 0,
            y: 0,
            y2: 0
        };

        $$.rotated_padding_left = 30;
        $$.rotated_padding_right = config.axis_rotated && !config.axis_x_show ? 0 : 30;
        $$.rotated_padding_top = 5;

        $$.withoutFadeIn = {};

        $$.intervalForObserveInserted = undefined;

        $$.axes.subx = d3.selectAll([]); // needs when excluding subchart.js
    };

    c3_chart_internal_fn.initChartElements = function () {
        if (this.initBar) {
            this.initBar();
        }
        if (this.initLine) {
            this.initLine();
        }
        if (this.initArc) {
            this.initArc();
        }
        if (this.initGauge) {
            this.initGauge();
        }
        if (this.initText) {
            this.initText();
        }
    };

    c3_chart_internal_fn.initWithData = function (data) {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config;
        var defs,
            main,
            binding = true;

        $$.axis = new Axis($$);

        if ($$.initPie) {
            $$.initPie();
        }
        if ($$.initBrush) {
            $$.initBrush();
        }
        if ($$.initZoom) {
            $$.initZoom();
        }

        if (!config.bindto) {
            $$.selectChart = d3.selectAll([]);
        } else if (typeof config.bindto.node === 'function') {
            $$.selectChart = config.bindto;
        } else {
            $$.selectChart = d3.select(config.bindto);
        }
        if ($$.selectChart.empty()) {
            $$.selectChart = d3.select(document.createElement('div')).style('opacity', 0);
            $$.observeInserted($$.selectChart);
            binding = false;
        }
        $$.selectChart.html("").classed("c3", true);

        // Init data as targets
        $$.data.xs = {};
        $$.data.targets = $$.convertDataToTargets(data);

        if (config.data_filter) {
            $$.data.targets = $$.data.targets.filter(config.data_filter);
        }

        // Set targets to hide if needed
        if (config.data_hide) {
            $$.addHiddenTargetIds(config.data_hide === true ? $$.mapToIds($$.data.targets) : config.data_hide);
        }
        if (config.legend_hide) {
            $$.addHiddenLegendIds(config.legend_hide === true ? $$.mapToIds($$.data.targets) : config.legend_hide);
        }

        // when gauge, hide legend // TODO: fix
        if ($$.hasType('gauge')) {
            config.legend_show = false;
        }

        // Init sizes and scales
        $$.updateSizes();
        $$.updateScales();

        // Set domains for each scale
        $$.x.domain(d3.extent($$.getXDomain($$.data.targets)));
        $$.y.domain($$.getYDomain($$.data.targets, 'y'));
        $$.y2.domain($$.getYDomain($$.data.targets, 'y2'));
        $$.subX.domain($$.x.domain());
        $$.subY.domain($$.y.domain());
        $$.subY2.domain($$.y2.domain());

        // Save original x domain for zoom update
        $$.orgXDomain = $$.x.domain();

        // Set initialized scales to brush and zoom
        if ($$.brush) {
            $$.brush.scale($$.subX);
        }
        if (config.zoom_enabled) {
            $$.zoom.scale($$.x);
        }

        /*-- Basic Elements --*/

        // Define svgs
        $$.svg = $$.selectChart.append("svg").style("overflow", "hidden").on('mouseenter', function () {
            return config.onmouseover.call($$);
        }).on('mouseleave', function () {
            return config.onmouseout.call($$);
        });

        if ($$.config.svg_classname) {
            $$.svg.attr('class', $$.config.svg_classname);
        }

        // Define defs
        defs = $$.svg.append("defs");
        $$.clipChart = $$.appendClip(defs, $$.clipId);
        $$.clipXAxis = $$.appendClip(defs, $$.clipIdForXAxis);
        $$.clipYAxis = $$.appendClip(defs, $$.clipIdForYAxis);
        $$.clipGrid = $$.appendClip(defs, $$.clipIdForGrid);
        $$.clipSubchart = $$.appendClip(defs, $$.clipIdForSubchart);
        $$.updateSvgSize();

        // Define regions
        main = $$.main = $$.svg.append("g").attr("transform", $$.getTranslate('main'));

        if ($$.initSubchart) {
            $$.initSubchart();
        }
        if ($$.initTooltip) {
            $$.initTooltip();
        }
        if ($$.initLegend) {
            $$.initLegend();
        }
        if ($$.initTitle) {
            $$.initTitle();
        }

        /*-- Main Region --*/

        // text when empty
        main.append("text").attr("class", CLASS.text + ' ' + CLASS.empty).attr("text-anchor", "middle") // horizontal centering of text at x position in all browsers.
        .attr("dominant-baseline", "middle"); // vertical centering of text at y position in all browsers, except IE.

        // Regions
        $$.initRegion();

        // Grids
        $$.initGrid();

        // Define g for chart area
        main.append('g').attr("clip-path", $$.clipPath).attr('class', CLASS.chart);

        // Grid lines
        if (config.grid_lines_front) {
            $$.initGridLines();
        }

        // Cover whole with rects for events
        $$.initEventRect();

        // Define g for chart
        $$.initChartElements();

        // if zoom privileged, insert rect to forefront
        // TODO: is this needed?
        main.insert('rect', config.zoom_privileged ? null : 'g.' + CLASS.regions).attr('class', CLASS.zoomRect).attr('width', $$.width).attr('height', $$.height).style('opacity', 0).on("dblclick.zoom", null);

        // Set default extent if defined
        if (config.axis_x_extent) {
            $$.brush.extent($$.getDefaultExtent());
        }

        // Add Axis
        $$.axis.init();

        // Set targets
        $$.updateTargets($$.data.targets);

        // Draw with targets
        if (binding) {
            $$.updateDimension();
            $$.config.oninit.call($$);
            $$.redraw({
                withTransition: false,
                withTransform: true,
                withUpdateXDomain: true,
                withUpdateOrgXDomain: true,
                withTransitionForAxis: false
            });
        }

        // Bind resize event
        $$.bindResize();

        // export element of the chart
        $$.api.element = $$.selectChart.node();
    };

    c3_chart_internal_fn.smoothLines = function (el, type) {
        var $$ = this;
        if (type === 'grid') {
            el.each(function () {
                var g = $$.d3.select(this),
                    x1 = g.attr('x1'),
                    x2 = g.attr('x2'),
                    y1 = g.attr('y1'),
                    y2 = g.attr('y2');
                g.attr({
                    'x1': Math.ceil(x1),
                    'x2': Math.ceil(x2),
                    'y1': Math.ceil(y1),
                    'y2': Math.ceil(y2)
                });
            });
        }
    };

    c3_chart_internal_fn.updateSizes = function () {
        var $$ = this,
            config = $$.config;
        var legendHeight = $$.legend ? $$.getLegendHeight() : 0,
            legendWidth = $$.legend ? $$.getLegendWidth() : 0,
            legendHeightForBottom = $$.isLegendRight || $$.isLegendInset ? 0 : legendHeight,
            hasArc = $$.hasArcType(),
            xAxisHeight = config.axis_rotated || hasArc ? 0 : $$.getHorizontalAxisHeight('x'),
            subchartHeight = config.subchart_show && !hasArc ? config.subchart_size_height + xAxisHeight : 0;

        $$.currentWidth = $$.getCurrentWidth();
        $$.currentHeight = $$.getCurrentHeight();

        // for main
        $$.margin = config.axis_rotated ? {
            top: $$.getHorizontalAxisHeight('y2') + $$.getCurrentPaddingTop(),
            right: hasArc ? 0 : $$.getCurrentPaddingRight(),
            bottom: $$.getHorizontalAxisHeight('y') + legendHeightForBottom + $$.getCurrentPaddingBottom(),
            left: subchartHeight + (hasArc ? 0 : $$.getCurrentPaddingLeft())
        } : {
            top: 4 + $$.getCurrentPaddingTop(), // for top tick text
            right: hasArc ? 0 : $$.getCurrentPaddingRight(),
            bottom: xAxisHeight + subchartHeight + legendHeightForBottom + $$.getCurrentPaddingBottom(),
            left: hasArc ? 0 : $$.getCurrentPaddingLeft()
        };

        // for subchart
        $$.margin2 = config.axis_rotated ? {
            top: $$.margin.top,
            right: NaN,
            bottom: 20 + legendHeightForBottom,
            left: $$.rotated_padding_left
        } : {
            top: $$.currentHeight - subchartHeight - legendHeightForBottom,
            right: NaN,
            bottom: xAxisHeight + legendHeightForBottom,
            left: $$.margin.left
        };

        // for legend
        $$.margin3 = {
            top: 0,
            right: NaN,
            bottom: 0,
            left: 0
        };
        if ($$.updateSizeForLegend) {
            $$.updateSizeForLegend(legendHeight, legendWidth);
        }

        $$.width = $$.currentWidth - $$.margin.left - $$.margin.right;
        $$.height = $$.currentHeight - $$.margin.top - $$.margin.bottom;
        if ($$.width < 0) {
            $$.width = 0;
        }
        if ($$.height < 0) {
            $$.height = 0;
        }

        $$.width2 = config.axis_rotated ? $$.margin.left - $$.rotated_padding_left - $$.rotated_padding_right : $$.width;
        $$.height2 = config.axis_rotated ? $$.height : $$.currentHeight - $$.margin2.top - $$.margin2.bottom;
        if ($$.width2 < 0) {
            $$.width2 = 0;
        }
        if ($$.height2 < 0) {
            $$.height2 = 0;
        }

        // for arc
        $$.arcWidth = $$.width - ($$.isLegendRight ? legendWidth + 10 : 0);
        $$.arcHeight = $$.height - ($$.isLegendRight ? 0 : 10);
        if ($$.hasType('gauge') && !config.gauge_fullCircle) {
            $$.arcHeight += $$.height - $$.getGaugeLabelHeight();
        }
        if ($$.updateRadius) {
            $$.updateRadius();
        }

        if ($$.isLegendRight && hasArc) {
            $$.margin3.left = $$.arcWidth / 2 + $$.radiusExpanded * 1.1;
        }
    };

    c3_chart_internal_fn.updateTargets = function (targets) {
        var $$ = this;

        /*-- Main --*/

        //-- Text --//
        $$.updateTargetsForText(targets);

        //-- Bar --//
        $$.updateTargetsForBar(targets);

        //-- Line --//
        $$.updateTargetsForLine(targets);

        //-- Arc --//
        if ($$.hasArcType() && $$.updateTargetsForArc) {
            $$.updateTargetsForArc(targets);
        }

        /*-- Sub --*/

        if ($$.updateTargetsForSubchart) {
            $$.updateTargetsForSubchart(targets);
        }

        // Fade-in each chart
        $$.showTargets();
    };
    c3_chart_internal_fn.showTargets = function () {
        var $$ = this;
        $$.svg.selectAll('.' + CLASS.target).filter(function (d) {
            return $$.isTargetToShow(d.id);
        }).transition().duration($$.config.transition_duration).style("opacity", 1);
    };

    c3_chart_internal_fn.redraw = function (options, transitions) {
        var $$ = this,
            main = $$.main,
            d3 = $$.d3,
            config = $$.config;
        var areaIndices = $$.getShapeIndices($$.isAreaType),
            barIndices = $$.getShapeIndices($$.isBarType),
            lineIndices = $$.getShapeIndices($$.isLineType);
        var withY, withSubchart, withTransition, withTransitionForExit, withTransitionForAxis, withTransform, withUpdateXDomain, withUpdateOrgXDomain, withTrimXDomain, withLegend, withEventRect, withDimension, withUpdateXAxis;
        var hideAxis = $$.hasArcType();
        var drawArea, drawBar, drawLine, xForText, yForText;
        var duration, durationForExit, durationForAxis;
        var waitForDraw, flow;
        var targetsToShow = $$.filterTargetsToShow($$.data.targets),
            tickValues,
            i,
            intervalForCulling,
            xDomainForZoom;
        var xv = $$.xv.bind($$),
            cx,
            cy;

        options = options || {};
        withY = getOption(options, "withY", true);
        withSubchart = getOption(options, "withSubchart", true);
        withTransition = getOption(options, "withTransition", true);
        withTransform = getOption(options, "withTransform", false);
        withUpdateXDomain = getOption(options, "withUpdateXDomain", false);
        withUpdateOrgXDomain = getOption(options, "withUpdateOrgXDomain", false);
        withTrimXDomain = getOption(options, "withTrimXDomain", true);
        withUpdateXAxis = getOption(options, "withUpdateXAxis", withUpdateXDomain);
        withLegend = getOption(options, "withLegend", false);
        withEventRect = getOption(options, "withEventRect", true);
        withDimension = getOption(options, "withDimension", true);
        withTransitionForExit = getOption(options, "withTransitionForExit", withTransition);
        withTransitionForAxis = getOption(options, "withTransitionForAxis", withTransition);

        duration = withTransition ? config.transition_duration : 0;
        durationForExit = withTransitionForExit ? duration : 0;
        durationForAxis = withTransitionForAxis ? duration : 0;

        transitions = transitions || $$.axis.generateTransitions(durationForAxis);

        // update legend and transform each g
        if (withLegend && config.legend_show) {
            $$.updateLegend($$.mapToIds($$.data.targets), options, transitions);
        } else if (withDimension) {
            // need to update dimension (e.g. axis.y.tick.values) because y tick values should change
            // no need to update axis in it because they will be updated in redraw()
            $$.updateDimension(true);
        }

        // MEMO: needed for grids calculation
        if ($$.isCategorized() && targetsToShow.length === 0) {
            $$.x.domain([0, $$.axes.x.selectAll('.tick').size()]);
        }

        if (targetsToShow.length) {
            $$.updateXDomain(targetsToShow, withUpdateXDomain, withUpdateOrgXDomain, withTrimXDomain);
            if (!config.axis_x_tick_values) {
                tickValues = $$.axis.updateXAxisTickValues(targetsToShow);
            }
        } else {
            $$.xAxis.tickValues([]);
            $$.subXAxis.tickValues([]);
        }

        if (config.zoom_rescale && !options.flow) {
            xDomainForZoom = $$.x.orgDomain();
        }

        $$.y.domain($$.getYDomain(targetsToShow, 'y', xDomainForZoom));
        $$.y2.domain($$.getYDomain(targetsToShow, 'y2', xDomainForZoom));

        if (!config.axis_y_tick_values && config.axis_y_tick_count) {
            $$.yAxis.tickValues($$.axis.generateTickValues($$.y.domain(), config.axis_y_tick_count));
        }
        if (!config.axis_y2_tick_values && config.axis_y2_tick_count) {
            $$.y2Axis.tickValues($$.axis.generateTickValues($$.y2.domain(), config.axis_y2_tick_count));
        }

        // axes
        $$.axis.redraw(transitions, hideAxis);

        // Update axis label
        $$.axis.updateLabels(withTransition);

        // show/hide if manual culling needed
        if ((withUpdateXDomain || withUpdateXAxis) && targetsToShow.length) {
            if (config.axis_x_tick_culling && tickValues) {
                for (i = 1; i < tickValues.length; i++) {
                    if (tickValues.length / i < config.axis_x_tick_culling_max) {
                        intervalForCulling = i;
                        break;
                    }
                }
                $$.svg.selectAll('.' + CLASS.axisX + ' .tick text').each(function (e) {
                    var index = tickValues.indexOf(e);
                    if (index >= 0) {
                        d3.select(this).style('display', index % intervalForCulling ? 'none' : 'block');
                    }
                });
            } else {
                $$.svg.selectAll('.' + CLASS.axisX + ' .tick text').style('display', 'block');
            }
        }

        // setup drawer - MEMO: these must be called after axis updated
        drawArea = $$.generateDrawArea ? $$.generateDrawArea(areaIndices, false) : undefined;
        drawBar = $$.generateDrawBar ? $$.generateDrawBar(barIndices) : undefined;
        drawLine = $$.generateDrawLine ? $$.generateDrawLine(lineIndices, false) : undefined;
        xForText = $$.generateXYForText(areaIndices, barIndices, lineIndices, true);
        yForText = $$.generateXYForText(areaIndices, barIndices, lineIndices, false);

        // Update sub domain
        if (withY) {
            $$.subY.domain($$.getYDomain(targetsToShow, 'y'));
            $$.subY2.domain($$.getYDomain(targetsToShow, 'y2'));
        }

        // xgrid focus
        $$.updateXgridFocus();

        // Data empty label positioning and text.
        main.select("text." + CLASS.text + '.' + CLASS.empty).attr("x", $$.width / 2).attr("y", $$.height / 2).text(config.data_empty_label_text).transition().style('opacity', targetsToShow.length ? 0 : 1);

        // grid
        $$.updateGrid(duration);

        // rect for regions
        $$.updateRegion(duration);

        // bars
        $$.updateBar(durationForExit);

        // lines, areas and cricles
        $$.updateLine(durationForExit);
        $$.updateArea(durationForExit);
        $$.updateCircle();

        // text
        if ($$.hasDataLabel()) {
            $$.updateText(durationForExit);
        }

        // title
        if ($$.redrawTitle) {
            $$.redrawTitle();
        }

        // arc
        if ($$.redrawArc) {
            $$.redrawArc(duration, durationForExit, withTransform);
        }

        // subchart
        if ($$.redrawSubchart) {
            $$.redrawSubchart(withSubchart, transitions, duration, durationForExit, areaIndices, barIndices, lineIndices);
        }

        // circles for select
        main.selectAll('.' + CLASS.selectedCircles).filter($$.isBarType.bind($$)).selectAll('circle').remove();

        // event rects will redrawn when flow called
        if (config.interaction_enabled && !options.flow && withEventRect) {
            $$.redrawEventRect();
            if ($$.updateZoom) {
                $$.updateZoom();
            }
        }

        // update circleY based on updated parameters
        $$.updateCircleY();

        // generate circle x/y functions depending on updated params
        cx = ($$.config.axis_rotated ? $$.circleY : $$.circleX).bind($$);
        cy = ($$.config.axis_rotated ? $$.circleX : $$.circleY).bind($$);

        if (options.flow) {
            flow = $$.generateFlow({
                targets: targetsToShow,
                flow: options.flow,
                duration: options.flow.duration,
                drawBar: drawBar,
                drawLine: drawLine,
                drawArea: drawArea,
                cx: cx,
                cy: cy,
                xv: xv,
                xForText: xForText,
                yForText: yForText
            });
        }

        if ((duration || flow) && $$.isTabVisible()) {
            // Only use transition if tab visible. See #938.
            // transition should be derived from one transition
            d3.transition().duration(duration).each(function () {
                var transitionsToWait = [];

                // redraw and gather transitions
                [$$.redrawBar(drawBar, true), $$.redrawLine(drawLine, true), $$.redrawArea(drawArea, true), $$.redrawCircle(cx, cy, true), $$.redrawText(xForText, yForText, options.flow, true), $$.redrawRegion(true), $$.redrawGrid(true)].forEach(function (transitions) {
                    transitions.forEach(function (transition) {
                        transitionsToWait.push(transition);
                    });
                });

                // Wait for end of transitions to call flow and onrendered callback
                waitForDraw = $$.generateWait();
                transitionsToWait.forEach(function (t) {
                    waitForDraw.add(t);
                });
            }).call(waitForDraw, function () {
                if (flow) {
                    flow();
                }
                if (config.onrendered) {
                    config.onrendered.call($$);
                }
            });
        } else {
            $$.redrawBar(drawBar);
            $$.redrawLine(drawLine);
            $$.redrawArea(drawArea);
            $$.redrawCircle(cx, cy);
            $$.redrawText(xForText, yForText, options.flow);
            $$.redrawRegion();
            $$.redrawGrid();
            if (config.onrendered) {
                config.onrendered.call($$);
            }
        }

        // update fadein condition
        $$.mapToIds($$.data.targets).forEach(function (id) {
            $$.withoutFadeIn[id] = true;
        });
    };

    c3_chart_internal_fn.updateAndRedraw = function (options) {
        var $$ = this,
            config = $$.config,
            transitions;
        options = options || {};
        // same with redraw
        options.withTransition = getOption(options, "withTransition", true);
        options.withTransform = getOption(options, "withTransform", false);
        options.withLegend = getOption(options, "withLegend", false);
        // NOT same with redraw
        options.withUpdateXDomain = true;
        options.withUpdateOrgXDomain = true;
        options.withTransitionForExit = false;
        options.withTransitionForTransform = getOption(options, "withTransitionForTransform", options.withTransition);
        // MEMO: this needs to be called before updateLegend and it means this ALWAYS needs to be called)
        $$.updateSizes();
        // MEMO: called in updateLegend in redraw if withLegend
        if (!(options.withLegend && config.legend_show)) {
            transitions = $$.axis.generateTransitions(options.withTransitionForAxis ? config.transition_duration : 0);
            // Update scales
            $$.updateScales();
            $$.updateSvgSize();
            // Update g positions
            $$.transformAll(options.withTransitionForTransform, transitions);
        }
        // Draw with new sizes & scales
        $$.redraw(options, transitions);
    };
    c3_chart_internal_fn.redrawWithoutRescale = function () {
        this.redraw({
            withY: false,
            withSubchart: false,
            withEventRect: false,
            withTransitionForAxis: false
        });
    };

    c3_chart_internal_fn.isTimeSeries = function () {
        return this.config.axis_x_type === 'timeseries';
    };
    c3_chart_internal_fn.isCategorized = function () {
        return this.config.axis_x_type.indexOf('categor') >= 0;
    };
    c3_chart_internal_fn.isCustomX = function () {
        var $$ = this,
            config = $$.config;
        return !$$.isTimeSeries() && (config.data_x || notEmpty(config.data_xs));
    };

    c3_chart_internal_fn.isTimeSeriesY = function () {
        return this.config.axis_y_type === 'timeseries';
    };

    c3_chart_internal_fn.getTranslate = function (target) {
        var $$ = this,
            config = $$.config,
            x,
            y;
        if (target === 'main') {
            x = asHalfPixel($$.margin.left);
            y = asHalfPixel($$.margin.top);
        } else if (target === 'context') {
            x = asHalfPixel($$.margin2.left);
            y = asHalfPixel($$.margin2.top);
        } else if (target === 'legend') {
            x = $$.margin3.left;
            y = $$.margin3.top;
        } else if (target === 'x') {
            x = 0;
            y = config.axis_rotated ? 0 : $$.height;
        } else if (target === 'y') {
            x = 0;
            y = config.axis_rotated ? $$.height : 0;
        } else if (target === 'y2') {
            x = config.axis_rotated ? 0 : $$.width;
            y = config.axis_rotated ? 1 : 0;
        } else if (target === 'subx') {
            x = 0;
            y = config.axis_rotated ? 0 : $$.height2;
        } else if (target === 'arc') {
            x = $$.arcWidth / 2;
            y = $$.arcHeight / 2;
        }
        return "translate(" + x + "," + y + ")";
    };
    c3_chart_internal_fn.initialOpacity = function (d) {
        return d.value !== null && this.withoutFadeIn[d.id] ? 1 : 0;
    };
    c3_chart_internal_fn.initialOpacityForCircle = function (d) {
        return d.value !== null && this.withoutFadeIn[d.id] ? this.opacityForCircle(d) : 0;
    };
    c3_chart_internal_fn.opacityForCircle = function (d) {
        var opacity = this.config.point_show ? 1 : 0;
        return isValue(d.value) ? this.isScatterType(d) ? 0.5 : opacity : 0;
    };
    c3_chart_internal_fn.opacityForText = function () {
        return this.hasDataLabel() ? 1 : 0;
    };
    c3_chart_internal_fn.xx = function (d) {
        return d ? this.x(d.x) : null;
    };
    c3_chart_internal_fn.xv = function (d) {
        var $$ = this,
            value = d.value;
        if ($$.isTimeSeries()) {
            value = $$.parseDate(d.value);
        } else if ($$.isCategorized() && typeof d.value === 'string') {
            value = $$.config.axis_x_categories.indexOf(d.value);
        }
        return Math.ceil($$.x(value));
    };
    c3_chart_internal_fn.yv = function (d) {
        var $$ = this,
            yScale = d.axis && d.axis === 'y2' ? $$.y2 : $$.y;
        return Math.ceil(yScale(d.value));
    };
    c3_chart_internal_fn.subxx = function (d) {
        return d ? this.subX(d.x) : null;
    };

    c3_chart_internal_fn.transformMain = function (withTransition, transitions) {
        var $$ = this,
            xAxis,
            yAxis,
            y2Axis;
        if (transitions && transitions.axisX) {
            xAxis = transitions.axisX;
        } else {
            xAxis = $$.main.select('.' + CLASS.axisX);
            if (withTransition) {
                xAxis = xAxis.transition();
            }
        }
        if (transitions && transitions.axisY) {
            yAxis = transitions.axisY;
        } else {
            yAxis = $$.main.select('.' + CLASS.axisY);
            if (withTransition) {
                yAxis = yAxis.transition();
            }
        }
        if (transitions && transitions.axisY2) {
            y2Axis = transitions.axisY2;
        } else {
            y2Axis = $$.main.select('.' + CLASS.axisY2);
            if (withTransition) {
                y2Axis = y2Axis.transition();
            }
        }
        (withTransition ? $$.main.transition() : $$.main).attr("transform", $$.getTranslate('main'));
        xAxis.attr("transform", $$.getTranslate('x'));
        yAxis.attr("transform", $$.getTranslate('y'));
        y2Axis.attr("transform", $$.getTranslate('y2'));
        $$.main.select('.' + CLASS.chartArcs).attr("transform", $$.getTranslate('arc'));
    };
    c3_chart_internal_fn.transformAll = function (withTransition, transitions) {
        var $$ = this;
        $$.transformMain(withTransition, transitions);
        if ($$.config.subchart_show) {
            $$.transformContext(withTransition, transitions);
        }
        if ($$.legend) {
            $$.transformLegend(withTransition);
        }
    };

    c3_chart_internal_fn.updateSvgSize = function () {
        var $$ = this,
            brush = $$.svg.select(".c3-brush .background");
        $$.svg.attr('width', $$.currentWidth).attr('height', $$.currentHeight);
        $$.svg.selectAll(['#' + $$.clipId, '#' + $$.clipIdForGrid]).select('rect').attr('width', $$.width).attr('height', $$.height);
        $$.svg.select('#' + $$.clipIdForXAxis).select('rect').attr('x', $$.getXAxisClipX.bind($$)).attr('y', $$.getXAxisClipY.bind($$)).attr('width', $$.getXAxisClipWidth.bind($$)).attr('height', $$.getXAxisClipHeight.bind($$));
        $$.svg.select('#' + $$.clipIdForYAxis).select('rect').attr('x', $$.getYAxisClipX.bind($$)).attr('y', $$.getYAxisClipY.bind($$)).attr('width', $$.getYAxisClipWidth.bind($$)).attr('height', $$.getYAxisClipHeight.bind($$));
        $$.svg.select('#' + $$.clipIdForSubchart).select('rect').attr('width', $$.width).attr('height', brush.size() ? brush.attr('height') : 0);
        $$.svg.select('.' + CLASS.zoomRect).attr('width', $$.width).attr('height', $$.height);
        // MEMO: parent div's height will be bigger than svg when <!DOCTYPE html>
        $$.selectChart.style('max-height', $$.currentHeight + "px");
    };

    c3_chart_internal_fn.updateDimension = function (withoutAxis) {
        var $$ = this;
        if (!withoutAxis) {
            if ($$.config.axis_rotated) {
                $$.axes.x.call($$.xAxis);
                $$.axes.subx.call($$.subXAxis);
            } else {
                $$.axes.y.call($$.yAxis);
                $$.axes.y2.call($$.y2Axis);
            }
        }
        $$.updateSizes();
        $$.updateScales();
        $$.updateSvgSize();
        $$.transformAll(false);
    };

    c3_chart_internal_fn.observeInserted = function (selection) {
        var $$ = this,
            observer;
        if (typeof MutationObserver === 'undefined') {
            window.console.error("MutationObserver not defined.");
            return;
        }
        observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
                if (mutation.type === 'childList' && mutation.previousSibling) {
                    observer.disconnect();
                    // need to wait for completion of load because size calculation requires the actual sizes determined after that completion
                    $$.intervalForObserveInserted = window.setInterval(function () {
                        // parentNode will NOT be null when completed
                        if (selection.node().parentNode) {
                            window.clearInterval($$.intervalForObserveInserted);
                            $$.updateDimension();
                            if ($$.brush) {
                                $$.brush.update();
                            }
                            $$.config.oninit.call($$);
                            $$.redraw({
                                withTransform: true,
                                withUpdateXDomain: true,
                                withUpdateOrgXDomain: true,
                                withTransition: false,
                                withTransitionForTransform: false,
                                withLegend: true
                            });
                            selection.transition().style('opacity', 1);
                        }
                    }, 10);
                }
            });
        });
        observer.observe(selection.node(), { attributes: true, childList: true, characterData: true });
    };

    c3_chart_internal_fn.bindResize = function () {
        var $$ = this,
            config = $$.config;

        $$.resizeFunction = $$.generateResize();

        $$.resizeFunction.add(function () {
            config.onresize.call($$);
        });
        if (config.resize_auto) {
            $$.resizeFunction.add(function () {
                if ($$.resizeTimeout !== undefined) {
                    window.clearTimeout($$.resizeTimeout);
                }
                $$.resizeTimeout = window.setTimeout(function () {
                    delete $$.resizeTimeout;
                    $$.api.flush();
                }, 100);
            });
        }
        $$.resizeFunction.add(function () {
            config.onresized.call($$);
        });

        if (window.attachEvent) {
            window.attachEvent('onresize', $$.resizeFunction);
        } else if (window.addEventListener) {
            window.addEventListener('resize', $$.resizeFunction, false);
        } else {
            // fallback to this, if this is a very old browser
            var wrapper = window.onresize;
            if (!wrapper) {
                // create a wrapper that will call all charts
                wrapper = $$.generateResize();
            } else if (!wrapper.add || !wrapper.remove) {
                // there is already a handler registered, make sure we call it too
                wrapper = $$.generateResize();
                wrapper.add(window.onresize);
            }
            // add this graph to the wrapper, we will be removed if the user calls destroy
            wrapper.add($$.resizeFunction);
            window.onresize = wrapper;
        }
    };

    c3_chart_internal_fn.generateResize = function () {
        var resizeFunctions = [];
        function callResizeFunctions() {
            resizeFunctions.forEach(function (f) {
                f();
            });
        }
        callResizeFunctions.add = function (f) {
            resizeFunctions.push(f);
        };
        callResizeFunctions.remove = function (f) {
            for (var i = 0; i < resizeFunctions.length; i++) {
                if (resizeFunctions[i] === f) {
                    resizeFunctions.splice(i, 1);
                    break;
                }
            }
        };
        return callResizeFunctions;
    };

    c3_chart_internal_fn.endall = function (transition, callback) {
        var n = 0;
        transition.each(function () {
            ++n;
        }).each("end", function () {
            if (! --n) {
                callback.apply(this, arguments);
            }
        });
    };
    c3_chart_internal_fn.generateWait = function () {
        var transitionsToWait = [],
            f = function f(transition, callback) {
            var timer = setInterval(function () {
                var done = 0;
                transitionsToWait.forEach(function (t) {
                    if (t.empty()) {
                        done += 1;
                        return;
                    }
                    try {
                        t.transition();
                    } catch (e) {
                        done += 1;
                    }
                });
                if (done === transitionsToWait.length) {
                    clearInterval(timer);
                    if (callback) {
                        callback();
                    }
                }
            }, 10);
        };
        f.add = function (transition) {
            transitionsToWait.push(transition);
        };
        return f;
    };

    c3_chart_internal_fn.parseDate = function (date) {
        var $$ = this,
            parsedDate;
        if (date instanceof Date) {
            parsedDate = date;
        } else if (typeof date === 'string') {
            parsedDate = $$.dataTimeFormat($$.config.data_xFormat).parse(date);
        } else if (typeof date === 'number' && !isNaN(date)) {
            parsedDate = new Date(+date);
        }
        if (!parsedDate || isNaN(+parsedDate)) {
            window.console.error("Failed to parse x '" + date + "' to Date object");
        }
        return parsedDate;
    };

    c3_chart_internal_fn.isTabVisible = function () {
        var hidden;
        if (typeof document.hidden !== "undefined") {
            // Opera 12.10 and Firefox 18 and later support
            hidden = "hidden";
        } else if (typeof document.mozHidden !== "undefined") {
            hidden = "mozHidden";
        } else if (typeof document.msHidden !== "undefined") {
            hidden = "msHidden";
        } else if (typeof document.webkitHidden !== "undefined") {
            hidden = "webkitHidden";
        }

        return document[hidden] ? false : true;
    };

    c3_chart_internal_fn.getDefaultConfig = function () {
        var config = {
            bindto: '#chart',
            svg_classname: undefined,
            size_width: undefined,
            size_height: undefined,
            padding_left: undefined,
            padding_right: undefined,
            padding_top: undefined,
            padding_bottom: undefined,
            resize_auto: true,
            zoom_enabled: false,
            zoom_extent: undefined,
            zoom_privileged: false,
            zoom_rescale: false,
            zoom_onzoom: function zoom_onzoom() {},
            zoom_onzoomstart: function zoom_onzoomstart() {},
            zoom_onzoomend: function zoom_onzoomend() {},
            zoom_x_min: undefined,
            zoom_x_max: undefined,
            interaction_brighten: true,
            interaction_enabled: true,
            onmouseover: function onmouseover() {},
            onmouseout: function onmouseout() {},
            onresize: function onresize() {},
            onresized: function onresized() {},
            oninit: function oninit() {},
            onrendered: function onrendered() {},
            transition_duration: 350,
            data_x: undefined,
            data_xs: {},
            data_xFormat: '%Y-%m-%d',
            data_xLocaltime: true,
            data_xSort: true,
            data_idConverter: function data_idConverter(id) {
                return id;
            },
            data_names: {},
            data_classes: {},
            data_groups: [],
            data_axes: {},
            data_type: undefined,
            data_types: {},
            data_labels: {},
            data_order: 'desc',
            data_regions: {},
            data_color: undefined,
            data_colors: {},
            data_hide: false,
            data_filter: undefined,
            data_selection_enabled: false,
            data_selection_grouped: false,
            data_selection_isselectable: function data_selection_isselectable() {
                return true;
            },
            data_selection_multiple: true,
            data_selection_draggable: false,
            data_onclick: function data_onclick() {},
            data_onmouseover: function data_onmouseover() {},
            data_onmouseout: function data_onmouseout() {},
            data_onselected: function data_onselected() {},
            data_onunselected: function data_onunselected() {},
            data_url: undefined,
            data_headers: undefined,
            data_json: undefined,
            data_rows: undefined,
            data_columns: undefined,
            data_mimeType: undefined,
            data_keys: undefined,
            // configuration for no plot-able data supplied.
            data_empty_label_text: "",
            // subchart
            subchart_show: false,
            subchart_size_height: 60,
            subchart_axis_x_show: true,
            subchart_onbrush: function subchart_onbrush() {},
            // color
            color_pattern: [],
            color_threshold: {},
            // legend
            legend_show: true,
            legend_hide: false,
            legend_position: 'bottom',
            legend_inset_anchor: 'top-left',
            legend_inset_x: 10,
            legend_inset_y: 0,
            legend_inset_step: undefined,
            legend_item_onclick: undefined,
            legend_item_onmouseover: undefined,
            legend_item_onmouseout: undefined,
            legend_equally: false,
            legend_padding: 0,
            legend_item_tile_width: 10,
            legend_item_tile_height: 10,
            // axis
            axis_rotated: false,
            axis_x_show: true,
            axis_x_type: 'indexed',
            axis_x_localtime: true,
            axis_x_categories: [],
            axis_x_tick_centered: false,
            axis_x_tick_format: undefined,
            axis_x_tick_culling: {},
            axis_x_tick_culling_max: 10,
            axis_x_tick_count: undefined,
            axis_x_tick_fit: true,
            axis_x_tick_values: null,
            axis_x_tick_rotate: 0,
            axis_x_tick_outer: true,
            axis_x_tick_multiline: true,
            axis_x_tick_width: null,
            axis_x_max: undefined,
            axis_x_min: undefined,
            axis_x_padding: {},
            axis_x_height: undefined,
            axis_x_extent: undefined,
            axis_x_label: {},
            axis_y_show: true,
            axis_y_type: undefined,
            axis_y_max: undefined,
            axis_y_min: undefined,
            axis_y_inverted: false,
            axis_y_center: undefined,
            axis_y_inner: undefined,
            axis_y_label: {},
            axis_y_tick_format: undefined,
            axis_y_tick_outer: true,
            axis_y_tick_values: null,
            axis_y_tick_rotate: 0,
            axis_y_tick_count: undefined,
            axis_y_tick_time_value: undefined,
            axis_y_tick_time_interval: undefined,
            axis_y_padding: {},
            axis_y_default: undefined,
            axis_y2_show: false,
            axis_y2_max: undefined,
            axis_y2_min: undefined,
            axis_y2_inverted: false,
            axis_y2_center: undefined,
            axis_y2_inner: undefined,
            axis_y2_label: {},
            axis_y2_tick_format: undefined,
            axis_y2_tick_outer: true,
            axis_y2_tick_values: null,
            axis_y2_tick_count: undefined,
            axis_y2_padding: {},
            axis_y2_default: undefined,
            // grid
            grid_x_show: false,
            grid_x_type: 'tick',
            grid_x_lines: [],
            grid_y_show: false,
            // not used
            // grid_y_type: 'tick',
            grid_y_lines: [],
            grid_y_ticks: 10,
            grid_focus_show: true,
            grid_lines_front: true,
            // point - point of each data
            point_show: true,
            point_r: 2.5,
            point_sensitivity: 10,
            point_focus_expand_enabled: true,
            point_focus_expand_r: undefined,
            point_select_r: undefined,
            // line
            line_connectNull: false,
            line_step_type: 'step',
            // bar
            bar_width: undefined,
            bar_width_ratio: 0.6,
            bar_width_max: undefined,
            bar_zerobased: true,
            // area
            area_zerobased: true,
            area_above: false,
            // pie
            pie_label_show: true,
            pie_label_format: undefined,
            pie_label_threshold: 0.05,
            pie_label_ratio: undefined,
            pie_expand: {},
            pie_expand_duration: 50,
            // gauge
            gauge_fullCircle: false,
            gauge_label_show: true,
            gauge_label_format: undefined,
            gauge_min: 0,
            gauge_max: 100,
            gauge_startingAngle: -1 * Math.PI / 2,
            gauge_units: undefined,
            gauge_width: undefined,
            gauge_expand: {},
            gauge_expand_duration: 50,
            // donut
            donut_label_show: true,
            donut_label_format: undefined,
            donut_label_threshold: 0.05,
            donut_label_ratio: undefined,
            donut_width: undefined,
            donut_title: "",
            donut_expand: {},
            donut_expand_duration: 50,
            // spline
            spline_interpolation_type: 'cardinal',
            // region - region to change style
            regions: [],
            // tooltip - show when mouseover on each data
            tooltip_show: true,
            tooltip_grouped: true,
            tooltip_format_title: undefined,
            tooltip_format_name: undefined,
            tooltip_format_value: undefined,
            tooltip_position: undefined,
            tooltip_contents: function tooltip_contents(d, defaultTitleFormat, defaultValueFormat, color) {
                return this.getTooltipContent ? this.getTooltipContent(d, defaultTitleFormat, defaultValueFormat, color) : '';
            },
            tooltip_init_show: false,
            tooltip_init_x: 0,
            tooltip_init_position: { top: '0px', left: '50px' },
            tooltip_onshow: function tooltip_onshow() {},
            tooltip_onhide: function tooltip_onhide() {},
            // title
            title_text: undefined,
            title_padding: {
                top: 0,
                right: 0,
                bottom: 0,
                left: 0
            },
            title_position: 'top-center'
        };

        Object.keys(this.additionalConfig).forEach(function (key) {
            config[key] = this.additionalConfig[key];
        }, this);

        return config;
    };
    c3_chart_internal_fn.additionalConfig = {};

    c3_chart_internal_fn.loadConfig = function (config) {
        var this_config = this.config,
            target,
            keys,
            read;
        function find() {
            var key = keys.shift();
            //        console.log("key =>", key, ", target =>", target);
            if (key && target && (typeof target === 'undefined' ? 'undefined' : _typeof(target)) === 'object' && key in target) {
                target = target[key];
                return find();
            } else if (!key) {
                return target;
            } else {
                return undefined;
            }
        }
        Object.keys(this_config).forEach(function (key) {
            target = config;
            keys = key.split('_');
            read = find();
            //        console.log("CONFIG : ", key, read);
            if (isDefined(read)) {
                this_config[key] = read;
            }
        });
    };

    c3_chart_internal_fn.getScale = function (min, max, forTimeseries) {
        return (forTimeseries ? this.d3.time.scale() : this.d3.scale.linear()).range([min, max]);
    };
    c3_chart_internal_fn.getX = function (min, max, domain, offset) {
        var $$ = this,
            scale = $$.getScale(min, max, $$.isTimeSeries()),
            _scale = domain ? scale.domain(domain) : scale,
            key;
        // Define customized scale if categorized axis
        if ($$.isCategorized()) {
            offset = offset || function () {
                return 0;
            };
            scale = function scale(d, raw) {
                var v = _scale(d) + offset(d);
                return raw ? v : Math.ceil(v);
            };
        } else {
            scale = function scale(d, raw) {
                var v = _scale(d);
                return raw ? v : Math.ceil(v);
            };
        }
        // define functions
        for (key in _scale) {
            scale[key] = _scale[key];
        }
        scale.orgDomain = function () {
            return _scale.domain();
        };
        // define custom domain() for categorized axis
        if ($$.isCategorized()) {
            scale.domain = function (domain) {
                if (!arguments.length) {
                    domain = this.orgDomain();
                    return [domain[0], domain[1] + 1];
                }
                _scale.domain(domain);
                return scale;
            };
        }
        return scale;
    };
    c3_chart_internal_fn.getY = function (min, max, domain) {
        var scale = this.getScale(min, max, this.isTimeSeriesY());
        if (domain) {
            scale.domain(domain);
        }
        return scale;
    };
    c3_chart_internal_fn.getYScale = function (id) {
        return this.axis.getId(id) === 'y2' ? this.y2 : this.y;
    };
    c3_chart_internal_fn.getSubYScale = function (id) {
        return this.axis.getId(id) === 'y2' ? this.subY2 : this.subY;
    };
    c3_chart_internal_fn.updateScales = function () {
        var $$ = this,
            config = $$.config,
            forInit = !$$.x;
        // update edges
        $$.xMin = config.axis_rotated ? 1 : 0;
        $$.xMax = config.axis_rotated ? $$.height : $$.width;
        $$.yMin = config.axis_rotated ? 0 : $$.height;
        $$.yMax = config.axis_rotated ? $$.width : 1;
        $$.subXMin = $$.xMin;
        $$.subXMax = $$.xMax;
        $$.subYMin = config.axis_rotated ? 0 : $$.height2;
        $$.subYMax = config.axis_rotated ? $$.width2 : 1;
        // update scales
        $$.x = $$.getX($$.xMin, $$.xMax, forInit ? undefined : $$.x.orgDomain(), function () {
            return $$.xAxis.tickOffset();
        });
        $$.y = $$.getY($$.yMin, $$.yMax, forInit ? config.axis_y_default : $$.y.domain());
        $$.y2 = $$.getY($$.yMin, $$.yMax, forInit ? config.axis_y2_default : $$.y2.domain());
        $$.subX = $$.getX($$.xMin, $$.xMax, $$.orgXDomain, function (d) {
            return d % 1 ? 0 : $$.subXAxis.tickOffset();
        });
        $$.subY = $$.getY($$.subYMin, $$.subYMax, forInit ? config.axis_y_default : $$.subY.domain());
        $$.subY2 = $$.getY($$.subYMin, $$.subYMax, forInit ? config.axis_y2_default : $$.subY2.domain());
        // update axes
        $$.xAxisTickFormat = $$.axis.getXAxisTickFormat();
        $$.xAxisTickValues = $$.axis.getXAxisTickValues();
        $$.yAxisTickValues = $$.axis.getYAxisTickValues();
        $$.y2AxisTickValues = $$.axis.getY2AxisTickValues();

        $$.xAxis = $$.axis.getXAxis($$.x, $$.xOrient, $$.xAxisTickFormat, $$.xAxisTickValues, config.axis_x_tick_outer);
        $$.subXAxis = $$.axis.getXAxis($$.subX, $$.subXOrient, $$.xAxisTickFormat, $$.xAxisTickValues, config.axis_x_tick_outer);
        $$.yAxis = $$.axis.getYAxis($$.y, $$.yOrient, config.axis_y_tick_format, $$.yAxisTickValues, config.axis_y_tick_outer);
        $$.y2Axis = $$.axis.getYAxis($$.y2, $$.y2Orient, config.axis_y2_tick_format, $$.y2AxisTickValues, config.axis_y2_tick_outer);

        // Set initialized scales to brush and zoom
        if (!forInit) {
            if ($$.brush) {
                $$.brush.scale($$.subX);
            }
            if (config.zoom_enabled) {
                $$.zoom.scale($$.x);
            }
        }
        // update for arc
        if ($$.updateArc) {
            $$.updateArc();
        }
    };

    c3_chart_internal_fn.getYDomainMin = function (targets) {
        var $$ = this,
            config = $$.config,
            ids = $$.mapToIds(targets),
            ys = $$.getValuesAsIdKeyed(targets),
            j,
            k,
            baseId,
            idsInGroup,
            id,
            hasNegativeValue;
        if (config.data_groups.length > 0) {
            hasNegativeValue = $$.hasNegativeValueInTargets(targets);
            for (j = 0; j < config.data_groups.length; j++) {
                // Determine baseId
                idsInGroup = config.data_groups[j].filter(function (id) {
                    return ids.indexOf(id) >= 0;
                });
                if (idsInGroup.length === 0) {
                    continue;
                }
                baseId = idsInGroup[0];
                // Consider negative values
                if (hasNegativeValue && ys[baseId]) {
                    ys[baseId].forEach(function (v, i) {
                        ys[baseId][i] = v < 0 ? v : 0;
                    });
                }
                // Compute min
                for (k = 1; k < idsInGroup.length; k++) {
                    id = idsInGroup[k];
                    if (!ys[id]) {
                        continue;
                    }
                    ys[id].forEach(function (v, i) {
                        if ($$.axis.getId(id) === $$.axis.getId(baseId) && ys[baseId] && !(hasNegativeValue && +v > 0)) {
                            ys[baseId][i] += +v;
                        }
                    });
                }
            }
        }
        return $$.d3.min(Object.keys(ys).map(function (key) {
            return $$.d3.min(ys[key]);
        }));
    };
    c3_chart_internal_fn.getYDomainMax = function (targets) {
        var $$ = this,
            config = $$.config,
            ids = $$.mapToIds(targets),
            ys = $$.getValuesAsIdKeyed(targets),
            j,
            k,
            baseId,
            idsInGroup,
            id,
            hasPositiveValue;
        if (config.data_groups.length > 0) {
            hasPositiveValue = $$.hasPositiveValueInTargets(targets);
            for (j = 0; j < config.data_groups.length; j++) {
                // Determine baseId
                idsInGroup = config.data_groups[j].filter(function (id) {
                    return ids.indexOf(id) >= 0;
                });
                if (idsInGroup.length === 0) {
                    continue;
                }
                baseId = idsInGroup[0];
                // Consider positive values
                if (hasPositiveValue && ys[baseId]) {
                    ys[baseId].forEach(function (v, i) {
                        ys[baseId][i] = v > 0 ? v : 0;
                    });
                }
                // Compute max
                for (k = 1; k < idsInGroup.length; k++) {
                    id = idsInGroup[k];
                    if (!ys[id]) {
                        continue;
                    }
                    ys[id].forEach(function (v, i) {
                        if ($$.axis.getId(id) === $$.axis.getId(baseId) && ys[baseId] && !(hasPositiveValue && +v < 0)) {
                            ys[baseId][i] += +v;
                        }
                    });
                }
            }
        }
        return $$.d3.max(Object.keys(ys).map(function (key) {
            return $$.d3.max(ys[key]);
        }));
    };
    c3_chart_internal_fn.getYDomain = function (targets, axisId, xDomain) {
        var $$ = this,
            config = $$.config,
            targetsByAxisId = targets.filter(function (t) {
            return $$.axis.getId(t.id) === axisId;
        }),
            yTargets = xDomain ? $$.filterByXDomain(targetsByAxisId, xDomain) : targetsByAxisId,
            yMin = axisId === 'y2' ? config.axis_y2_min : config.axis_y_min,
            yMax = axisId === 'y2' ? config.axis_y2_max : config.axis_y_max,
            yDomainMin = $$.getYDomainMin(yTargets),
            yDomainMax = $$.getYDomainMax(yTargets),
            domain,
            domainLength,
            padding,
            padding_top,
            padding_bottom,
            center = axisId === 'y2' ? config.axis_y2_center : config.axis_y_center,
            yDomainAbs,
            lengths,
            diff,
            ratio,
            isAllPositive,
            isAllNegative,
            isZeroBased = $$.hasType('bar', yTargets) && config.bar_zerobased || $$.hasType('area', yTargets) && config.area_zerobased,
            isInverted = axisId === 'y2' ? config.axis_y2_inverted : config.axis_y_inverted,
            showHorizontalDataLabel = $$.hasDataLabel() && config.axis_rotated,
            showVerticalDataLabel = $$.hasDataLabel() && !config.axis_rotated;

        // MEMO: avoid inverting domain unexpectedly
        yDomainMin = isValue(yMin) ? yMin : isValue(yMax) ? yDomainMin < yMax ? yDomainMin : yMax - 10 : yDomainMin;
        yDomainMax = isValue(yMax) ? yMax : isValue(yMin) ? yMin < yDomainMax ? yDomainMax : yMin + 10 : yDomainMax;

        if (yTargets.length === 0) {
            // use current domain if target of axisId is none
            return axisId === 'y2' ? $$.y2.domain() : $$.y.domain();
        }
        if (isNaN(yDomainMin)) {
            // set minimum to zero when not number
            yDomainMin = 0;
        }
        if (isNaN(yDomainMax)) {
            // set maximum to have same value as yDomainMin
            yDomainMax = yDomainMin;
        }
        if (yDomainMin === yDomainMax) {
            yDomainMin < 0 ? yDomainMax = 0 : yDomainMin = 0;
        }
        isAllPositive = yDomainMin >= 0 && yDomainMax >= 0;
        isAllNegative = yDomainMin <= 0 && yDomainMax <= 0;

        // Cancel zerobased if axis_*_min / axis_*_max specified
        if (isValue(yMin) && isAllPositive || isValue(yMax) && isAllNegative) {
            isZeroBased = false;
        }

        // Bar/Area chart should be 0-based if all positive|negative
        if (isZeroBased) {
            if (isAllPositive) {
                yDomainMin = 0;
            }
            if (isAllNegative) {
                yDomainMax = 0;
            }
        }

        domainLength = Math.abs(yDomainMax - yDomainMin);
        padding = padding_top = padding_bottom = domainLength * 0.1;

        if (typeof center !== 'undefined') {
            yDomainAbs = Math.max(Math.abs(yDomainMin), Math.abs(yDomainMax));
            yDomainMax = center + yDomainAbs;
            yDomainMin = center - yDomainAbs;
        }
        // add padding for data label
        if (showHorizontalDataLabel) {
            lengths = $$.getDataLabelLength(yDomainMin, yDomainMax, 'width');
            diff = diffDomain($$.y.range());
            ratio = [lengths[0] / diff, lengths[1] / diff];
            padding_top += domainLength * (ratio[1] / (1 - ratio[0] - ratio[1]));
            padding_bottom += domainLength * (ratio[0] / (1 - ratio[0] - ratio[1]));
        } else if (showVerticalDataLabel) {
            lengths = $$.getDataLabelLength(yDomainMin, yDomainMax, 'height');
            padding_top += $$.axis.convertPixelsToAxisPadding(lengths[1], domainLength);
            padding_bottom += $$.axis.convertPixelsToAxisPadding(lengths[0], domainLength);
        }
        if (axisId === 'y' && notEmpty(config.axis_y_padding)) {
            padding_top = $$.axis.getPadding(config.axis_y_padding, 'top', padding_top, domainLength);
            padding_bottom = $$.axis.getPadding(config.axis_y_padding, 'bottom', padding_bottom, domainLength);
        }
        if (axisId === 'y2' && notEmpty(config.axis_y2_padding)) {
            padding_top = $$.axis.getPadding(config.axis_y2_padding, 'top', padding_top, domainLength);
            padding_bottom = $$.axis.getPadding(config.axis_y2_padding, 'bottom', padding_bottom, domainLength);
        }
        // Bar/Area chart should be 0-based if all positive|negative
        if (isZeroBased) {
            if (isAllPositive) {
                padding_bottom = yDomainMin;
            }
            if (isAllNegative) {
                padding_top = -yDomainMax;
            }
        }
        domain = [yDomainMin - padding_bottom, yDomainMax + padding_top];
        return isInverted ? domain.reverse() : domain;
    };
    c3_chart_internal_fn.getXDomainMin = function (targets) {
        var $$ = this,
            config = $$.config;
        return isDefined(config.axis_x_min) ? $$.isTimeSeries() ? this.parseDate(config.axis_x_min) : config.axis_x_min : $$.d3.min(targets, function (t) {
            return $$.d3.min(t.values, function (v) {
                return v.x;
            });
        });
    };
    c3_chart_internal_fn.getXDomainMax = function (targets) {
        var $$ = this,
            config = $$.config;
        return isDefined(config.axis_x_max) ? $$.isTimeSeries() ? this.parseDate(config.axis_x_max) : config.axis_x_max : $$.d3.max(targets, function (t) {
            return $$.d3.max(t.values, function (v) {
                return v.x;
            });
        });
    };
    c3_chart_internal_fn.getXDomainPadding = function (domain) {
        var $$ = this,
            config = $$.config,
            diff = domain[1] - domain[0],
            maxDataCount,
            padding,
            paddingLeft,
            paddingRight;
        if ($$.isCategorized()) {
            padding = 0;
        } else if ($$.hasType('bar')) {
            maxDataCount = $$.getMaxDataCount();
            padding = maxDataCount > 1 ? diff / (maxDataCount - 1) / 2 : 0.5;
        } else {
            padding = diff * 0.01;
        }
        if (_typeof(config.axis_x_padding) === 'object' && notEmpty(config.axis_x_padding)) {
            paddingLeft = isValue(config.axis_x_padding.left) ? config.axis_x_padding.left : padding;
            paddingRight = isValue(config.axis_x_padding.right) ? config.axis_x_padding.right : padding;
        } else if (typeof config.axis_x_padding === 'number') {
            paddingLeft = paddingRight = config.axis_x_padding;
        } else {
            paddingLeft = paddingRight = padding;
        }
        return { left: paddingLeft, right: paddingRight };
    };
    c3_chart_internal_fn.getXDomain = function (targets) {
        var $$ = this,
            xDomain = [$$.getXDomainMin(targets), $$.getXDomainMax(targets)],
            firstX = xDomain[0],
            lastX = xDomain[1],
            padding = $$.getXDomainPadding(xDomain),
            min = 0,
            max = 0;
        // show center of x domain if min and max are the same
        if (firstX - lastX === 0 && !$$.isCategorized()) {
            if ($$.isTimeSeries()) {
                firstX = new Date(firstX.getTime() * 0.5);
                lastX = new Date(lastX.getTime() * 1.5);
            } else {
                firstX = firstX === 0 ? 1 : firstX * 0.5;
                lastX = lastX === 0 ? -1 : lastX * 1.5;
            }
        }
        if (firstX || firstX === 0) {
            min = $$.isTimeSeries() ? new Date(firstX.getTime() - padding.left) : firstX - padding.left;
        }
        if (lastX || lastX === 0) {
            max = $$.isTimeSeries() ? new Date(lastX.getTime() + padding.right) : lastX + padding.right;
        }
        return [min, max];
    };
    c3_chart_internal_fn.updateXDomain = function (targets, withUpdateXDomain, withUpdateOrgXDomain, withTrim, domain) {
        var $$ = this,
            config = $$.config;

        if (withUpdateOrgXDomain) {
            $$.x.domain(domain ? domain : $$.d3.extent($$.getXDomain(targets)));
            $$.orgXDomain = $$.x.domain();
            if (config.zoom_enabled) {
                $$.zoom.scale($$.x).updateScaleExtent();
            }
            $$.subX.domain($$.x.domain());
            if ($$.brush) {
                $$.brush.scale($$.subX);
            }
        }
        if (withUpdateXDomain) {
            $$.x.domain(domain ? domain : !$$.brush || $$.brush.empty() ? $$.orgXDomain : $$.brush.extent());
            if (config.zoom_enabled) {
                $$.zoom.scale($$.x).updateScaleExtent();
            }
        }

        // Trim domain when too big by zoom mousemove event
        if (withTrim) {
            $$.x.domain($$.trimXDomain($$.x.orgDomain()));
        }

        return $$.x.domain();
    };
    c3_chart_internal_fn.trimXDomain = function (domain) {
        var zoomDomain = this.getZoomDomain(),
            min = zoomDomain[0],
            max = zoomDomain[1];
        if (domain[0] <= min) {
            domain[1] = +domain[1] + (min - domain[0]);
            domain[0] = min;
        }
        if (max <= domain[1]) {
            domain[0] = +domain[0] - (domain[1] - max);
            domain[1] = max;
        }
        return domain;
    };

    c3_chart_internal_fn.isX = function (key) {
        var $$ = this,
            config = $$.config;
        return config.data_x && key === config.data_x || notEmpty(config.data_xs) && hasValue(config.data_xs, key);
    };
    c3_chart_internal_fn.isNotX = function (key) {
        return !this.isX(key);
    };
    c3_chart_internal_fn.getXKey = function (id) {
        var $$ = this,
            config = $$.config;
        return config.data_x ? config.data_x : notEmpty(config.data_xs) ? config.data_xs[id] : null;
    };
    c3_chart_internal_fn.getXValuesOfXKey = function (key, targets) {
        var $$ = this,
            xValues,
            ids = targets && notEmpty(targets) ? $$.mapToIds(targets) : [];
        ids.forEach(function (id) {
            if ($$.getXKey(id) === key) {
                xValues = $$.data.xs[id];
            }
        });
        return xValues;
    };
    c3_chart_internal_fn.getIndexByX = function (x) {
        var $$ = this,
            data = $$.filterByX($$.data.targets, x);
        return data.length ? data[0].index : null;
    };
    c3_chart_internal_fn.getXValue = function (id, i) {
        var $$ = this;
        return id in $$.data.xs && $$.data.xs[id] && isValue($$.data.xs[id][i]) ? $$.data.xs[id][i] : i;
    };
    c3_chart_internal_fn.getOtherTargetXs = function () {
        var $$ = this,
            idsForX = Object.keys($$.data.xs);
        return idsForX.length ? $$.data.xs[idsForX[0]] : null;
    };
    c3_chart_internal_fn.getOtherTargetX = function (index) {
        var xs = this.getOtherTargetXs();
        return xs && index < xs.length ? xs[index] : null;
    };
    c3_chart_internal_fn.addXs = function (xs) {
        var $$ = this;
        Object.keys(xs).forEach(function (id) {
            $$.config.data_xs[id] = xs[id];
        });
    };
    c3_chart_internal_fn.hasMultipleX = function (xs) {
        return this.d3.set(Object.keys(xs).map(function (id) {
            return xs[id];
        })).size() > 1;
    };
    c3_chart_internal_fn.isMultipleX = function () {
        return notEmpty(this.config.data_xs) || !this.config.data_xSort || this.hasType('scatter');
    };
    c3_chart_internal_fn.addName = function (data) {
        var $$ = this,
            name;
        if (data) {
            name = $$.config.data_names[data.id];
            data.name = name !== undefined ? name : data.id;
        }
        return data;
    };
    c3_chart_internal_fn.getValueOnIndex = function (values, index) {
        var valueOnIndex = values.filter(function (v) {
            return v.index === index;
        });
        return valueOnIndex.length ? valueOnIndex[0] : null;
    };
    c3_chart_internal_fn.updateTargetX = function (targets, x) {
        var $$ = this;
        targets.forEach(function (t) {
            t.values.forEach(function (v, i) {
                v.x = $$.generateTargetX(x[i], t.id, i);
            });
            $$.data.xs[t.id] = x;
        });
    };
    c3_chart_internal_fn.updateTargetXs = function (targets, xs) {
        var $$ = this;
        targets.forEach(function (t) {
            if (xs[t.id]) {
                $$.updateTargetX([t], xs[t.id]);
            }
        });
    };
    c3_chart_internal_fn.generateTargetX = function (rawX, id, index) {
        var $$ = this,
            x;
        if ($$.isTimeSeries()) {
            x = rawX ? $$.parseDate(rawX) : $$.parseDate($$.getXValue(id, index));
        } else if ($$.isCustomX() && !$$.isCategorized()) {
            x = isValue(rawX) ? +rawX : $$.getXValue(id, index);
        } else {
            x = index;
        }
        return x;
    };
    c3_chart_internal_fn.cloneTarget = function (target) {
        return {
            id: target.id,
            id_org: target.id_org,
            values: target.values.map(function (d) {
                return { x: d.x, value: d.value, id: d.id };
            })
        };
    };
    c3_chart_internal_fn.updateXs = function () {
        var $$ = this;
        if ($$.data.targets.length) {
            $$.xs = [];
            $$.data.targets[0].values.forEach(function (v) {
                $$.xs[v.index] = v.x;
            });
        }
    };
    c3_chart_internal_fn.getPrevX = function (i) {
        var x = this.xs[i - 1];
        return typeof x !== 'undefined' ? x : null;
    };
    c3_chart_internal_fn.getNextX = function (i) {
        var x = this.xs[i + 1];
        return typeof x !== 'undefined' ? x : null;
    };
    c3_chart_internal_fn.getMaxDataCount = function () {
        var $$ = this;
        return $$.d3.max($$.data.targets, function (t) {
            return t.values.length;
        });
    };
    c3_chart_internal_fn.getMaxDataCountTarget = function (targets) {
        var length = targets.length,
            max = 0,
            maxTarget;
        if (length > 1) {
            targets.forEach(function (t) {
                if (t.values.length > max) {
                    maxTarget = t;
                    max = t.values.length;
                }
            });
        } else {
            maxTarget = length ? targets[0] : null;
        }
        return maxTarget;
    };
    c3_chart_internal_fn.getEdgeX = function (targets) {
        var $$ = this;
        return !targets.length ? [0, 0] : [$$.d3.min(targets, function (t) {
            return t.values[0].x;
        }), $$.d3.max(targets, function (t) {
            return t.values[t.values.length - 1].x;
        })];
    };
    c3_chart_internal_fn.mapToIds = function (targets) {
        return targets.map(function (d) {
            return d.id;
        });
    };
    c3_chart_internal_fn.mapToTargetIds = function (ids) {
        var $$ = this;
        return ids ? [].concat(ids) : $$.mapToIds($$.data.targets);
    };
    c3_chart_internal_fn.hasTarget = function (targets, id) {
        var ids = this.mapToIds(targets),
            i;
        for (i = 0; i < ids.length; i++) {
            if (ids[i] === id) {
                return true;
            }
        }
        return false;
    };
    c3_chart_internal_fn.isTargetToShow = function (targetId) {
        return this.hiddenTargetIds.indexOf(targetId) < 0;
    };
    c3_chart_internal_fn.isLegendToShow = function (targetId) {
        return this.hiddenLegendIds.indexOf(targetId) < 0;
    };
    c3_chart_internal_fn.filterTargetsToShow = function (targets) {
        var $$ = this;
        return targets.filter(function (t) {
            return $$.isTargetToShow(t.id);
        });
    };
    c3_chart_internal_fn.mapTargetsToUniqueXs = function (targets) {
        var $$ = this;
        var xs = $$.d3.set($$.d3.merge(targets.map(function (t) {
            return t.values.map(function (v) {
                return +v.x;
            });
        }))).values();
        xs = $$.isTimeSeries() ? xs.map(function (x) {
            return new Date(+x);
        }) : xs.map(function (x) {
            return +x;
        });
        return xs.sort(function (a, b) {
            return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;
        });
    };
    c3_chart_internal_fn.addHiddenTargetIds = function (targetIds) {
        this.hiddenTargetIds = this.hiddenTargetIds.concat(targetIds);
    };
    c3_chart_internal_fn.removeHiddenTargetIds = function (targetIds) {
        this.hiddenTargetIds = this.hiddenTargetIds.filter(function (id) {
            return targetIds.indexOf(id) < 0;
        });
    };
    c3_chart_internal_fn.addHiddenLegendIds = function (targetIds) {
        this.hiddenLegendIds = this.hiddenLegendIds.concat(targetIds);
    };
    c3_chart_internal_fn.removeHiddenLegendIds = function (targetIds) {
        this.hiddenLegendIds = this.hiddenLegendIds.filter(function (id) {
            return targetIds.indexOf(id) < 0;
        });
    };
    c3_chart_internal_fn.getValuesAsIdKeyed = function (targets) {
        var ys = {};
        targets.forEach(function (t) {
            ys[t.id] = [];
            t.values.forEach(function (v) {
                ys[t.id].push(v.value);
            });
        });
        return ys;
    };
    c3_chart_internal_fn.checkValueInTargets = function (targets, checker) {
        var ids = Object.keys(targets),
            i,
            j,
            values;
        for (i = 0; i < ids.length; i++) {
            values = targets[ids[i]].values;
            for (j = 0; j < values.length; j++) {
                if (checker(values[j].value)) {
                    return true;
                }
            }
        }
        return false;
    };
    c3_chart_internal_fn.hasNegativeValueInTargets = function (targets) {
        return this.checkValueInTargets(targets, function (v) {
            return v < 0;
        });
    };
    c3_chart_internal_fn.hasPositiveValueInTargets = function (targets) {
        return this.checkValueInTargets(targets, function (v) {
            return v > 0;
        });
    };
    c3_chart_internal_fn.isOrderDesc = function () {
        var config = this.config;
        return typeof config.data_order === 'string' && config.data_order.toLowerCase() === 'desc';
    };
    c3_chart_internal_fn.isOrderAsc = function () {
        var config = this.config;
        return typeof config.data_order === 'string' && config.data_order.toLowerCase() === 'asc';
    };
    c3_chart_internal_fn.orderTargets = function (targets) {
        var $$ = this,
            config = $$.config,
            orderAsc = $$.isOrderAsc(),
            orderDesc = $$.isOrderDesc();
        if (orderAsc || orderDesc) {
            targets.sort(function (t1, t2) {
                var reducer = function reducer(p, c) {
                    return p + Math.abs(c.value);
                };
                var t1Sum = t1.values.reduce(reducer, 0),
                    t2Sum = t2.values.reduce(reducer, 0);
                return orderAsc ? t2Sum - t1Sum : t1Sum - t2Sum;
            });
        } else if (isFunction(config.data_order)) {
            targets.sort(config.data_order);
        } // TODO: accept name array for order
        return targets;
    };
    c3_chart_internal_fn.filterByX = function (targets, x) {
        return this.d3.merge(targets.map(function (t) {
            return t.values;
        })).filter(function (v) {
            return v.x - x === 0;
        });
    };
    c3_chart_internal_fn.filterRemoveNull = function (data) {
        return data.filter(function (d) {
            return isValue(d.value);
        });
    };
    c3_chart_internal_fn.filterByXDomain = function (targets, xDomain) {
        return targets.map(function (t) {
            return {
                id: t.id,
                id_org: t.id_org,
                values: t.values.filter(function (v) {
                    return xDomain[0] <= v.x && v.x <= xDomain[1];
                })
            };
        });
    };
    c3_chart_internal_fn.hasDataLabel = function () {
        var config = this.config;
        if (typeof config.data_labels === 'boolean' && config.data_labels) {
            return true;
        } else if (_typeof(config.data_labels) === 'object' && notEmpty(config.data_labels)) {
            return true;
        }
        return false;
    };
    c3_chart_internal_fn.getDataLabelLength = function (min, max, key) {
        var $$ = this,
            lengths = [0, 0],
            paddingCoef = 1.3;
        $$.selectChart.select('svg').selectAll('.dummy').data([min, max]).enter().append('text').text(function (d) {
            return $$.dataLabelFormat(d.id)(d);
        }).each(function (d, i) {
            lengths[i] = this.getBoundingClientRect()[key] * paddingCoef;
        }).remove();
        return lengths;
    };
    c3_chart_internal_fn.isNoneArc = function (d) {
        return this.hasTarget(this.data.targets, d.id);
    }, c3_chart_internal_fn.isArc = function (d) {
        return 'data' in d && this.hasTarget(this.data.targets, d.data.id);
    };
    c3_chart_internal_fn.findSameXOfValues = function (values, index) {
        var i,
            targetX = values[index].x,
            sames = [];
        for (i = index - 1; i >= 0; i--) {
            if (targetX !== values[i].x) {
                break;
            }
            sames.push(values[i]);
        }
        for (i = index; i < values.length; i++) {
            if (targetX !== values[i].x) {
                break;
            }
            sames.push(values[i]);
        }
        return sames;
    };

    c3_chart_internal_fn.findClosestFromTargets = function (targets, pos) {
        var $$ = this,
            candidates;

        // map to array of closest points of each target
        candidates = targets.map(function (target) {
            return $$.findClosest(target.values, pos);
        });

        // decide closest point and return
        return $$.findClosest(candidates, pos);
    };
    c3_chart_internal_fn.findClosest = function (values, pos) {
        var $$ = this,
            minDist = $$.config.point_sensitivity,
            closest;

        // find mouseovering bar
        values.filter(function (v) {
            return v && $$.isBarType(v.id);
        }).forEach(function (v) {
            var shape = $$.main.select('.' + CLASS.bars + $$.getTargetSelectorSuffix(v.id) + ' .' + CLASS.bar + '-' + v.index).node();
            if (!closest && $$.isWithinBar(shape)) {
                closest = v;
            }
        });

        // find closest point from non-bar
        values.filter(function (v) {
            return v && !$$.isBarType(v.id);
        }).forEach(function (v) {
            var d = $$.dist(v, pos);
            if (d < minDist) {
                minDist = d;
                closest = v;
            }
        });

        return closest;
    };
    c3_chart_internal_fn.dist = function (data, pos) {
        var $$ = this,
            config = $$.config,
            xIndex = config.axis_rotated ? 1 : 0,
            yIndex = config.axis_rotated ? 0 : 1,
            y = $$.circleY(data, data.index),
            x = $$.x(data.x);
        return Math.sqrt(Math.pow(x - pos[xIndex], 2) + Math.pow(y - pos[yIndex], 2));
    };
    c3_chart_internal_fn.convertValuesToStep = function (values) {
        var converted = [].concat(values),
            i;

        if (!this.isCategorized()) {
            return values;
        }

        for (i = values.length + 1; 0 < i; i--) {
            converted[i] = converted[i - 1];
        }

        converted[0] = {
            x: converted[0].x - 1,
            value: converted[0].value,
            id: converted[0].id
        };
        converted[values.length + 1] = {
            x: converted[values.length].x + 1,
            value: converted[values.length].value,
            id: converted[values.length].id
        };

        return converted;
    };
    c3_chart_internal_fn.updateDataAttributes = function (name, attrs) {
        var $$ = this,
            config = $$.config,
            current = config['data_' + name];
        if (typeof attrs === 'undefined') {
            return current;
        }
        Object.keys(attrs).forEach(function (id) {
            current[id] = attrs[id];
        });
        $$.redraw({ withLegend: true });
        return current;
    };

    c3_chart_internal_fn.convertUrlToData = function (url, mimeType, headers, keys, done) {
        var $$ = this,
            type = mimeType ? mimeType : 'csv';
        var req = $$.d3.xhr(url);
        if (headers) {
            Object.keys(headers).forEach(function (header) {
                req.header(header, headers[header]);
            });
        }
        req.get(function (error, data) {
            var d;
            if (!data) {
                throw new Error(error.responseURL + ' ' + error.status + ' (' + error.statusText + ')');
            }
            if (type === 'json') {
                d = $$.convertJsonToData(JSON.parse(data.response), keys);
            } else if (type === 'tsv') {
                d = $$.convertTsvToData(data.response);
            } else {
                d = $$.convertCsvToData(data.response);
            }
            done.call($$, d);
        });
    };
    c3_chart_internal_fn.convertXsvToData = function (xsv, parser) {
        var rows = parser.parseRows(xsv),
            d;
        if (rows.length === 1) {
            d = [{}];
            rows[0].forEach(function (id) {
                d[0][id] = null;
            });
        } else {
            d = parser.parse(xsv);
        }
        return d;
    };
    c3_chart_internal_fn.convertCsvToData = function (csv) {
        return this.convertXsvToData(csv, this.d3.csv);
    };
    c3_chart_internal_fn.convertTsvToData = function (tsv) {
        return this.convertXsvToData(tsv, this.d3.tsv);
    };
    c3_chart_internal_fn.convertJsonToData = function (json, keys) {
        var $$ = this,
            new_rows = [],
            targetKeys,
            data;
        if (keys) {
            // when keys specified, json would be an array that includes objects
            if (keys.x) {
                targetKeys = keys.value.concat(keys.x);
                $$.config.data_x = keys.x;
            } else {
                targetKeys = keys.value;
            }
            new_rows.push(targetKeys);
            json.forEach(function (o) {
                var new_row = [];
                targetKeys.forEach(function (key) {
                    // convert undefined to null because undefined data will be removed in convertDataToTargets()
                    var v = $$.findValueInJson(o, key);
                    if (isUndefined(v)) {
                        v = null;
                    }
                    new_row.push(v);
                });
                new_rows.push(new_row);
            });
            data = $$.convertRowsToData(new_rows);
        } else {
            Object.keys(json).forEach(function (key) {
                new_rows.push([key].concat(json[key]));
            });
            data = $$.convertColumnsToData(new_rows);
        }
        return data;
    };
    c3_chart_internal_fn.findValueInJson = function (object, path) {
        path = path.replace(/\[(\w+)\]/g, '.$1'); // convert indexes to properties (replace [] with .)
        path = path.replace(/^\./, ''); // strip a leading dot
        var pathArray = path.split('.');
        for (var i = 0; i < pathArray.length; ++i) {
            var k = pathArray[i];
            if (k in object) {
                object = object[k];
            } else {
                return;
            }
        }
        return object;
    };
    c3_chart_internal_fn.convertRowsToData = function (rows) {
        var keys = rows[0],
            new_row = {},
            new_rows = [],
            i,
            j;
        for (i = 1; i < rows.length; i++) {
            new_row = {};
            for (j = 0; j < rows[i].length; j++) {
                if (isUndefined(rows[i][j])) {
                    throw new Error("Source data is missing a component at (" + i + "," + j + ")!");
                }
                new_row[keys[j]] = rows[i][j];
            }
            new_rows.push(new_row);
        }
        return new_rows;
    };
    c3_chart_internal_fn.convertColumnsToData = function (columns) {
        var new_rows = [],
            i,
            j,
            key;
        for (i = 0; i < columns.length; i++) {
            key = columns[i][0];
            for (j = 1; j < columns[i].length; j++) {
                if (isUndefined(new_rows[j - 1])) {
                    new_rows[j - 1] = {};
                }
                if (isUndefined(columns[i][j])) {
                    throw new Error("Source data is missing a component at (" + i + "," + j + ")!");
                }
                new_rows[j - 1][key] = columns[i][j];
            }
        }
        return new_rows;
    };
    c3_chart_internal_fn.convertDataToTargets = function (data, appendXs) {
        var $$ = this,
            config = $$.config,
            ids = $$.d3.keys(data[0]).filter($$.isNotX, $$),
            xs = $$.d3.keys(data[0]).filter($$.isX, $$),
            targets;

        // save x for update data by load when custom x and c3.x API
        ids.forEach(function (id) {
            var xKey = $$.getXKey(id);

            if ($$.isCustomX() || $$.isTimeSeries()) {
                // if included in input data
                if (xs.indexOf(xKey) >= 0) {
                    $$.data.xs[id] = (appendXs && $$.data.xs[id] ? $$.data.xs[id] : []).concat(data.map(function (d) {
                        return d[xKey];
                    }).filter(isValue).map(function (rawX, i) {
                        return $$.generateTargetX(rawX, id, i);
                    }));
                }
                // if not included in input data, find from preloaded data of other id's x
                else if (config.data_x) {
                        $$.data.xs[id] = $$.getOtherTargetXs();
                    }
                    // if not included in input data, find from preloaded data
                    else if (notEmpty(config.data_xs)) {
                            $$.data.xs[id] = $$.getXValuesOfXKey(xKey, $$.data.targets);
                        }
                // MEMO: if no x included, use same x of current will be used
            } else {
                $$.data.xs[id] = data.map(function (d, i) {
                    return i;
                });
            }
        });

        // check x is defined
        ids.forEach(function (id) {
            if (!$$.data.xs[id]) {
                throw new Error('x is not defined for id = "' + id + '".');
            }
        });

        // convert to target
        targets = ids.map(function (id, index) {
            var convertedId = config.data_idConverter(id);
            return {
                id: convertedId,
                id_org: id,
                values: data.map(function (d, i) {
                    var xKey = $$.getXKey(id),
                        rawX = d[xKey],
                        value = d[id] !== null && !isNaN(d[id]) ? +d[id] : null,
                        x;
                    // use x as categories if custom x and categorized
                    if ($$.isCustomX() && $$.isCategorized() && index === 0 && !isUndefined(rawX)) {
                        if (index === 0 && i === 0) {
                            config.axis_x_categories = [];
                        }
                        x = config.axis_x_categories.indexOf(rawX);
                        if (x === -1) {
                            x = config.axis_x_categories.length;
                            config.axis_x_categories.push(rawX);
                        }
                    } else {
                        x = $$.generateTargetX(rawX, id, i);
                    }
                    // mark as x = undefined if value is undefined and filter to remove after mapped
                    if (isUndefined(d[id]) || $$.data.xs[id].length <= i) {
                        x = undefined;
                    }
                    return { x: x, value: value, id: convertedId };
                }).filter(function (v) {
                    return isDefined(v.x);
                })
            };
        });

        // finish targets
        targets.forEach(function (t) {
            var i;
            // sort values by its x
            if (config.data_xSort) {
                t.values = t.values.sort(function (v1, v2) {
                    var x1 = v1.x || v1.x === 0 ? v1.x : Infinity,
                        x2 = v2.x || v2.x === 0 ? v2.x : Infinity;
                    return x1 - x2;
                });
            }
            // indexing each value
            i = 0;
            t.values.forEach(function (v) {
                v.index = i++;
            });
            // this needs to be sorted because its index and value.index is identical
            $$.data.xs[t.id].sort(function (v1, v2) {
                return v1 - v2;
            });
        });

        // cache information about values
        $$.hasNegativeValue = $$.hasNegativeValueInTargets(targets);
        $$.hasPositiveValue = $$.hasPositiveValueInTargets(targets);

        // set target types
        if (config.data_type) {
            $$.setTargetType($$.mapToIds(targets).filter(function (id) {
                return !(id in config.data_types);
            }), config.data_type);
        }

        // cache as original id keyed
        targets.forEach(function (d) {
            $$.addCache(d.id_org, d);
        });

        return targets;
    };

    c3_chart_internal_fn.load = function (targets, args) {
        var $$ = this;
        if (targets) {
            // filter loading targets if needed
            if (args.filter) {
                targets = targets.filter(args.filter);
            }
            // set type if args.types || args.type specified
            if (args.type || args.types) {
                targets.forEach(function (t) {
                    var type = args.types && args.types[t.id] ? args.types[t.id] : args.type;
                    $$.setTargetType(t.id, type);
                });
            }
            // Update/Add data
            $$.data.targets.forEach(function (d) {
                for (var i = 0; i < targets.length; i++) {
                    if (d.id === targets[i].id) {
                        d.values = targets[i].values;
                        targets.splice(i, 1);
                        break;
                    }
                }
            });
            $$.data.targets = $$.data.targets.concat(targets); // add remained
        }

        // Set targets
        $$.updateTargets($$.data.targets);

        // Redraw with new targets
        $$.redraw({ withUpdateOrgXDomain: true, withUpdateXDomain: true, withLegend: true });

        if (args.done) {
            args.done();
        }
    };
    c3_chart_internal_fn.loadFromArgs = function (args) {
        var $$ = this;
        if (args.data) {
            $$.load($$.convertDataToTargets(args.data), args);
        } else if (args.url) {
            $$.convertUrlToData(args.url, args.mimeType, args.headers, args.keys, function (data) {
                $$.load($$.convertDataToTargets(data), args);
            });
        } else if (args.json) {
            $$.load($$.convertDataToTargets($$.convertJsonToData(args.json, args.keys)), args);
        } else if (args.rows) {
            $$.load($$.convertDataToTargets($$.convertRowsToData(args.rows)), args);
        } else if (args.columns) {
            $$.load($$.convertDataToTargets($$.convertColumnsToData(args.columns)), args);
        } else {
            $$.load(null, args);
        }
    };
    c3_chart_internal_fn.unload = function (targetIds, done) {
        var $$ = this;
        if (!done) {
            done = function done() {};
        }
        // filter existing target
        targetIds = targetIds.filter(function (id) {
            return $$.hasTarget($$.data.targets, id);
        });
        // If no target, call done and return
        if (!targetIds || targetIds.length === 0) {
            done();
            return;
        }
        $$.svg.selectAll(targetIds.map(function (id) {
            return $$.selectorTarget(id);
        })).transition().style('opacity', 0).remove().call($$.endall, done);
        targetIds.forEach(function (id) {
            // Reset fadein for future load
            $$.withoutFadeIn[id] = false;
            // Remove target's elements
            if ($$.legend) {
                $$.legend.selectAll('.' + CLASS.legendItem + $$.getTargetSelectorSuffix(id)).remove();
            }
            // Remove target
            $$.data.targets = $$.data.targets.filter(function (t) {
                return t.id !== id;
            });
        });
    };

    c3_chart_internal_fn.categoryName = function (i) {
        var config = this.config;
        return i < config.axis_x_categories.length ? config.axis_x_categories[i] : i;
    };

    c3_chart_internal_fn.initEventRect = function () {
        var $$ = this;
        $$.main.select('.' + CLASS.chart).append("g").attr("class", CLASS.eventRects).style('fill-opacity', 0);
    };
    c3_chart_internal_fn.redrawEventRect = function () {
        var $$ = this,
            config = $$.config,
            eventRectUpdate,
            maxDataCountTarget,
            isMultipleX = $$.isMultipleX();

        // rects for mouseover
        var eventRects = $$.main.select('.' + CLASS.eventRects).style('cursor', config.zoom_enabled ? config.axis_rotated ? 'ns-resize' : 'ew-resize' : null).classed(CLASS.eventRectsMultiple, isMultipleX).classed(CLASS.eventRectsSingle, !isMultipleX);

        // clear old rects
        eventRects.selectAll('.' + CLASS.eventRect).remove();

        // open as public variable
        $$.eventRect = eventRects.selectAll('.' + CLASS.eventRect);

        if (isMultipleX) {
            eventRectUpdate = $$.eventRect.data([0]);
            // enter : only one rect will be added
            $$.generateEventRectsForMultipleXs(eventRectUpdate.enter());
            // update
            $$.updateEventRect(eventRectUpdate);
            // exit : not needed because always only one rect exists
        } else {
            // Set data and update $$.eventRect
            maxDataCountTarget = $$.getMaxDataCountTarget($$.data.targets);
            eventRects.datum(maxDataCountTarget ? maxDataCountTarget.values : []);
            $$.eventRect = eventRects.selectAll('.' + CLASS.eventRect);
            eventRectUpdate = $$.eventRect.data(function (d) {
                return d;
            });
            // enter
            $$.generateEventRectsForSingleX(eventRectUpdate.enter());
            // update
            $$.updateEventRect(eventRectUpdate);
            // exit
            eventRectUpdate.exit().remove();
        }
    };
    c3_chart_internal_fn.updateEventRect = function (eventRectUpdate) {
        var $$ = this,
            config = $$.config,
            x,
            y,
            w,
            h,
            rectW,
            rectX;

        // set update selection if null
        eventRectUpdate = eventRectUpdate || $$.eventRect.data(function (d) {
            return d;
        });

        if ($$.isMultipleX()) {
            // TODO: rotated not supported yet
            x = 0;
            y = 0;
            w = $$.width;
            h = $$.height;
        } else {
            if (($$.isCustomX() || $$.isTimeSeries()) && !$$.isCategorized()) {

                // update index for x that is used by prevX and nextX
                $$.updateXs();

                rectW = function rectW(d) {
                    var prevX = $$.getPrevX(d.index),
                        nextX = $$.getNextX(d.index);

                    // if there this is a single data point make the eventRect full width (or height)
                    if (prevX === null && nextX === null) {
                        return config.axis_rotated ? $$.height : $$.width;
                    }

                    if (prevX === null) {
                        prevX = $$.x.domain()[0];
                    }
                    if (nextX === null) {
                        nextX = $$.x.domain()[1];
                    }

                    return Math.max(0, ($$.x(nextX) - $$.x(prevX)) / 2);
                };
                rectX = function rectX(d) {
                    var prevX = $$.getPrevX(d.index),
                        nextX = $$.getNextX(d.index),
                        thisX = $$.data.xs[d.id][d.index];

                    // if there this is a single data point position the eventRect at 0
                    if (prevX === null && nextX === null) {
                        return 0;
                    }

                    if (prevX === null) {
                        prevX = $$.x.domain()[0];
                    }

                    return ($$.x(thisX) + $$.x(prevX)) / 2;
                };
            } else {
                rectW = $$.getEventRectWidth();
                rectX = function rectX(d) {
                    return $$.x(d.x) - rectW / 2;
                };
            }
            x = config.axis_rotated ? 0 : rectX;
            y = config.axis_rotated ? rectX : 0;
            w = config.axis_rotated ? $$.width : rectW;
            h = config.axis_rotated ? rectW : $$.height;
        }

        eventRectUpdate.attr('class', $$.classEvent.bind($$)).attr("x", x).attr("y", y).attr("width", w).attr("height", h);
    };
    c3_chart_internal_fn.generateEventRectsForSingleX = function (eventRectEnter) {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config;
        eventRectEnter.append("rect").attr("class", $$.classEvent.bind($$)).style("cursor", config.data_selection_enabled && config.data_selection_grouped ? "pointer" : null).on('mouseover', function (d) {
            var index = d.index;

            if ($$.dragging || $$.flowing) {
                return;
            } // do nothing while dragging/flowing
            if ($$.hasArcType()) {
                return;
            }

            // Expand shapes for selection
            if (config.point_focus_expand_enabled) {
                $$.expandCircles(index, null, true);
            }
            $$.expandBars(index, null, true);

            // Call event handler
            $$.main.selectAll('.' + CLASS.shape + '-' + index).each(function (d) {
                config.data_onmouseover.call($$.api, d);
            });
        }).on('mouseout', function (d) {
            var index = d.index;
            if (!$$.config) {
                return;
            } // chart is destroyed
            if ($$.hasArcType()) {
                return;
            }
            $$.hideXGridFocus();
            $$.hideTooltip();
            // Undo expanded shapes
            $$.unexpandCircles();
            $$.unexpandBars();
            // Call event handler
            $$.main.selectAll('.' + CLASS.shape + '-' + index).each(function (d) {
                config.data_onmouseout.call($$.api, d);
            });
        }).on('mousemove', function (d) {
            var selectedData,
                index = d.index,
                eventRect = $$.svg.select('.' + CLASS.eventRect + '-' + index);

            if ($$.dragging || $$.flowing) {
                return;
            } // do nothing while dragging/flowing
            if ($$.hasArcType()) {
                return;
            }

            if ($$.isStepType(d) && $$.config.line_step_type === 'step-after' && d3.mouse(this)[0] < $$.x($$.getXValue(d.id, index))) {
                index -= 1;
            }

            // Show tooltip
            selectedData = $$.filterTargetsToShow($$.data.targets).map(function (t) {
                return $$.addName($$.getValueOnIndex(t.values, index));
            });

            if (config.tooltip_grouped) {
                $$.showTooltip(selectedData, this);
                $$.showXGridFocus(selectedData);
            }

            if (config.tooltip_grouped && (!config.data_selection_enabled || config.data_selection_grouped)) {
                return;
            }

            $$.main.selectAll('.' + CLASS.shape + '-' + index).each(function () {
                d3.select(this).classed(CLASS.EXPANDED, true);
                if (config.data_selection_enabled) {
                    eventRect.style('cursor', config.data_selection_grouped ? 'pointer' : null);
                }
                if (!config.tooltip_grouped) {
                    $$.hideXGridFocus();
                    $$.hideTooltip();
                    if (!config.data_selection_grouped) {
                        $$.unexpandCircles(index);
                        $$.unexpandBars(index);
                    }
                }
            }).filter(function (d) {
                return $$.isWithinShape(this, d);
            }).each(function (d) {
                if (config.data_selection_enabled && (config.data_selection_grouped || config.data_selection_isselectable(d))) {
                    eventRect.style('cursor', 'pointer');
                }
                if (!config.tooltip_grouped) {
                    $$.showTooltip([d], this);
                    $$.showXGridFocus([d]);
                    if (config.point_focus_expand_enabled) {
                        $$.expandCircles(index, d.id, true);
                    }
                    $$.expandBars(index, d.id, true);
                }
            });
        }).on('click', function (d) {
            var index = d.index;
            if ($$.hasArcType() || !$$.toggleShape) {
                return;
            }
            if ($$.cancelClick) {
                $$.cancelClick = false;
                return;
            }
            if ($$.isStepType(d) && config.line_step_type === 'step-after' && d3.mouse(this)[0] < $$.x($$.getXValue(d.id, index))) {
                index -= 1;
            }
            $$.main.selectAll('.' + CLASS.shape + '-' + index).each(function (d) {
                if (config.data_selection_grouped || $$.isWithinShape(this, d)) {
                    $$.toggleShape(this, d, index);
                    $$.config.data_onclick.call($$.api, d, this);
                }
            });
        }).call(config.data_selection_draggable && $$.drag ? d3.behavior.drag().origin(Object).on('drag', function () {
            $$.drag(d3.mouse(this));
        }).on('dragstart', function () {
            $$.dragstart(d3.mouse(this));
        }).on('dragend', function () {
            $$.dragend();
        }) : function () {});
    };

    c3_chart_internal_fn.generateEventRectsForMultipleXs = function (eventRectEnter) {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config;

        function mouseout() {
            $$.svg.select('.' + CLASS.eventRect).style('cursor', null);
            $$.hideXGridFocus();
            $$.hideTooltip();
            $$.unexpandCircles();
            $$.unexpandBars();
        }

        eventRectEnter.append('rect').attr('x', 0).attr('y', 0).attr('width', $$.width).attr('height', $$.height).attr('class', CLASS.eventRect).on('mouseout', function () {
            if (!$$.config) {
                return;
            } // chart is destroyed
            if ($$.hasArcType()) {
                return;
            }
            mouseout();
        }).on('mousemove', function () {
            var targetsToShow = $$.filterTargetsToShow($$.data.targets);
            var mouse, closest, sameXData, selectedData;

            if ($$.dragging) {
                return;
            } // do nothing when dragging
            if ($$.hasArcType(targetsToShow)) {
                return;
            }

            mouse = d3.mouse(this);
            closest = $$.findClosestFromTargets(targetsToShow, mouse);

            if ($$.mouseover && (!closest || closest.id !== $$.mouseover.id)) {
                config.data_onmouseout.call($$.api, $$.mouseover);
                $$.mouseover = undefined;
            }

            if (!closest) {
                mouseout();
                return;
            }

            if ($$.isScatterType(closest) || !config.tooltip_grouped) {
                sameXData = [closest];
            } else {
                sameXData = $$.filterByX(targetsToShow, closest.x);
            }

            // show tooltip when cursor is close to some point
            selectedData = sameXData.map(function (d) {
                return $$.addName(d);
            });
            $$.showTooltip(selectedData, this);

            // expand points
            if (config.point_focus_expand_enabled) {
                $$.expandCircles(closest.index, closest.id, true);
            }
            $$.expandBars(closest.index, closest.id, true);

            // Show xgrid focus line
            $$.showXGridFocus(selectedData);

            // Show cursor as pointer if point is close to mouse position
            if ($$.isBarType(closest.id) || $$.dist(closest, mouse) < config.point_sensitivity) {
                $$.svg.select('.' + CLASS.eventRect).style('cursor', 'pointer');
                if (!$$.mouseover) {
                    config.data_onmouseover.call($$.api, closest);
                    $$.mouseover = closest;
                }
            }
        }).on('click', function () {
            var targetsToShow = $$.filterTargetsToShow($$.data.targets);
            var mouse, closest;
            if ($$.hasArcType(targetsToShow)) {
                return;
            }

            mouse = d3.mouse(this);
            closest = $$.findClosestFromTargets(targetsToShow, mouse);
            if (!closest) {
                return;
            }
            // select if selection enabled
            if ($$.isBarType(closest.id) || $$.dist(closest, mouse) < config.point_sensitivity) {
                $$.main.selectAll('.' + CLASS.shapes + $$.getTargetSelectorSuffix(closest.id)).selectAll('.' + CLASS.shape + '-' + closest.index).each(function () {
                    if (config.data_selection_grouped || $$.isWithinShape(this, closest)) {
                        $$.toggleShape(this, closest, closest.index);
                        $$.config.data_onclick.call($$.api, closest, this);
                    }
                });
            }
        }).call(config.data_selection_draggable && $$.drag ? d3.behavior.drag().origin(Object).on('drag', function () {
            $$.drag(d3.mouse(this));
        }).on('dragstart', function () {
            $$.dragstart(d3.mouse(this));
        }).on('dragend', function () {
            $$.dragend();
        }) : function () {});
    };
    c3_chart_internal_fn.dispatchEvent = function (type, index, mouse) {
        var $$ = this,
            selector = '.' + CLASS.eventRect + (!$$.isMultipleX() ? '-' + index : ''),
            eventRect = $$.main.select(selector).node(),
            box = eventRect.getBoundingClientRect(),
            x = box.left + (mouse ? mouse[0] : 0),
            y = box.top + (mouse ? mouse[1] : 0),
            event = document.createEvent("MouseEvents");

        event.initMouseEvent(type, true, true, window, 0, x, y, x, y, false, false, false, false, 0, null);
        eventRect.dispatchEvent(event);
    };

    c3_chart_internal_fn.getCurrentWidth = function () {
        var $$ = this,
            config = $$.config;
        return config.size_width ? config.size_width : $$.getParentWidth();
    };
    c3_chart_internal_fn.getCurrentHeight = function () {
        var $$ = this,
            config = $$.config,
            h = config.size_height ? config.size_height : $$.getParentHeight();
        return h > 0 ? h : 320 / ($$.hasType('gauge') && !config.gauge_fullCircle ? 2 : 1);
    };
    c3_chart_internal_fn.getCurrentPaddingTop = function () {
        var $$ = this,
            config = $$.config,
            padding = isValue(config.padding_top) ? config.padding_top : 0;
        if ($$.title && $$.title.node()) {
            padding += $$.getTitlePadding();
        }
        return padding;
    };
    c3_chart_internal_fn.getCurrentPaddingBottom = function () {
        var config = this.config;
        return isValue(config.padding_bottom) ? config.padding_bottom : 0;
    };
    c3_chart_internal_fn.getCurrentPaddingLeft = function (withoutRecompute) {
        var $$ = this,
            config = $$.config;
        if (isValue(config.padding_left)) {
            return config.padding_left;
        } else if (config.axis_rotated) {
            return !config.axis_x_show ? 1 : Math.max(ceil10($$.getAxisWidthByAxisId('x', withoutRecompute)), 40);
        } else if (!config.axis_y_show || config.axis_y_inner) {
            // && !config.axis_rotated
            return $$.axis.getYAxisLabelPosition().isOuter ? 30 : 1;
        } else {
            return ceil10($$.getAxisWidthByAxisId('y', withoutRecompute));
        }
    };
    c3_chart_internal_fn.getCurrentPaddingRight = function () {
        var $$ = this,
            config = $$.config,
            defaultPadding = 10,
            legendWidthOnRight = $$.isLegendRight ? $$.getLegendWidth() + 20 : 0;
        if (isValue(config.padding_right)) {
            return config.padding_right + 1; // 1 is needed not to hide tick line
        } else if (config.axis_rotated) {
            return defaultPadding + legendWidthOnRight;
        } else if (!config.axis_y2_show || config.axis_y2_inner) {
            // && !config.axis_rotated
            return 2 + legendWidthOnRight + ($$.axis.getY2AxisLabelPosition().isOuter ? 20 : 0);
        } else {
            return ceil10($$.getAxisWidthByAxisId('y2')) + legendWidthOnRight;
        }
    };

    c3_chart_internal_fn.getParentRectValue = function (key) {
        var parent = this.selectChart.node(),
            v;
        while (parent && parent.tagName !== 'BODY') {
            try {
                v = parent.getBoundingClientRect()[key];
            } catch (e) {
                if (key === 'width') {
                    // In IE in certain cases getBoundingClientRect
                    // will cause an "unspecified error"
                    v = parent.offsetWidth;
                }
            }
            if (v) {
                break;
            }
            parent = parent.parentNode;
        }
        return v;
    };
    c3_chart_internal_fn.getParentWidth = function () {
        return this.getParentRectValue('width');
    };
    c3_chart_internal_fn.getParentHeight = function () {
        var h = this.selectChart.style('height');
        return h.indexOf('px') > 0 ? +h.replace('px', '') : 0;
    };

    c3_chart_internal_fn.getSvgLeft = function (withoutRecompute) {
        var $$ = this,
            config = $$.config,
            hasLeftAxisRect = config.axis_rotated || !config.axis_rotated && !config.axis_y_inner,
            leftAxisClass = config.axis_rotated ? CLASS.axisX : CLASS.axisY,
            leftAxis = $$.main.select('.' + leftAxisClass).node(),
            svgRect = leftAxis && hasLeftAxisRect ? leftAxis.getBoundingClientRect() : { right: 0 },
            chartRect = $$.selectChart.node().getBoundingClientRect(),
            hasArc = $$.hasArcType(),
            svgLeft = svgRect.right - chartRect.left - (hasArc ? 0 : $$.getCurrentPaddingLeft(withoutRecompute));
        return svgLeft > 0 ? svgLeft : 0;
    };

    c3_chart_internal_fn.getAxisWidthByAxisId = function (id, withoutRecompute) {
        var $$ = this,
            position = $$.axis.getLabelPositionById(id);
        return $$.axis.getMaxTickWidth(id, withoutRecompute) + (position.isInner ? 20 : 40);
    };
    c3_chart_internal_fn.getHorizontalAxisHeight = function (axisId) {
        var $$ = this,
            config = $$.config,
            h = 30;
        if (axisId === 'x' && !config.axis_x_show) {
            return 8;
        }
        if (axisId === 'x' && config.axis_x_height) {
            return config.axis_x_height;
        }
        if (axisId === 'y' && !config.axis_y_show) {
            return config.legend_show && !$$.isLegendRight && !$$.isLegendInset ? 10 : 1;
        }
        if (axisId === 'y2' && !config.axis_y2_show) {
            return $$.rotated_padding_top;
        }
        // Calculate x axis height when tick rotated
        if (axisId === 'x' && !config.axis_rotated && config.axis_x_tick_rotate) {
            h = 30 + $$.axis.getMaxTickWidth(axisId) * Math.cos(Math.PI * (90 - config.axis_x_tick_rotate) / 180);
        }
        // Calculate y axis height when tick rotated
        if (axisId === 'y' && config.axis_rotated && config.axis_y_tick_rotate) {
            h = 30 + $$.axis.getMaxTickWidth(axisId) * Math.cos(Math.PI * (90 - config.axis_y_tick_rotate) / 180);
        }
        return h + ($$.axis.getLabelPositionById(axisId).isInner ? 0 : 10) + (axisId === 'y2' ? -10 : 0);
    };

    c3_chart_internal_fn.getEventRectWidth = function () {
        return Math.max(0, this.xAxis.tickInterval());
    };

    c3_chart_internal_fn.getShapeIndices = function (typeFilter) {
        var $$ = this,
            config = $$.config,
            indices = {},
            i = 0,
            j,
            k;
        $$.filterTargetsToShow($$.data.targets.filter(typeFilter, $$)).forEach(function (d) {
            for (j = 0; j < config.data_groups.length; j++) {
                if (config.data_groups[j].indexOf(d.id) < 0) {
                    continue;
                }
                for (k = 0; k < config.data_groups[j].length; k++) {
                    if (config.data_groups[j][k] in indices) {
                        indices[d.id] = indices[config.data_groups[j][k]];
                        break;
                    }
                }
            }
            if (isUndefined(indices[d.id])) {
                indices[d.id] = i++;
            }
        });
        indices.__max__ = i - 1;
        return indices;
    };
    c3_chart_internal_fn.getShapeX = function (offset, targetsNum, indices, isSub) {
        var $$ = this,
            scale = isSub ? $$.subX : $$.x;
        return function (d) {
            var index = d.id in indices ? indices[d.id] : 0;
            return d.x || d.x === 0 ? scale(d.x) - offset * (targetsNum / 2 - index) : 0;
        };
    };
    c3_chart_internal_fn.getShapeY = function (isSub) {
        var $$ = this;
        return function (d) {
            var scale = isSub ? $$.getSubYScale(d.id) : $$.getYScale(d.id);
            return scale(d.value);
        };
    };
    c3_chart_internal_fn.getShapeOffset = function (typeFilter, indices, isSub) {
        var $$ = this,
            targets = $$.orderTargets($$.filterTargetsToShow($$.data.targets.filter(typeFilter, $$))),
            targetIds = targets.map(function (t) {
            return t.id;
        });
        return function (d, i) {
            var scale = isSub ? $$.getSubYScale(d.id) : $$.getYScale(d.id),
                y0 = scale(0),
                offset = y0;
            targets.forEach(function (t) {
                var values = $$.isStepType(d) ? $$.convertValuesToStep(t.values) : t.values;
                if (t.id === d.id || indices[t.id] !== indices[d.id]) {
                    return;
                }
                if (targetIds.indexOf(t.id) < targetIds.indexOf(d.id)) {
                    // check if the x values line up
                    if (typeof values[i] === 'undefined' || +values[i].x !== +d.x) {
                        // "+" for timeseries
                        // if not, try to find the value that does line up
                        i = -1;
                        values.forEach(function (v, j) {
                            if (v.x === d.x) {
                                i = j;
                            }
                        });
                    }
                    if (i in values && values[i].value * d.value >= 0) {
                        offset += scale(values[i].value) - y0;
                    }
                }
            });
            return offset;
        };
    };
    c3_chart_internal_fn.isWithinShape = function (that, d) {
        var $$ = this,
            shape = $$.d3.select(that),
            isWithin;
        if (!$$.isTargetToShow(d.id)) {
            isWithin = false;
        } else if (that.nodeName === 'circle') {
            isWithin = $$.isStepType(d) ? $$.isWithinStep(that, $$.getYScale(d.id)(d.value)) : $$.isWithinCircle(that, $$.pointSelectR(d) * 1.5);
        } else if (that.nodeName === 'path') {
            isWithin = shape.classed(CLASS.bar) ? $$.isWithinBar(that) : true;
        }
        return isWithin;
    };

    c3_chart_internal_fn.getInterpolate = function (d) {
        var $$ = this,
            interpolation = $$.isInterpolationType($$.config.spline_interpolation_type) ? $$.config.spline_interpolation_type : 'cardinal';
        return $$.isSplineType(d) ? interpolation : $$.isStepType(d) ? $$.config.line_step_type : "linear";
    };

    c3_chart_internal_fn.initLine = function () {
        var $$ = this;
        $$.main.select('.' + CLASS.chart).append("g").attr("class", CLASS.chartLines);
    };
    c3_chart_internal_fn.updateTargetsForLine = function (targets) {
        var $$ = this,
            config = $$.config,
            mainLineUpdate,
            mainLineEnter,
            classChartLine = $$.classChartLine.bind($$),
            classLines = $$.classLines.bind($$),
            classAreas = $$.classAreas.bind($$),
            classCircles = $$.classCircles.bind($$),
            classFocus = $$.classFocus.bind($$);
        mainLineUpdate = $$.main.select('.' + CLASS.chartLines).selectAll('.' + CLASS.chartLine).data(targets).attr('class', function (d) {
            return classChartLine(d) + classFocus(d);
        });
        mainLineEnter = mainLineUpdate.enter().append('g').attr('class', classChartLine).style('opacity', 0).style("pointer-events", "none");
        // Lines for each data
        mainLineEnter.append('g').attr("class", classLines);
        // Areas
        mainLineEnter.append('g').attr('class', classAreas);
        // Circles for each data point on lines
        mainLineEnter.append('g').attr("class", function (d) {
            return $$.generateClass(CLASS.selectedCircles, d.id);
        });
        mainLineEnter.append('g').attr("class", classCircles).style("cursor", function (d) {
            return config.data_selection_isselectable(d) ? "pointer" : null;
        });
        // Update date for selected circles
        targets.forEach(function (t) {
            $$.main.selectAll('.' + CLASS.selectedCircles + $$.getTargetSelectorSuffix(t.id)).selectAll('.' + CLASS.selectedCircle).each(function (d) {
                d.value = t.values[d.index].value;
            });
        });
        // MEMO: can not keep same color...
        //mainLineUpdate.exit().remove();
    };
    c3_chart_internal_fn.updateLine = function (durationForExit) {
        var $$ = this;
        $$.mainLine = $$.main.selectAll('.' + CLASS.lines).selectAll('.' + CLASS.line).data($$.lineData.bind($$));
        $$.mainLine.enter().append('path').attr('class', $$.classLine.bind($$)).style("stroke", $$.color);
        $$.mainLine.style("opacity", $$.initialOpacity.bind($$)).style('shape-rendering', function (d) {
            return $$.isStepType(d) ? 'crispEdges' : '';
        }).attr('transform', null);
        $$.mainLine.exit().transition().duration(durationForExit).style('opacity', 0).remove();
    };
    c3_chart_internal_fn.redrawLine = function (drawLine, withTransition) {
        return [(withTransition ? this.mainLine.transition(Math.random().toString()) : this.mainLine).attr("d", drawLine).style("stroke", this.color).style("opacity", 1)];
    };
    c3_chart_internal_fn.generateDrawLine = function (lineIndices, isSub) {
        var $$ = this,
            config = $$.config,
            line = $$.d3.svg.line(),
            getPoints = $$.generateGetLinePoints(lineIndices, isSub),
            yScaleGetter = isSub ? $$.getSubYScale : $$.getYScale,
            xValue = function xValue(d) {
            return (isSub ? $$.subxx : $$.xx).call($$, d);
        },
            yValue = function yValue(d, i) {
            return config.data_groups.length > 0 ? getPoints(d, i)[0][1] : yScaleGetter.call($$, d.id)(d.value);
        };

        line = config.axis_rotated ? line.x(yValue).y(xValue) : line.x(xValue).y(yValue);
        if (!config.line_connectNull) {
            line = line.defined(function (d) {
                return d.value != null;
            });
        }
        return function (d) {
            var values = config.line_connectNull ? $$.filterRemoveNull(d.values) : d.values,
                x = isSub ? $$.x : $$.subX,
                y = yScaleGetter.call($$, d.id),
                x0 = 0,
                y0 = 0,
                path;
            if ($$.isLineType(d)) {
                if (config.data_regions[d.id]) {
                    path = $$.lineWithRegions(values, x, y, config.data_regions[d.id]);
                } else {
                    if ($$.isStepType(d)) {
                        values = $$.convertValuesToStep(values);
                    }
                    path = line.interpolate($$.getInterpolate(d))(values);
                }
            } else {
                if (values[0]) {
                    x0 = x(values[0].x);
                    y0 = y(values[0].value);
                }
                path = config.axis_rotated ? "M " + y0 + " " + x0 : "M " + x0 + " " + y0;
            }
            return path ? path : "M 0 0";
        };
    };
    c3_chart_internal_fn.generateGetLinePoints = function (lineIndices, isSub) {
        // partial duplication of generateGetBarPoints
        var $$ = this,
            config = $$.config,
            lineTargetsNum = lineIndices.__max__ + 1,
            x = $$.getShapeX(0, lineTargetsNum, lineIndices, !!isSub),
            y = $$.getShapeY(!!isSub),
            lineOffset = $$.getShapeOffset($$.isLineType, lineIndices, !!isSub),
            yScale = isSub ? $$.getSubYScale : $$.getYScale;
        return function (d, i) {
            var y0 = yScale.call($$, d.id)(0),
                offset = lineOffset(d, i) || y0,
                // offset is for stacked area chart
            posX = x(d),
                posY = y(d);
            // fix posY not to overflow opposite quadrant
            if (config.axis_rotated) {
                if (0 < d.value && posY < y0 || d.value < 0 && y0 < posY) {
                    posY = y0;
                }
            }
            // 1 point that marks the line position
            return [[posX, posY - (y0 - offset)], [posX, posY - (y0 - offset)], // needed for compatibility
            [posX, posY - (y0 - offset)], // needed for compatibility
            [posX, posY - (y0 - offset)] // needed for compatibility
            ];
        };
    };

    c3_chart_internal_fn.lineWithRegions = function (d, x, y, _regions) {
        var $$ = this,
            config = $$.config,
            prev = -1,
            i,
            j,
            s = "M",
            sWithRegion,
            xp,
            yp,
            dx,
            dy,
            dd,
            diff,
            diffx2,
            xOffset = $$.isCategorized() ? 0.5 : 0,
            xValue,
            yValue,
            regions = [];

        function isWithinRegions(x, regions) {
            var i;
            for (i = 0; i < regions.length; i++) {
                if (regions[i].start < x && x <= regions[i].end) {
                    return true;
                }
            }
            return false;
        }

        // Check start/end of regions
        if (isDefined(_regions)) {
            for (i = 0; i < _regions.length; i++) {
                regions[i] = {};
                if (isUndefined(_regions[i].start)) {
                    regions[i].start = d[0].x;
                } else {
                    regions[i].start = $$.isTimeSeries() ? $$.parseDate(_regions[i].start) : _regions[i].start;
                }
                if (isUndefined(_regions[i].end)) {
                    regions[i].end = d[d.length - 1].x;
                } else {
                    regions[i].end = $$.isTimeSeries() ? $$.parseDate(_regions[i].end) : _regions[i].end;
                }
            }
        }

        // Set scales
        xValue = config.axis_rotated ? function (d) {
            return y(d.value);
        } : function (d) {
            return x(d.x);
        };
        yValue = config.axis_rotated ? function (d) {
            return x(d.x);
        } : function (d) {
            return y(d.value);
        };

        // Define svg generator function for region
        function generateM(points) {
            return 'M' + points[0][0] + ' ' + points[0][1] + ' ' + points[1][0] + ' ' + points[1][1];
        }
        if ($$.isTimeSeries()) {
            sWithRegion = function sWithRegion(d0, d1, j, diff) {
                var x0 = d0.x.getTime(),
                    x_diff = d1.x - d0.x,
                    xv0 = new Date(x0 + x_diff * j),
                    xv1 = new Date(x0 + x_diff * (j + diff)),
                    points;
                if (config.axis_rotated) {
                    points = [[y(yp(j)), x(xv0)], [y(yp(j + diff)), x(xv1)]];
                } else {
                    points = [[x(xv0), y(yp(j))], [x(xv1), y(yp(j + diff))]];
                }
                return generateM(points);
            };
        } else {
            sWithRegion = function sWithRegion(d0, d1, j, diff) {
                var points;
                if (config.axis_rotated) {
                    points = [[y(yp(j), true), x(xp(j))], [y(yp(j + diff), true), x(xp(j + diff))]];
                } else {
                    points = [[x(xp(j), true), y(yp(j))], [x(xp(j + diff), true), y(yp(j + diff))]];
                }
                return generateM(points);
            };
        }

        // Generate
        for (i = 0; i < d.length; i++) {

            // Draw as normal
            if (isUndefined(regions) || !isWithinRegions(d[i].x, regions)) {
                s += " " + xValue(d[i]) + " " + yValue(d[i]);
            }
            // Draw with region // TODO: Fix for horizotal charts
            else {
                    xp = $$.getScale(d[i - 1].x + xOffset, d[i].x + xOffset, $$.isTimeSeries());
                    yp = $$.getScale(d[i - 1].value, d[i].value);

                    dx = x(d[i].x) - x(d[i - 1].x);
                    dy = y(d[i].value) - y(d[i - 1].value);
                    dd = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
                    diff = 2 / dd;
                    diffx2 = diff * 2;

                    for (j = diff; j <= 1; j += diffx2) {
                        s += sWithRegion(d[i - 1], d[i], j, diff);
                    }
                }
            prev = d[i].x;
        }

        return s;
    };

    c3_chart_internal_fn.updateArea = function (durationForExit) {
        var $$ = this,
            d3 = $$.d3;
        $$.mainArea = $$.main.selectAll('.' + CLASS.areas).selectAll('.' + CLASS.area).data($$.lineData.bind($$));
        $$.mainArea.enter().append('path').attr("class", $$.classArea.bind($$)).style("fill", $$.color).style("opacity", function () {
            $$.orgAreaOpacity = +d3.select(this).style('opacity');return 0;
        });
        $$.mainArea.style("opacity", $$.orgAreaOpacity);
        $$.mainArea.exit().transition().duration(durationForExit).style('opacity', 0).remove();
    };
    c3_chart_internal_fn.redrawArea = function (drawArea, withTransition) {
        return [(withTransition ? this.mainArea.transition(Math.random().toString()) : this.mainArea).attr("d", drawArea).style("fill", this.color).style("opacity", this.orgAreaOpacity)];
    };
    c3_chart_internal_fn.generateDrawArea = function (areaIndices, isSub) {
        var $$ = this,
            config = $$.config,
            area = $$.d3.svg.area(),
            getPoints = $$.generateGetAreaPoints(areaIndices, isSub),
            yScaleGetter = isSub ? $$.getSubYScale : $$.getYScale,
            xValue = function xValue(d) {
            return (isSub ? $$.subxx : $$.xx).call($$, d);
        },
            value0 = function value0(d, i) {
            return config.data_groups.length > 0 ? getPoints(d, i)[0][1] : yScaleGetter.call($$, d.id)($$.getAreaBaseValue(d.id));
        },
            value1 = function value1(d, i) {
            return config.data_groups.length > 0 ? getPoints(d, i)[1][1] : yScaleGetter.call($$, d.id)(d.value);
        };

        area = config.axis_rotated ? area.x0(value0).x1(value1).y(xValue) : area.x(xValue).y0(config.area_above ? 0 : value0).y1(value1);
        if (!config.line_connectNull) {
            area = area.defined(function (d) {
                return d.value !== null;
            });
        }

        return function (d) {
            var values = config.line_connectNull ? $$.filterRemoveNull(d.values) : d.values,
                x0 = 0,
                y0 = 0,
                path;
            if ($$.isAreaType(d)) {
                if ($$.isStepType(d)) {
                    values = $$.convertValuesToStep(values);
                }
                path = area.interpolate($$.getInterpolate(d))(values);
            } else {
                if (values[0]) {
                    x0 = $$.x(values[0].x);
                    y0 = $$.getYScale(d.id)(values[0].value);
                }
                path = config.axis_rotated ? "M " + y0 + " " + x0 : "M " + x0 + " " + y0;
            }
            return path ? path : "M 0 0";
        };
    };
    c3_chart_internal_fn.getAreaBaseValue = function () {
        return 0;
    };
    c3_chart_internal_fn.generateGetAreaPoints = function (areaIndices, isSub) {
        // partial duplication of generateGetBarPoints
        var $$ = this,
            config = $$.config,
            areaTargetsNum = areaIndices.__max__ + 1,
            x = $$.getShapeX(0, areaTargetsNum, areaIndices, !!isSub),
            y = $$.getShapeY(!!isSub),
            areaOffset = $$.getShapeOffset($$.isAreaType, areaIndices, !!isSub),
            yScale = isSub ? $$.getSubYScale : $$.getYScale;
        return function (d, i) {
            var y0 = yScale.call($$, d.id)(0),
                offset = areaOffset(d, i) || y0,
                // offset is for stacked area chart
            posX = x(d),
                posY = y(d);
            // fix posY not to overflow opposite quadrant
            if (config.axis_rotated) {
                if (0 < d.value && posY < y0 || d.value < 0 && y0 < posY) {
                    posY = y0;
                }
            }
            // 1 point that marks the area position
            return [[posX, offset], [posX, posY - (y0 - offset)], [posX, posY - (y0 - offset)], // needed for compatibility
            [posX, offset] // needed for compatibility
            ];
        };
    };

    c3_chart_internal_fn.updateCircle = function () {
        var $$ = this;
        $$.mainCircle = $$.main.selectAll('.' + CLASS.circles).selectAll('.' + CLASS.circle).data($$.lineOrScatterData.bind($$));
        $$.mainCircle.enter().append("circle").attr("class", $$.classCircle.bind($$)).attr("r", $$.pointR.bind($$)).style("fill", $$.color);
        $$.mainCircle.style("opacity", $$.initialOpacityForCircle.bind($$));
        $$.mainCircle.exit().remove();
    };
    c3_chart_internal_fn.redrawCircle = function (cx, cy, withTransition) {
        var selectedCircles = this.main.selectAll('.' + CLASS.selectedCircle);
        return [(withTransition ? this.mainCircle.transition(Math.random().toString()) : this.mainCircle).style('opacity', this.opacityForCircle.bind(this)).style("fill", this.color).attr("cx", cx).attr("cy", cy), (withTransition ? selectedCircles.transition(Math.random().toString()) : selectedCircles).attr("cx", cx).attr("cy", cy)];
    };
    c3_chart_internal_fn.circleX = function (d) {
        return d.x || d.x === 0 ? this.x(d.x) : null;
    };
    c3_chart_internal_fn.updateCircleY = function () {
        var $$ = this,
            lineIndices,
            getPoints;
        if ($$.config.data_groups.length > 0) {
            lineIndices = $$.getShapeIndices($$.isLineType), getPoints = $$.generateGetLinePoints(lineIndices);
            $$.circleY = function (d, i) {
                return getPoints(d, i)[0][1];
            };
        } else {
            $$.circleY = function (d) {
                return $$.getYScale(d.id)(d.value);
            };
        }
    };
    c3_chart_internal_fn.getCircles = function (i, id) {
        var $$ = this;
        return (id ? $$.main.selectAll('.' + CLASS.circles + $$.getTargetSelectorSuffix(id)) : $$.main).selectAll('.' + CLASS.circle + (isValue(i) ? '-' + i : ''));
    };
    c3_chart_internal_fn.expandCircles = function (i, id, reset) {
        var $$ = this,
            r = $$.pointExpandedR.bind($$);
        if (reset) {
            $$.unexpandCircles();
        }
        $$.getCircles(i, id).classed(CLASS.EXPANDED, true).attr('r', r);
    };
    c3_chart_internal_fn.unexpandCircles = function (i) {
        var $$ = this,
            r = $$.pointR.bind($$);
        $$.getCircles(i).filter(function () {
            return $$.d3.select(this).classed(CLASS.EXPANDED);
        }).classed(CLASS.EXPANDED, false).attr('r', r);
    };
    c3_chart_internal_fn.pointR = function (d) {
        var $$ = this,
            config = $$.config;
        return $$.isStepType(d) ? 0 : isFunction(config.point_r) ? config.point_r(d) : config.point_r;
    };
    c3_chart_internal_fn.pointExpandedR = function (d) {
        var $$ = this,
            config = $$.config;
        return config.point_focus_expand_enabled ? config.point_focus_expand_r ? config.point_focus_expand_r : $$.pointR(d) * 1.75 : $$.pointR(d);
    };
    c3_chart_internal_fn.pointSelectR = function (d) {
        var $$ = this,
            config = $$.config;
        return isFunction(config.point_select_r) ? config.point_select_r(d) : config.point_select_r ? config.point_select_r : $$.pointR(d) * 4;
    };
    c3_chart_internal_fn.isWithinCircle = function (that, r) {
        var d3 = this.d3,
            mouse = d3.mouse(that),
            d3_this = d3.select(that),
            cx = +d3_this.attr("cx"),
            cy = +d3_this.attr("cy");
        return Math.sqrt(Math.pow(cx - mouse[0], 2) + Math.pow(cy - mouse[1], 2)) < r;
    };
    c3_chart_internal_fn.isWithinStep = function (that, y) {
        return Math.abs(y - this.d3.mouse(that)[1]) < 30;
    };

    c3_chart_internal_fn.initBar = function () {
        var $$ = this;
        $$.main.select('.' + CLASS.chart).append("g").attr("class", CLASS.chartBars);
    };
    c3_chart_internal_fn.updateTargetsForBar = function (targets) {
        var $$ = this,
            config = $$.config,
            mainBarUpdate,
            mainBarEnter,
            classChartBar = $$.classChartBar.bind($$),
            classBars = $$.classBars.bind($$),
            classFocus = $$.classFocus.bind($$);
        mainBarUpdate = $$.main.select('.' + CLASS.chartBars).selectAll('.' + CLASS.chartBar).data(targets).attr('class', function (d) {
            return classChartBar(d) + classFocus(d);
        });
        mainBarEnter = mainBarUpdate.enter().append('g').attr('class', classChartBar).style('opacity', 0).style("pointer-events", "none");
        // Bars for each data
        mainBarEnter.append('g').attr("class", classBars).style("cursor", function (d) {
            return config.data_selection_isselectable(d) ? "pointer" : null;
        });
    };
    c3_chart_internal_fn.updateBar = function (durationForExit) {
        var $$ = this,
            barData = $$.barData.bind($$),
            classBar = $$.classBar.bind($$),
            initialOpacity = $$.initialOpacity.bind($$),
            color = function color(d) {
            return $$.color(d.id);
        };
        $$.mainBar = $$.main.selectAll('.' + CLASS.bars).selectAll('.' + CLASS.bar).data(barData);
        $$.mainBar.enter().append('path').attr("class", classBar).style("stroke", color).style("fill", color);
        $$.mainBar.style("opacity", initialOpacity);
        $$.mainBar.exit().transition().duration(durationForExit).style('opacity', 0).remove();
    };
    c3_chart_internal_fn.redrawBar = function (drawBar, withTransition) {
        return [(withTransition ? this.mainBar.transition(Math.random().toString()) : this.mainBar).attr('d', drawBar).style("fill", this.color).style("opacity", 1)];
    };
    c3_chart_internal_fn.getBarW = function (axis, barTargetsNum) {
        var $$ = this,
            config = $$.config,
            w = typeof config.bar_width === 'number' ? config.bar_width : barTargetsNum ? axis.tickInterval() * config.bar_width_ratio / barTargetsNum : 0;
        return config.bar_width_max && w > config.bar_width_max ? config.bar_width_max : w;
    };
    c3_chart_internal_fn.getBars = function (i, id) {
        var $$ = this;
        return (id ? $$.main.selectAll('.' + CLASS.bars + $$.getTargetSelectorSuffix(id)) : $$.main).selectAll('.' + CLASS.bar + (isValue(i) ? '-' + i : ''));
    };
    c3_chart_internal_fn.expandBars = function (i, id, reset) {
        var $$ = this;
        if (reset) {
            $$.unexpandBars();
        }
        $$.getBars(i, id).classed(CLASS.EXPANDED, true);
    };
    c3_chart_internal_fn.unexpandBars = function (i) {
        var $$ = this;
        $$.getBars(i).classed(CLASS.EXPANDED, false);
    };
    c3_chart_internal_fn.generateDrawBar = function (barIndices, isSub) {
        var $$ = this,
            config = $$.config,
            getPoints = $$.generateGetBarPoints(barIndices, isSub);
        return function (d, i) {
            // 4 points that make a bar
            var points = getPoints(d, i);

            // switch points if axis is rotated, not applicable for sub chart
            var indexX = config.axis_rotated ? 1 : 0;
            var indexY = config.axis_rotated ? 0 : 1;

            var path = 'M ' + points[0][indexX] + ',' + points[0][indexY] + ' ' + 'L' + points[1][indexX] + ',' + points[1][indexY] + ' ' + 'L' + points[2][indexX] + ',' + points[2][indexY] + ' ' + 'L' + points[3][indexX] + ',' + points[3][indexY] + ' ' + 'z';

            return path;
        };
    };
    c3_chart_internal_fn.generateGetBarPoints = function (barIndices, isSub) {
        var $$ = this,
            axis = isSub ? $$.subXAxis : $$.xAxis,
            barTargetsNum = barIndices.__max__ + 1,
            barW = $$.getBarW(axis, barTargetsNum),
            barX = $$.getShapeX(barW, barTargetsNum, barIndices, !!isSub),
            barY = $$.getShapeY(!!isSub),
            barOffset = $$.getShapeOffset($$.isBarType, barIndices, !!isSub),
            yScale = isSub ? $$.getSubYScale : $$.getYScale;
        return function (d, i) {
            var y0 = yScale.call($$, d.id)(0),
                offset = barOffset(d, i) || y0,
                // offset is for stacked bar chart
            posX = barX(d),
                posY = barY(d);
            // fix posY not to overflow opposite quadrant
            if ($$.config.axis_rotated) {
                if (0 < d.value && posY < y0 || d.value < 0 && y0 < posY) {
                    posY = y0;
                }
            }
            // 4 points that make a bar
            return [[posX, offset], [posX, posY - (y0 - offset)], [posX + barW, posY - (y0 - offset)], [posX + barW, offset]];
        };
    };
    c3_chart_internal_fn.isWithinBar = function (that) {
        var mouse = this.d3.mouse(that),
            box = that.getBoundingClientRect(),
            seg0 = that.pathSegList.getItem(0),
            seg1 = that.pathSegList.getItem(1),
            x = Math.min(seg0.x, seg1.x),
            y = Math.min(seg0.y, seg1.y),
            w = box.width,
            h = box.height,
            offset = 2,
            sx = x - offset,
            ex = x + w + offset,
            sy = y + h + offset,
            ey = y - offset;
        return sx < mouse[0] && mouse[0] < ex && ey < mouse[1] && mouse[1] < sy;
    };

    c3_chart_internal_fn.initText = function () {
        var $$ = this;
        $$.main.select('.' + CLASS.chart).append("g").attr("class", CLASS.chartTexts);
        $$.mainText = $$.d3.selectAll([]);
    };
    c3_chart_internal_fn.updateTargetsForText = function (targets) {
        var $$ = this,
            mainTextUpdate,
            mainTextEnter,
            classChartText = $$.classChartText.bind($$),
            classTexts = $$.classTexts.bind($$),
            classFocus = $$.classFocus.bind($$);
        mainTextUpdate = $$.main.select('.' + CLASS.chartTexts).selectAll('.' + CLASS.chartText).data(targets).attr('class', function (d) {
            return classChartText(d) + classFocus(d);
        });
        mainTextEnter = mainTextUpdate.enter().append('g').attr('class', classChartText).style('opacity', 0).style("pointer-events", "none");
        mainTextEnter.append('g').attr('class', classTexts);
    };
    c3_chart_internal_fn.updateText = function (durationForExit) {
        var $$ = this,
            config = $$.config,
            barOrLineData = $$.barOrLineData.bind($$),
            classText = $$.classText.bind($$);
        $$.mainText = $$.main.selectAll('.' + CLASS.texts).selectAll('.' + CLASS.text).data(barOrLineData);
        $$.mainText.enter().append('text').attr("class", classText).attr('text-anchor', function (d) {
            return config.axis_rotated ? d.value < 0 ? 'end' : 'start' : 'middle';
        }).style("stroke", 'none').style("fill", function (d) {
            return $$.color(d);
        }).style("fill-opacity", 0);
        $$.mainText.text(function (d, i, j) {
            return $$.dataLabelFormat(d.id)(d.value, d.id, i, j);
        });
        $$.mainText.exit().transition().duration(durationForExit).style('fill-opacity', 0).remove();
    };
    c3_chart_internal_fn.redrawText = function (xForText, yForText, forFlow, withTransition) {
        return [(withTransition ? this.mainText.transition() : this.mainText).attr('x', xForText).attr('y', yForText).style("fill", this.color).style("fill-opacity", forFlow ? 0 : this.opacityForText.bind(this))];
    };
    c3_chart_internal_fn.getTextRect = function (text, cls, element) {
        var dummy = this.d3.select('body').append('div').classed('c3', true),
            svg = dummy.append("svg").style('visibility', 'hidden').style('position', 'fixed').style('top', 0).style('left', 0),
            font = this.d3.select(element).style('font'),
            rect;
        svg.selectAll('.dummy').data([text]).enter().append('text').classed(cls ? cls : "", true).style('font', font).text(text).each(function () {
            rect = this.getBoundingClientRect();
        });
        dummy.remove();
        return rect;
    };
    c3_chart_internal_fn.generateXYForText = function (areaIndices, barIndices, lineIndices, forX) {
        var $$ = this,
            getAreaPoints = $$.generateGetAreaPoints(areaIndices, false),
            getBarPoints = $$.generateGetBarPoints(barIndices, false),
            getLinePoints = $$.generateGetLinePoints(lineIndices, false),
            getter = forX ? $$.getXForText : $$.getYForText;
        return function (d, i) {
            var getPoints = $$.isAreaType(d) ? getAreaPoints : $$.isBarType(d) ? getBarPoints : getLinePoints;
            return getter.call($$, getPoints(d, i), d, this);
        };
    };
    c3_chart_internal_fn.getXForText = function (points, d, textElement) {
        var $$ = this,
            box = textElement.getBoundingClientRect(),
            xPos,
            padding;
        if ($$.config.axis_rotated) {
            padding = $$.isBarType(d) ? 4 : 6;
            xPos = points[2][1] + padding * (d.value < 0 ? -1 : 1);
        } else {
            xPos = $$.hasType('bar') ? (points[2][0] + points[0][0]) / 2 : points[0][0];
        }
        // show labels regardless of the domain if value is null
        if (d.value === null) {
            if (xPos > $$.width) {
                xPos = $$.width - box.width;
            } else if (xPos < 0) {
                xPos = 4;
            }
        }
        return xPos;
    };
    c3_chart_internal_fn.getYForText = function (points, d, textElement) {
        var $$ = this,
            box = textElement.getBoundingClientRect(),
            yPos;
        if ($$.config.axis_rotated) {
            yPos = (points[0][0] + points[2][0] + box.height * 0.6) / 2;
        } else {
            yPos = points[2][1];
            if (d.value < 0 || d.value === 0 && !$$.hasPositiveValue) {
                yPos += box.height;
                if ($$.isBarType(d) && $$.isSafari()) {
                    yPos -= 3;
                } else if (!$$.isBarType(d) && $$.isChrome()) {
                    yPos += 3;
                }
            } else {
                yPos += $$.isBarType(d) ? -3 : -6;
            }
        }
        // show labels regardless of the domain if value is null
        if (d.value === null && !$$.config.axis_rotated) {
            if (yPos < box.height) {
                yPos = box.height;
            } else if (yPos > this.height) {
                yPos = this.height - 4;
            }
        }
        return yPos;
    };

    c3_chart_internal_fn.setTargetType = function (targetIds, type) {
        var $$ = this,
            config = $$.config;
        $$.mapToTargetIds(targetIds).forEach(function (id) {
            $$.withoutFadeIn[id] = type === config.data_types[id];
            config.data_types[id] = type;
        });
        if (!targetIds) {
            config.data_type = type;
        }
    };
    c3_chart_internal_fn.hasType = function (type, targets) {
        var $$ = this,
            types = $$.config.data_types,
            has = false;
        targets = targets || $$.data.targets;
        if (targets && targets.length) {
            targets.forEach(function (target) {
                var t = types[target.id];
                if (t && t.indexOf(type) >= 0 || !t && type === 'line') {
                    has = true;
                }
            });
        } else if (Object.keys(types).length) {
            Object.keys(types).forEach(function (id) {
                if (types[id] === type) {
                    has = true;
                }
            });
        } else {
            has = $$.config.data_type === type;
        }
        return has;
    };
    c3_chart_internal_fn.hasArcType = function (targets) {
        return this.hasType('pie', targets) || this.hasType('donut', targets) || this.hasType('gauge', targets);
    };
    c3_chart_internal_fn.isLineType = function (d) {
        var config = this.config,
            id = isString(d) ? d : d.id;
        return !config.data_types[id] || ['line', 'spline', 'area', 'area-spline', 'step', 'area-step'].indexOf(config.data_types[id]) >= 0;
    };
    c3_chart_internal_fn.isStepType = function (d) {
        var id = isString(d) ? d : d.id;
        return ['step', 'area-step'].indexOf(this.config.data_types[id]) >= 0;
    };
    c3_chart_internal_fn.isSplineType = function (d) {
        var id = isString(d) ? d : d.id;
        return ['spline', 'area-spline'].indexOf(this.config.data_types[id]) >= 0;
    };
    c3_chart_internal_fn.isAreaType = function (d) {
        var id = isString(d) ? d : d.id;
        return ['area', 'area-spline', 'area-step'].indexOf(this.config.data_types[id]) >= 0;
    };
    c3_chart_internal_fn.isBarType = function (d) {
        var id = isString(d) ? d : d.id;
        return this.config.data_types[id] === 'bar';
    };
    c3_chart_internal_fn.isScatterType = function (d) {
        var id = isString(d) ? d : d.id;
        return this.config.data_types[id] === 'scatter';
    };
    c3_chart_internal_fn.isPieType = function (d) {
        var id = isString(d) ? d : d.id;
        return this.config.data_types[id] === 'pie';
    };
    c3_chart_internal_fn.isGaugeType = function (d) {
        var id = isString(d) ? d : d.id;
        return this.config.data_types[id] === 'gauge';
    };
    c3_chart_internal_fn.isDonutType = function (d) {
        var id = isString(d) ? d : d.id;
        return this.config.data_types[id] === 'donut';
    };
    c3_chart_internal_fn.isArcType = function (d) {
        return this.isPieType(d) || this.isDonutType(d) || this.isGaugeType(d);
    };
    c3_chart_internal_fn.lineData = function (d) {
        return this.isLineType(d) ? [d] : [];
    };
    c3_chart_internal_fn.arcData = function (d) {
        return this.isArcType(d.data) ? [d] : [];
    };
    /* not used
     function scatterData(d) {
     return isScatterType(d) ? d.values : [];
     }
     */
    c3_chart_internal_fn.barData = function (d) {
        return this.isBarType(d) ? d.values : [];
    };
    c3_chart_internal_fn.lineOrScatterData = function (d) {
        return this.isLineType(d) || this.isScatterType(d) ? d.values : [];
    };
    c3_chart_internal_fn.barOrLineData = function (d) {
        return this.isBarType(d) || this.isLineType(d) ? d.values : [];
    };
    c3_chart_internal_fn.isInterpolationType = function (type) {
        return ['linear', 'linear-closed', 'basis', 'basis-open', 'basis-closed', 'bundle', 'cardinal', 'cardinal-open', 'cardinal-closed', 'monotone'].indexOf(type) >= 0;
    };

    c3_chart_internal_fn.initGrid = function () {
        var $$ = this,
            config = $$.config,
            d3 = $$.d3;
        $$.grid = $$.main.append('g').attr("clip-path", $$.clipPathForGrid).attr('class', CLASS.grid);
        if (config.grid_x_show) {
            $$.grid.append("g").attr("class", CLASS.xgrids);
        }
        if (config.grid_y_show) {
            $$.grid.append('g').attr('class', CLASS.ygrids);
        }
        if (config.grid_focus_show) {
            $$.grid.append('g').attr("class", CLASS.xgridFocus).append('line').attr('class', CLASS.xgridFocus);
        }
        $$.xgrid = d3.selectAll([]);
        if (!config.grid_lines_front) {
            $$.initGridLines();
        }
    };
    c3_chart_internal_fn.initGridLines = function () {
        var $$ = this,
            d3 = $$.d3;
        $$.gridLines = $$.main.append('g').attr("clip-path", $$.clipPathForGrid).attr('class', CLASS.grid + ' ' + CLASS.gridLines);
        $$.gridLines.append('g').attr("class", CLASS.xgridLines);
        $$.gridLines.append('g').attr('class', CLASS.ygridLines);
        $$.xgridLines = d3.selectAll([]);
    };
    c3_chart_internal_fn.updateXGrid = function (withoutUpdate) {
        var $$ = this,
            config = $$.config,
            d3 = $$.d3,
            xgridData = $$.generateGridData(config.grid_x_type, $$.x),
            tickOffset = $$.isCategorized() ? $$.xAxis.tickOffset() : 0;

        $$.xgridAttr = config.axis_rotated ? {
            'x1': 0,
            'x2': $$.width,
            'y1': function y1(d) {
                return $$.x(d) - tickOffset;
            },
            'y2': function y2(d) {
                return $$.x(d) - tickOffset;
            }
        } : {
            'x1': function x1(d) {
                return $$.x(d) + tickOffset;
            },
            'x2': function x2(d) {
                return $$.x(d) + tickOffset;
            },
            'y1': 0,
            'y2': $$.height
        };

        $$.xgrid = $$.main.select('.' + CLASS.xgrids).selectAll('.' + CLASS.xgrid).data(xgridData);
        $$.xgrid.enter().append('line').attr("class", CLASS.xgrid);
        if (!withoutUpdate) {
            $$.xgrid.attr($$.xgridAttr).style("opacity", function () {
                return +d3.select(this).attr(config.axis_rotated ? 'y1' : 'x1') === (config.axis_rotated ? $$.height : 0) ? 0 : 1;
            });
        }
        $$.xgrid.exit().remove();
    };

    c3_chart_internal_fn.updateYGrid = function () {
        var $$ = this,
            config = $$.config,
            gridValues = $$.yAxis.tickValues() || $$.y.ticks(config.grid_y_ticks);
        $$.ygrid = $$.main.select('.' + CLASS.ygrids).selectAll('.' + CLASS.ygrid).data(gridValues);
        $$.ygrid.enter().append('line').attr('class', CLASS.ygrid);
        $$.ygrid.attr("x1", config.axis_rotated ? $$.y : 0).attr("x2", config.axis_rotated ? $$.y : $$.width).attr("y1", config.axis_rotated ? 0 : $$.y).attr("y2", config.axis_rotated ? $$.height : $$.y);
        $$.ygrid.exit().remove();
        $$.smoothLines($$.ygrid, 'grid');
    };

    c3_chart_internal_fn.gridTextAnchor = function (d) {
        return d.position ? d.position : "end";
    };
    c3_chart_internal_fn.gridTextDx = function (d) {
        return d.position === 'start' ? 4 : d.position === 'middle' ? 0 : -4;
    };
    c3_chart_internal_fn.xGridTextX = function (d) {
        return d.position === 'start' ? -this.height : d.position === 'middle' ? -this.height / 2 : 0;
    };
    c3_chart_internal_fn.yGridTextX = function (d) {
        return d.position === 'start' ? 0 : d.position === 'middle' ? this.width / 2 : this.width;
    };
    c3_chart_internal_fn.updateGrid = function (duration) {
        var $$ = this,
            main = $$.main,
            config = $$.config,
            xgridLine,
            ygridLine,
            yv;

        // hide if arc type
        $$.grid.style('visibility', $$.hasArcType() ? 'hidden' : 'visible');

        main.select('line.' + CLASS.xgridFocus).style("visibility", "hidden");
        if (config.grid_x_show) {
            $$.updateXGrid();
        }
        $$.xgridLines = main.select('.' + CLASS.xgridLines).selectAll('.' + CLASS.xgridLine).data(config.grid_x_lines);
        // enter
        xgridLine = $$.xgridLines.enter().append('g').attr("class", function (d) {
            return CLASS.xgridLine + (d['class'] ? ' ' + d['class'] : '');
        });
        xgridLine.append('line').style("opacity", 0);
        xgridLine.append('text').attr("text-anchor", $$.gridTextAnchor).attr("transform", config.axis_rotated ? "" : "rotate(-90)").attr('dx', $$.gridTextDx).attr('dy', -5).style("opacity", 0);
        // udpate
        // done in d3.transition() of the end of this function
        // exit
        $$.xgridLines.exit().transition().duration(duration).style("opacity", 0).remove();

        // Y-Grid
        if (config.grid_y_show) {
            $$.updateYGrid();
        }
        $$.ygridLines = main.select('.' + CLASS.ygridLines).selectAll('.' + CLASS.ygridLine).data(config.grid_y_lines);
        // enter
        ygridLine = $$.ygridLines.enter().append('g').attr("class", function (d) {
            return CLASS.ygridLine + (d['class'] ? ' ' + d['class'] : '');
        });
        ygridLine.append('line').style("opacity", 0);
        ygridLine.append('text').attr("text-anchor", $$.gridTextAnchor).attr("transform", config.axis_rotated ? "rotate(-90)" : "").attr('dx', $$.gridTextDx).attr('dy', -5).style("opacity", 0);
        // update
        yv = $$.yv.bind($$);
        $$.ygridLines.select('line').transition().duration(duration).attr("x1", config.axis_rotated ? yv : 0).attr("x2", config.axis_rotated ? yv : $$.width).attr("y1", config.axis_rotated ? 0 : yv).attr("y2", config.axis_rotated ? $$.height : yv).style("opacity", 1);
        $$.ygridLines.select('text').transition().duration(duration).attr("x", config.axis_rotated ? $$.xGridTextX.bind($$) : $$.yGridTextX.bind($$)).attr("y", yv).text(function (d) {
            return d.text;
        }).style("opacity", 1);
        // exit
        $$.ygridLines.exit().transition().duration(duration).style("opacity", 0).remove();
    };
    c3_chart_internal_fn.redrawGrid = function (withTransition) {
        var $$ = this,
            config = $$.config,
            xv = $$.xv.bind($$),
            lines = $$.xgridLines.select('line'),
            texts = $$.xgridLines.select('text');
        return [(withTransition ? lines.transition() : lines).attr("x1", config.axis_rotated ? 0 : xv).attr("x2", config.axis_rotated ? $$.width : xv).attr("y1", config.axis_rotated ? xv : 0).attr("y2", config.axis_rotated ? xv : $$.height).style("opacity", 1), (withTransition ? texts.transition() : texts).attr("x", config.axis_rotated ? $$.yGridTextX.bind($$) : $$.xGridTextX.bind($$)).attr("y", xv).text(function (d) {
            return d.text;
        }).style("opacity", 1)];
    };
    c3_chart_internal_fn.showXGridFocus = function (selectedData) {
        var $$ = this,
            config = $$.config,
            dataToShow = selectedData.filter(function (d) {
            return d && isValue(d.value);
        }),
            focusEl = $$.main.selectAll('line.' + CLASS.xgridFocus),
            xx = $$.xx.bind($$);
        if (!config.tooltip_show) {
            return;
        }
        // Hide when scatter plot exists
        if ($$.hasType('scatter') || $$.hasArcType()) {
            return;
        }
        focusEl.style("visibility", "visible").data([dataToShow[0]]).attr(config.axis_rotated ? 'y1' : 'x1', xx).attr(config.axis_rotated ? 'y2' : 'x2', xx);
        $$.smoothLines(focusEl, 'grid');
    };
    c3_chart_internal_fn.hideXGridFocus = function () {
        this.main.select('line.' + CLASS.xgridFocus).style("visibility", "hidden");
    };
    c3_chart_internal_fn.updateXgridFocus = function () {
        var $$ = this,
            config = $$.config;
        $$.main.select('line.' + CLASS.xgridFocus).attr("x1", config.axis_rotated ? 0 : -10).attr("x2", config.axis_rotated ? $$.width : -10).attr("y1", config.axis_rotated ? -10 : 0).attr("y2", config.axis_rotated ? -10 : $$.height);
    };
    c3_chart_internal_fn.generateGridData = function (type, scale) {
        var $$ = this,
            gridData = [],
            xDomain,
            firstYear,
            lastYear,
            i,
            tickNum = $$.main.select("." + CLASS.axisX).selectAll('.tick').size();
        if (type === 'year') {
            xDomain = $$.getXDomain();
            firstYear = xDomain[0].getFullYear();
            lastYear = xDomain[1].getFullYear();
            for (i = firstYear; i <= lastYear; i++) {
                gridData.push(new Date(i + '-01-01 00:00:00'));
            }
        } else {
            gridData = scale.ticks(10);
            if (gridData.length > tickNum) {
                // use only int
                gridData = gridData.filter(function (d) {
                    return ("" + d).indexOf('.') < 0;
                });
            }
        }
        return gridData;
    };
    c3_chart_internal_fn.getGridFilterToRemove = function (params) {
        return params ? function (line) {
            var found = false;
            [].concat(params).forEach(function (param) {
                if ('value' in param && line.value === param.value || 'class' in param && line['class'] === param['class']) {
                    found = true;
                }
            });
            return found;
        } : function () {
            return true;
        };
    };
    c3_chart_internal_fn.removeGridLines = function (params, forX) {
        var $$ = this,
            config = $$.config,
            toRemove = $$.getGridFilterToRemove(params),
            toShow = function toShow(line) {
            return !toRemove(line);
        },
            classLines = forX ? CLASS.xgridLines : CLASS.ygridLines,
            classLine = forX ? CLASS.xgridLine : CLASS.ygridLine;
        $$.main.select('.' + classLines).selectAll('.' + classLine).filter(toRemove).transition().duration(config.transition_duration).style('opacity', 0).remove();
        if (forX) {
            config.grid_x_lines = config.grid_x_lines.filter(toShow);
        } else {
            config.grid_y_lines = config.grid_y_lines.filter(toShow);
        }
    };

    c3_chart_internal_fn.initTooltip = function () {
        var $$ = this,
            config = $$.config,
            i;
        $$.tooltip = $$.selectChart.style("position", "relative").append("div").attr('class', CLASS.tooltipContainer).style("position", "absolute").style("pointer-events", "none").style("display", "none");
        // Show tooltip if needed
        if (config.tooltip_init_show) {
            if ($$.isTimeSeries() && isString(config.tooltip_init_x)) {
                config.tooltip_init_x = $$.parseDate(config.tooltip_init_x);
                for (i = 0; i < $$.data.targets[0].values.length; i++) {
                    if ($$.data.targets[0].values[i].x - config.tooltip_init_x === 0) {
                        break;
                    }
                }
                config.tooltip_init_x = i;
            }
            $$.tooltip.html(config.tooltip_contents.call($$, $$.data.targets.map(function (d) {
                return $$.addName(d.values[config.tooltip_init_x]);
            }), $$.axis.getXAxisTickFormat(), $$.getYFormat($$.hasArcType()), $$.color));
            $$.tooltip.style("top", config.tooltip_init_position.top).style("left", config.tooltip_init_position.left).style("display", "block");
        }
    };
    c3_chart_internal_fn.getTooltipContent = function (d, defaultTitleFormat, defaultValueFormat, color) {
        var $$ = this,
            config = $$.config,
            titleFormat = config.tooltip_format_title || defaultTitleFormat,
            nameFormat = config.tooltip_format_name || function (name) {
            return name;
        },
            valueFormat = config.tooltip_format_value || defaultValueFormat,
            text,
            i,
            title,
            value,
            name,
            bgcolor,
            orderAsc = $$.isOrderAsc();

        if (config.data_groups.length === 0) {
            d.sort(function (a, b) {
                var v1 = a ? a.value : null,
                    v2 = b ? b.value : null;
                return orderAsc ? v1 - v2 : v2 - v1;
            });
        } else {
            var ids = $$.orderTargets($$.data.targets).map(function (i) {
                return i.id;
            });
            d.sort(function (a, b) {
                var v1 = a ? a.value : null,
                    v2 = b ? b.value : null;
                if (v1 > 0 && v2 > 0) {
                    v1 = a ? ids.indexOf(a.id) : null;
                    v2 = b ? ids.indexOf(b.id) : null;
                }
                return orderAsc ? v1 - v2 : v2 - v1;
            });
        }

        for (i = 0; i < d.length; i++) {
            if (!(d[i] && (d[i].value || d[i].value === 0))) {
                continue;
            }

            if (!text) {
                title = sanitise(titleFormat ? titleFormat(d[i].x) : d[i].x);
                text = "<table class='" + $$.CLASS.tooltip + "'>" + (title || title === 0 ? "<tr><th colspan='2'>" + title + "</th></tr>" : "");
            }

            value = sanitise(valueFormat(d[i].value, d[i].ratio, d[i].id, d[i].index, d));
            if (value !== undefined) {
                // Skip elements when their name is set to null
                if (d[i].name === null) {
                    continue;
                }
                name = sanitise(nameFormat(d[i].name, d[i].ratio, d[i].id, d[i].index));
                bgcolor = $$.levelColor ? $$.levelColor(d[i].value) : color(d[i].id);

                text += "<tr class='" + $$.CLASS.tooltipName + "-" + $$.getTargetSelectorSuffix(d[i].id) + "'>";
                text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>" + name + "</td>";
                text += "<td class='value'>" + value + "</td>";
                text += "</tr>";
            }
        }
        return text + "</table>";
    };
    c3_chart_internal_fn.tooltipPosition = function (dataToShow, tWidth, tHeight, element) {
        var $$ = this,
            config = $$.config,
            d3 = $$.d3;
        var svgLeft, tooltipLeft, tooltipRight, tooltipTop, chartRight;
        var forArc = $$.hasArcType(),
            mouse = d3.mouse(element);
        // Determin tooltip position
        if (forArc) {
            tooltipLeft = ($$.width - ($$.isLegendRight ? $$.getLegendWidth() : 0)) / 2 + mouse[0];
            tooltipTop = $$.height / 2 + mouse[1] + 20;
        } else {
            svgLeft = $$.getSvgLeft(true);
            if (config.axis_rotated) {
                tooltipLeft = svgLeft + mouse[0] + 100;
                tooltipRight = tooltipLeft + tWidth;
                chartRight = $$.currentWidth - $$.getCurrentPaddingRight();
                tooltipTop = $$.x(dataToShow[0].x) + 20;
            } else {
                tooltipLeft = svgLeft + $$.getCurrentPaddingLeft(true) + $$.x(dataToShow[0].x) + 20;
                tooltipRight = tooltipLeft + tWidth;
                chartRight = svgLeft + $$.currentWidth - $$.getCurrentPaddingRight();
                tooltipTop = mouse[1] + 15;
            }

            if (tooltipRight > chartRight) {
                // 20 is needed for Firefox to keep tooltip width
                tooltipLeft -= tooltipRight - chartRight + 20;
            }
            if (tooltipTop + tHeight > $$.currentHeight) {
                tooltipTop -= tHeight + 30;
            }
        }
        if (tooltipTop < 0) {
            tooltipTop = 0;
        }
        return { top: tooltipTop, left: tooltipLeft };
    };
    c3_chart_internal_fn.showTooltip = function (selectedData, element) {
        var $$ = this,
            config = $$.config;
        var tWidth, tHeight, position;
        var forArc = $$.hasArcType(),
            dataToShow = selectedData.filter(function (d) {
            return d && isValue(d.value);
        }),
            positionFunction = config.tooltip_position || c3_chart_internal_fn.tooltipPosition;
        if (dataToShow.length === 0 || !config.tooltip_show) {
            return;
        }
        $$.tooltip.html(config.tooltip_contents.call($$, selectedData, $$.axis.getXAxisTickFormat(), $$.getYFormat(forArc), $$.color)).style("display", "block");

        // Get tooltip dimensions
        tWidth = $$.tooltip.property('offsetWidth');
        tHeight = $$.tooltip.property('offsetHeight');

        position = positionFunction.call(this, dataToShow, tWidth, tHeight, element);
        // Set tooltip
        $$.tooltip.style("top", position.top + "px").style("left", position.left + 'px');
    };
    c3_chart_internal_fn.hideTooltip = function () {
        this.tooltip.style("display", "none");
    };

    c3_chart_internal_fn.initLegend = function () {
        var $$ = this;
        $$.legendItemTextBox = {};
        $$.legendHasRendered = false;
        $$.legend = $$.svg.append("g").attr("transform", $$.getTranslate('legend'));
        if (!$$.config.legend_show) {
            $$.legend.style('visibility', 'hidden');
            $$.hiddenLegendIds = $$.mapToIds($$.data.targets);
            return;
        }
        // MEMO: call here to update legend box and tranlate for all
        // MEMO: translate will be upated by this, so transform not needed in updateLegend()
        $$.updateLegendWithDefaults();
    };
    c3_chart_internal_fn.updateLegendWithDefaults = function () {
        var $$ = this;
        $$.updateLegend($$.mapToIds($$.data.targets), { withTransform: false, withTransitionForTransform: false, withTransition: false });
    };
    c3_chart_internal_fn.updateSizeForLegend = function (legendHeight, legendWidth) {
        var $$ = this,
            config = $$.config,
            insetLegendPosition = {
            top: $$.isLegendTop ? $$.getCurrentPaddingTop() + config.legend_inset_y + 5.5 : $$.currentHeight - legendHeight - $$.getCurrentPaddingBottom() - config.legend_inset_y,
            left: $$.isLegendLeft ? $$.getCurrentPaddingLeft() + config.legend_inset_x + 0.5 : $$.currentWidth - legendWidth - $$.getCurrentPaddingRight() - config.legend_inset_x + 0.5
        };

        $$.margin3 = {
            top: $$.isLegendRight ? 0 : $$.isLegendInset ? insetLegendPosition.top : $$.currentHeight - legendHeight,
            right: NaN,
            bottom: 0,
            left: $$.isLegendRight ? $$.currentWidth - legendWidth : $$.isLegendInset ? insetLegendPosition.left : 0
        };
    };
    c3_chart_internal_fn.transformLegend = function (withTransition) {
        var $$ = this;
        (withTransition ? $$.legend.transition() : $$.legend).attr("transform", $$.getTranslate('legend'));
    };
    c3_chart_internal_fn.updateLegendStep = function (step) {
        this.legendStep = step;
    };
    c3_chart_internal_fn.updateLegendItemWidth = function (w) {
        this.legendItemWidth = w;
    };
    c3_chart_internal_fn.updateLegendItemHeight = function (h) {
        this.legendItemHeight = h;
    };
    c3_chart_internal_fn.getLegendWidth = function () {
        var $$ = this;
        return $$.config.legend_show ? $$.isLegendRight || $$.isLegendInset ? $$.legendItemWidth * ($$.legendStep + 1) : $$.currentWidth : 0;
    };
    c3_chart_internal_fn.getLegendHeight = function () {
        var $$ = this,
            h = 0;
        if ($$.config.legend_show) {
            if ($$.isLegendRight) {
                h = $$.currentHeight;
            } else {
                h = Math.max(20, $$.legendItemHeight) * ($$.legendStep + 1);
            }
        }
        return h;
    };
    c3_chart_internal_fn.opacityForLegend = function (legendItem) {
        return legendItem.classed(CLASS.legendItemHidden) ? null : 1;
    };
    c3_chart_internal_fn.opacityForUnfocusedLegend = function (legendItem) {
        return legendItem.classed(CLASS.legendItemHidden) ? null : 0.3;
    };
    c3_chart_internal_fn.toggleFocusLegend = function (targetIds, focus) {
        var $$ = this;
        targetIds = $$.mapToTargetIds(targetIds);
        $$.legend.selectAll('.' + CLASS.legendItem).filter(function (id) {
            return targetIds.indexOf(id) >= 0;
        }).classed(CLASS.legendItemFocused, focus).transition().duration(100).style('opacity', function () {
            var opacity = focus ? $$.opacityForLegend : $$.opacityForUnfocusedLegend;
            return opacity.call($$, $$.d3.select(this));
        });
    };
    c3_chart_internal_fn.revertLegend = function () {
        var $$ = this,
            d3 = $$.d3;
        $$.legend.selectAll('.' + CLASS.legendItem).classed(CLASS.legendItemFocused, false).transition().duration(100).style('opacity', function () {
            return $$.opacityForLegend(d3.select(this));
        });
    };
    c3_chart_internal_fn.showLegend = function (targetIds) {
        var $$ = this,
            config = $$.config;
        if (!config.legend_show) {
            config.legend_show = true;
            $$.legend.style('visibility', 'visible');
            if (!$$.legendHasRendered) {
                $$.updateLegendWithDefaults();
            }
        }
        $$.removeHiddenLegendIds(targetIds);
        $$.legend.selectAll($$.selectorLegends(targetIds)).style('visibility', 'visible').transition().style('opacity', function () {
            return $$.opacityForLegend($$.d3.select(this));
        });
    };
    c3_chart_internal_fn.hideLegend = function (targetIds) {
        var $$ = this,
            config = $$.config;
        if (config.legend_show && isEmpty(targetIds)) {
            config.legend_show = false;
            $$.legend.style('visibility', 'hidden');
        }
        $$.addHiddenLegendIds(targetIds);
        $$.legend.selectAll($$.selectorLegends(targetIds)).style('opacity', 0).style('visibility', 'hidden');
    };
    c3_chart_internal_fn.clearLegendItemTextBoxCache = function () {
        this.legendItemTextBox = {};
    };
    c3_chart_internal_fn.updateLegend = function (targetIds, options, transitions) {
        var $$ = this,
            config = $$.config;
        var xForLegend, xForLegendText, xForLegendRect, yForLegend, yForLegendText, yForLegendRect, x1ForLegendTile, x2ForLegendTile, yForLegendTile;
        var paddingTop = 4,
            paddingRight = 10,
            maxWidth = 0,
            maxHeight = 0,
            posMin = 10,
            tileWidth = config.legend_item_tile_width + 5;
        var l,
            totalLength = 0,
            offsets = {},
            widths = {},
            heights = {},
            margins = [0],
            steps = {},
            step = 0;
        var withTransition, withTransitionForTransform;
        var texts, rects, tiles, background;

        // Skip elements when their name is set to null
        targetIds = targetIds.filter(function (id) {
            return !isDefined(config.data_names[id]) || config.data_names[id] !== null;
        });

        options = options || {};
        withTransition = getOption(options, "withTransition", true);
        withTransitionForTransform = getOption(options, "withTransitionForTransform", true);

        function getTextBox(textElement, id) {
            if (!$$.legendItemTextBox[id]) {
                $$.legendItemTextBox[id] = $$.getTextRect(textElement.textContent, CLASS.legendItem, textElement);
            }
            return $$.legendItemTextBox[id];
        }

        function updatePositions(textElement, id, index) {
            var reset = index === 0,
                isLast = index === targetIds.length - 1,
                box = getTextBox(textElement, id),
                itemWidth = box.width + tileWidth + (isLast && !($$.isLegendRight || $$.isLegendInset) ? 0 : paddingRight) + config.legend_padding,
                itemHeight = box.height + paddingTop,
                itemLength = $$.isLegendRight || $$.isLegendInset ? itemHeight : itemWidth,
                areaLength = $$.isLegendRight || $$.isLegendInset ? $$.getLegendHeight() : $$.getLegendWidth(),
                margin,
                maxLength;

            // MEMO: care about condifion of step, totalLength
            function updateValues(id, withoutStep) {
                if (!withoutStep) {
                    margin = (areaLength - totalLength - itemLength) / 2;
                    if (margin < posMin) {
                        margin = (areaLength - itemLength) / 2;
                        totalLength = 0;
                        step++;
                    }
                }
                steps[id] = step;
                margins[step] = $$.isLegendInset ? 10 : margin;
                offsets[id] = totalLength;
                totalLength += itemLength;
            }

            if (reset) {
                totalLength = 0;
                step = 0;
                maxWidth = 0;
                maxHeight = 0;
            }

            if (config.legend_show && !$$.isLegendToShow(id)) {
                widths[id] = heights[id] = steps[id] = offsets[id] = 0;
                return;
            }

            widths[id] = itemWidth;
            heights[id] = itemHeight;

            if (!maxWidth || itemWidth >= maxWidth) {
                maxWidth = itemWidth;
            }
            if (!maxHeight || itemHeight >= maxHeight) {
                maxHeight = itemHeight;
            }
            maxLength = $$.isLegendRight || $$.isLegendInset ? maxHeight : maxWidth;

            if (config.legend_equally) {
                Object.keys(widths).forEach(function (id) {
                    widths[id] = maxWidth;
                });
                Object.keys(heights).forEach(function (id) {
                    heights[id] = maxHeight;
                });
                margin = (areaLength - maxLength * targetIds.length) / 2;
                if (margin < posMin) {
                    totalLength = 0;
                    step = 0;
                    targetIds.forEach(function (id) {
                        updateValues(id);
                    });
                } else {
                    updateValues(id, true);
                }
            } else {
                updateValues(id);
            }
        }

        if ($$.isLegendInset) {
            step = config.legend_inset_step ? config.legend_inset_step : targetIds.length;
            $$.updateLegendStep(step);
        }

        if ($$.isLegendRight) {
            xForLegend = function xForLegend(id) {
                return maxWidth * steps[id];
            };
            yForLegend = function yForLegend(id) {
                return margins[steps[id]] + offsets[id];
            };
        } else if ($$.isLegendInset) {
            xForLegend = function xForLegend(id) {
                return maxWidth * steps[id] + 10;
            };
            yForLegend = function yForLegend(id) {
                return margins[steps[id]] + offsets[id];
            };
        } else {
            xForLegend = function xForLegend(id) {
                return margins[steps[id]] + offsets[id];
            };
            yForLegend = function yForLegend(id) {
                return maxHeight * steps[id];
            };
        }
        xForLegendText = function xForLegendText(id, i) {
            return xForLegend(id, i) + 4 + config.legend_item_tile_width;
        };
        yForLegendText = function yForLegendText(id, i) {
            return yForLegend(id, i) + 9;
        };
        xForLegendRect = function xForLegendRect(id, i) {
            return xForLegend(id, i);
        };
        yForLegendRect = function yForLegendRect(id, i) {
            return yForLegend(id, i) - 5;
        };
        x1ForLegendTile = function x1ForLegendTile(id, i) {
            return xForLegend(id, i) - 2;
        };
        x2ForLegendTile = function x2ForLegendTile(id, i) {
            return xForLegend(id, i) - 2 + config.legend_item_tile_width;
        };
        yForLegendTile = function yForLegendTile(id, i) {
            return yForLegend(id, i) + 4;
        };

        // Define g for legend area
        l = $$.legend.selectAll('.' + CLASS.legendItem).data(targetIds).enter().append('g').attr('class', function (id) {
            return $$.generateClass(CLASS.legendItem, id);
        }).style('visibility', function (id) {
            return $$.isLegendToShow(id) ? 'visible' : 'hidden';
        }).style('cursor', 'pointer').on('click', function (id) {
            if (config.legend_item_onclick) {
                config.legend_item_onclick.call($$, id);
            } else {
                if ($$.d3.event.altKey) {
                    $$.api.hide();
                    $$.api.show(id);
                } else {
                    $$.api.toggle(id);
                    $$.isTargetToShow(id) ? $$.api.focus(id) : $$.api.revert();
                }
            }
        }).on('mouseover', function (id) {
            if (config.legend_item_onmouseover) {
                config.legend_item_onmouseover.call($$, id);
            } else {
                $$.d3.select(this).classed(CLASS.legendItemFocused, true);
                if (!$$.transiting && $$.isTargetToShow(id)) {
                    $$.api.focus(id);
                }
            }
        }).on('mouseout', function (id) {
            if (config.legend_item_onmouseout) {
                config.legend_item_onmouseout.call($$, id);
            } else {
                $$.d3.select(this).classed(CLASS.legendItemFocused, false);
                $$.api.revert();
            }
        });
        l.append('text').text(function (id) {
            return isDefined(config.data_names[id]) ? config.data_names[id] : id;
        }).each(function (id, i) {
            updatePositions(this, id, i);
        }).style("pointer-events", "none").attr('x', $$.isLegendRight || $$.isLegendInset ? xForLegendText : -200).attr('y', $$.isLegendRight || $$.isLegendInset ? -200 : yForLegendText);
        l.append('rect').attr("class", CLASS.legendItemEvent).style('fill-opacity', 0).attr('x', $$.isLegendRight || $$.isLegendInset ? xForLegendRect : -200).attr('y', $$.isLegendRight || $$.isLegendInset ? -200 : yForLegendRect);
        l.append('line').attr('class', CLASS.legendItemTile).style('stroke', $$.color).style("pointer-events", "none").attr('x1', $$.isLegendRight || $$.isLegendInset ? x1ForLegendTile : -200).attr('y1', $$.isLegendRight || $$.isLegendInset ? -200 : yForLegendTile).attr('x2', $$.isLegendRight || $$.isLegendInset ? x2ForLegendTile : -200).attr('y2', $$.isLegendRight || $$.isLegendInset ? -200 : yForLegendTile).attr('stroke-width', config.legend_item_tile_height);

        // Set background for inset legend
        background = $$.legend.select('.' + CLASS.legendBackground + ' rect');
        if ($$.isLegendInset && maxWidth > 0 && background.size() === 0) {
            background = $$.legend.insert('g', '.' + CLASS.legendItem).attr("class", CLASS.legendBackground).append('rect');
        }

        texts = $$.legend.selectAll('text').data(targetIds).text(function (id) {
            return isDefined(config.data_names[id]) ? config.data_names[id] : id;
        }) // MEMO: needed for update
        .each(function (id, i) {
            updatePositions(this, id, i);
        });
        (withTransition ? texts.transition() : texts).attr('x', xForLegendText).attr('y', yForLegendText);

        rects = $$.legend.selectAll('rect.' + CLASS.legendItemEvent).data(targetIds);
        (withTransition ? rects.transition() : rects).attr('width', function (id) {
            return widths[id];
        }).attr('height', function (id) {
            return heights[id];
        }).attr('x', xForLegendRect).attr('y', yForLegendRect);

        tiles = $$.legend.selectAll('line.' + CLASS.legendItemTile).data(targetIds);
        (withTransition ? tiles.transition() : tiles).style('stroke', $$.color).attr('x1', x1ForLegendTile).attr('y1', yForLegendTile).attr('x2', x2ForLegendTile).attr('y2', yForLegendTile);

        if (background) {
            (withTransition ? background.transition() : background).attr('height', $$.getLegendHeight() - 12).attr('width', maxWidth * (step + 1) + 10);
        }

        // toggle legend state
        $$.legend.selectAll('.' + CLASS.legendItem).classed(CLASS.legendItemHidden, function (id) {
            return !$$.isTargetToShow(id);
        });

        // Update all to reflect change of legend
        $$.updateLegendItemWidth(maxWidth);
        $$.updateLegendItemHeight(maxHeight);
        $$.updateLegendStep(step);
        // Update size and scale
        $$.updateSizes();
        $$.updateScales();
        $$.updateSvgSize();
        // Update g positions
        $$.transformAll(withTransitionForTransform, transitions);
        $$.legendHasRendered = true;
    };

    c3_chart_internal_fn.initTitle = function () {
        var $$ = this;
        $$.title = $$.svg.append("text").text($$.config.title_text).attr("class", $$.CLASS.title);
    };
    c3_chart_internal_fn.redrawTitle = function () {
        var $$ = this;
        $$.title.attr("x", $$.xForTitle.bind($$)).attr("y", $$.yForTitle.bind($$));
    };
    c3_chart_internal_fn.xForTitle = function () {
        var $$ = this,
            config = $$.config,
            position = config.title_position || 'left',
            x;
        if (position.indexOf('right') >= 0) {
            x = $$.currentWidth - $$.getTextRect($$.title.node().textContent, $$.CLASS.title, $$.title.node()).width - config.title_padding.right;
        } else if (position.indexOf('center') >= 0) {
            x = ($$.currentWidth - $$.getTextRect($$.title.node().textContent, $$.CLASS.title, $$.title.node()).width) / 2;
        } else {
            // left
            x = config.title_padding.left;
        }
        return x;
    };
    c3_chart_internal_fn.yForTitle = function () {
        var $$ = this;
        return $$.config.title_padding.top + $$.getTextRect($$.title.node().textContent, $$.CLASS.title, $$.title.node()).height;
    };
    c3_chart_internal_fn.getTitlePadding = function () {
        var $$ = this;
        return $$.yForTitle() + $$.config.title_padding.bottom;
    };

    function Axis(owner) {
        API.call(this, owner);
    }

    inherit(API, Axis);

    Axis.prototype.init = function init() {

        var $$ = this.owner,
            config = $$.config,
            main = $$.main;
        $$.axes.x = main.append("g").attr("class", CLASS.axis + ' ' + CLASS.axisX).attr("clip-path", $$.clipPathForXAxis).attr("transform", $$.getTranslate('x')).style("visibility", config.axis_x_show ? 'visible' : 'hidden');
        $$.axes.x.append("text").attr("class", CLASS.axisXLabel).attr("transform", config.axis_rotated ? "rotate(-90)" : "").style("text-anchor", this.textAnchorForXAxisLabel.bind(this));
        $$.axes.y = main.append("g").attr("class", CLASS.axis + ' ' + CLASS.axisY).attr("clip-path", config.axis_y_inner ? "" : $$.clipPathForYAxis).attr("transform", $$.getTranslate('y')).style("visibility", config.axis_y_show ? 'visible' : 'hidden');
        $$.axes.y.append("text").attr("class", CLASS.axisYLabel).attr("transform", config.axis_rotated ? "" : "rotate(-90)").style("text-anchor", this.textAnchorForYAxisLabel.bind(this));

        $$.axes.y2 = main.append("g").attr("class", CLASS.axis + ' ' + CLASS.axisY2)
        // clip-path?
        .attr("transform", $$.getTranslate('y2')).style("visibility", config.axis_y2_show ? 'visible' : 'hidden');
        $$.axes.y2.append("text").attr("class", CLASS.axisY2Label).attr("transform", config.axis_rotated ? "" : "rotate(-90)").style("text-anchor", this.textAnchorForY2AxisLabel.bind(this));
    };
    Axis.prototype.getXAxis = function getXAxis(scale, orient, tickFormat, tickValues, withOuterTick, withoutTransition, withoutRotateTickText) {
        var $$ = this.owner,
            config = $$.config,
            axisParams = {
            isCategory: $$.isCategorized(),
            withOuterTick: withOuterTick,
            tickMultiline: config.axis_x_tick_multiline,
            tickWidth: config.axis_x_tick_width,
            tickTextRotate: withoutRotateTickText ? 0 : config.axis_x_tick_rotate,
            withoutTransition: withoutTransition
        },
            axis = c3_axis($$.d3, axisParams).scale(scale).orient(orient);

        if ($$.isTimeSeries() && tickValues && typeof tickValues !== "function") {
            tickValues = tickValues.map(function (v) {
                return $$.parseDate(v);
            });
        }

        // Set tick
        axis.tickFormat(tickFormat).tickValues(tickValues);
        if ($$.isCategorized()) {
            axis.tickCentered(config.axis_x_tick_centered);
            if (isEmpty(config.axis_x_tick_culling)) {
                config.axis_x_tick_culling = false;
            }
        }

        return axis;
    };
    Axis.prototype.updateXAxisTickValues = function updateXAxisTickValues(targets, axis) {
        var $$ = this.owner,
            config = $$.config,
            tickValues;
        if (config.axis_x_tick_fit || config.axis_x_tick_count) {
            tickValues = this.generateTickValues($$.mapTargetsToUniqueXs(targets), config.axis_x_tick_count, $$.isTimeSeries());
        }
        if (axis) {
            axis.tickValues(tickValues);
        } else {
            $$.xAxis.tickValues(tickValues);
            $$.subXAxis.tickValues(tickValues);
        }
        return tickValues;
    };
    Axis.prototype.getYAxis = function getYAxis(scale, orient, tickFormat, tickValues, withOuterTick, withoutTransition, withoutRotateTickText) {
        var $$ = this.owner,
            config = $$.config,
            axisParams = {
            withOuterTick: withOuterTick,
            withoutTransition: withoutTransition,
            tickTextRotate: withoutRotateTickText ? 0 : config.axis_y_tick_rotate
        },
            axis = c3_axis($$.d3, axisParams).scale(scale).orient(orient).tickFormat(tickFormat);
        if ($$.isTimeSeriesY()) {
            axis.ticks($$.d3.time[config.axis_y_tick_time_value], config.axis_y_tick_time_interval);
        } else {
            axis.tickValues(tickValues);
        }
        return axis;
    };
    Axis.prototype.getId = function getId(id) {
        var config = this.owner.config;
        return id in config.data_axes ? config.data_axes[id] : 'y';
    };
    Axis.prototype.getXAxisTickFormat = function getXAxisTickFormat() {
        var $$ = this.owner,
            config = $$.config,
            format = $$.isTimeSeries() ? $$.defaultAxisTimeFormat : $$.isCategorized() ? $$.categoryName : function (v) {
            return v < 0 ? v.toFixed(0) : v;
        };
        if (config.axis_x_tick_format) {
            if (isFunction(config.axis_x_tick_format)) {
                format = config.axis_x_tick_format;
            } else if ($$.isTimeSeries()) {
                format = function format(date) {
                    return date ? $$.axisTimeFormat(config.axis_x_tick_format)(date) : "";
                };
            }
        }
        return isFunction(format) ? function (v) {
            return format.call($$, v);
        } : format;
    };
    Axis.prototype.getTickValues = function getTickValues(tickValues, axis) {
        return tickValues ? tickValues : axis ? axis.tickValues() : undefined;
    };
    Axis.prototype.getXAxisTickValues = function getXAxisTickValues() {
        return this.getTickValues(this.owner.config.axis_x_tick_values, this.owner.xAxis);
    };
    Axis.prototype.getYAxisTickValues = function getYAxisTickValues() {
        return this.getTickValues(this.owner.config.axis_y_tick_values, this.owner.yAxis);
    };
    Axis.prototype.getY2AxisTickValues = function getY2AxisTickValues() {
        return this.getTickValues(this.owner.config.axis_y2_tick_values, this.owner.y2Axis);
    };
    Axis.prototype.getLabelOptionByAxisId = function getLabelOptionByAxisId(axisId) {
        var $$ = this.owner,
            config = $$.config,
            option;
        if (axisId === 'y') {
            option = config.axis_y_label;
        } else if (axisId === 'y2') {
            option = config.axis_y2_label;
        } else if (axisId === 'x') {
            option = config.axis_x_label;
        }
        return option;
    };
    Axis.prototype.getLabelText = function getLabelText(axisId) {
        var option = this.getLabelOptionByAxisId(axisId);
        return isString(option) ? option : option ? option.text : null;
    };
    Axis.prototype.setLabelText = function setLabelText(axisId, text) {
        var $$ = this.owner,
            config = $$.config,
            option = this.getLabelOptionByAxisId(axisId);
        if (isString(option)) {
            if (axisId === 'y') {
                config.axis_y_label = text;
            } else if (axisId === 'y2') {
                config.axis_y2_label = text;
            } else if (axisId === 'x') {
                config.axis_x_label = text;
            }
        } else if (option) {
            option.text = text;
        }
    };
    Axis.prototype.getLabelPosition = function getLabelPosition(axisId, defaultPosition) {
        var option = this.getLabelOptionByAxisId(axisId),
            position = option && (typeof option === 'undefined' ? 'undefined' : _typeof(option)) === 'object' && option.position ? option.position : defaultPosition;
        return {
            isInner: position.indexOf('inner') >= 0,
            isOuter: position.indexOf('outer') >= 0,
            isLeft: position.indexOf('left') >= 0,
            isCenter: position.indexOf('center') >= 0,
            isRight: position.indexOf('right') >= 0,
            isTop: position.indexOf('top') >= 0,
            isMiddle: position.indexOf('middle') >= 0,
            isBottom: position.indexOf('bottom') >= 0
        };
    };
    Axis.prototype.getXAxisLabelPosition = function getXAxisLabelPosition() {
        return this.getLabelPosition('x', this.owner.config.axis_rotated ? 'inner-top' : 'inner-right');
    };
    Axis.prototype.getYAxisLabelPosition = function getYAxisLabelPosition() {
        return this.getLabelPosition('y', this.owner.config.axis_rotated ? 'inner-right' : 'inner-top');
    };
    Axis.prototype.getY2AxisLabelPosition = function getY2AxisLabelPosition() {
        return this.getLabelPosition('y2', this.owner.config.axis_rotated ? 'inner-right' : 'inner-top');
    };
    Axis.prototype.getLabelPositionById = function getLabelPositionById(id) {
        return id === 'y2' ? this.getY2AxisLabelPosition() : id === 'y' ? this.getYAxisLabelPosition() : this.getXAxisLabelPosition();
    };
    Axis.prototype.textForXAxisLabel = function textForXAxisLabel() {
        return this.getLabelText('x');
    };
    Axis.prototype.textForYAxisLabel = function textForYAxisLabel() {
        return this.getLabelText('y');
    };
    Axis.prototype.textForY2AxisLabel = function textForY2AxisLabel() {
        return this.getLabelText('y2');
    };
    Axis.prototype.xForAxisLabel = function xForAxisLabel(forHorizontal, position) {
        var $$ = this.owner;
        if (forHorizontal) {
            return position.isLeft ? 0 : position.isCenter ? $$.width / 2 : $$.width;
        } else {
            return position.isBottom ? -$$.height : position.isMiddle ? -$$.height / 2 : 0;
        }
    };
    Axis.prototype.dxForAxisLabel = function dxForAxisLabel(forHorizontal, position) {
        if (forHorizontal) {
            return position.isLeft ? "0.5em" : position.isRight ? "-0.5em" : "0";
        } else {
            return position.isTop ? "-0.5em" : position.isBottom ? "0.5em" : "0";
        }
    };
    Axis.prototype.textAnchorForAxisLabel = function textAnchorForAxisLabel(forHorizontal, position) {
        if (forHorizontal) {
            return position.isLeft ? 'start' : position.isCenter ? 'middle' : 'end';
        } else {
            return position.isBottom ? 'start' : position.isMiddle ? 'middle' : 'end';
        }
    };
    Axis.prototype.xForXAxisLabel = function xForXAxisLabel() {
        return this.xForAxisLabel(!this.owner.config.axis_rotated, this.getXAxisLabelPosition());
    };
    Axis.prototype.xForYAxisLabel = function xForYAxisLabel() {
        return this.xForAxisLabel(this.owner.config.axis_rotated, this.getYAxisLabelPosition());
    };
    Axis.prototype.xForY2AxisLabel = function xForY2AxisLabel() {
        return this.xForAxisLabel(this.owner.config.axis_rotated, this.getY2AxisLabelPosition());
    };
    Axis.prototype.dxForXAxisLabel = function dxForXAxisLabel() {
        return this.dxForAxisLabel(!this.owner.config.axis_rotated, this.getXAxisLabelPosition());
    };
    Axis.prototype.dxForYAxisLabel = function dxForYAxisLabel() {
        return this.dxForAxisLabel(this.owner.config.axis_rotated, this.getYAxisLabelPosition());
    };
    Axis.prototype.dxForY2AxisLabel = function dxForY2AxisLabel() {
        return this.dxForAxisLabel(this.owner.config.axis_rotated, this.getY2AxisLabelPosition());
    };
    Axis.prototype.dyForXAxisLabel = function dyForXAxisLabel() {
        var $$ = this.owner,
            config = $$.config,
            position = this.getXAxisLabelPosition();
        if (config.axis_rotated) {
            return position.isInner ? "1.2em" : -25 - this.getMaxTickWidth('x');
        } else {
            return position.isInner ? "-0.5em" : config.axis_x_height ? config.axis_x_height - 10 : "3em";
        }
    };
    Axis.prototype.dyForYAxisLabel = function dyForYAxisLabel() {
        var $$ = this.owner,
            position = this.getYAxisLabelPosition();
        if ($$.config.axis_rotated) {
            return position.isInner ? "-0.5em" : "3em";
        } else {
            return position.isInner ? "1.2em" : -10 - ($$.config.axis_y_inner ? 0 : this.getMaxTickWidth('y') + 10);
        }
    };
    Axis.prototype.dyForY2AxisLabel = function dyForY2AxisLabel() {
        var $$ = this.owner,
            position = this.getY2AxisLabelPosition();
        if ($$.config.axis_rotated) {
            return position.isInner ? "1.2em" : "-2.2em";
        } else {
            return position.isInner ? "-0.5em" : 15 + ($$.config.axis_y2_inner ? 0 : this.getMaxTickWidth('y2') + 15);
        }
    };
    Axis.prototype.textAnchorForXAxisLabel = function textAnchorForXAxisLabel() {
        var $$ = this.owner;
        return this.textAnchorForAxisLabel(!$$.config.axis_rotated, this.getXAxisLabelPosition());
    };
    Axis.prototype.textAnchorForYAxisLabel = function textAnchorForYAxisLabel() {
        var $$ = this.owner;
        return this.textAnchorForAxisLabel($$.config.axis_rotated, this.getYAxisLabelPosition());
    };
    Axis.prototype.textAnchorForY2AxisLabel = function textAnchorForY2AxisLabel() {
        var $$ = this.owner;
        return this.textAnchorForAxisLabel($$.config.axis_rotated, this.getY2AxisLabelPosition());
    };
    Axis.prototype.getMaxTickWidth = function getMaxTickWidth(id, withoutRecompute) {
        var $$ = this.owner,
            config = $$.config,
            maxWidth = 0,
            targetsToShow,
            scale,
            axis,
            dummy,
            svg;
        if (withoutRecompute && $$.currentMaxTickWidths[id]) {
            return $$.currentMaxTickWidths[id];
        }
        if ($$.svg) {
            targetsToShow = $$.filterTargetsToShow($$.data.targets);
            if (id === 'y') {
                scale = $$.y.copy().domain($$.getYDomain(targetsToShow, 'y'));
                axis = this.getYAxis(scale, $$.yOrient, config.axis_y_tick_format, $$.yAxisTickValues, false, true, true);
            } else if (id === 'y2') {
                scale = $$.y2.copy().domain($$.getYDomain(targetsToShow, 'y2'));
                axis = this.getYAxis(scale, $$.y2Orient, config.axis_y2_tick_format, $$.y2AxisTickValues, false, true, true);
            } else {
                scale = $$.x.copy().domain($$.getXDomain(targetsToShow));
                axis = this.getXAxis(scale, $$.xOrient, $$.xAxisTickFormat, $$.xAxisTickValues, false, true, true);
                this.updateXAxisTickValues(targetsToShow, axis);
            }
            dummy = $$.d3.select('body').append('div').classed('c3', true);
            svg = dummy.append("svg").style('visibility', 'hidden').style('position', 'fixed').style('top', 0).style('left', 0), svg.append('g').call(axis).each(function () {
                $$.d3.select(this).selectAll('text').each(function () {
                    var box = this.getBoundingClientRect();
                    if (maxWidth < box.width) {
                        maxWidth = box.width;
                    }
                });
                dummy.remove();
            });
        }
        $$.currentMaxTickWidths[id] = maxWidth <= 0 ? $$.currentMaxTickWidths[id] : maxWidth;
        return $$.currentMaxTickWidths[id];
    };

    Axis.prototype.updateLabels = function updateLabels(withTransition) {
        var $$ = this.owner;
        var axisXLabel = $$.main.select('.' + CLASS.axisX + ' .' + CLASS.axisXLabel),
            axisYLabel = $$.main.select('.' + CLASS.axisY + ' .' + CLASS.axisYLabel),
            axisY2Label = $$.main.select('.' + CLASS.axisY2 + ' .' + CLASS.axisY2Label);
        (withTransition ? axisXLabel.transition() : axisXLabel).attr("x", this.xForXAxisLabel.bind(this)).attr("dx", this.dxForXAxisLabel.bind(this)).attr("dy", this.dyForXAxisLabel.bind(this)).text(this.textForXAxisLabel.bind(this));
        (withTransition ? axisYLabel.transition() : axisYLabel).attr("x", this.xForYAxisLabel.bind(this)).attr("dx", this.dxForYAxisLabel.bind(this)).attr("dy", this.dyForYAxisLabel.bind(this)).text(this.textForYAxisLabel.bind(this));
        (withTransition ? axisY2Label.transition() : axisY2Label).attr("x", this.xForY2AxisLabel.bind(this)).attr("dx", this.dxForY2AxisLabel.bind(this)).attr("dy", this.dyForY2AxisLabel.bind(this)).text(this.textForY2AxisLabel.bind(this));
    };
    Axis.prototype.getPadding = function getPadding(padding, key, defaultValue, domainLength) {
        var p = typeof padding === 'number' ? padding : padding[key];
        if (!isValue(p)) {
            return defaultValue;
        }
        if (padding.unit === 'ratio') {
            return padding[key] * domainLength;
        }
        // assume padding is pixels if unit is not specified
        return this.convertPixelsToAxisPadding(p, domainLength);
    };
    Axis.prototype.convertPixelsToAxisPadding = function convertPixelsToAxisPadding(pixels, domainLength) {
        var $$ = this.owner,
            length = $$.config.axis_rotated ? $$.width : $$.height;
        return domainLength * (pixels / length);
    };
    Axis.prototype.generateTickValues = function generateTickValues(values, tickCount, forTimeSeries) {
        var tickValues = values,
            targetCount,
            start,
            end,
            count,
            interval,
            i,
            tickValue;
        if (tickCount) {
            targetCount = isFunction(tickCount) ? tickCount() : tickCount;
            // compute ticks according to tickCount
            if (targetCount === 1) {
                tickValues = [values[0]];
            } else if (targetCount === 2) {
                tickValues = [values[0], values[values.length - 1]];
            } else if (targetCount > 2) {
                count = targetCount - 2;
                start = values[0];
                end = values[values.length - 1];
                interval = (end - start) / (count + 1);
                // re-construct unique values
                tickValues = [start];
                for (i = 0; i < count; i++) {
                    tickValue = +start + interval * (i + 1);
                    tickValues.push(forTimeSeries ? new Date(tickValue) : tickValue);
                }
                tickValues.push(end);
            }
        }
        if (!forTimeSeries) {
            tickValues = tickValues.sort(function (a, b) {
                return a - b;
            });
        }
        return tickValues;
    };
    Axis.prototype.generateTransitions = function generateTransitions(duration) {
        var $$ = this.owner,
            axes = $$.axes;
        return {
            axisX: duration ? axes.x.transition().duration(duration) : axes.x,
            axisY: duration ? axes.y.transition().duration(duration) : axes.y,
            axisY2: duration ? axes.y2.transition().duration(duration) : axes.y2,
            axisSubX: duration ? axes.subx.transition().duration(duration) : axes.subx
        };
    };
    Axis.prototype.redraw = function redraw(transitions, isHidden) {
        var $$ = this.owner;
        $$.axes.x.style("opacity", isHidden ? 0 : 1);
        $$.axes.y.style("opacity", isHidden ? 0 : 1);
        $$.axes.y2.style("opacity", isHidden ? 0 : 1);
        $$.axes.subx.style("opacity", isHidden ? 0 : 1);
        transitions.axisX.call($$.xAxis);
        transitions.axisY.call($$.yAxis);
        transitions.axisY2.call($$.y2Axis);
        transitions.axisSubX.call($$.subXAxis);
    };

    c3_chart_internal_fn.getClipPath = function (id) {
        var isIE9 = window.navigator.appVersion.toLowerCase().indexOf("msie 9.") >= 0;
        return "url(" + (isIE9 ? "" : document.URL.split('#')[0]) + "#" + id + ")";
    };
    c3_chart_internal_fn.appendClip = function (parent, id) {
        return parent.append("clipPath").attr("id", id).append("rect");
    };
    c3_chart_internal_fn.getAxisClipX = function (forHorizontal) {
        // axis line width + padding for left
        var left = Math.max(30, this.margin.left);
        return forHorizontal ? -(1 + left) : -(left - 1);
    };
    c3_chart_internal_fn.getAxisClipY = function (forHorizontal) {
        return forHorizontal ? -20 : -this.margin.top;
    };
    c3_chart_internal_fn.getXAxisClipX = function () {
        var $$ = this;
        return $$.getAxisClipX(!$$.config.axis_rotated);
    };
    c3_chart_internal_fn.getXAxisClipY = function () {
        var $$ = this;
        return $$.getAxisClipY(!$$.config.axis_rotated);
    };
    c3_chart_internal_fn.getYAxisClipX = function () {
        var $$ = this;
        return $$.config.axis_y_inner ? -1 : $$.getAxisClipX($$.config.axis_rotated);
    };
    c3_chart_internal_fn.getYAxisClipY = function () {
        var $$ = this;
        return $$.getAxisClipY($$.config.axis_rotated);
    };
    c3_chart_internal_fn.getAxisClipWidth = function (forHorizontal) {
        var $$ = this,
            left = Math.max(30, $$.margin.left),
            right = Math.max(30, $$.margin.right);
        // width + axis line width + padding for left/right
        return forHorizontal ? $$.width + 2 + left + right : $$.margin.left + 20;
    };
    c3_chart_internal_fn.getAxisClipHeight = function (forHorizontal) {
        // less than 20 is not enough to show the axis label 'outer' without legend
        return (forHorizontal ? this.margin.bottom : this.margin.top + this.height) + 20;
    };
    c3_chart_internal_fn.getXAxisClipWidth = function () {
        var $$ = this;
        return $$.getAxisClipWidth(!$$.config.axis_rotated);
    };
    c3_chart_internal_fn.getXAxisClipHeight = function () {
        var $$ = this;
        return $$.getAxisClipHeight(!$$.config.axis_rotated);
    };
    c3_chart_internal_fn.getYAxisClipWidth = function () {
        var $$ = this;
        return $$.getAxisClipWidth($$.config.axis_rotated) + ($$.config.axis_y_inner ? 20 : 0);
    };
    c3_chart_internal_fn.getYAxisClipHeight = function () {
        var $$ = this;
        return $$.getAxisClipHeight($$.config.axis_rotated);
    };

    c3_chart_internal_fn.initPie = function () {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config;
        $$.pie = d3.layout.pie().value(function (d) {
            return d.values.reduce(function (a, b) {
                return a + b.value;
            }, 0);
        });
        if (!config.data_order) {
            $$.pie.sort(null);
        }
    };

    c3_chart_internal_fn.updateRadius = function () {
        var $$ = this,
            config = $$.config,
            w = config.gauge_width || config.donut_width;
        $$.radiusExpanded = Math.min($$.arcWidth, $$.arcHeight) / 2;
        $$.radius = $$.radiusExpanded * 0.95;
        $$.innerRadiusRatio = w ? ($$.radius - w) / $$.radius : 0.6;
        $$.innerRadius = $$.hasType('donut') || $$.hasType('gauge') ? $$.radius * $$.innerRadiusRatio : 0;
    };

    c3_chart_internal_fn.updateArc = function () {
        var $$ = this;
        $$.svgArc = $$.getSvgArc();
        $$.svgArcExpanded = $$.getSvgArcExpanded();
        $$.svgArcExpandedSub = $$.getSvgArcExpanded(0.98);
    };

    c3_chart_internal_fn.updateAngle = function (d) {
        var $$ = this,
            config = $$.config,
            found = false,
            index = 0,
            gMin,
            gMax,
            gTic,
            gValue;

        if (!config) {
            return null;
        }

        $$.pie($$.filterTargetsToShow($$.data.targets)).forEach(function (t) {
            if (!found && t.data.id === d.data.id) {
                found = true;
                d = t;
                d.index = index;
            }
            index++;
        });
        if (isNaN(d.startAngle)) {
            d.startAngle = 0;
        }
        if (isNaN(d.endAngle)) {
            d.endAngle = d.startAngle;
        }
        if ($$.isGaugeType(d.data)) {
            gMin = config.gauge_min;
            gMax = config.gauge_max;
            gTic = Math.PI * (config.gauge_fullCircle ? 2 : 1) / (gMax - gMin);
            gValue = d.value < gMin ? 0 : d.value < gMax ? d.value - gMin : gMax - gMin;
            d.startAngle = config.gauge_startingAngle;
            d.endAngle = d.startAngle + gTic * gValue;
        }
        return found ? d : null;
    };

    c3_chart_internal_fn.getSvgArc = function () {
        var $$ = this,
            arc = $$.d3.svg.arc().outerRadius($$.radius).innerRadius($$.innerRadius),
            newArc = function newArc(d, withoutUpdate) {
            var updated;
            if (withoutUpdate) {
                return arc(d);
            } // for interpolate
            updated = $$.updateAngle(d);
            return updated ? arc(updated) : "M 0 0";
        };
        // TODO: extends all function
        newArc.centroid = arc.centroid;
        return newArc;
    };

    c3_chart_internal_fn.getSvgArcExpanded = function (rate) {
        var $$ = this,
            arc = $$.d3.svg.arc().outerRadius($$.radiusExpanded * (rate ? rate : 1)).innerRadius($$.innerRadius);
        return function (d) {
            var updated = $$.updateAngle(d);
            return updated ? arc(updated) : "M 0 0";
        };
    };

    c3_chart_internal_fn.getArc = function (d, withoutUpdate, force) {
        return force || this.isArcType(d.data) ? this.svgArc(d, withoutUpdate) : "M 0 0";
    };

    c3_chart_internal_fn.transformForArcLabel = function (d) {
        var $$ = this,
            config = $$.config,
            updated = $$.updateAngle(d),
            c,
            x,
            y,
            h,
            ratio,
            translate = "";
        if (updated && !$$.hasType('gauge')) {
            c = this.svgArc.centroid(updated);
            x = isNaN(c[0]) ? 0 : c[0];
            y = isNaN(c[1]) ? 0 : c[1];
            h = Math.sqrt(x * x + y * y);
            if ($$.hasType('donut') && config.donut_label_ratio) {
                ratio = isFunction(config.donut_label_ratio) ? config.donut_label_ratio(d, $$.radius, h) : config.donut_label_ratio;
            } else if ($$.hasType('pie') && config.pie_label_ratio) {
                ratio = isFunction(config.pie_label_ratio) ? config.pie_label_ratio(d, $$.radius, h) : config.pie_label_ratio;
            } else {
                ratio = $$.radius && h ? (36 / $$.radius > 0.375 ? 1.175 - 36 / $$.radius : 0.8) * $$.radius / h : 0;
            }
            translate = "translate(" + x * ratio + ',' + y * ratio + ")";
        }
        return translate;
    };

    c3_chart_internal_fn.getArcRatio = function (d) {
        var $$ = this,
            config = $$.config,
            whole = Math.PI * ($$.hasType('gauge') && !config.gauge_fullCircle ? 1 : 2);
        return d ? (d.endAngle - d.startAngle) / whole : null;
    };

    c3_chart_internal_fn.convertToArcData = function (d) {
        return this.addName({
            id: d.data.id,
            value: d.value,
            ratio: this.getArcRatio(d),
            index: d.index
        });
    };

    c3_chart_internal_fn.textForArcLabel = function (d) {
        var $$ = this,
            updated,
            value,
            ratio,
            id,
            format;
        if (!$$.shouldShowArcLabel()) {
            return "";
        }
        updated = $$.updateAngle(d);
        value = updated ? updated.value : null;
        ratio = $$.getArcRatio(updated);
        id = d.data.id;
        if (!$$.hasType('gauge') && !$$.meetsArcLabelThreshold(ratio)) {
            return "";
        }
        format = $$.getArcLabelFormat();
        return format ? format(value, ratio, id) : $$.defaultArcValueFormat(value, ratio);
    };

    c3_chart_internal_fn.expandArc = function (targetIds) {
        var $$ = this,
            interval;

        // MEMO: avoid to cancel transition
        if ($$.transiting) {
            interval = window.setInterval(function () {
                if (!$$.transiting) {
                    window.clearInterval(interval);
                    if ($$.legend.selectAll('.c3-legend-item-focused').size() > 0) {
                        $$.expandArc(targetIds);
                    }
                }
            }, 10);
            return;
        }

        targetIds = $$.mapToTargetIds(targetIds);

        $$.svg.selectAll($$.selectorTargets(targetIds, '.' + CLASS.chartArc)).each(function (d) {
            if (!$$.shouldExpand(d.data.id)) {
                return;
            }
            $$.d3.select(this).selectAll('path').transition().duration($$.expandDuration(d.data.id)).attr("d", $$.svgArcExpanded).transition().duration($$.expandDuration(d.data.id) * 2).attr("d", $$.svgArcExpandedSub).each(function (d) {
                if ($$.isDonutType(d.data)) {
                    // callback here
                }
            });
        });
    };

    c3_chart_internal_fn.unexpandArc = function (targetIds) {
        var $$ = this;

        if ($$.transiting) {
            return;
        }

        targetIds = $$.mapToTargetIds(targetIds);

        $$.svg.selectAll($$.selectorTargets(targetIds, '.' + CLASS.chartArc)).selectAll('path').transition().duration(function (d) {
            return $$.expandDuration(d.data.id);
        }).attr("d", $$.svgArc);
        $$.svg.selectAll('.' + CLASS.arc).style("opacity", 1);
    };

    c3_chart_internal_fn.expandDuration = function (id) {
        var $$ = this,
            config = $$.config;

        if ($$.isDonutType(id)) {
            return config.donut_expand_duration;
        } else if ($$.isGaugeType(id)) {
            return config.gauge_expand_duration;
        } else if ($$.isPieType(id)) {
            return config.pie_expand_duration;
        } else {
            return 50;
        }
    };

    c3_chart_internal_fn.shouldExpand = function (id) {
        var $$ = this,
            config = $$.config;
        return $$.isDonutType(id) && config.donut_expand || $$.isGaugeType(id) && config.gauge_expand || $$.isPieType(id) && config.pie_expand;
    };

    c3_chart_internal_fn.shouldShowArcLabel = function () {
        var $$ = this,
            config = $$.config,
            shouldShow = true;
        if ($$.hasType('donut')) {
            shouldShow = config.donut_label_show;
        } else if ($$.hasType('pie')) {
            shouldShow = config.pie_label_show;
        }
        // when gauge, always true
        return shouldShow;
    };

    c3_chart_internal_fn.meetsArcLabelThreshold = function (ratio) {
        var $$ = this,
            config = $$.config,
            threshold = $$.hasType('donut') ? config.donut_label_threshold : config.pie_label_threshold;
        return ratio >= threshold;
    };

    c3_chart_internal_fn.getArcLabelFormat = function () {
        var $$ = this,
            config = $$.config,
            format = config.pie_label_format;
        if ($$.hasType('gauge')) {
            format = config.gauge_label_format;
        } else if ($$.hasType('donut')) {
            format = config.donut_label_format;
        }
        return format;
    };

    c3_chart_internal_fn.getArcTitle = function () {
        var $$ = this;
        return $$.hasType('donut') ? $$.config.donut_title : "";
    };

    c3_chart_internal_fn.updateTargetsForArc = function (targets) {
        var $$ = this,
            main = $$.main,
            mainPieUpdate,
            mainPieEnter,
            classChartArc = $$.classChartArc.bind($$),
            classArcs = $$.classArcs.bind($$),
            classFocus = $$.classFocus.bind($$);
        mainPieUpdate = main.select('.' + CLASS.chartArcs).selectAll('.' + CLASS.chartArc).data($$.pie(targets)).attr("class", function (d) {
            return classChartArc(d) + classFocus(d.data);
        });
        mainPieEnter = mainPieUpdate.enter().append("g").attr("class", classChartArc);
        mainPieEnter.append('g').attr('class', classArcs);
        mainPieEnter.append("text").attr("dy", $$.hasType('gauge') ? "-.1em" : ".35em").style("opacity", 0).style("text-anchor", "middle").style("pointer-events", "none");
        // MEMO: can not keep same color..., but not bad to update color in redraw
        //mainPieUpdate.exit().remove();
    };

    c3_chart_internal_fn.initArc = function () {
        var $$ = this;
        $$.arcs = $$.main.select('.' + CLASS.chart).append("g").attr("class", CLASS.chartArcs).attr("transform", $$.getTranslate('arc'));
        $$.arcs.append('text').attr('class', CLASS.chartArcsTitle).style("text-anchor", "middle").text($$.getArcTitle());
    };

    c3_chart_internal_fn.redrawArc = function (duration, durationForExit, withTransform) {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config,
            main = $$.main,
            mainArc;
        mainArc = main.selectAll('.' + CLASS.arcs).selectAll('.' + CLASS.arc).data($$.arcData.bind($$));
        mainArc.enter().append('path').attr("class", $$.classArc.bind($$)).style("fill", function (d) {
            return $$.color(d.data);
        }).style("cursor", function (d) {
            return config.interaction_enabled && config.data_selection_isselectable(d) ? "pointer" : null;
        }).style("opacity", 0).each(function (d) {
            if ($$.isGaugeType(d.data)) {
                d.startAngle = d.endAngle = config.gauge_startingAngle;
            }
            this._current = d;
        });
        mainArc.attr("transform", function (d) {
            return !$$.isGaugeType(d.data) && withTransform ? "scale(0)" : "";
        }).style("opacity", function (d) {
            return d === this._current ? 0 : 1;
        }).on('mouseover', config.interaction_enabled ? function (d) {
            var updated, arcData;
            if ($$.transiting) {
                // skip while transiting
                return;
            }
            updated = $$.updateAngle(d);
            if (updated) {
                arcData = $$.convertToArcData(updated);
                // transitions
                $$.expandArc(updated.data.id);
                $$.api.focus(updated.data.id);
                $$.toggleFocusLegend(updated.data.id, true);
                $$.config.data_onmouseover(arcData, this);
            }
        } : null).on('mousemove', config.interaction_enabled ? function (d) {
            var updated = $$.updateAngle(d),
                arcData,
                selectedData;
            if (updated) {
                arcData = $$.convertToArcData(updated), selectedData = [arcData];
                $$.showTooltip(selectedData, this);
            }
        } : null).on('mouseout', config.interaction_enabled ? function (d) {
            var updated, arcData;
            if ($$.transiting) {
                // skip while transiting
                return;
            }
            updated = $$.updateAngle(d);
            if (updated) {
                arcData = $$.convertToArcData(updated);
                // transitions
                $$.unexpandArc(updated.data.id);
                $$.api.revert();
                $$.revertLegend();
                $$.hideTooltip();
                $$.config.data_onmouseout(arcData, this);
            }
        } : null).on('click', config.interaction_enabled ? function (d, i) {
            var updated = $$.updateAngle(d),
                arcData;
            if (updated) {
                arcData = $$.convertToArcData(updated);
                if ($$.toggleShape) {
                    $$.toggleShape(this, arcData, i);
                }
                $$.config.data_onclick.call($$.api, arcData, this);
            }
        } : null).each(function () {
            $$.transiting = true;
        }).transition().duration(duration).attrTween("d", function (d) {
            var updated = $$.updateAngle(d),
                interpolate;
            if (!updated) {
                return function () {
                    return "M 0 0";
                };
            }
            //                if (this._current === d) {
            //                    this._current = {
            //                        startAngle: Math.PI*2,
            //                        endAngle: Math.PI*2,
            //                    };
            //                }
            if (isNaN(this._current.startAngle)) {
                this._current.startAngle = 0;
            }
            if (isNaN(this._current.endAngle)) {
                this._current.endAngle = this._current.startAngle;
            }
            interpolate = d3.interpolate(this._current, updated);
            this._current = interpolate(0);
            return function (t) {
                var interpolated = interpolate(t);
                interpolated.data = d.data; // data.id will be updated by interporator
                return $$.getArc(interpolated, true);
            };
        }).attr("transform", withTransform ? "scale(1)" : "").style("fill", function (d) {
            return $$.levelColor ? $$.levelColor(d.data.values[0].value) : $$.color(d.data.id);
        }) // Where gauge reading color would receive customization.
        .style("opacity", 1).call($$.endall, function () {
            $$.transiting = false;
        });
        mainArc.exit().transition().duration(durationForExit).style('opacity', 0).remove();
        main.selectAll('.' + CLASS.chartArc).select('text').style("opacity", 0).attr('class', function (d) {
            return $$.isGaugeType(d.data) ? CLASS.gaugeValue : '';
        }).text($$.textForArcLabel.bind($$)).attr("transform", $$.transformForArcLabel.bind($$)).style('font-size', function (d) {
            return $$.isGaugeType(d.data) ? Math.round($$.radius / 5) + 'px' : '';
        }).transition().duration(duration).style("opacity", function (d) {
            return $$.isTargetToShow(d.data.id) && $$.isArcType(d.data) ? 1 : 0;
        });
        main.select('.' + CLASS.chartArcsTitle).style("opacity", $$.hasType('donut') || $$.hasType('gauge') ? 1 : 0);

        if ($$.hasType('gauge')) {
            $$.arcs.select('.' + CLASS.chartArcsBackground).attr("d", function () {
                var d = {
                    data: [{ value: config.gauge_max }],
                    startAngle: config.gauge_startingAngle,
                    endAngle: -1 * config.gauge_startingAngle
                };
                return $$.getArc(d, true, true);
            });
            $$.arcs.select('.' + CLASS.chartArcsGaugeUnit).attr("dy", ".75em").text(config.gauge_label_show ? config.gauge_units : '');
            $$.arcs.select('.' + CLASS.chartArcsGaugeMin).attr("dx", -1 * ($$.innerRadius + ($$.radius - $$.innerRadius) / (config.gauge_fullCircle ? 1 : 2)) + "px").attr("dy", "1.2em").text(config.gauge_label_show ? config.gauge_min : '');
            $$.arcs.select('.' + CLASS.chartArcsGaugeMax).attr("dx", $$.innerRadius + ($$.radius - $$.innerRadius) / (config.gauge_fullCircle ? 1 : 2) + "px").attr("dy", "1.2em").text(config.gauge_label_show ? config.gauge_max : '');
        }
    };
    c3_chart_internal_fn.initGauge = function () {
        var arcs = this.arcs;
        if (this.hasType('gauge')) {
            arcs.append('path').attr("class", CLASS.chartArcsBackground);
            arcs.append("text").attr("class", CLASS.chartArcsGaugeUnit).style("text-anchor", "middle").style("pointer-events", "none");
            arcs.append("text").attr("class", CLASS.chartArcsGaugeMin).style("text-anchor", "middle").style("pointer-events", "none");
            arcs.append("text").attr("class", CLASS.chartArcsGaugeMax).style("text-anchor", "middle").style("pointer-events", "none");
        }
    };
    c3_chart_internal_fn.getGaugeLabelHeight = function () {
        return this.config.gauge_label_show ? 20 : 0;
    };

    c3_chart_internal_fn.initRegion = function () {
        var $$ = this;
        $$.region = $$.main.append('g').attr("clip-path", $$.clipPath).attr("class", CLASS.regions);
    };
    c3_chart_internal_fn.updateRegion = function (duration) {
        var $$ = this,
            config = $$.config;

        // hide if arc type
        $$.region.style('visibility', $$.hasArcType() ? 'hidden' : 'visible');

        $$.mainRegion = $$.main.select('.' + CLASS.regions).selectAll('.' + CLASS.region).data(config.regions);
        $$.mainRegion.enter().append('g').append('rect').style("fill-opacity", 0);
        $$.mainRegion.attr('class', $$.classRegion.bind($$));
        $$.mainRegion.exit().transition().duration(duration).style("opacity", 0).remove();
    };
    c3_chart_internal_fn.redrawRegion = function (withTransition) {
        var $$ = this,
            regions = $$.mainRegion.selectAll('rect').each(function () {
            // data is binded to g and it's not transferred to rect (child node) automatically,
            // then data of each rect has to be updated manually.
            // TODO: there should be more efficient way to solve this?
            var parentData = $$.d3.select(this.parentNode).datum();
            $$.d3.select(this).datum(parentData);
        }),
            x = $$.regionX.bind($$),
            y = $$.regionY.bind($$),
            w = $$.regionWidth.bind($$),
            h = $$.regionHeight.bind($$);
        return [(withTransition ? regions.transition() : regions).attr("x", x).attr("y", y).attr("width", w).attr("height", h).style("fill-opacity", function (d) {
            return isValue(d.opacity) ? d.opacity : 0.1;
        })];
    };
    c3_chart_internal_fn.regionX = function (d) {
        var $$ = this,
            config = $$.config,
            xPos,
            yScale = d.axis === 'y' ? $$.y : $$.y2;
        if (d.axis === 'y' || d.axis === 'y2') {
            xPos = config.axis_rotated ? 'start' in d ? yScale(d.start) : 0 : 0;
        } else {
            xPos = config.axis_rotated ? 0 : 'start' in d ? $$.x($$.isTimeSeries() ? $$.parseDate(d.start) : d.start) : 0;
        }
        return xPos;
    };
    c3_chart_internal_fn.regionY = function (d) {
        var $$ = this,
            config = $$.config,
            yPos,
            yScale = d.axis === 'y' ? $$.y : $$.y2;
        if (d.axis === 'y' || d.axis === 'y2') {
            yPos = config.axis_rotated ? 0 : 'end' in d ? yScale(d.end) : 0;
        } else {
            yPos = config.axis_rotated ? 'start' in d ? $$.x($$.isTimeSeries() ? $$.parseDate(d.start) : d.start) : 0 : 0;
        }
        return yPos;
    };
    c3_chart_internal_fn.regionWidth = function (d) {
        var $$ = this,
            config = $$.config,
            start = $$.regionX(d),
            end,
            yScale = d.axis === 'y' ? $$.y : $$.y2;
        if (d.axis === 'y' || d.axis === 'y2') {
            end = config.axis_rotated ? 'end' in d ? yScale(d.end) : $$.width : $$.width;
        } else {
            end = config.axis_rotated ? $$.width : 'end' in d ? $$.x($$.isTimeSeries() ? $$.parseDate(d.end) : d.end) : $$.width;
        }
        return end < start ? 0 : end - start;
    };
    c3_chart_internal_fn.regionHeight = function (d) {
        var $$ = this,
            config = $$.config,
            start = this.regionY(d),
            end,
            yScale = d.axis === 'y' ? $$.y : $$.y2;
        if (d.axis === 'y' || d.axis === 'y2') {
            end = config.axis_rotated ? $$.height : 'start' in d ? yScale(d.start) : $$.height;
        } else {
            end = config.axis_rotated ? 'end' in d ? $$.x($$.isTimeSeries() ? $$.parseDate(d.end) : d.end) : $$.height : $$.height;
        }
        return end < start ? 0 : end - start;
    };
    c3_chart_internal_fn.isRegionOnX = function (d) {
        return !d.axis || d.axis === 'x';
    };

    c3_chart_internal_fn.drag = function (mouse) {
        var $$ = this,
            config = $$.config,
            main = $$.main,
            d3 = $$.d3;
        var sx, sy, mx, my, minX, maxX, minY, maxY;

        if ($$.hasArcType()) {
            return;
        }
        if (!config.data_selection_enabled) {
            return;
        } // do nothing if not selectable
        if (config.zoom_enabled && !$$.zoom.altDomain) {
            return;
        } // skip if zoomable because of conflict drag dehavior
        if (!config.data_selection_multiple) {
            return;
        } // skip when single selection because drag is used for multiple selection

        sx = $$.dragStart[0];
        sy = $$.dragStart[1];
        mx = mouse[0];
        my = mouse[1];
        minX = Math.min(sx, mx);
        maxX = Math.max(sx, mx);
        minY = config.data_selection_grouped ? $$.margin.top : Math.min(sy, my);
        maxY = config.data_selection_grouped ? $$.height : Math.max(sy, my);

        main.select('.' + CLASS.dragarea).attr('x', minX).attr('y', minY).attr('width', maxX - minX).attr('height', maxY - minY);
        // TODO: binary search when multiple xs
        main.selectAll('.' + CLASS.shapes).selectAll('.' + CLASS.shape).filter(function (d) {
            return config.data_selection_isselectable(d);
        }).each(function (d, i) {
            var shape = d3.select(this),
                isSelected = shape.classed(CLASS.SELECTED),
                isIncluded = shape.classed(CLASS.INCLUDED),
                _x,
                _y,
                _w,
                _h,
                toggle,
                isWithin = false,
                box;
            if (shape.classed(CLASS.circle)) {
                _x = shape.attr("cx") * 1;
                _y = shape.attr("cy") * 1;
                toggle = $$.togglePoint;
                isWithin = minX < _x && _x < maxX && minY < _y && _y < maxY;
            } else if (shape.classed(CLASS.bar)) {
                box = getPathBox(this);
                _x = box.x;
                _y = box.y;
                _w = box.width;
                _h = box.height;
                toggle = $$.togglePath;
                isWithin = !(maxX < _x || _x + _w < minX) && !(maxY < _y || _y + _h < minY);
            } else {
                // line/area selection not supported yet
                return;
            }
            if (isWithin ^ isIncluded) {
                shape.classed(CLASS.INCLUDED, !isIncluded);
                // TODO: included/unincluded callback here
                shape.classed(CLASS.SELECTED, !isSelected);
                toggle.call($$, !isSelected, shape, d, i);
            }
        });
    };

    c3_chart_internal_fn.dragstart = function (mouse) {
        var $$ = this,
            config = $$.config;
        if ($$.hasArcType()) {
            return;
        }
        if (!config.data_selection_enabled) {
            return;
        } // do nothing if not selectable
        $$.dragStart = mouse;
        $$.main.select('.' + CLASS.chart).append('rect').attr('class', CLASS.dragarea).style('opacity', 0.1);
        $$.dragging = true;
    };

    c3_chart_internal_fn.dragend = function () {
        var $$ = this,
            config = $$.config;
        if ($$.hasArcType()) {
            return;
        }
        if (!config.data_selection_enabled) {
            return;
        } // do nothing if not selectable
        $$.main.select('.' + CLASS.dragarea).transition().duration(100).style('opacity', 0).remove();
        $$.main.selectAll('.' + CLASS.shape).classed(CLASS.INCLUDED, false);
        $$.dragging = false;
    };

    c3_chart_internal_fn.selectPoint = function (target, d, i) {
        var $$ = this,
            config = $$.config,
            cx = (config.axis_rotated ? $$.circleY : $$.circleX).bind($$),
            cy = (config.axis_rotated ? $$.circleX : $$.circleY).bind($$),
            r = $$.pointSelectR.bind($$);
        config.data_onselected.call($$.api, d, target.node());
        // add selected-circle on low layer g
        $$.main.select('.' + CLASS.selectedCircles + $$.getTargetSelectorSuffix(d.id)).selectAll('.' + CLASS.selectedCircle + '-' + i).data([d]).enter().append('circle').attr("class", function () {
            return $$.generateClass(CLASS.selectedCircle, i);
        }).attr("cx", cx).attr("cy", cy).attr("stroke", function () {
            return $$.color(d);
        }).attr("r", function (d) {
            return $$.pointSelectR(d) * 1.4;
        }).transition().duration(100).attr("r", r);
    };
    c3_chart_internal_fn.unselectPoint = function (target, d, i) {
        var $$ = this;
        $$.config.data_onunselected.call($$.api, d, target.node());
        // remove selected-circle from low layer g
        $$.main.select('.' + CLASS.selectedCircles + $$.getTargetSelectorSuffix(d.id)).selectAll('.' + CLASS.selectedCircle + '-' + i).transition().duration(100).attr('r', 0).remove();
    };
    c3_chart_internal_fn.togglePoint = function (selected, target, d, i) {
        selected ? this.selectPoint(target, d, i) : this.unselectPoint(target, d, i);
    };
    c3_chart_internal_fn.selectPath = function (target, d) {
        var $$ = this;
        $$.config.data_onselected.call($$, d, target.node());
        if ($$.config.interaction_brighten) {
            target.transition().duration(100).style("fill", function () {
                return $$.d3.rgb($$.color(d)).brighter(0.75);
            });
        }
    };
    c3_chart_internal_fn.unselectPath = function (target, d) {
        var $$ = this;
        $$.config.data_onunselected.call($$, d, target.node());
        if ($$.config.interaction_brighten) {
            target.transition().duration(100).style("fill", function () {
                return $$.color(d);
            });
        }
    };
    c3_chart_internal_fn.togglePath = function (selected, target, d, i) {
        selected ? this.selectPath(target, d, i) : this.unselectPath(target, d, i);
    };
    c3_chart_internal_fn.getToggle = function (that, d) {
        var $$ = this,
            toggle;
        if (that.nodeName === 'circle') {
            if ($$.isStepType(d)) {
                // circle is hidden in step chart, so treat as within the click area
                toggle = function toggle() {}; // TODO: how to select step chart?
            } else {
                toggle = $$.togglePoint;
            }
        } else if (that.nodeName === 'path') {
            toggle = $$.togglePath;
        }
        return toggle;
    };
    c3_chart_internal_fn.toggleShape = function (that, d, i) {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config,
            shape = d3.select(that),
            isSelected = shape.classed(CLASS.SELECTED),
            toggle = $$.getToggle(that, d).bind($$);

        if (config.data_selection_enabled && config.data_selection_isselectable(d)) {
            if (!config.data_selection_multiple) {
                $$.main.selectAll('.' + CLASS.shapes + (config.data_selection_grouped ? $$.getTargetSelectorSuffix(d.id) : "")).selectAll('.' + CLASS.shape).each(function (d, i) {
                    var shape = d3.select(this);
                    if (shape.classed(CLASS.SELECTED)) {
                        toggle(false, shape.classed(CLASS.SELECTED, false), d, i);
                    }
                });
            }
            shape.classed(CLASS.SELECTED, !isSelected);
            toggle(!isSelected, shape, d, i);
        }
    };

    c3_chart_internal_fn.initBrush = function () {
        var $$ = this,
            d3 = $$.d3;
        $$.brush = d3.svg.brush().on("brush", function () {
            $$.redrawForBrush();
        });
        $$.brush.update = function () {
            if ($$.context) {
                $$.context.select('.' + CLASS.brush).call(this);
            }
            return this;
        };
        $$.brush.scale = function (scale) {
            return $$.config.axis_rotated ? this.y(scale) : this.x(scale);
        };
    };
    c3_chart_internal_fn.initSubchart = function () {
        var $$ = this,
            config = $$.config,
            context = $$.context = $$.svg.append("g").attr("transform", $$.getTranslate('context')),
            visibility = config.subchart_show ? 'visible' : 'hidden';

        context.style('visibility', visibility);

        // Define g for chart area
        context.append('g').attr("clip-path", $$.clipPathForSubchart).attr('class', CLASS.chart);

        // Define g for bar chart area
        context.select('.' + CLASS.chart).append("g").attr("class", CLASS.chartBars);

        // Define g for line chart area
        context.select('.' + CLASS.chart).append("g").attr("class", CLASS.chartLines);

        // Add extent rect for Brush
        context.append("g").attr("clip-path", $$.clipPath).attr("class", CLASS.brush).call($$.brush);

        // ATTENTION: This must be called AFTER chart added
        // Add Axis
        $$.axes.subx = context.append("g").attr("class", CLASS.axisX).attr("transform", $$.getTranslate('subx')).attr("clip-path", config.axis_rotated ? "" : $$.clipPathForXAxis).style("visibility", config.subchart_axis_x_show ? visibility : 'hidden');
    };
    c3_chart_internal_fn.updateTargetsForSubchart = function (targets) {
        var $$ = this,
            context = $$.context,
            config = $$.config,
            contextLineEnter,
            contextLineUpdate,
            contextBarEnter,
            contextBarUpdate,
            classChartBar = $$.classChartBar.bind($$),
            classBars = $$.classBars.bind($$),
            classChartLine = $$.classChartLine.bind($$),
            classLines = $$.classLines.bind($$),
            classAreas = $$.classAreas.bind($$);

        if (config.subchart_show) {
            //-- Bar --//
            contextBarUpdate = context.select('.' + CLASS.chartBars).selectAll('.' + CLASS.chartBar).data(targets).attr('class', classChartBar);
            contextBarEnter = contextBarUpdate.enter().append('g').style('opacity', 0).attr('class', classChartBar);
            // Bars for each data
            contextBarEnter.append('g').attr("class", classBars);

            //-- Line --//
            contextLineUpdate = context.select('.' + CLASS.chartLines).selectAll('.' + CLASS.chartLine).data(targets).attr('class', classChartLine);
            contextLineEnter = contextLineUpdate.enter().append('g').style('opacity', 0).attr('class', classChartLine);
            // Lines for each data
            contextLineEnter.append("g").attr("class", classLines);
            // Area
            contextLineEnter.append("g").attr("class", classAreas);

            //-- Brush --//
            context.selectAll('.' + CLASS.brush + ' rect').attr(config.axis_rotated ? "width" : "height", config.axis_rotated ? $$.width2 : $$.height2);
        }
    };
    c3_chart_internal_fn.updateBarForSubchart = function (durationForExit) {
        var $$ = this;
        $$.contextBar = $$.context.selectAll('.' + CLASS.bars).selectAll('.' + CLASS.bar).data($$.barData.bind($$));
        $$.contextBar.enter().append('path').attr("class", $$.classBar.bind($$)).style("stroke", 'none').style("fill", $$.color);
        $$.contextBar.style("opacity", $$.initialOpacity.bind($$));
        $$.contextBar.exit().transition().duration(durationForExit).style('opacity', 0).remove();
    };
    c3_chart_internal_fn.redrawBarForSubchart = function (drawBarOnSub, withTransition, duration) {
        (withTransition ? this.contextBar.transition(Math.random().toString()).duration(duration) : this.contextBar).attr('d', drawBarOnSub).style('opacity', 1);
    };
    c3_chart_internal_fn.updateLineForSubchart = function (durationForExit) {
        var $$ = this;
        $$.contextLine = $$.context.selectAll('.' + CLASS.lines).selectAll('.' + CLASS.line).data($$.lineData.bind($$));
        $$.contextLine.enter().append('path').attr('class', $$.classLine.bind($$)).style('stroke', $$.color);
        $$.contextLine.style("opacity", $$.initialOpacity.bind($$));
        $$.contextLine.exit().transition().duration(durationForExit).style('opacity', 0).remove();
    };
    c3_chart_internal_fn.redrawLineForSubchart = function (drawLineOnSub, withTransition, duration) {
        (withTransition ? this.contextLine.transition(Math.random().toString()).duration(duration) : this.contextLine).attr("d", drawLineOnSub).style('opacity', 1);
    };
    c3_chart_internal_fn.updateAreaForSubchart = function (durationForExit) {
        var $$ = this,
            d3 = $$.d3;
        $$.contextArea = $$.context.selectAll('.' + CLASS.areas).selectAll('.' + CLASS.area).data($$.lineData.bind($$));
        $$.contextArea.enter().append('path').attr("class", $$.classArea.bind($$)).style("fill", $$.color).style("opacity", function () {
            $$.orgAreaOpacity = +d3.select(this).style('opacity');return 0;
        });
        $$.contextArea.style("opacity", 0);
        $$.contextArea.exit().transition().duration(durationForExit).style('opacity', 0).remove();
    };
    c3_chart_internal_fn.redrawAreaForSubchart = function (drawAreaOnSub, withTransition, duration) {
        (withTransition ? this.contextArea.transition(Math.random().toString()).duration(duration) : this.contextArea).attr("d", drawAreaOnSub).style("fill", this.color).style("opacity", this.orgAreaOpacity);
    };
    c3_chart_internal_fn.redrawSubchart = function (withSubchart, transitions, duration, durationForExit, areaIndices, barIndices, lineIndices) {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config,
            drawAreaOnSub,
            drawBarOnSub,
            drawLineOnSub;

        $$.context.style('visibility', config.subchart_show ? 'visible' : 'hidden');

        // subchart
        if (config.subchart_show) {
            // reflect main chart to extent on subchart if zoomed
            if (d3.event && d3.event.type === 'zoom') {
                $$.brush.extent($$.x.orgDomain()).update();
            }
            // update subchart elements if needed
            if (withSubchart) {

                // extent rect
                if (!$$.brush.empty()) {
                    $$.brush.extent($$.x.orgDomain()).update();
                }
                // setup drawer - MEMO: this must be called after axis updated
                drawAreaOnSub = $$.generateDrawArea(areaIndices, true);
                drawBarOnSub = $$.generateDrawBar(barIndices, true);
                drawLineOnSub = $$.generateDrawLine(lineIndices, true);

                $$.updateBarForSubchart(duration);
                $$.updateLineForSubchart(duration);
                $$.updateAreaForSubchart(duration);

                $$.redrawBarForSubchart(drawBarOnSub, duration, duration);
                $$.redrawLineForSubchart(drawLineOnSub, duration, duration);
                $$.redrawAreaForSubchart(drawAreaOnSub, duration, duration);
            }
        }
    };
    c3_chart_internal_fn.redrawForBrush = function () {
        var $$ = this,
            x = $$.x;
        $$.redraw({
            withTransition: false,
            withY: $$.config.zoom_rescale,
            withSubchart: false,
            withUpdateXDomain: true,
            withDimension: false
        });
        $$.config.subchart_onbrush.call($$.api, x.orgDomain());
    };
    c3_chart_internal_fn.transformContext = function (withTransition, transitions) {
        var $$ = this,
            subXAxis;
        if (transitions && transitions.axisSubX) {
            subXAxis = transitions.axisSubX;
        } else {
            subXAxis = $$.context.select('.' + CLASS.axisX);
            if (withTransition) {
                subXAxis = subXAxis.transition();
            }
        }
        $$.context.attr("transform", $$.getTranslate('context'));
        subXAxis.attr("transform", $$.getTranslate('subx'));
    };
    c3_chart_internal_fn.getDefaultExtent = function () {
        var $$ = this,
            config = $$.config,
            extent = isFunction(config.axis_x_extent) ? config.axis_x_extent($$.getXDomain($$.data.targets)) : config.axis_x_extent;
        if ($$.isTimeSeries()) {
            extent = [$$.parseDate(extent[0]), $$.parseDate(extent[1])];
        }
        return extent;
    };

    c3_chart_internal_fn.initZoom = function () {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config,
            startEvent;

        $$.zoom = d3.behavior.zoom().on("zoomstart", function () {
            startEvent = d3.event.sourceEvent;
            $$.zoom.altDomain = d3.event.sourceEvent.altKey ? $$.x.orgDomain() : null;
            config.zoom_onzoomstart.call($$.api, d3.event.sourceEvent);
        }).on("zoom", function () {
            $$.redrawForZoom.call($$);
        }).on('zoomend', function () {
            var event = d3.event.sourceEvent;
            // if click, do nothing. otherwise, click interaction will be canceled.
            if (event && startEvent.clientX === event.clientX && startEvent.clientY === event.clientY) {
                return;
            }
            $$.redrawEventRect();
            $$.updateZoom();
            config.zoom_onzoomend.call($$.api, $$.x.orgDomain());
        });
        $$.zoom.scale = function (scale) {
            return config.axis_rotated ? this.y(scale) : this.x(scale);
        };
        $$.zoom.orgScaleExtent = function () {
            var extent = config.zoom_extent ? config.zoom_extent : [1, 10];
            return [extent[0], Math.max($$.getMaxDataCount() / extent[1], extent[1])];
        };
        $$.zoom.updateScaleExtent = function () {
            var ratio = diffDomain($$.x.orgDomain()) / diffDomain($$.getZoomDomain()),
                extent = this.orgScaleExtent();
            this.scaleExtent([extent[0] * ratio, extent[1] * ratio]);
            return this;
        };
    };
    c3_chart_internal_fn.getZoomDomain = function () {
        var $$ = this,
            config = $$.config,
            d3 = $$.d3,
            min = d3.min([$$.orgXDomain[0], config.zoom_x_min]),
            max = d3.max([$$.orgXDomain[1], config.zoom_x_max]);
        return [min, max];
    };
    c3_chart_internal_fn.updateZoom = function () {
        var $$ = this,
            z = $$.config.zoom_enabled ? $$.zoom : function () {};
        $$.main.select('.' + CLASS.zoomRect).call(z).on("dblclick.zoom", null);
        $$.main.selectAll('.' + CLASS.eventRect).call(z).on("dblclick.zoom", null);
    };
    c3_chart_internal_fn.redrawForZoom = function () {
        var $$ = this,
            d3 = $$.d3,
            config = $$.config,
            zoom = $$.zoom,
            x = $$.x;
        if (!config.zoom_enabled) {
            return;
        }
        if ($$.filterTargetsToShow($$.data.targets).length === 0) {
            return;
        }
        if (d3.event.sourceEvent.type === 'mousemove' && zoom.altDomain) {
            x.domain(zoom.altDomain);
            zoom.scale(x).updateScaleExtent();
            return;
        }
        if ($$.isCategorized() && x.orgDomain()[0] === $$.orgXDomain[0]) {
            x.domain([$$.orgXDomain[0] - 1e-10, x.orgDomain()[1]]);
        }
        $$.redraw({
            withTransition: false,
            withY: config.zoom_rescale,
            withSubchart: false,
            withEventRect: false,
            withDimension: false
        });
        if (d3.event.sourceEvent.type === 'mousemove') {
            $$.cancelClick = true;
        }
        config.zoom_onzoom.call($$.api, x.orgDomain());
    };

    c3_chart_internal_fn.generateColor = function () {
        var $$ = this,
            config = $$.config,
            d3 = $$.d3,
            colors = config.data_colors,
            pattern = notEmpty(config.color_pattern) ? config.color_pattern : d3.scale.category10().range(),
            callback = config.data_color,
            ids = [];

        return function (d) {
            var id = d.id || d.data && d.data.id || d,
                color;

            // if callback function is provided
            if (colors[id] instanceof Function) {
                color = colors[id](d);
            }
            // if specified, choose that color
            else if (colors[id]) {
                    color = colors[id];
                }
                // if not specified, choose from pattern
                else {
                        if (ids.indexOf(id) < 0) {
                            ids.push(id);
                        }
                        color = pattern[ids.indexOf(id) % pattern.length];
                        colors[id] = color;
                    }
            return callback instanceof Function ? callback(color, d) : color;
        };
    };
    c3_chart_internal_fn.generateLevelColor = function () {
        var $$ = this,
            config = $$.config,
            colors = config.color_pattern,
            threshold = config.color_threshold,
            asValue = threshold.unit === 'value',
            values = threshold.values && threshold.values.length ? threshold.values : [],
            max = threshold.max || 100;
        return notEmpty(config.color_threshold) ? function (value) {
            var i,
                v,
                color = colors[colors.length - 1];
            for (i = 0; i < values.length; i++) {
                v = asValue ? value : value * 100 / max;
                if (v < values[i]) {
                    color = colors[i];
                    break;
                }
            }
            return color;
        } : null;
    };

    c3_chart_internal_fn.getYFormat = function (forArc) {
        var $$ = this,
            formatForY = forArc && !$$.hasType('gauge') ? $$.defaultArcValueFormat : $$.yFormat,
            formatForY2 = forArc && !$$.hasType('gauge') ? $$.defaultArcValueFormat : $$.y2Format;
        return function (v, ratio, id) {
            var format = $$.axis.getId(id) === 'y2' ? formatForY2 : formatForY;
            return format.call($$, v, ratio);
        };
    };
    c3_chart_internal_fn.yFormat = function (v) {
        var $$ = this,
            config = $$.config,
            format = config.axis_y_tick_format ? config.axis_y_tick_format : $$.defaultValueFormat;
        return format(v);
    };
    c3_chart_internal_fn.y2Format = function (v) {
        var $$ = this,
            config = $$.config,
            format = config.axis_y2_tick_format ? config.axis_y2_tick_format : $$.defaultValueFormat;
        return format(v);
    };
    c3_chart_internal_fn.defaultValueFormat = function (v) {
        return isValue(v) ? +v : "";
    };
    c3_chart_internal_fn.defaultArcValueFormat = function (v, ratio) {
        return (ratio * 100).toFixed(1) + '%';
    };
    c3_chart_internal_fn.dataLabelFormat = function (targetId) {
        var $$ = this,
            data_labels = $$.config.data_labels,
            format,
            defaultFormat = function defaultFormat(v) {
            return isValue(v) ? +v : "";
        };
        // find format according to axis id
        if (typeof data_labels.format === 'function') {
            format = data_labels.format;
        } else if (_typeof(data_labels.format) === 'object') {
            if (data_labels.format[targetId]) {
                format = data_labels.format[targetId] === true ? defaultFormat : data_labels.format[targetId];
            } else {
                format = function format() {
                    return '';
                };
            }
        } else {
            format = defaultFormat;
        }
        return format;
    };

    c3_chart_internal_fn.hasCaches = function (ids) {
        for (var i = 0; i < ids.length; i++) {
            if (!(ids[i] in this.cache)) {
                return false;
            }
        }
        return true;
    };
    c3_chart_internal_fn.addCache = function (id, target) {
        this.cache[id] = this.cloneTarget(target);
    };
    c3_chart_internal_fn.getCaches = function (ids) {
        var targets = [],
            i;
        for (i = 0; i < ids.length; i++) {
            if (ids[i] in this.cache) {
                targets.push(this.cloneTarget(this.cache[ids[i]]));
            }
        }
        return targets;
    };

    var CLASS = c3_chart_internal_fn.CLASS = {
        target: 'c3-target',
        chart: 'c3-chart',
        chartLine: 'c3-chart-line',
        chartLines: 'c3-chart-lines',
        chartBar: 'c3-chart-bar',
        chartBars: 'c3-chart-bars',
        chartText: 'c3-chart-text',
        chartTexts: 'c3-chart-texts',
        chartArc: 'c3-chart-arc',
        chartArcs: 'c3-chart-arcs',
        chartArcsTitle: 'c3-chart-arcs-title',
        chartArcsBackground: 'c3-chart-arcs-background',
        chartArcsGaugeUnit: 'c3-chart-arcs-gauge-unit',
        chartArcsGaugeMax: 'c3-chart-arcs-gauge-max',
        chartArcsGaugeMin: 'c3-chart-arcs-gauge-min',
        selectedCircle: 'c3-selected-circle',
        selectedCircles: 'c3-selected-circles',
        eventRect: 'c3-event-rect',
        eventRects: 'c3-event-rects',
        eventRectsSingle: 'c3-event-rects-single',
        eventRectsMultiple: 'c3-event-rects-multiple',
        zoomRect: 'c3-zoom-rect',
        brush: 'c3-brush',
        focused: 'c3-focused',
        defocused: 'c3-defocused',
        region: 'c3-region',
        regions: 'c3-regions',
        title: 'c3-title',
        tooltipContainer: 'c3-tooltip-container',
        tooltip: 'c3-tooltip',
        tooltipName: 'c3-tooltip-name',
        shape: 'c3-shape',
        shapes: 'c3-shapes',
        line: 'c3-line',
        lines: 'c3-lines',
        bar: 'c3-bar',
        bars: 'c3-bars',
        circle: 'c3-circle',
        circles: 'c3-circles',
        arc: 'c3-arc',
        arcs: 'c3-arcs',
        area: 'c3-area',
        areas: 'c3-areas',
        empty: 'c3-empty',
        text: 'c3-text',
        texts: 'c3-texts',
        gaugeValue: 'c3-gauge-value',
        grid: 'c3-grid',
        gridLines: 'c3-grid-lines',
        xgrid: 'c3-xgrid',
        xgrids: 'c3-xgrids',
        xgridLine: 'c3-xgrid-line',
        xgridLines: 'c3-xgrid-lines',
        xgridFocus: 'c3-xgrid-focus',
        ygrid: 'c3-ygrid',
        ygrids: 'c3-ygrids',
        ygridLine: 'c3-ygrid-line',
        ygridLines: 'c3-ygrid-lines',
        axis: 'c3-axis',
        axisX: 'c3-axis-x',
        axisXLabel: 'c3-axis-x-label',
        axisY: 'c3-axis-y',
        axisYLabel: 'c3-axis-y-label',
        axisY2: 'c3-axis-y2',
        axisY2Label: 'c3-axis-y2-label',
        legendBackground: 'c3-legend-background',
        legendItem: 'c3-legend-item',
        legendItemEvent: 'c3-legend-item-event',
        legendItemTile: 'c3-legend-item-tile',
        legendItemHidden: 'c3-legend-item-hidden',
        legendItemFocused: 'c3-legend-item-focused',
        dragarea: 'c3-dragarea',
        EXPANDED: '_expanded_',
        SELECTED: '_selected_',
        INCLUDED: '_included_'
    };
    c3_chart_internal_fn.generateClass = function (prefix, targetId) {
        return " " + prefix + " " + prefix + this.getTargetSelectorSuffix(targetId);
    };
    c3_chart_internal_fn.classText = function (d) {
        return this.generateClass(CLASS.text, d.index);
    };
    c3_chart_internal_fn.classTexts = function (d) {
        return this.generateClass(CLASS.texts, d.id);
    };
    c3_chart_internal_fn.classShape = function (d) {
        return this.generateClass(CLASS.shape, d.index);
    };
    c3_chart_internal_fn.classShapes = function (d) {
        return this.generateClass(CLASS.shapes, d.id);
    };
    c3_chart_internal_fn.classLine = function (d) {
        return this.classShape(d) + this.generateClass(CLASS.line, d.id);
    };
    c3_chart_internal_fn.classLines = function (d) {
        return this.classShapes(d) + this.generateClass(CLASS.lines, d.id);
    };
    c3_chart_internal_fn.classCircle = function (d) {
        return this.classShape(d) + this.generateClass(CLASS.circle, d.index);
    };
    c3_chart_internal_fn.classCircles = function (d) {
        return this.classShapes(d) + this.generateClass(CLASS.circles, d.id);
    };
    c3_chart_internal_fn.classBar = function (d) {
        return this.classShape(d) + this.generateClass(CLASS.bar, d.index);
    };
    c3_chart_internal_fn.classBars = function (d) {
        return this.classShapes(d) + this.generateClass(CLASS.bars, d.id);
    };
    c3_chart_internal_fn.classArc = function (d) {
        return this.classShape(d.data) + this.generateClass(CLASS.arc, d.data.id);
    };
    c3_chart_internal_fn.classArcs = function (d) {
        return this.classShapes(d.data) + this.generateClass(CLASS.arcs, d.data.id);
    };
    c3_chart_internal_fn.classArea = function (d) {
        return this.classShape(d) + this.generateClass(CLASS.area, d.id);
    };
    c3_chart_internal_fn.classAreas = function (d) {
        return this.classShapes(d) + this.generateClass(CLASS.areas, d.id);
    };
    c3_chart_internal_fn.classRegion = function (d, i) {
        return this.generateClass(CLASS.region, i) + ' ' + ('class' in d ? d['class'] : '');
    };
    c3_chart_internal_fn.classEvent = function (d) {
        return this.generateClass(CLASS.eventRect, d.index);
    };
    c3_chart_internal_fn.classTarget = function (id) {
        var $$ = this;
        var additionalClassSuffix = $$.config.data_classes[id],
            additionalClass = '';
        if (additionalClassSuffix) {
            additionalClass = ' ' + CLASS.target + '-' + additionalClassSuffix;
        }
        return $$.generateClass(CLASS.target, id) + additionalClass;
    };
    c3_chart_internal_fn.classFocus = function (d) {
        return this.classFocused(d) + this.classDefocused(d);
    };
    c3_chart_internal_fn.classFocused = function (d) {
        return ' ' + (this.focusedTargetIds.indexOf(d.id) >= 0 ? CLASS.focused : '');
    };
    c3_chart_internal_fn.classDefocused = function (d) {
        return ' ' + (this.defocusedTargetIds.indexOf(d.id) >= 0 ? CLASS.defocused : '');
    };
    c3_chart_internal_fn.classChartText = function (d) {
        return CLASS.chartText + this.classTarget(d.id);
    };
    c3_chart_internal_fn.classChartLine = function (d) {
        return CLASS.chartLine + this.classTarget(d.id);
    };
    c3_chart_internal_fn.classChartBar = function (d) {
        return CLASS.chartBar + this.classTarget(d.id);
    };
    c3_chart_internal_fn.classChartArc = function (d) {
        return CLASS.chartArc + this.classTarget(d.data.id);
    };
    c3_chart_internal_fn.getTargetSelectorSuffix = function (targetId) {
        return targetId || targetId === 0 ? ('-' + targetId).replace(/[\s?!@#$%^&*()_=+,.<>'":;\[\]\/|~`{}\\]/g, '-') : '';
    };
    c3_chart_internal_fn.selectorTarget = function (id, prefix) {
        return (prefix || '') + '.' + CLASS.target + this.getTargetSelectorSuffix(id);
    };
    c3_chart_internal_fn.selectorTargets = function (ids, prefix) {
        var $$ = this;
        ids = ids || [];
        return ids.length ? ids.map(function (id) {
            return $$.selectorTarget(id, prefix);
        }) : null;
    };
    c3_chart_internal_fn.selectorLegend = function (id) {
        return '.' + CLASS.legendItem + this.getTargetSelectorSuffix(id);
    };
    c3_chart_internal_fn.selectorLegends = function (ids) {
        var $$ = this;
        return ids && ids.length ? ids.map(function (id) {
            return $$.selectorLegend(id);
        }) : null;
    };

    var isValue = c3_chart_internal_fn.isValue = function (v) {
        return v || v === 0;
    },
        isFunction = c3_chart_internal_fn.isFunction = function (o) {
        return typeof o === 'function';
    },
        isString = c3_chart_internal_fn.isString = function (o) {
        return typeof o === 'string';
    },
        isUndefined = c3_chart_internal_fn.isUndefined = function (v) {
        return typeof v === 'undefined';
    },
        isDefined = c3_chart_internal_fn.isDefined = function (v) {
        return typeof v !== 'undefined';
    },
        ceil10 = c3_chart_internal_fn.ceil10 = function (v) {
        return Math.ceil(v / 10) * 10;
    },
        asHalfPixel = c3_chart_internal_fn.asHalfPixel = function (n) {
        return Math.ceil(n) + 0.5;
    },
        diffDomain = c3_chart_internal_fn.diffDomain = function (d) {
        return d[1] - d[0];
    },
        isEmpty = c3_chart_internal_fn.isEmpty = function (o) {
        return typeof o === 'undefined' || o === null || isString(o) && o.length === 0 || (typeof o === 'undefined' ? 'undefined' : _typeof(o)) === 'object' && Object.keys(o).length === 0;
    },
        notEmpty = c3_chart_internal_fn.notEmpty = function (o) {
        return !c3_chart_internal_fn.isEmpty(o);
    },
        getOption = c3_chart_internal_fn.getOption = function (options, key, defaultValue) {
        return isDefined(options[key]) ? options[key] : defaultValue;
    },
        hasValue = c3_chart_internal_fn.hasValue = function (dict, value) {
        var found = false;
        Object.keys(dict).forEach(function (key) {
            if (dict[key] === value) {
                found = true;
            }
        });
        return found;
    },
        sanitise = c3_chart_internal_fn.sanitise = function (str) {
        return typeof str === 'string' ? str.replace(/</g, '&lt;').replace(/>/g, '&gt;') : str;
    },
        getPathBox = c3_chart_internal_fn.getPathBox = function (path) {
        var box = path.getBoundingClientRect(),
            items = [path.pathSegList.getItem(0), path.pathSegList.getItem(1)],
            minX = items[0].x,
            minY = Math.min(items[0].y, items[1].y);
        return { x: minX, y: minY, width: box.width, height: box.height };
    };

    c3_chart_fn.focus = function (targetIds) {
        var $$ = this.internal,
            candidates;

        targetIds = $$.mapToTargetIds(targetIds);
        candidates = $$.svg.selectAll($$.selectorTargets(targetIds.filter($$.isTargetToShow, $$))), this.revert();
        this.defocus();
        candidates.classed(CLASS.focused, true).classed(CLASS.defocused, false);
        if ($$.hasArcType()) {
            $$.expandArc(targetIds);
        }
        $$.toggleFocusLegend(targetIds, true);

        $$.focusedTargetIds = targetIds;
        $$.defocusedTargetIds = $$.defocusedTargetIds.filter(function (id) {
            return targetIds.indexOf(id) < 0;
        });
    };

    c3_chart_fn.defocus = function (targetIds) {
        var $$ = this.internal,
            candidates;

        targetIds = $$.mapToTargetIds(targetIds);
        candidates = $$.svg.selectAll($$.selectorTargets(targetIds.filter($$.isTargetToShow, $$))), candidates.classed(CLASS.focused, false).classed(CLASS.defocused, true);
        if ($$.hasArcType()) {
            $$.unexpandArc(targetIds);
        }
        $$.toggleFocusLegend(targetIds, false);

        $$.focusedTargetIds = $$.focusedTargetIds.filter(function (id) {
            return targetIds.indexOf(id) < 0;
        });
        $$.defocusedTargetIds = targetIds;
    };

    c3_chart_fn.revert = function (targetIds) {
        var $$ = this.internal,
            candidates;

        targetIds = $$.mapToTargetIds(targetIds);
        candidates = $$.svg.selectAll($$.selectorTargets(targetIds)); // should be for all targets

        candidates.classed(CLASS.focused, false).classed(CLASS.defocused, false);
        if ($$.hasArcType()) {
            $$.unexpandArc(targetIds);
        }
        if ($$.config.legend_show) {
            $$.showLegend(targetIds.filter($$.isLegendToShow.bind($$)));
            $$.legend.selectAll($$.selectorLegends(targetIds)).filter(function () {
                return $$.d3.select(this).classed(CLASS.legendItemFocused);
            }).classed(CLASS.legendItemFocused, false);
        }

        $$.focusedTargetIds = [];
        $$.defocusedTargetIds = [];
    };

    c3_chart_fn.show = function (targetIds, options) {
        var $$ = this.internal,
            targets;

        targetIds = $$.mapToTargetIds(targetIds);
        options = options || {};

        $$.removeHiddenTargetIds(targetIds);
        targets = $$.svg.selectAll($$.selectorTargets(targetIds));

        targets.transition().style('opacity', 1, 'important').call($$.endall, function () {
            targets.style('opacity', null).style('opacity', 1);
        });

        if (options.withLegend) {
            $$.showLegend(targetIds);
        }

        $$.redraw({ withUpdateOrgXDomain: true, withUpdateXDomain: true, withLegend: true });
    };

    c3_chart_fn.hide = function (targetIds, options) {
        var $$ = this.internal,
            targets;

        targetIds = $$.mapToTargetIds(targetIds);
        options = options || {};

        $$.addHiddenTargetIds(targetIds);
        targets = $$.svg.selectAll($$.selectorTargets(targetIds));

        targets.transition().style('opacity', 0, 'important').call($$.endall, function () {
            targets.style('opacity', null).style('opacity', 0);
        });

        if (options.withLegend) {
            $$.hideLegend(targetIds);
        }

        $$.redraw({ withUpdateOrgXDomain: true, withUpdateXDomain: true, withLegend: true });
    };

    c3_chart_fn.toggle = function (targetIds, options) {
        var that = this,
            $$ = this.internal;
        $$.mapToTargetIds(targetIds).forEach(function (targetId) {
            $$.isTargetToShow(targetId) ? that.hide(targetId, options) : that.show(targetId, options);
        });
    };

    c3_chart_fn.zoom = function (domain) {
        var $$ = this.internal;
        if (domain) {
            if ($$.isTimeSeries()) {
                domain = domain.map(function (x) {
                    return $$.parseDate(x);
                });
            }
            $$.brush.extent(domain);
            $$.redraw({ withUpdateXDomain: true, withY: $$.config.zoom_rescale });
            $$.config.zoom_onzoom.call(this, $$.x.orgDomain());
        }
        return $$.brush.extent();
    };
    c3_chart_fn.zoom.enable = function (enabled) {
        var $$ = this.internal;
        $$.config.zoom_enabled = enabled;
        $$.updateAndRedraw();
    };
    c3_chart_fn.unzoom = function () {
        var $$ = this.internal;
        $$.brush.clear().update();
        $$.redraw({ withUpdateXDomain: true });
    };

    c3_chart_fn.zoom.max = function (max) {
        var $$ = this.internal,
            config = $$.config,
            d3 = $$.d3;
        if (max === 0 || max) {
            config.zoom_x_max = d3.max([$$.orgXDomain[1], max]);
        } else {
            return config.zoom_x_max;
        }
    };

    c3_chart_fn.zoom.min = function (min) {
        var $$ = this.internal,
            config = $$.config,
            d3 = $$.d3;
        if (min === 0 || min) {
            config.zoom_x_min = d3.min([$$.orgXDomain[0], min]);
        } else {
            return config.zoom_x_min;
        }
    };

    c3_chart_fn.zoom.range = function (range) {
        if (arguments.length) {
            if (isDefined(range.max)) {
                this.domain.max(range.max);
            }
            if (isDefined(range.min)) {
                this.domain.min(range.min);
            }
        } else {
            return {
                max: this.domain.max(),
                min: this.domain.min()
            };
        }
    };

    c3_chart_fn.load = function (args) {
        var $$ = this.internal,
            config = $$.config;
        // update xs if specified
        if (args.xs) {
            $$.addXs(args.xs);
        }
        // update names if exists
        if ('names' in args) {
            c3_chart_fn.data.names.bind(this)(args.names);
        }
        // update classes if exists
        if ('classes' in args) {
            Object.keys(args.classes).forEach(function (id) {
                config.data_classes[id] = args.classes[id];
            });
        }
        // update categories if exists
        if ('categories' in args && $$.isCategorized()) {
            config.axis_x_categories = args.categories;
        }
        // update axes if exists
        if ('axes' in args) {
            Object.keys(args.axes).forEach(function (id) {
                config.data_axes[id] = args.axes[id];
            });
        }
        // update colors if exists
        if ('colors' in args) {
            Object.keys(args.colors).forEach(function (id) {
                config.data_colors[id] = args.colors[id];
            });
        }
        // use cache if exists
        if ('cacheIds' in args && $$.hasCaches(args.cacheIds)) {
            $$.load($$.getCaches(args.cacheIds), args.done);
            return;
        }
        // unload if needed
        if ('unload' in args) {
            // TODO: do not unload if target will load (included in url/rows/columns)
            $$.unload($$.mapToTargetIds(typeof args.unload === 'boolean' && args.unload ? null : args.unload), function () {
                $$.loadFromArgs(args);
            });
        } else {
            $$.loadFromArgs(args);
        }
    };

    c3_chart_fn.unload = function (args) {
        var $$ = this.internal;
        args = args || {};
        if (args instanceof Array) {
            args = { ids: args };
        } else if (typeof args === 'string') {
            args = { ids: [args] };
        }
        $$.unload($$.mapToTargetIds(args.ids), function () {
            $$.redraw({ withUpdateOrgXDomain: true, withUpdateXDomain: true, withLegend: true });
            if (args.done) {
                args.done();
            }
        });
    };

    c3_chart_fn.flow = function (args) {
        var $$ = this.internal,
            targets,
            data,
            notfoundIds = [],
            orgDataCount = $$.getMaxDataCount(),
            dataCount,
            domain,
            baseTarget,
            baseValue,
            length = 0,
            tail = 0,
            diff,
            to;

        if (args.json) {
            data = $$.convertJsonToData(args.json, args.keys);
        } else if (args.rows) {
            data = $$.convertRowsToData(args.rows);
        } else if (args.columns) {
            data = $$.convertColumnsToData(args.columns);
        } else {
            return;
        }
        targets = $$.convertDataToTargets(data, true);

        // Update/Add data
        $$.data.targets.forEach(function (t) {
            var found = false,
                i,
                j;
            for (i = 0; i < targets.length; i++) {
                if (t.id === targets[i].id) {
                    found = true;

                    if (t.values[t.values.length - 1]) {
                        tail = t.values[t.values.length - 1].index + 1;
                    }
                    length = targets[i].values.length;

                    for (j = 0; j < length; j++) {
                        targets[i].values[j].index = tail + j;
                        if (!$$.isTimeSeries()) {
                            targets[i].values[j].x = tail + j;
                        }
                    }
                    t.values = t.values.concat(targets[i].values);

                    targets.splice(i, 1);
                    break;
                }
            }
            if (!found) {
                notfoundIds.push(t.id);
            }
        });

        // Append null for not found targets
        $$.data.targets.forEach(function (t) {
            var i, j;
            for (i = 0; i < notfoundIds.length; i++) {
                if (t.id === notfoundIds[i]) {
                    tail = t.values[t.values.length - 1].index + 1;
                    for (j = 0; j < length; j++) {
                        t.values.push({
                            id: t.id,
                            index: tail + j,
                            x: $$.isTimeSeries() ? $$.getOtherTargetX(tail + j) : tail + j,
                            value: null
                        });
                    }
                }
            }
        });

        // Generate null values for new target
        if ($$.data.targets.length) {
            targets.forEach(function (t) {
                var i,
                    missing = [];
                for (i = $$.data.targets[0].values[0].index; i < tail; i++) {
                    missing.push({
                        id: t.id,
                        index: i,
                        x: $$.isTimeSeries() ? $$.getOtherTargetX(i) : i,
                        value: null
                    });
                }
                t.values.forEach(function (v) {
                    v.index += tail;
                    if (!$$.isTimeSeries()) {
                        v.x += tail;
                    }
                });
                t.values = missing.concat(t.values);
            });
        }
        $$.data.targets = $$.data.targets.concat(targets); // add remained

        // check data count because behavior needs to change when it's only one
        dataCount = $$.getMaxDataCount();
        baseTarget = $$.data.targets[0];
        baseValue = baseTarget.values[0];

        // Update length to flow if needed
        if (isDefined(args.to)) {
            length = 0;
            to = $$.isTimeSeries() ? $$.parseDate(args.to) : args.to;
            baseTarget.values.forEach(function (v) {
                if (v.x < to) {
                    length++;
                }
            });
        } else if (isDefined(args.length)) {
            length = args.length;
        }

        // If only one data, update the domain to flow from left edge of the chart
        if (!orgDataCount) {
            if ($$.isTimeSeries()) {
                if (baseTarget.values.length > 1) {
                    diff = baseTarget.values[baseTarget.values.length - 1].x - baseValue.x;
                } else {
                    diff = baseValue.x - $$.getXDomain($$.data.targets)[0];
                }
            } else {
                diff = 1;
            }
            domain = [baseValue.x - diff, baseValue.x];
            $$.updateXDomain(null, true, true, false, domain);
        } else if (orgDataCount === 1) {
            if ($$.isTimeSeries()) {
                diff = (baseTarget.values[baseTarget.values.length - 1].x - baseValue.x) / 2;
                domain = [new Date(+baseValue.x - diff), new Date(+baseValue.x + diff)];
                $$.updateXDomain(null, true, true, false, domain);
            }
        }

        // Set targets
        $$.updateTargets($$.data.targets);

        // Redraw with new targets
        $$.redraw({
            flow: {
                index: baseValue.index,
                length: length,
                duration: isValue(args.duration) ? args.duration : $$.config.transition_duration,
                done: args.done,
                orgDataCount: orgDataCount
            },
            withLegend: true,
            withTransition: orgDataCount > 1,
            withTrimXDomain: false,
            withUpdateXAxis: true
        });
    };

    c3_chart_internal_fn.generateFlow = function (args) {
        var $$ = this,
            config = $$.config,
            d3 = $$.d3;

        return function () {
            var targets = args.targets,
                flow = args.flow,
                drawBar = args.drawBar,
                drawLine = args.drawLine,
                drawArea = args.drawArea,
                cx = args.cx,
                cy = args.cy,
                xv = args.xv,
                xForText = args.xForText,
                yForText = args.yForText,
                duration = args.duration;

            var translateX,
                scaleX = 1,
                transform,
                flowIndex = flow.index,
                flowLength = flow.length,
                flowStart = $$.getValueOnIndex($$.data.targets[0].values, flowIndex),
                flowEnd = $$.getValueOnIndex($$.data.targets[0].values, flowIndex + flowLength),
                orgDomain = $$.x.domain(),
                domain,
                durationForFlow = flow.duration || duration,
                done = flow.done || function () {},
                wait = $$.generateWait();

            var xgrid = $$.xgrid || d3.selectAll([]),
                xgridLines = $$.xgridLines || d3.selectAll([]),
                mainRegion = $$.mainRegion || d3.selectAll([]),
                mainText = $$.mainText || d3.selectAll([]),
                mainBar = $$.mainBar || d3.selectAll([]),
                mainLine = $$.mainLine || d3.selectAll([]),
                mainArea = $$.mainArea || d3.selectAll([]),
                mainCircle = $$.mainCircle || d3.selectAll([]);

            // set flag
            $$.flowing = true;

            // remove head data after rendered
            $$.data.targets.forEach(function (d) {
                d.values.splice(0, flowLength);
            });

            // update x domain to generate axis elements for flow
            domain = $$.updateXDomain(targets, true, true);
            // update elements related to x scale
            if ($$.updateXGrid) {
                $$.updateXGrid(true);
            }

            // generate transform to flow
            if (!flow.orgDataCount) {
                // if empty
                if ($$.data.targets[0].values.length !== 1) {
                    translateX = $$.x(orgDomain[0]) - $$.x(domain[0]);
                } else {
                    if ($$.isTimeSeries()) {
                        flowStart = $$.getValueOnIndex($$.data.targets[0].values, 0);
                        flowEnd = $$.getValueOnIndex($$.data.targets[0].values, $$.data.targets[0].values.length - 1);
                        translateX = $$.x(flowStart.x) - $$.x(flowEnd.x);
                    } else {
                        translateX = diffDomain(domain) / 2;
                    }
                }
            } else if (flow.orgDataCount === 1 || (flowStart && flowStart.x) === (flowEnd && flowEnd.x)) {
                translateX = $$.x(orgDomain[0]) - $$.x(domain[0]);
            } else {
                if ($$.isTimeSeries()) {
                    translateX = $$.x(orgDomain[0]) - $$.x(domain[0]);
                } else {
                    translateX = $$.x(flowStart.x) - $$.x(flowEnd.x);
                }
            }
            scaleX = diffDomain(orgDomain) / diffDomain(domain);
            transform = 'translate(' + translateX + ',0) scale(' + scaleX + ',1)';

            $$.hideXGridFocus();

            d3.transition().ease('linear').duration(durationForFlow).each(function () {
                wait.add($$.axes.x.transition().call($$.xAxis));
                wait.add(mainBar.transition().attr('transform', transform));
                wait.add(mainLine.transition().attr('transform', transform));
                wait.add(mainArea.transition().attr('transform', transform));
                wait.add(mainCircle.transition().attr('transform', transform));
                wait.add(mainText.transition().attr('transform', transform));
                wait.add(mainRegion.filter($$.isRegionOnX).transition().attr('transform', transform));
                wait.add(xgrid.transition().attr('transform', transform));
                wait.add(xgridLines.transition().attr('transform', transform));
            }).call(wait, function () {
                var i,
                    shapes = [],
                    texts = [],
                    eventRects = [];

                // remove flowed elements
                if (flowLength) {
                    for (i = 0; i < flowLength; i++) {
                        shapes.push('.' + CLASS.shape + '-' + (flowIndex + i));
                        texts.push('.' + CLASS.text + '-' + (flowIndex + i));
                        eventRects.push('.' + CLASS.eventRect + '-' + (flowIndex + i));
                    }
                    $$.svg.selectAll('.' + CLASS.shapes).selectAll(shapes).remove();
                    $$.svg.selectAll('.' + CLASS.texts).selectAll(texts).remove();
                    $$.svg.selectAll('.' + CLASS.eventRects).selectAll(eventRects).remove();
                    $$.svg.select('.' + CLASS.xgrid).remove();
                }

                // draw again for removing flowed elements and reverting attr
                xgrid.attr('transform', null).attr($$.xgridAttr);
                xgridLines.attr('transform', null);
                xgridLines.select('line').attr("x1", config.axis_rotated ? 0 : xv).attr("x2", config.axis_rotated ? $$.width : xv);
                xgridLines.select('text').attr("x", config.axis_rotated ? $$.width : 0).attr("y", xv);
                mainBar.attr('transform', null).attr("d", drawBar);
                mainLine.attr('transform', null).attr("d", drawLine);
                mainArea.attr('transform', null).attr("d", drawArea);
                mainCircle.attr('transform', null).attr("cx", cx).attr("cy", cy);
                mainText.attr('transform', null).attr('x', xForText).attr('y', yForText).style('fill-opacity', $$.opacityForText.bind($$));
                mainRegion.attr('transform', null);
                mainRegion.select('rect').filter($$.isRegionOnX).attr("x", $$.regionX.bind($$)).attr("width", $$.regionWidth.bind($$));

                if (config.interaction_enabled) {
                    $$.redrawEventRect();
                }

                // callback for end of flow
                done();

                $$.flowing = false;
            });
        };
    };

    c3_chart_fn.selected = function (targetId) {
        var $$ = this.internal,
            d3 = $$.d3;
        return d3.merge($$.main.selectAll('.' + CLASS.shapes + $$.getTargetSelectorSuffix(targetId)).selectAll('.' + CLASS.shape).filter(function () {
            return d3.select(this).classed(CLASS.SELECTED);
        }).map(function (d) {
            return d.map(function (d) {
                var data = d.__data__;return data.data ? data.data : data;
            });
        }));
    };
    c3_chart_fn.select = function (ids, indices, resetOther) {
        var $$ = this.internal,
            d3 = $$.d3,
            config = $$.config;
        if (!config.data_selection_enabled) {
            return;
        }
        $$.main.selectAll('.' + CLASS.shapes).selectAll('.' + CLASS.shape).each(function (d, i) {
            var shape = d3.select(this),
                id = d.data ? d.data.id : d.id,
                toggle = $$.getToggle(this, d).bind($$),
                isTargetId = config.data_selection_grouped || !ids || ids.indexOf(id) >= 0,
                isTargetIndex = !indices || indices.indexOf(i) >= 0,
                isSelected = shape.classed(CLASS.SELECTED);
            // line/area selection not supported yet
            if (shape.classed(CLASS.line) || shape.classed(CLASS.area)) {
                return;
            }
            if (isTargetId && isTargetIndex) {
                if (config.data_selection_isselectable(d) && !isSelected) {
                    toggle(true, shape.classed(CLASS.SELECTED, true), d, i);
                }
            } else if (isDefined(resetOther) && resetOther) {
                if (isSelected) {
                    toggle(false, shape.classed(CLASS.SELECTED, false), d, i);
                }
            }
        });
    };
    c3_chart_fn.unselect = function (ids, indices) {
        var $$ = this.internal,
            d3 = $$.d3,
            config = $$.config;
        if (!config.data_selection_enabled) {
            return;
        }
        $$.main.selectAll('.' + CLASS.shapes).selectAll('.' + CLASS.shape).each(function (d, i) {
            var shape = d3.select(this),
                id = d.data ? d.data.id : d.id,
                toggle = $$.getToggle(this, d).bind($$),
                isTargetId = config.data_selection_grouped || !ids || ids.indexOf(id) >= 0,
                isTargetIndex = !indices || indices.indexOf(i) >= 0,
                isSelected = shape.classed(CLASS.SELECTED);
            // line/area selection not supported yet
            if (shape.classed(CLASS.line) || shape.classed(CLASS.area)) {
                return;
            }
            if (isTargetId && isTargetIndex) {
                if (config.data_selection_isselectable(d)) {
                    if (isSelected) {
                        toggle(false, shape.classed(CLASS.SELECTED, false), d, i);
                    }
                }
            }
        });
    };

    c3_chart_fn.transform = function (type, targetIds) {
        var $$ = this.internal,
            options = ['pie', 'donut'].indexOf(type) >= 0 ? { withTransform: true } : null;
        $$.transformTo(targetIds, type, options);
    };

    c3_chart_internal_fn.transformTo = function (targetIds, type, optionsForRedraw) {
        var $$ = this,
            withTransitionForAxis = !$$.hasArcType(),
            options = optionsForRedraw || { withTransitionForAxis: withTransitionForAxis };
        options.withTransitionForTransform = false;
        $$.transiting = false;
        $$.setTargetType(targetIds, type);
        $$.updateTargets($$.data.targets); // this is needed when transforming to arc
        $$.updateAndRedraw(options);
    };

    c3_chart_fn.groups = function (groups) {
        var $$ = this.internal,
            config = $$.config;
        if (isUndefined(groups)) {
            return config.data_groups;
        }
        config.data_groups = groups;
        $$.redraw();
        return config.data_groups;
    };

    c3_chart_fn.xgrids = function (grids) {
        var $$ = this.internal,
            config = $$.config;
        if (!grids) {
            return config.grid_x_lines;
        }
        config.grid_x_lines = grids;
        $$.redrawWithoutRescale();
        return config.grid_x_lines;
    };
    c3_chart_fn.xgrids.add = function (grids) {
        var $$ = this.internal;
        return this.xgrids($$.config.grid_x_lines.concat(grids ? grids : []));
    };
    c3_chart_fn.xgrids.remove = function (params) {
        // TODO: multiple
        var $$ = this.internal;
        $$.removeGridLines(params, true);
    };

    c3_chart_fn.ygrids = function (grids) {
        var $$ = this.internal,
            config = $$.config;
        if (!grids) {
            return config.grid_y_lines;
        }
        config.grid_y_lines = grids;
        $$.redrawWithoutRescale();
        return config.grid_y_lines;
    };
    c3_chart_fn.ygrids.add = function (grids) {
        var $$ = this.internal;
        return this.ygrids($$.config.grid_y_lines.concat(grids ? grids : []));
    };
    c3_chart_fn.ygrids.remove = function (params) {
        // TODO: multiple
        var $$ = this.internal;
        $$.removeGridLines(params, false);
    };

    c3_chart_fn.regions = function (regions) {
        var $$ = this.internal,
            config = $$.config;
        if (!regions) {
            return config.regions;
        }
        config.regions = regions;
        $$.redrawWithoutRescale();
        return config.regions;
    };
    c3_chart_fn.regions.add = function (regions) {
        var $$ = this.internal,
            config = $$.config;
        if (!regions) {
            return config.regions;
        }
        config.regions = config.regions.concat(regions);
        $$.redrawWithoutRescale();
        return config.regions;
    };
    c3_chart_fn.regions.remove = function (options) {
        var $$ = this.internal,
            config = $$.config,
            duration,
            classes,
            regions;

        options = options || {};
        duration = $$.getOption(options, "duration", config.transition_duration);
        classes = $$.getOption(options, "classes", [CLASS.region]);

        regions = $$.main.select('.' + CLASS.regions).selectAll(classes.map(function (c) {
            return '.' + c;
        }));
        (duration ? regions.transition().duration(duration) : regions).style('opacity', 0).remove();

        config.regions = config.regions.filter(function (region) {
            var found = false;
            if (!region['class']) {
                return true;
            }
            region['class'].split(' ').forEach(function (c) {
                if (classes.indexOf(c) >= 0) {
                    found = true;
                }
            });
            return !found;
        });

        return config.regions;
    };

    c3_chart_fn.data = function (targetIds) {
        var targets = this.internal.data.targets;
        return typeof targetIds === 'undefined' ? targets : targets.filter(function (t) {
            return [].concat(targetIds).indexOf(t.id) >= 0;
        });
    };
    c3_chart_fn.data.shown = function (targetIds) {
        return this.internal.filterTargetsToShow(this.data(targetIds));
    };
    c3_chart_fn.data.values = function (targetId) {
        var targets,
            values = null;
        if (targetId) {
            targets = this.data(targetId);
            values = targets[0] ? targets[0].values.map(function (d) {
                return d.value;
            }) : null;
        }
        return values;
    };
    c3_chart_fn.data.names = function (names) {
        this.internal.clearLegendItemTextBoxCache();
        return this.internal.updateDataAttributes('names', names);
    };
    c3_chart_fn.data.colors = function (colors) {
        return this.internal.updateDataAttributes('colors', colors);
    };
    c3_chart_fn.data.axes = function (axes) {
        return this.internal.updateDataAttributes('axes', axes);
    };

    c3_chart_fn.category = function (i, category) {
        var $$ = this.internal,
            config = $$.config;
        if (arguments.length > 1) {
            config.axis_x_categories[i] = category;
            $$.redraw();
        }
        return config.axis_x_categories[i];
    };
    c3_chart_fn.categories = function (categories) {
        var $$ = this.internal,
            config = $$.config;
        if (!arguments.length) {
            return config.axis_x_categories;
        }
        config.axis_x_categories = categories;
        $$.redraw();
        return config.axis_x_categories;
    };

    // TODO: fix
    c3_chart_fn.color = function (id) {
        var $$ = this.internal;
        return $$.color(id); // more patterns
    };

    c3_chart_fn.x = function (x) {
        var $$ = this.internal;
        if (arguments.length) {
            $$.updateTargetX($$.data.targets, x);
            $$.redraw({ withUpdateOrgXDomain: true, withUpdateXDomain: true });
        }
        return $$.data.xs;
    };
    c3_chart_fn.xs = function (xs) {
        var $$ = this.internal;
        if (arguments.length) {
            $$.updateTargetXs($$.data.targets, xs);
            $$.redraw({ withUpdateOrgXDomain: true, withUpdateXDomain: true });
        }
        return $$.data.xs;
    };

    c3_chart_fn.axis = function () {};
    c3_chart_fn.axis.labels = function (labels) {
        var $$ = this.internal;
        if (arguments.length) {
            Object.keys(labels).forEach(function (axisId) {
                $$.axis.setLabelText(axisId, labels[axisId]);
            });
            $$.axis.updateLabels();
        }
        // TODO: return some values?
    };
    c3_chart_fn.axis.max = function (max) {
        var $$ = this.internal,
            config = $$.config;
        if (arguments.length) {
            if ((typeof max === 'undefined' ? 'undefined' : _typeof(max)) === 'object') {
                if (isValue(max.x)) {
                    config.axis_x_max = max.x;
                }
                if (isValue(max.y)) {
                    config.axis_y_max = max.y;
                }
                if (isValue(max.y2)) {
                    config.axis_y2_max = max.y2;
                }
            } else {
                config.axis_y_max = config.axis_y2_max = max;
            }
            $$.redraw({ withUpdateOrgXDomain: true, withUpdateXDomain: true });
        } else {
            return {
                x: config.axis_x_max,
                y: config.axis_y_max,
                y2: config.axis_y2_max
            };
        }
    };
    c3_chart_fn.axis.min = function (min) {
        var $$ = this.internal,
            config = $$.config;
        if (arguments.length) {
            if ((typeof min === 'undefined' ? 'undefined' : _typeof(min)) === 'object') {
                if (isValue(min.x)) {
                    config.axis_x_min = min.x;
                }
                if (isValue(min.y)) {
                    config.axis_y_min = min.y;
                }
                if (isValue(min.y2)) {
                    config.axis_y2_min = min.y2;
                }
            } else {
                config.axis_y_min = config.axis_y2_min = min;
            }
            $$.redraw({ withUpdateOrgXDomain: true, withUpdateXDomain: true });
        } else {
            return {
                x: config.axis_x_min,
                y: config.axis_y_min,
                y2: config.axis_y2_min
            };
        }
    };
    c3_chart_fn.axis.range = function (range) {
        if (arguments.length) {
            if (isDefined(range.max)) {
                this.axis.max(range.max);
            }
            if (isDefined(range.min)) {
                this.axis.min(range.min);
            }
        } else {
            return {
                max: this.axis.max(),
                min: this.axis.min()
            };
        }
    };

    c3_chart_fn.legend = function () {};
    c3_chart_fn.legend.show = function (targetIds) {
        var $$ = this.internal;
        $$.showLegend($$.mapToTargetIds(targetIds));
        $$.updateAndRedraw({ withLegend: true });
    };
    c3_chart_fn.legend.hide = function (targetIds) {
        var $$ = this.internal;
        $$.hideLegend($$.mapToTargetIds(targetIds));
        $$.updateAndRedraw({ withLegend: true });
    };

    c3_chart_fn.resize = function (size) {
        var $$ = this.internal,
            config = $$.config;
        config.size_width = size ? size.width : null;
        config.size_height = size ? size.height : null;
        this.flush();
    };

    c3_chart_fn.flush = function () {
        var $$ = this.internal;
        $$.updateAndRedraw({ withLegend: true, withTransition: false, withTransitionForTransform: false });
    };

    c3_chart_fn.destroy = function () {
        var $$ = this.internal;

        window.clearInterval($$.intervalForObserveInserted);

        if ($$.resizeTimeout !== undefined) {
            window.clearTimeout($$.resizeTimeout);
        }

        if (window.detachEvent) {
            window.detachEvent('onresize', $$.resizeFunction);
        } else if (window.removeEventListener) {
            window.removeEventListener('resize', $$.resizeFunction);
        } else {
            var wrapper = window.onresize;
            // check if no one else removed our wrapper and remove our resizeFunction from it
            if (wrapper && wrapper.add && wrapper.remove) {
                wrapper.remove($$.resizeFunction);
            }
        }

        $$.selectChart.classed('c3', false).html("");

        // MEMO: this is needed because the reference of some elements will not be released, then memory leak will happen.
        Object.keys($$).forEach(function (key) {
            $$[key] = null;
        });

        return null;
    };

    c3_chart_fn.tooltip = function () {};
    c3_chart_fn.tooltip.show = function (args) {
        var $$ = this.internal,
            index,
            mouse;

        // determine mouse position on the chart
        if (args.mouse) {
            mouse = args.mouse;
        }

        // determine focus data
        if (args.data) {
            if ($$.isMultipleX()) {
                // if multiple xs, target point will be determined by mouse
                mouse = [$$.x(args.data.x), $$.getYScale(args.data.id)(args.data.value)];
                index = null;
            } else {
                // TODO: when tooltip_grouped = false
                index = isValue(args.data.index) ? args.data.index : $$.getIndexByX(args.data.x);
            }
        } else if (typeof args.x !== 'undefined') {
            index = $$.getIndexByX(args.x);
        } else if (typeof args.index !== 'undefined') {
            index = args.index;
        }

        // emulate mouse events to show
        $$.dispatchEvent('mouseover', index, mouse);
        $$.dispatchEvent('mousemove', index, mouse);

        $$.config.tooltip_onshow.call($$, args.data);
    };
    c3_chart_fn.tooltip.hide = function () {
        // TODO: get target data by checking the state of focus
        this.internal.dispatchEvent('mouseout', 0);

        this.internal.config.tooltip_onhide.call(this);
    };

    // Features:
    // 1. category axis
    // 2. ceil values of translate/x/y to int for half pixel antialiasing
    // 3. multiline tick text
    var tickTextCharSize;
    function c3_axis(d3, params) {
        var scale = d3.scale.linear(),
            orient = "bottom",
            innerTickSize = 6,
            outerTickSize,
            tickPadding = 3,
            tickValues = null,
            tickFormat,
            tickArguments;

        var tickOffset = 0,
            tickCulling = true,
            tickCentered;

        params = params || {};
        outerTickSize = params.withOuterTick ? 6 : 0;

        function axisX(selection, x) {
            selection.attr("transform", function (d) {
                return "translate(" + Math.ceil(x(d) + tickOffset) + ", 0)";
            });
        }
        function axisY(selection, y) {
            selection.attr("transform", function (d) {
                return "translate(0," + Math.ceil(y(d)) + ")";
            });
        }
        function scaleExtent(domain) {
            var start = domain[0],
                stop = domain[domain.length - 1];
            return start < stop ? [start, stop] : [stop, start];
        }
        function generateTicks(scale) {
            var i,
                domain,
                ticks = [];
            if (scale.ticks) {
                return scale.ticks.apply(scale, tickArguments);
            }
            domain = scale.domain();
            for (i = Math.ceil(domain[0]); i < domain[1]; i++) {
                ticks.push(i);
            }
            if (ticks.length > 0 && ticks[0] > 0) {
                ticks.unshift(ticks[0] - (ticks[1] - ticks[0]));
            }
            return ticks;
        }
        function copyScale() {
            var newScale = scale.copy(),
                domain;
            if (params.isCategory) {
                domain = scale.domain();
                newScale.domain([domain[0], domain[1] - 1]);
            }
            return newScale;
        }
        function textFormatted(v) {
            var formatted = tickFormat ? tickFormat(v) : v;
            return typeof formatted !== 'undefined' ? formatted : '';
        }
        function getSizeFor1Char(tick) {
            if (tickTextCharSize) {
                return tickTextCharSize;
            }
            var size = {
                h: 11.5,
                w: 5.5
            };
            tick.select('text').text(textFormatted).each(function (d) {
                var box = this.getBoundingClientRect(),
                    text = textFormatted(d),
                    h = box.height,
                    w = text ? box.width / text.length : undefined;
                if (h && w) {
                    size.h = h;
                    size.w = w;
                }
            }).text('');
            tickTextCharSize = size;
            return size;
        }
        function transitionise(selection) {
            return params.withoutTransition ? selection : d3.transition(selection);
        }
        function axis(g) {
            g.each(function () {
                var g = axis.g = d3.select(this);

                var scale0 = this.__chart__ || scale,
                    scale1 = this.__chart__ = copyScale();

                var ticks = tickValues ? tickValues : generateTicks(scale1),
                    tick = g.selectAll(".tick").data(ticks, scale1),
                    tickEnter = tick.enter().insert("g", ".domain").attr("class", "tick").style("opacity", 1e-6),

                // MEMO: No exit transition. The reason is this transition affects max tick width calculation because old tick will be included in the ticks.
                tickExit = tick.exit().remove(),
                    tickUpdate = transitionise(tick).style("opacity", 1),
                    tickTransform,
                    tickX,
                    tickY;

                var range = scale.rangeExtent ? scale.rangeExtent() : scaleExtent(scale.range()),
                    path = g.selectAll(".domain").data([0]),
                    pathUpdate = (path.enter().append("path").attr("class", "domain"), transitionise(path));
                tickEnter.append("line");
                tickEnter.append("text");

                var lineEnter = tickEnter.select("line"),
                    lineUpdate = tickUpdate.select("line"),
                    textEnter = tickEnter.select("text"),
                    textUpdate = tickUpdate.select("text");

                if (params.isCategory) {
                    tickOffset = Math.ceil((scale1(1) - scale1(0)) / 2);
                    tickX = tickCentered ? 0 : tickOffset;
                    tickY = tickCentered ? tickOffset : 0;
                } else {
                    tickOffset = tickX = 0;
                }

                var text,
                    tspan,
                    sizeFor1Char = getSizeFor1Char(g.select('.tick')),
                    counts = [];
                var tickLength = Math.max(innerTickSize, 0) + tickPadding,
                    isVertical = orient === 'left' || orient === 'right';

                // this should be called only when category axis
                function splitTickText(d, maxWidth) {
                    var tickText = textFormatted(d),
                        subtext,
                        spaceIndex,
                        textWidth,
                        splitted = [];

                    if (Object.prototype.toString.call(tickText) === "[object Array]") {
                        return tickText;
                    }

                    if (!maxWidth || maxWidth <= 0) {
                        maxWidth = isVertical ? 95 : params.isCategory ? Math.ceil(scale1(ticks[1]) - scale1(ticks[0])) - 12 : 110;
                    }

                    function split(splitted, text) {
                        spaceIndex = undefined;
                        for (var i = 1; i < text.length; i++) {
                            if (text.charAt(i) === ' ') {
                                spaceIndex = i;
                            }
                            subtext = text.substr(0, i + 1);
                            textWidth = sizeFor1Char.w * subtext.length;
                            // if text width gets over tick width, split by space index or crrent index
                            if (maxWidth < textWidth) {
                                return split(splitted.concat(text.substr(0, spaceIndex ? spaceIndex : i)), text.slice(spaceIndex ? spaceIndex + 1 : i));
                            }
                        }
                        return splitted.concat(text);
                    }

                    return split(splitted, tickText + "");
                }

                function tspanDy(d, i) {
                    var dy = sizeFor1Char.h;
                    if (i === 0) {
                        if (orient === 'left' || orient === 'right') {
                            dy = -((counts[d.index] - 1) * (sizeFor1Char.h / 2) - 3);
                        } else {
                            dy = ".71em";
                        }
                    }
                    return dy;
                }

                function tickSize(d) {
                    var tickPosition = scale(d) + (tickCentered ? 0 : tickOffset);
                    return range[0] < tickPosition && tickPosition < range[1] ? innerTickSize : 0;
                }

                text = tick.select("text");
                tspan = text.selectAll('tspan').data(function (d, i) {
                    var splitted = params.tickMultiline ? splitTickText(d, params.tickWidth) : [].concat(textFormatted(d));
                    counts[i] = splitted.length;
                    return splitted.map(function (s) {
                        return { index: i, splitted: s };
                    });
                });
                tspan.enter().append('tspan');
                tspan.exit().remove();
                tspan.text(function (d) {
                    return d.splitted;
                });

                var rotate = params.tickTextRotate;

                function textAnchorForText(rotate) {
                    if (!rotate) {
                        return 'middle';
                    }
                    return rotate > 0 ? "start" : "end";
                }
                function textTransform(rotate) {
                    if (!rotate) {
                        return '';
                    }
                    return "rotate(" + rotate + ")";
                }
                function dxForText(rotate) {
                    if (!rotate) {
                        return 0;
                    }
                    return 8 * Math.sin(Math.PI * (rotate / 180));
                }
                function yForText(rotate) {
                    if (!rotate) {
                        return tickLength;
                    }
                    return 11.5 - 2.5 * (rotate / 15) * (rotate > 0 ? 1 : -1);
                }

                switch (orient) {
                    case "bottom":
                        {
                            tickTransform = axisX;
                            lineEnter.attr("y2", innerTickSize);
                            textEnter.attr("y", tickLength);
                            lineUpdate.attr("x1", tickX).attr("x2", tickX).attr("y2", tickSize);
                            textUpdate.attr("x", 0).attr("y", yForText(rotate)).style("text-anchor", textAnchorForText(rotate)).attr("transform", textTransform(rotate));
                            tspan.attr('x', 0).attr("dy", tspanDy).attr('dx', dxForText(rotate));
                            pathUpdate.attr("d", "M" + range[0] + "," + outerTickSize + "V0H" + range[1] + "V" + outerTickSize);
                            break;
                        }
                    case "top":
                        {
                            // TODO: rotated tick text
                            tickTransform = axisX;
                            lineEnter.attr("y2", -innerTickSize);
                            textEnter.attr("y", -tickLength);
                            lineUpdate.attr("x2", 0).attr("y2", -innerTickSize);
                            textUpdate.attr("x", 0).attr("y", -tickLength);
                            text.style("text-anchor", "middle");
                            tspan.attr('x', 0).attr("dy", "0em");
                            pathUpdate.attr("d", "M" + range[0] + "," + -outerTickSize + "V0H" + range[1] + "V" + -outerTickSize);
                            break;
                        }
                    case "left":
                        {
                            tickTransform = axisY;
                            lineEnter.attr("x2", -innerTickSize);
                            textEnter.attr("x", -tickLength);
                            lineUpdate.attr("x2", -innerTickSize).attr("y1", tickY).attr("y2", tickY);
                            textUpdate.attr("x", -tickLength).attr("y", tickOffset);
                            text.style("text-anchor", "end");
                            tspan.attr('x', -tickLength).attr("dy", tspanDy);
                            pathUpdate.attr("d", "M" + -outerTickSize + "," + range[0] + "H0V" + range[1] + "H" + -outerTickSize);
                            break;
                        }
                    case "right":
                        {
                            tickTransform = axisY;
                            lineEnter.attr("x2", innerTickSize);
                            textEnter.attr("x", tickLength);
                            lineUpdate.attr("x2", innerTickSize).attr("y2", 0);
                            textUpdate.attr("x", tickLength).attr("y", 0);
                            text.style("text-anchor", "start");
                            tspan.attr('x', tickLength).attr("dy", tspanDy);
                            pathUpdate.attr("d", "M" + outerTickSize + "," + range[0] + "H0V" + range[1] + "H" + outerTickSize);
                            break;
                        }
                }
                if (scale1.rangeBand) {
                    var x = scale1,
                        dx = x.rangeBand() / 2;
                    scale0 = scale1 = function scale1(d) {
                        return x(d) + dx;
                    };
                } else if (scale0.rangeBand) {
                    scale0 = scale1;
                } else {
                    tickExit.call(tickTransform, scale1);
                }
                tickEnter.call(tickTransform, scale0);
                tickUpdate.call(tickTransform, scale1);
            });
        }
        axis.scale = function (x) {
            if (!arguments.length) {
                return scale;
            }
            scale = x;
            return axis;
        };
        axis.orient = function (x) {
            if (!arguments.length) {
                return orient;
            }
            orient = x in { top: 1, right: 1, bottom: 1, left: 1 } ? x + "" : "bottom";
            return axis;
        };
        axis.tickFormat = function (format) {
            if (!arguments.length) {
                return tickFormat;
            }
            tickFormat = format;
            return axis;
        };
        axis.tickCentered = function (isCentered) {
            if (!arguments.length) {
                return tickCentered;
            }
            tickCentered = isCentered;
            return axis;
        };
        axis.tickOffset = function () {
            return tickOffset;
        };
        axis.tickInterval = function () {
            var interval, length;
            if (params.isCategory) {
                interval = tickOffset * 2;
            } else {
                length = axis.g.select('path.domain').node().getTotalLength() - outerTickSize * 2;
                interval = length / axis.g.selectAll('line').size();
            }
            return interval === Infinity ? 0 : interval;
        };
        axis.ticks = function () {
            if (!arguments.length) {
                return tickArguments;
            }
            tickArguments = arguments;
            return axis;
        };
        axis.tickCulling = function (culling) {
            if (!arguments.length) {
                return tickCulling;
            }
            tickCulling = culling;
            return axis;
        };
        axis.tickValues = function (x) {
            if (typeof x === 'function') {
                tickValues = function tickValues() {
                    return x(scale.domain());
                };
            } else {
                if (!arguments.length) {
                    return tickValues;
                }
                tickValues = x;
            }
            return axis;
        };
        return axis;
    }

    c3_chart_internal_fn.isSafari = function () {
        var ua = window.navigator.userAgent;
        return ua.indexOf('Safari') >= 0 && ua.indexOf('Chrome') < 0;
    };
    c3_chart_internal_fn.isChrome = function () {
        var ua = window.navigator.userAgent;
        return ua.indexOf('Chrome') >= 0;
    };

    /* jshint ignore:start */

    // PhantomJS doesn't have support for Function.prototype.bind, which has caused confusion. Use
    // this polyfill to avoid the confusion.
    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind#Polyfill

    if (!Function.prototype.bind) {
        Function.prototype.bind = function (oThis) {
            if (typeof this !== 'function') {
                // closest thing possible to the ECMAScript 5
                // internal IsCallable function
                throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');
            }

            var aArgs = Array.prototype.slice.call(arguments, 1),
                fToBind = this,
                fNOP = function fNOP() {},
                fBound = function fBound() {
                return fToBind.apply(this instanceof fNOP ? this : oThis, aArgs.concat(Array.prototype.slice.call(arguments)));
            };

            fNOP.prototype = this.prototype;
            fBound.prototype = new fNOP();

            return fBound;
        };
    }

    //SVGPathSeg API polyfill
    //https://github.com/progers/pathseg
    //
    //This is a drop-in replacement for the SVGPathSeg and SVGPathSegList APIs that were removed from
    //SVG2 (https://lists.w3.org/Archives/Public/www-svg/2015Jun/0044.html), including the latest spec
    //changes which were implemented in Firefox 43 and Chrome 46.
    //Chrome 48 removes these APIs, so this polyfill is required.

    (function () {
        "use strict";

        if (!("SVGPathSeg" in window)) {
            // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathSeg
            window.SVGPathSeg = function (type, typeAsLetter, owningPathSegList) {
                this.pathSegType = type;
                this.pathSegTypeAsLetter = typeAsLetter;
                this._owningPathSegList = owningPathSegList;
            };

            SVGPathSeg.PATHSEG_UNKNOWN = 0;
            SVGPathSeg.PATHSEG_CLOSEPATH = 1;
            SVGPathSeg.PATHSEG_MOVETO_ABS = 2;
            SVGPathSeg.PATHSEG_MOVETO_REL = 3;
            SVGPathSeg.PATHSEG_LINETO_ABS = 4;
            SVGPathSeg.PATHSEG_LINETO_REL = 5;
            SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS = 6;
            SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL = 7;
            SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS = 8;
            SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL = 9;
            SVGPathSeg.PATHSEG_ARC_ABS = 10;
            SVGPathSeg.PATHSEG_ARC_REL = 11;
            SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS = 12;
            SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL = 13;
            SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS = 14;
            SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL = 15;
            SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS = 16;
            SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL = 17;
            SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS = 18;
            SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL = 19;

            // Notify owning PathSegList on any changes so they can be synchronized back to the path element.
            SVGPathSeg.prototype._segmentChanged = function () {
                if (this._owningPathSegList) this._owningPathSegList.segmentChanged(this);
            };

            window.SVGPathSegClosePath = function (owningPathSegList) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CLOSEPATH, "z", owningPathSegList);
            };
            SVGPathSegClosePath.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegClosePath.prototype.toString = function () {
                return "[object SVGPathSegClosePath]";
            };
            SVGPathSegClosePath.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter;
            };
            SVGPathSegClosePath.prototype.clone = function () {
                return new SVGPathSegClosePath(undefined);
            };

            window.SVGPathSegMovetoAbs = function (owningPathSegList, x, y) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_MOVETO_ABS, "M", owningPathSegList);
                this._x = x;
                this._y = y;
            };
            SVGPathSegMovetoAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegMovetoAbs.prototype.toString = function () {
                return "[object SVGPathSegMovetoAbs]";
            };
            SVGPathSegMovetoAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x + " " + this._y;
            };
            SVGPathSegMovetoAbs.prototype.clone = function () {
                return new SVGPathSegMovetoAbs(undefined, this._x, this._y);
            };
            Object.defineProperty(SVGPathSegMovetoAbs.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegMovetoAbs.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegMovetoRel = function (owningPathSegList, x, y) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_MOVETO_REL, "m", owningPathSegList);
                this._x = x;
                this._y = y;
            };
            SVGPathSegMovetoRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegMovetoRel.prototype.toString = function () {
                return "[object SVGPathSegMovetoRel]";
            };
            SVGPathSegMovetoRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x + " " + this._y;
            };
            SVGPathSegMovetoRel.prototype.clone = function () {
                return new SVGPathSegMovetoRel(undefined, this._x, this._y);
            };
            Object.defineProperty(SVGPathSegMovetoRel.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegMovetoRel.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegLinetoAbs = function (owningPathSegList, x, y) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_ABS, "L", owningPathSegList);
                this._x = x;
                this._y = y;
            };
            SVGPathSegLinetoAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegLinetoAbs.prototype.toString = function () {
                return "[object SVGPathSegLinetoAbs]";
            };
            SVGPathSegLinetoAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x + " " + this._y;
            };
            SVGPathSegLinetoAbs.prototype.clone = function () {
                return new SVGPathSegLinetoAbs(undefined, this._x, this._y);
            };
            Object.defineProperty(SVGPathSegLinetoAbs.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegLinetoAbs.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegLinetoRel = function (owningPathSegList, x, y) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_REL, "l", owningPathSegList);
                this._x = x;
                this._y = y;
            };
            SVGPathSegLinetoRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegLinetoRel.prototype.toString = function () {
                return "[object SVGPathSegLinetoRel]";
            };
            SVGPathSegLinetoRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x + " " + this._y;
            };
            SVGPathSegLinetoRel.prototype.clone = function () {
                return new SVGPathSegLinetoRel(undefined, this._x, this._y);
            };
            Object.defineProperty(SVGPathSegLinetoRel.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegLinetoRel.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegCurvetoCubicAbs = function (owningPathSegList, x, y, x1, y1, x2, y2) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS, "C", owningPathSegList);
                this._x = x;
                this._y = y;
                this._x1 = x1;
                this._y1 = y1;
                this._x2 = x2;
                this._y2 = y2;
            };
            SVGPathSegCurvetoCubicAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegCurvetoCubicAbs.prototype.toString = function () {
                return "[object SVGPathSegCurvetoCubicAbs]";
            };
            SVGPathSegCurvetoCubicAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x1 + " " + this._y1 + " " + this._x2 + " " + this._y2 + " " + this._x + " " + this._y;
            };
            SVGPathSegCurvetoCubicAbs.prototype.clone = function () {
                return new SVGPathSegCurvetoCubicAbs(undefined, this._x, this._y, this._x1, this._y1, this._x2, this._y2);
            };
            Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, "x1", { get: function get() {
                    return this._x1;
                }, set: function set(x1) {
                    this._x1 = x1;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, "y1", { get: function get() {
                    return this._y1;
                }, set: function set(y1) {
                    this._y1 = y1;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, "x2", { get: function get() {
                    return this._x2;
                }, set: function set(x2) {
                    this._x2 = x2;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype, "y2", { get: function get() {
                    return this._y2;
                }, set: function set(y2) {
                    this._y2 = y2;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegCurvetoCubicRel = function (owningPathSegList, x, y, x1, y1, x2, y2) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL, "c", owningPathSegList);
                this._x = x;
                this._y = y;
                this._x1 = x1;
                this._y1 = y1;
                this._x2 = x2;
                this._y2 = y2;
            };
            SVGPathSegCurvetoCubicRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegCurvetoCubicRel.prototype.toString = function () {
                return "[object SVGPathSegCurvetoCubicRel]";
            };
            SVGPathSegCurvetoCubicRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x1 + " " + this._y1 + " " + this._x2 + " " + this._y2 + " " + this._x + " " + this._y;
            };
            SVGPathSegCurvetoCubicRel.prototype.clone = function () {
                return new SVGPathSegCurvetoCubicRel(undefined, this._x, this._y, this._x1, this._y1, this._x2, this._y2);
            };
            Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, "x1", { get: function get() {
                    return this._x1;
                }, set: function set(x1) {
                    this._x1 = x1;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, "y1", { get: function get() {
                    return this._y1;
                }, set: function set(y1) {
                    this._y1 = y1;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, "x2", { get: function get() {
                    return this._x2;
                }, set: function set(x2) {
                    this._x2 = x2;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype, "y2", { get: function get() {
                    return this._y2;
                }, set: function set(y2) {
                    this._y2 = y2;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegCurvetoQuadraticAbs = function (owningPathSegList, x, y, x1, y1) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS, "Q", owningPathSegList);
                this._x = x;
                this._y = y;
                this._x1 = x1;
                this._y1 = y1;
            };
            SVGPathSegCurvetoQuadraticAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegCurvetoQuadraticAbs.prototype.toString = function () {
                return "[object SVGPathSegCurvetoQuadraticAbs]";
            };
            SVGPathSegCurvetoQuadraticAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x1 + " " + this._y1 + " " + this._x + " " + this._y;
            };
            SVGPathSegCurvetoQuadraticAbs.prototype.clone = function () {
                return new SVGPathSegCurvetoQuadraticAbs(undefined, this._x, this._y, this._x1, this._y1);
            };
            Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype, "x1", { get: function get() {
                    return this._x1;
                }, set: function set(x1) {
                    this._x1 = x1;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype, "y1", { get: function get() {
                    return this._y1;
                }, set: function set(y1) {
                    this._y1 = y1;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegCurvetoQuadraticRel = function (owningPathSegList, x, y, x1, y1) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL, "q", owningPathSegList);
                this._x = x;
                this._y = y;
                this._x1 = x1;
                this._y1 = y1;
            };
            SVGPathSegCurvetoQuadraticRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegCurvetoQuadraticRel.prototype.toString = function () {
                return "[object SVGPathSegCurvetoQuadraticRel]";
            };
            SVGPathSegCurvetoQuadraticRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x1 + " " + this._y1 + " " + this._x + " " + this._y;
            };
            SVGPathSegCurvetoQuadraticRel.prototype.clone = function () {
                return new SVGPathSegCurvetoQuadraticRel(undefined, this._x, this._y, this._x1, this._y1);
            };
            Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype, "x1", { get: function get() {
                    return this._x1;
                }, set: function set(x1) {
                    this._x1 = x1;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype, "y1", { get: function get() {
                    return this._y1;
                }, set: function set(y1) {
                    this._y1 = y1;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegArcAbs = function (owningPathSegList, x, y, r1, r2, angle, largeArcFlag, sweepFlag) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_ARC_ABS, "A", owningPathSegList);
                this._x = x;
                this._y = y;
                this._r1 = r1;
                this._r2 = r2;
                this._angle = angle;
                this._largeArcFlag = largeArcFlag;
                this._sweepFlag = sweepFlag;
            };
            SVGPathSegArcAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegArcAbs.prototype.toString = function () {
                return "[object SVGPathSegArcAbs]";
            };
            SVGPathSegArcAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._r1 + " " + this._r2 + " " + this._angle + " " + (this._largeArcFlag ? "1" : "0") + " " + (this._sweepFlag ? "1" : "0") + " " + this._x + " " + this._y;
            };
            SVGPathSegArcAbs.prototype.clone = function () {
                return new SVGPathSegArcAbs(undefined, this._x, this._y, this._r1, this._r2, this._angle, this._largeArcFlag, this._sweepFlag);
            };
            Object.defineProperty(SVGPathSegArcAbs.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcAbs.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcAbs.prototype, "r1", { get: function get() {
                    return this._r1;
                }, set: function set(r1) {
                    this._r1 = r1;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcAbs.prototype, "r2", { get: function get() {
                    return this._r2;
                }, set: function set(r2) {
                    this._r2 = r2;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcAbs.prototype, "angle", { get: function get() {
                    return this._angle;
                }, set: function set(angle) {
                    this._angle = angle;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcAbs.prototype, "largeArcFlag", { get: function get() {
                    return this._largeArcFlag;
                }, set: function set(largeArcFlag) {
                    this._largeArcFlag = largeArcFlag;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcAbs.prototype, "sweepFlag", { get: function get() {
                    return this._sweepFlag;
                }, set: function set(sweepFlag) {
                    this._sweepFlag = sweepFlag;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegArcRel = function (owningPathSegList, x, y, r1, r2, angle, largeArcFlag, sweepFlag) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_ARC_REL, "a", owningPathSegList);
                this._x = x;
                this._y = y;
                this._r1 = r1;
                this._r2 = r2;
                this._angle = angle;
                this._largeArcFlag = largeArcFlag;
                this._sweepFlag = sweepFlag;
            };
            SVGPathSegArcRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegArcRel.prototype.toString = function () {
                return "[object SVGPathSegArcRel]";
            };
            SVGPathSegArcRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._r1 + " " + this._r2 + " " + this._angle + " " + (this._largeArcFlag ? "1" : "0") + " " + (this._sweepFlag ? "1" : "0") + " " + this._x + " " + this._y;
            };
            SVGPathSegArcRel.prototype.clone = function () {
                return new SVGPathSegArcRel(undefined, this._x, this._y, this._r1, this._r2, this._angle, this._largeArcFlag, this._sweepFlag);
            };
            Object.defineProperty(SVGPathSegArcRel.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcRel.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcRel.prototype, "r1", { get: function get() {
                    return this._r1;
                }, set: function set(r1) {
                    this._r1 = r1;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcRel.prototype, "r2", { get: function get() {
                    return this._r2;
                }, set: function set(r2) {
                    this._r2 = r2;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcRel.prototype, "angle", { get: function get() {
                    return this._angle;
                }, set: function set(angle) {
                    this._angle = angle;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcRel.prototype, "largeArcFlag", { get: function get() {
                    return this._largeArcFlag;
                }, set: function set(largeArcFlag) {
                    this._largeArcFlag = largeArcFlag;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegArcRel.prototype, "sweepFlag", { get: function get() {
                    return this._sweepFlag;
                }, set: function set(sweepFlag) {
                    this._sweepFlag = sweepFlag;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegLinetoHorizontalAbs = function (owningPathSegList, x) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS, "H", owningPathSegList);
                this._x = x;
            };
            SVGPathSegLinetoHorizontalAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegLinetoHorizontalAbs.prototype.toString = function () {
                return "[object SVGPathSegLinetoHorizontalAbs]";
            };
            SVGPathSegLinetoHorizontalAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x;
            };
            SVGPathSegLinetoHorizontalAbs.prototype.clone = function () {
                return new SVGPathSegLinetoHorizontalAbs(undefined, this._x);
            };
            Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegLinetoHorizontalRel = function (owningPathSegList, x) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL, "h", owningPathSegList);
                this._x = x;
            };
            SVGPathSegLinetoHorizontalRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegLinetoHorizontalRel.prototype.toString = function () {
                return "[object SVGPathSegLinetoHorizontalRel]";
            };
            SVGPathSegLinetoHorizontalRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x;
            };
            SVGPathSegLinetoHorizontalRel.prototype.clone = function () {
                return new SVGPathSegLinetoHorizontalRel(undefined, this._x);
            };
            Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegLinetoVerticalAbs = function (owningPathSegList, y) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS, "V", owningPathSegList);
                this._y = y;
            };
            SVGPathSegLinetoVerticalAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegLinetoVerticalAbs.prototype.toString = function () {
                return "[object SVGPathSegLinetoVerticalAbs]";
            };
            SVGPathSegLinetoVerticalAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._y;
            };
            SVGPathSegLinetoVerticalAbs.prototype.clone = function () {
                return new SVGPathSegLinetoVerticalAbs(undefined, this._y);
            };
            Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegLinetoVerticalRel = function (owningPathSegList, y) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL, "v", owningPathSegList);
                this._y = y;
            };
            SVGPathSegLinetoVerticalRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegLinetoVerticalRel.prototype.toString = function () {
                return "[object SVGPathSegLinetoVerticalRel]";
            };
            SVGPathSegLinetoVerticalRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._y;
            };
            SVGPathSegLinetoVerticalRel.prototype.clone = function () {
                return new SVGPathSegLinetoVerticalRel(undefined, this._y);
            };
            Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegCurvetoCubicSmoothAbs = function (owningPathSegList, x, y, x2, y2) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS, "S", owningPathSegList);
                this._x = x;
                this._y = y;
                this._x2 = x2;
                this._y2 = y2;
            };
            SVGPathSegCurvetoCubicSmoothAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegCurvetoCubicSmoothAbs.prototype.toString = function () {
                return "[object SVGPathSegCurvetoCubicSmoothAbs]";
            };
            SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x2 + " " + this._y2 + " " + this._x + " " + this._y;
            };
            SVGPathSegCurvetoCubicSmoothAbs.prototype.clone = function () {
                return new SVGPathSegCurvetoCubicSmoothAbs(undefined, this._x, this._y, this._x2, this._y2);
            };
            Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype, "x2", { get: function get() {
                    return this._x2;
                }, set: function set(x2) {
                    this._x2 = x2;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype, "y2", { get: function get() {
                    return this._y2;
                }, set: function set(y2) {
                    this._y2 = y2;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegCurvetoCubicSmoothRel = function (owningPathSegList, x, y, x2, y2) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL, "s", owningPathSegList);
                this._x = x;
                this._y = y;
                this._x2 = x2;
                this._y2 = y2;
            };
            SVGPathSegCurvetoCubicSmoothRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegCurvetoCubicSmoothRel.prototype.toString = function () {
                return "[object SVGPathSegCurvetoCubicSmoothRel]";
            };
            SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x2 + " " + this._y2 + " " + this._x + " " + this._y;
            };
            SVGPathSegCurvetoCubicSmoothRel.prototype.clone = function () {
                return new SVGPathSegCurvetoCubicSmoothRel(undefined, this._x, this._y, this._x2, this._y2);
            };
            Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype, "x2", { get: function get() {
                    return this._x2;
                }, set: function set(x2) {
                    this._x2 = x2;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype, "y2", { get: function get() {
                    return this._y2;
                }, set: function set(y2) {
                    this._y2 = y2;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegCurvetoQuadraticSmoothAbs = function (owningPathSegList, x, y) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS, "T", owningPathSegList);
                this._x = x;
                this._y = y;
            };
            SVGPathSegCurvetoQuadraticSmoothAbs.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString = function () {
                return "[object SVGPathSegCurvetoQuadraticSmoothAbs]";
            };
            SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x + " " + this._y;
            };
            SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone = function () {
                return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined, this._x, this._y);
            };
            Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });

            window.SVGPathSegCurvetoQuadraticSmoothRel = function (owningPathSegList, x, y) {
                SVGPathSeg.call(this, SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL, "t", owningPathSegList);
                this._x = x;
                this._y = y;
            };
            SVGPathSegCurvetoQuadraticSmoothRel.prototype = Object.create(SVGPathSeg.prototype);
            SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString = function () {
                return "[object SVGPathSegCurvetoQuadraticSmoothRel]";
            };
            SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString = function () {
                return this.pathSegTypeAsLetter + " " + this._x + " " + this._y;
            };
            SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone = function () {
                return new SVGPathSegCurvetoQuadraticSmoothRel(undefined, this._x, this._y);
            };
            Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype, "x", { get: function get() {
                    return this._x;
                }, set: function set(x) {
                    this._x = x;this._segmentChanged();
                }, enumerable: true });
            Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype, "y", { get: function get() {
                    return this._y;
                }, set: function set(y) {
                    this._y = y;this._segmentChanged();
                }, enumerable: true });

            // Add createSVGPathSeg* functions to SVGPathElement.
            // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathElement.
            SVGPathElement.prototype.createSVGPathSegClosePath = function () {
                return new SVGPathSegClosePath(undefined);
            };
            SVGPathElement.prototype.createSVGPathSegMovetoAbs = function (x, y) {
                return new SVGPathSegMovetoAbs(undefined, x, y);
            };
            SVGPathElement.prototype.createSVGPathSegMovetoRel = function (x, y) {
                return new SVGPathSegMovetoRel(undefined, x, y);
            };
            SVGPathElement.prototype.createSVGPathSegLinetoAbs = function (x, y) {
                return new SVGPathSegLinetoAbs(undefined, x, y);
            };
            SVGPathElement.prototype.createSVGPathSegLinetoRel = function (x, y) {
                return new SVGPathSegLinetoRel(undefined, x, y);
            };
            SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs = function (x, y, x1, y1, x2, y2) {
                return new SVGPathSegCurvetoCubicAbs(undefined, x, y, x1, y1, x2, y2);
            };
            SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel = function (x, y, x1, y1, x2, y2) {
                return new SVGPathSegCurvetoCubicRel(undefined, x, y, x1, y1, x2, y2);
            };
            SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs = function (x, y, x1, y1) {
                return new SVGPathSegCurvetoQuadraticAbs(undefined, x, y, x1, y1);
            };
            SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel = function (x, y, x1, y1) {
                return new SVGPathSegCurvetoQuadraticRel(undefined, x, y, x1, y1);
            };
            SVGPathElement.prototype.createSVGPathSegArcAbs = function (x, y, r1, r2, angle, largeArcFlag, sweepFlag) {
                return new SVGPathSegArcAbs(undefined, x, y, r1, r2, angle, largeArcFlag, sweepFlag);
            };
            SVGPathElement.prototype.createSVGPathSegArcRel = function (x, y, r1, r2, angle, largeArcFlag, sweepFlag) {
                return new SVGPathSegArcRel(undefined, x, y, r1, r2, angle, largeArcFlag, sweepFlag);
            };
            SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs = function (x) {
                return new SVGPathSegLinetoHorizontalAbs(undefined, x);
            };
            SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel = function (x) {
                return new SVGPathSegLinetoHorizontalRel(undefined, x);
            };
            SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs = function (y) {
                return new SVGPathSegLinetoVerticalAbs(undefined, y);
            };
            SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel = function (y) {
                return new SVGPathSegLinetoVerticalRel(undefined, y);
            };
            SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs = function (x, y, x2, y2) {
                return new SVGPathSegCurvetoCubicSmoothAbs(undefined, x, y, x2, y2);
            };
            SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel = function (x, y, x2, y2) {
                return new SVGPathSegCurvetoCubicSmoothRel(undefined, x, y, x2, y2);
            };
            SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs = function (x, y) {
                return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined, x, y);
            };
            SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel = function (x, y) {
                return new SVGPathSegCurvetoQuadraticSmoothRel(undefined, x, y);
            };
        }

        if (!("SVGPathSegList" in window)) {
            // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathSegList
            window.SVGPathSegList = function (pathElement) {
                this._pathElement = pathElement;
                this._list = this._parsePath(this._pathElement.getAttribute("d"));

                // Use a MutationObserver to catch changes to the path's "d" attribute.
                this._mutationObserverConfig = { "attributes": true, "attributeFilter": ["d"] };
                this._pathElementMutationObserver = new MutationObserver(this._updateListFromPathMutations.bind(this));
                this._pathElementMutationObserver.observe(this._pathElement, this._mutationObserverConfig);
            };

            Object.defineProperty(SVGPathSegList.prototype, "numberOfItems", {
                get: function get() {
                    this._checkPathSynchronizedToList();
                    return this._list.length;
                },
                enumerable: true
            });

            // Add the pathSegList accessors to SVGPathElement.
            // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGAnimatedPathData
            Object.defineProperty(SVGPathElement.prototype, "pathSegList", {
                get: function get() {
                    if (!this._pathSegList) this._pathSegList = new SVGPathSegList(this);
                    return this._pathSegList;
                },
                enumerable: true
            });
            // FIXME: The following are not implemented and simply return SVGPathElement.pathSegList.
            Object.defineProperty(SVGPathElement.prototype, "normalizedPathSegList", { get: function get() {
                    return this.pathSegList;
                }, enumerable: true });
            Object.defineProperty(SVGPathElement.prototype, "animatedPathSegList", { get: function get() {
                    return this.pathSegList;
                }, enumerable: true });
            Object.defineProperty(SVGPathElement.prototype, "animatedNormalizedPathSegList", { get: function get() {
                    return this.pathSegList;
                }, enumerable: true });

            // Process any pending mutations to the path element and update the list as needed.
            // This should be the first call of all public functions and is needed because
            // MutationObservers are not synchronous so we can have pending asynchronous mutations.
            SVGPathSegList.prototype._checkPathSynchronizedToList = function () {
                this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords());
            };

            SVGPathSegList.prototype._updateListFromPathMutations = function (mutationRecords) {
                if (!this._pathElement) return;
                var hasPathMutations = false;
                mutationRecords.forEach(function (record) {
                    if (record.attributeName == "d") hasPathMutations = true;
                });
                if (hasPathMutations) this._list = this._parsePath(this._pathElement.getAttribute("d"));
            };

            // Serialize the list and update the path's 'd' attribute.
            SVGPathSegList.prototype._writeListToPath = function () {
                this._pathElementMutationObserver.disconnect();
                this._pathElement.setAttribute("d", SVGPathSegList._pathSegArrayAsString(this._list));
                this._pathElementMutationObserver.observe(this._pathElement, this._mutationObserverConfig);
            };

            // When a path segment changes the list needs to be synchronized back to the path element.
            SVGPathSegList.prototype.segmentChanged = function (pathSeg) {
                this._writeListToPath();
            };

            SVGPathSegList.prototype.clear = function () {
                this._checkPathSynchronizedToList();

                this._list.forEach(function (pathSeg) {
                    pathSeg._owningPathSegList = null;
                });
                this._list = [];
                this._writeListToPath();
            };

            SVGPathSegList.prototype.initialize = function (newItem) {
                this._checkPathSynchronizedToList();

                this._list = [newItem];
                newItem._owningPathSegList = this;
                this._writeListToPath();
                return newItem;
            };

            SVGPathSegList.prototype._checkValidIndex = function (index) {
                if (isNaN(index) || index < 0 || index >= this.numberOfItems) throw "INDEX_SIZE_ERR";
            };

            SVGPathSegList.prototype.getItem = function (index) {
                this._checkPathSynchronizedToList();

                this._checkValidIndex(index);
                return this._list[index];
            };

            SVGPathSegList.prototype.insertItemBefore = function (newItem, index) {
                this._checkPathSynchronizedToList();

                // Spec: If the index is greater than or equal to numberOfItems, then the new item is appended to the end of the list.
                if (index > this.numberOfItems) index = this.numberOfItems;
                if (newItem._owningPathSegList) {
                    // SVG2 spec says to make a copy.
                    newItem = newItem.clone();
                }
                this._list.splice(index, 0, newItem);
                newItem._owningPathSegList = this;
                this._writeListToPath();
                return newItem;
            };

            SVGPathSegList.prototype.replaceItem = function (newItem, index) {
                this._checkPathSynchronizedToList();

                if (newItem._owningPathSegList) {
                    // SVG2 spec says to make a copy.
                    newItem = newItem.clone();
                }
                this._checkValidIndex(index);
                this._list[index] = newItem;
                newItem._owningPathSegList = this;
                this._writeListToPath();
                return newItem;
            };

            SVGPathSegList.prototype.removeItem = function (index) {
                this._checkPathSynchronizedToList();

                this._checkValidIndex(index);
                var item = this._list[index];
                this._list.splice(index, 1);
                this._writeListToPath();
                return item;
            };

            SVGPathSegList.prototype.appendItem = function (newItem) {
                this._checkPathSynchronizedToList();

                if (newItem._owningPathSegList) {
                    // SVG2 spec says to make a copy.
                    newItem = newItem.clone();
                }
                this._list.push(newItem);
                newItem._owningPathSegList = this;
                // TODO: Optimize this to just append to the existing attribute.
                this._writeListToPath();
                return newItem;
            };

            SVGPathSegList._pathSegArrayAsString = function (pathSegArray) {
                var string = "";
                var first = true;
                pathSegArray.forEach(function (pathSeg) {
                    if (first) {
                        first = false;
                        string += pathSeg._asPathString();
                    } else {
                        string += " " + pathSeg._asPathString();
                    }
                });
                return string;
            };

            // This closely follows SVGPathParser::parsePath from Source/core/svg/SVGPathParser.cpp.
            SVGPathSegList.prototype._parsePath = function (string) {
                if (!string || string.length == 0) return [];

                var owningPathSegList = this;

                var Builder = function Builder() {
                    this.pathSegList = [];
                };

                Builder.prototype.appendSegment = function (pathSeg) {
                    this.pathSegList.push(pathSeg);
                };

                var Source = function Source(string) {
                    this._string = string;
                    this._currentIndex = 0;
                    this._endIndex = this._string.length;
                    this._previousCommand = SVGPathSeg.PATHSEG_UNKNOWN;

                    this._skipOptionalSpaces();
                };

                Source.prototype._isCurrentSpace = function () {
                    var character = this._string[this._currentIndex];
                    return character <= " " && (character == " " || character == "\n" || character == "\t" || character == "\r" || character == "\f");
                };

                Source.prototype._skipOptionalSpaces = function () {
                    while (this._currentIndex < this._endIndex && this._isCurrentSpace()) {
                        this._currentIndex++;
                    }return this._currentIndex < this._endIndex;
                };

                Source.prototype._skipOptionalSpacesOrDelimiter = function () {
                    if (this._currentIndex < this._endIndex && !this._isCurrentSpace() && this._string.charAt(this._currentIndex) != ",") return false;
                    if (this._skipOptionalSpaces()) {
                        if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) == ",") {
                            this._currentIndex++;
                            this._skipOptionalSpaces();
                        }
                    }
                    return this._currentIndex < this._endIndex;
                };

                Source.prototype.hasMoreData = function () {
                    return this._currentIndex < this._endIndex;
                };

                Source.prototype.peekSegmentType = function () {
                    var lookahead = this._string[this._currentIndex];
                    return this._pathSegTypeFromChar(lookahead);
                };

                Source.prototype._pathSegTypeFromChar = function (lookahead) {
                    switch (lookahead) {
                        case "Z":
                        case "z":
                            return SVGPathSeg.PATHSEG_CLOSEPATH;
                        case "M":
                            return SVGPathSeg.PATHSEG_MOVETO_ABS;
                        case "m":
                            return SVGPathSeg.PATHSEG_MOVETO_REL;
                        case "L":
                            return SVGPathSeg.PATHSEG_LINETO_ABS;
                        case "l":
                            return SVGPathSeg.PATHSEG_LINETO_REL;
                        case "C":
                            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;
                        case "c":
                            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;
                        case "Q":
                            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;
                        case "q":
                            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;
                        case "A":
                            return SVGPathSeg.PATHSEG_ARC_ABS;
                        case "a":
                            return SVGPathSeg.PATHSEG_ARC_REL;
                        case "H":
                            return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;
                        case "h":
                            return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;
                        case "V":
                            return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;
                        case "v":
                            return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;
                        case "S":
                            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;
                        case "s":
                            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;
                        case "T":
                            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;
                        case "t":
                            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;
                        default:
                            return SVGPathSeg.PATHSEG_UNKNOWN;
                    }
                };

                Source.prototype._nextCommandHelper = function (lookahead, previousCommand) {
                    // Check for remaining coordinates in the current command.
                    if ((lookahead == "+" || lookahead == "-" || lookahead == "." || lookahead >= "0" && lookahead <= "9") && previousCommand != SVGPathSeg.PATHSEG_CLOSEPATH) {
                        if (previousCommand == SVGPathSeg.PATHSEG_MOVETO_ABS) return SVGPathSeg.PATHSEG_LINETO_ABS;
                        if (previousCommand == SVGPathSeg.PATHSEG_MOVETO_REL) return SVGPathSeg.PATHSEG_LINETO_REL;
                        return previousCommand;
                    }
                    return SVGPathSeg.PATHSEG_UNKNOWN;
                };

                Source.prototype.initialCommandIsMoveTo = function () {
                    // If the path is empty it is still valid, so return true.
                    if (!this.hasMoreData()) return true;
                    var command = this.peekSegmentType();
                    // Path must start with moveTo.
                    return command == SVGPathSeg.PATHSEG_MOVETO_ABS || command == SVGPathSeg.PATHSEG_MOVETO_REL;
                };

                // Parse a number from an SVG path. This very closely follows genericParseNumber(...) from Source/core/svg/SVGParserUtilities.cpp.
                // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-PathDataBNF
                Source.prototype._parseNumber = function () {
                    var exponent = 0;
                    var integer = 0;
                    var frac = 1;
                    var decimal = 0;
                    var sign = 1;
                    var expsign = 1;

                    var startIndex = this._currentIndex;

                    this._skipOptionalSpaces();

                    // Read the sign.
                    if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) == "+") this._currentIndex++;else if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) == "-") {
                        this._currentIndex++;
                        sign = -1;
                    }

                    if (this._currentIndex == this._endIndex || (this._string.charAt(this._currentIndex) < "0" || this._string.charAt(this._currentIndex) > "9") && this._string.charAt(this._currentIndex) != ".")
                        // The first character of a number must be one of [0-9+-.].
                        return undefined;

                    // Read the integer part, build right-to-left.
                    var startIntPartIndex = this._currentIndex;
                    while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= "0" && this._string.charAt(this._currentIndex) <= "9") {
                        this._currentIndex++;
                    } // Advance to first non-digit.

                    if (this._currentIndex != startIntPartIndex) {
                        var scanIntPartIndex = this._currentIndex - 1;
                        var multiplier = 1;
                        while (scanIntPartIndex >= startIntPartIndex) {
                            integer += multiplier * (this._string.charAt(scanIntPartIndex--) - "0");
                            multiplier *= 10;
                        }
                    }

                    // Read the decimals.
                    if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) == ".") {
                        this._currentIndex++;

                        // There must be a least one digit following the .
                        if (this._currentIndex >= this._endIndex || this._string.charAt(this._currentIndex) < "0" || this._string.charAt(this._currentIndex) > "9") return undefined;
                        while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= "0" && this._string.charAt(this._currentIndex) <= "9") {
                            decimal += (this._string.charAt(this._currentIndex++) - "0") * (frac *= 0.1);
                        }
                    }

                    // Read the exponent part.
                    if (this._currentIndex != startIndex && this._currentIndex + 1 < this._endIndex && (this._string.charAt(this._currentIndex) == "e" || this._string.charAt(this._currentIndex) == "E") && this._string.charAt(this._currentIndex + 1) != "x" && this._string.charAt(this._currentIndex + 1) != "m") {
                        this._currentIndex++;

                        // Read the sign of the exponent.
                        if (this._string.charAt(this._currentIndex) == "+") {
                            this._currentIndex++;
                        } else if (this._string.charAt(this._currentIndex) == "-") {
                            this._currentIndex++;
                            expsign = -1;
                        }

                        // There must be an exponent.
                        if (this._currentIndex >= this._endIndex || this._string.charAt(this._currentIndex) < "0" || this._string.charAt(this._currentIndex) > "9") return undefined;

                        while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= "0" && this._string.charAt(this._currentIndex) <= "9") {
                            exponent *= 10;
                            exponent += this._string.charAt(this._currentIndex) - "0";
                            this._currentIndex++;
                        }
                    }

                    var number = integer + decimal;
                    number *= sign;

                    if (exponent) number *= Math.pow(10, expsign * exponent);

                    if (startIndex == this._currentIndex) return undefined;

                    this._skipOptionalSpacesOrDelimiter();

                    return number;
                };

                Source.prototype._parseArcFlag = function () {
                    if (this._currentIndex >= this._endIndex) return undefined;
                    var flag = false;
                    var flagChar = this._string.charAt(this._currentIndex++);
                    if (flagChar == "0") flag = false;else if (flagChar == "1") flag = true;else return undefined;

                    this._skipOptionalSpacesOrDelimiter();
                    return flag;
                };

                Source.prototype.parseSegment = function () {
                    var lookahead = this._string[this._currentIndex];
                    var command = this._pathSegTypeFromChar(lookahead);
                    if (command == SVGPathSeg.PATHSEG_UNKNOWN) {
                        // Possibly an implicit command. Not allowed if this is the first command.
                        if (this._previousCommand == SVGPathSeg.PATHSEG_UNKNOWN) return null;
                        command = this._nextCommandHelper(lookahead, this._previousCommand);
                        if (command == SVGPathSeg.PATHSEG_UNKNOWN) return null;
                    } else {
                        this._currentIndex++;
                    }

                    this._previousCommand = command;

                    switch (command) {
                        case SVGPathSeg.PATHSEG_MOVETO_REL:
                            return new SVGPathSegMovetoRel(owningPathSegList, this._parseNumber(), this._parseNumber());
                        case SVGPathSeg.PATHSEG_MOVETO_ABS:
                            return new SVGPathSegMovetoAbs(owningPathSegList, this._parseNumber(), this._parseNumber());
                        case SVGPathSeg.PATHSEG_LINETO_REL:
                            return new SVGPathSegLinetoRel(owningPathSegList, this._parseNumber(), this._parseNumber());
                        case SVGPathSeg.PATHSEG_LINETO_ABS:
                            return new SVGPathSegLinetoAbs(owningPathSegList, this._parseNumber(), this._parseNumber());
                        case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:
                            return new SVGPathSegLinetoHorizontalRel(owningPathSegList, this._parseNumber());
                        case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:
                            return new SVGPathSegLinetoHorizontalAbs(owningPathSegList, this._parseNumber());
                        case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:
                            return new SVGPathSegLinetoVerticalRel(owningPathSegList, this._parseNumber());
                        case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:
                            return new SVGPathSegLinetoVerticalAbs(owningPathSegList, this._parseNumber());
                        case SVGPathSeg.PATHSEG_CLOSEPATH:
                            this._skipOptionalSpaces();
                            return new SVGPathSegClosePath(owningPathSegList);
                        case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:
                            var points = { x1: this._parseNumber(), y1: this._parseNumber(), x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber() };
                            return new SVGPathSegCurvetoCubicRel(owningPathSegList, points.x, points.y, points.x1, points.y1, points.x2, points.y2);
                        case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:
                            var points = { x1: this._parseNumber(), y1: this._parseNumber(), x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber() };
                            return new SVGPathSegCurvetoCubicAbs(owningPathSegList, points.x, points.y, points.x1, points.y1, points.x2, points.y2);
                        case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:
                            var points = { x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber() };
                            return new SVGPathSegCurvetoCubicSmoothRel(owningPathSegList, points.x, points.y, points.x2, points.y2);
                        case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:
                            var points = { x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber() };
                            return new SVGPathSegCurvetoCubicSmoothAbs(owningPathSegList, points.x, points.y, points.x2, points.y2);
                        case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:
                            var points = { x1: this._parseNumber(), y1: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber() };
                            return new SVGPathSegCurvetoQuadraticRel(owningPathSegList, points.x, points.y, points.x1, points.y1);
                        case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:
                            var points = { x1: this._parseNumber(), y1: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber() };
                            return new SVGPathSegCurvetoQuadraticAbs(owningPathSegList, points.x, points.y, points.x1, points.y1);
                        case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:
                            return new SVGPathSegCurvetoQuadraticSmoothRel(owningPathSegList, this._parseNumber(), this._parseNumber());
                        case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:
                            return new SVGPathSegCurvetoQuadraticSmoothAbs(owningPathSegList, this._parseNumber(), this._parseNumber());
                        case SVGPathSeg.PATHSEG_ARC_REL:
                            var points = { x1: this._parseNumber(), y1: this._parseNumber(), arcAngle: this._parseNumber(), arcLarge: this._parseArcFlag(), arcSweep: this._parseArcFlag(), x: this._parseNumber(), y: this._parseNumber() };
                            return new SVGPathSegArcRel(owningPathSegList, points.x, points.y, points.x1, points.y1, points.arcAngle, points.arcLarge, points.arcSweep);
                        case SVGPathSeg.PATHSEG_ARC_ABS:
                            var points = { x1: this._parseNumber(), y1: this._parseNumber(), arcAngle: this._parseNumber(), arcLarge: this._parseArcFlag(), arcSweep: this._parseArcFlag(), x: this._parseNumber(), y: this._parseNumber() };
                            return new SVGPathSegArcAbs(owningPathSegList, points.x, points.y, points.x1, points.y1, points.arcAngle, points.arcLarge, points.arcSweep);
                        default:
                            throw "Unknown path seg type.";
                    }
                };

                var builder = new Builder();
                var source = new Source(string);

                if (!source.initialCommandIsMoveTo()) return [];
                while (source.hasMoreData()) {
                    var pathSeg = source.parseSegment();
                    if (!pathSeg) return [];
                    builder.appendSegment(pathSeg);
                }

                return builder.pathSegList;
            };
        }
    })();

    /* jshint ignore:end */

    if (typeof define === 'function' && define.amd) {
        define("c3", ["d3"], function () {
            return c3;
        });
    } else if ('undefined' !== typeof exports && 'undefined' !== typeof module) {
        module.exports = c3;
    } else {
        window.c3 = c3;
    }
})(window);
'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/*
 * jQuery liMarquee v 4.6
 *
 * Copyright 2013, Linnik Yura | LI MASS CODE | http://masscode.ru
 * http://masscode.ru/index.php/k2/item/44-limarquee
 * Free to use
 *
 * Last Update 20.11.2014
 */
(function ($) {
	var methods = {
		init: function init(options) {
			var p = {
				direction: 'left', //Указывает направление движения содержимого контейнера (left | right | up | down)
				loop: -1, //Задает, сколько раз будет прокручиваться содержимое. "-1" для бесконечного воспроизведения движения
				scrolldelay: 0, //Величина задержки в миллисекундах между движениями
				scrollamount: 50, //Скорость движения контента (px/sec)
				circular: true, //Если "true" - строка непрерывная 
				drag: true, //Если "true" - включено перетаскивание строки
				runshort: true, //Если "true" - короткая строка тоже "бегает", "false" - стоит на месте
				hoverstop: true, //true - строка останавливается при наведении курсора мыши, false - строка не останавливается
				inverthover: false, //false - стандартное поведение. Если "true" - строка начинает движение только при наведении курсора
				xml: false //Путь к xml файлу с нужным текстом
			};
			if (options) {
				$.extend(p, options);
			}

			return this.each(function () {
				var enterEvent = 'mouseenter';
				var leaveEvent = 'mouseleave';
				if (p.inverthover) {
					enterEvent = 'mouseleave';
					leaveEvent = 'mouseenter';
				}

				var loop = p.loop,
				    strWrap = $(this).addClass('str_wrap').data({ scrollamount: p.scrollamount }),
				    fMove = false;

				var strWrapStyle = strWrap.attr('style');

				if (strWrapStyle) {
					var wrapStyleArr = strWrapStyle.split(';');
					var startHeight = false;
					for (var i = 0; i < wrapStyleArr.length; i++) {
						var str = $.trim(wrapStyleArr[i]);
						var tested = str.search(/^height/g);
						if (tested != -1) {
							startHeight = parseFloat(strWrap.css('height'));
						}
					}
				}

				var code = function code() {

					strWrap.off('mouseleave');
					strWrap.off('mouseenter');
					strWrap.off('mousemove');
					strWrap.off('mousedown');
					strWrap.off('mouseup');

					if (!$('.str_move', strWrap).length) {
						strWrap.wrapInner($('<div>').addClass('str_move'));
					}

					var strMove = $('.str_move', strWrap).addClass('str_origin'),
					    strMoveClone = strMove.clone().removeClass('str_origin').addClass('str_move_clone'),
					    time = 0;

					if (!p.hoverstop) {
						strWrap.addClass('noStop');
					}

					var circCloneHor = function circCloneHor() {
						strMoveClone.clone().css({
							left: '100%',
							right: 'auto',
							width: strMove.width()
						}).appendTo(strMove);
						strMoveClone.css({
							right: '100%',
							left: 'auto',
							width: strMove.width()
						}).appendTo(strMove);
					};

					var circCloneVert = function circCloneVert() {
						strMoveClone.clone().css({
							top: '100%',
							bottom: 'auto',
							height: strMove.height()
						}).appendTo(strMove);
						strMoveClone.css({
							bottom: '100%',
							top: 'auto',
							height: strMove.height()
						}).appendTo(strMove);
					};

					if (p.direction == 'left') {
						strWrap.height(strMove.outerHeight());
						if (strMove.width() > strWrap.width()) {
							var leftPos = -strMove.width();

							if (p.circular) {

								if (!p.xml) {
									circCloneHor();
									leftPos = -(strMove.width() + (strMove.width() - strWrap.width()));
								}
							}
							if (p.xml) {
								strMove.css({
									left: strWrap.width()
								});
							}
							var strMoveLeft = strWrap.width(),
							    k1 = 0,
							    timeFunc1 = function timeFunc1() {
								var fullS = Math.abs(leftPos),
								    time = fullS / strWrap.data('scrollamount') * 1000;
								if (parseFloat(strMove.css('left')) != 0) {
									fullS = fullS + strWrap.width();
									time = (fullS - (strWrap.width() - parseFloat(strMove.css('left')))) / strWrap.data('scrollamount') * 1000;
								}
								return time;
							},
							    moveFuncId1 = false,
							    moveFunc1 = function moveFunc1() {
								if (loop != 0) {
									strMove.stop(true).animate({
										left: leftPos
									}, timeFunc1(), 'linear', function () {
										$(this).css({
											left: strWrap.width()
										});
										if (loop == -1) {
											moveFuncId1 = setTimeout(moveFunc1, p.scrolldelay);
										} else {
											loop--;
											moveFuncId1 = setTimeout(moveFunc1, p.scrolldelay);
										}
									});
								}
							};
							strWrap.data({
								moveId: moveFuncId1,
								moveF: moveFunc1
							});
							if (!p.inverthover) {
								moveFunc1();
							}

							if (p.hoverstop) {
								strWrap.on(enterEvent, function () {
									$(this).addClass('str_active');
									clearTimeout(moveFuncId1);
									strMove.stop(true);
								}).on(leaveEvent, function () {
									$(this).removeClass('str_active');
									$(this).off('mousemove');
									moveFunc1();
								});

								if (p.drag) {
									strWrap.on('mousedown', function (e) {
										if (p.inverthover) {
											strMove.stop(true);
										}
										//drag
										var dragLeft;
										var dir = 1;
										var newX;
										var oldX = e.clientX;
										//drag

										strMoveLeft = strMove.position().left;
										k1 = strMoveLeft - (e.clientX - strWrap.offset().left);

										$(this).on('mousemove', function (e) {
											fMove = true;

											//drag
											newX = e.clientX;
											if (newX > oldX) {
												dir = 1;
											} else {
												dir = -1;
											}
											oldX = newX;
											dragLeft = k1 + (e.clientX - strWrap.offset().left);

											if (!p.circular) {
												if (dragLeft < -strMove.width() && dir < 0) {
													dragLeft = strWrap.width();
													strMoveLeft = strMove.position().left;
													k1 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
												if (dragLeft > strWrap.width() && dir > 0) {
													dragLeft = -strMove.width();
													strMoveLeft = strMove.position().left;
													k1 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
											} else {
												if (dragLeft < -strMove.width() && dir < 0) {
													dragLeft = 0;
													strMoveLeft = strMove.position().left;
													k1 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
												if (dragLeft > 0 && dir > 0) {
													dragLeft = -strMove.width();
													strMoveLeft = strMove.position().left;
													k1 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
											}

											strMove.stop(true).css({
												left: dragLeft
											});
											//drag

										}).on('mouseup', function () {
											$(this).off('mousemove');
											if (p.inverthover) {
												strMove.trigger('mouseenter');
											}
											setTimeout(function () {
												fMove = false;
											}, 50);
										});
										return false;
									}).on('click', function () {
										if (fMove) {
											return false;
										}
									});
								} else {
									strWrap.addClass('no_drag');
								};
							}
						} else {
							if (p.runshort) {
								strMove.css({
									left: strWrap.width()
								});
								var strMoveLeft = strWrap.width(),
								    k1 = 0,
								    timeFunc = function timeFunc() {
									time = (strMove.width() + strMove.position().left) / strWrap.data('scrollamount') * 1000;
									return time;
								};
								var moveFunc = function moveFunc() {
									var leftPos = -strMove.width();
									strMove.animate({
										left: leftPos
									}, timeFunc(), 'linear', function () {
										$(this).css({
											left: strWrap.width()
										});
										if (loop == -1) {
											setTimeout(moveFunc, p.scrolldelay);
										} else {
											loop--;
											setTimeout(moveFunc, p.scrolldelay);
										}
									});
								};
								strWrap.data({
									moveF: moveFunc
								});
								if (!p.inverthover) {
									moveFunc();
								}
								if (p.hoverstop) {
									strWrap.on(enterEvent, function () {
										$(this).addClass('str_active');
										strMove.stop(true);
									}).on(leaveEvent, function () {
										$(this).removeClass('str_active');
										$(this).off('mousemove');
										moveFunc();
									});

									if (p.drag) {
										strWrap.on('mousedown', function (e) {
											if (p.inverthover) {
												strMove.stop(true);
											}

											//drag
											var dragLeft;
											var dir = 1;
											var newX;
											var oldX = e.clientX;
											//drag

											strMoveLeft = strMove.position().left;
											k1 = strMoveLeft - (e.clientX - strWrap.offset().left);
											$(this).on('mousemove', function (e) {
												fMove = true;

												//drag
												newX = e.clientX;
												if (newX > oldX) {
													dir = 1;
												} else {
													dir = -1;
												}
												oldX = newX;
												dragLeft = k1 + (e.clientX - strWrap.offset().left);

												if (dragLeft < -strMove.width() && dir < 0) {
													dragLeft = strWrap.width();
													strMoveLeft = strMove.position().left;
													k1 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
												if (dragLeft > strWrap.width() && dir > 0) {
													dragLeft = -strMove.width();
													strMoveLeft = strMove.position().left;
													k1 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}

												strMove.stop(true).css({
													left: dragLeft
												});
											}).on('mouseup', function () {
												if (p.inverthover) {
													strMove.trigger('mouseenter');
												}
												$(this).off('mousemove');
												setTimeout(function () {
													fMove = false;
												}, 50);
											});
											return false;
										}).on('click', function () {
											if (fMove) {
												return false;
											}
										});
									} else {
										strWrap.addClass('no_drag');
									};
								}
							} else {
								strWrap.addClass('str_static');
							}
						};
					};
					if (p.direction == 'right') {
						strWrap.height(strMove.outerHeight());
						strWrap.addClass('str_right');
						strMove.css({
							left: -strMove.width(),
							right: 'auto'
						});

						if (strMove.width() > strWrap.width()) {
							var leftPos = strWrap.width();
							strMove.css({
								left: 0
							});
							if (p.circular) {
								if (!p.xml) {
									circCloneHor();
									//Определяем крайнюю точку
									leftPos = strMove.width();
								}
							}

							var k2 = 0;
							timeFunc = function timeFunc() {
								var fullS = strWrap.width(),
								    //крайняя точка
								time = fullS / strWrap.data('scrollamount') * 1000; //время
								if (parseFloat(strMove.css('left')) != 0) {
									fullS = strMove.width() + strWrap.width();
									time = (fullS - (strMove.width() + parseFloat(strMove.css('left')))) / strWrap.data('scrollamount') * 1000;
								}
								return time;
							};
							var moveFunc = function moveFunc() {

								if (loop != 0) {
									strMove.animate({
										left: leftPos
									}, timeFunc(), 'linear', function () {
										$(this).css({
											left: -strMove.width()
										});
										if (loop == -1) {
											setTimeout(moveFunc, p.scrolldelay);
										} else {
											loop--;
											setTimeout(moveFunc, p.scrolldelay);
										};
									});
								};
							};
							strWrap.data({
								moveF: moveFunc
							});

							if (!p.inverthover) {
								moveFunc();
							}
							if (p.hoverstop) {
								strWrap.on(enterEvent, function () {
									$(this).addClass('str_active');
									strMove.stop(true);
								}).on(leaveEvent, function () {
									$(this).removeClass('str_active');
									$(this).off('mousemove');
									moveFunc();
								});

								if (p.drag) {

									strWrap.on('mousedown', function (e) {
										if (p.inverthover) {
											strMove.stop(true);
										}

										//drag
										var dragLeft;
										var dir = 1;
										var newX;
										var oldX = e.clientX;
										//drag

										strMoveLeft = strMove.position().left;
										k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
										$(this).on('mousemove', function (e) {

											fMove = true;

											//drag
											newX = e.clientX;
											if (newX > oldX) {
												dir = 1;
											} else {
												dir = -1;
											}
											oldX = newX;
											dragLeft = k2 + (e.clientX - strWrap.offset().left);

											if (!p.circular) {

												if (dragLeft < -strMove.width() && dir < 0) {
													dragLeft = strWrap.width();
													strMoveLeft = strMove.position().left;
													k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
												if (dragLeft > strWrap.width() && dir > 0) {
													dragLeft = -strMove.width();
													strMoveLeft = strMove.position().left;
													k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
											} else {
												if (dragLeft < -strMove.width() && dir < 0) {
													dragLeft = 0;
													strMoveLeft = strMove.position().left;
													k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
												if (dragLeft > 0 && dir > 0) {
													dragLeft = -strMove.width();
													strMoveLeft = strMove.position().left;
													k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
											}

											strMove.stop(true).css({
												left: dragLeft
											});
										}).on('mouseup', function () {
											if (p.inverthover) {
												strMove.trigger('mouseenter');
											}
											$(this).off('mousemove');
											setTimeout(function () {
												fMove = false;
											}, 50);
										});
										return false;
									}).on('click', function () {
										if (fMove) {
											return false;
										}
									});
								} else {
									strWrap.addClass('no_drag');
								};
							}
						} else {

							if (p.runshort) {

								var k2 = 0;
								var timeFunc = function timeFunc() {
									time = (strWrap.width() - strMove.position().left) / strWrap.data('scrollamount') * 1000;
									return time;
								};
								var moveFunc = function moveFunc() {
									var leftPos = strWrap.width();
									strMove.animate({
										left: leftPos
									}, timeFunc(), 'linear', function () {
										$(this).css({
											left: -strMove.width()
										});
										if (loop == -1) {
											setTimeout(moveFunc, p.scrolldelay);
										} else {
											loop--;
											setTimeout(moveFunc, p.scrolldelay);
										};
									});
								};

								strWrap.data({
									moveF: moveFunc
								});

								if (!p.inverthover) {
									moveFunc();
								}
								if (p.hoverstop) {
									strWrap.on(enterEvent, function () {
										$(this).addClass('str_active');
										strMove.stop(true);
									}).on(leaveEvent, function () {
										$(this).removeClass('str_active');
										$(this).off('mousemove');
										moveFunc();
									});

									if (p.drag) {
										strWrap.on('mousedown', function (e) {
											if (p.inverthover) {
												strMove.stop(true);
											}

											//drag
											var dragLeft;
											var dir = 1;
											var newX;
											var oldX = e.clientX;
											//drag

											strMoveLeft = strMove.position().left;
											k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
											$(this).on('mousemove', function (e) {
												fMove = true;

												//drag
												newX = e.clientX;
												if (newX > oldX) {
													dir = 1;
												} else {
													dir = -1;
												}
												oldX = newX;
												dragLeft = k2 + (e.clientX - strWrap.offset().left);

												if (dragLeft < -strMove.width() && dir < 0) {
													dragLeft = strWrap.width();
													strMoveLeft = strMove.position().left;
													k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}
												if (dragLeft > strWrap.width() && dir > 0) {
													dragLeft = -strMove.width();
													strMoveLeft = strMove.position().left;
													k2 = strMoveLeft - (e.clientX - strWrap.offset().left);
												}

												strMove.stop(true).css({
													left: dragLeft
												});
											}).on('mouseup', function () {
												if (p.inverthover) {
													strMove.trigger('mouseenter');
												}
												$(this).off('mousemove');
												setTimeout(function () {
													fMove = false;
												}, 50);
											});
											return false;
										}).on('click', function () {
											if (fMove) {
												return false;
											}
										});
									} else {
										strWrap.addClass('no_drag');
									};
								}
							} else {
								strWrap.addClass('str_static');
							}
						};
					};
					if (p.direction == 'up') {
						strWrap.addClass('str_vertical');

						if (strMove.height() > strWrap.height()) {
							var topPos = -strMove.height();
							if (p.circular) {
								if (!p.xml) {
									circCloneVert();
									topPos = -(strMove.height() + (strMove.height() - strWrap.height()));
								}
							}
							if (p.xml) {
								strMove.css({
									top: strWrap.height()
								});
							}
							var k2 = 0;
							timeFunc = function timeFunc() {
								var fullS = Math.abs(topPos),
								    time = fullS / strWrap.data('scrollamount') * 1000;
								if (parseFloat(strMove.css('top')) != 0) {
									fullS = fullS + strWrap.height();
									time = (fullS - (strWrap.height() - parseFloat(strMove.css('top')))) / strWrap.data('scrollamount') * 1000;
								}

								return time;
							};
							var moveFunc = function moveFunc() {
								if (loop != 0) {
									strMove.animate({
										top: topPos
									}, timeFunc(), 'linear', function () {
										$(this).css({
											top: strWrap.height()
										});
										if (loop == -1) {
											setTimeout(moveFunc, p.scrolldelay);
										} else {
											loop--;
											setTimeout(moveFunc, p.scrolldelay);
										};
									});
								};
							};

							strWrap.data({
								moveF: moveFunc
							});

							if (!p.inverthover) {
								moveFunc();
							}
							if (p.hoverstop) {
								strWrap.on(enterEvent, function () {
									$(this).addClass('str_active');
									strMove.stop(true);
								}).on(leaveEvent, function () {
									$(this).removeClass('str_active');
									$(this).off('mousemove');
									moveFunc();
								});

								if (p.drag) {
									strWrap.on('mousedown', function (e) {
										if (p.inverthover) {
											strMove.stop(true);
										}

										//drag
										var dragTop;
										var dir = 1;
										var newY;
										var oldY = e.clientY;
										//drag


										strMoveTop = strMove.position().top;
										k2 = strMoveTop - (e.clientY - strWrap.offset().top);
										$(this).on('mousemove', function (e) {

											fMove = true;

											//drag
											newY = e.clientY;
											if (newY > oldY) {
												dir = 1;
											} else {
												if (newY < oldY) {
													dir = -1;
												}
											}
											oldY = newY;
											dragTop = k2 + e.clientY - strWrap.offset().top;

											if (!p.circular) {
												if (dragTop < -strMove.height() && dir < 0) {
													dragTop = strWrap.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
												if (dragTop > strWrap.height() && dir > 0) {
													dragTop = -strMove.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
											} else {
												if (dragTop < -strMove.height() && dir < 0) {
													dragTop = 0;
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
												if (dragTop > 0 && dir > 0) {
													dragTop = -strMove.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
											}

											strMove.stop(true).css({
												top: dragTop
											});
											//drag

										}).on('mouseup', function () {
											if (p.inverthover) {
												strMove.trigger('mouseenter');
											}
											$(this).off('mousemove');
											setTimeout(function () {
												fMove = false;
											}, 50);
										});
										return false;
									}).on('click', function () {
										if (fMove) {
											return false;
										}
									});
								} else {
									strWrap.addClass('no_drag');
								};
							}
						} else {
							if (p.runshort) {
								strMove.css({
									top: strWrap.height()
								});
								var k2 = 0;
								var timeFunc = function timeFunc() {

									time = (strMove.height() + strMove.position().top) / strWrap.data('scrollamount') * 1000;

									return time;
								};
								var moveFunc = function moveFunc() {
									var topPos = -strMove.height();
									strMove.animate({
										top: topPos
									}, timeFunc(), 'linear', function () {
										$(this).css({
											top: strWrap.height()
										});
										if (loop == -1) {
											setTimeout(moveFunc, p.scrolldelay);
										} else {
											loop--;
											setTimeout(moveFunc, p.scrolldelay);
										};
									});
								};
								strWrap.data({
									moveF: moveFunc
								});
								if (!p.inverthover) {
									moveFunc();
								}
								if (p.hoverstop) {
									strWrap.on(enterEvent, function () {
										$(this).addClass('str_active');
										strMove.stop(true);
									}).on(leaveEvent, function () {
										$(this).removeClass('str_active');
										$(this).off('mousemove');
										moveFunc();
									});

									if (p.drag) {
										strWrap.on('mousedown', function (e) {
											if (p.inverthover) {
												strMove.stop(true);
											}

											//drag
											var dragTop;
											var dir = 1;
											var newY;
											var oldY = e.clientY;
											//drag

											strMoveTop = strMove.position().top;
											k2 = strMoveTop - (e.clientY - strWrap.offset().top);
											$(this).on('mousemove', function (e) {

												fMove = true;

												//drag
												newY = e.clientY;
												if (newY > oldY) {
													dir = 1;
												} else {
													if (newY < oldY) {
														dir = -1;
													}
												}
												oldY = newY;
												dragTop = k2 + e.clientY - strWrap.offset().top;

												if (dragTop < -strMove.height() && dir < 0) {
													dragTop = strWrap.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
												if (dragTop > strWrap.height() && dir > 0) {
													dragTop = -strMove.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
												//*drag

												strMove.stop(true).css({
													top: dragTop
												});
											}).on('mouseup', function () {
												if (p.inverthover) {
													strMove.trigger('mouseenter');
												}
												$(this).off('mousemove');
												setTimeout(function () {
													fMove = false;
												}, 50);
											});
											return false;
										}).on('click', function () {
											if (fMove) {
												return false;
											}
										});
									} else {
										strWrap.addClass('no_drag');
									};
								}
							} else {
								strWrap.addClass('str_static');
							}
						};
					};
					if (p.direction == 'down') {

						strWrap.addClass('str_vertical').addClass('str_down');
						strMove.css({
							top: -strMove.height(),
							bottom: 'auto'
						});
						if (strMove.height() > strWrap.height()) {
							var topPos = strWrap.height();
							if (p.circular) {
								if (!p.xml) {
									circCloneVert();
									topPos = strMove.height();
								}
							}
							if (p.xml) {
								strMove.css({
									top: -strMove.height()
								});
							}
							var k2 = 0;
							timeFunc = function timeFunc() {
								var fullS = strWrap.height(),
								    //крайняя точка
								time = fullS / strWrap.data('scrollamount') * 1000; //время

								if (parseFloat(strMove.css('top')) != 0) {
									fullS = strMove.height() + strWrap.height();
									time = (fullS - (strMove.height() + parseFloat(strMove.css('top')))) / strWrap.data('scrollamount') * 1000;
								}
								return time;
							};
							var moveFunc = function moveFunc() {

								if (loop != 0) {
									strMove.animate({
										top: topPos
									}, timeFunc(), 'linear', function () {
										$(this).css({
											top: -strMove.height()
										});
										if (loop == -1) {

											setTimeout(moveFunc, p.scrolldelay);
										} else {
											loop--;
											setTimeout(moveFunc, p.scrolldelay);
										};
									});
								};
							};
							strWrap.data({
								moveF: moveFunc
							});
							if (!p.inverthover) {
								moveFunc();
							}
							if (p.hoverstop) {
								strWrap.on(enterEvent, function () {
									$(this).addClass('str_active');
									strMove.stop(true);
								}).on(leaveEvent, function () {
									$(this).removeClass('str_active');
									$(this).off('mousemove');
									moveFunc();
								});

								if (p.drag) {
									strWrap.on('mousedown', function (e) {
										if (p.inverthover) {
											strMove.stop(true);
										}

										//drag
										var dragTop;
										var dir = 1;
										var newY;
										var oldY = e.clientY;
										//drag


										strMoveTop = strMove.position().top;
										k2 = strMoveTop - (e.clientY - strWrap.offset().top);
										$(this).on('mousemove', function (e) {

											fMove = true;

											//drag
											newY = e.clientY;
											if (newY > oldY) {
												dir = 1;
											} else {
												if (newY < oldY) {
													dir = -1;
												}
											}
											oldY = newY;
											dragTop = k2 + e.clientY - strWrap.offset().top;

											if (!p.circular) {
												if (dragTop < -strMove.height() && dir < 0) {
													dragTop = strWrap.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
												if (dragTop > strWrap.height() && dir > 0) {
													dragTop = -strMove.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
											} else {
												if (dragTop < -strMove.height() && dir < 0) {
													dragTop = 0;
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
												if (dragTop > 0 && dir > 0) {
													dragTop = -strMove.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
											}

											strMove.stop(true).css({
												top: dragTop
											});
											//drag

										}).on('mouseup', function () {
											if (p.inverthover) {
												strMove.trigger('mouseenter');
											}
											$(this).off('mousemove');
											setTimeout(function () {
												fMove = false;
											}, 50);
										});
										return false;
									}).on('click', function () {
										if (fMove) {
											return false;
										}
									});
								} else {
									strWrap.addClass('no_drag');
								};
							}
						} else {
							if (p.runshort) {
								var k2 = 0;
								var timeFunc = function timeFunc() {
									time = (strWrap.height() - strMove.position().top) / strWrap.data('scrollamount') * 1000;
									return time;
								};
								var moveFunc = function moveFunc() {
									var topPos = strWrap.height();
									strMove.animate({
										top: topPos
									}, timeFunc(), 'linear', function () {
										$(this).css({
											top: -strMove.height()
										});
										if (loop == -1) {
											setTimeout(moveFunc, p.scrolldelay);
										} else {
											loop--;
											setTimeout(moveFunc, p.scrolldelay);
										};
									});
								};
								strWrap.data({
									moveF: moveFunc
								});
								if (!p.inverthover) {
									moveFunc();
								}
								if (p.hoverstop) {
									strWrap.on(enterEvent, function () {
										$(this).addClass('str_active');
										strMove.stop(true);
									}).on(leaveEvent, function () {
										$(this).removeClass('str_active');
										$(this).off('mousemove');
										moveFunc();
									});

									if (p.drag) {
										strWrap.on('mousedown', function (e) {
											if (p.inverthover) {
												strMove.stop(true);
											}

											//drag
											var dragTop;
											var dir = 1;
											var newY;
											var oldY = e.clientY;
											//drag

											strMoveTop = strMove.position().top;
											k2 = strMoveTop - (e.clientY - strWrap.offset().top);
											$(this).on('mousemove', function (e) {
												fMove = true;

												//drag
												newY = e.clientY;
												if (newY > oldY) {
													dir = 1;
												} else {
													if (newY < oldY) {
														dir = -1;
													}
												}
												oldY = newY;
												dragTop = k2 + e.clientY - strWrap.offset().top;

												if (dragTop < -strMove.height() && dir < 0) {
													dragTop = strWrap.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
												if (dragTop > strWrap.height() && dir > 0) {
													dragTop = -strMove.height();
													strMoveTop = strMove.position().top;
													k2 = strMoveTop - (e.clientY - strWrap.offset().top);
												}
												//*drag

												strMove.stop(true).css({
													top: dragTop
												});
											}).on('mouseup', function () {
												if (p.inverthover) {
													strMove.trigger('mouseenter');
												}
												$(this).off('mousemove');
												setTimeout(function () {
													fMove = false;
												}, 50);
											});
											return false;
										}).on('click', function () {
											if (fMove) {
												return false;
											}
										});
									} else {
										strWrap.addClass('no_drag');
									};
								}
							} else {
								strWrap.addClass('str_static');
							}
						};
					};
				};
				if (p.xml) {
					$.ajax({
						url: p.xml,
						dataType: "xml",
						success: function success(xml) {
							var xmlTextEl = $(xml).find('text');
							var xmlTextLength = xmlTextEl.length;
							for (var i = 0; i < xmlTextLength; i++) {
								var xmlElActive = xmlTextEl.eq(i);
								var xmlElContent = xmlElActive.text();
								var xmlItemEl = $('<span>').text(xmlElContent).appendTo(strWrap);

								if (p.direction == 'left' || p.direction == 'right') {
									xmlItemEl.css({ display: 'inline-block', textAlign: 'right' });
									if (i > 0) {
										xmlItemEl.css({ width: strWrap.width() + xmlItemEl.width() });
									}
								}
								if (p.direction == 'down' || p.direction == 'up') {
									xmlItemEl.css({ display: 'block', textAlign: 'left' });
									if (i > 0) {
										xmlItemEl.css({ paddingTop: strWrap.height() });
									}
								}
							}
							code();
						}
					});
				} else {
					code();
				}
				strWrap.data({
					ini: code,
					startheight: startHeight
				});
			});
		},
		update: function update() {
			var el = $(this);
			var str_origin = $('.str_origin', el);
			var str_move_clone = $('.str_move_clone', el);
			str_origin.stop(true);
			str_move_clone.remove();
			el.data('ini')();
		},
		destroy: function destroy() {

			var el = $(this);
			var elMove = $('.str_move', el);
			var startHeight = el.data('startheight');

			$('.str_move_clone', el).remove();
			el.off('mouseenter');
			el.off('mousedown');
			el.off('mouseup');
			el.off('mouseleave');
			el.off('mousemove');
			el.removeClass('noStop').removeClass('str_vertical').removeClass('str_active').removeClass('no_drag').removeClass('str_static').removeClass('str_right').removeClass('str_down');

			var elStyle = el.attr('style');
			if (elStyle) {
				var styleArr = elStyle.split(';');
				for (var i = 0; i < styleArr.length; i++) {
					var str = $.trim(styleArr[i]);
					var tested = str.search(/^height/g);
					if (tested != -1) {
						styleArr[i] = '';
					}
				}
				var newArr = styleArr.join(';');
				var newStyle = newArr.replace(/;+/g, ';');

				if (newStyle == ';') {
					el.removeAttr('style');
				} else {
					el.attr('style', newStyle);
				}

				if (startHeight) {
					el.css({ height: startHeight });
				}
			}
			elMove.stop(true);

			if (elMove.length) {
				var context = elMove.html();
				elMove.remove();
				el.html(context);
			}
		},
		pause: function pause() {
			var el = $(this);
			var elMove = $('.str_move', el);
			elMove.stop(true);
		},
		play: function play() {
			var el = $(this);
			$(this).off('mousemove');
			el.data('moveF')();
		}

	};
	$.fn.liMarquee = function (method) {
		if (methods[method]) {
			return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if ((typeof method === 'undefined' ? 'undefined' : _typeof(method)) === 'object' || !method) {
			return methods.init.apply(this, arguments);
		} else {
			$.error('Метод ' + method + ' в jQuery.liMarquee не существует');
		}
	};
})(jQuery);
"use strict";

/*!
 * jQCloud Plugin for jQuery
 *
 * Version 1.0.4
 *
 * Copyright 2011, Luca Ongaro
 * Licensed under the MIT license.
 *
 * Date: 2013-05-09 18:54:22 +0200
*/

(function ($) {
  "use strict";

  $.fn.jQCloud = function (word_array, options) {
    // Reference to the container element
    var $this = this;
    // Namespace word ids to avoid collisions between multiple clouds
    var cloud_namespace = $this.attr('id') || Math.floor(Math.random() * 1000000).toString(36);

    // Default options value
    var default_options = {
      width: $this.width(),
      height: $this.height(),
      center: {
        x: (options && options.width ? options.width : $this.width()) / 2.0,
        y: (options && options.height ? options.height : $this.height()) / 2.0
      },
      delayedMode: word_array.length > 50,
      shape: false, // It defaults to elliptic shape
      encodeURI: true,
      removeOverflowing: true
    };

    options = $.extend(default_options, options || {});

    // Add the "jqcloud" class to the container for easy CSS styling, set container width/height
    $this.addClass("jqcloud").width(options.width).height(options.height);

    // Container's CSS position cannot be 'static'
    if ($this.css("position") === "static") {
      $this.css("position", "relative");
    }

    var drawWordCloud = function drawWordCloud() {
      // Helper function to test if an element overlaps others
      var hitTest = function hitTest(elem, other_elems) {
        // Pairwise overlap detection
        var overlapping = function overlapping(a, b) {
          if (Math.abs(2.0 * a.offsetLeft + a.offsetWidth - 2.0 * b.offsetLeft - b.offsetWidth) < a.offsetWidth + b.offsetWidth) {
            if (Math.abs(2.0 * a.offsetTop + a.offsetHeight - 2.0 * b.offsetTop - b.offsetHeight) < a.offsetHeight + b.offsetHeight) {
              return true;
            }
          }
          return false;
        };
        var i = 0;
        // Check elements for overlap one by one, stop and return false as soon as an overlap is found
        for (i = 0; i < other_elems.length; i++) {
          if (overlapping(elem, other_elems[i])) {
            return true;
          }
        }
        return false;
      };

      // Make sure every weight is a number before sorting
      for (var i = 0; i < word_array.length; i++) {
        word_array[i].weight = parseFloat(word_array[i].weight, 10);
      }

      // Sort word_array from the word with the highest weight to the one with the lowest
      word_array.sort(function (a, b) {
        if (a.weight < b.weight) {
          return 1;
        } else if (a.weight > b.weight) {
          return -1;
        } else {
          return 0;
        }
      });

      var step = options.shape === "rectangular" ? 18.0 : 2.0,
          already_placed_words = [],
          aspect_ratio = options.width / options.height;

      // Function to draw a word, by moving it in spiral until it finds a suitable empty place. This will be iterated on each word.
      var drawOneWord = function drawOneWord(index, word) {
        // Define the ID attribute of the span that will wrap the word, and the associated jQuery selector string
        var word_id = cloud_namespace + "_word_" + index,
            word_selector = "#" + word_id,
            angle = 6.28 * Math.random(),
            radius = 0.0,


        // Only used if option.shape == 'rectangular'
        steps_in_direction = 0.0,
            quarter_turns = 0.0,
            weight = 5,
            custom_class = "",
            inner_html = "",
            word_span;

        // Extend word html options with defaults
        word.html = $.extend(word.html, { id: word_id });

        // If custom class was specified, put them into a variable and remove it from html attrs, to avoid overwriting classes set by jQCloud
        if (word.html && word.html["class"]) {
          custom_class = word.html["class"];
          delete word.html["class"];
        }

        // Check if min(weight) > max(weight) otherwise use default
        if (word_array[0].weight > word_array[word_array.length - 1].weight) {
          // Linearly map the original weight to a discrete scale from 1 to 10
          weight = Math.round((word.weight - word_array[word_array.length - 1].weight) / (word_array[0].weight - word_array[word_array.length - 1].weight) * 9.0) + 1;
        }
        word_span = $('<span>').attr(word.html).addClass('w' + weight + " " + custom_class);

        // Append link if word.url attribute was set
        if (word.link) {
          // If link is a string, then use it as the link href
          if (typeof word.link === "string") {
            word.link = { href: word.link };
          }

          // Extend link html options with defaults
          if (options.encodeURI) {
            word.link = $.extend(word.link, { href: encodeURI(word.link.href).replace(/'/g, "%27") });
          }

          inner_html = $('<a>').attr(word.link).text(word.text);
        } else {
          inner_html = word.text;
        }
        word_span.append(inner_html);

        // Bind handlers to words
        if (!!word.handlers) {
          for (var prop in word.handlers) {
            if (word.handlers.hasOwnProperty(prop) && typeof word.handlers[prop] === 'function') {
              $(word_span).bind(prop, word.handlers[prop]);
            }
          }
        }

        $this.append(word_span);

        var width = word_span.width(),
            height = word_span.height(),
            left = options.center.x - width / 2.0,
            top = options.center.y - height / 2.0;

        // Save a reference to the style property, for better performance
        var word_style = word_span[0].style;
        word_style.position = "absolute";
        word_style.left = left + "px";
        word_style.top = top + "px";

        while (hitTest(word_span[0], already_placed_words)) {
          // option shape is 'rectangular' so move the word in a rectangular spiral
          if (options.shape === "rectangular") {
            steps_in_direction++;
            if (steps_in_direction * step > (1 + Math.floor(quarter_turns / 2.0)) * step * (quarter_turns % 4 % 2 === 0 ? 1 : aspect_ratio)) {
              steps_in_direction = 0.0;
              quarter_turns++;
            }
            switch (quarter_turns % 4) {
              case 1:
                left += step * aspect_ratio + Math.random() * 2.0;
                break;
              case 2:
                top -= step + Math.random() * 2.0;
                break;
              case 3:
                left -= step * aspect_ratio + Math.random() * 2.0;
                break;
              case 0:
                top += step + Math.random() * 2.0;
                break;
            }
          } else {
            // Default settings: elliptic spiral shape
            radius += step;
            angle += (index % 2 === 0 ? 1 : -1) * step;

            left = options.center.x - width / 2.0 + radius * Math.cos(angle) * aspect_ratio;
            top = options.center.y + radius * Math.sin(angle) - height / 2.0;
          }
          word_style.left = left + "px";
          word_style.top = top + "px";
        }

        // Don't render word if part of it would be outside the container
        if (options.removeOverflowing && (left < 0 || top < 0 || left + width > options.width || top + height > options.height)) {
          word_span.remove();
          return;
        }

        already_placed_words.push(word_span[0]);

        // Invoke callback if existing
        if ($.isFunction(word.afterWordRender)) {
          word.afterWordRender.call(word_span);
        }
      };

      var drawOneWordDelayed = function drawOneWordDelayed(index) {
        index = index || 0;
        if (!$this.is(':visible')) {
          // if not visible then do not attempt to draw
          setTimeout(function () {
            drawOneWordDelayed(index);
          }, 10);
          return;
        }
        if (index < word_array.length) {
          drawOneWord(index, word_array[index]);
          setTimeout(function () {
            drawOneWordDelayed(index + 1);
          }, 10);
        } else {
          if ($.isFunction(options.afterCloudRender)) {
            options.afterCloudRender.call($this);
          }
        }
      };

      // Iterate drawOneWord on every word. The way the iteration is done depends on the drawing mode (delayedMode is true or false)
      if (options.delayedMode) {
        drawOneWordDelayed();
      } else {
        $.each(word_array, drawOneWord);
        if ($.isFunction(options.afterCloudRender)) {
          options.afterCloudRender.call($this);
        }
      }
    };

    // Delay execution so that the browser can render the page before the computatively intensive word cloud drawing
    setTimeout(function () {
      drawWordCloud();
    }, 10);
    return $this;
  };
})(jQuery);
'use strict';

define('global:maps:GeoMapGoogleView', ['async!http://maps.google.com/maps/api/js?v=3.22&key=AIzaSyD2WhtWvymVvaSFTjqufGtxBgdEaDQbpEw'], function () {

    return Mn.View.extend({

        template: false,

        onRender: function onRender() {
            this.$el.css({ position: 'absolute', top: 0, left: 0, bottom: 0, right: 0, margin: '-20px' });
        },

        onAttach: function onAttach() {

            var zoom = this.model.get("Zoom"),
                lat = this.model.get("CenterLat"),
                long = this.model.get("CenterLong"),
                flag = zoom && lat && long,
                bounds = new google.maps.LatLngBounds(),
                mapOptions = {
                center: new google.maps.LatLng(lat || 55.76, long || 37.64),
                zoom: zoom || 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            },
                map = new google.maps.Map(this.el, mapOptions);

            // для сохранения позиции и масштаба

            function setCenter() {

                var zoom = map.getZoom(),
                    center = map.getCenter();

                if (!this.model.get("ReadOnly")) {
                    var m = new Backbone.Model({
                        widget: {
                            name: this.model.get('title'),
                            type: this.model.get('type'),
                            uid: this.model.id,
                            Visualization: this.model.get('Visualization')
                        },
                        CenterLat: center.lat(),
                        CenterLong: center.lng(),
                        Zoom: zoom
                    });
                    m.url = '/api/widget/' + this.model.id + '/setstate';
                    m.save();
                }
            };

            google.maps.event.addListener(map, "dragend", setCenter.bind(this));
            google.maps.event.addListener(map, "zoom_changed", setCenter.bind(this));

            var shape = {
                coords: [1, 1, 1, 20, 18, 20, 18, 1],
                type: 'poly'
            };

            var infoWindow = new google.maps.InfoWindow();
            var widgetModel = this.model;

            this.collection.each(function (m) {

                if (m.get('latitude') && m.get('longitude')) {

                    var image = {
                        url: m.get('markerurl'),
                        size: new google.maps.Size(17, 32),
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(0, 32)
                    };

                    var position = new google.maps.LatLng(parseFloat(m.get('latitude').replace(",", ".")), parseFloat(m.get('longitude').replace(",", ".")));

                    bounds.extend(position);

                    var marker = new google.maps.Marker({
                        position: position,
                        map: map,
                        icon: image,
                        shape: shape,
                        title: m.get('display_name'),
                        zIndex: 1
                    });

                    google.maps.event.addListener(marker, 'click', function (marker, i) {

                        return function () {

                            widgetModel.trigger('click:item', m);

                            infoWindow.setContent(m.get('display_name'));
                            infoWindow.open(map, marker);
                        };
                    }(marker));
                }
            }, this);

            if (!flag) map.fitBounds(bounds);
        }
    });
});
'use strict';

define('ejChartView', ['i18n!nls/resources.min', 'global.charts.settingsmodel', 'RU'], function (Resources, subsetModel) {

    return Mn.View.extend({

        className: 'g--chart',

        template: _.template(''),

        initialize: function initialize() {

            this.subModel = new subsetModel();

            if (this.options.subset) this.subModel.set(this.options.subset);
        },

        onBeforeRender: function onBeforeRender() {

            this.$el.attr('id', (Date.now().toString(36) + Math.random().toString(36).substr(2, 5)).toUpperCase());
        },

        onRender: function onRender() {

            var sModel = this.subModel;

            this.$el.css('display', 'inline-block');

            this._getColor();

            this.ejOptions = {

                //Initializing Series
                series: this.model.get('flow'),

                load: "loadTheme",

                //isResponsive: true, Controls whether Chart has to be responsive while resizing. - для нас не подходит
                locale: Resources.Lang,

                title: {
                    text: sModel.get('chartTitle') || this.model.get('name') || "",
                    enableTrim: true
                },

                size: {
                    width: this.model.get('width'),
                    height: this.model.get('height')
                },

                //Initializing Zooming
                zooming: {
                    enable: true,
                    type: 'x,y',
                    enableMouseWheel: true,
                    enableScrollbar: true,
                    enableDeferredZoom: true
                },

                legend: {
                    visible: sModel.get('legendVisible'),
                    title: {
                        text: sModel.get('legendTitle')
                    },
                    enableScrollbar: false,
                    position: sModel.get('legendPosition'),
                    rowCount: isNaN(parseInt(sModel.get('legendRowCount'))) ? null : parseInt(sModel.get('legendRowCount')),
                    border: {
                        color: sModel.get('legendBorderColor'),
                        width: isNaN(parseInt(sModel.get('legendBorderSize'))) ? 1 : parseInt(sModel.get('legendBorderSize'))
                    }
                },

                chartClick: function (args) {

                    this.triggerMethod('chart:selected', this);
                }.bind(this)
            };

            if (this.model.get('type') === 'pie') {

                this.ejOptions.commonSeriesOptions = {
                    type: this.model.get('type'),
                    enableAnimation: true,

                    tooltip: {
                        visible: sModel.get('tooltipVisible'),
                        format: sModel.get('tooltipFormat')
                    },

                    border: {
                        width: 1,
                        color: 'white'
                    },

                    marker: {
                        dataLabel: {
                            visible: sModel.get('dataLabelVisible'),
                            shape: 'none',
                            connectorLine: { type: 'bezier', color: 'black' },
                            font: { size: '14px' },
                            enableContrastColor: true
                        }
                    },

                    labelPosition: 'outsideExtended',
                    enableSmartLabels: true,
                    startAngle: 145,

                    pieCoefficient: parseFloat(sModel.get('pieSize')),
                    //explodeIndex: isNaN(parseInt(sModel.get('explodedIndex'))) ? null : parseInt(sModel.get('explodedIndex')),
                    explodeAll: sModel.get('explodeAllSegments'),
                    explode: sModel.get('explodeOnMouseOver')

                };
            } else {
                this.ejOptions.primaryXAxis = {
                    visible: sModel.get('primaryXAxisVisible'),
                    title: { text: sModel.get('primaryXAxisTitle') },
                    majorGridLines: { visible: true, color: "#a9a9a9", opacity: 0.12 },
                    labelIntersectAction: sModel.get('primaryXAxislabelIntrsectAction'),
                    valueType: this.model.get('xAxisType').toLowerCase()
                };

                //Initializing Primary Y Axis	
                this.ejOptions.primaryYAxis = {
                    //range: { min: 0, max: 80, interval: 20 },
                    visible: sModel.get('primaryYAxisVisible'),
                    title: { text: sModel.get('primaryYAxisTitle') },
                    //range: this.getRange(),
                    majorGridLines: { visible: true, color: "#a9a9a9", opacity: 0.12 },
                    labelIntersectAction: sModel.get('primaryYAxislabelIntrsectAction'),
                    valueType: this.model.get('yAxisType').toLowerCase()
                };

                //Initializing Common Properties for all the series
                this.ejOptions.commonSeriesOptions = {
                    type: this.model.get('type'),
                    enableAnimation: true,

                    tooltip: {
                        visible: sModel.get('tooltipVisible'),
                        format: sModel.get('tooltipFormat')
                    },

                    marker: {
                        shape: sModel.get('markerShape'),
                        size: {
                            height: sModel.get('markerHeight'), width: sModel.get('markerWidth')
                        },
                        visible: sModel.get('markerVisible'),
                        dataLabel: {
                            opacity: sModel.get('dataLabelOpacity'),
                            textPosition: sModel.get('dataLabelPosition'),
                            visible: sModel.get('dataLabelVisible')
                        }
                    },

                    columnWidth: parseFloat(sModel.get('columnWidth')),

                    width: parseInt(sModel.get('lineWidth'))
                };
            }

            //#4268 volkov для графиков, которые закрашивают области, области сделать полупрозрачными
            if (this.model.get('type').indexOf('area') >= 0) this.ejOptions.commonSeriesOptions.opacity = 0.5;
        },

        onAttach: function onAttach() {

            try {

                this.$el.ejChart(this.ejOptions);
            } catch (e) {

                console.error(e.message, 'chart name - ' + this.model.get('type'));
            }
        },

        _getColor: function _getColor() {

            var p = this.options.palette;
            var colorsValue = p ? p.WidgetParamValue : undefined;

            if (colorsValue) {

                var series = this.model.get('flow').map(function (el) {

                    if (el.fnId && el.fnId !== -1) {

                        var o = _.findWhere(colorsValue, { 'object_id': el.elId });

                        if (o && o.color !== 'none') {
                            el.fill = o.color;

                            el.points.map(function (a) {
                                a.fill = o.color;
                            });
                        }
                    } else {

                        var points = el.points;
                        _.map(points, function (el) {

                            var o = _.findWhere(colorsValue, { 'object_id': el.elId });

                            if (o && o.color !== 'none') el.fill = o.color;
                        });
                    }
                });
            }
        }

    });
});
'use strict';

define('global.charts.settingsmodel', [], function () {

                return Backbone.Model.extend({

                                defaults: function defaults() {

                                                return {

                                                                /* Базовая настройка */

                                                                //Наименование графика
                                                                chartTitle: '',

                                                                /* Настройка подсказки */

                                                                // Показать всплывающую подсказку
                                                                tooltipVisible: true,

                                                                //Формат всплывающей подсказки
                                                                tooltipFormat: '#series.name# : #point.y#',

                                                                // Маркер данных
                                                                markerVisible: true,
                                                                markerShape: 'circle',
                                                                markerHeight: 10,
                                                                markerWidth: 10,

                                                                // Метка данных
                                                                dataLabelVisible: false,
                                                                dataLabelPosition: 'top',
                                                                dataLabelOpacity: 0.5,

                                                                /* Настройка легенды */

                                                                // Показывать легенду
                                                                legendVisible: false,

                                                                // Заголовок легенды
                                                                legendTitle: '',

                                                                // Расположение легенды
                                                                legendPosition: 'Bottom', // Left, Right, Top, Bottom (default)

                                                                // Количество рядов в легенде
                                                                legendRowCount: null, // Number of rows to arrange the legend items.

                                                                // Толщина границы легенды
                                                                legendBorderSize: 0,

                                                                //  Цвет границы легенды
                                                                legendBorderColor: 'transparent',

                                                                /* Настройка осей */

                                                                // exclude pie

                                                                // Показывать ось X
                                                                primaryXAxisVisible: true,

                                                                //  Наименование оси X
                                                                primaryXAxisTitle: '',

                                                                // Расположение меток на оси X
                                                                primaryXAxislabelIntrsectAction: 'Trim',

                                                                // Показывать ось Y
                                                                primaryYAxisVisible: true,

                                                                //  Наименование оси Y
                                                                primaryYAxisTitle: '',

                                                                // Расположение меток на оси Y
                                                                primaryYAxislabelIntrsectAction: 'Trim',

                                                                /*
                                                                
                                                                None	string	no action will be perform in axis labels 
                                                                Rotate90	string	Displays axis labels with 90 degree
                                                                Rotate45	string	Displays axis labels with 45 degree
                                                                Wrap	string	Axis labels will be Wrap
                                                                WrapByword	string	Axis labels will be Wrap by word
                                                                Trim	string	Axis labels will be trimmed
                                                                Hide	string	Axis labels will be hide when overlap to others
                                                                MultipleRows	string	Axis labels will display the next line when overlap to others
                                                                
                                                                */

                                                                /* Настройка колонок */

                                                                // column, bar, stackingColumn100, stackingColumn, bar


                                                                //Ширина колонки
                                                                columnWidth: 0.7, //Было 1

                                                                // Рассотяние между колонками
                                                                columnSpacing: 0,

                                                                /* График */

                                                                // line

                                                                // Ширина линии
                                                                lineWidth: 2,

                                                                /* Настройка секций (круговая диаграмма) */

                                                                // pie

                                                                // series.pieCoefficient - Диаметр круга 0-1
                                                                pieSize: 0.8,

                                                                // Индекс отделенного сегмента
                                                                //explodedIndex: null,

                                                                // Отделять все сегменты
                                                                explodeAllSegments: false,

                                                                // series.explode отделять сегмент при наведении
                                                                explodeOnMouseOver: false,

                                                                /* Настройки цветов */

                                                                colorSettings: false
                                                };
                                }
                });
});
'use strict';

define('services.library.libraryView', ['i18n!nls/resources.min', 'global.request.param', 'g/tree', 'global.grid.dataItemsView'], function (Resources, ParamView, treeView, tableView) {

    var queryModel = new Backbone.Model();

    var query = Backbone.Collection.extend({

        url: '/api/Request/ExecuteV2?page=1',
        sync: function sync(method, model, options) {
            var json = queryModel;
            json.set('page', this.url.split('?')[1].split('=')[1]);
            json.url = this.url;
            Backbone.Collection.prototype.sync.apply(this, ['create', json, options]);
        }

    });

    var parametersView = Mn.CollectionView.extend({

        className: "params-container",

        childView: ParamView,

        childViewOptions: function childViewOptions() {
            return {
                rid: this.options.rid,
                dbase: this.options.dbase
            };
        },

        emptyView: Mn.View.extend({
            template: _.template(Resources.N),
            templateContext: { Resources: Resources }
        })

    });

    return Mn.View.extend({

        className: 'request-library',

        template: templates['services-request-library'],
        templateContext: { Resources: Resources },

        events: {

            "click .run:not([data-icon='icon-loader'])": function clickRunNotDataIconIconLoader() {

                this.ui.run.attr('data-icon', 'icon-loader');
                var data = this.getChildView('params').collection.toJSON();

                queryModel.set({
                    id: parseInt(this.requestID),
                    pars: data
                });

                var collection = new query();

                this.showChildView('result', new tableView({ collection: collection, hideButton: true }));

                collection.fetch({

                    reset: true,

                    success: function () {

                        this.ui.run.attr("data-icon", "icon-next");
                        this.getChildView('result').getChildView('table').getChildView('body').$('.btn-link').remove();
                    }.bind(this),

                    error: function (c, xhr) {

                        var m = xhr.responseJSON ? xhr.responseJSON.msg : null;

                        if (m) this.getChildView('result').$el.html('<i style="color:red">' + Resources.rer + ': <br/>{ ' + m + ' }</i>');else this.getChildView('result').$el.html('<i style="color:red">' + xhr.statusText + '</i>');

                        this.ui.run.attr("data-icon", "icon-next");
                    }.bind(this)

                });
            }
        },

        ui: {
            run: 'button.run',
            result: '.result',
            main: '.main'
        },

        regions: {
            tree: '.left',
            params: { el: '.params', replaceElement: true },
            result: { el: '@ui.result', replaceElement: true }
        },

        onRender: function onRender() {

            this.ui.run.hide();

            var collection = new Backbone.Collection();
            collection.url = '/api/request' + (this.options.widgetType ? '?widgetType=' + this.options.widgetType : '');

            this.showChildView('tree', new treeView({ collection: collection, node: { checkbox: false } }));

            collection.fetch({ reset: true });

            //if (this.options.isDemo) {
            //    this.$el.addClass("isDemo");
            //    this.getChildView('tree').$el.showIndicator();
            //    this.getChildView('tree').collection.fetch({ reset: true });
            //}
            //else {
            //    this.showChildView('authorise', new Authorise);
            //    this.getChildView('authorise').$el.show();
            //    this.ui.main.hide();
            //}
        },

        onChildviewContainerSelectItem: function onChildviewContainerSelectItem(v) {

            var p = v.model.get('parameters') || [];

            if (this.getRegion('result').hasView()) this.getChildView('result').$el.hide();

            if (v.model.get('isdoc')) {

                this.requestID = v.model.id;

                this.showChildView('params', new parametersView({ collection: new Backbone.Collection(p), dbase: this.options.dbase }));

                this.ui.run.show();
            } else {

                if (this.getRegion('params').hasView()) this.getChildView('params').collection.reset();

                this.ui.run.hide();
            }
        },

        onChildviewAuthorizeEnd: function onChildviewAuthorizeEnd() {

            //this.getChildView('authorise').$el.hide();

            //if (this.getRegion('authorise').hasView())
            //    $.ajaxSettings.headers.key = $.mergeUrlParam($.ajaxSettings.url, { db: 'db' + this.getChildView('authorise').collection.at(0).id });

            //this.getChildView('tree').$el.showIndicator();
            //this.getChildView('tree').collection.fetch({ reset: true });
            //this.ui.main.show();

            //this.triggerMethod('authorise:end');

        }

    });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIm1vZGVscy9TZW5kTW9kZWwuanMiLCJtb2RlbHMvV2lkZ2V0TW9kZWwuanMiLCJyYWRpby9jaGFyYWN0ZXJpc3RpY3MuanMiLCJ2aWV3cy9EYXNoYm9hcmRzVmlldy5qcyIsInZpZXdzL2Rhc2hEZWNvclZpZXcuanMiLCJ2aWV3cy9GaXJzdFZpZXcuanMiLCJ2aWV3cy9NYWluVmlldy5qcyIsInZpZXdzL1NsaWRlclZpZXcuanMiLCJ2aWV3cy9kMy9IaXN0b2dyYW1WaWV3LmpzIiwidmlld3MvcGFuZWxzL2xlZnRQYW5lbFZpZXcuanMiLCJ2aWV3cy9wYW5lbHMvdG9wUGFuZWxWaWV3LmpzIiwidmlld3MvcmVxdWVzdHMvcmVxdWVzdFZpZXcuanMiLCJ2aWV3cy9zZXR0aW5ncy9jb2xvclJvdy5qcyIsInZpZXdzL3NldHRpbmdzL2h0bWxFZGl0b3IuanMiLCJ2aWV3cy9zZXR0aW5ncy9yZXF1ZXN0UGFyYW1zLmpzIiwidmlld3Mvc2V0dGluZ3Mvc2V0dGluZ3NWaWV3LmpzIiwidmlld3Mvd2lkZ2V0L1dpZGdldENsb3VkLmpzIiwidmlld3Mvd2lkZ2V0L1dpZGdldEdyYXBoLmpzIiwidmlld3Mvd2lkZ2V0L1dpZGdldEh0bWwuanMiLCJ2aWV3cy93aWRnZXQvV2lkZ2V0TWFwLmpzIiwidmlld3Mvd2lkZ2V0L1dpZGdldFJ1bm5pbmcuanMiLCJ2aWV3cy93aWRnZXQvV2lkZ2V0VGFibGUuanMiLCJ2aWV3cy93aWRnZXQvV2lkZ2V0Vmlldy5qcyIsInZpZXdzL3NldHRpbmdzL2Jhc2UvYmFzZU9wdGlvbnMuanMiLCJ2aWV3cy9zZXR0aW5ncy9jaGFpbi9jaGFpblZpZXcuanMiLCJ2aWV3cy9zZXR0aW5ncy9kZWNvcmF0aW9uL2RlY29yYXRpb25WaWV3LmpzIiwidmlld3Mvc2V0dGluZ3MvbGVnZW5kL2xlZ2VuZE1hcC5qcyIsInZpZXdzL3NldHRpbmdzL3JlcG9ydC9yZXBvcnRpbmdWaWV3LmpzIiwidmlld3Mvc2V0dGluZ3Mvc3Vic2NyaWJlL3N1YnNjcmliZUxpc3QuanMiLCJ2aWV3cy9zZXR0aW5ncy9zdWJzY3JpYmUvc3Vic2NyaWJlVmlldy5qcyIsInZpZXdzL3dpZGdldC9jb250ZW50L2NvbnRlbnRWaWV3LmpzIiwidmlld3Mvd2lkZ2V0L2NyZWF0ZS9tYXN0ZXJWaWV3LmpzIiwidmlld3Mvd2lkZ2V0L21hcC9sZWdlbmRWaWV3LmpzIiwidmlld3Mvd2lkZ2V0L3JlcG9ydC9yZXBvcnRWaWV3LmpzIiwidmlld3Mvd2lkZ2V0L3NlbW5ldC9zZW1uZXRWaWV3LmpzIiwidmlld3Mvc2V0dGluZ3MvdmlzdWFsaXphdGlvbi9jaGFydC9jaGFydHNSZXBvc2l0b3J5LmpzIiwidmlld3Mvc2V0dGluZ3MvdmlzdWFsaXphdGlvbi9jaGFydC9jaG9pY2VWaWV3LmpzIiwidmlld3Mvc2V0dGluZ3MvdmlzdWFsaXphdGlvbi9jaGFydC9zY2hhcnRWaWV3LmpzIiwidmlld3Mvc2V0dGluZ3MvdmlzdWFsaXphdGlvbi9jbG91ZC9jbG91ZFZpZXcuanMiLCJ2aWV3cy9zZXR0aW5ncy92aXN1YWxpemF0aW9uL3RhYmxlL2NvbHVtbk9yZy5qcyIsInZpZXdzL3NldHRpbmdzL3Zpc3VhbGl6YXRpb24vdGFibGUvZmllbGRPcmcuanMiLCJ2aWV3cy9zZXR0aW5ncy92aXN1YWxpemF0aW9uL3RhYmxlL3RhYmxlVmlldy5qcyIsInZpZXdzL3NldHRpbmdzL3Zpc3VhbGl6YXRpb24vc2VtbmV0L3NzZW1uZXRWaWV3LmpzIiwidmlld3Mvd2lkZ2V0L3RhYmxlL2NhcmQvY2FyZFZpZXcuanMiLCJ2aWV3cy93aWRnZXQvdGFibGUvZ3JpZC9maWx0ZXJWaWV3LmpzIiwidmlld3Mvd2lkZ2V0L3RhYmxlL2dyaWQvZ3JpZFZpZXcuanMiLCJqcXVlcnkuZm9ybS5qcyIsImMzLmpzIiwianF1ZXJ5LmxpbWFycXVlZS5qcyIsImpxY2xvdWQtMS4wLjQuanMiLCJnZW9tYXBnb29nbGV2aWV3LmpzIiwiZWpjaGFydHZpZXcuanMiLCJzZXR0aW5nc21vZGVsLmpzIiwibGlicmFyeXZpZXcuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNodUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDektBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25OQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5Z0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbHBCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNVJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdk1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25vQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcHlSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ROQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJpbmRleC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnUERGSlMnLCBbJy9qcy9kaXN0L3BkZi9zaGFyZWQvdXRpbC5qcyddLCBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIFBERkpTO1xufSk7XG5cbnJlcXVpcmUuY29uZmlnKHtcbiAgICBwYXRoczoge1xuICAgICAgICAnQCc6IFwiQHdhbGxcIixcbiAgICAgICAgYXN5bmM6ICdkaXN0L3JlcXVpcmVqcy1wbHVnaW5zL3NyYy9hc3luYydcbiAgICB9XG59KTtcblxuZGVmaW5lKFsnYXBwJywgJ2FjY2VzcycsICdnbG9iYWwudmlldy5oZWFkZXJWaWV3JywgJ21haW5WaWV3JywgJ2dsb2JhbC5yYWRpby5sb2FkZXInXSwgZnVuY3Rpb24gKEFwcCwgYWNjLCBIZWFkZXIsIG1haW5WaWV3KSB7XG5cbiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uIGluaXQoKSB7XG5cbiAgICAgICAgJC5hamF4U2V0dXAoe1xuXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgJ2tleSc6ICQuYWpheFNldHRpbmdzLnVybFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBBcHAuYWNjZXNzID0gYWNjLmRhdGEuUG9pbnRzO1xuXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoKSB7XG4gICAgICAgICAgICBCYWNrYm9uZS5oaXN0b3J5Lm5hdmlnYXRlKCcnLCB7IHRyaWdnZXI6IHRydWUgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAkKFwiaGVhZGVyIC5sb2dvXCIpLm9uKFwiY2xpY2tcIiwgaGFuZGxlcik7XG4gICAgICAgICQoXCJoZWFkZXIgLmxvZ29cIikub24oXCJ0b3VjaHN0YXJ0XCIsIGhhbmRsZXIpO1xuXG4gICAgICAgIHZhciBhcHBSb3V0ZXIgPSBNbi5BcHBSb3V0ZXIuZXh0ZW5kKHtcbiAgICAgICAgICAgIHJvdXRlczoge1xuXG4gICAgICAgICAgICAgICAgJyc6IGZ1bmN0aW9uIF8oKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhc2hib2FyZHMuZ2V0VmlldygpLnNob3dGaXJzdCgnbXknKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnaGVhZCBtZXRhW25hbWU9dmlld3BvcnRdJykuYXR0cignY29udGVudCcsICd3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wJyk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICdkZW1vJzogZnVuY3Rpb24gZGVtbygpIHtcbiAgICAgICAgICAgICAgICAgICAgZGFzaGJvYXJkcy5nZXRWaWV3KCkuc2hvd0ZpcnN0KCdzaGFyZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnaGVhZCBtZXRhW25hbWU9dmlld3BvcnRdJykuYXR0cignY29udGVudCcsICd3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wJyk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICduZXcnOiBmdW5jdGlvbiBfbmV3KCkge1xuICAgICAgICAgICAgICAgICAgICBkYXNoYm9hcmRzLmdldFZpZXcoKS5vcHRpb25zLnVpZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGRhc2hib2FyZHMuZ2V0VmlldygpLm9uU2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAkKCdoZWFkIG1ldGFbbmFtZT12aWV3cG9ydF0nKS5hdHRyKCdjb250ZW50JywgJ3dpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAnKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgJzp1aWQnOiBmdW5jdGlvbiB1aWQoX3VpZCkge1xuICAgICAgICAgICAgICAgICAgICBkYXNoYm9hcmRzLmdldFZpZXcoKS5vcHRpb25zLnVpZCA9IF91aWQ7XG4gICAgICAgICAgICAgICAgICAgIGRhc2hib2FyZHMuZ2V0VmlldygpLm9uU2hvdygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgYXBwID0gTW4uQXBwbGljYXRpb24uZXh0ZW5kKHtcblxuICAgICAgICAgICAgcmVnaW9uOiAnbWFpbicsXG5cbiAgICAgICAgICAgIG9uU3RhcnQ6IGZ1bmN0aW9uIG9uU3RhcnQoKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNob3dWaWV3KG5ldyBtYWluVmlldygpKTtcblxuICAgICAgICAgICAgICAgIG5ldyBIZWFkZXIoKS5yZW5kZXIoKTtcblxuICAgICAgICAgICAgICAgIEJhY2tib25lLmhpc3Rvcnkuc3RhcnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICBuZXcgYXBwUm91dGVyKCk7XG4gICAgICAgIHZhciBkYXNoYm9hcmRzID0gbmV3IGFwcCgpO1xuICAgICAgICBkYXNoYm9hcmRzLnN0YXJ0KCk7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3NlbmRNb2RlbCcsIFtdLCBmdW5jdGlvbiAoKSB7XG5cbiAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcblxuICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgaWQ6IG51bGwsXG4gICAgICAgICAgICBwYWdlOiAxLFxuICAgICAgICAgICAgcGFnZXNpemU6IDMwLFxuICAgICAgICAgICAgcGFyczogW10sXG4gICAgICAgICAgICB0czogJycsXG4gICAgICAgICAgICB1c2VEZWZQYXJhbXM6IHRydWUsXG4gICAgICAgICAgICBhY3Rpb246ICdzZW5kJ1xuICAgICAgICB9LFxuXG4gICAgICAgIHVybDogZnVuY3Rpb24gdXJsKCkge1xuICAgICAgICAgICAgcmV0dXJuICcvYXBpL2V4dHNydi8nICsgdGhpcy5nZXQoJ2FjdGlvbicpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHN5bmM6IGZ1bmN0aW9uIHN5bmMobWV0aG9kLCBtb2RlbCwgb3B0aW9ucykge1xuXG4gICAgICAgICAgICAvL0JhY2tib25lLk1vZGVsLnByb3RvdHlwZS5zeW5jLmFwcGx5KHRoaXMsIFsnY3JlYXRlJywgbW9kZWwsIG9wdGlvbnNdKTtcblxuICAgICAgICAgICAgJC5hamF4KHsgdXJsOiBtb2RlbC51cmwoKSwgbWV0aG9kOiAnUE9TVCcsIGRhdGE6IEpTT04uc3RyaW5naWZ5KG1vZGVsLnRvSlNPTigpKSwgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JyB9KS5kb25lKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2Vzcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBvcHRpb25zLmVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ1dpZGdldE1vZGVsJywgW10sIGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuXG4gICAgICAgIGRlZmF1bHRzOiBmdW5jdGlvbiBkZWZhdWx0cygpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IG51bGwsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiXCIsXG5cbiAgICAgICAgICAgICAgICB1cGRhdGU6IGZhbHNlLFxuXG4gICAgICAgICAgICAgICAgdGltZVVwZGF0ZTogMzYwMDAwLFxuXG4gICAgICAgICAgICAgICAgLy8g0LzQtdGC0LrQsCDQstGA0LXQvNC10L3QuCDQtNC70Y8g0L/QvtC70YPRh9C10L3QuNGPINC90L7QstGL0YUg0LTQsNC90L3Ri9GFINC/0L7RgdC70LUg0LzQvtC80LXQvdGC0LAg0LfQsNCz0YDRg9C30LrQuFxuICAgICAgICAgICAgICAgIC8vINC60L7QvdGE0LvQuNC60YIg0L/RgNC4INGB0L7Qt9C00LDQvdC40Lgg0YbQtdC/0L7Rh9C10LogLSBzZW5kTW9kZWwg0L3QtSDQtNC+0LvQttC90LAg0YHQvtC00LXRgNC20LDRgtGMINGB0LIt0LLQviB0c1xuICAgICAgICAgICAgICAgIHRpbWVTdGFtcEZvclVwZGF0ZTogJycsXG5cbiAgICAgICAgICAgICAgICBDaGFyYWN0ZXJpc3RpY3M6IFtdLFxuICAgICAgICAgICAgICAgIHdpZHRoOiA0MDAsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiA0NjAsXG4gICAgICAgICAgICAgICAgdG9wOiAxMDAsXG4gICAgICAgICAgICAgICAgbGVmdDogMTAwLFxuICAgICAgICAgICAgICAgIHpJbmRleDogMSxcbiAgICAgICAgICAgICAgICB0eXBlTmFtZTogXCJcIixcbiAgICAgICAgICAgICAgICByZXF1ZXN0UGFyYW1ldGVyczoge30sXG4gICAgICAgICAgICAgICAgcHVibGlzaGVyczogW10sXG4gICAgICAgICAgICAgICAgRGVjb3JhdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBDYXB0aW9uQmFja2dyb3VuZDogJ3JnYmEoMjAwLCAxODgsIDE2MiwgMSknLFxuICAgICAgICAgICAgICAgICAgICBDYXB0aW9uRm9yZWdyb3VuZDogJ3JnYmEoNTEsIDUxLCA1MSwgMSknLFxuICAgICAgICAgICAgICAgICAgICBDb250YWluZXJCYWNrZ3JvdW5kOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAxKScsXG4gICAgICAgICAgICAgICAgICAgIENvbnRhaW5lckZvcmVncm91bmQ6ICdyZ2JhKDUxLCA1MSwgNTEsIDEpJyxcbiAgICAgICAgICAgICAgICAgICAgTGlua0JhY2tncm91bmQ6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDEpJyxcbiAgICAgICAgICAgICAgICAgICAgTGlua0ZvcmVncm91bmQ6ICdyZ2JhKDU1LDE0MSwyMTgsMSknLFxuICAgICAgICAgICAgICAgICAgICBDYXB0aW9uSXNWaXNpYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBCb3JkZXJJc1Zpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIENvbnRhaW5lcklzVHJhbnNwYXJlbnQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBWaXN1YWxpemF0aW9uOiBudWxsLFxuICAgICAgICAgICAgICAgIExlZ2VuZDogbnVsbCxcbiAgICAgICAgICAgICAgICBpc01hcmtTZWxlY3RlZEl0ZW06IGZhbHNlLFxuXG4gICAgICAgICAgICAgICAgLy8gaW50P1xuICAgICAgICAgICAgICAgIFNOTGV2ZWw6IG51bGwsXG4gICAgICAgICAgICAgICAgU05MYXlvdXQ6IG51bGwsXG4gICAgICAgICAgICAgICAgU05TdHJ1Y3Q6IG51bGwsXG4gICAgICAgICAgICAgICAgU05YOiAwLFxuICAgICAgICAgICAgICAgIFNOWTogMCxcbiAgICAgICAgICAgICAgICBTTlpvb206IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXJsOiBmdW5jdGlvbiB1cmwoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uLnVybCgpICsgXCIvd2lkZ2V0L1wiICsgKHRoaXMuaWQgfHwgXCJcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKGF0dHIpIHtcblxuICAgICAgICAgICAgdmFyIG91dHB1dCA9IFtdLFxuICAgICAgICAgICAgICAgIGRwID0gJ15bXFxcXGRdKyQnO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB0ZXN0KHMsIHApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcyA9PT0gXCJcIiB8fCBuZXcgUmVnRXhwKHApLnRlc3Qocyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghYXR0ci50aXRsZSkge1xuICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHsgbmFtZTogXCJ0aXRsZVwiIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWF0dHIudHlwZU5hbWUpIHtcbiAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCh7IG5hbWU6IFwidHlwZU5hbWVcIiB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVE9ETzog0YPQsdGA0LDRgtGMINC60L7RgdGC0YvQu9C4XG4gICAgICAgICAgICB2YXIgdHlwZXMgPSBbXCJXaWRnZXRTb3VyY2VcIiwgXCJXaWRnZXRIdG1sXCIsIFwiV2lkZ2V0UmVwb3J0aW5nXCIsIFwiV2lkZ2V0U2VtTmV0XCJdO1xuXG4gICAgICAgICAgICBpZiAodHlwZXMuaW5kZXhPZih0aGlzLmdldChcInR5cGVOYW1lXCIpKSA9PT0gLTEgJiYgIWF0dHIucmVxdWVzdFBhcmFtZXRlcnMucmVxdWVzdGlkKSBvdXRwdXQucHVzaCh7IG5hbWU6IFwicmVxdWVzdFBhcmFtZXRlcnNcIiB9KTtcblxuICAgICAgICAgICAgaWYgKCF0ZXN0KGF0dHIudGltZVVwZGF0ZSwgZHApKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goeyBuYW1lOiBcInRpbWVVcGRhdGVcIiB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0ZXN0KGF0dHIud2lkdGgsIGRwKSkge1xuICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHsgbmFtZTogXCJ3aWR0aFwiIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRlc3QoYXR0ci5oZWlnaHQsIGRwKSkge1xuICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHsgbmFtZTogXCJoZWlnaHRcIiB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG91dHB1dC5sZW5ndGgpIHJldHVybiBvdXRwdXQ7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdyYWRpby5jaGFyYWN0ZXJpc3RpYycsIFtdLCBmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgcGFyYW1Nb2RlbCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4gICAgICAgIGlkQXR0cmlidXRlOiAnV2lkZ2V0UGFyYW1VSUQnLFxuICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgV2lkZ2V0UGFyYW1VSUQ6IG51bGwsXG4gICAgICAgICAgICBXaWRnZXRQYXJhbU5hbWU6ICcnLFxuICAgICAgICAgICAgV2lkZ2V0UGFyYW1WYWx1ZTogbnVsbFxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgY29sbGVjdGlvbnNQYXJhbXMgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7XG5cbiAgICAgICAgbW9kZWw6IHBhcmFtTW9kZWwsXG5cbiAgICAgICAgc3luYzogZnVuY3Rpb24gc3luYyhtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7XG5cbiAgICAgICAgICAgIEJhY2tib25lLk1vZGVsLnByb3RvdHlwZS5zeW5jLmFwcGx5KHRoaXMsIFsnY3JlYXRlJywgbW9kZWwsIG9wdGlvbnNdKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIGNoVyA9IE1uLk9iamVjdC5leHRlbmQoe1xuXG4gICAgICAgIGNoYW5uZWxOYW1lOiAnY2hXJyxcblxuICAgICAgICByYWRpb1JlcXVlc3RzOiB7XG5cbiAgICAgICAgICAgICdnZXQ6cGFyYW06bW9kZWwnOiBmdW5jdGlvbiBnZXRQYXJhbU1vZGVsKGEsIG4pIHtcblxuICAgICAgICAgICAgICAgIHZhciBwID0gXy5maW5kV2hlcmUoYSwgeyBXaWRnZXRQYXJhbU5hbWU6IG4gfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbSA9IG5ldyBwYXJhbU1vZGVsKHsgV2lkZ2V0UGFyYW1OYW1lOiBuIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHApIG0uc2V0KHApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnZ2V0OnBhcmFtczpjb2xsZWN0aW9uJzogZnVuY3Rpb24gZ2V0UGFyYW1zQ29sbGVjdGlvbih1aWQpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjID0gbmV3IGNvbGxlY3Rpb25zUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgYy51cmwgPSAnL2FwaS93aWRnZXQvJyArIHVpZCArICcvcGFyYW1zJztcblxuICAgICAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5ldyBjaFcoKTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdzZXR0MCcsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdnbG9iYWwuYmVoYXZpb3JzLmlucHV0J10sIGZ1bmN0aW9uIChSZXNvdXJjZXMsIElucHV0QmVoYXZpb3IpIHtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgYmVoYXZpb3JzOiB7XG4gICAgICAgICAgICBpbnB1dDogSW5wdXRCZWhhdmlvclxuICAgICAgICB9LFxuXG4gICAgICAgIGNsYXNzTmFtZTogJ2ctZm9ybS0taW5wdXQnLFxuICAgICAgICB0ZW1wbGF0ZTogJyNkYXNoYm9hcmQtc2V0dGluZ3MwJyxcbiAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7IFJlc291cmNlczogUmVzb3VyY2VzIH0sXG5cbiAgICAgICAgdWk6IHtcbiAgICAgICAgICAgIHRpdGxlOiAnaW5wdXRbbmFtZT1cInRpdGxlXCJdJ1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uU2F2ZTogZnVuY3Rpb24gb25TYXZlKCkge1xuICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHsgJ3RpdGxlJzogdGhpcy51aS50aXRsZS52YWwoKSB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24gb25DYW5jZWwoKSB7fSxcblxuICAgICAgICBtb2RlbEV2ZW50czoge1xuXG4gICAgICAgICAgICBpbnZhbGlkOiBmdW5jdGlvbiBpbnZhbGlkKCkge1xuICAgICAgICAgICAgICAgIHRoaXMudWkudGl0bGUuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkudGl0bGUucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCAzMDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfSk7XG59KTtcblxuZGVmaW5lKCdzZXR0MScsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdnL0ltYWdlR2FsbGVyeVZpZXcnLCAnUlUnLCAnc3luY2Z1c2lvbiddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCBHYWxsZXJ5KSB7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiAnI2Rhc2hib2FyZC1zZXR0aW5nczEnLFxuICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHsgUmVzb3VyY2VzOiBSZXNvdXJjZXMgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgYmdDb2xvcjogJ2lucHV0W25hbWU9QmFja2dyb3VuZENvbG9yXScsXG4gICAgICAgICAgICBwb3NpdGlvbjogJ2lucHV0W25hbWU9XCJCYWNrZ3JvdW5kUG9zaXRpb25cIl0nLFxuICAgICAgICAgICAgbGluazogJ2lucHV0W25hbWU9XCJCYWNrZ3JvdW5kSW1hZ2VMaW5rXCJdJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICBcImNsaWNrIEB1aS5wb3NpdGlvblwiOiBmdW5jdGlvbiBjbGlja1VpUG9zaXRpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kZXIuc2V0KCdCYWNrZ3JvdW5kUG9zaXRpb24nLCBwYXJzZUludCh0aGlzLiQoJ2lucHV0W25hbWU9QmFja2dyb3VuZFBvc2l0aW9uXTpjaGVja2VkJykudmFsKCkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBnYWxsZXJ5OiB7IGVsOiAnLmltYWdlLWdhbGxlcnknLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5zZW5kZXIgPSBuZXcgQmFja2JvbmUuTW9kZWwodGhpcy5tb2RlbC5nZXQoJ0RlY29yYXRpb24nKSB8fCB7XG4gICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAxKScsXG4gICAgICAgICAgICAgICAgQmFja2dyb3VuZEltYWdlTGluazogJ25vbmUnLFxuICAgICAgICAgICAgICAgIEJhY2tncm91bmRQb3NpdGlvbjogM1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2VuZGVyLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAobSwgdikge1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5wb3NpdGlvbi5maWx0ZXIoXCJbdmFsdWU9J1wiICsgdiArIFwiJ11cIikucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodiA9PT0gMykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRlci5zZXQoJ0JhY2tncm91bmRJbWFnZUxpbmsnLCAnbm9uZScpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbW8gPSB0aGlzLmdldENoaWxkVmlldygnZ2FsbGVyeScpLmNvbGxlY3Rpb24uZmluZFdoZXJlKHsgc2VsZWN0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAobW8pIG1vLnNldCgnc2VsZWN0JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcignY2hhbmdlOkRlY29yYXRpb24nLCB0aGlzLm1vZGVsLCB0aGlzLnNlbmRlci50b0pTT04oKSk7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnZ2FsbGVyeScsIG5ldyBHYWxsZXJ5KHsgc2VsZWN0ZWRJbWdQYXRoOiB0aGlzLnNlbmRlci5nZXQoJ0JhY2tncm91bmRJbWFnZUxpbmsnKSB9KSk7XG5cbiAgICAgICAgICAgIHZhciByZ2IgPSB7fSxcbiAgICAgICAgICAgICAgICB2YWwgPSB0aGlzLnNlbmRlci5nZXQoJ0JhY2tncm91bmRDb2xvcicpIHx8ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDEpJyxcbiAgICAgICAgICAgICAgICBhcnIgPSB2YWwuc3Vic3RyKHZhbC5pbmRleE9mKCcoJyksIHZhbC5pbmRleE9mKCcpJykpLnJlcGxhY2UoJygnLCAnJykucmVwbGFjZSgnKScsICcnKS5zcGxpdCgnLCcpO1xuXG4gICAgICAgICAgICBfLmVhY2goWydyJywgJ2cnLCAnYiddLCBmdW5jdGlvbiAobCwgaSkge1xuICAgICAgICAgICAgICAgIHJnYltsXSA9IHBhcnNlSW50KGFycltpXSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy51aS5iZ0NvbG9yLmVqQ29sb3JQaWNrZXIoe1xuICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnZy1jcCcsXG4gICAgICAgICAgICAgICAgbG9jYWxlOiBSZXNvdXJjZXMuTGFuZ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudWkuYmdDb2xvci5lakNvbG9yUGlja2VyKHtcblxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnVpLmJnQ29sb3IuZGF0YSgnZWpDb2xvclBpY2tlcicpLlJHQlRvSEVYKHJnYiksXG4gICAgICAgICAgICAgICAgb3BhY2l0eVZhbHVlOiBhcnJbM10gPyBwYXJzZUZsb2F0KGFyclszXSkgKiAxMDAgOiAxMDAsXG5cbiAgICAgICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKGFyZ3MpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMudWkuYmdDb2xvci5kYXRhKCdlakNvbG9yUGlja2VyJykuZ2V0Q29sb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kZXIuc2V0KCdCYWNrZ3JvdW5kQ29sb3InLCAncmdiYSgnICsgYy5yICsgJywgJyArIGMuZyArICcsICcgKyBjLmIgKyAnLCAnICsgYy5hICsgJyknKTtcbiAgICAgICAgICAgICAgICAgICAgLy90aGlzLm1vZGVsLnRyaWdnZXIoJ2NoYW5nZTpEZWNvcmF0aW9uJywgdGhpcy5tb2RlbCwgdGhpcy5zZW5kZXIudG9KU09OKCkpO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkNoaWxkdmlld0NoYW5nZUl0ZW06IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3Q2hhbmdlSXRlbShtb2RlbCkge1xuXG4gICAgICAgICAgICB0aGlzLnNlbmRlci5zZXQoe1xuICAgICAgICAgICAgICAgIEJhY2tncm91bmRJbWFnZUxpbms6IG1vZGVsLmdldCgnRmlsZVVybCcpLFxuICAgICAgICAgICAgICAgIEJhY2tncm91bmRQb3NpdGlvbjogdGhpcy5zZW5kZXIuZ2V0KCdCYWNrZ3JvdW5kUG9zaXRpb24nKSA9PT0gMyA/IDEgOiB0aGlzLnNlbmRlci5nZXQoJ0JhY2tncm91bmRQb3NpdGlvbicpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHsgRGVjb3JhdGlvbjogdGhpcy5zZW5kZXIudG9KU09OKCkgfSwge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kZXIudXJsID0gJy9hcGkvd2FsbC8nICsgci5pZCArICcvZGVjb3JhdGlvbic7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZGVyLnNhdmUoeyBpZDogci5pZCB9KTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbCgpIHtcblxuICAgICAgICAgICAgdGhpcy5zZW5kZXIgPSBuZXcgQmFja2JvbmUuTW9kZWwodGhpcy5tb2RlbC5nZXQoJ0RlY29yYXRpb24nKSB8fCB7XG4gICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAxKScsXG4gICAgICAgICAgICAgICAgQmFja2dyb3VuZEltYWdlTGluazogJ25vbmUnLFxuICAgICAgICAgICAgICAgIEJhY2tncm91bmRQb3NpdGlvbjogM1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcignY2hhbmdlOkRlY29yYXRpb24nLCB0aGlzLm1vZGVsLCB0aGlzLnNlbmRlci50b0pTT04oKSk7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pO1xuXG5kZWZpbmUoJ3NldHQyJywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMpIHtcblxuICAgIHZhciB0b29sc0ZvclVzZXJzID0gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRhZ05hbWU6ICdzcGFuJyxcbiAgICAgICAgY2xhc3NOYW1lOiAnZy1mb3JtLS1pbnB1dCcsXG5cbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzxpbnB1dCB0eXBlPVwidGV4dFwiIHZhbHVlPVwiXCIgaWQ9XCJ1bmluYW1lXCIgY2xhc3M9XCJnLWZvcm0tLWlucHV0XCIgcGxhY2Vob2xkZXI9XCI8JT0gUmVzb3VyY2VzLmFsaWFzICU+XCIgLz48bGFiZWwgZm9yPVwidW5pbmFtZVwiPjwlPSBSZXNvdXJjZXMuYWxpYXMgJT48L2xhYmVsPjxpIGNsYXNzPVwiYWRkIHJ0bC0xXCI+PC9pPicpLFxuXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgJ2NsaWNrIC5hZGQnOiAndXNlcjpjaGVjaydcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIHVzZXJDb2xsZWN0aW9uID0gTW4uQ29sbGVjdGlvblZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0YWdOYW1lOiAndGJvZHknLFxuXG4gICAgICAgIGVtcHR5VmlldzogTW4uVmlldy5leHRlbmQoe1xuICAgICAgICAgICAgdGFnTmFtZTogJ3RyJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8dGQgY29sc3Bhbj1cIjRcIj4nICsgUmVzb3VyY2VzLk4gKyAnPC90ZD4nKVxuICAgICAgICB9KSxcblxuICAgICAgICBjaGlsZFZpZXc6IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgdGFnTmFtZTogJ3RyJyxcblxuICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzx0ZD48JS0gVXNlclRpdGxlICU+PC90ZD48dGQ+PCU9IFVzZXJVSUQgJT48L3RkPjx0ZD48JS0gQWNjZXNzPyBSZXNvdXJjZXMucncgOiBSZXNvdXJjZXMucm8gJT48L3RkPjx0ZD48c3BhbiBjbGFzcz1cImNsZWFyXCIgZGF0YS1pY29uPVwiaWNvbi10cmFzaFwiPjwvc3Bhbj48L3RkPicpLFxuICAgICAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7IFJlc291cmNlczogUmVzb3VyY2VzIH0sXG5cbiAgICAgICAgICAgIHRyaWdnZXJzOiB7XG4gICAgICAgICAgICAgICAgJ2NsaWNrIC5jbGVhcic6ICdjbGVhcjppdGVtJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSxcblxuICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuICAgICAgICAgICAgJ2NsZWFyOml0ZW0nOiAnY2xlYXI6aXRlbSdcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICB2YXIgbGlzdFVzZXJzID0gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRhZ05hbWU6ICd0YWJsZScsXG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8dGhlYWQ+PHRyPjx0aD48JS0gUmVzb3VyY2VzLmRuYW1lICU+PC90aD48dGg+PCUtIFJlc291cmNlcy5sb2dpbiAlPjwvdGg+PHRoPjwlLSBSZXNvdXJjZXMuc2NvcGUgJT48L3RoPjx0aD48L3RoPjwvdHI+PC90aGVhZD48dGJvZHk+PC90Ym9keT48dGZvb3Q+PC90Zm9vdD4nKSxcbiAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7IFJlc291cmNlczogUmVzb3VyY2VzIH0sXG5cbiAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgdGJvZHk6IHsgZWw6ICd0Ym9keScsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ3Rib2R5JywgbmV3IHVzZXJDb2xsZWN0aW9uKHsgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uIH0pKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuICAgICAgICAgICAgJ2NsZWFyOml0ZW0nOiAnY2xlYXI6aXRlbSdcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICB2YXIgY2hlY2tlZFVzZXIgPSBNbi5WaWV3LmV4dGVuZCh7XG4gICAgICAgIHRhZ05hbWU6ICd0cicsXG5cbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzx0ZD48JS0gVXNlclRpdGxlICU+PC90ZD48dGQ+PCU9IFVzZXJVSUQgJT48L3RkPjx0ZD48c2VsZWN0IG5hbWU9XCJBY2Nlc3NcIj48b3B0aW9uIHZhbHVlPVwiMFwiPjwlLSBSZXNvdXJjZXMucm8gJT48L29wdGlvbj48b3B0aW9uIHZhbHVlPVwiMVwiPjwlLSBSZXNvdXJjZXMucncgJT48L29wdGlvbj48L3NlbGVjdD48L3RkPjx0ZD48c3BhbiBjbGFzcz1cImFkZFwiIGRhdGEtaWNvbj1cImljb24tcm91bmQtYWRkXCI+PC9zcGFuPjwvdGQ+JyksXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDogeyBSZXNvdXJjZXM6IFJlc291cmNlcyB9LFxuXG4gICAgICAgIHRyaWdnZXJzOiB7XG4gICAgICAgICAgICAnY2xpY2sgLmFkZCc6ICd1c2VyOmFkZCdcbiAgICAgICAgfSxcblxuICAgICAgICBvblVzZXJBZGQ6IGZ1bmN0aW9uIG9uVXNlckFkZCgpIHtcbiAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdBY2Nlc3MnLCBwYXJzZUludCh0aGlzLiQoJ3NlbGVjdFtuYW1lPUFjY2Vzc10nKS52YWwoKSkpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiAnI2Rhc2hib2FyZC1zZXR0aW5nczInLFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIHRvb2xzOiB7IGVsOiAnZGl2JywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIGNoZWNrOiB7IGVsOiAnLmNoZWNrZWQtdXNlcicsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICBsaXN0OiB7IGVsOiAnLmxpc3QnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW10sIHtcbiAgICAgICAgICAgICAgICBtb2RlbDogQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgICAgICAgICAgICAgaWRBdHRyaWJ1dGU6ICdVc2VySUQnLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgVXNlclVJRDogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyVGl0bGU6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgQWNjZXNzOiAwXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi51cmwgPSAnL2FwaS93YWxsLycgKyB0aGlzLm1vZGVsLmlkICsgJy91c2Vycyc7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29sbGVjdGlvbkV2ZW50czoge1xuICAgICAgICAgICAgYWRkOiBmdW5jdGlvbiBhZGQobSkge1xuICAgICAgICAgICAgICAgICQucG9zdCgnL2FwaS93YWxsLycgKyB0aGlzLm1vZGVsLmlkICsgJy9zaGFyZXdpdGgnLCBtLnRvSlNPTigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ3Rvb2xzJywgbmV3IHRvb2xzRm9yVXNlcnMoKSk7XG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2xpc3QnLCBuZXcgbGlzdFVzZXJzKHsgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uIH0pKTtcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5mZXRjaCh7IHJlc2V0OiB0cnVlIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNoaWxkVmlld0V2ZW50czoge1xuXG4gICAgICAgICAgICAndXNlcjphZGQnOiBmdW5jdGlvbiB1c2VyQWRkKHYpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFJlZ2lvbignY2hlY2snKS5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5hZGQodi5tb2RlbC50b0pTT04oKSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAndXNlcjpjaGVjayc6IGZ1bmN0aW9uIHVzZXJDaGVjaygpIHtcblxuICAgICAgICAgICAgICAgIHZhciAkdiA9IHRoaXMuZ2V0UmVnaW9uKCd0b29scycpLmN1cnJlbnRWaWV3LiQoJ2lucHV0Jyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJC50cmltKCR2LnZhbCgpKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IG5ldyBCYWNrYm9uZS5Nb2RlbCgpO1xuICAgICAgICAgICAgICAgICAgICBtLnVybCA9ICcvYXBpL3VzZXJzL2NoZWNrbmFtZT9uYW1lPScgKyAkdi52YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgbS5mZXRjaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtICYmIG0uZ2V0KCdVc2VySUQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2NoZWNrJywgbmV3IGNoZWNrZWRVc2VyKHsgbW9kZWw6IG0gfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdi52YWwoJycpLnJlbW92ZUNsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2LmFkZENsYXNzKCdlcnJvcicpLnZhbChSZXNvdXJjZXMubmYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2LnJlbW92ZUNsYXNzKCdlcnJvcicpLnZhbCgnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDUwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgJHYuYWRkQ2xhc3MoJ2Vycm9yJyk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJHYucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgfSwgNTAwMCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnY2xlYXI6aXRlbSc6IGZ1bmN0aW9uIGNsZWFySXRlbSh2KSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ3Nob3c6bWVzc2FnZTpjb25maXJtJywge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBSZXNvdXJjZXMuYXNreW91c3VyZSxcbiAgICAgICAgICAgICAgICAgICAgZng6IGZ1bmN0aW9uIGZ4KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdi5tb2RlbC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGN0eDogdGhpc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25TYXZlOiBmdW5jdGlvbiBvblNhdmUoKSB7fSxcblxuICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24gb25DYW5jZWwoKSB7fVxuXG4gICAgfSk7XG59KTtcblxuZGVmaW5lKCdzZXR0MycsIFsnYmFzZXVybCcsICdpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ2cvSW1hZ2VHYWxsZXJ5VmlldyddLCBmdW5jdGlvbiAoYmFzZXVybCwgUmVzb3VyY2VzLCBHYWxsZXJ5KSB7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiAnI2Rhc2hib2FyZC1zZXR0aW5nczMnLFxuICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHsgUmVzb3VyY2VzOiBSZXNvdXJjZXMgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgcHJlOiAnLnRodW1iLWltYWdlJ1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIGdhbGxlcnk6ICcudGh1bWItZ2FsbGVyeSdcbiAgICAgICAgfSxcblxuICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgJ2NoYW5nZSBpbnB1dFtuYW1lPXRodW1iXSc6IGZ1bmN0aW9uIGNoYW5nZUlucHV0TmFtZVRodW1iKGUpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMua2luZCA9ICQoZS50YXJnZXQpLnZhbCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMua2luZCAhPT0gJzMnKSB0aGlzLmhpZGVHYWxsZXJ5KCk7XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMua2luZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzAnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5wcmUuY3NzKCdiYWNrZ3JvdW5kJywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzEnOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnByZS5hcHBlbmQoJCgnPGkgY2xhc3M9XCJsb2FkaW5nXCIgc2l6ZT1cImxcIiBzcGVlZD1cInNsb3dcIj48L2k+JykpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlKFsnL2pzL2Rpc3QvaHRtbDJjYW52YXMubWluLmpzJ10sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sMmNhbnZhcyh0aGlzLm9wdGlvbnMuY29udGVudCkudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgdyA9IDIyMCwgaCA9IDE2MDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgaW1nID0gbmV3IEltYWdlKHcsIGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ltZy5zcmMgPSBjYW52YXMudG9EYXRhVVJMKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgY2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jYS53aWR0aCA9IHc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY2EuaGVpZ2h0ID0gaDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jYS5nZXRDb250ZXh0KFwiMmRcIikuZHJhd0ltYWdlKGltZywgMCwgMCwgdywgaCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZSA9IGNhbnZhcy50b0RhdGFVUkwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5wcmUuY3NzKHsgJ2JhY2tncm91bmQtaW1hZ2UnOiAndXJsKCcgKyB0aGlzLmltYWdlICsgJyknIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkucHJlLmZpbmQoJ2knKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzInOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJykgJiYgdGhpcy5tb2RlbC5nZXQoJ0RlY29yYXRpb24nKS5CYWNrZ3JvdW5kSW1hZ2VMaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJykuQmFja2dyb3VuZEltYWdlTGluaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnByZS5jc3MoeyAnYmFja2dyb3VuZC1pbWFnZSc6ICd1cmwoJyArIGJhc2V1cmwgKyAnL0ZpbGVzL0ltYWdlVHJhbnNmb3JtP3BhdGg9JyArIHRoaXMuaW1hZ2UgKyAnJndpZHRoPTIyMCZoZWlnaHQ9MTYwKScgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy50cmlnZ2VyTWV0aG9kKCdzaG93Om1lc3NhZ2UnLCBSZXNvdXJjZXMubm9zZWxlY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMyc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmltYWdlID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFJlZ2lvbignZ2FsbGVyeScpLiRlbC5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgICAgICAgdGhpcy5raW5kID0gJzAnO1xuICAgICAgICAgICAgdGhpcy5pbWFnZSA9ICcnO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdmFyIGZsYWcgPSAhIXRoaXMubW9kZWwuZ2V0KCdTY3JlZW4nKSAmJiB0aGlzLm1vZGVsLmdldCgnU2NyZWVuJykuaW5kZXhPZignZGF0YTppbWFnZScpID09PSAtMTtcblxuICAgICAgICAgICAgaWYgKGZsYWcpIHRoaXMudWkucHJlLmNzcyh7ICdiYWNrZ3JvdW5kLWltYWdlJzogJ3VybCgnICsgYmFzZXVybCArICcvRmlsZXMvSW1hZ2VUcmFuc2Zvcm0/cGF0aD0nICsgdGhpcy5tb2RlbC5nZXQoJ1NjcmVlbicpICsgJyZ3aWR0aD0yMjAmaGVpZ2h0PTE2MCknIH0pO2Vsc2UgdGhpcy51aS5wcmUuY3NzKHsgJ2JhY2tncm91bmQtaW1hZ2UnOiAndXJsKCcgKyB0aGlzLm1vZGVsLmdldCgnU2NyZWVuJykgKyAnKScgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnZ2FsbGVyeScsIG5ldyBHYWxsZXJ5KHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEltZ1BhdGg6IGZsYWcgPyB0aGlzLm1vZGVsLmdldCgnU2NyZWVuJykgOiAnJ1xuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICBpZiAoZmxhZyAmJiB0aGlzLm1vZGVsLmdldCgnU2NyZWVuJykgIT09IHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJykuQmFja2dyb3VuZEltYWdlTGluaykgdGhpcy5nZXRSZWdpb24oJ2dhbGxlcnknKS4kZWwuc2hvdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGVHYWxsZXJ5OiBmdW5jdGlvbiBoaWRlR2FsbGVyeSgpIHtcblxuICAgICAgICAgICAgdmFyIG0gPSB0aGlzLmdldENoaWxkVmlldygnZ2FsbGVyeScpLmNvbGxlY3Rpb24uZmluZFdoZXJlKHsgc2VsZWN0OiB0cnVlIH0pO1xuICAgICAgICAgICAgaWYgKG0pIG0uc2V0KCdzZWxlY3QnLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIHRoaXMuZ2V0UmVnaW9uKCdnYWxsZXJ5JykuJGVsLmhpZGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkNoaWxkdmlld0NoYW5nZUl0ZW06IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3Q2hhbmdlSXRlbShtb2RlbCkge1xuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IG1vZGVsLmdldCgnRmlsZVVybCcpO1xuICAgICAgICAgICAgdGhpcy51aS5wcmUuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJywgJ3VybCgnICsgYmFzZXVybCArICcvRmlsZXMvSW1hZ2VUcmFuc2Zvcm0/cGF0aD0nICsgbW9kZWwuZ2V0KCdGaWxlVXJsJykgKyAnJndpZHRoPTIyMCZoZWlnaHQ9MTYwKScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uU2F2ZTogZnVuY3Rpb24gb25TYXZlKGRpYWxvZykge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5raW5kID09PSAnMycgJiYgIXRoaXMuaW1hZ2UpIHRoaXMudHJpZ2dlck1ldGhvZCgnc2hvdzptZXNzYWdlJywgUmVzb3VyY2VzLm5vc2VsZWN0KTtlbHNlIHRoaXMubW9kZWwuc2F2ZSh7IFwiU2NyZWVuXCI6IHRoaXMuaW1hZ2UgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uIG9uQ2FuY2VsKCkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59KTtcblxuZGVmaW5lKCdARGFzaGJvYXJkc1ZpZXcnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnV2lkZ2V0TW9kZWwnLCAnQHdpZGdldC5XaWRnZXRWaWV3JywgJ2dsb2JhbC52aWV3LmRpYWxvZyddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCB3aWRnZXRNb2RlbCwgd2lkZ2V0VmlldywgZGlhbG9nKSB7XG5cbiAgICB2YXIgY2hhbm5lbFNlbGVjdCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ3NlbGVjdFdpZGdldCcpO1xuXG4gICAgdmFyIHNpZGVCYXJDb2xsZWN0aW9uID0gW3sgaWQ6ICdzZXR0MCcsIHRpdGxlOiBSZXNvdXJjZXMubXNkMCwgaWNvbjogJ2dlYXInIH0sIHsgaWQ6ICdzZXR0MScsIHRpdGxlOiBSZXNvdXJjZXMubXNkMSwgaWNvbjogJ2FwcGVhcmFuY2UnIH0sIHsgaWQ6ICdzZXR0MicsIHRpdGxlOiBSZXNvdXJjZXMubXNkMiwgaWNvbjogJ3Blcm1pc3Npb24nIH0sIHsgaWQ6ICdzZXR0MycsIHRpdGxlOiBSZXNvdXJjZXMubXNkMywgaWNvbjogJ3RodW1iJyB9XTtcblxuICAgIHJldHVybiBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNsYXNzTmFtZTogJ21haW4tY29udGFpbmVyJyxcblxuICAgICAgICBvblJlbmRlckNoaWxkcmVuOiBmdW5jdGlvbiBvblJlbmRlckNoaWxkcmVuKCkge1xuXG4gICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ2Rhc2hib2FyZHM6Y29udGFpbmVyOmZ1bGwnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXc6IE1uLkNvbGxlY3Rpb25WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbnRlbnQnLFxuXG4gICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW10sIHsgbW9kZWw6IHdpZGdldE1vZGVsIH0pO1xuICAgICAgICAgICAgICAgIC8vdGhpcy5jb2xsZWN0aW9uLmNvbXBhcmF0b3IgPSBmdW5jdGlvbiAodykgeyByZXR1cm4gdy5nZXQoXCJ0b3BcIikgKiAxMDAgKyB3LmdldChcImxlZnRcIik7IH07XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLnVybCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcvYXBpL3dhbGwvJyArIHRoaXMubW9kZWwuaWQ7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZXZlbnRzOiB7XG4gICAgICAgICAgICAgICAgJ3RvdWNoc3RhcnQnOiAnb25FbXB0eScsXG4gICAgICAgICAgICAgICAgJ2NsaWNrJzogJ29uRW1wdHknXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvbkVtcHR5OiBmdW5jdGlvbiBvbkVtcHR5KGUpIHtcblxuICAgICAgICAgICAgICAgIGlmICghJChlLnRhcmdldCkuY2xvc2VzdCgnLmFuYnItd2lkZ2V0JykuZ2V0KDApKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyTWV0aG9kKCdzZWxlY3Q6b25lJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnc2lkZWJhcicpLnJlcXVlc3QoJ29wZW4nLCB7IG5hbWVWaWV3OiB0aGlzLm1vZGVsLmdldCgndGl0bGUnKSwgdmlldzogdGhpcywgdGl0bGU6IFJlc291cmNlcy5kYnMgfSwgc2lkZUJhckNvbGxlY3Rpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNob3dTaWRlQmFyOiBmdW5jdGlvbiBzaG93U2lkZUJhcigpIHtcblxuICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ3NpZGViYXInKS50cmlnZ2VyKCdzaG93Jyk7XG4gICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnc2lkZWJhcicpLnJlcXVlc3QoJ29wZW4nLCB7IG5hbWVWaWV3OiB0aGlzLm1vZGVsLmdldCgndGl0bGUnKSwgdmlldzogdGhpcywgdGl0bGU6IFJlc291cmNlcy5kYnMgfSwgc2lkZUJhckNvbGxlY3Rpb24pO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc2lkZUJhclRyaWdnZXI6IGZ1bmN0aW9uIHNpZGVCYXJUcmlnZ2VyKG0pIHtcblxuICAgICAgICAgICAgICAgIHZhciBjb250cm9scyA9IG0uaWQgPT09ICdzZXR0MicgPyBbXSA6IFt7IGlkOiAnb25TYXZlJywgdGl0bGU6IFJlc291cmNlcy5zYXZlLCBjbGFzc05hbWU6ICdyaWdodCBibHVlIG5lc3QtcmlnaHQnIH0sIHsgaWQ6ICdvbkNhbmNlbCcsIHRpdGxlOiBSZXNvdXJjZXMuY2FuY2VsLCBjbGFzc05hbWU6ICdyaWdodCcgfV07XG5cbiAgICAgICAgICAgICAgICByZXF1aXJlKFttLmlkXSwgZnVuY3Rpb24gKHNldFZpZXcpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZGlhbG9nT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICdnZWFyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ3NldHRpbmdzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLm1vZGVsLmlkID8gbS5nZXQoJ3RpdGxlJykgOiBSZXNvdXJjZXMuYWRkVml0cmluLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogbmV3IHNldFZpZXcoeyBtb2RlbDogdGhpcy5tb2RlbCwgY29udGVudDogdGhpcy4kZWwgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBmb290ZXI6IGNvbnRyb2xzXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnTm90aWZ5JykucmVxdWVzdCgnc2hvdzpvdmVybGF5Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkaWFsb2cgPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdOb3RpZnknKS5yZXF1ZXN0KCdvbmNlOmRpYWxvZycsIGRpYWxvZ09wdGlvbnMpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuVG8oZGlhbG9nLCAnZm9vdGVyOmJ1dHRvbjpjbGljaycsIGZ1bmN0aW9uIChhKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLm1vZGVsLmlkID09PSAnb25TYXZlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZGlhbG9nT3B0aW9ucy5jb250ZW50Lm9uU2F2ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nLiRlbC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnTm90aWZ5JykucmVxdWVzdCgnaGlkZTpvdmVybGF5Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLm1vZGVsLmlkID09PSAnb25DYW5jZWwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9kaWFsb2dPcHRpb25zLmNvbnRlbnQub25DYW5jZWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdOb3RpZnknKS5yZXF1ZXN0KCdoaWRlOm92ZXJsYXknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU5ldyhkaWFsb2cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RlblRvKGRpYWxvZywgJ2RpYWxvZzpjbG9zZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU5ldyhkaWFsb2cpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RlblRvKGRpYWxvZywgJ2RldGFjaCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ05vdGlmeScpLnJlcXVlc3QoJ2hpZGU6b3ZlcmxheScpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVtb3ZlTmV3OiBmdW5jdGlvbiByZW1vdmVOZXcoZGlhbG9nKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAvL2RpYWxvZy4kZWwuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAvL0JhY2tib25lLlJhZGlvLmNoYW5uZWwoJ05vdGlmeScpLnJlcXVlc3QoJ2hpZGU6b3ZlcmxheScpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdjdXJyZW50JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbGxlY3Rpb24ucmVtb3ZlKHRoaXMubW9kZWwpO1xuXG4gICAgICAgICAgICAgICAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoJycsIHsgdHJpZ2dlcjogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvblJlbmRlckNoaWxkcmVuOiBmdW5jdGlvbiBvblJlbmRlckNoaWxkcmVuKCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fbG9hZFdpZGdldHMoMCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgICAgICBCYWNrYm9uZS5vbihcIndpbmRvdzpyZXNpemVlbmRcIiwgZnVuY3Rpb24gKCkge30sIHRoaXMpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgX2xvYWRXaWRnZXRzOiBmdW5jdGlvbiBfbG9hZFdpZGdldHMoY291bnQpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IGNvdW50KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzLmNoaWxkcmVuLmZpbmRCeUluZGV4KGNvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgY291bnQrKztcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RlblRvT25jZSh2LCAnbG9hZDplbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkV2lkZ2V0cyhjb3VudCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gdi5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHAuSXNJbnZhbGlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHYudWkubG9hZC5odG1sKCc8cD48aSBzdHlsZT1cImNvbG9yOnJlZDtcIj4nICsgUmVzb3VyY2VzLmlyZGIgKyAnPC9pPjwvcD4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHYudHJpZ2dlcignbG9hZDplbmQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHYub25Mb2FkKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ01vZGUnKS5yZXF1ZXN0KCdlbmFibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzaG93OiBmdW5jdGlvbiBzaG93KCkge1xuXG4gICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnTW9kZScpLnJlcXVlc3QoJ3Nob3cnLCAhdGhpcy5tb2RlbC5nZXQoXCJJc1NoYXJlZFwiKSk7XG4gICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnTW9kZScpLnJlcXVlc3QoJ2xlZnQ6aW5pdDptb2RlbCcsIHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKCdjaGFuZ2U6RGVjb3JhdGlvbicsIHRoaXMubW9kZWwsIHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJykpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNGZXRjaCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdNb2RlJykucmVxdWVzdCgnZW5hYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLnRyaWdnZXIoJ21lc3NhZ2U6bW9kYWwnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5mZXRjaCh7IHJlc2V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0ZldGNoID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ01vZGUnKS5yZXF1ZXN0KCdlbmFibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U2lkZUJhcigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNpZGVCYXJUcmlnZ2VyKHNpZGVCYXJDb2xsZWN0aW9uWzBdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLiRlbC5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmF0aW8gPSAkKHdpbmRvdykud2lkdGgoKSAvIHRoaXMuJGVsLndpZHRoKCk7XG4gICAgICAgICAgICAgICAgJCgnaGVhZCBtZXRhW25hbWU9dmlld3BvcnRdJykuYXR0cignY29udGVudCcsICd3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9JyArIChyYXRpbyA8IDEgPyByYXRpbyA6ICcxLjAnKSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBjb2xsZWN0aW9uRXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShjLCBvKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG8uYWRkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gby5jaGFuZ2VzLmFkZGVkWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLmNoaWxkcmVuLmZpbmRCeU1vZGVsKG0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2LnN3aXRjaE1vZGUodHJ1ZSkub25Mb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ3NlbGVjdDpvbmUnLCBtKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdi5fYWRkU2V0dGluZ3MoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnc2lkZWJhcicpLnJlcXVlc3QoJ29wZW4nLCB7IG5hbWVWaWV3OiB2Lm1vZGVsLmdldCgndGl0bGUnKSwgdmlldzogdi5nZXRDaGlsZFZpZXcoJ3NldHRpbmdzJyksIHRpdGxlOiBSZXNvdXJjZXMud3N0IH0sIHYuZ2V0Q2hpbGRWaWV3KCdzZXR0aW5ncycpLmdldE1lbnUoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHtcblxuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdzaWRlYmFyJykucmVxdWVzdCgnb3BlbicsIHsgbmFtZVZpZXc6IHRoaXMubW9kZWwuZ2V0KCd0aXRsZScpLCB2aWV3OiB0aGlzLCB0aXRsZTogUmVzb3VyY2VzLmRicyB9LCBzaWRlQmFyQ29sbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHtcblxuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdNb2RlJykucmVxdWVzdCgnZW5hYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKCdtZXNzYWdlOmhpZGUnKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKCkge1xuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKCdtZXNzYWdlOmhpZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBtb2RlbEV2ZW50czoge1xuXG4gICAgICAgICAgICAgICAgJ2NoYW5nZTppZCc6IGZ1bmN0aW9uIGNoYW5nZUlkKG0sIGlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5oaXN0b3J5Lm5hdmlnYXRlKGlkLCB7IHRyaWdnZXI6IGZhbHNlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnTW9kZScpLnJlcXVlc3QoJ2VuYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ01vZGUnKS5yZXF1ZXN0KCd0dXJuOnN3aXRjaCcsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICdjaGFuZ2U6Y3VycmVudCc6IGZ1bmN0aW9uIGNoYW5nZUN1cnJlbnQobSwgdikge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ01vZGUnKS5yZXF1ZXN0KCd0dXJuOnN3aXRjaCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQod2luZG93KS5zY3JvbGxUb3AoMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUobS5pZCB8fCAnbmV3JywgeyB0cmlnZ2VyOiAhbS5pZCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5yZW1vdmVDbGFzcygnZWRpdC1tb2RlJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICdjaGFuZ2U6RGVjb3JhdGlvbic6IGZ1bmN0aW9uIGNoYW5nZURlY29yYXRpb24obSwgZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3NzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmFja2dyb3VuZC1jb2xvclwiOiBkLkJhY2tncm91bmRDb2xvcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhY2tncm91bmQtaW1hZ2VcIjogZC5CYWNrZ3JvdW5kSW1hZ2VMaW5rID8gXCJ1cmwoJ1wiICsgZC5CYWNrZ3JvdW5kSW1hZ2VMaW5rICsgXCInKVwiIDogXCJub25lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiYWNrZ3JvdW5kLWF0dGFjaG1lbnRcIjogXCJmaXhlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmFja2dyb3VuZC1yZXBlYXRcIjogXCJuby1yZXBlYXRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhY2tncm91bmQtcG9zaXRpb25cIjogXCI1MCUgNTAlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiYWNrZ3JvdW5kLXNpemVcIjogXCJhdXRvXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLkJhY2tncm91bmRQb3NpdGlvbiA9PT0gMSkgY3NzW1wiYmFja2dyb3VuZC1zaXplXCJdID0gXCJjb3ZlclwiO2Vsc2UgaWYgKGQuQmFja2dyb3VuZFBvc2l0aW9uID09PSAyKSBjc3NbXCJiYWNrZ3JvdW5kLXJlcGVhdFwiXSA9IFwicmVwZWF0XCI7ZWxzZSBpZiAoZC5CYWNrZ3JvdW5kUG9zaXRpb24gPT09IDMpIGNzc1tcImJhY2tncm91bmQtaW1hZ2VcIl0gPSBcIm5vbmVcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuY3NzKGNzcyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtLnNldCgnRGVjb3JhdGlvbicsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDEpJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kSW1hZ2VMaW5rOiAnbm9uZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFBvc2l0aW9uOiAzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGNoaWxkVmlldzogd2lkZ2V0VmlldyxcblxuICAgICAgICAgICAgY2hpbGRWaWV3RXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAnd2lkZ2V0OmRyYWcnOiBmdW5jdGlvbiB3aWRnZXREcmFnKG0sIGxlZnQsIHRvcCwgaXNTYXZlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uICh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2LiRlbC5oYXNDbGFzcyhcIndpZGdldC1lZGl0aW5nXCIpICYmIHYubW9kZWwuaWQgIT09IG0uaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gdi4kZWwucG9zaXRpb24oKS50b3AsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwgPSB2LiRlbC5wb3NpdGlvbigpLmxlZnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCA8IDApIHQgPSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsIDwgMCkgbCA9IDM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Lm1vZGVsLnNldCh7IHRvcDogdCArIHRvcCwgbGVmdDogbCArIGxlZnQgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNTYXZlKSB2LnBvc2l0aW9uLnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICdmaXg6c2l6ZSc6IGZ1bmN0aW9uIGZpeFNpemUobSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRlbC53aWR0aCgpIDwgbS5nZXQoJ2xlZnQnKSArIG0uZ2V0KCd3aWR0aCcpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLndpZHRoKG0uZ2V0KCdsZWZ0JykgKyBtLmdldCgnd2lkdGgnKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByYXRpbyA9ICQod2luZG93KS53aWR0aCgpIC8gdGhpcy4kZWwud2lkdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2hlYWQgbWV0YVtuYW1lPXZpZXdwb3J0XScpLmF0dHIoJ2NvbnRlbnQnLCAnd2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPScgKyAocmF0aW8gPCAxID8gcmF0aW8gOiAnMS4wJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGVsLmhlaWdodCgpIDwgbS5nZXQoJ3RvcCcpICsgbS5nZXQoJ2hlaWdodCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5oZWlnaHQobS5nZXQoJ3RvcCcpICsgbS5nZXQoJ2hlaWdodCcpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgY2hpbGRWaWV3VHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICAgICAnc2VsZWN0Om1vcmUnOiAnc2VsZWN0Om1vcmUnLFxuICAgICAgICAgICAgICAgICdzZWxlY3Q6b25lJzogJ3NlbGVjdDpvbmUnXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLFxuXG4gICAgICAgIGNoaWxkVmlld1RyaWdnZXJzOiB7XG4gICAgICAgICAgICAnc2VsZWN0Om1vcmUnOiAnc2VsZWN0Om1vcmU6d2lkZ2V0JyxcbiAgICAgICAgICAgICdzZWxlY3Q6b25lJzogJ3NlbGVjdDpvbmU6d2lkZ2V0J1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdEZWNvcmF0aW9uVmlldycsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdnL0ltYWdlR2FsbGVyeVZpZXcnLCAnc3BlY3RydW1Db2xvclZpZXcnXSwgZnVuY3Rpb24gKFJlc291cmNlcywgR2FsbGVyeSwgU3BlY3RydW1Db2xvcikge1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBjbGFzc05hbWU6IFwiVml0cmluRGVjb3JhdGlvblwiLFxuXG4gICAgICAgIHRlbXBsYXRlOiAnI2RlY29yYXRpb24tYm9hcmQnLFxuXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgYmdDb2xvcjogJ2lucHV0W25hbWU9QmFja2dyb3VuZENvbG9yXScsXG4gICAgICAgICAgICBwb3NpdGlvbjogJ2lucHV0W25hbWU9XCJCYWNrZ3JvdW5kUG9zaXRpb25cIl0nLFxuICAgICAgICAgICAgbGluazogJ2lucHV0W25hbWU9XCJCYWNrZ3JvdW5kSW1hZ2VMaW5rXCJdJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICBcImNsaWNrIEB1aS5wb3NpdGlvblwiOiBmdW5jdGlvbiBjbGlja1VpUG9zaXRpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ0JhY2tncm91bmRQb3NpdGlvbicsIHBhcnNlSW50KHRoaXMuJCgnaW5wdXRbbmFtZT1CYWNrZ3JvdW5kUG9zaXRpb25dOmNoZWNrZWQnKS52YWwoKSkpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgXCJjbGljayAuaWNvbi1jbGVhclwiOiBmdW5jdGlvbiBjbGlja0ljb25DbGVhcigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVpLmxpbmsudmFsKFwiXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIGdhbGxlcnk6IHsgZWw6ICcuaW1hZ2UtZ2FsbGVyeScsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnZ2FsbGVyeScsIG5ldyBHYWxsZXJ5KHsgc2VsZWN0ZWRJbWdQYXRoOiB0aGlzLm1vZGVsLmdldCgnQmFja2dyb3VuZEltYWdlTGluaycpIH0pKTtcblxuICAgICAgICAgICAgdGhpcy5jb2xvciA9IG5ldyBTcGVjdHJ1bUNvbG9yKHsgZWw6IHRoaXMuJCgnaW5wdXQuRGVjb3JhdGlvbicpIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMuY29sb3IsIFwiY2hhbmdlOmNvbG9yXCIsIGZ1bmN0aW9uICgkZWxtLCB2cmdiYSwgYSkge1xuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdCYWNrZ3JvdW5kQ29sb3InLCB2cmdiYSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkNoaWxkdmlld0NoYW5nZUl0ZW06IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3Q2hhbmdlSXRlbShtb2RlbCkge1xuICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoe1xuICAgICAgICAgICAgICAgIEJhY2tncm91bmRJbWFnZUxpbms6IG1vZGVsLmdldCgnRmlsZVVybCcpLFxuICAgICAgICAgICAgICAgIEJhY2tncm91bmRQb3NpdGlvbjogdGhpcy5tb2RlbC5nZXQoJ0JhY2tncm91bmRQb3NpdGlvbicpID09PSAzID8gMSA6IHRoaXMubW9kZWwuZ2V0KCdCYWNrZ3JvdW5kUG9zaXRpb24nKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbW9kZWxFdmVudHM6IHtcblxuICAgICAgICAgICAgJ2NoYW5nZTpCYWNrZ3JvdW5kUG9zaXRpb24nOiBmdW5jdGlvbiBjaGFuZ2VCYWNrZ3JvdW5kUG9zaXRpb24obSwgdikge1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5wb3NpdGlvbi5maW5kKFwiW3ZhbHVlPSdcIiArIHYgKyBcIiddXCIpLnByb3AoXCJjaGVja2VkXCIsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHYgPT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ0JhY2tncm91bmRJbWFnZUxpbmsnLCAnbm9uZScpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IHRoaXMuZ2V0Q2hpbGRWaWV3KCdnYWxsZXJ5JykuY29sbGVjdGlvbi5maW5kV2hlcmUoeyBzZWxlY3Q6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtKSBtLnNldCgnc2VsZWN0JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdjaGFuZ2U6QmFja2dyb3VuZENvbG9yJzogZnVuY3Rpb24gY2hhbmdlQmFja2dyb3VuZENvbG9yKG0sIHYpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yLiRlbC5zcGVjdHJ1bShcInNldFwiLCB2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ0BGaXJzdFZpZXcnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnYmFzZXVybCddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCBiYXNldXJsKSB7XG5cbiAgICB2YXIgbGlzdFZpZXcgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNsYXNzTmFtZTogJ2xpc3QnLFxuXG4gICAgICAgIGVtcHR5VmlldzogTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdjcmVhdGUnLFxuXG4gICAgICAgICAgICBnZXRUZW1wbGF0ZTogZnVuY3Rpb24gZ2V0VGVtcGxhdGUoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZsYWcgPT09ICdteScpIHJldHVybiBfLnRlbXBsYXRlKCc8c2VjdGlvbj48c3BhbiBjbGFzcz1cImZvbnQtaWNvbiBmb250LWljb24tYWRkXCI+PC9zcGFuPjxzcGFuPjwlLSBSZXNvdXJjZXMuYWRkVml0cmluICU+PC9zcGFuPjwvc2VjdGlvbj4nKTtlbHNlIHJldHVybiBfLnRlbXBsYXRlKCcnKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgICAgIFJlc291cmNlczogUmVzb3VyY2VzXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgICAgICdjbGljayc6IGZ1bmN0aW9uIGNsaWNrKCkge1xuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5oaXN0b3J5Lm5hdmlnYXRlKHYubW9kZWwuaWQgfHwgJ25ldycsIHsgdHJpZ2dlcjogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KSxcblxuICAgICAgICBjaGlsZFZpZXc6IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgdGVtcGxhdGU6ICcjZmlyc3QtaXRlbS10ZW1wbGF0ZScsXG4gICAgICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICBiYXNldXJsOiBiYXNldXJsXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgICAgIC8vJ3RvdWNoZW5kJzogJ2NsaWNrOml0ZW0nLFxuICAgICAgICAgICAgICAgICdjbGljayc6ICdjbGljazppdGVtJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAnY2xpY2sgaS5yZW1vdmUnOiBmdW5jdGlvbiBjbGlja0lSZW1vdmUoZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgQmFja2JvbmUudHJpZ2dlcihcIm1lc3NhZ2U6Y29uZmlybVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogUmVzb3VyY2VzLmFza3lvdXN1cmUsIG1lc3NhZ2U6ICQuRm9ybWF0KFJlc291cmNlcy5kZWx0ZXh0LCBSZXNvdXJjZXMudG9kYXNoYm9hcmQsIHRoaXMubW9kZWwuZ2V0KFwidGl0bGVcIikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZng6IGZ1bmN0aW9uIGZ4KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eDogdGhpc1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIG1vZGVsRXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAnY2hhbmdlOlNjcmVlbic6IGZ1bmN0aW9uIGNoYW5nZVNjcmVlbihtLCB2KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSxcblxuICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuICAgICAgICAgICAgJ2NsaWNrOml0ZW0nOiAnY2xpY2s6aXRlbSdcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdPcHRpb25zOiBmdW5jdGlvbiBjaGlsZFZpZXdPcHRpb25zKCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZmxhZzogdGhpcy5vcHRpb25zLmZsYWcgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uIGZpbHRlcihtKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmZsYWcgPT09ICdteScgPyAhbS5nZXQoJ0lzU2hhcmVkJykgOiBtLmdldCgnSXNTaGFyZWQnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlckNoaWxkcmVuOiBmdW5jdGlvbiBvblJlbmRlckNoaWxkcmVuKCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZsYWcgPT09ICdteScpIHtcblxuICAgICAgICAgICAgICAgIHZhciBhZGRWaWV3ID0gTW4uVmlldy5leHRlbmQoe1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjcmVhdGUnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPHNlY3Rpb24+PHNwYW4gY2xhc3M9XCJmb250LWljb24gZm9udC1pY29uLWFkZFwiPjwvc3Bhbj48c3Bhbj48JS0gUmVzb3VyY2VzLmFkZFZpdHJpbiAlPjwvc3Bhbj48L3NlY3Rpb24+JyksXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRDaGlsZFZpZXcobmV3IGFkZFZpZXcoeyBtb2RlbDogbmV3IEJhY2tib25lLk1vZGVsKHsgaWQ6ICdjcmVhdGUnIH0pIH0pLCAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB0aGlzLiQoJ2kucmVtb3ZlJykuaGlkZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdGhpcy4kZWwuc29ydGFibGUoe1xuXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwicGxhY2Vob2xkZXItY2xhc3NcIixcbiAgICAgICAgICAgICAgICBpdGVtczogXCJkaXY6bm90KC5jcmVhdGUpXCIsXG4gICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKGUsIHVpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnc29ydDpzdG9wJywgYXJncywgdGhpcyk7XG5cbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcblxuICAgICAgICAgICAgfSkuZGlzYWJsZVNlbGVjdGlvbigpO1xuICAgICAgICB9XG5cbiAgICB9KTtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6ICcjZmlyc3QtcGFnZS10ZW1wbGF0ZScsXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgdGl0bGU6ICdoMSdcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBsaXN0OiB7IGVsOiAnLmxpc3QnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICd0b3VjaHN0YXJ0IGJ1dHRvbic6ICd0YWJOYXYnLFxuICAgICAgICAgICAgJ2NsaWNrIGJ1dHRvbic6ICd0YWJOYXYnLFxuXG4gICAgICAgICAgICAnY2xpY2sgLmNyZWF0ZSc6IGZ1bmN0aW9uIGNsaWNrQ3JlYXRlKCkge1xuICAgICAgICAgICAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoJ25ldycsIHsgdHJpZ2dlcjogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIHRhYk5hdjogZnVuY3Rpb24gdGFiTmF2KGUpIHtcblxuICAgICAgICAgICAgdmFyIGxpbmsgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCdidXR0b24nKS5hdHRyKCdkYXRhLWxpbmsnKTtcbiAgICAgICAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUobGluayA9PT0gJ3NoYXJlZCcgPyAnZGVtbycgOiAnJywgeyB0cmlnZ2VyOiB0cnVlIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQmVmb3JlUmVuZGVyOiBmdW5jdGlvbiBvbkJlZm9yZVJlbmRlcigpIHtcbiAgICAgICAgICAgIHRoaXMuJGVsLmF0dHIoJ2lkJywgJ2ZpcnN0LXBhZ2UnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbGlzdCcsIG5ldyBsaXN0Vmlldyh7IGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbiwgZmxhZzogdGhpcy5vcHRpb25zLmZpbHRlciB9KSk7XG5cbiAgICAgICAgICAgIHZhciByZXMgPSB7XG4gICAgICAgICAgICAgICAgbXk6IFJlc291cmNlcy5teURhc2hib2FyZCxcbiAgICAgICAgICAgICAgICBzaGFyZWQ6IFJlc291cmNlcy5zaGFyZURhc2hib2FyZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy4kKFwiYnV0dG9uW2RhdGEtbGluaz0nXCIgKyB0aGlzLm9wdGlvbnMuZmlsdGVyICsgXCInXVwiKS5hZGRDbGFzcyhcInByZXNzZWRcIik7XG5cbiAgICAgICAgICAgIHRoaXMudWkudGl0bGUudGV4dChyZXNbdGhpcy5vcHRpb25zLmZpbHRlcl0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2hpbGR2aWV3Q2xpY2tJdGVtOiBmdW5jdGlvbiBvbkNoaWxkdmlld0NsaWNrSXRlbSh2KSB7XG5cbiAgICAgICAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUodi5tb2RlbC5pZCB8fCAnbmV3JywgeyB0cmlnZ2VyOiB0cnVlIH0pO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdtYWluVmlldycsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdARmlyc3RWaWV3JywgJ0BTbGlkZXJWaWV3JywgJ0BEYXNoYm9hcmRzVmlldycsICdsZWZ0UGFuZWwnLCAndG9wUGFuZWwnLCAnZ2xvYmFsLnJhZGlvLnNpZGVCYXInXSwgZnVuY3Rpb24gKFJlc291cmNlcywgZmlyc3RWaWV3LCBzbGlkZXJWaWV3LCBkYXNoYm9hcmRzVmlldywgbGVmdFBhbmVsLCB0b3BQYW5lbCkge1xuXG4gICAgdmFyIG1vZGVDaGFubmVsID0gTW4uT2JqZWN0LmV4dGVuZCh7XG4gICAgICAgIGNoYW5uZWxOYW1lOiAnTW9kZSdcbiAgICB9KTtcblxuICAgIG5ldyBtb2RlQ2hhbm5lbCgpO1xuXG4gICAgdmFyIHNlbGVjdFdpZGdldCA9IE1uLk9iamVjdC5leHRlbmQoe1xuICAgICAgICBjaGFubmVsTmFtZTogJ3NlbGVjdFdpZGdldCdcbiAgICB9KTtcblxuICAgIG5ldyBzZWxlY3RXaWRnZXQoKTtcblxuICAgIHZhciBib2FyZE1vZGVsID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgICAgIGlkOiBudWxsLFxuICAgICAgICAgICAgdGl0bGU6IFJlc291cmNlcy50aXRsZSxcbiAgICAgICAgICAgIElzU2hhcmVkOiBmYWxzZSxcbiAgICAgICAgICAgIGN1cnJlbnQ6IGZhbHNlLFxuICAgICAgICAgICAgaXNJbml0OiBmYWxzZSxcbiAgICAgICAgICAgIFNjcmVlbjogJycsXG4gICAgICAgICAgICBEZWNvcmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAxKScsXG4gICAgICAgICAgICAgICAgQmFja2dyb3VuZEltYWdlTGluazogJ25vbmUnLFxuICAgICAgICAgICAgICAgIEJhY2tncm91bmRQb3NpdGlvbjogM1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIENEYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfSxcbiAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKGF0dHIsIG8pIHtcbiAgICAgICAgICAgIHZhciBvdXRwdXQgPSBbXTtcblxuICAgICAgICAgICAgaWYgKCEkLnRyaW0oYXR0ci50aXRsZSkpIG91dHB1dC5wdXNoKHsgbmFtZTogXCJ0aXRsZVwiIH0pO1xuXG4gICAgICAgICAgICBpZiAob3V0cHV0Lmxlbmd0aCkgcmV0dXJuIG91dHB1dDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIGJvYXJkQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHtcbiAgICAgICAgbW9kZWw6IGJvYXJkTW9kZWwsXG4gICAgICAgIHVybDogZnVuY3Rpb24gdXJsKCkge1xuICAgICAgICAgICAgcmV0dXJuICcvYXBpL3dhbGwvJztcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0ZW1wbGF0ZTogJyNtYWluLXRlbXBsYXRlJyxcbiAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7XG4gICAgICAgICAgICBSZXNvdXJjZXM6IFJlc291cmNlc1xuICAgICAgICB9LFxuXG4gICAgICAgIHVpOiB7XG4gICAgICAgICAgICBtb2RlOiAnLm1vZGUtaW5mbycsXG4gICAgICAgICAgICBzdzogJy5nLWZvcm0tLXN3aXRjaCdcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBmaXJzdDogeyBlbDogJyNmaXJzdCcsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICBjb250YWluZXI6IHsgZWw6ICcjY29udGFpbmVyJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIHRvcDogeyBlbDogJy5TaG5hJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIGxlZnQ6IHsgZWw6ICcjbGVmdC1wcm9wZXJ0eScsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICBzbGlkZXI6IHsgZWw6ICcjc2xpZGVyJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIGRpYWxvZzogeyBlbDogJyNkaWFsb2cnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdHJpZ2dlcnM6IHtcblxuICAgICAgICAgICAgJ2NsaWNrIEB1aS5tb2RlOm5vdCguZGlzYWJsZWQpIGJ1dHRvbic6ICdjbGljazptb2RlJ1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25DbGlja01vZGU6IGZ1bmN0aW9uIG9uQ2xpY2tNb2RlKCkge1xuICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnTW9kZScpLnJlcXVlc3QoJ3R1cm46c3dpdGNoJywgdGhpcy51aS5zdy5hdHRyKFwibW9kZVwiKSAhPT0gXCJvblwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuXG4gICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBuZXcgYm9hcmRDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uY29tcGFyYXRvciA9IGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1uZXcgRGF0ZShtLmdldCgnQ0RhdGUnKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgY2hhbm5lbE1vZGUgPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdNb2RlJyk7XG5cbiAgICAgICAgICAgIGNoYW5uZWxNb2RlLnJlcGx5KCdzaG93JywgZnVuY3Rpb24gKGZsYWcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmxhZykgdGhpcy51aS5tb2RlLnNob3coKTtlbHNlIHRoaXMudWkubW9kZS5oaWRlKCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICBjaGFubmVsTW9kZS5yZXBseSgnZW5hYmxlZCcsIGZ1bmN0aW9uIChmbGFnKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZsYWcpIHRoaXMudWkubW9kZS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtlbHNlIHRoaXMudWkubW9kZS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICAgIC8vIHN3aXRjaC1tb2RlXG4gICAgICAgICAgICBjaGFubmVsTW9kZS5yZXBseSgndHVybjpzd2l0Y2gnLCB0aGlzLnN3aXRjaE1vZGUuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICAgIC8vIHJlbmRlciBkaWFsb2dcbiAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ05vdGlmeScpLnJlcGx5KCdhZGQ6ZGlhbG9nJywgZnVuY3Rpb24gKGRpYWxvZykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0UmVnaW9uKCdkaWFsb2cnKS5oYXNWaWV3KCkpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IHRoaXMuZ2V0Q2hpbGRWaWV3KCdkaWFsb2cnKS4kZWwuaXMoJzp2aXNpYmxlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy9cblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5zaG93Q2hpbGRWaWV3KCdkaWFsb2cnLCBkaWFsb2cpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLnNob3dDaGlsZFZpZXcoJ2RpYWxvZycsIGRpYWxvZyk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQmVmb3JlUmVuZGVyOiBmdW5jdGlvbiBvbkJlZm9yZVJlbmRlcigpIHtcblxuICAgICAgICAgICAgQmFja2JvbmUudHJpZ2dlcignbWVzc2FnZTptb2RhbCcpO1xuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmZldGNoKHsgcmVzZXQ6IHRydWUgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ3RvcCcsIG5ldyB0b3BQYW5lbCgpKTtcbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbGVmdCcsIG5ldyBsZWZ0UGFuZWwoKSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnc2xpZGVyJywgbmV3IHNsaWRlclZpZXcoeyBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24gfSkpO1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2NvbnRhaW5lcicsIG5ldyBkYXNoYm9hcmRzVmlldyh7IGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbiB9KSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hpbGRWaWV3RXZlbnRzOiB7XG5cbiAgICAgICAgICAgICdyZW5kZXI6dml0cmluOmFmdGVyOmNsb25lOndpZGdldCc6IGZ1bmN0aW9uIHJlbmRlclZpdHJpbkFmdGVyQ2xvbmVXaWRnZXQobSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzLmdldENoaWxkVmlldygnY29udGFpbmVyJykuY2hpbGRyZW4uZmluZEJ5TW9kZWwobSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodi5pc0ZldGNoKSB2LmNvbGxlY3Rpb24uZmV0Y2goeyByZXNldDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdzZWxlY3Q6bW9yZTp3aWRnZXQnOiBmdW5jdGlvbiBzZWxlY3RNb3JlV2lkZ2V0KG0pIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCd0b3AnKS5nZXRDaGlsZFZpZXcoJ3Bvc2l0aW9uJykuY29sbGVjdGlvbi5hZGQobSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnc2VsZWN0Om9uZTp3aWRnZXQnOiBmdW5jdGlvbiBzZWxlY3RPbmVXaWRnZXQobSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHBvcyA9IHRoaXMuZ2V0Q2hpbGRWaWV3KCd0b3AnKS5nZXRDaGlsZFZpZXcoJ3Bvc2l0aW9uJyk7XG5cbiAgICAgICAgICAgICAgICBwb3MuY29sbGVjdGlvbi5yZXNldCgpO1xuICAgICAgICAgICAgICAgIGlmIChtKSBwb3MuY29sbGVjdGlvbi5hZGQobSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnZGFzaGJvYXJkczpjb250YWluZXI6ZnVsbCc6IGZ1bmN0aW9uIGRhc2hib2FyZHNDb250YWluZXJGdWxsKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNXYWl0U2hvdykgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnc2xpZGVyOm5ldzpkYXNoYm9hcmQnOiBmdW5jdGlvbiBzbGlkZXJOZXdEYXNoYm9hcmQoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnVpZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnc2hvdzpsZWZ0OnBhbmVsJzogZnVuY3Rpb24gc2hvd0xlZnRQYW5lbCgpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdsZWZ0Jykub25TaG93KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBzaG93Rmlyc3Q6IGZ1bmN0aW9uIHNob3dGaXJzdChmaWx0ZXIpIHtcblxuICAgICAgICAgICAgdGhpcy5nZXRSZWdpb24oJ2RpYWxvZycpLmVtcHR5KCk7XG5cbiAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ01vZGUnKS5yZXF1ZXN0KCdzaG93JywgZmFsc2UpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5nZXRSZWdpb24oJ2ZpcnN0JykuaGFzVmlldygpKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRDaGlsZFZpZXcoJ2ZpcnN0Jykub3B0aW9ucy5maWx0ZXIgIT09IGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnZmlyc3QnKS5vcHRpb25zLmZpbHRlciA9IGZpbHRlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2ZpcnN0JykucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdmaXJzdCcpLiRlbC5zaG93KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuZ2V0Q2hpbGRWaWV3KCdmaXJzdCcpLiRlbC5zbGlkZURvd24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB0aGlzLnNob3dDaGlsZFZpZXcoJ2ZpcnN0JywgbmV3IGZpcnN0Vmlldyh7IGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbiwgZmlsdGVyOiBmaWx0ZXIgfSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uU2hvdzogZnVuY3Rpb24gb25TaG93KCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5nZXRSZWdpb24oJ2ZpcnN0JykuaGFzVmlldygpKSB0aGlzLmdldENoaWxkVmlldygnZmlyc3QnKS4kZWwuc2xpZGVVcCgpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uLmxlbmd0aCkgdGhpcy5zaG93KCk7ZWxzZSB0aGlzLmlzV2FpdFNob3cgPSB0cnVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uIHNob3coKSB7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudWlkKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyQ3VycmVudCgpO1xuICAgICAgICAgICAgICAgIHZhciBtID0gdGhpcy5jb2xsZWN0aW9uLmdldCh0aGlzLm9wdGlvbnMudWlkKTtcblxuICAgICAgICAgICAgICAgIGlmIChtKSBtLnNldCgnY3VycmVudCcsIHRydWUpO2Vsc2Uge1xuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKCdtZXNzYWdlOndhcm5pbmcnLCB7IG1lc3NhZ2U6IFJlc291cmNlcy5kbnZ1IH0pO1xuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5oaXN0b3J5Lm5hdmlnYXRlKCcnLCB7IHRyaWdnZXI6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVnaW9uKCdkaWFsb2cnKS5lbXB0eSgpO1xuICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ01vZGUnKS5yZXF1ZXN0KCdlbmFibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdsZWZ0JykuJGVsLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ3RvcCcpLmdldENoaWxkVmlldygncG9zaXRpb24nKS5jb2xsZWN0aW9uLnJlc2V0KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSB0aGlzLmNvbGxlY3Rpb24uZmluZFdoZXJlKHsgaWQ6IG51bGwgfSkgfHwgbmV3IGJvYXJkTW9kZWwoKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5jb2xsZWN0aW9uID0gdGhpcy5jb2xsZWN0aW9uO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmFkZChtb2RlbCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyQ3VycmVudCgpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnNldCgnY3VycmVudCcsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzLmdldENoaWxkVmlldygnY29udGFpbmVyJykuY2hpbGRyZW4uZmluZEJ5TW9kZWwobW9kZWwpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCd0b3AnKS5vblNob3codik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29sbGVjdGlvbkV2ZW50czoge1xuXG4gICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZSgpIHtcblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb2xsZWN0aW9uLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMudWlkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNvbGxlY3Rpb24ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy51aWQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3coKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKCdtZXNzYWdlOmhpZGUnKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcigpIHtcbiAgICAgICAgICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKCdtZXNzYWdlOmhpZGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjbGVhckN1cnJlbnQ6IGZ1bmN0aW9uIGNsZWFyQ3VycmVudCgpIHtcblxuICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmNvbGxlY3Rpb24uZmluZFdoZXJlKHsgY3VycmVudDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIGlmIChjKSBjLnNldCgnY3VycmVudCcsIGZhbHNlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzd2l0Y2hNb2RlOiBmdW5jdGlvbiBzd2l0Y2hNb2RlKGZsYWcpIHtcblxuICAgICAgICAgICAgdmFyIG0gPSB0aGlzLmNvbGxlY3Rpb24uZmluZFdoZXJlKHsgY3VycmVudDogdHJ1ZSB9KSxcbiAgICAgICAgICAgICAgICB2ID0gdGhpcy5nZXRDaGlsZFZpZXcoJ2NvbnRhaW5lcicpLmNoaWxkcmVuLmZpbmRCeU1vZGVsKG0pO1xuXG4gICAgICAgICAgICBpZiAoZmxhZykge1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5zdy5hdHRyKFwibW9kZVwiLCBcIm9uXCIpO1xuICAgICAgICAgICAgICAgIHYuJGVsLmFkZENsYXNzKCdlZGl0LW1vZGUnKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCd0b3AnKS5vblNob3codik7XG5cbiAgICAgICAgICAgICAgICB2LnNob3dTaWRlQmFyKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBzaG93IGVkaXQgYnV0dG9uc1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdzbGlkZXInKS5nZXRDaGlsZFZpZXcoJ2xpc3QnKS5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdi5tb2RlbC5nZXQoJ0lzU2hhcmVkJykpIHYuJCgnc3BhbicpLmNzcyhcImRpc3BsYXlcIiwgXCJpbmxpbmUtYmxvY2tcIik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2LmNoaWxkcmVuLmVhY2goZnVuY3Rpb24gKHcpIHtcbiAgICAgICAgICAgICAgICAgICAgdy5zd2l0Y2hNb2RlKHRydWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHRoaXMudWkuc3cuYXR0cihcIm1vZGVcIiwgXCJvZmZcIik7XG4gICAgICAgICAgICAgICAgdi4kZWwucmVtb3ZlQ2xhc3MoJ2VkaXQtbW9kZScpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ3RvcCcpLiRlbC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2xlZnQnKS4kZWwucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAvL3RoaXMuZ2V0Q2hpbGRWaWV3KCdyaWdodCcpLiRlbC5yZW1vdmVDbGFzcygnc2hvdycpO1xuXG4gICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnc2lkZWJhcicpLnRyaWdnZXIoJ2hpZGUnKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVnaW9uKCdkaWFsb2cnKS5lbXB0eSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gaGlkZSBlZGl0IGJ1dHRvbnMgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdzbGlkZXInKS5nZXRDaGlsZFZpZXcoJ2xpc3QnKS5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2Lm1vZGVsLmlkKSB2LiQoJ3NwYW4nKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2LmNoaWxkcmVuLmVhY2goZnVuY3Rpb24gKHcpIHtcbiAgICAgICAgICAgICAgICAgICAgdy5zd2l0Y2hNb2RlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnQFNsaWRlclZpZXcnLCBbJ2Jhc2V1cmwnLCAnaTE4biFubHMvcmVzb3VyY2VzLm1pbiddLCBmdW5jdGlvbiAoYmFzZXVybCwgUmVzb3VyY2VzKSB7XG5cbiAgICB2YXIgVklUUklOQV9JVEVNX1dJRFRIID0gMjczO1xuXG4gICAgdmFyIHNsaWRlckxpc3QgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNsYXNzTmFtZTogJ3NsaWRlcicsXG5cbiAgICAgICAgY2hpbGRWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJ2aXRyaW5hXCIsXG5cbiAgICAgICAgICAgIHRlbXBsYXRlOiAnI3NsaWRlci1pdGVtLXRlbXBsYXRlJyxcbiAgICAgICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgICAgIGJhc2V1cmw6IGJhc2V1cmxcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICAgICAgLy8ndG91Y2hzdGFydCAucGFuZWwtdml0cmluJzogJ3NldEN1cnJlbnQnLFxuICAgICAgICAgICAgICAgICdjbGljayAucGFuZWwtdml0cmluJzogJ3NldEN1cnJlbnQnLFxuXG4gICAgICAgICAgICAgICAgJ2NsaWNrIC5kZWxldGUtdml0cmluYSc6IGZ1bmN0aW9uIGNsaWNrRGVsZXRlVml0cmluYSgpIHtcblxuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKFwibWVzc2FnZTpjb25maXJtXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBSZXNvdXJjZXMuYXNreW91c3VyZSwgbWVzc2FnZTogJC5Gb3JtYXQoUmVzb3VyY2VzLmRlbHRleHQsIFJlc291cmNlcy50b2Rhc2hib2FyZCwgdGhpcy5tb2RlbC5nZXQoXCJ0aXRsZVwiKSksXG4gICAgICAgICAgICAgICAgICAgICAgICBmeDogZnVuY3Rpb24gZngoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2N1cnJlbnQnKSkgdGhpcy5tb2RlbC5zZXQoJ2N1cnJlbnQnLCBmYWxzZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5oaXN0b3J5Lm5hdmlnYXRlKCcnLCB7IHRyaWdnZXI6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4OiB0aGlzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldEN1cnJlbnQ6IGZ1bmN0aW9uIHNldEN1cnJlbnQoKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMubW9kZWwuY29sbGVjdGlvbi5maW5kV2hlcmUoeyBjdXJyZW50OiB0cnVlIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGMpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5pZCAhPT0gYy5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYy5zZXQoJ2N1cnJlbnQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgnY3VycmVudCcsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMubW9kZWwuc2V0KCdjdXJyZW50JywgdHJ1ZSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBtb2RlbEV2ZW50czoge1xuXG4gICAgICAgICAgICAgICAgJ2NoYW5nZTpjdXJyZW50JzogZnVuY3Rpb24gY2hhbmdlQ3VycmVudChtLCB2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHYpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ2N1cnJlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlck1ldGhvZCgnc2xpZGVyOnJlbmRlcicsIHRoaXMuJGVsLmluZGV4KCkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2N1cnJlbnQnKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgJ2NoYW5nZTpTY3JlZW4nOiBmdW5jdGlvbiBjaGFuZ2VTY3JlZW4obSwgdikge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICdjaGFuZ2U6dGl0bGUnOiBmdW5jdGlvbiBjaGFuZ2VUaXRsZShtLCB2KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJCgnLm5hbWUtdml0cmluYScpLnRleHQodik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvbkRldGFjaDogZnVuY3Rpb24gb25EZXRhY2goKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyTWV0aG9kKCdzbGlkZXI6Ym9hcmQ6ZGV0YWNoZWQnLCB0aGlzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KSxcblxuICAgICAgICBjYWxjU3RlcDogZnVuY3Rpb24gY2FsY1N0ZXAoKSB7XG5cbiAgICAgICAgICAgIHZhciBkdyA9IHRoaXMuJGVsLmNsb3Nlc3QoJy5pdGVtcy13cmFwJykud2lkdGgoKSxcbiAgICAgICAgICAgICAgICBzdyA9IHRoaXMuY29sbGVjdGlvbi5sZW5ndGggKiBWSVRSSU5BX0lURU1fV0lEVEgsXG4gICAgICAgICAgICAgICAgZmxhZyA9IHN3ID4gZHc7XG5cbiAgICAgICAgICAgIGlmIChmbGFnKSB0aGlzLm1heFN0ZXAgPSBNYXRoLmNlaWwoKHN3IC0gZHcpIC8gVklUUklOQV9JVEVNX1dJRFRIKTtlbHNlIHRoaXMubWF4U3RlcCA9IDA7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnN0ZXAgPj0gdGhpcy5tYXhTdGVwKSBmbGFnID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHRoaXMudHJpZ2dlck1ldGhvZCgnc2hvdzptb3JlJywgZmxhZyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2xpZGVMaW5lOiBmdW5jdGlvbiBzbGlkZUxpbmUocCkge1xuXG4gICAgICAgICAgICB2YXIgZmxhZyA9IHAgPj0gdGhpcy5tYXhTdGVwO1xuICAgICAgICAgICAgaWYgKGZsYWcpIHRoaXMuc3RlcCA9IHRoaXMubWF4U3RlcDtlbHNlIHRoaXMuc3RlcCA9IHA7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnN0ZXAgIT09IDApIHRoaXMuc3RlcCAtPSAxO1xuXG4gICAgICAgICAgICB0aGlzLiRlbC5hbmltYXRlKHsgXCJsZWZ0XCI6ICctJyArIHRoaXMuc3RlcCAqIFZJVFJJTkFfSVRFTV9XSURUSCB9KTtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlck1ldGhvZCgnc2hvdzptb3JlJywgIWZsYWcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3RlcCA9IDA7XG4gICAgICAgICAgICB0aGlzLm1heFN0ZXAgPSAwO1xuICAgICAgICAgICAgQmFja2JvbmUub24oXCJ3aW5kb3c6cmVzaXplZW5kXCIsIHRoaXMuY2FsY1N0ZXAsIHRoaXMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyQ2hpbGRyZW46IGZ1bmN0aW9uIG9uUmVuZGVyQ2hpbGRyZW4oKSB7XG5cbiAgICAgICAgICAgIHZhciB3ID0gdGhpcy5jb2xsZWN0aW9uLmxlbmd0aCAqIFZJVFJJTkFfSVRFTV9XSURUSDtcbiAgICAgICAgICAgIHRoaXMuJGVsLndpZHRoKHcpO1xuXG4gICAgICAgICAgICB0aGlzLmNhbGNTdGVwKCk7XG5cbiAgICAgICAgICAgIHZhciBjbSA9IHRoaXMuY29sbGVjdGlvbi5maW5kV2hlcmUoeyBjdXJyZW50OiB0cnVlIH0pO1xuXG4gICAgICAgICAgICBpZiAoY20pIHtcbiAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXMuY2hpbGRyZW4uZmluZEJ5TW9kZWwoY20pO1xuICAgICAgICAgICAgICAgIHYuJGVsLmFkZENsYXNzKCdjdXJyZW50Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbGlkZUxpbmUodi4kZWwuaW5kZXgoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25DaGlsZHZpZXdTbGlkZXJSZW5kZXI6IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3U2xpZGVyUmVuZGVyKHApIHtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVMaW5lKHApO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiAnI3NsaWRlci10ZW1wbGF0ZScsXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgJ2NsaWNrIC5zaG93LWFkZC12aXRyaW4nOiAnc2xpZGVyOm5ldzpkYXNoYm9hcmQnXG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICdjbGljayAuYm9sdC1sdWcnOiAndG9wJyxcbiAgICAgICAgICAgIFwiY2xpY2sgLmxlXCI6ICdsZWZ0JyxcbiAgICAgICAgICAgIFwiY2xpY2sgLnJpXCI6ICdyaWdodCcsXG5cbiAgICAgICAgICAgICd0b3VjaHN0YXJ0IC5ib2x0LWx1Zyc6ICd0b3AnLFxuICAgICAgICAgICAgXCJ0b3VjaHN0YXJ0IC5sZVwiOiAnbGVmdCcsXG4gICAgICAgICAgICBcInRvdWNoc3RhcnQgLnJpXCI6ICdyaWdodCdcbiAgICAgICAgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgbW9yZTogJy5jb250aW51ZSdcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBsaXN0OiAnLml0ZW1zLXdyYXAnXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB0aGlzLiRlbC5hdHRyKCdpZCcsICd2aXRyaW4tbGlzdCcpO1xuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdsaXN0JywgbmV3IHNsaWRlckxpc3QoeyBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24gfSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxlY3Rpb25FdmVudHM6IHtcblxuICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoYywgbykge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2xpc3QnKS5jYWxjU3RlcCgpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkge1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9wKCk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCA4MDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b3A6IGZ1bmN0aW9uIHRvcCgpIHtcbiAgICAgICAgICAgIHRoaXMuJGVsLnRvZ2dsZUNsYXNzKFwiYWJzXCIpLmZpbmQoXCIuYXJyb3dcIikudG9nZ2xlQ2xhc3MoXCJub3JkXCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGxlZnQ6IGZ1bmN0aW9uIGxlZnQoKSB7XG4gICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXMuZ2V0Q2hpbGRWaWV3KCdsaXN0Jyk7XG4gICAgICAgICAgICBpZiAobGlzdC5zdGVwID4gMCkge1xuICAgICAgICAgICAgICAgIGxpc3Quc3RlcC0tO1xuICAgICAgICAgICAgICAgIGxpc3QuJGVsLmFuaW1hdGUoeyBcImxlZnRcIjogXCIrPVwiICsgVklUUklOQV9JVEVNX1dJRFRIIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMudWkubW9yZS5zaG93KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmlnaHQ6IGZ1bmN0aW9uIHJpZ2h0KCkge1xuICAgICAgICAgICAgdmFyIGxpc3QgPSB0aGlzLmdldENoaWxkVmlldygnbGlzdCcpO1xuICAgICAgICAgICAgaWYgKGxpc3Quc3RlcCA8IGxpc3QubWF4U3RlcCkge1xuICAgICAgICAgICAgICAgIGxpc3Quc3RlcCsrO1xuICAgICAgICAgICAgICAgIGxpc3QuJGVsLmFuaW1hdGUoeyBcImxlZnRcIjogXCItPVwiICsgVklUUklOQV9JVEVNX1dJRFRIIH0pO1xuICAgICAgICAgICAgICAgIGlmIChsaXN0LnN0ZXAgPT09IGxpc3QubWF4U3RlcCkgdGhpcy51aS5tb3JlLmhpZGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB0aGlzLnVpLm1vcmUuaGlkZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2hpbGR2aWV3U2hvd01vcmU6IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3U2hvd01vcmUoZmxhZykge1xuICAgICAgICAgICAgaWYgKGZsYWcpIHRoaXMudWkubW9yZS5zaG93KCk7ZWxzZSB0aGlzLnVpLm1vcmUuaGlkZSgpO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdkMzpoaXN0b2dyYW0nLCBbJ2dsb2JhbC5jaGFydHMuc2V0dGluZ3Ntb2RlbCddLCBmdW5jdGlvbiAoc3ViU2V0dGluZ3MpIHtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJycpLFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuZmxhZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5pc0dyb3VwZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuR3JvcHMgPSB7fTtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IHRoaXMub3B0aW9ucy5pdGVtcy52YXJpYXRpb25zWzFdLmZsb3dbMF0ucG9pbnRzO1xuICAgICAgICAgICAgdGhpcy5keCA9IFtdO1xuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKTtcblxuICAgICAgICAgICAgdmFyIG5hbWUgPSB0aGlzLm1vZGVsLmdldCgndHlwZU5hbWUnKSArIFwiLkdoYXBoU3ViU2V0dGluZ3NcIjtcbiAgICAgICAgICAgIHZhciBwID0gXy5maW5kV2hlcmUodGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCB7IFdpZGdldFBhcmFtTmFtZTogbmFtZSB9KTtcblxuICAgICAgICAgICAgdGhpcy5zdWJTZXR0aW5ncyA9IG5ldyBzdWJTZXR0aW5ncygpO1xuXG4gICAgICAgICAgICBpZiAocCkgdGhpcy5zdWJTZXR0aW5ncy5zZXQocC5XaWRnZXRQYXJhbVZhbHVlKTtcblxuICAgICAgICAgICAgXy5lYWNoKGl0ZW1zLCBmdW5jdGlvbiAobSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHogPSB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBtLmVsSWQsXG4gICAgICAgICAgICAgICAgICAgIHg6IG0ueCxcbiAgICAgICAgICAgICAgICAgICAgeTogcGFyc2VGbG9hdChtLnkpLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogbS50ZXh0IC8vXy5maW5kV2hlcmUodGhpcy5tb2RlbC5nZXQoJ2ZlZWQnKS5oZWFkLCB7IHN5c3RlbU5hbWU6ICd5dmFsJyB9KS5kaXNwbGF5TmFtZVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuY29sbGVjdGlvbi5nZXQoei5pZCksXG4gICAgICAgICAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZSh6LngpLFxuICAgICAgICAgICAgICAgICAgICB4b3V0ID0gei54O1xuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGUudG9TdHJpbmcoKSAhPT0gXCJJbnZhbGlkIERhdGVcIikge1xuICAgICAgICAgICAgICAgICAgICB4b3V0ID0gZGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFnID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5keC5pbmRleE9mKHhvdXQpID09PSAtMSkgdGhpcy5keC5wdXNoKHhvdXQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHlzID0gZS5nZXQoXCJ5XCIpO1xuICAgICAgICAgICAgICAgICAgICB5cy5wdXNoKHoueSk7XG4gICAgICAgICAgICAgICAgICAgIGUuc2V0KFwieVwiLCB5cyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgei55ID0gW3oueV07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5hZGQoeik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25CZWZvcmVSZW5kZXI6IGZ1bmN0aW9uIG9uQmVmb3JlUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB0aGlzLiRlbC5jc3MoeyBwb3NpdGlvbjogJ2Fic29sdXRlJywgdG9wOiAwLCBsZWZ0OiAwLCBib3R0b206IDAsIHJpZ2h0OiAwIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdmFyIGNvbHVtbnMgPSBbXTtcblxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24gKG0sIGkpIHtcblxuICAgICAgICAgICAgICAgIHZhciBheSA9IG0uZ2V0KFwieVwiKSxcbiAgICAgICAgICAgICAgICAgICAgZ2lkID0gbS5nZXQoXCJHcm91cE5hbWVcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5keC5pbmRleE9mKFwieFwiKSA9PT0gLTEpIHRoaXMuZHgudW5zaGlmdChcInhcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXkubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaCh0aGlzLmR4KTtcbiAgICAgICAgICAgICAgICAgICAgYXkudW5zaGlmdChtLmdldChcInRpdGxlXCIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgYXkudW5zaGlmdChtLmdldChcInhcIikpO1xuXG4gICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKGF5KTtcblxuICAgICAgICAgICAgICAgIGlmIChnaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0dyb3VwZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuR3JvcHNbZ2lkXSkgdGhpcy5Hcm9wc1tnaWRdID0gW20uZ2V0KFwieFwiKV07ZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLkdyb3BzW2dpZF0ucHVzaChtLmdldChcInhcIikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGNvbHVtbnM6IGNvbHVtbnMsXG4gICAgICAgICAgICAgICAgdHlwZTogdGhpcy5vcHRpb25zLmNoYXJ0IHx8ICdiYXInXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGF4aXMgPSB7XG4gICAgICAgICAgICAgICAgeToge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5zdWJTZXR0aW5ncy5nZXQoJ3ByaW1hcnlZQXhpc1RpdGxlJylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdyb3VwcyA9IFtdLFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5ID0gW107XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmZsYWcpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnggPSBcInhcIjtcbiAgICAgICAgICAgICAgICBheGlzLnggPSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0aW1lc2VyaWVzJyxcbiAgICAgICAgICAgICAgICAgICAgdGljazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiAnJVktJW0tJWQnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0dyb3VwZWQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBhIGluIHRoaXMuR3JvcHMpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2godGhpcy5Hcm9wc1thXSk7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5LnB1c2goYSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYXRlZ29yeS5sZW5ndGggPj0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGNvbHVtbnMsIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGdyb3VwcywgZnVuY3Rpb24gKGcsIGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8uY29udGFpbnMoZywgYVswXSkpIGEuc3BsaWNlKGkgKyAxLCAwLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYXhpcy54ID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2F0ZWdvcnknLFxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yaWVzOiBjYXRlZ29yeVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZGF0YS5ncm91cHMgPSBncm91cHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyeSB7XG5cbiAgICAgICAgICAgICAgICBjMy5nZW5lcmF0ZSh7XG5cbiAgICAgICAgICAgICAgICAgICAgYmluZHRvOiB0aGlzLmVsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbiB0aXRsZShkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRpdGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYXhpczogYXhpcyxcbiAgICAgICAgICAgICAgICAgICAgYmFyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhdGlvOiAwLjVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlLm1lc3NhZ2UsIGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnbGVmdFBhbmVsJywgWydXaWRnZXRNb2RlbCcsICdNYXN0ZXJDcmVhdGVWaWV3J10sIGZ1bmN0aW9uIChXaWRnZXRNb2RlbCwgTWFzdGVyQ3JlYXRlVmlldykge1xuXG4gICAgICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdzaWRlLXBhbmVsJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPHN2ZyBjbGFzcz1cInN2Zy1pY29uIGljb24tY2xvc2VcIj48dXNlIHhsaW5rOmhyZWY9XCIjaWNvbi1jbG9zZVwiIC8+PC9zdmc+PHNlY3Rpb24gaWQ9XCJtYXN0ZXItY3JlYXRlXCI+PC9zZWN0aW9uPicpLFxuXG4gICAgICAgICAgICAgICAgZXZlbnRzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnY2xpY2sgLmljb24tY2xvc2UnOiBmdW5jdGlvbiBjbGlja0ljb25DbG9zZSgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCcuc3RlcC1wYW5lbCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2JpZycpLnJlbW92ZUNsYXNzKFwic2hvd1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFzdGVyOiBcIiNtYXN0ZXItY3JlYXRlXCJcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbCA9IG5ldyBXaWRnZXRNb2RlbCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdNb2RlJykucmVwbHkoJ2xlZnQ6aW5pdDptb2RlbCcsIGZ1bmN0aW9uICh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gdi5jb2xsZWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYXR0cignaWQnLCAnbGVmdC1wcm9wZXJ0eScpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvblNob3c6IGZ1bmN0aW9uIG9uU2hvdygpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbCA9IG5ldyBXaWRnZXRNb2RlbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb2xsZWN0aW9uID0gdGhpcy5jb2xsZWN0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGVsLmhhc0NsYXNzKFwic2hvd1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5hZGRDbGFzcyhcInNob3dcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbWFzdGVyJywgbmV3IE1hc3RlckNyZWF0ZVZpZXcoeyBtb2RlbDogdGhpcy5tb2RlbCB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uQ2hpbGR2aWV3Q2xvc2VMZWZ0OiBmdW5jdGlvbiBvbkNoaWxkdmlld0Nsb3NlTGVmdCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFJlZ2lvbignbWFzdGVyJykuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3RvcFBhbmVsJywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ2dsb2JhbC52aWV3LmRyb3BEb3duJywgJ2dsb2JhbC52aWV3LmRpYWxvZycsICdzZXR0aW5ncy5kZWNvcmF0aW9uV2lkZ2V0J10sIGZ1bmN0aW9uIChSZXNvdXJjZXMsIGRyb3BEb3duLCBkaWFsb2csIGRlY29yYXRpb25Db250ZW50KSB7XG5cbiAgICB2YXIgTUlOX1NJWkUgPSAxNTA7XG5cbiAgICB2YXIgY2xvbmVEaWFsb2cgPSBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6ICcjY2xvbmUtd2lkZ2V0LWRpYWxvZy10ZW1wbGF0ZScsXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgbmQ6ICcjbmV3REJOYW1lJ1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIGRkOiB7IGVsOiAnI2Rhc2hib2FyZHMtbGlzdCcsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgfSxcblxuICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgIFwiY2hhbmdlIHNlbGVjdC5wcm9maWxlXCI6IFwic2VsZWN0Vml0cmluYVwiXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB2YXIgY29sbGVjdGlvbiA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKHRoaXMubW9kZWwuY29sbGVjdGlvbi5tb2RlbHMpO1xuICAgICAgICAgICAgY29sbGVjdGlvbi5hZGQoeyBpZDogMCwgdGl0bGU6IFJlc291cmNlcy53YWxsX3RvUGFuZWxWaWV3X25ld1ZpdHJpbmEgfSwgeyBhdDogMCB9KTtcblxuICAgICAgICAgICAgdmFyIGRkID0gbmV3IGRyb3BEb3duKHsgY29sbGVjdGlvbjogY29sbGVjdGlvbiwgY3VycmVudDogXCIwXCIgfSk7XG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2RkJywgZGQpO1xuXG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKGRkLCBcImRyb3Bkb3duOnNlbGVjdFwiLCBmdW5jdGlvbiAobW9kZWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENsb25uaW5nVml0cmluYShtb2RlbC5pZCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2RkJykuZ2V0Q2hpbGRWaWV3KCdjb250YWluZXInKS5zZXRGaWx0ZXIoZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIW0uZ2V0KCdJc1NoYXJlZCcpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyM0Mjc3IFZvbGtvdiAtINC/0L7Qu9C1INGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40Y8g0LTQu9GPINCy0LLQvtC00LAg0LjQvNC10L3QuCDQstC40YLRgNC40Ysg0YHQutGA0YvQstCw0LXRgtGB0Y8sINC10YHQu9C4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDQutC70L7QvdC40YDRg9C10YIg0L3QsCDRgdGD0YnQtdGB0YLQstGD0Y7RidGD0Y4g0LLQuNGC0YDQuNC90YMgXG4gICAgICAgIHNlbGVjdENsb25uaW5nVml0cmluYTogZnVuY3Rpb24gc2VsZWN0Q2xvbm5pbmdWaXRyaW5hKHZpdHJpbmEpIHtcbiAgICAgICAgICAgIGlmICh2aXRyaW5hKSAkKHRoaXMudWkubmQpLnBhcmVudCgpLnBhcmVudCgpLmhpZGUoKTtlbHNlICQodGhpcy51aS5uZCkucGFyZW50KCkucGFyZW50KCkuc2hvdygpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgcG9zaXRpb25WaWV3ID0gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIC8vdGFnTmFtZTogJ3NwYW4nLFxuICAgICAgICB0YWdOYW1lOiAnZGl2JyxcbiAgICAgICAgY2xhc3NOYW1lOiAncG9zaXRpb24tYnV0dG9ucycsXG5cbiAgICAgICAgdGVtcGxhdGU6ICcjcG9zaXRpb24tYnRucy10ZW1wbGF0ZScsXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgZHg6IFwiaW5wdXRbbmFtZT0nUG9zaXRvblBhZGRpbmcteCddXCIsXG4gICAgICAgICAgICBkeTogXCJpbnB1dFtuYW1lPSdQb3NpdG9uUGFkZGluZy15J11cIixcbiAgICAgICAgICAgIHdpZHRoOiAnaW5wdXRbbmFtZT1cIndpZHRoXCJdJyxcbiAgICAgICAgICAgIGhlaWdodDogJ2lucHV0W25hbWU9XCJoZWlnaHRcIl0nXG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgbW86IHsgZWw6ICcjbXVsdGktb3BlcmF0aW9uJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIGRpYWxvZzogeyBlbDogJyNkaWFsb2cnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgIFwiY2xpY2sgYnV0dG9uOm5vdChbZGlzYWJsZWRdKVwiOiBcImZpeGVkXCIsXG5cbiAgICAgICAgICAgICdrZXl1cCBAdWkuZHgnOiBmdW5jdGlvbiBrZXl1cFVpRHgoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzKSB0aGlzLmZpeGVkKGUsICdkaXNwb3NlLXgnKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdrZXl1cCBAdWkuZHknOiBmdW5jdGlvbiBrZXl1cFVpRHkoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzKSB0aGlzLmZpeGVkKGUsICdkaXNwb3NlLXknKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdrZXl1cCBAdWkud2lkdGgnOiBmdW5jdGlvbiBrZXl1cFVpV2lkdGgoZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHRoaXMuX3NldFByb3AocGFyc2VJbnQodGhpcy51aS53aWR0aC52YWwoKSksICd3aWR0aCcpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ2tleXVwIEB1aS5oZWlnaHQnOiBmdW5jdGlvbiBrZXl1cFVpSGVpZ2h0KGUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzKSB0aGlzLl9zZXRQcm9wKHBhcnNlSW50KHRoaXMudWkuaGVpZ2h0LnZhbCgpKSwgJ2hlaWdodCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NldFByb3A6IGZ1bmN0aW9uIF9zZXRQcm9wKHByb3AsIG5hbWUpIHtcblxuICAgICAgICAgICAgLy9pZiAoIHRoaXMua2V5VGltZW91dCApXG4gICAgICAgICAgICAvLyAgICBjbGVhclRpbWVvdXQoIHRoaXMua2V5VGltZW91dCApO1xuXG4gICAgICAgICAgICAvL3RoaXMua2V5VGltZW91dCA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIGNoID0gdGhpcy5jdXJyZW50RGFzaGJvYXJkLmNoaWxkcmVuO1xuXG4gICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uZWFjaChmdW5jdGlvbiAobSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKHByb3ApIHx8IHByb3AgPCBNSU5fU0laRSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpW25hbWVdLnZhbChtLmdldChuYW1lKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbS5zZXQobmFtZSwgcHJvcCk7XG4gICAgICAgICAgICAgICAgICAgIGNoLmZpbmRCeU1vZGVsKG0pLnBvc2l0aW9uLnNhdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgLy99LmJpbmQoIHRoaXMgKSwgNTAwICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZml4ZWQ6IGZ1bmN0aW9uIGZpeGVkKGUsIG5hbWUpIHtcblxuICAgICAgICAgICAgdmFyIG5hbWUgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KFwiYnV0dG9uXCIpLmF0dHIoXCJuYW1lXCIpIHx8IG5hbWUsXG4gICAgICAgICAgICAgICAgZHggPSBwYXJzZUludCh0aGlzLnVpLmR4LnZhbCgpKSxcbiAgICAgICAgICAgICAgICBkeSA9IHBhcnNlSW50KHRoaXMudWkuZHkudmFsKCkpLFxuICAgICAgICAgICAgICAgIHByb3BuYW1lID0gbmFtZTtcblxuICAgICAgICAgICAgaWYgKG5hbWUgPT09IFwiZnJvbnRcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsY1Bvc2l0aW9uKHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChuYW1lID09PSBcImJhY2tcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FsY1Bvc2l0aW9uKGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb24ubGVuZ3RoID4gMSkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5maXJzdE1vZGVsID0gdGhpcy5jb2xsZWN0aW9uLmF0KDApO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgZmlyc3QgPSB0aGlzLmZpcnN0TW9kZWwuZ2V0KHByb3BuYW1lKSxcbiAgICAgICAgICAgICAgICAgICAgcHJldiA9IHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogdGhpcy5maXJzdE1vZGVsLmdldChcImxlZnRcIiksXG4gICAgICAgICAgICAgICAgICAgIHRvcDogdGhpcy5maXJzdE1vZGVsLmdldChcInRvcFwiKVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uZWFjaChmdW5jdGlvbiAobSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBvID0ge307XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChuYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJkaXNwb3NlLXhcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wbmFtZSA9IFwibGVmdFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gcHJldi5sZWZ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihkeCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5keC5jc3MoJ2JvcmRlci1jb2xvcicsICdyZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmR4LmNzcygnYm9yZGVyLWNvbG9yJywgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksIDIwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMudWkuZHguY3NzKCdib3JkZXItY29sb3InLCAnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LmxlZnQgKz0gbS5nZXQoXCJ3aWR0aFwiKSArIGR4O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZGlzcG9zZS15XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcG5hbWUgPSBcInRvcFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gcHJldi50b3A7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGR5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmR5LmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkuZHkuY3NzKCdib3JkZXItY29sb3InLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSwgMjAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy51aS5keC5jc3MoJ2JvcmRlci1jb2xvcicsICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LnRvcCArPSBtLmdldChcImhlaWdodFwiKSArIGR5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwic2l6ZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0ID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Qud2lkdGggPSB0aGlzLmZpcnN0TW9kZWwuZ2V0KFwid2lkdGhcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3QuaGVpZ2h0ID0gdGhpcy5maXJzdE1vZGVsLmdldChcImhlaWdodFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wbmFtZSA9IFwic2l6ZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibWlkZGxlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcG5hbWUgPSBcInRvcFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gdGhpcy5maXJzdE1vZGVsLmdldChcInRvcFwiKSArIHRoaXMuZmlyc3RNb2RlbC5nZXQoXCJoZWlnaHRcIikgLyAyIC0gbS5nZXQoXCJoZWlnaHRcIikgLyAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdCA8IDApIGZpcnN0ID0gNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJvdHRvbVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BuYW1lID0gXCJ0b3BcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IHRoaXMuZmlyc3RNb2RlbC5nZXQoXCJ0b3BcIikgKyB0aGlzLmZpcnN0TW9kZWwuZ2V0KFwiaGVpZ2h0XCIpIC0gbS5nZXQoXCJoZWlnaHRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0IDwgMCkgZmlyc3QgPSA1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiY2VudGVyXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcG5hbWUgPSBcImxlZnRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IHRoaXMuZmlyc3RNb2RlbC5nZXQoXCJsZWZ0XCIpICsgdGhpcy5maXJzdE1vZGVsLmdldChcIndpZHRoXCIpIC8gMiAtIG0uZ2V0KFwid2lkdGhcIikgLyAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdCA8IDApIGZpcnN0ID0gNTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcG5hbWUgPSBcImxlZnRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IHRoaXMuZmlyc3RNb2RlbC5nZXQoXCJsZWZ0XCIpICsgdGhpcy5maXJzdE1vZGVsLmdldChcIndpZHRoXCIpIC0gbS5nZXQoXCJ3aWR0aFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3QgPCAwKSBmaXJzdCA9IDU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgV2lkZ2V0VWlkOiBtLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgUGxhY2VtZW50V2lkdGg6IG5hbWUgPT09IFwic2l6ZVwiID8gZmlyc3Qud2lkdGggOiBuYW1lID09PSBcIndpZHRoXCIgPyBmaXJzdCA6IG0uZ2V0KFwid2lkdGhcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBQbGFjZW1lbnRIZWlnaHQ6IG5hbWUgPT09IFwic2l6ZVwiID8gZmlyc3QuaGVpZ2h0IDogbmFtZSA9PT0gXCJoZWlnaHRcIiA/IGZpcnN0IDogbS5nZXQoXCJoZWlnaHRcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBQbGFjZW1lbnRUb3A6IHByb3BuYW1lID09PSBcInRvcFwiID8gZmlyc3QgOiBtLmdldCgndG9wJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBQbGFjZW1lbnRMZWZ0OiBwcm9wbmFtZSA9PT0gXCJsZWZ0XCIgPyBmaXJzdCA6IG0uZ2V0KCdsZWZ0JyksXG4gICAgICAgICAgICAgICAgICAgICAgICBaSW5kZXg6IG5hbWUgPT09IFwiekluZGV4XCIgPyBmaXJzdCA6IG0uZ2V0KFwiekluZGV4XCIpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lICE9PSBcInNpemVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbS5zZXQocHJvcG5hbWUsIGZpcnN0KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2V0KHsgd2lkdGg6IGZpcnN0LndpZHRoLCBoZWlnaHQ6IGZpcnN0LmhlaWdodCB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5vblNhdmUoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FsY1Bvc2l0aW9uOiBmdW5jdGlvbiBjYWxjUG9zaXRpb24oZnJvbnQpIHtcblxuICAgICAgICAgICAgdmFyIGZpcnN0ID0gdGhpcy5jb2xsZWN0aW9uLmF0KDApLFxuICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5jdXJyZW50RGFzaGJvYXJkLmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgIHAgPSAxO1xuXG4gICAgICAgICAgICBpZiAoIWZyb250KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudERhc2hib2FyZC5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KG0uZ2V0KCd6SW5kZXgnKSkgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gY2hpbGQuZmluZEJ5TW9kZWwobSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBtLnNldChcInpJbmRleFwiLCBtLmdldCgnekluZGV4JykgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCh2LnBvc2l0aW9uLnRvSlNPTigpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5vblNhdmUoZGF0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1heCA9IHRoaXMuY3VycmVudERhc2hib2FyZC5jb2xsZWN0aW9uLm1heChmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoXCJ6SW5kZXhcIik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAobWF4KSBpZiAoZmlyc3QuaWQgIT09IG1heC5pZCkgcCA9IHBhcnNlSW50KG1heC5nZXQoXCJ6SW5kZXhcIikpICsgMTtlbHNlIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZmlyc3Quc2V0KFwiekluZGV4XCIsIHApO1xuICAgICAgICAgICAgdmFyIGZ2ID0gY2hpbGQuZmluZEJ5TW9kZWwoZmlyc3QpO1xuICAgICAgICAgICAgZnYucG9zaXRpb24uc2F2ZSgpO1xuICAgICAgICAgICAgZnYuJGVsLnJlbW92ZUNsYXNzKCd3aWRnZXQtZWRpdGluZycpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uU2F2ZTogZnVuY3Rpb24gb25TYXZlKGRhdGEpIHtcblxuICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL2FwaS93YWxsLycgKyB0aGlzLm1vZGVsLmlkICsgJy9wb3NpdGlvbnMnLFxuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGRhdGEpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy90aGlzLmNvbGxlY3Rpb24ucmVzZXQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb2xsZWN0aW9uRXZlbnRzOiB7XG5cbiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3kobSkge1xuICAgICAgICAgICAgICAgIHRoaXMuJCgnI2NvdW50JykudGV4dCh0aGlzLmNvbGxlY3Rpb24ubGVuZ3RoKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGFkZDogZnVuY3Rpb24gYWRkKG0pIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudERhc2hib2FyZC5jaGlsZHJlbi5maW5kQnlNb2RlbChtKS4kZWwuYWRkQ2xhc3MoJ3dpZGdldC1lZGl0aW5nJyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLiQoXCJidXR0b25bbmFtZT1mcm9udF0sIGJ1dHRvbltuYW1lPWJhY2tdLCBidXR0b25bbmFtZT1yZXNpemVdXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sbGVjdGlvbi5sZW5ndGggPiAxKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kKFwiYnV0dG9uXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS53aWR0aC52YWwoJycpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmhlaWdodC52YWwoJycpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhID0gW3sgaWQ6ICdkZWNvcmF0aW9uJywgdGl0bGU6IFJlc291cmNlcy5tMywgaWNvbjogJ2FwcGVhcmFuY2UnIH0sIHsgaWQ6ICdjbGVhcicsIHRpdGxlOiBSZXNvdXJjZXMuZGVsLCBpY29uOiAndHJhc2gnIH1dO1xuXG4gICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ3NpZGViYXInKS5yZXF1ZXN0KCdvcGVuJywgeyB0aXRsZVZpZXc6ICcnLCB2aWV3OiB0aGlzLCBuYW1lOiBSZXNvdXJjZXMuZGJzIH0sIGEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkud2lkdGgudmFsKG0uZ2V0KCd3aWR0aCcpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5oZWlnaHQudmFsKG0uZ2V0KCdoZWlnaHQnKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ21vJykuJGVsLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgIHRoaXMuJCgnI2NvdW50JykudGV4dCh0aGlzLmNvbGxlY3Rpb24ubGVuZ3RoKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldChjLCBvKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY3VycmVudERhc2hib2FyZCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RGFzaGJvYXJkLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24gKHYpIHtcblxuICAgICAgICAgICAgICAgICAgICB2LiRlbC5yZW1vdmVDbGFzcygnd2lkZ2V0LWVkaXRpbmcnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodi5nZXRSZWdpb24oJ3NldHRpbmdzJykuaGFzVmlldygpKSB2LmdldENoaWxkVmlldygnc2V0dGluZ3MnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLiQoJyNjb3VudCcpLnRleHQodGhpcy5jb2xsZWN0aW9uLmxlbmd0aCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLiQoXCJidXR0b25cIikuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbW8nKS4kZWwuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuJChcImJ1dHRvblwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdtbycsIG5ldyBkcm9wRG93bih7XG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICc8ZGl2IGNsYXNzPVwiaXRlbVwiPjxzcGFuPjxzdmc+PHVzZSB4bGluazpocmVmPVwiI3NlbGVjdGVkLXdpZGdldHNcIiAvPjwvc3ZnPjwvc3Bhbj48c3Bhbj4nICsgUmVzb3VyY2VzLnNlbGVjdGVkV2lkZ2V0cyArICc8L3NwYW4+PHNwYW4gaWQ9XCJjb3VudFwiPjA8L3NwYW4+PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uOiBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbihbeyBpZDogJ2Nsb25lJywgdGl0bGU6IFJlc291cmNlcy5jbG9uZVRvLCBpY29uOiAnaWNvbi1jbG9uZScgfSwgeyBpZDogJ2NsZWFyJywgdGl0bGU6IFJlc291cmNlcy5kZWxldGVJdGVtLCBpY29uOiAnaWNvbi10cmFzaCcgfV0pXG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdtbycpLiRlbC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdFdmVudHM6IHtcblxuICAgICAgICAgICAgJ2Ryb3Bkb3duOnNlbGVjdCc6IGZ1bmN0aW9uIGRyb3Bkb3duU2VsZWN0KG0sIG5hbWUpIHtcblxuICAgICAgICAgICAgICAgIHN3aXRjaCAobS5pZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Nsb25lJzpcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBuZXcgZGlhbG9nKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBuZXcgY2xvbmVEaWFsb2coeyBtb2RlbDogdGhpcy5tb2RlbCB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogUmVzb3VyY2VzLmNsb25lVG8sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2Nsb25lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb290ZXI6IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFt7IGlkOiAnY2xvbmUnLCB0aXRsZTogUmVzb3VyY2VzLnNhdmUsIGNsYXNzTmFtZTogJ2JsdWUgcmlnaHQnIH1dKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuVG8oZCwgJ2Zvb3RlcjpidXR0b246Y2xpY2snLCBmdW5jdGlvbiAodikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpZCA9IGQubW9kZWwuZ2V0KCdjb250ZW50JykuZ2V0Q2hpbGRWaWV3KCdkZCcpLmN1cnJlbnQuaWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRpZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9ICQudHJpbShkLm1vZGVsLmdldCgnY29udGVudCcpLnVpLm5kLnZhbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpdGxlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29sbGVjdGlvbi5jcmVhdGUoeyB0aXRsZTogdGl0bGUgfSwgeyB3YWl0OiB0cnVlIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RlblRvT25jZSh0aGlzLm1vZGVsLmNvbGxlY3Rpb24sICdzeW5jJywgZnVuY3Rpb24gKG0pIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nsb25lV2lkZ2V0cyhtLmlkLCBkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBkLmdldENoaWxkVmlldygnbm90aWZ5Jykuc2hvd05vdGlmeShSZXNvdXJjZXMubmV3REJOYW1lICsgJyAtICcgKyBSZXNvdXJjZXMuaXNFbXB0eS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jbG9uZVdpZGdldHMoZGlkLCBkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ05vdGlmeScpLnJlcXVlc3QoJ2FkZDpkaWFsb2cnLCBkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2xlYXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xlYXJXaWRnZXRzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2lkZUJhclRyaWdnZXI6IGZ1bmN0aW9uIHNpZGVCYXJUcmlnZ2VyKG0pIHtcblxuICAgICAgICAgICAgc3dpdGNoIChtLmlkKSB7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdkZWNvcmF0aW9uJzpcblxuICAgICAgICAgICAgICAgICAgICB2YXIgb25lID0gdGhpcy5jb2xsZWN0aW9uLmF0KDApO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gbmV3IGRpYWxvZyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBuZXcgZGVjb3JhdGlvbkNvbnRlbnQoeyBtb2RlbDogb25lIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFJlc291cmNlcy5tMyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICdhcHBlYXJhbmNlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlcjogbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW3sgaWQ6ICdkZWNvcicsIHRpdGxlOiBSZXNvdXJjZXMuc2F2ZSwgY2xhc3NOYW1lOiAnYmx1ZSByaWdodCcgfV0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuVG8ob25lLCAnY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnNldCgnRGVjb3JhdGlvbicsIG9uZS5nZXQoJ0RlY29yYXRpb24nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5UbyhkLCAnZm9vdGVyOmJ1dHRvbjpjbGljaycsIGZ1bmN0aW9uICh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5lYWNoKGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5zYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZC5nZXRDaGlsZFZpZXcoJ25vdGlmeScpLnNob3dOb3RpZnkoUmVzb3VyY2VzLnN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdOb3RpZnknKS5yZXF1ZXN0KCdhZGQ6ZGlhbG9nJywgZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdjbGVhcic6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFyV2lkZ2V0cygpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfY2xvbmVXaWRnZXRzOiBmdW5jdGlvbiBfY2xvbmVXaWRnZXRzKGlkLCBkKSB7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHdpZGdldHM6IHRoaXMuY29sbGVjdGlvbi5wbHVjaygnaWQnKSxcbiAgICAgICAgICAgICAgICB2aXRyaW5zOiBbaWRdXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoIWRhdGEud2lkZ2V0cyB8fCAhZGF0YS53aWRnZXRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5hamF4KHsgdXJsOiAnL2FwaS93YWxsL3NlcnZpY2Uvd2lkZ2V0Y2xvbm5pbmcnLCBkYXRhOiBkYXRhLCB0eXBlOiBcIlBPU1RcIiB9KS5kb25lKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIC8vINC+0LHQvdC+0LLQuNGC0Ywg0YbQtdC70LXQstGD0Y4g0LLQuNGC0YDQuNC90YMgKNC10YHQu9C4INC+0L3QsCDQt9Cw0LPRgNGD0LbQtdC90LAg0LLQuNC00LbQtdGC0Ysg0L3QtSDQv9C+0Y/QstGP0YLRgdGPKVxuICAgICAgICAgICAgICAgIHZhciBtZCA9IHRoaXMubW9kZWwuY29sbGVjdGlvbi5nZXQoZGF0YS52aXRyaW5zWzBdKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ3JlbmRlcjp2aXRyaW46YWZ0ZXI6Y2xvbmU6d2lkZ2V0JywgbWQpO1xuXG4gICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0LrQu9C+0L3QuNGA0L7QstCw0L3QuNC1INC/0YDQvtC40LfQstC+0LTQuNGC0YHRjyDQsiDRjdGC0YMg0LbQtSDQstC40YLRgNC40L3RgyDRgyDQstC40LTQttC10YLQvtCyINC/0YDQvtC/0LDQtNCw0LXRgiDQstGL0LTQtdC70LXQvdC40LVcbiAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdNb2RlJykucmVxdWVzdCgndHVybjpzd2l0Y2gnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgLy9kLmdldENoaWxkVmlldygnbm90aWZ5Jykuc2hvd05vdGlmeShSZXNvdXJjZXMuc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24ucmVzZXQoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSkuZmFpbChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBkLmdldENoaWxkVmlldygnbm90aWZ5Jykuc2hvd05vdGlmeShcIkludGVybmFsIEVycm9yXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2NsZWFyV2lkZ2V0czogZnVuY3Rpb24gX2NsZWFyV2lkZ2V0cygpIHtcblxuICAgICAgICAgICAgQmFja2JvbmUudHJpZ2dlcihcIm1lc3NhZ2U6Y29uZmlybVwiLCB7XG5cbiAgICAgICAgICAgICAgICB0aXRsZTogUmVzb3VyY2VzLmFza3lvdXN1cmUsIG1lc3NhZ2U6ICQuRm9ybWF0KFJlc291cmNlcy5kZWx0ZXh0LCBSZXNvdXJjZXMud2lkZ2V0LCB0aGlzLmNvbGxlY3Rpb24ucGx1Y2soXCJ0aXRsZVwiKS5qb2luKCcsICcpKSxcblxuICAgICAgICAgICAgICAgIGZ4OiBmdW5jdGlvbiBmeCgpIHtcblxuICAgICAgICAgICAgICAgICAgICBBcnJheS5mcm9tKHRoaXMuY29sbGVjdGlvbi5tb2RlbHMpLm1hcChmdW5jdGlvbiAobSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBtLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGN0eDogdGhpc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgY2xhc3NOYW1lOiAnU2huYScsXG5cbiAgICAgICAgdGVtcGxhdGU6ICcjdG9wLWJ1dHRvbnMtdGVtcGxhdGUnLFxuICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHtcbiAgICAgICAgICAgIFJlc291cmNlczogUmVzb3VyY2VzXG4gICAgICAgIH0sXG5cbiAgICAgICAgdHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICdjbGljayAuc2hvdy1hZGQtd2lkZ2V0LWJ0bic6ICdzaG93OmxlZnQ6cGFuZWwnXG4gICAgICAgICAgICAvLydjbGljayAuZm9udC1pY29uLXJlcGFpcic6ICdzaG93OnJpZ2h0OnBhbmVsJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICBcIm1vdXNlZW50ZXIgLnNob3ctYWRkLXdpZGdldC1idG5cIjogZnVuY3Rpb24gbW91c2VlbnRlclNob3dBZGRXaWRnZXRCdG4oZSkge1xuICAgICAgICAgICAgICAgICQoZS50YXJnZXQpLmNsb3Nlc3QoXCJidXR0b25cIikuZmluZChcIi5hbmJyLXRvb2x0aXBcIikuc2hvdygpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgXCJtb3VzZWxlYXZlIC5zaG93LWFkZC13aWRnZXQtYnRuXCI6IGZ1bmN0aW9uIG1vdXNlbGVhdmVTaG93QWRkV2lkZ2V0QnRuKGUpIHtcbiAgICAgICAgICAgICAgICAkKGUudGFyZ2V0KS5jbG9zZXN0KFwiYnV0dG9uXCIpLmZpbmQoXCIuYW5ici10b29sdGlwXCIpLmZhZGVPdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBwb3NpdGlvbjogeyBlbDogJyNwb3NpdGlvbi1idXR0b25zJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdwb3NpdGlvbicsIG5ldyBwb3NpdGlvblZpZXcoKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25TaG93OiBmdW5jdGlvbiBvblNob3codikge1xuXG4gICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygncG9zaXRpb24nKS5jdXJyZW50RGFzaGJvYXJkID0gdjtcbiAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdwb3NpdGlvbicpLm1vZGVsID0gdi5tb2RlbDtcblxuICAgICAgICAgICAgdGhpcy4kZWwuc2hvdygpO1xuXG4gICAgICAgICAgICBpZiAoIXYuY29sbGVjdGlvbi5sZW5ndGgpIHRoaXMuJChcIi5zaG93LWFkZC13aWRnZXQtYnRuXCIpLmZpbmQoXCIuYW5ici10b29sdGlwXCIpLnNob3coKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuICAgICAgICAgICAgJ3JlbmRlcjp2aXRyaW46YWZ0ZXI6Y2xvbmU6d2lkZ2V0JzogJ3JlbmRlcjp2aXRyaW46YWZ0ZXI6Y2xvbmU6d2lkZ2V0J1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdyZXF1ZXN0VmlldycsIFsnYmRpZCcsICdpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ3NlcnZpY2VzLmxpYnJhcnkubGlicmFyeVZpZXcnLCAnZ2xvYmFsLnZpZXcuZGlhbG9nJywgJ2dsb2JhbC52aWV3LmNvbm5lY3QnXSwgZnVuY3Rpb24gKGJkaWQsIFJlc291cmNlcywgcmVxdWVzdExpYnJhcnksIGRpYWxvZ1ZpZXcsIGNvbm5lY3RWaWV3KSB7XG5cbiAgICB2YXIgY29sbGVjdGlvblJlcXVlc3RzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuICAgICAgICBtb2RlbDogQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgICAgIGlkQXR0cmlidXRlOiBcInJpZFwiLFxuICAgICAgICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgICAgICAgICByaWQ6IDAsXG4gICAgICAgICAgICAgICAgZG9tYWluOiBcIlwiLFxuICAgICAgICAgICAgICAgIGRiYXNlOiBwYXJzZUludChiZGlkKSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0aWQ6IG51bGwsXG4gICAgICAgICAgICAgICAgcGFyYW06IFtdLFxuICAgICAgICAgICAgICAgIHBhZ2U6IDEsXG4gICAgICAgICAgICAgICAgcGFnZXNpemU6IDEwXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICB1cmw6IGZ1bmN0aW9uIHVybCgpIHtcbiAgICAgICAgICAgIHJldHVybiAnL2FwaS9pbnRlcmFjdGl2ZS9nZXRwYXJhbXNmb3J3YWxsLyc7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciByZXF1ZXN0VmlldyA9IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBjbGFzc05hbWU6ICdpdGVtJyxcblxuICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPGlucHV0IHR5cGU9XCJyYWRpb1wiIGlkPVwiPCUtIHJpZCAlPl88JS0gcHJlZml4ICU+XCIgY2xhc3M9XCJnLWZvcm0tLXJhZGlvXCIgbmFtZT1cInJhZGlvX01hc3RlckNyZWF0ZVwiPjxsYWJlbCBmb3I9XCI8JS0gcmlkICU+XzwlLSBwcmVmaXggJT5cIj48JS0gdGl0bGUgJT48L2xhYmVsPjxzdmcgY2xhc3M9XCJzdmctaWNvbiBpY29uLWNsb3NlXCI+PHVzZSB4bGluazpocmVmPVwiI2ljb24tY2xvc2VcIiAvPjwvc3ZnPicpLFxuXG4gICAgICAgIHRyaWdnZXJzOiB7XG5cbiAgICAgICAgICAgIFwiY2xpY2sgaW5wdXRcIjoge1xuICAgICAgICAgICAgICAgIGV2ZW50OiAnY2xpY2s6aXRlbScsXG4gICAgICAgICAgICAgICAgc3RvcFByb3BhZ2F0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdDogZmFsc2VcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIFwiY2xpY2sgLmljb24tY2xvc2VcIjogJ2Nsb3NlJ1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7XG5cbiAgICAgICAgICAgIEJhY2tib25lLnRyaWdnZXIoXCJtZXNzYWdlOmNvbmZpcm1cIiwge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBSZXNvdXJjZXMuYXNreW91c3VyZSwgbWVzc2FnZTogUmVzb3VyY2VzLmNybixcbiAgICAgICAgICAgICAgICBmeDogZnVuY3Rpb24gZngoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZGVzdHJveSh7IHdhaXQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjdHg6IHRoaXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgbGlzdFJlcXVlc3RzID0gTW4uQ29sbGVjdGlvblZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBjbGFzc05hbWU6ICdsaXN0LWFyZWEnLFxuXG4gICAgICAgIGNoaWxkVmlldzogcmVxdWVzdFZpZXcsXG5cbiAgICAgICAgZW1wdHlWaWV3OiBNbi5WaWV3LmV4dGVuZCh7IHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8ZGl2IGNsYXNzPVwiaXRlbVwiPicgKyBSZXNvdXJjZXMuTiArICc8L2Rpdj4nKSB9KSxcblxuICAgICAgICBvblJlbmRlckNoaWxkcmVuOiBmdW5jdGlvbiBvblJlbmRlckNoaWxkcmVuKCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5yZXF1ZXN0QWRkZWRJRCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gdGhpcy5jb2xsZWN0aW9uLmZpbmRXaGVyZSh7IHJlcXVlc3RpZDogcGFyc2VJbnQodGhpcy5yZXF1ZXN0QWRkZWRJRCkgfSk7XG4gICAgICAgICAgICAgICAgaWYgKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4uZmluZEJ5TW9kZWwobW9kZWwpLiQoJ2lucHV0JykucHJvcCgnY2hlY2tlZCcsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RBZGRlZElEID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKSAmJiB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5yaWQpIHtcblxuICAgICAgICAgICAgICAgIG1vZGVsID0gdGhpcy5jb2xsZWN0aW9uLmdldCh0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5yaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4uZmluZEJ5TW9kZWwobW9kZWwpLiQoJ2lucHV0JykucHJvcCgnY2hlY2tlZCcsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoaWxkVmlld09wdGlvbnM6IGZ1bmN0aW9uIGNoaWxkVmlld09wdGlvbnMobSkge1xuICAgICAgICAgICAgbS5zZXQoJ3ByZWZpeCcsIHRoaXMubW9kZWwuZ2V0KCd3aWRnZXRJRCcpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuICAgICAgICAgICAgJ2NsaWNrOml0ZW0nOiAnY2hpbGQ6Y2xpY2s6aXRlbSdcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0ZW1wbGF0ZTogdGVtcGxhdGVzWydyZXF1ZXN0cy10ZW1wbGF0ZSddLFxuICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHtcbiAgICAgICAgICAgIFJlc291cmNlczogUmVzb3VyY2VzXG4gICAgICAgIH0sXG5cbiAgICAgICAgdWk6IHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnLmRlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgIHQ6ICcudGl0bGUyJ1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIGxpc3Q6IHsgZWw6ICcubGlzdC1hcmVhJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICBcImNsaWNrIC5yZWZyZXNoXCI6IGZ1bmN0aW9uIGNsaWNrUmVmcmVzaCgpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5mZXRjaCh7IHJlc2V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHsgXCJyZXF1ZXN0UGFyYW1ldGVyc1wiOiB7fSB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIFwiY2xpY2sgLmxpYnJhcnlcIjogZnVuY3Rpb24gY2xpY2tMaWJyYXJ5KGUpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjb25uZWN0ID0gbmV3IGNvbm5lY3RWaWV3KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBkaWFsb2dWaWV3KHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdibHVlJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2dlYXInLFxuICAgICAgICAgICAgICAgICAgICBtb2RhbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJ2Z1bGwnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogUmVzb3VyY2VzLnRpdGxlUmVxTGliLFxuICAgICAgICAgICAgICAgICAgICBmb290ZXI6IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFt7IGlkOiAnY2FuY2VsJywgdGl0bGU6IFJlc291cmNlcy5jYW5jZWwgfSwgeyBpZDogJ2Nvbm5lY3QnLCB0aXRsZTogUmVzb3VyY2VzLkNvbm5lY3QsIGNsYXNzTmFtZTogJ3JpZ2h0IGJsdWUgZGlzYWJsZWQnIH1dKSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29ubmVjdFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5UbyhkLCAnZm9vdGVyOmJ1dHRvbjpjbGljaycsIGZ1bmN0aW9uICh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRiYXNlID0gJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2Lm1vZGVsLmlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NhbmNlbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5jbG9zZSgpO2JyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjb25uZWN0JzpcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiYXNlID0gY29ubmVjdC5jb2xsZWN0aW9uLmF0KDApLmlkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4U2V0dGluZ3MuaGVhZGVycy5rZXkgPSAkLm1lcmdlVXJsUGFyYW0oJC5hamF4U2V0dGluZ3MudXJsLCB7IGRiOiAnZGInICsgZGJhc2UgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLm1vZGVsLmdldCgnZm9vdGVyJykuc2V0KFt7IGlkOiAnY2FuY2VsJywgdGl0bGU6IFJlc291cmNlcy5jYW5jZWwgfSwgeyBpZDogJ2FkZCcsIHRpdGxlOiBSZXNvdXJjZXMuYWRkLCBjbGFzc05hbWU6ICdyaWdodCBibHVlJyB9XSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLm1vZGVsLnNldCgnY29udGVudCcsIG5ldyByZXF1ZXN0TGlicmFyeSh7IHdpZGdldFR5cGU6IHRoaXMubW9kZWwuZ2V0KFwidHlwZU5hbWVcIiksIGRiYXNlOiBkYmFzZSB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWRkJzpcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaWJyYXJ5ID0gZC5tb2RlbC5nZXQoJ2NvbnRlbnQnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbGlicmFyeS5yZXF1ZXN0SUQpIGxpYnJhcnkudHJpZ2dlck1ldGhvZCgnc2hvdzptZXNzYWdlJywgUmVzb3VyY2VzLm5vc2VsZWN0KTtlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGxpYnJhcnkuZ2V0Q2hpbGRWaWV3KCdwYXJhbXMnKS5jb2xsZWN0aW9uLnRvSlNPTigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFBhcmFtZXRlcnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21haW46IHdpbmRvdy5sb2NhdGlvbi5ob3N0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJhc2U6IGRiYXNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGlkOiBsaWJyYXJ5LnJlcXVlc3RJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnM6IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoeyB1cmw6IFwiL2FwaS9pbnRlcmFjdGl2ZS9wYXJhbXNmb3J3YWxsXCIsIGRhdGE6ICQucGFyYW0ocmVxdWVzdFBhcmFtZXRlcnMpLCB0eXBlOiBcIlBPU1RcIiB9KS5kb25lKGZ1bmN0aW9uIChtLCBuKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdsaXN0JykucmVxdWVzdEFkZGVkSUQgPSBsaWJyYXJ5LnJlcXVlc3RJRDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmZldGNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoYykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5jb2xsZWN0aW9uLmZpbmRXaGVyZSh7IHJlcXVlc3RpZDogcGFyc2VJbnQobGlicmFyeS5yZXF1ZXN0SUQpIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7IFwicmVxdWVzdFBhcmFtZXRlcnNcIjogZGF0YS50b0pTT04oKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIEJhY2tib25lLnRyaWdnZXIoJ21lc3NhZ2U6d2FybmluZycsIHsgbWVzc2FnZTogUmVzb3VyY2VzLmVycm9yICsgJyAnICsgUmVzb3VyY2VzLk4gfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5Ubyhjb25uZWN0LCAnY29ubmVjdDptYWRlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBkLmdldENoaWxkVmlldygnZm9vdGVyJykuY2hpbGRyZW4uZmluZEJ5SW5kZXgoMSkuJCgnYnV0dG9uJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdOb3RpZnknKS5yZXF1ZXN0KCdhZGQ6ZGlhbG9nJywgZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IGNvbGxlY3Rpb25SZXF1ZXN0cygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQXR0YWNoOiBmdW5jdGlvbiBvbkF0dGFjaCgpIHtcblxuICAgICAgICAgICAgaWYgKFtcIldpZGdldFNvdXJjZVwiLCBcIldpZGdldFJlcG9ydGluZ1wiLCBcIldpZGdldEh0bWxcIiwgXCJXaWRnZXRTZW1OZXRcIl0uaW5kZXhPZih0aGlzLm1vZGVsLmdldChcInR5cGVOYW1lXCIpKSA9PT0gLTEpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbGlzdCcsIG5ldyBsaXN0UmVxdWVzdHMoeyBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24sIG1vZGVsOiB0aGlzLm1vZGVsIH0pKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi51cmwgPSAnL2FwaS9pbnRlcmFjdGl2ZS9nZXRwYXJhbXNmb3J3YWxsLycgKyB0aGlzLm1vZGVsLmdldChcInR5cGVOYW1lXCIpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmZldGNoKHsgcmVzZXQ6IHRydWUgfSk7XG4gICAgICAgICAgICB9IGVsc2UgdGhpcy4kZWwuaGlkZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxlY3Rpb25FdmVudHM6IHtcblxuICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gcmVxdWVzdCgpIHtcblxuICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2xvYWRlcicpLnRyaWdnZXIoJ3Nob3cnLCB0aGlzLnVpLnQsIHsgc2l6ZTogJycsIHNwZWVkOiAnZmFzdCcgfSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzeW5jOiBmdW5jdGlvbiBzeW5jKCkge1xuXG4gICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnbG9hZGVyJykudHJpZ2dlcignaGlkZScpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoYywgbykge1xuXG4gICAgICAgICAgICAgICAgaWYgKG8uY2hhbmdlcy5yZW1vdmVkLmxlbmd0aCAmJiB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKSAmJiB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5yaWQgPT09IG8uY2hhbmdlcy5yZW1vdmVkWzBdLmlkKSB0aGlzLm1vZGVsLnNldCh7IFwicmVxdWVzdFBhcmFtZXRlcnNcIjoge30gfSk7XG5cbiAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdsb2FkZXInKS50cmlnZ2VyKCdoaWRlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBvbkNoaWxkdmlld0NoaWxkQ2xpY2tJdGVtOiBmdW5jdGlvbiBvbkNoaWxkdmlld0NoaWxkQ2xpY2tJdGVtKHYpIHtcbiAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHsgXCJyZXF1ZXN0UGFyYW1ldGVyc1wiOiB2Lm1vZGVsLnRvSlNPTigpIH0pO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdzZXR0aW5ncy5jb2xvclJvdycsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdSVSddLCBmdW5jdGlvbiAoUmVzb3VyY2VzKSB7XG5cbiAgICB2YXIgbGlzdENvbGxlY3Rpb24gPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNoaWxkVmlldzogTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPHNwYW4gc3R5bGU9XCJjdXJzb3I6cG9pbnRlcjtsaW5lLWhlaWdodDoyOHB4O3BhZGRpbmctbGVmdDo2cHg7XCI+PCUtIGRpc3BsYXlfbmFtZSAlPjwvc3Bhbj48c3BhbiBjbGFzcz1cInJlbG9hZFwiIHN0eWxlPVwiZmxvYXQ6cmlnaHQ7ZGlzcGxheTpibG9jazttYXJnaW4tdG9wOjlweDtcIiBkYXRhLWljb249XCJpY29uLXJlbG9hZFwiPjwvc3Bhbj48c3BhbiBjbGFzcz1cInBpY2tlclwiIHN0eWxlPVwiZGlzcGxheTppbmxpbmUtYmxvY2s7d2lkdGg6NDBweDtoZWlnaHQ6MTZweDttYXJnaW4tdG9wOjZweDtmbG9hdDpyaWdodDtjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kLWNvbG9yOjwlLSBjb2xvciAlPjtib3JkZXI6c29saWQgMXB4IGdyYXk7XCI+PC9zcGFuPicpLFxuXG4gICAgICAgICAgICB1aToge1xuICAgICAgICAgICAgICAgIHBpY2tlcjogJy5waWNrZXInXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgICAgICdjbGljayBAdWkucGlja2VyJzogJ2NsaWNrOml0ZW0nXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgICAgICdjbGljayAucmVsb2FkJzogZnVuY3Rpb24gY2xpY2tSZWxvYWQoZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgnY29sb3InLCAnbm9uZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIG1vZGVsRXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAnY2hhbmdlOmNvbG9yJzogZnVuY3Rpb24gY2hhbmdlQ29sb3IobSwgYykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnBpY2tlci5jc3MoJ2JhY2tncm91bmQnLCBjKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KSxcblxuICAgICAgICBjaGlsZFZpZXdPcHRpb25zOiBmdW5jdGlvbiBjaGlsZFZpZXdPcHRpb25zKG0pIHtcbiAgICAgICAgICAgIGlmICghbS5oYXMoJ2NvbG9yJykpIG0uc2V0KCdjb2xvcicsICdub25lJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hpbGRWaWV3VHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICdjbGljazppdGVtJzogJ2NsaWNrOml0ZW0nXG4gICAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPGRpdiBjbGFzcz1cInJpZ2h0XCIgc3R5bGU9XCJoZWlnaHQ6MHB4O292ZXJmbG93OmhpZGRlbjtcIj48aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImNvbG9yLWl0ZW1zLWRpYWdyYW1cIiAvPjwvZGl2PjxkaXYgY2xhc3M9XCJsaXN0XCIgc3R5bGU9XCJjbGVhcjpib3RoO1wiPjwvZGl2PicpLFxuXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBsaXN0OiAnLmxpc3QnXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB0aGlzLiQoJy5jb2xvci1pdGVtcy1kaWFncmFtJykuZWpDb2xvclBpY2tlcih7XG4gICAgICAgICAgICAgICAgZW5hYmxlT3BhY2l0eTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbG9jYWxlOiBSZXNvdXJjZXMuTGFuZ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX3ByZXBhcmVDb2xsZWN0aW9uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29sbGVjdGlvbkV2ZW50czoge1xuXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVwYXJlQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgX3ByZXBhcmVDb2xsZWN0aW9uOiBmdW5jdGlvbiBfcHJlcGFyZUNvbGxlY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBtcyA9IHRoaXMuY29sbGVjdGlvbixcbiAgICAgICAgICAgICAgICBjYyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG5cbiAgICAgICAgICAgIHZhciBjID0gXy5maW5kV2hlcmUodGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCB7IFdpZGdldFBhcmFtTmFtZTogJ1BhbGV0dGVCeUNoYXJ0JyB9KTtcblxuICAgICAgICAgICAgdmFyIGNvbG9yc1ZhbHVlID0gYyA/IGMuV2lkZ2V0UGFyYW1WYWx1ZSA6IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgaWYgKG1zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIFxuXG4gICAgICAgICAgICAgICAgdmFyIG9uZSA9IG1zLmF0KDApO1xuXG4gICAgICAgICAgICAgICAgb25lLnNldCh7IG9iamVjdF9pZDogbnVsbCwgZGlzcGxheV9uYW1lOiAnJyB9KTtcblxuICAgICAgICAgICAgICAgIG9uZS5nZXQoJ3BvaW50cycpLm1hcChmdW5jdGlvbiAobSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xvciA9ICdub25lJztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sb3JzVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gXy5maW5kV2hlcmUoY29sb3JzVmFsdWUsIHsgJ29iamVjdF9pZCc6IG0uZWxJZCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvKSBjb2xvciA9IG8uY29sb3I7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjYy5hZGQobmV3IEJhY2tib25lLk1vZGVsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdF9pZDogbS5lbElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheV9uYW1lOiBtLngsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogY29sb3JcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIG1zLm1hcChmdW5jdGlvbiAobSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG4gPSBuZXcgQmFja2JvbmUuTW9kZWwoe1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RfaWQ6IG0uZ2V0KCdlbElkJyksXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlfbmFtZTogbS5nZXQoJ25hbWUnKSB8fCBfLnBsdWNrKG0uZ2V0KCdwb2ludHMnKSwgJ3gnKS5qb2luKCcsJylcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChjb2xvcnNWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IF8uZmluZFdoZXJlKGNvbG9yc1ZhbHVlLCB7ICdvYmplY3RfaWQnOiBtLmdldCgnZWxJZCcpIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAobykgbi5zZXQoJ2NvbG9yJywgby5jb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY2MuYWRkKG4pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbGlzdCcsIG5ldyBsaXN0Q29sbGVjdGlvbih7IGNvbGxlY3Rpb246IGNjIH0pKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkNoaWxkdmlld0NsaWNrSXRlbTogZnVuY3Rpb24gb25DaGlsZHZpZXdDbGlja0l0ZW0odikge1xuXG4gICAgICAgICAgICB0aGlzLiQoJy5jb2xvci1pdGVtcy1kaWFncmFtJykuZWpDb2xvclBpY2tlcignaGlkZScpO1xuXG4gICAgICAgICAgICB0aGlzLiQoJy5jb2xvci1pdGVtcy1kaWFncmFtJykuZWpDb2xvclBpY2tlcih7XG5cbiAgICAgICAgICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb24oJ3ZhbHVlJywgdi5tb2RlbC5nZXQoJ2NvbG9yJykpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uIHNlbGVjdChhcmdzKSB7XG4gICAgICAgICAgICAgICAgICAgIHYubW9kZWwuc2V0KCdjb2xvcicsIGFyZ3MudmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLiQoJy5jb2xvci1pdGVtcy1kaWFncmFtJykuZWpDb2xvclBpY2tlcignc2hvdycpO1xuICAgICAgICB9XG4gICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnc2V0dGluZ3MuaHRtbEVkaXRvcicsIFsncmVxdWVzdFZpZXcnLCAnZy9lalJURVZpZXcnXSwgZnVuY3Rpb24gKHJlcXVlc3RzTGlzdCwgZWpSVEVWaWV3KSB7XG5cbiAgICAgICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8ZGl2IGNsYXNzPVwibGlzdFwiIHN0eWxlPVwiZGlzcGxheTpub25lO2hlaWdodDoxOTZweDttYXJnaW4tYm90dG9tOjEwcHg7XCI+PC9kaXY+PGRpdiBjbGFzcz1cImVkaXRvclwiPjwvZGl2PicpLFxuXG4gICAgICAgICAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVxQXJlYTogJy5saXN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvcjogJy5lZGl0b3InXG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uQXR0YWNoOiBmdW5jdGlvbiBvbkF0dGFjaCgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmdldFJlZ2lvbignZWRpdG9yJykuaGFzVmlldygpKSB0aGlzLnNob3dDaGlsZFZpZXcoJ2VkaXRvcicsIG5ldyBlalJURVZpZXcoeyB2YWx1ZTogdGhpcy5tb2RlbC5nZXQoJ2NvbnRlbnRIdG1sJykgfSkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFJlZ2lvbigncmVxQXJlYScpLnNob3cobmV3IHJlcXVlc3RzTGlzdCh7IG1vZGVsOiBuZXcgQmFja2JvbmUuTW9kZWwoeyB0eXBlTmFtZTogJ0FsbCcsIHdpZGdldElEOiB0aGlzLm1vZGVsLmlkIH0pIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdyZXFBcmVhJykudWkuZGVzY3JpcHRpb24uaGlkZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygncmVxQXJlYScpLm1vZGVsLm9uKCdjaGFuZ2U6cmVxdWVzdFBhcmFtZXRlcnMnLCBmdW5jdGlvbiAobW9kZWwpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IG1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5yaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHsgXCJyZXF1ZXN0UGFyYW1ldGVyc1wiOiBkYXRhIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSB0aGlzLmdldENoaWxkVmlldygnZWRpdG9yJykuZWpSVEUuZ2V0U2VsZWN0ZWRIdG1sKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISQudHJpbSh0ZXh0KSkgdGV4dCA9ICc8c3ZnIHN0eWxlPVwiZmlsbDojNjY2NjY2OyB3aWR0aDoyNHB4OyBoZWlnaHQ6MjRweDtcIj48cGF0aCBkPVwiTTE1LDAuMjc5QzE0LjcwNCwwLjEwNiwxNC4zNjUsMCwxNCwwaC0xSDRDMi45LDAsMiwwLjksMiwydjEwYy0wLjczNSwwLTEuMzczLDAuNDA2LTEuNzIxLDFDMC4xMDYsMTMuMjk2LDAsMTMuNjM1LDAsMTRzMC4xMDYsMC43MDQsMC4yNzksMUMwLjYyNywxNS41OTQsMS4yNjUsMTYsMiwxNmgxaDZoMWgxYzEuMSwwLDItMC45LDItMnYtMXYtMlY2VjRoMmgxVjNWMiBDMTYsMS4yNjUsMTUuNTk0LDAuNjI3LDE1LDAuMjc5eiBNNy4yNzksMTVIN0gzSDJjLTAuNTUyLDAtMS0wLjQ0OS0xLTFzMC40NDgtMSwxLTFoMWg0aDAuMjc5QzcuMTA2LDEzLjI5Niw3LDEzLjYzNSw3LDE0IFM3LjEwNiwxNC43MDQsNy4yNzksMTV6IE0xMiw2djV2MnYxYzAsMC41NTEtMC40NDksMS0xLDFoLTFIOWMtMC41NTIsMC0xLTAuNDQ5LTEtMXMwLjQ0OC0xLDEtMWgxdi0xSDlIM1YyYzAtMC41NTEsMC40NDgtMSwxLTEgaDguMjc5QzEyLjEwNiwxLjI5NiwxMiwxLjYzNSwxMiwydjF2MVY2eiBNMTMsM1YyYzAtMC41NTEsMC40NDktMSwxLTFzMSwwLjQ0OSwxLDF2MUgxM3pcIj48L3BhdGg+PC9zdmc+JztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdlZGl0b3InKS5lalJURS5leGVjdXRlQ29tbWFuZChcImluc2VydGh0bWxcIiwgJzxzcGFuIGRhdGEtb2tuZD1cXCc0XFwnIGRhdGEtb2lkPVxcJycgKyBkYXRhLnJpZCArICdcXCcgdGl0bGU9XFwnJyArIGRhdGEudGl0bGUgKyAnXFwnPicgKyB0ZXh0ICsgJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMubW9kZWwuc2V0KHsgXCJyZXF1ZXN0UGFyYW1ldGVyc1wiOiB7fSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICB0b29sc0J1dHRvblNob3dSZXF1ZXN0czogZnVuY3Rpb24gdG9vbHNCdXR0b25TaG93UmVxdWVzdHMoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMuZ2V0UmVnaW9uKCdyZXFBcmVhJykuY3VycmVudFZpZXcuY29sbGVjdGlvbi5mZXRjaCh7IHJlc2V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRSZWdpb24oJ3JlcUFyZWEnKS4kZWwudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uU2F2ZTogZnVuY3Rpb24gb25TYXZlKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJykgJiYgdGhpcy5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJykucmlkKSAkLmFqYXhTZXR0aW5ncy5oZWFkZXJzLmtleSA9ICQubWVyZ2VVcmxQYXJhbSgkLmFqYXhTZXR0aW5ncy5oZWFkZXJzLmtleSwgeyBSSUQ6IHRoaXMubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpLnJpZCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHsgXCJjb250ZW50SHRtbFwiOiB0aGlzLmdldENoaWxkVmlldygnZWRpdG9yJykuZWpSVEUuZ2V0SHRtbCgpIH0pO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvblJlc2V0OiBmdW5jdGlvbiBvblJlc2V0KCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRSZWdpb24oJ3JlcUFyZWEnKS5jb2xsZWN0aW9uKSB0aGlzLmdldFJlZ2lvbigncmVxQXJlYScpLmNvbGxlY3Rpb24uZmV0Y2goeyByZXNldDogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoeyBcInJlcXVlc3RQYXJhbWV0ZXJzXCI6IHt9IH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdzZXR0aW5ncy5yZXFwYXJhbXMnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnZ2xvYmFsLnJlcXVlc3QucGFyYW0nXSwgZnVuY3Rpb24gKFJlc291cmNlcywgUGFyYW1WaWV3KSB7XG5cbiAgICB2YXIgbGlzdFZpZXcgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNsYXNzTmFtZTogJ2xpc3QnLFxuXG4gICAgICAgIGNoaWxkVmlldzogUGFyYW1WaWV3LFxuXG4gICAgICAgIGNoaWxkVmlld09wdGlvbnM6IGZ1bmN0aW9uIGNoaWxkVmlld09wdGlvbnMoKSB7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmlkOiB0aGlzLm9wdGlvbnMucmlkLFxuICAgICAgICAgICAgICAgIGRiYXNlOiB0aGlzLm9wdGlvbnMuZGJhc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzxzcGFuIGNsYXNzPVwicmVxdWVzdC10aXRsZVwiPjwlLSBSZXNvdXJjZXMuc2V0dGluZ3NWaWV3X3JlcXBhcmFtc19yZXF1ZXN0VGl0bGUgJT48L3NwYW4+PHNwYW4gY2xhc3M9XCJyZXF1ZXN0LWRhdGFcIj48JS0gcmVxVGl0bGUgJT48L3NwYW4+PGJyPlxcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwicmVxdWVzdC10aXRsZVwiPjwlLSBSZXNvdXJjZXMuc2V0dGluZ3NWaWV3X3JlcXBhcmFtc19kYlRpdGxlICU+PC9zcGFuPjxzcGFuIGNsYXNzPVwicmVxdWVzdC1kYXRhXCI+PCUtIGRiVGl0bGUgJT48L3NwYW4+PGJyPlxcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZy1mb3JtLS1pbnB1dFwiPlxcbiAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJnLWZvcm0tLWNoZWNrYm94XCIgdHlwZT1cImNoZWNrYm94XCIgbmFtZT1cInVzZURlZlBhcmFtc1wiIGlkPVwiPCUtIHByZWZpeCAlPl91c2VEZWZQYXJhbXNcIiAvPlxcbiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPVwiPCUtIHByZWZpeCAlPl91c2VEZWZQYXJhbXNcIj48JS0gUmVzb3VyY2VzLmRlZmF1bHQgJT48L2xhYmVsPlxcbiAgICAgICAgICAgIDwvc3Bhbj5cXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibGlzdFwiPjwvZGl2PicpLFxuXG4gICAgICAgIGlkOiBcInJlcXVlc3QtcGFyYW1zLWNvbnRhaW5lclwiLFxuXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDogZnVuY3Rpb24gdGVtcGxhdGVDb250ZXh0KCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBSZXNvdXJjZXM6IFJlc291cmNlcyxcbiAgICAgICAgICAgICAgICBwcmVmaXg6IHRoaXMubW9kZWwuaWQsXG4gICAgICAgICAgICAgICAgcmVxVGl0bGU6IHRoaXMubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpLnJlcXVlc3RUaXRsZSxcbiAgICAgICAgICAgICAgICBkYlRpdGxlOiB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5kYlRpdGxlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIGFyZWE6IHsgZWw6ICcubGlzdCcsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgdXNlOiAnaW5wdXRbbmFtZT11c2VEZWZQYXJhbXNdJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICAnY2hhbmdlIEB1aS51c2UnOiBmdW5jdGlvbiBjaGFuZ2VVaVVzZShlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudWkudXNlLmlzKFwiOmNoZWNrZWRcIikpIHRoaXMuZ2V0Q2hpbGRWaWV3KCdhcmVhJykuJGVsLmhpZGUoKTtlbHNlIHRoaXMuZ2V0Q2hpbGRWaWV3KCdhcmVhJykuJGVsLnNob3coKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnYXJlYScsIG5ldyBsaXN0Vmlldyh7XG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbjogbmV3IEJhY2tib25lLkNvbGxlY3Rpb24odGhpcy5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJykucGFyYW1ldGVycyksXG4gICAgICAgICAgICAgICAgcmlkOiB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5yaWQsXG4gICAgICAgICAgICAgICAgZGJhc2U6IHRoaXMubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpLmRiYXNlLFxuICAgICAgICAgICAgICAgIHVzZTogdGhpcy5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJykudXNlRGVmUGFyYW1zXG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgIHZhciB1c2VEZWZhdWx0ID0gdGhpcy5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJykudXNlRGVmUGFyYW1zO1xuICAgICAgICAgICAgdGhpcy51aS51c2UucHJvcCgnY2hlY2tlZCcsIHVzZURlZmF1bHQpO1xuXG4gICAgICAgICAgICBpZiAodXNlRGVmYXVsdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdhcmVhJykuJGVsLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZSgpIHtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKTtcblxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2FyZWEnKS5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uICh2KSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh2Lm1vZGVsLnRvSlNPTigpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgY2hlY2sgPSByZXN1bHQuZmlsdGVyKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFhLlZhbHVlLmxlbmd0aCB8fCAhJC50cmltKGEuVmFsdWVbMF0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRhdGEucGFyYW1ldGVycyA9IHJlc3VsdDtcbiAgICAgICAgICAgIGRhdGEudXNlRGVmUGFyYW1zID0gdGhpcy51aS51c2UuaXMoXCI6Y2hlY2tlZFwiKTtcblxuICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoeyByZXF1ZXN0UGFyYW1ldGVyczogZGF0YSB9KTtcblxuICAgICAgICAgICAgLyogICoqKiDQv9GA0L7QsdC70LXQvNCwINGBINGB0LXRgNC40LDQu9C40LfQsNGG0LjQtdC5INC00LDQvdC90YvRhSDRgdGC0YDQvtC60LAg0YLQuNC/0LAgSVNPINGC0YDQsNC90YHRhNC+0YDQvNC40YDRg9C10YLRgdGPINCyINC00LDRgtGDINCyINC30LDQstC40YHQuNC80L7RgdGC0Lgg0L7RgiDQu9C+0LrQsNC70Lgg0LrQu9C40LXQvdGC0LAgKioqICovXG5cbiAgICAgICAgICAgICQuYWpheCh7IHVybDogdGhpcy5tb2RlbC51cmwoKSwgbWV0aG9kOiAnUFVUJywgZGF0YTogSlNPTi5zdHJpbmdpZnkodGhpcy5tb2RlbC50b0pTT04oKSksIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcgfSkuYWx3YXlzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoJ3N5bmMnKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH1cblxuICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3NldHRpbmdzVmlldycsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdzZXR0aW5ncy5sZWdlbmRNYXAnLCAnc2V0dGluZ3MucmVwb3J0aW5nVmlldycsICdzZXR0aW5ncy5iYXNlT3B0aW9ucycsICdzZXR0aW5ncy52aXN1YWxpemF0aW9uLmNoYXJ0JywgJ3NldHRpbmdzLmRlY29yYXRpb25XaWRnZXQnLCAnc2V0dGluZ3MucmVxcGFyYW1zJywgJ3NldHRpbmdzLmNoYWluJywgJ3NldHRpbmdzLmh0bWxFZGl0b3InLCAnc2V0dGluZ3Muc3Vic2NyaWJlJywgJ3NldHRpbmdzLnZpc3VhbGl6YXRpb24uY2xvdWQnLCAnc2V0dGluZ3MudmlzdWFsaXphdGlvbi50YWJsZScsICdzZXR0aW5ncy52aXN1YWxpemF0aW9uLnNlbW5ldCcsICdnbG9iYWwudmlldy5kaWFsb2cnXSwgZnVuY3Rpb24gKFJlc291cmNlcywgbGVnZW5kVmlldywgcmVwb3J0aW5nU2V0dGluZ3MsIGJhc2VPcHRpb25zLCB2aXN1YWxpemF0aW9uQ2hhcnQsIGRlY29yYXRpb24sIHJlcXBhcmFtcywgY2hhaW4sIGh0bWxFZGl0b3IsIHN1YnNjcmliZSwgY2xvdWRTZXR0aW5ncywgdmlzdWFsaXphdGlvblRhYmxlLCBzZW1uZXRTZXR0aW5ncywgZGlhbG9nVmlldykge1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBjbGFzc05hbWU6IFwic2V0dGluZ3NcIixcblxuICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPGRpdj48L2Rpdj4nKSxcblxuICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgXCJtb3VzZWRvd25cIjogZnVuY3Rpb24gbW91c2Vkb3duKGUpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgZGlhbG9nOiB7IGVsOiAnZGl2JywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgICAgIC8vdmFyIGRlY29yYXRpb24gPSB0aGlzLm1vZGVsLmhhcyhcIkRlY29yYXRpb25cIikgP1xuICAgICAgICAgICAgLy8gICB0aGlzLm1vZGVsLmdldChcIkRlY29yYXRpb25cIikgOlxuICAgICAgICAgICAgLy8gICAge1xuICAgICAgICAgICAgLy8gICAgICAgIENhcHRpb25CYWNrZ3JvdW5kOiBcInJnYmEoMjAwLCAxODgsIDE2MiwgMSlcIiwgQ2FwdGlvbkZvcmVncm91bmQ6IFwicmdiYSg1MSwgNTEsIDUxLCAxKVwiLFxuICAgICAgICAgICAgLy8gICAgICAgIENvbnRhaW5lckJhY2tncm91bmQ6IFwicmdiYSgyNTUsIDI1NSwgMjU1LCAxKVwiLCBDb250YWluZXJGb3JlZ3JvdW5kOiBcInJnYmEoNTEsIDUxLCA1MSwgMSlcIixcbiAgICAgICAgICAgIC8vICAgICAgICBMaW5rQmFja2dyb3VuZDogXCJyZ2JhKDAsIDAsIDAsIDApXCIsIExpbmtGb3JlZ3JvdW5kOiBcInJnYmEoNzAsIDEyNywgMjEyLCAxKVwiLFxuICAgICAgICAgICAgLy8gICAgICAgIENhcHRpb25Jc1Zpc2libGU6IHRydWUsIEJvcmRlcklzVmlzaWJsZTogdHJ1ZSwgQ29udGFpbmVySXNUcmFuc3BhcmVudDogZmFsc2VcbiAgICAgICAgICAgIC8vICAgIH07XG5cbiAgICAgICAgICAgIC8vaWYgKCF0aGlzLm1vZGVsLmhhcyhcIkRlY29yYXRpb25cIikpXG4gICAgICAgICAgICAvLyAgICB0aGlzLm1vZGVsLnNldChcIkRlY29yYXRpb25cIiwgZGVjb3JhdGlvbik7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnZGlhbG9nJywgbmV3IGRpYWxvZ1ZpZXcoe1xuICAgICAgICAgICAgICAgIGF1dG9PcGVuOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBoZWFkZXI6IHsgbWFuYWdlOiBbeyBpZDogJ2Nsb3NlJyB9XSB9LFxuICAgICAgICAgICAgICAgIGZvb3RlcjogbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW3sgaWQ6ICdvblNhdmUnLCB0aXRsZTogUmVzb3VyY2VzLmFwcGx5LCBjbGFzc05hbWU6ICdibHVlIHJpZ2h0JyB9LCB7IGlkOiAnb25SZXNldCcsIHRpdGxlOiBSZXNvdXJjZXMucmVzZXQsIGNsYXNzTmFtZTogJ3JpZ2h0IG5lc3QtbGVmdCcgfV0pXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbW9kZWxFdmVudHM6IHtcblxuICAgICAgICAgICAgaW52YWxpZDogZnVuY3Rpb24gaW52YWxpZChtLCBlcnIpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdkaWFsb2cnKS5nZXRDaGlsZFZpZXcoJ25vdGlmeScpLnNob3dOb3RpZnkoUmVzb3VyY2VzLmVycm9yKTtcblxuICAgICAgICAgICAgICAgIF8uZWFjaChlcnIsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFZpZXcuJCgnW25hbWU9JyArIG8ubmFtZSArICddJykuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Vmlldy4kKCcuZXJyb3InKS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksIDMwMDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0TWVudTogZnVuY3Rpb24gZ2V0TWVudSgpIHtcblxuICAgICAgICAgICAgdmFyIHR5cGVOYW1lID0gdGhpcy5tb2RlbC5nZXQoJ3R5cGVOYW1lJyksXG4gICAgICAgICAgICAgICAgc20gPSBbXTtcblxuICAgICAgICAgICAgdmFyIHN1YnNjaWJlQ29sbGVjdGlvbiA9IHRoaXMub3B0aW9ucy5zdWJzY2liZUNvbGxlY3Rpb247XG5cbiAgICAgICAgICAgIHRoaXMubWVudSA9IHtcbiAgICAgICAgICAgICAgICBiYXNlT3B0aW9uczogeyBpZDogXCJiYXNlT3B0aW9uc1wiLCB0aXRsZTogUmVzb3VyY2VzLm0xLCBpY29uOiAnZ2VhcicsIGNvbnRlbnQ6IGJhc2VPcHRpb25zIH0sXG4gICAgICAgICAgICAgICAgdmlzdWFsaXphdGlvblRhYmxlOiB7IGlkOiAndmlzdWFsaXphdGlvblRhYmxlJywgdGl0bGU6IFJlc291cmNlcy5tMiwgaWNvbjogJ2V5ZScsIGNvbnRlbnQ6IHZpc3VhbGl6YXRpb25UYWJsZSB9LFxuICAgICAgICAgICAgICAgIHZpc3VhbGl6YXRpb25DaGFydDogeyBpZDogXCJ2aXN1YWxpemF0aW9uQ2hhcnRcIiwgdGl0bGU6IFJlc291cmNlcy5tMiwgaWNvbjogJ2V5ZScsIGNvbnRlbnQ6IHZpc3VhbGl6YXRpb25DaGFydCB9LFxuICAgICAgICAgICAgICAgIHZpc3VhbGl6YXRpb25DbG91ZDogeyBpZDogJ3Zpc3VhbGl6YXRpb25DbG91ZCcsIHRpdGxlOiBSZXNvdXJjZXMubTIsIGljb246ICdleWUnLCBjb250ZW50OiBjbG91ZFNldHRpbmdzIH0sXG4gICAgICAgICAgICAgICAgdmlzdWFsaXphdGlvbkxlZ2VuZE1hcDogeyBpZDogXCJ2aXN1YWxpemF0aW9uTGVnZW5kTWFwXCIsIHRpdGxlOiBSZXNvdXJjZXMubTcsIGljb246ICdsZWdlbmQnLCBjb250ZW50OiBsZWdlbmRWaWV3IH0sXG4gICAgICAgICAgICAgICAgdmlzdWFsaXphdGlvblNlbW5ldDogeyBpZDogJ3Zpc3VhbGl6YXRpb25TZW1uZXQnLCB0aXRsZTogUmVzb3VyY2VzLm0yLCBpY29uOiAnZXllJywgY29udGVudDogc2VtbmV0U2V0dGluZ3MgfSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0UGFyYW1zOiB7IGlkOiAncmVxdWVzdFBhcmFtcycsIHRpdGxlOiBSZXNvdXJjZXMubTEyLCBpY29uOiAnc2NyaXB0LXNldHRpbmdzJywgY29udGVudDogcmVxcGFyYW1zIH0sXG4gICAgICAgICAgICAgICAgY2hhaW5EZXBlbmRlbmNpZXM6IHsgaWQ6ICdjaGFpbkRlcGVuZGVuY2llcycsIHRpdGxlOiBSZXNvdXJjZXMubTEzLCBpY29uOiAnYW5jaG9yJywgY29udGVudDogY2hhaW4gfSxcbiAgICAgICAgICAgICAgICBkZWNvcmF0aW9uOiB7IGlkOiBcImRlY29yYXRpb25cIiwgdGl0bGU6IFJlc291cmNlcy5tMywgaWNvbjogJ2FwcGVhcmFuY2UnLCBjb250ZW50OiBkZWNvcmF0aW9uIH0sXG4gICAgICAgICAgICAgICAgaHRtbEVkaXRvcjogeyBpZDogXCJodG1sRWRpdG9yXCIsIHRpdGxlOiBSZXNvdXJjZXMubTYsIGljb246ICdwZW4nLCBjb250ZW50OiBodG1sRWRpdG9yLCB0b29sYmFyOiBbeyBpZDogJ3Rvb2xzQnV0dG9uU2hvd1JlcXVlc3RzJywgdGl0bGU6IFJlc291cmNlcy5zZWxlY3RSZXF1ZXN0LCBjbGFzc05hbWU6ICdzY3JpcHQtY3JlYXRlJyB9XSB9LFxuICAgICAgICAgICAgICAgIHN1YnNjcmliZTogeyBpZDogXCJzdWJzY3JpYmVcIiwgdGl0bGU6IFJlc291cmNlcy5tNCwgaWNvbjogJ25ldy1tYWlsJywgY29udGVudDogc3Vic2NyaWJlLCBhcmdzOiB7IG1vZGVsOiB0aGlzLm1vZGVsLCBjb2xsZWN0aW9uOiBzdWJzY2liZUNvbGxlY3Rpb24gfSB9LFxuICAgICAgICAgICAgICAgIHJlcG9ydGluZ1NldHRpbmdzOiB7IGlkOiBcInJlcG9ydGluZ1NldHRpbmdzXCIsIHRpdGxlOiBSZXNvdXJjZXMubTEwLCBpY29uOiAncmVwb3J0cycsIGNvbnRlbnQ6IHJlcG9ydGluZ1NldHRpbmdzLCBhcmdzOiB7IHdpZDogdGhpcy5tb2RlbC5pZCwgcHVibGlzaGVyczogc3Vic2NpYmVDb2xsZWN0aW9uIH0gfSxcbiAgICAgICAgICAgICAgICBjbGVhcldpZGdldDogeyBpZDogJ2NsZWFyV2lkZ2V0JywgdGl0bGU6IFJlc291cmNlcy5kZWwsIGljb246ICd0cmFzaCcgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG1lbnUgPSB0aGlzLm1lbnU7XG5cbiAgICAgICAgICAgIHN3aXRjaCAodHlwZU5hbWUpIHtcblxuICAgICAgICAgICAgICAgIGNhc2UgJ1dpZGdldFRhYmxlJzpcbiAgICAgICAgICAgICAgICAgICAgc20gPSBbbWVudS5iYXNlT3B0aW9ucywgbWVudS52aXN1YWxpemF0aW9uVGFibGUsIG1lbnUucmVxdWVzdFBhcmFtcywgbWVudS5jaGFpbkRlcGVuZGVuY2llcywgbWVudS5kZWNvcmF0aW9uLCBtZW51LmNsZWFyV2lkZ2V0XTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdXaWRnZXRSdW5uaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgc20gPSBbbWVudS5iYXNlT3B0aW9ucywgbWVudS5yZXF1ZXN0UGFyYW1zLCBtZW51LmNoYWluRGVwZW5kZW5jaWVzLCBtZW51LmRlY29yYXRpb24sIG1lbnUuY2xlYXJXaWRnZXRdO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ1dpZGdldEdyYXBoJzpcbiAgICAgICAgICAgICAgICAgICAgc20gPSBbbWVudS5iYXNlT3B0aW9ucywgbWVudS52aXN1YWxpemF0aW9uQ2hhcnQsIG1lbnUucmVxdWVzdFBhcmFtcywgbWVudS5jaGFpbkRlcGVuZGVuY2llcywgbWVudS5kZWNvcmF0aW9uLCBtZW51LmNsZWFyV2lkZ2V0XTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdXaWRnZXRDbG91ZCc6XG4gICAgICAgICAgICAgICAgICAgIHNtID0gW21lbnUuYmFzZU9wdGlvbnMsIG1lbnUudmlzdWFsaXphdGlvbkNsb3VkLCBtZW51LnJlcXVlc3RQYXJhbXMsIG1lbnUuY2hhaW5EZXBlbmRlbmNpZXMsIG1lbnUuZGVjb3JhdGlvbiwgbWVudS5jbGVhcldpZGdldF07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnV2lkZ2V0TWFwJzpcbiAgICAgICAgICAgICAgICAgICAgc20gPSBbbWVudS5iYXNlT3B0aW9ucywgbWVudS52aXN1YWxpemF0aW9uTGVnZW5kTWFwLCBtZW51LnJlcXVlc3RQYXJhbXMsIG1lbnUuY2hhaW5EZXBlbmRlbmNpZXMsIG1lbnUuZGVjb3JhdGlvbiwgbWVudS5jbGVhcldpZGdldF07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnV2lkZ2V0SHRtbCc6XG4gICAgICAgICAgICAgICAgICAgIHNtID0gW21lbnUuYmFzZU9wdGlvbnMsIG1lbnUuaHRtbEVkaXRvciwgbWVudS5yZXF1ZXN0UGFyYW1zLCBtZW51LmNoYWluRGVwZW5kZW5jaWVzLCBtZW51LmRlY29yYXRpb24sIG1lbnUuY2xlYXJXaWRnZXRdO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ1dpZGdldFNvdXJjZSc6XG4gICAgICAgICAgICAgICAgICAgIHNtID0gW21lbnUuYmFzZU9wdGlvbnMsIG1lbnUuc3Vic2NyaWJlLCBtZW51LmRlY29yYXRpb24sIG1lbnUuY2xlYXJXaWRnZXRdO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ1dpZGdldFJlcG9ydGluZyc6XG4gICAgICAgICAgICAgICAgICAgIHNtID0gW21lbnUuYmFzZU9wdGlvbnMsIG1lbnUucmVwb3J0aW5nU2V0dGluZ3MsIG1lbnUuc3Vic2NyaWJlLCBtZW51LmRlY29yYXRpb24sIG1lbnUuY2xlYXJXaWRnZXRdO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ1dpZGdldFNlbU5ldCc6XG4gICAgICAgICAgICAgICAgICAgIHNtID0gW21lbnUuYmFzZU9wdGlvbnMsIG1lbnUudmlzdWFsaXphdGlvblNlbW5ldCwgbWVudS5zdWJzY3JpYmUsIG1lbnUuZGVjb3JhdGlvbiwgbWVudS5jbGVhcldpZGdldF07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzbTtcbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlOiBmdW5jdGlvbiBoaWRlKGZ4KSB7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmdldFJlZ2lvbignZGlhbG9nJykgJiYgdGhpcy5nZXRSZWdpb24oJ2RpYWxvZycpLmhhc1ZpZXcoKSkgdGhpcy5nZXRDaGlsZFZpZXcoJ2RpYWxvZycpLmNsb3NlKCk7XG5cbiAgICAgICAgICAgIC8vZWxzZSBpZiAoZngpXG4gICAgICAgICAgICAvLyAgICBmeC5jYWxsKHRoaXMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9zZXREaWFsb2c6IGZ1bmN0aW9uIF9zZXREaWFsb2coaWQpIHtcblxuICAgICAgICAgICAgdmFyIGRtID0gdGhpcy5nZXRDaGlsZFZpZXcoJ2RpYWxvZycpLm1vZGVsLFxuICAgICAgICAgICAgICAgIHMgPSB0aGlzLm1lbnVbaWRdLFxuICAgICAgICAgICAgICAgIGMgPSBzLmNvbnRlbnQ7XG5cbiAgICAgICAgICAgIGlmIChjKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAocy50b29sYmFyKSBkbS5nZXQoJ3Rvb2xiYXInKS5yZXNldChzLnRvb2xiYXIpO2Vsc2UgZG0uZ2V0KCd0b29sYmFyJykucmVzZXQoKTtcblxuICAgICAgICAgICAgICAgIC8vIFRPRE86INC/0YDQuNCy0LXRgdGC0Lgg0LLRgdC1INCw0YDQs9GD0LzQtdC90YLRiyDQuiDQvtC00L3QvtC80YMg0LLQuNC00YMg0YPQsdGA0LDRgtGMINGN0YLQvi4uLlxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0geyBtb2RlbDogdGhpcy5tb2RlbCwgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uIH07XG5cbiAgICAgICAgICAgICAgICBpZiAocy5hcmdzKSBhcmdzID0gcy5hcmdzO1xuXG4gICAgICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgYyhhcmdzKTtcblxuICAgICAgICAgICAgICAgIGRtLnNldCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBzLmljb24sXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHZpZXdcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB2aWV3O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSxcblxuICAgICAgICBzaWRlQmFyVHJpZ2dlcjogZnVuY3Rpb24gc2lkZUJhclRyaWdnZXIobSkge1xuXG4gICAgICAgICAgICB2YXIgYWN0VmlldyA9IHRoaXMuX3NldERpYWxvZyhtLmlkKTtcblxuICAgICAgICAgICAgaWYgKGFjdFZpZXcpIHtcblxuICAgICAgICAgICAgICAgIGlmIChhY3RWaWV3Lm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKSAmJiBhY3RWaWV3Lm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5yaWQpICQuYWpheFNldHRpbmdzLmhlYWRlcnMua2V5ID0gJC5tZXJnZVVybFBhcmFtKCQuYWpheFNldHRpbmdzLmhlYWRlcnMua2V5LCB7IFJJRDogYWN0Vmlldy5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJykucmlkIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGFjdFZpZXcub25CZWZvcmVTaG93KSBhY3RWaWV3Lm9uQmVmb3JlU2hvdygpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHdpbiA9ICQoJ21haW4nKSxcbiAgICAgICAgICAgICAgICAgICAgY3YgPSB0aGlzLmdldENoaWxkVmlldygnZGlhbG9nJykuJGVsLFxuICAgICAgICAgICAgICAgICAgICB0b3AgPSB3aW4uaGVpZ2h0KCkgLyAyIC0gY3YuaGVpZ2h0KCkgLyAyO1xuXG4gICAgICAgICAgICAgICAgY3YuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiB0b3AgPCA5MCA/IDEwMCA6IHRvcCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogd2luLndpZHRoKCkgLyAyIC0gY3Yud2lkdGgoKSAvIDJcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdkaWFsb2cnKS4kZWwuc2hvdyhmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdFZpZXcub25TaG93KSBhY3RWaWV3Lm9uU2hvdygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHRoaXNbbS5pZF0uY2FsbCh0aGlzKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjbGVhcldpZGdldDogZnVuY3Rpb24gY2xlYXJXaWRnZXQoKSB7XG5cbiAgICAgICAgICAgIEJhY2tib25lLnRyaWdnZXIoXCJtZXNzYWdlOmNvbmZpcm1cIiwge1xuXG4gICAgICAgICAgICAgICAgdGl0bGU6IFJlc291cmNlcy5hc2t5b3VzdXJlLCBtZXNzYWdlOiAkLkZvcm1hdChSZXNvdXJjZXMuZGVsdGV4dCwgUmVzb3VyY2VzLndpZGdldCwgdGhpcy5tb2RlbC5nZXQoXCJ0aXRsZVwiKSksXG5cbiAgICAgICAgICAgICAgICBmeDogZnVuY3Rpb24gZngoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGN0eDogdGhpc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdAd2lkZ2V0LldpZGdldENsb3VkJywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMpIHtcblxuICAgICAgICAgICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzxkaXY+PC9kaXY+JyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHsgUmVzb3VyY2VzOiBSZXNvdXJjZXMgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhcGg6IHsgZWw6ICdkaXYnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkF0dGFjaDogZnVuY3Rpb24gb25BdHRhY2goKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMubW9kZWwuZ2V0KCdmZWVkJykudmFyaWF0aW9uc1swXS5mbG93WzBdLnBvaW50cy5tYXAoZnVuY3Rpb24gKGEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGEudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlaWdodDogcGFyc2VJbnQoYS55KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWw6IHsgJ2RhdGEtb2lkJzogdGhpcy5tb2RlbC5pZCArICdfJyArIGEuZWxJZCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBuZXcgQmFja2JvbmUuTW9kZWwoeyBvYmplY3RfaWQ6IGEuZWxJZCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uc2V0KGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoJ2NsaWNrOml0ZW0nLCBtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5oZWlnaHQodGhpcy4kZWwucGFyZW50KCkuaGVpZ2h0KCkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5qUUNsb3VkKHRoaXMuZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FwcGx5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoaWxkdmlld0NsaWNrSXRlbTogZnVuY3Rpb24gb25DaGlsZHZpZXdDbGlja0l0ZW0odikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoJ2NsaWNrOml0ZW0nLCB2Lm1vZGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsRXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuZ2U6d2lkdGgnOiBmdW5jdGlvbiBjaGFuZ2VXaWR0aCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpdFNpemUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuZ2U6aGVpZ2h0JzogZnVuY3Rpb24gY2hhbmdlSGVpZ2h0KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZml0U2l6ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBfYXBwbHk6IGZ1bmN0aW9uIF9hcHBseSgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhbGxldGUgPSBfLmZpbmRXaGVyZSh0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIHsgV2lkZ2V0UGFyYW1OYW1lOiAnUGFsZXR0ZUJ5Q2hhcnQnIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNzZXQgPSBfLmZpbmRXaGVyZSh0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIHsgV2lkZ2V0UGFyYW1OYW1lOiAnV2lkZ2V0Q2xvdWQuU3ViU2V0dGluZ3MnIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3NldCAmJiBzc2V0LldpZGdldFBhcmFtVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmNzcygnZm9udC1zaXplJywgc3NldC5XaWRnZXRQYXJhbVZhbHVlLm1pbkZvbnRTaXplQ2xvdWQgKyAncHgnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhbGxldGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xvcnMgPSBwYWxsZXRlLldpZGdldFBhcmFtVmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmVmID0gdGhpcy5tb2RlbC5pZCArICdfJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChjb2xvcnMsIGZ1bmN0aW9uIChvKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLmNvbG9yICE9PSBcIm5vbmVcIikgdGhpcy4kKCdbZGF0YS1vaWQ9JyArIHByZWYgKyBvLm9iamVjdF9pZCArICddJykuY3NzKCdjb2xvcicsIG8uY29sb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBfZml0U2l6ZTogZnVuY3Rpb24gX2ZpdFNpemUoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0KSBjbGVhclRpbWVvdXQodGhpcy5zdCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3QgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuY3NzKHsgd2lkdGg6IHRoaXMuJGVsLnBhcmVudCgpLndpZHRoKCksIGhlaWdodDogdGhpcy4kZWwucGFyZW50KCkuaGVpZ2h0KCkgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmVtcHR5KCkualFDbG91ZCh0aGlzLmRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hcHBseSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCA1MDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdAd2lkZ2V0LldpZGdldEdyYXBoJywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ2VqQ2hhcnRWaWV3JywgJ2QzOmhpc3RvZ3JhbScsICdjaGFydHNSZXBvc2l0b3J5J10sIGZ1bmN0aW9uIChSZXNvdXJjZXMsIGNoYXJ0VmlldywgZDNIaXN0b2dyYW0sIHJlcG9zaXRvcnkpIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzxkaXYgY2xhc3M9XCJncmFwaFwiPjwvZGl2PicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHsgUmVzb3VyY2VzOiBSZXNvdXJjZXMgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmFwaDogeyBlbDogJy5ncmFwaCcsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkF0dGFjaDogZnVuY3Rpb24gb25BdHRhY2goKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2aXN1YWxpemF0aW9uID0gdGhpcy5tb2RlbC5nZXQoXCJWaXN1YWxpemF0aW9uXCIpIHx8IFwiYmFyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHZpc3VhbGl6YXRpb24uc3BsaXQoJ18nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBfLmZpbmRXaGVyZSh0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIHsgV2lkZ2V0UGFyYW1OYW1lOiBcIldpZGdldEdyYXBoLkdoYXBoU3ViU2V0dGluZ3NcIiB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHApIHAgPSBwLldpZGdldFBhcmFtVmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuYW1lLmxlbmd0aCAmJiBuYW1lWzFdID09PSAnZDMnKSB0aGlzLnNob3dDaGlsZFZpZXcoJ2dyYXBoJywgbmV3IGQzSGlzdG9ncmFtKHsgaXRlbXM6IHRoaXMubW9kZWwuZ2V0KCdmZWVkJyksIG1vZGVsOiB0aGlzLm1vZGVsLCBjaGFydDogbmFtZVswXSB9KSk7ZWxzZSBpZiAobmFtZVswXSAhPT0gJ3RhZ0Nsb3VkJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBfLmZpbmRXaGVyZShyZXBvc2l0b3J5LCB7IHR5cGU6IHZpc3VhbGl6YXRpb24gfSkgfHwgeyB0eXBlOiB2aXN1YWxpemF0aW9uIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8gPSB0aGlzLm1vZGVsLmdldCgnZmVlZCcpLnZhcmlhdGlvbnNbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSBuZXcgQmFja2JvbmUuTW9kZWwoXy5leHRlbmQocywgbykpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuJGVsLnBhcmVudCgpLmhlaWdodCgpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLiRlbC5wYXJlbnQoKS53aWR0aCgpLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnZ3JhcGgnLCBuZXcgY2hhcnRWaWV3KHsgbW9kZWw6IG0sIHN1YnNldDogcCwgcGFsZXR0ZTogXy5maW5kV2hlcmUodGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCB7IFdpZGdldFBhcmFtTmFtZTogJ1BhbGV0dGVCeUNoYXJ0JyB9KSB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxFdmVudHM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5nZTp3aWR0aCc6IGZ1bmN0aW9uIGNoYW5nZVdpZHRoKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpdFNpemUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuZ2U6aGVpZ2h0JzogZnVuY3Rpb24gY2hhbmdlSGVpZ2h0KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpdFNpemUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkVmlld0V2ZW50czoge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnQ6c2VsZWN0ZWQnOiBmdW5jdGlvbiBjaGFydFNlbGVjdGVkKHYpIHt9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZml0U2l6ZTogZnVuY3Rpb24gX2ZpdFNpemUoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2aXN1YWxpemF0aW9uID0gdGhpcy5tb2RlbC5nZXQoXCJWaXN1YWxpemF0aW9uXCIpIHx8IFwiYmFyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHZpc3VhbGl6YXRpb24uc3BsaXQoJ18nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUubGVuZ3RoICYmIG5hbWVbMV0gPT09ICdkMycpIHt9IGVsc2UgaWYgKG5hbWVbMF0gIT09ICd0YWdDbG91ZCcpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gdGhpcy5nZXRDaGlsZFZpZXcoJ2dyYXBoJykubW9kZWw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IF8uZmluZFdoZXJlKHRoaXMubW9kZWwuZ2V0KCdDaGFyYWN0ZXJpc3RpY3MnKSwgeyBXaWRnZXRQYXJhbU5hbWU6IFwiV2lkZ2V0R3JhcGguR2hhcGhTdWJTZXR0aW5nc1wiIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHApIHAgPSBwLldpZGdldFBhcmFtVmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnNldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy4kZWwucGFyZW50KCkuaGVpZ2h0KCkudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuJGVsLnBhcmVudCgpLndpZHRoKCkudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdncmFwaCcsIG5ldyBjaGFydFZpZXcoeyBtb2RlbDogbSwgc3Vic2V0OiBwLCBwYWxldHRlOiBfLmZpbmRXaGVyZSh0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIHsgV2lkZ2V0UGFyYW1OYW1lOiAnUGFsZXR0ZUJ5Q2hhcnQnIH0pIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnQHdpZGdldC5XaWRnZXRIdG1sJywgWydhcHAnXSwgZnVuY3Rpb24gKEFwcCkge1xuXG4gICAgICAgICAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPGRpdiBkaXI9XCJhdXRvXCI+PCU9IGNvbnRlbnRIdG1sICU+PC9kaXY+JyksXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHVpOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvaWQ6ICdzcGFuW2RhdGEtb2lkXSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG91dHB1dCA9ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5jb2xsZWN0aW9uLmF0KDApLmdldCgnZGlzcGxheV9uYW1lJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSAnPHRhYmxlPic7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5lYWNoKGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCArPSAnPHRyPic7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChlLmF0dHJpYnV0ZXMsIGZ1bmN0aW9uIChhKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghXy5pc09iamVjdChhKSkgb3V0cHV0ICs9ICc8dGQ+JyArIChhID8gYSA6ICcnKSArICc8L2E+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgKz0gJzwvdHI+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgKz0gJzwvdGFibGU+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5vaWQuaHRtbChvdXRwdXQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRGVjb3JhdGlvbiA9IHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5jc3MoeyBjb2xvcjogRGVjb3JhdGlvbi5Db250YWluZXJGb3JlZ3JvdW5kIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZChcImFcIikuY3NzKHsgXCJiYWNrZ3JvdW5kLWNvbG9yXCI6IERlY29yYXRpb24uTGlua0JhY2tncm91bmQsIFwiY29sb3JcIjogRGVjb3JhdGlvbi5MaW5rRm9yZWdyb3VuZCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnQHdpZGdldC5XaWRnZXRNYXAnLCBbJ2dsb2JhbDptYXBzOkdlb01hcEdvb2dsZVZpZXcnLCAnd2lkZ2V0Om1hcDpsZWdlbmRWaWV3J10sIGZ1bmN0aW9uIChHZW9NYXAsIGxlZ2VuZFZpZXcpIHtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzxkaXYgY2xhc3M9XCJsZWdlbmRcIj48L2Rpdj48ZGl2IGNsYXNzPVwibWFwXCI+PC9kaXY+JyksXG5cbiAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgbGVnZW5kOiB7IGVsOiAnLmxlZ2VuZCcsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICBtYXA6IHsgZWw6ICcubWFwJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdtYXAnLCBuZXcgR2VvTWFwKHtcbiAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb25cbiAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLm1vZGVsLmdldCgnTGVnZW5kJyk7XG4gICAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLkxlZ2VuZElzVmlzaWJsZSkgdGhpcy5zaG93Q2hpbGRWaWV3KCdsZWdlbmQnLCBuZXcgbGVnZW5kVmlldyh7IG1vZGVsOiBuZXcgQmFja2JvbmUuTW9kZWwoZGF0YSkgfSkpO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdAd2lkZ2V0LldpZGdldFJ1bm5pbmcnLCBbXSwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIHJldHVybiBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnUnVubmluZ1RleHQnLFxuXG4gICAgICAgICAgICAgICAgY2hpbGRWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ05hbWU6ICdzcGFuJyxcblxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0VGVtcGxhdGU6IGZ1bmN0aW9uIGdldFRlbXBsYXRlKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy50ZW1wbGF0ZSh0aGlzLm9wdGlvbnMudGVtcGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsaWNrJzogJ3RhYmxlOnJvdzpoYW5kbGVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLFxuXG4gICAgICAgICAgICAgICAgY2hpbGRWaWV3T3B0aW9uczogZnVuY3Rpb24gY2hpbGRWaWV3T3B0aW9ucygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsOiB0aGlzLnRlbXBsXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBsID0gJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5zID0gdGhpcy5tb2RlbC5nZXQoJ0NvbHVtbkN1c3RvbWl6YXRpb25zJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1ucykgXy5jaGFpbihjb2x1bW5zKS5maWx0ZXIoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUuQ29sdW1uSXNWaXNpYmxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkuc29ydEJ5KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLlNlcmlhbE51bTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcGwgKz0gJyZuYnNwOzwlPSAnICsgZS5Db2x1bW5TeXN0ZW1OYW1lLnRvTG93ZXJDYXNlKCkgKyAnICU+Jm5ic3A7JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO2Vsc2UgXy5jaGFpbih0aGlzLm1vZGVsLmdldCgnZmVlZCcpLmhlYWQpLmZpbHRlcihmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gby5pc1Zpc2libGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBsICs9ICcmbmJzcDs8JT0gJyArIGUuc3lzdGVtTmFtZSArICcgJT4mbmJzcDsnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcGwgKz0gJyZuYnNwOyZuYnNwOyoqKiZuYnNwOyZuYnNwOyc7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uQXR0YWNoOiBmdW5jdGlvbiBvbkF0dGFjaCgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBfLmZpbmRXaGVyZSh0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIHsgV2lkZ2V0UGFyYW1OYW1lOiBcIldpZGdldFJ1bkRpcmVjdGlvblwiIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IHAgPyBwLldpZGdldFBhcmFtVmFsdWUuUmlnaHQgPyAncmlnaHQnIDogJ2xlZnQnIDogJ2xlZnQnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5saU1hcnF1ZWUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IGRpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGNoaWxkVmlld0V2ZW50czoge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAndGFibGU6cm93OmhhbmRsZXInOiBmdW5jdGlvbiB0YWJsZVJvd0hhbmRsZXIodikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcignY2xpY2s6aXRlbScsIHYubW9kZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdAd2lkZ2V0LldpZGdldFRhYmxlJywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ3dpZGdldFRhYmxlQ2FyZCcsICd3aWRnZXRUYWJsZUdyaWQnXSwgZnVuY3Rpb24gKFJlc291cmNlcywgY2FyZFZpZXcsIGdyaWRWaWV3KSB7XG5cbiAgICAgICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8ZGl2PjwvZGl2PicpLFxuXG4gICAgICAgICAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgd3JhcDogeyBlbDogJ2RpdicsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXMubW9kZWwuZ2V0KCdWaXN1YWxpemF0aW9uJykgfHwgJ3RhYmxlJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndGFibGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnd3JhcCcsIG5ldyBncmlkVmlldyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjYXJkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2FyZDInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnd3JhcCcsIG5ldyBjYXJkVmlldyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgbW9kZWxFdmVudHM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5nZTpWaXN1YWxpemF0aW9uJzogZnVuY3Rpb24gY2hhbmdlVmlzdWFsaXphdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGNoaWxkVmlld1RyaWdnZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAndGFibGU6YWRkOnJ1YnJpY3M6ZmlsdGVyJzogJ3RhYmxlOmFkZDpydWJyaWNzOmZpbHRlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2Nyb2xsOmdyaWQnOiAnc2Nyb2xsOmdyaWQnXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ0B3aWRnZXQuV2lkZ2V0VmlldycsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdzZW5kTW9kZWwnLCAnc2V0dGluZ3NWaWV3JywgJ3dpZGdldC5yZXBvcnRWaWV3JywgJ3dpZGdldC5jb250ZW50LmNvbnRlbnRWaWV3JywgJ3dpZGdldC5zZW1uZXQuc2VtbmV0VmlldyddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCBzZW5kTW9kZWwsIHNldHRpbmdWaWV3LCByZXBvcnRMb2FkLCBjb250ZW50Vmlldywgc2VtbmV0Vmlldykge1xuXG4gICAgICAgICAgICAgICAgLy8gc2V0dGluZ3Muc3Vic2NyaWJlLnN1YnNjcmliZUxpc3QgXG4gICAgICAgICAgICAgICAgdmFyIGluY2x1ZGUgPSBbXCJXaWRnZXRUYWJsZVwiLCBcIldpZGdldE1hcFwiLCBcIldpZGdldEdyYXBoXCIsIFwiV2lkZ2V0UnVubmluZ1wiLCBcIldpZGdldEh0bWxcIiwgJ1dpZGdldENsb3VkJ107XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb25Nb2RlbCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkQXR0cmlidXRlOiAnV2lkZ2V0VWlkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdpZGdldFVpZDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYWNlbWVudFdpZHRoOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxhY2VtZW50SGVpZ2h0OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxhY2VtZW50VG9wOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxhY2VtZW50TGVmdDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFpJbmRleDogMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGZ1bmN0aW9uIHVybCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnL2FwaS93aWRnZXQvJyArIHRoaXMuaWQgKyAnL3Bvc2l0aW9uJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1YnNjaWJlT2JqZWN0ID0gTW4uT2JqZWN0LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi51cmwgPSAnL2FwaS93aWRnZXQvJyArIHRoaXMub3B0aW9ucy53aWRnZXRJRCArICcvc3Vic2NyaWJlZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnYW5ici13aWRnZXQnLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiB0ZW1wbGF0ZXNbJ3dpZGdldC10ZW1wbGF0ZSddLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiAnLmFuYnJfaGVhZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6ICcud2lkZ2V0LWNvbnRhaW5lcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJy53aWRnZXQtdGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZDogJy5hbmJyX2xpc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyOiAnLmFuYnJfaGVhZCAuUHJlbG9hZGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiAnLnNldHRpbmdzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYXNoOiAnLmljb24tdHJhc2gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAnLmZvbnQtaWNvbi1maWx0ZXInXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZDogJ0B1aS5sb2FkJywgLy8geyBlbDogJ0B1aS5sb2FkJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiB7IGVsOiAnQHVpLnNldHRpbmdzJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNsaWNrIC5mb250LWljb24tZmlsdGVyXCI6IGZ1bmN0aW9uIGNsaWNrRm9udEljb25GaWx0ZXIoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbG9hZCcpLmdldENoaWxkVmlldygnd3JhcCcpLmdldENoaWxkVmlldygnZmlsdGVyJykuJGVsLnNsaWRlVG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xpY2sgLmFuYnJfaGVhZCBAdWkudHJhc2gnOiBmdW5jdGlvbiBjbGlja0FuYnJfaGVhZFVpVHJhc2goKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKCdtZXNzYWdlOmNvbmZpcm0nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBSZXNvdXJjZXMuc3VyZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJC5Gb3JtYXQoUmVzb3VyY2VzLmRlbHRleHQsIFJlc291cmNlcy53aWRnZXQsIHRoaXMubW9kZWwuZ2V0KCd0aXRsZScpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZng6IGZ1bmN0aW9uIGZ4KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eDogdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtb3VzZWRvd25cIjogZnVuY3Rpb24gbW91c2Vkb3duKGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLk1vZGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRTZXR0aW5ncygpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ3NpZGViYXInKS5yZXF1ZXN0KCdvcGVuJywgeyBuYW1lVmlldzogdGhpcy5tb2RlbC5nZXQoJ3RpdGxlJyksIHZpZXc6IHRoaXMuZ2V0Q2hpbGRWaWV3KCdzZXR0aW5ncycpLCB0aXRsZTogUmVzb3VyY2VzLndzdCB9LCB0aGlzLmdldENoaWxkVmlldygnc2V0dGluZ3MnKS5nZXRNZW51KCkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSkgdGhpcy50cmlnZ2VyTWV0aG9kKCdzZWxlY3Q6bW9yZScsIHRoaXMubW9kZWwpO2Vsc2UgdGhpcy50cmlnZ2VyTWV0aG9kKCdzZWxlY3Q6b25lJywgdGhpcy5tb2RlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hZGRTZXR0aW5nczogZnVuY3Rpb24gX2FkZFNldHRpbmdzKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZ2V0UmVnaW9uKCdzZXR0aW5ncycpLmhhc1ZpZXcoKSkgdGhpcy5zaG93Q2hpbGRWaWV3KCdzZXR0aW5ncycsIG5ldyBzZXR0aW5nVmlldyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjaWJlQ29sbGVjdGlvbjogdGhpcy5zdWJzY2liZU9iamVjdC5jb2xsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ1JlYWRPbmx5JywgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFtdLCB7IG1vZGVsOiBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoeyBpZEF0dHJpYnV0ZTogJ29iamVjdF9pZCcgfSkgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NpYmVPYmplY3QgPSBuZXcgc3Vic2NpYmVPYmplY3QoeyB3aWRnZXRJRDogdGhpcy5tb2RlbC5pZCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhID0gdGhpcy5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1vZGVsID0gbmV3IHNlbmRNb2RlbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHBhLnJpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzOiBwYS5wYXJhbWV0ZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTW9kZWwub24oJ2NoYW5nZTp0cycsIGZ1bmN0aW9uIChtLCB0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cykgdGhpcy5tb2RlbC5zZXQoJ3RpbWVTdGFtcEZvclVwZGF0ZScsIHRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gbmV3IHBvc2l0aW9uTW9kZWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdpZGdldFVpZDogdGhpcy5tb2RlbC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQbGFjZW1lbnRUb3A6IHBhcnNlSW50KHRoaXMubW9kZWwuZ2V0KFwidG9wXCIpKSA8IDAgPyA1IDogcGFyc2VJbnQodGhpcy5tb2RlbC5nZXQoXCJ0b3BcIikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYWNlbWVudExlZnQ6IHBhcnNlSW50KHRoaXMubW9kZWwuZ2V0KFwibGVmdFwiKSkgPCAwID8gNSA6IHBhcnNlSW50KHRoaXMubW9kZWwuZ2V0KFwibGVmdFwiKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGxhY2VtZW50V2lkdGg6IHBhcnNlSW50KHRoaXMubW9kZWwuZ2V0KFwid2lkdGhcIikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBsYWNlbWVudEhlaWdodDogcGFyc2VJbnQodGhpcy5tb2RlbC5nZXQoXCJoZWlnaHRcIikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFpJbmRleDogcGFyc2VJbnQodGhpcy5tb2RlbC5nZXQoXCJ6SW5kZXhcIikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLnBvc2l0aW9uLCAncmVxdWVzdCcsIHRoaXMuX3NpemVBbmRQb3NpdGlvbi5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwidmlzdWFsOnVwZGF0ZVwiLCB0aGlzLl9zdWNjZXNzTG9hZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25CZWZvcmVSZW5kZXI6IGZ1bmN0aW9uIG9uQmVmb3JlUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJEZWNvcmF0aW9uXCIpICYmICF0aGlzLm1vZGVsLmdldChcIkRlY29yYXRpb25cIikuQm9yZGVySXNWaXNpYmxlKSB0aGlzLiRlbC5hZGRDbGFzcyhcIm5vc2hhZG93XCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaXplQW5kUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlY29yYXRpb24oKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwidHlwZU5hbWVcIikgIT09ICdXaWRnZXRUYWJsZScpIHRoaXMudWkuZmlsdGVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkF0dGFjaDogZnVuY3Rpb24gb25BdHRhY2goKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmbGFnID0gdGhpcy5tb2RlbC5nZXQoJ0RlY29yYXRpb24nKS5DYXB0aW9uSXNWaXNpYmxlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5tb2RlbC5nZXQoXCJoZWlnaHRcIikgLSAoZmxhZyA/IHRoaXMudWkuaGVhZC5vdXRlckhlaWdodCgpIDogMClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMudWkudHJhc2guY3NzKCdmaWxsJywgdGhpcy5tb2RlbC5nZXQoJ0RlY29yYXRpb24nKS5DYXB0aW9uRm9yZWdyb3VuZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkubG9hZC5jc3MoXCJoZWlnaHRcIiwgdGhpcy51aS5jb250YWluZXIuaGVpZ2h0KCkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ2ZpeDpzaXplJywgdGhpcy5tb2RlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxFdmVudHM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3luYzogZnVuY3Rpb24gc3luYygpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1vZGVsLnNldCgndHMnLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVjb3JhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25Mb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xpY2s6aXRlbSc6IGZ1bmN0aW9uIGNsaWNrSXRlbShpdGVtTW9kZWwpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29sbGVjdGlvbi5lYWNoKGZ1bmN0aW9uIChtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuaWQgIT09IG0uaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS50cmlnZ2VyKCdjaGVjazpzdWJzY3JpYmVycycsIHRoaXMubW9kZWwuaWQsIGl0ZW1Nb2RlbC5nZXQoJ3JlcXVlc3RJRCcpIHx8IHRoaXMubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpLnJpZCwgaXRlbU1vZGVsLmdldCgnb2JqZWN0X2lkJykpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2gobS5nZXQoJ3B1Ymxpc2hlcnNTdWJzY3JpYmVyTWFwJyksIGZ1bmN0aW9uICh2LCBrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoayA9PT0gdGhpcy5tb2RlbC5pZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaCh2LCBmdW5jdGlvbiAocCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocC5RdWVyeUlEID09PSB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5yaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXIgPSBfLmZpbmRXaGVyZShtLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5wYXJhbWV0ZXJzLCB7IGlkOiBwLlF1ZXJ5UGFyYW1JRCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChpdGVtTW9kZWwuYXR0cmlidXRlcywgZnVuY3Rpb24gKHYsIGspIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoay50b0xvd2VyQ2FzZSgpID09PSBwLkNvbHVtblN5c3RlbU5hbWUudG9Mb3dlckNhc2UoKSkgcGFyLlZhbHVlID0gW3ZdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS50cmlnZ2VyKCdsb2FkOmNoYWluJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hlY2s6c3Vic2NyaWJlcnMnOiBmdW5jdGlvbiBjaGVja1N1YnNjcmliZXJzKHN1YnNjcmliZXJJRCwgcmVxdWVzdElELCBvYmplY3RJRCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLnN1YnNjaWJlT2JqZWN0LmNvbGxlY3Rpb247XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5sZW5ndGgpIHRoaXMuX2NhbGxTdWJzY3JpYmVycyhzdWJzY3JpYmVySUQsIG9iamVjdElELCByZXF1ZXN0SUQpO2Vsc2UgaWYgKGluY2x1ZGUuaW5kZXhPZih0aGlzLm1vZGVsLmdldCgndHlwZU5hbWUnKSkgPT09IC0xICYmICF0aGlzLnN1YnNjaWJlT2JqZWN0LmlzRmV0Y2gpIGMuZmV0Y2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGNvbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NpYmVPYmplY3QuaXNGZXRjaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYWxsU3Vic2NyaWJlcnMoc3Vic2NyaWJlcklELCBvYmplY3RJRCwgcmVxdWVzdElEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbG9hZDpjaGFpbic6IGZ1bmN0aW9uIGxvYWRDaGFpbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINGG0LXQv9C+0YfQutC4INC90LUg0LTQvtC70LbQvdGLINGB0L7QtNC10YDQttCw0YLRjCDQvNC10YLQutGDINCy0YDQtdC80LXQvdC4INC00LvRjyDQvtCx0L3QvtCy0LvQtdC90LjRj1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINC30L3QsNGH0LXQvdC40LUg0LTQvtC70LbQvdC+INCx0YvRgtGM0LEg0LIgdGhpcy5tb2RlbC5nZXQoJ3RpbWVTdGFtcEZvclVwZGF0ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTW9kZWwuc2V0KCd0cycsICcnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINC90LUg0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINC/0LDRgNCw0LzQtdGC0YDRiyDQv9C+INGD0LzQvtC70YfQsNC90LjRjiDQsiDQtNCw0L3QvdC+0Lwg0YHQu9GD0YfQsNC1IC0g0YbQtdC/0L7Rh9C60LAg0YDQtdCw0LrRhtC40LlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTG9hZCh7IG5vdFVzZURlZlBhcmFtczogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINC/0L4g0LjQtNC10LUg0Y3RgtC+INC70LjRiNC90LXQtSAtIHNlbmQg0LLQtdGA0L3QtdGCINC90L7QstGL0LkgdHMg0Lgg0L7QvSDRgdC+0YXRgNCw0L3QuNGC0YHRjyDQsiB0aW1lU3RhbXBGb3JVcGRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3RpbWVTdGFtcEZvclVwZGF0ZScpKSB0aGlzLnNlbmRNb2RlbC5zZXQoJ3RzJywgdGhpcy5tb2RlbC5nZXQoJ3RpbWVTdGFtcEZvclVwZGF0ZScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmlzdWFsOnVwZGF0ZSc6IGZ1bmN0aW9uIHZpc3VhbFVwZGF0ZShmZWVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdWNjZXNzTG9hZChmZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuZ2U6Q29sdW1uQ3VzdG9taXphdGlvbnMnOiBmdW5jdGlvbiBjaGFuZ2VDb2x1bW5DdXN0b21pemF0aW9ucygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdWNjZXNzTG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5nZTpEZWNvcmF0aW9uJzogZnVuY3Rpb24gY2hhbmdlRGVjb3JhdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlY29yYXRpb24oKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5tb2RlbC5nZXQoXCJoZWlnaHRcIikgLSAodGhpcy5tb2RlbC5nZXQoJ0RlY29yYXRpb24nKS5DYXB0aW9uSXNWaXNpYmxlID8gdGhpcy51aS5oZWFkLm91dGVySGVpZ2h0KCkgOiAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkLmNzcyhcImhlaWdodFwiLCB0aGlzLnVpLmNvbnRhaW5lci5oZWlnaHQoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmdlOnRpdGxlJzogZnVuY3Rpb24gY2hhbmdlVGl0bGUobSwgdikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkudGl0bGUudGV4dCh2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuZ2U6bGVmdCc6IGZ1bmN0aW9uIGNoYW5nZUxlZnQobSwgdikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24uc2V0KCdQbGFjZW1lbnRMZWZ0Jywgdik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2l6ZUFuZFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmdlOnRvcCc6IGZ1bmN0aW9uIGNoYW5nZVRvcChtLCB2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbi5zZXQoJ1BsYWNlbWVudFRvcCcsIHYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NpemVBbmRQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYW5nZTp3aWR0aCc6IGZ1bmN0aW9uIGNoYW5nZVdpZHRoKG0sIHYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uLnNldCgnUGxhY2VtZW50V2lkdGgnLCB2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaXplQW5kUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuZ2U6aGVpZ2h0JzogZnVuY3Rpb24gY2hhbmdlSGVpZ2h0KG0sIHYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5jc3MoeyBoZWlnaHQ6IHYgLSB0aGlzLnVpLmhlYWQub3V0ZXJIZWlnaHQoKSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uLnNldCgnUGxhY2VtZW50SGVpZ2h0Jywgdik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2l6ZUFuZFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhbmdlOnpJbmRleCc6IGZ1bmN0aW9uIGNoYW5nZVpJbmRleChtLCB2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbi5zZXQoJ1pJbmRleCcsIHYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NpemVBbmRQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Mb2FkOiBmdW5jdGlvbiBvbkxvYWQobykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRPcHRpb25zID0gbyB8fCB7fTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVOYW1lID0gdGhpcy5tb2RlbC5nZXQoXCJ0eXBlTmFtZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhID0gdGhpcy5tb2RlbC5nZXQoJ3JlcXVlc3RQYXJhbWV0ZXJzJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYSAmJiBwYS5yaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGEudXNlRGVmUGFyYW1zKSB0aGlzLmxvYWRPcHRpb25zLm5vdFVzZURlZlBhcmFtcyA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRNb2RlbC5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpZDogdGhpcy5tb2RlbC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubW9kZWwuZ2V0KCd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5tb2RlbC5nZXQoJ3R5cGVOYW1lJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWaXN1YWxpemF0aW9uOiB0aGlzLm1vZGVsLmdldCgnVmlzdWFsaXphdGlvbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBwYS5yaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnM6IHBhLnBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZURlZlBhcmFtczogIXRoaXMubG9hZE9wdGlvbnMubm90VXNlRGVmUGFyYW1zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmxvYWRlci5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTW9kZWwuZmV0Y2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0aGlzLl9zdWNjZXNzTG9hZC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogdGhpcy5fZW5kbG9hZC5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3VwZGF0ZScpKSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkZXIuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRNb2RlbC5mZXRjaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0aGlzLl9zdWNjZXNzTG9hZC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRoaXMuX2VuZGxvYWQuYmluZCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksIHRoaXMubW9kZWwuZ2V0KCd0aW1lVXBkYXRlJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQstC40LTQttC10YLRiyDQvdC1INC40LzQtdGO0YnQuNC1INGB0LLQvtC40YUg0LfQsNC/0YDQvtGB0L7QslxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVOYW1lID09PSBcIldpZGdldEh0bWxcIikgdGhpcy51aS5sb2FkLmh0bWwodGhpcy5tb2RlbC5nZXQoXCJjb250ZW50SHRtbFwiKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vYmplY3RJRCAmJiB0aGlzLnJlcXVlc3RJRCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5tb2RlbC5nZXQoXCJ0eXBlTmFtZVwiKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiV2lkZ2V0U291cmNlXCI6XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2xvYWQnLCBuZXcgY29udGVudFZpZXcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdElEOiB0aGlzLnJlcXVlc3RJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0SUQ6IHRoaXMub2JqZWN0SURcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIldpZGdldFNlbU5ldFwiOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdsb2FkJywgbmV3IHNlbW5ldFZpZXcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RJRDogdGhpcy5vYmplY3RJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUklEOiB0aGlzLnJlcXVlc3RJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiB0aGlzLnVpLmNvbnRhaW5lcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiB0aGlzLm1vZGVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJXaWRnZXRSZXBvcnRpbmdcIjpcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2xvYWRlcicpLnRyaWdnZXIoJ3Nob3cnLCB0aGlzLnVpLmxvYWQsIHsgc3BlZWQ6ICdmYXN0JyB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZ2V0KCcvYXBpL3dpZGdldC9saXN0ZW4vJyArIHRoaXMucmVxdWVzdElEICsgJy9yZXBvcnRpbmcvJyArIHRoaXMubW9kZWwuaWQgKyAnLycgKyB0aGlzLm9iamVjdElEKS5kb25lKGZ1bmN0aW9uICh1cmwpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2xvYWQnLCBuZXcgcmVwb3J0TG9hZCh7IHVybDogdXJsLCBtb2RlbDogdGhpcy5tb2RlbCB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKS5hbHdheXMoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2xvYWRlcicpLnRyaWdnZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTb3VyY2VQcm9jID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiV2lkZ2V0SHRtbFwiOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnbG9hZGVyJykudHJpZ2dlcignc2hvdycsIHRoaXMudWkubG9hZCwgeyBzcGVlZDogJ2Zhc3QnIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5nZXQoJy9hcGkvd2lkZ2V0L2xpc3Rlbi8nICsgdGhpcy5yZXF1ZXN0SUQgKyAnL3Vpd2lkZ2V0LycgKyB0aGlzLm1vZGVsLmlkICsgJy8nICsgdGhpcy5vYmplY3RJRCkuZG9uZShmdW5jdGlvbiAoc291cmNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ2NvbnRlbnRIdG1sJywgc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkubG9hZC5odG1sKHRoaXMubW9kZWwuZ2V0KFwiY29udGVudEh0bWxcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKS5hbHdheXMoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2xvYWRlcicpLnRyaWdnZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTb3VyY2VQcm9jID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbmRsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jYWxsU3Vic2NyaWJlcnM6IGZ1bmN0aW9uIF9jYWxsU3Vic2NyaWJlcnMoc3Vic2NyaWJlcklELCBvYmplY3RJRCwgcmVxdWVzdElEKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NpYmVPYmplY3QuY29sbGVjdGlvbi5lYWNoKGZ1bmN0aW9uIChtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobS5pZCA9PT0gc3Vic2NyaWJlcklEKSB0aGlzLl9sb2FkU291cmNlKG9iamVjdElELCByZXF1ZXN0SUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvYWRTb3VyY2U6IGZ1bmN0aW9uIF9sb2FkU291cmNlKG9JRCwgcklEKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0SUQgPSBwYXJzZUludChvSUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0SUQgPSBwYXJzZUludChySUQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMubG9hZFNvdXJjZVByb2MpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkubG9hZGVyLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTb3VyY2VQcm9jID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25Mb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3N1Y2Nlc3NMb2FkOiBmdW5jdGlvbiBfc3VjY2Vzc0xvYWQoZmVlZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZW5kTW9kZWwuZ2V0KCdtc2cnKSkgQmFja2JvbmUudHJpZ2dlcignbWVzc2FnZTp3YXJuaW5nJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuc2VuZE1vZGVsLmdldCgnbXNnJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgnZmVlZCcsIHRoaXMuc2VuZE1vZGVsLmdldCgnZmVlZCcpIHx8IHRoaXMuc2VuZE1vZGVsLmdldCgnZGF0YScpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVOYW1lID0gdGhpcy5tb2RlbC5nZXQoXCJ0eXBlTmFtZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZShbJ0B3aWRnZXQuJyArIHR5cGVOYW1lXSwgZnVuY3Rpb24gKHR5cGVXaWRnZXQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbG9hZCcsIG5ldyB0eXBlV2lkZ2V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VuZGxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IHRoaXMubW9kZWwuZ2V0KCdmZWVkJykgPyB0aGlzLm1vZGVsLmdldCgnZmVlZCcpLml0ZW1zID8gJC5wcmVwYXJlKHRoaXMubW9kZWwuZ2V0KCdmZWVkJykuaXRlbXMpIDogdGhpcy5tb2RlbC5nZXQoJ2ZlZWQnKS52YXJpYXRpb25zWzBdLmZsb3cgOiAvLyBkaWFncmFtcyBkYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9hZE9wdGlvbnMuYWRkKSB0aGlzLmNvbGxlY3Rpb24uYWRkKGl0ZW1zKTtlbHNlIHRoaXMuY29sbGVjdGlvbi5yZXNldChpdGVtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2VuZGxvYWQ6IGZ1bmN0aW9uIF9lbmRsb2FkKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMuZ2V0Q2hpbGRWaWV3KCAnc2V0dGluZ3MnICkubG9hZFByb2Nlc3MgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkZXIuaGlkZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3R5cGVOYW1lJykgPT09ICdXaWRnZXRUYWJsZScpIHRoaXMudWkuZmlsdGVyLnNob3coKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU291cmNlUHJvYyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdsb2FkOmVuZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuaGFzKCdmZWVkJykpIHRoaXMubW9kZWwuc2V0KCdmZWVkJywge30pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRGVjb3JhdGlvbiA9IHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZyA9IHRoaXMubW9kZWwuZ2V0KCdpc01hcmtTZWxlY3RlZEl0ZW0nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCd0YWJsZS53aWRnZXQtdGFibGUgdGQnKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBEZWNvcmF0aW9uLkNvbnRhaW5lckZvcmVncm91bmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiBEZWNvcmF0aW9uLkNvbnRhaW5lckJhY2tncm91bmRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQoJy5ydWJyaWNzJykuY3NzKCdvcGFjaXR5JywgJzAuNScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQoJ3RhYmxlLndpZGdldC10YWJsZSB0cicpLmhvdmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ3RkJykuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IERlY29yYXRpb24uQ29udGFpbmVyRm9yZWdyb3VuZEhvdmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6IERlY29yYXRpb24uQ29udGFpbmVyQmFja2dyb3VuZEhvdmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNWaXNpdGVkID0gJCh0aGlzKS5oYXNDbGFzcygndmlld2VkJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQWN0aXZlID0gJCh0aGlzKS5oYXNDbGFzcygnY3VycmVudCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCd0ZCcpLmNzcyh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGlzQWN0aXZlID8gRGVjb3JhdGlvbi5Db250YWluZXJGb3JlZ3JvdW5kQWN0aXZlIDogZmxhZyAmJiBpc1Zpc2l0ZWQgPyBEZWNvcmF0aW9uLkNvbnRhaW5lckZvcmVncm91bmRWaXNpdGVkIDogRGVjb3JhdGlvbi5Db250YWluZXJGb3JlZ3JvdW5kLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogaXNBY3RpdmUgPyBEZWNvcmF0aW9uLkNvbnRhaW5lckJhY2tncm91bmRBY3RpdmUgOiBmbGFnICYmIGlzVmlzaXRlZCA/IERlY29yYXRpb24uQ29udGFpbmVyQmFja2dyb3VuZFZpc2l0ZWQgOiBEZWNvcmF0aW9uLkNvbnRhaW5lckJhY2tncm91bmRcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoXCJhXCIpLmNzcyh7IFwiYmFja2dyb3VuZC1jb2xvclwiOiBEZWNvcmF0aW9uLkxpbmtCYWNrZ3JvdW5kLCBcImNvbG9yXCI6IERlY29yYXRpb24uTGlua0ZvcmVncm91bmQgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3NpemVBbmRQb3NpdGlvbjogZnVuY3Rpb24gX3NpemVBbmRQb3NpdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5wb3NpdGlvbi5nZXQoXCJQbGFjZW1lbnRXaWR0aFwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMucG9zaXRpb24uZ2V0KFwiUGxhY2VtZW50SGVpZ2h0XCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogdGhpcy5wb3NpdGlvbi5nZXQoXCJQbGFjZW1lbnRUb3BcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogdGhpcy5wb3NpdGlvbi5nZXQoXCJQbGFjZW1lbnRMZWZ0XCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiei1pbmRleFwiOiB0aGlzLnBvc2l0aW9uLmdldChcIlpJbmRleFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RlY29yYXRpb246IGZ1bmN0aW9uIF9kZWNvcmF0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgRGVjb3JhdGlvbiA9IHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEJnID0gXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0Y3NzID0gXCJwYWRkaW5nOjEwcHggMTBweCAwO2ZvbnQtc2l6ZTogMThweDtcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdGNzcyA9IFwiZm9udC1zaXplOjFlbTtjdXJzb3I6ZGVmYXVsdDt0ZXh0LWRlY29yYXRpb246bm9uZTtcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsY3NzID0gJ2ZvbnQtc2l6ZToxM3B4O292ZXJmbG93OmF1dG87Y2xlYXI6Ym90aDsnICsgKHRoaXMubW9kZWwuZ2V0KCd0eXBlTmFtZScpICE9PSBcIldpZGdldFRhYmxlXCIgPyBcInBhZGRpbmc6MjBweDtcIiA6IFwiXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRGVjb3JhdGlvbikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKERlY29yYXRpb24uQ2FwdGlvbklzVmlzaWJsZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChEZWNvcmF0aW9uLkNhcHRpb25CYWNrZ3JvdW5kKSB0Y3NzICs9IFwiYmFja2dyb3VuZDpcIiArIERlY29yYXRpb24uQ2FwdGlvbkJhY2tncm91bmQgKyBcIjtcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRGVjb3JhdGlvbi5Cb3JkZXJJc1Zpc2libGUpIHRjc3MgKz0gJ2JvcmRlcjpzb2xpZCAxcHggJyArIERlY29yYXRpb24uQ2FwdGlvbkJhY2tncm91bmQgKyAnO2JvcmRlci1ib3R0b206MDsnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChEZWNvcmF0aW9uLkNhcHRpb25Gb3JlZ3JvdW5kKSBtdGNzcyArPSAnY29sb3I6JyArIERlY29yYXRpb24uQ2FwdGlvbkZvcmVncm91bmQgKyAnOyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRjc3MgKz0gXCJkaXNwbGF5Om5vbmU7XCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRGVjb3JhdGlvbi5Db250YWluZXJJc1RyYW5zcGFyZW50KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9kZWZhdWx0QmcgPSBcImJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7XCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ3RyYW5zcGFyZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChEZWNvcmF0aW9uLkNvbnRhaW5lckJhY2tncm91bmQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5yZW1vdmVDbGFzcygndHJhbnNwYXJlbnQnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0QmcgPSAnYmFja2dyb3VuZDonICsgRGVjb3JhdGlvbi5Db250YWluZXJCYWNrZ3JvdW5kICsgJzsnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChEZWNvcmF0aW9uLkNvbnRhaW5lckZvcmVncm91bmQpIGxjc3MgKz0gJ2NvbG9yOicgKyBEZWNvcmF0aW9uLkNvbnRhaW5lckZvcmVncm91bmQgKyAnOyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRGVjb3JhdGlvbi5Cb3JkZXJJc1Zpc2libGUpIGxjc3MgKz0gJ2JvcmRlcjpzb2xpZCAxMHB4ICcgKyBEZWNvcmF0aW9uLkNhcHRpb25CYWNrZ3JvdW5kICsgJzsnO2Vsc2UgdGNzcyArPSBcInBhZGRpbmctYm90dG9tOjEwcHg7XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkuaGVhZC5hdHRyKFwic3R5bGVcIiwgdGNzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkuY29udGFpbmVyLmF0dHIoXCJzdHlsZVwiLCBsY3NzICsgZGVmYXVsdEJnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS50aXRsZS5hdHRyKFwic3R5bGVcIiwgbXRjc3MpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnRyYXNoLmNzcygnZmlsbCcsIHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJykuQ2FwdGlvbkZvcmVncm91bmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5maWx0ZXIuY3NzKCdjb2xvcicsIHRoaXMubW9kZWwuZ2V0KCdEZWNvcmF0aW9uJykuQ2FwdGlvbkZvcmVncm91bmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaE1vZGU6IGZ1bmN0aW9uIHN3aXRjaE1vZGUoZmxhZykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5oZWFkLmNzcyh7IGN1cnNvcjogXCJtb3ZlXCIgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5kcmFnZ2FibGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2hlbHBlcjogXCJvcmlnaW5hbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGU6IHRoaXMudWkuaGVhZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsOiB0aGlzLnVpLnNldHRpbmdzLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWc6IGZ1bmN0aW9uIChlbCwgdWkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyTWV0aG9kKCd3aWRnZXQ6ZHJhZycsIHRoaXMubW9kZWwsIHVpLnBvc2l0aW9uLmxlZnQgLSB0aGlzLiRlbC5wb3NpdGlvbigpLmxlZnQsIHVpLnBvc2l0aW9uLnRvcCAtIHRoaXMuJGVsLnBvc2l0aW9uKCkudG9wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uIChlbCwgdWkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvcCA9IHBhcnNlSW50KHVpLnBvc2l0aW9uLnRvcCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlSW50KHVpLnBvc2l0aW9uLmxlZnQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9wIDwgMCkgdG9wID0gMztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZWZ0IDwgMCkgbGVmdCA9IDM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHsgdG9wOiB0b3AsIGxlZnQ6IGxlZnQgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24uc2F2ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ3dpZGdldDpkcmFnJywgdGhpcy5tb2RlbCwgbGVmdCAtIHRoaXMuJGVsLnBvc2l0aW9uKCkubGVmdCwgdG9wIC0gdGhpcy4kZWwucG9zaXRpb24oKS50b3AsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnJlc2l6YWJsZSh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplOiBmdW5jdGlvbiAoZSwgdWkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5jb250YWluZXIuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHVpLnNpemUuaGVpZ2h0IC0gdGhpcy51aS5oZWFkLm91dGVySGVpZ2h0KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKGUsIHVpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkubG9hZC5jc3MoXCJoZWlnaHRcIiwgdGhpcy51aS5jb250YWluZXIuaGVpZ2h0KCkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHBhcnNlSW50KHVpLnNpemUud2lkdGgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogcGFyc2VJbnQodWkuc2l6ZS5oZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbi5zYXZlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlck1ldGhvZCgnc2VsZWN0Om9uZScsIHRoaXMubW9kZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmhlYWQuY3NzKHsgY3Vyc29yOiAnZGVmYXVsdCcgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5kcmFnZ2FibGUoKS5kcmFnZ2FibGUoXCJkZXN0cm95XCIpLnJlc2l6YWJsZSgpLnJlc2l6YWJsZShcImRlc3Ryb3lcIikucmVtb3ZlQ2xhc3MoXCJ3aWRnZXQtZWRpdGluZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5Nb2RlID0gZmxhZztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ1JlYWRPbmx5JywgIWZsYWcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFZpZXdFdmVudHM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbnRlbnQ6bG9hZGVkJzogZnVuY3Rpb24gY29udGVudExvYWRlZCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbmRsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3Vic2NyaWJlcnM6cmVmbGVjdCc6IGZ1bmN0aW9uIHN1YnNjcmliZXJzUmVmbGVjdChtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoJ2NsaWNrOml0ZW0nLCBtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzY3JvbGw6Z3JpZCc6IGZ1bmN0aW9uIHNjcm9sbEdyaWQoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZVRvcCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9uID0gdGhpcy5zZW5kTW9kZWwuZ2V0KCdmZWVkJykucGFnaW5hdGlvbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb24udG90YWxJdGVtcyA+IHBvbi5wYWdlU2l6ZSAqIHBvbi5jdXJyZW50UGFnZSAtIHBvbi5wYWdlU2l6ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b3AgPSB0aGlzLnVpLmNvbnRhaW5lci5zY3JvbGxUb3AoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5hbmJyX2xpc3Q+ZGl2JykuaGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3IgPSBoZWlnaHQgLSB0aGlzLnVpLmNvbnRhaW5lci5oZWlnaHQoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnID0gc2F2ZVRvcCA8IHRvcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVRvcCA9IHRvcDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ3Njcm9sbCBub3QgcmVsaXNlZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmbGFnICYmIHNjciAtIHRvcCA8PSA4MCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRNb2RlbC5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRzOiB0aGlzLm1vZGVsLmdldCgndGltZVN0YW1wRm9yVXBkYXRlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogcG9uLmN1cnJlbnRQYWdlKytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTG9hZCh7IGFkZDogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Njcm9sbCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRWaWV3VHJpZ2dlcnM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RhYmxlOnJvdzpoYW5kbGVyJzogJ3RhYmxlOnJvdzpoYW5kbGVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdzZXR0aW5ncy5iYXNlT3B0aW9ucycsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdnbG9iYWwucmVxdWVzdC5wYXJhbSddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCBwYXJhbVZpZXcpIHtcblxuICAgICAgICAgICAgcmV0dXJuIE1uLkNvbGxlY3Rpb25WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkVmlldzogTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJyNiYXNlLXNldHRpbmctdGVtcGxhdGUnLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsgZWw6ICcjcGFyYW1zJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25CZWZvcmVSZW5kZXI6IGZ1bmN0aW9uIG9uQmVmb3JlUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuaGFzKCd0eXBlJykpIHRoaXMubW9kZWwuc2V0KCd0eXBlJywgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmICh0aGlzLm1vZGVsLmdldCgnbmFtZScpID09PSAnTWFpbkVudGl0eScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ3BhcmFtcycsIG5ldyBwYXJhbVZpZXcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgUGFyYW1ldHJUeXBlOiAnT2JqZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgTmFtZTogJ01haW5FbnRpdHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBEaXNwbGF5VmFsdWU6IHRoaXMubW9kZWwuZ2V0KCd2YWx1ZScpLkRpc3BsYXlWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgVmFsdWU6IHRoaXMubW9kZWwuZ2V0KCd2YWx1ZScpLlZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBDYXB0aW9uOiB0aGlzLm1vZGVsLmdldCgnZGlzcGxheU5hbWUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIH19KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFt7IGRpc3BsYXlOYW1lOiBSZXNvdXJjZXMudGl0bGUsIG5hbWU6ICd0aXRsZScsIHZhbHVlOiB0aGlzLm1vZGVsLmdldCgndGl0bGUnKSwgdHlwZTogJ3RleHQnIH0sIHsgZGlzcGxheU5hbWU6IFJlc291cmNlcy51cGRhdGluZ0NvbnRlbnQsIG5hbWU6ICd1cGRhdGUnLCB2YWx1ZTogdGhpcy5tb2RlbC5nZXQoJ3VwZGF0ZScpLCB0eXBlOiAnY2hlY2tib3gnIH0sIHsgZGlzcGxheU5hbWU6IFJlc291cmNlcy50aW1lb3V0VXBkYXRlLCBuYW1lOiAndGltZVVwZGF0ZScsIHZhbHVlOiB0aGlzLm1vZGVsLmdldCgndGltZVVwZGF0ZScpLCB0eXBlOiAndGV4dCcgfV0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3R5cGVOYW1lJykgPT09ICdXaWRnZXRTb3VyY2UnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnY2hXJykucmVxdWVzdCgnZ2V0OnBhcmFtOm1vZGVsJywgdGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCBcIldpZGdldFNvdXJjZS5PcHRpb25zXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW8uaGFzKCdXaWRnZXRQYXJhbVZhbHVlJykpIG8uc2V0KCdXaWRnZXRQYXJhbVZhbHVlJywgeyBoaWRlUnVicmljczogZmFsc2UgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5hZGQoW3sgZGlzcGxheU5hbWU6IFJlc291cmNlcy5oaWRlUnVicmljcywgbmFtZTogJ2hpZGVSdWJyaWNzJywgdmFsdWU6ICEhby5nZXQoJ1dpZGdldFBhcmFtVmFsdWUnKS5oaWRlUnVicmljcywgdHlwZTogJ2NoZWNrYm94JyB9LCB7IGRpc3BsYXlOYW1lOiBSZXNvdXJjZXNbJ2NvbnRhaW4taHRtbCddLCBuYW1lOiAnaXNIdG1sQ29udGVudCcsIHZhbHVlOiAhIXRoaXMubW9kZWwuZ2V0KCdpc0h0bWxDb250ZW50JyksIHR5cGU6ICdjaGVja2JveCcgfSwgeyBkaXNwbGF5TmFtZTogUmVzb3VyY2VzLmhpZ2hsaWdodE1lbnRpb25PYmosIG5hbWU6ICdoaWdobGlnaHRNZW50aW9uT2JqJywgdmFsdWU6ICEhdGhpcy5tb2RlbC5nZXQoJ2hpZ2hsaWdodE1lbnRpb25PYmonKSwgdHlwZTogJ2NoZWNrYm94JyB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogUmVzb3VyY2VzLmNvbnRlbnRQcm9wLCB0eXBlOiAnc2VsZWN0JywgbmFtZTogJ2NvbnRlbnRQcm9wJywgdmFsdWU6IFt7IHZhbHVlOiAnJywgdGl0bGU6ICcuLi4nIH0sIHsgdmFsdWU6ICdUZXh0U291cmNlJywgdGl0bGU6ICdUZXh0U291cmNlJywgY2hlY2tlZDogdGhpcy5tb2RlbC5nZXQoJ2NvbnRlbnRQcm9wJykgPT09ICdUZXh0U291cmNlJyB9LCB7IHZhbHVlOiAnV2ViRmlsZScsIHRpdGxlOiAnV2ViRmlsZScsIGNoZWNrZWQ6IHRoaXMubW9kZWwuZ2V0KCdjb250ZW50UHJvcCcpID09PSAnV2ViRmlsZScgfV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsgZGlzcGxheU5hbWU6IFJlc291cmNlcy5lbWMsIG5hbWU6ICdleHRyYWN0T25seU1lZGlhJywgdmFsdWU6ICEhdGhpcy5tb2RlbC5nZXQoJ2V4dHJhY3RPbmx5TWVkaWEnKSwgdHlwZTogJ2NoZWNrYm94JyB9XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgndHlwZU5hbWUnKSA9PT0gJ1dpZGdldFRhYmxlJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uYWRkKFt7IGRpc3BsYXlOYW1lOiBSZXNvdXJjZXMubWFya0FmU2VsLCBuYW1lOiAnaXNNYXJrU2VsZWN0ZWRJdGVtJywgdmFsdWU6ICEhdGhpcy5tb2RlbC5nZXQoJ2lzTWFya1NlbGVjdGVkSXRlbScpLCB0eXBlOiAnY2hlY2tib3gnIH1dKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCd0eXBlTmFtZScpID09PSAnV2lkZ2V0UnVubmluZycpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9vID0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnY2hXJykucmVxdWVzdCgnZ2V0OnBhcmFtOm1vZGVsJywgdGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCBcIldpZGdldFJ1bkRpcmVjdGlvblwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfby5oYXMoJ1dpZGdldFBhcmFtVmFsdWUnKSkgX28uc2V0KCdXaWRnZXRQYXJhbVZhbHVlJywgeyBSaWdodDogZmFsc2UgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5hZGQoW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBSZXNvdXJjZXMuZGlyZSArICcgKCAnICsgUmVzb3VyY2VzLnRvcmlnaHQgKyAnICknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1dpZGdldFJ1bkRpcmVjdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogISFfby5nZXQoJ1dpZGdldFBhcmFtVmFsdWUnKS5SaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCd0eXBlTmFtZScpID09PSAnV2lkZ2V0U2VtTmV0Jykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdjaFcnKS5yZXF1ZXN0KCdnZXQ6cGFyYW06bW9kZWwnLCB0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIFwiV2lkZ2V0U291cmNlLk9wdGlvbnNcIikuV2lkZ2V0UGFyYW1WYWx1ZSB8fCB7IERpc3BsYXlWYWx1ZTogJycsIFZhbHVlOiBbXSB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uYWRkKFt7IGRpc3BsYXlOYW1lOiBSZXNvdXJjZXMuYnNubywgbmFtZTogJ01haW5FbnRpdHknLCB2YWx1ZTogdmFsdWUgfV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRWaWV3T3B0aW9uczogZnVuY3Rpb24gY2hpbGRWaWV3T3B0aW9ucyhtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLnNldCgncHJlZml4JywgdGhpcy5tb2RlbC5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZSgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLkdldERhdGEodGhpcy4kZWwpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2NoVycpLnJlcXVlc3QoJ2dldDpwYXJhbTptb2RlbCcsIHRoaXMubW9kZWwuZ2V0KCdDaGFyYWN0ZXJpc3RpY3MnKSwgXCJXaWRnZXRTb3VyY2UuT3B0aW9uc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2V0KCdXaWRnZXRQYXJhbVZhbHVlJywgeyBoaWRlUnVicmljczogZGF0YS5oaWRlUnVicmljcyB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdjaFcnKS5yZXF1ZXN0KCdnZXQ6cGFyYW06bW9kZWwnLCB0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIFwiV2lkZ2V0UnVuRGlyZWN0aW9uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zZXQoJ1dpZGdldFBhcmFtVmFsdWUnLCB7IFJpZ2h0OiBkYXRhLldpZGdldFJ1bkRpcmVjdGlvbiB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNhdmVDb2xsZWN0aW9uID0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnY2hXJykucmVxdWVzdCgnZ2V0OnBhcmFtczpjb2xsZWN0aW9uJywgdGhpcy5tb2RlbC5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29sbGVjdGlvbi5hZGQoW28sIGFdKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvbGxlY3Rpb24uZmV0Y2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLkNoYXJhY3RlcmlzdGljcyA9IHJlcy50b0pTT04oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3NldHRpbmdzLmNoYWluJywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMpIHtcblxuICAgIHZhciBjb2xsZWN0aW9uUGFyYW1zID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuICAgICAgICBtb2RlbDogQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgICAgIGlkQXR0cmlidXRlOiAnUXVlcnlQYXJhbXNNYXBJRCcsXG4gICAgICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgICAgIFF1ZXJ5UGFyYW1zTWFwSUQ6IG51bGwsXG4gICAgICAgICAgICAgICAgUXVlcnlQYXJhbUlEOiAwLFxuICAgICAgICAgICAgICAgIFF1ZXJ5SUQ6IDAsXG4gICAgICAgICAgICAgICAgQ29sdW1uU3lzdGVtTmFtZTogJydcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9KTtcblxuICAgIHZhciBsaXN0VmlldyA9IE1uLkNvbGxlY3Rpb25WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGFnTmFtZTogJ3VsJyxcblxuICAgICAgICBjaGlsZFZpZXc6IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgdGFnTmFtZTogJ2xpJyxcblxuICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzxpbnB1dCB0eXBlPVwicmFkaW9cIiBpZD1cImlkPCUtIGlkICU+XCIgY2xhc3M9XCJnLWZvcm0tLXJhZGlvXCIgbmFtZT1cIndpZGdldHNcIiB2YWx1ZT1cIjwlLSBpZCAlPlwiPjxsYWJlbCBmb3I9XCJpZDwlLSBpZCAlPlwiPjwlLSB0aXRsZSAlPjwvbGFiZWw+JyksXG5cbiAgICAgICAgICAgIHRyaWdnZXJzOiB7XG5cbiAgICAgICAgICAgICAgICAnY2xpY2sgaW5wdXQnOiB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50OiAnd2lkZ2V0OnNlbGVjdCcsXG4gICAgICAgICAgICAgICAgICAgIHN0b3BQcm9wYWdhdGlvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0OiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSksXG5cbiAgICAgICAgY2hpbGRWaWV3VHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICd3aWRnZXQ6c2VsZWN0JzogJ3dpZGdldDpzZWxlY3QnXG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBzZWxlY3RWaWV3ID0gTW4uQ29sbGVjdGlvblZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0YWdOYW1lOiAnc2VsZWN0JyxcblxuICAgICAgICBjaGlsZFZpZXc6IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgdGFnTmFtZTogJ29wdGlvbicsXG5cbiAgICAgICAgICAgIGdldFRlbXBsYXRlOiBmdW5jdGlvbiBnZXRUZW1wbGF0ZSgpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmhhcygnZGlzcGxheU5hbWUnKSkgcmV0dXJuIF8udGVtcGxhdGUoJzwlLSBkaXNwbGF5TmFtZSAlPiAoPCUtIHN5c3RlbU5hbWUgJT4pJyk7ZWxzZSByZXR1cm4gXy50ZW1wbGF0ZSgnPCUtIENhcHRpb24gJT4gKDwlLSBOYW1lICU+KScpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuaGFzKCdzeXN0ZW1OYW1lJykpIHRoaXMuJGVsLmF0dHIoJ3ZhbHVlJywgdGhpcy5tb2RlbC5nZXQoJ3N5c3RlbU5hbWUnKSk7ZWxzZSB0aGlzLiRlbC5hdHRyKCd2YWx1ZScsIHRoaXMubW9kZWwuaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0pO1xuXG4gICAgdmFyIHJlc3VsdFZpZXcgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRhZ05hbWU6ICd1bCcsXG4gICAgICAgIGNsYXNzTmFtZTogJ2xpc3QtYXJlYScsXG5cbiAgICAgICAgY2hpbGRWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgIHRhZ05hbWU6ICdsaScsXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdpdGVtJyxcblxuICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzwlLSBUaXRsZSAlPiZuYnNwOzxzcGFuIGRhdGEtaWNvbj1cImljb24tdHJhc2hcIj48L3NwYW4+JyksXG5cbiAgICAgICAgICAgIHRyaWdnZXJzOiB7XG4gICAgICAgICAgICAgICAgJ2NsaWNrIHNwYW5bZGF0YS1pY29uPVwiaWNvbi10cmFzaFwiXSc6ICdyZWw6cmVtb3ZlJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSxcblxuICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuICAgICAgICAgICAgJ3JlbDpyZW1vdmUnOiAncmVsOnJlbW92ZSdcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0ZW1wbGF0ZTogJyNyZWxhdGlvbnMtc2V0dGluZ3MtdGVtcGxhdGUnLFxuICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHtcbiAgICAgICAgICAgIFJlc291cmNlczogUmVzb3VyY2VzXG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICdjbGljayBzcGFuW2RhdGEtaWNvbj1cImljb24tYW5jaG9yXCJdJzogZnVuY3Rpb24gY2xpY2tTcGFuRGF0YUljb25JY29uQW5jaG9yKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlV2lkZ2V0ID0gdGhpcy5zZWxlY3RXaWRnZXQuZ2V0KCd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNUaGlzV2lkZ2V0ID0gdGhpcy5nZXRDaGlsZFZpZXcoJ3BhcmFtcycpLFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zU2VsZWN0V2lkZ2V0ID0gdGhpcy5nZXRDaGlsZFZpZXcoJ3NlbGVjdCcpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG0gPSBuZXcgdGhpcy5jb2xsZWN0aW9uLm1vZGVsKHtcbiAgICAgICAgICAgICAgICAgICAgVGl0bGU6IHRpdGxlV2lkZ2V0ICsgXCIgOiBcIiArIGNvbHVtbnNTZWxlY3RXaWRnZXQuJCgnOmNoZWNrZWQnKS50ZXh0KCkgKyBcIiAtIFwiICsgcGFyYW1zVGhpc1dpZGdldC4kKCc6Y2hlY2tlZCcpLnRleHQoKSxcbiAgICAgICAgICAgICAgICAgICAgd0lEOiB0aGlzLnNlbGVjdFdpZGdldC5pZCxcbiAgICAgICAgICAgICAgICAgICAgUXVlcnlQYXJhbUlEOiBwYXJhbXNUaGlzV2lkZ2V0LiQoJzpjaGVja2VkJykudmFsKCksXG4gICAgICAgICAgICAgICAgICAgIFF1ZXJ5SUQ6IHRoaXMuc2VsZWN0V2lkZ2V0LmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5yaWQsXG4gICAgICAgICAgICAgICAgICAgIENvbHVtblN5c3RlbU5hbWU6IGNvbHVtbnNTZWxlY3RXaWRnZXQuJCgnOmNoZWNrZWQnKS52YWwoKVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbS5jb2xsZWN0aW9uID0gdGhpcy5jb2xsZWN0aW9uO1xuICAgICAgICAgICAgICAgIG0uc2F2ZSh7fSwge1xuXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChtb2RlbCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uYWRkKG1vZGVsKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLm1vZGVsLmdldCgncHVibGlzaGVyc1N1YnNjcmliZXJNYXAnKSB8fCB7fTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzW21vZGVsLmdldCgnd0lEJyldKSBzW21vZGVsLmdldCgnd0lEJyldID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNbbW9kZWwuZ2V0KCd3SUQnKV0ucHVzaChtb2RlbC50b0pTT04oKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdwdWJsaXNoZXJzU3Vic2NyaWJlck1hcCcsIHMpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksXG5cbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlck1ldGhvZCgnc2hvdzptZXNzYWdlJywgUmVzb3VyY2VzLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBsaXN0OiB7IGVsOiAnI3dpZGdldHMnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9LFxuICAgICAgICAgICAgcGFyYW1zOiB7IGVsOiAnI3BhcmFtcycsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHsgZWw6ICcjc2VsZWN0LXBhcmFtJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIHJlc3VsdDogeyBlbDogJyNyZXN1bHQnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IGNvbGxlY3Rpb25QYXJhbXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbGlzdCcsIG5ldyBsaXN0Vmlldyh7IGNvbGxlY3Rpb246IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCkgfSkpO1xuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdzZWxlY3QnLCBuZXcgc2VsZWN0Vmlldyh7IGNvbGxlY3Rpb246IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCkgfSkpO1xuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdyZXN1bHQnLCBuZXcgcmVzdWx0Vmlldyh7IGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbiB9KSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygncGFyYW1zJywgbmV3IHNlbGVjdFZpZXcoe1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IHRoaXMubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpICYmIHRoaXMubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpLnBhcmFtZXRlcnMgPyBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbih0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5wYXJhbWV0ZXJzKSA6IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKClcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkJlZm9yZVNob3c6IGZ1bmN0aW9uIG9uQmVmb3JlU2hvdygpIHtcblxuICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpICYmIHRoaXMubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpLnJpZCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzUmVnaW9uKCdub3RpZnknKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBycyA9IHRoaXMuZ2V0UmVnaW9ucygpO1xuXG4gICAgICAgICAgICAgICAgICAgIF8uZWFjaChycywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHYuJGVsLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCd0YWJsZScpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVSZWdpb24oJ25vdGlmeScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5nZXRDaGlsZFZpZXcoJ3BhcmFtcycpLmNvbGxlY3Rpb24ubGVuZ3RoKSB0aGlzLmdldENoaWxkVmlldygncGFyYW1zJykuY29sbGVjdGlvbi5yZXNldCh0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKS5wYXJhbWV0ZXJzKTtcblxuICAgICAgICAgICAgICAgIHZhciBtaWQgPSB0aGlzLm1vZGVsLmlkLFxuICAgICAgICAgICAgICAgICAgICBtb2RlbHMgPSB0aGlzLm1vZGVsLmNvbGxlY3Rpb24gPyB0aGlzLm1vZGVsLmNvbGxlY3Rpb24uZmlsdGVyKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhLmdldCgnZmVlZCcpICYmIG1pZCAhPT0gYS5pZCkgcmV0dXJuIGE7XG4gICAgICAgICAgICAgICAgfSkgOiBbXTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdsaXN0JykuY29sbGVjdGlvbi5yZXNldChtb2RlbHMpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBtID0gdGhpcy5tb2RlbC5nZXQoJ3B1Ymxpc2hlcnNTdWJzY3JpYmVyTWFwJyksXG4gICAgICAgICAgICAgICAgICAgIGxpc3RXaWRnZXRzID0gdGhpcy5nZXRDaGlsZFZpZXcoJ2xpc3QnKS5jb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNUaGlzV2lkZ2V0ID0gdGhpcy5nZXRDaGlsZFZpZXcoJ3BhcmFtcycpLmNvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnNTZWxlY3RXaWRnZXQgPSB0aGlzLmdldENoaWxkVmlldygnc2VsZWN0JykuY29sbGVjdGlvbjtcblxuICAgICAgICAgICAgICAgIF8uZWFjaChwbSwgZnVuY3Rpb24gKHYsIGspIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdyA9IHRoaXMubW9kZWwuY29sbGVjdGlvbi5nZXQoayk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF3KSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRpdGxlV2lkZ2V0ID0gdy5nZXQoJ3RpdGxlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zV2lkZ2V0ID0gdy5oYXMoJ2ZlZWQnKSA/IHcuZ2V0KCdmZWVkJykuaGVhZCA/IHcuZ2V0KCdmZWVkJykuaGVhZCA6IFt7IHN5c3RlbU5hbWU6ICdhcmdJZCcsIGRpc3BsYXlOYW1lOiAnYXJnSWQnIH0sIHsgc3lzdGVtTmFtZTogJ2ZuSWQnLCBkaXNwbGF5TmFtZTogJ2ZuSWQnIH1dIDogW107XG5cbiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHYsIGZ1bmN0aW9uIChvKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJNb2RlbCA9IHBhcmFtc1RoaXNXaWRnZXQuZ2V0KG8uUXVlcnlQYXJhbUlEKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4gPSBfLmZpbmRXaGVyZShjb2x1bW5zV2lkZ2V0LCB7IHN5c3RlbU5hbWU6IG8uQ29sdW1uU3lzdGVtTmFtZSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVBhcmFtID0gcGFyTW9kZWwuZ2V0KCdDYXB0aW9uJykgKyAnICggJyArIHBhck1vZGVsLmdldCgnTmFtZScpICsgJyApJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZUNvbHVtbiA9IGNvbHVtbiA/IGNvbHVtbi5kaXNwbGF5TmFtZSArICcgKCAnICsgY29sdW1uLnN5c3RlbU5hbWUgKyAnICknIDogJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG8uVGl0bGUgPSB0aXRsZVdpZGdldCArIFwiIDogXCIgKyB0aXRsZUNvbHVtbiArIFwiIC0gXCIgKyB0aXRsZVBhcmFtO1xuICAgICAgICAgICAgICAgICAgICAgICAgby53SUQgPSBrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBuZXcgdGhpcy5jb2xsZWN0aW9uLm1vZGVsKG8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwudXJsID0gJy9hcGkvd2lkZ2V0LycgKyB0aGlzLm1vZGVsLmlkICsgJy9xcGFyYW1tYXBzLycgKyBrICsgJy8nICsgby5RdWVyeVBhcmFtc01hcElEO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uYWRkKG1vZGVsKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgcnMgPSB0aGlzLmdldFJlZ2lvbnMoKTtcblxuICAgICAgICAgICAgICAgIF8uZWFjaChycywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgICAgICAgICAgICAgdi4kZWwuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy4kKCd0YWJsZScpLmhpZGUoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuYWRkUmVnaW9uKCdub3RpZnknLCAnLm5vdGlmeScpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG5vdGlmeSA9IE1uLlZpZXcuZXh0ZW5kKHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoUmVzb3VyY2VzLnJzdzMpXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ25vdGlmeScsIG5ldyBub3RpZnkoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29sbGVjdGlvbkV2ZW50czoge1xuXG4gICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShjLCBvKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoby5jaGFuZ2VzLnJlbW92ZWQubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBvLmNoYW5nZXMucmVtb3ZlZFswXTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMubW9kZWwuZ2V0KCdwdWJsaXNoZXJzU3Vic2NyaWJlck1hcCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gZGF0YVtkLmdldCgnd0lEJyldLmZpbHRlcihmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuUXVlcnlQYXJhbXNNYXBJRCAhPT0gZC5nZXQoJ1F1ZXJ5UGFyYW1zTWFwSUQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YVtkLmdldCgnd0lEJyldID0gcDtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgncHVibGlzaGVyc1N1YnNjcmliZXJNYXAnLCBkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbiByZXF1ZXN0KCkge30sXG5cbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdyZXN1bHQnKS5jb2xsZWN0aW9uLnJlc2V0KHRoaXMuY29sbGVjdGlvbi5tb2RlbHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoaWxkVmlld0V2ZW50czoge1xuXG4gICAgICAgICAgICAncmVsOnJlbW92ZSc6IGZ1bmN0aW9uIHJlbFJlbW92ZSh2KSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ3Nob3c6bWVzc2FnZTpjb25maXJtJywge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBSZXNvdXJjZXMuc3VyZSxcbiAgICAgICAgICAgICAgICAgICAgZng6IGZ1bmN0aW9uIGZ4KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdi5tb2RlbC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICd3aWRnZXQ6c2VsZWN0JzogZnVuY3Rpb24gd2lkZ2V0U2VsZWN0KHYpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0V2lkZ2V0ID0gdi5tb2RlbDtcblxuICAgICAgICAgICAgICAgIHZhciBvID0gdGhpcy5zZWxlY3RXaWRnZXQuZ2V0KCdmZWVkJykuaGVhZCB8fCBbeyBzeXN0ZW1OYW1lOiAnYXJnSWQnLCBkaXNwbGF5TmFtZTogJ2FyZ0lkJyB9LCB7IHN5c3RlbU5hbWU6ICdmbklkJywgZGlzcGxheU5hbWU6ICdmbklkJyB9XTtcblxuICAgICAgICAgICAgICAgIGlmIChvKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ3NlbGVjdCcpLmNvbGxlY3Rpb24ucmVzZXQobyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLnVybCA9ICcvYXBpL3dpZGdldC8nICsgdGhpcy5tb2RlbC5pZCArICcvcXBhcmFtbWFwcy8nICsgdGhpcy5zZWxlY3RXaWRnZXQuaWQ7XG4gICAgICAgICAgICAgICAgICAgIC8vdGhpcy5jb2xsZWN0aW9uLmZldGNoKHsgcmVzZXQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuZ2V0Q2hpbGRWaWV3KCdzZWxlY3QnKS5jb2xsZWN0aW9uLnJlc2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdzZXR0aW5ncy5kZWNvcmF0aW9uV2lkZ2V0JywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMpIHtcblxuICAgICAgICBmdW5jdGlvbiByZ2IyaGV4KHJnYikge1xuXG4gICAgICAgICAgICAgICAgaWYgKHJnYikgcmdiID0gcmdiLnJlcGxhY2UoJ3JnYmEoJywgJycpLnJlcGxhY2UoJyknLCAnJykuc3BsaXQoJywnKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiByZ2IgJiYgcmdiLmxlbmd0aCA9PT0gNCA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhleDogXCIjXCIgKyAoXCIwXCIgKyBwYXJzZUludChyZ2JbMF0sIDEwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKSArIChcIjBcIiArIHBhcnNlSW50KHJnYlsxXSwgMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICsgKFwiMFwiICsgcGFyc2VJbnQocmdiWzJdLCAxMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtMiksXG4gICAgICAgICAgICAgICAgICAgICAgICBhOiBwYXJzZUZsb2F0KHJnYlszXSkudG9GaXhlZCgyKSAqIDEwMFxuICAgICAgICAgICAgICAgIH0gOiB7IGhleDogJyNmZmZmZmYnLCBhOiAxMDAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBtYWtldFZpZXcgPSBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdwYXR0ZXJuJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJyNtYWtldC10ZW1wbGF0ZScsXG5cbiAgICAgICAgICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnQm9yZGVySXNWaXNpYmxlJykpIHRoaXMuJGVsLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIHRoaXMubW9kZWwuZ2V0KCdDYXB0aW9uQmFja2dyb3VuZCcpKTtlbHNlIHRoaXMuJGVsLmNzcygnYmFja2dyb3VuZC1jb2xvcicsICd0cmFuc3BhcmVudCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ0NvbnRhaW5lcklzVHJhbnNwYXJlbnQnKSkgdGhpcy4kZWwuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgJ3RyYW5zcGFyZW50Jyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBwYXRWaWV3ID0gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZGVjb3JhdGlvbicsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICcjZGVjb3JhdGlvbi1zZXR0aW5ncy10ZW1wbGF0ZScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBSZXNvdXJjZXM6IFJlc291cmNlc1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYWtldDogeyBlbDogJyNtYWtldCcsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICdjbGljayBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nOiBmdW5jdGlvbiBjbGlja0lucHV0VHlwZUNoZWNrYm94KGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGUgPSAkKGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJGUuYXR0cignbmFtZScpLCAkZS5wcm9wKCdjaGVja2VkJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdtYWtldCcsIG5ldyBtYWtldFZpZXcoeyBtb2RlbDogdGhpcy5tb2RlbCB9KSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uQXR0YWNoOiBmdW5jdGlvbiBvbkF0dGFjaCgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCdpbnB1dC5EZWNvcmF0aW9uJykuZWFjaChmdW5jdGlvbiAoaSwgZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gcmdiMmhleCh0aGlzLm1vZGVsLmdldChlLmdldEF0dHJpYnV0ZSgnbmFtZScpKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlKS5lakNvbG9yUGlja2VyKHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsZTogUmVzb3VyY2VzLkxhbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxUeXBlOiBcInBhbGV0dGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVzZXRUeXBlOiBcIndlYmNvbG9yc1wiLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbEF0dHJpYnV0ZXM6IHsgc3R5bGU6IFwiZGlzcGxheTppbmxpbmUtYmxvY2s7XCIgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2LmhleCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5VmFsdWU6IHYuYSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoYXJncykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmdiID0gJChlKS5kYXRhKCdlakNvbG9yUGlja2VyJykucmdiO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgkKGUpLmF0dHIoJ25hbWUnKSwgJ3JnYmEoJyArIHJnYi5yICsgJywnICsgcmdiLmcgKyAnLCcgKyByZ2IuYiArICcsJyArIHJnYi5hICsgJyknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG1vZGVsRXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZTogZnVuY3Rpb24gY2hhbmdlKG0pIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbWFrZXQnKS5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzxkaXY+PC9kaXY+JyksXG5cbiAgICAgICAgICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjOiB7IGVsOiAnZGl2JywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvID0gdGhpcy5tb2RlbC5nZXQoJ0RlY29yYXRpb24nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgby5wcmVmaXggPSB0aGlzLm1vZGVsLmlkIHx8IG5ldyBEYXRlKCkudmFsdWVPZigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IG5ldyBCYWNrYm9uZS5Nb2RlbChvKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdjJywgbmV3IHBhdFZpZXcoeyBtb2RlbDogbSB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuVG8obSwgJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ0RlY29yYXRpb24nLCBtLnRvSlNPTigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZSgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3NldHRpbmdzLmxlZ2VuZE1hcCcsIFsnaTE4biFubHMvcmVzb3VyY2VzLm1pbicsICdnbG9iYWwuYmVoYXZpb3JzLmlucHV0J10sIGZ1bmN0aW9uIChSZXNvdXJjZXMsIGlucHV0QmVoYXZpb3IpIHtcblxuICAgIHZhciBsZWdlbmRJdGVtID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgaWRBdHRyaWJ1dGU6IFwiTGVnZW5kSXRlbVVJRFwiLFxuICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgTGVnZW5kSXRlbVVJRDogbnVsbCxcbiAgICAgICAgICAgIE1hcmtlckNvbG9yOiBcIlwiLFxuICAgICAgICAgICAgTWFya2VyRGVzY3JpcHRpb246IFwiXCIsXG4gICAgICAgICAgICBNYXJrZXJVcmw6IFwiXCJcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIGxlZ2VuZE1vZGVsID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgICAgIGlkOiBudWxsLFxuICAgICAgICAgICAgVGl0bGU6ICcnLFxuICAgICAgICAgICAgTGVnZW5kSXNWaXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIExlZ2VuZFBvc2l0aW9uOiAnJyxcbiAgICAgICAgICAgIFdpZGdldHNMZWdlbmRJdGVtczogW11cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIGxpc3RWaWV3ID0gTW4uQ29sbGVjdGlvblZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0YWdOYW1lOiAndGFibGUnLFxuICAgICAgICBjbGFzc05hbWU6ICdpdGVtcy1sZWdlbmQtc2V0dGluZ3MnLFxuXG4gICAgICAgIGNoaWxkVmlldzogTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICB0YWdOYW1lOiAndHInLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICcjbGVnZW5kLWl0ZW0tdGVtcGxhdGUnLFxuICAgICAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7IFJlc291cmNlczogUmVzb3VyY2VzIH0sXG5cbiAgICAgICAgICAgIHVpOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2lucHV0W25hbWU9TWFya2VyRGVzY3JpcHRpb25dJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAnYmx1ciBAdWkubmFtZSc6IGZ1bmN0aW9uIGJsdXJVaU5hbWUoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCQudHJpbSh0aGlzLnVpLm5hbWUudmFsKCkpKSB0aGlzLm1vZGVsLnNldCgnTWFya2VyRGVzY3JpcHRpb24nLCB0aGlzLnVpLm5hbWUudmFsKCkpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAnY2xpY2sgYnV0dG9uW2RhdGEtaWNvbj1cImljb24tdHJhc2hcIl0nOiBmdW5jdGlvbiBjbGlja0J1dHRvbkRhdGFJY29uSWNvblRyYXNoKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIEJhY2tib25lLnRyaWdnZXIoJ21lc3NhZ2U6Y29uZmlybScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBSZXNvdXJjZXMuYXNreW91c3VyZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ4OiBmdW5jdGlvbiBmeCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHg6IHRoaXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSxcblxuICAgICAgICBjb2xsZWN0aW9uRXZlbnRzOiB7XG5cbiAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKGMsIG8pIHtcbiAgICAgICAgICAgICAgICBpZiAoby5jaGFuZ2VzLnJlbW92ZWQubGVuZ3RoKSB0aGlzLnRyaWdnZXJNZXRob2QoJ3Jlc2V0OmRlZmF1bHQnLCBvLmNoYW5nZXMucmVtb3ZlZFswXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBtYWluVmlldyA9IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBiZWhhdmlvcnM6IHtcbiAgICAgICAgICAgIGlucHV0OiBpbnB1dEJlaGF2aW9yXG4gICAgICAgIH0sXG5cbiAgICAgICAgdGVtcGxhdGU6ICcjbGVnZW5kLXNldHRpbmdzLXRlbXBsYXRlJyxcbiAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7XG4gICAgICAgICAgICBSZXNvdXJjZXM6IFJlc291cmNlc1xuICAgICAgICB9LFxuXG4gICAgICAgIHVpOiB7XG4gICAgICAgICAgICB0aXRsZTogJ2lucHV0W25hbWU9VGl0bGVdJyxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnLlJidG5TZXQgaW5wdXQnLFxuICAgICAgICAgICAgc2hvdzogJ2lucHV0W25hbWU9TGVnZW5kSXNWaXNpYmxlXSdcbiAgICAgICAgfSxcblxuICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgJ2JsdXIgQHVpLnRpdGxlJzogZnVuY3Rpb24gYmx1clVpVGl0bGUoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ1RpdGxlJywgdGhpcy51aS50aXRsZS52YWwoKSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnY2xpY2sgQHVpLnBvc2l0aW9uJzogZnVuY3Rpb24gY2xpY2tVaVBvc2l0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdMZWdlbmRQb3NpdGlvbicsIHRoaXMudWkucG9zaXRpb24uZmlsdGVyKCc6Y2hlY2tlZCcpLnZhbCgpKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdjbGljayBAdWkuc2hvdyc6IGZ1bmN0aW9uIGNsaWNrVWlTaG93KCkge1xuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdMZWdlbmRJc1Zpc2libGUnLCB0aGlzLnVpLnNob3cucHJvcCgnY2hlY2tlZCcpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIG1vZGVsRXZlbnRzOiB7XG5cbiAgICAgICAgICAgIGludmFsaWQ6IGZ1bmN0aW9uIGludmFsaWQoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51aS50aXRsZS5hZGRDbGFzcyhcIkFsYXJtXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdGhpcy51aS5wb3NpdGlvbi5maWx0ZXIoJ1t2YWx1ZT1cIicgKyB0aGlzLm1vZGVsLmdldCgnTGVnZW5kUG9zaXRpb24nKSArICdcIl0nKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzxkaXYgaWQ9XCJtYWluXCI+PC9kaXY+PGRpdiBpZD1cImxpc3RcIj48L2Rpdj4nKSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBtYWluOiB7IGVsOiAnI21haW4nLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9LFxuICAgICAgICAgICAgbGlzdDogeyBlbDogJyNsaXN0JywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdmFyIG1haW5Nb2RlbCA9IG5ldyBsZWdlbmRNb2RlbCh0aGlzLm1vZGVsLmdldCgnTGVnZW5kJykpO1xuICAgICAgICAgICAgbWFpbk1vZGVsLnNldCgnaWQnLCB0aGlzLm1vZGVsLmlkKTtcbiAgICAgICAgICAgIG1haW5Nb2RlbC51cmwgPSBcIi9hcGkvd2lkZ2V0L1wiICsgdGhpcy5tb2RlbC5pZCArIFwiL2xlZ2VuZFwiO1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ21haW4nLCBuZXcgbWFpblZpZXcoeyBtb2RlbDogbWFpbk1vZGVsIH0pKTtcblxuICAgICAgICAgICAgdmFyIGxlZ2VuZEl0ZW1zQ29sbGVjdGlvbiA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKHRoaXMubW9kZWwuZ2V0KCdXaWRnZXRzTGVnZW5kSXRlbXMnKSwgeyBtb2RlbDogbGVnZW5kSXRlbSB9KTtcbiAgICAgICAgICAgIGxlZ2VuZEl0ZW1zQ29sbGVjdGlvbi51cmwgPSAnL2FwaS93aWRnZXQvJyArIHRoaXMubW9kZWwuaWQgKyAnL2xlZ2VuZGl0ZW0nO1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2xpc3QnLCBuZXcgbGlzdFZpZXcoeyBjb2xsZWN0aW9uOiBsZWdlbmRJdGVtc0NvbGxlY3Rpb24gfSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxlY3Rpb25FdmVudHM6IHtcblxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmdldCgnTGVnZW5kJykgfHwgIXRoaXMubW9kZWwuZ2V0KCdMZWdlbmQnKS5XaWRnZXRzTGVnZW5kSXRlbXMubGVuZ3RoKSB0aGlzLnNldERlZmF1bHRMaXN0KCk7ZWxzZSB0aGlzLmdldENoaWxkVmlldygnbGlzdCcpLmNvbGxlY3Rpb24ucmVzZXQodGhpcy5tb2RlbC5nZXQoJ0xlZ2VuZCcpLldpZGdldHNMZWdlbmRJdGVtcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBvbkNoaWxkdmlld1Jlc2V0RGVmYXVsdDogZnVuY3Rpb24gb25DaGlsZHZpZXdSZXNldERlZmF1bHQobSkge1xuXG4gICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbGlzdCcpLmNvbGxlY3Rpb24uYWRkKG5ldyBsZWdlbmRJdGVtKHsgTWFya2VyVXJsOiBtLmdldCgnTWFya2VyVXJsJykgfSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uU2F2ZTogZnVuY3Rpb24gb25TYXZlKCkge1xuXG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JyxcbiAgICAgICAgICAgICAgICB1cmw6IFwiL2FwaS93aWRnZXQvXCIgKyB0aGlzLm1vZGVsLmlkICsgXCIvbGVnZW5kaXRlbXNcIixcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh0aGlzLmdldENoaWxkVmlldygnbGlzdCcpLmNvbGxlY3Rpb24udG9KU09OKCkpXG4gICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChjKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbWFpbicpLm1vZGVsLnNhdmUoeyBXaWRnZXRzTGVnZW5kSXRlbXM6IHRoaXMuZ2V0Q2hpbGRWaWV3KCdsaXN0JykuY29sbGVjdGlvbi50b0pTT04oKSB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7ICdMZWdlbmQnOiB0aGlzLmdldENoaWxkVmlldygnbWFpbicpLm1vZGVsLnRvSlNPTigpIH0pO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlc2V0OiBmdW5jdGlvbiBvblJlc2V0KCkge1xuXG4gICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbGlzdCcpLmNvbGxlY3Rpb24ucmVzZXQoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0RGVmYXVsdExpc3QoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXREZWZhdWx0TGlzdDogZnVuY3Rpb24gc2V0RGVmYXVsdExpc3QoKSB7XG5cbiAgICAgICAgICAgIHZhciBncm91cCA9IHRoaXMuY29sbGVjdGlvbi5ncm91cEJ5KCdtYXJrZXJ1cmwnKTtcblxuICAgICAgICAgICAgXy5lYWNoKGdyb3VwLCBmdW5jdGlvbiAobywgaykge1xuXG4gICAgICAgICAgICAgICAgaWYgKGsgIT09ICd1bmRlZmluZWQnKSB0aGlzLmdldENoaWxkVmlldygnbGlzdCcpLmNvbGxlY3Rpb24uYWRkKG5ldyBsZWdlbmRJdGVtKHsgTWFya2VyVXJsOiBrIH0pKTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdzZXR0aW5ncy5yZXBvcnRpbmdWaWV3JywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ2cvdHJlZSddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCB0cmVlVmlldykge1xuXG4gICAgdmFyIG1vZGVsUmVwb3J0ID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgaWRBdHRyaWJ1dGU6IFwiVUlEXCIsXG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICBVSUQ6IG51bGwsXG4gICAgICAgICAgICBSZXBvcnRTeXNOYW1lOiBcIlwiLFxuICAgICAgICAgICAgVHlwZVN5c05hbWU6IFwiXCJcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIGxpc3RSZXBvcnRzID0gTW4uQ29sbGVjdGlvblZpZXcuZXh0ZW5kKHtcbiAgICAgICAgY2xhc3NOYW1lOiAnbGlzdC1yZXBvcnQnLFxuICAgICAgICB0YWdOYW1lOiAnc2VjdGlvbicsXG5cbiAgICAgICAgY2hpbGRWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2l0ZW0nLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICcjaXRlbS1yZXBvcnQtdGVtcGxhdGUnLFxuXG4gICAgICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICBSZXNvdXJjZXM6IFJlc291cmNlc1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgdHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICAgICBcImNsaWNrIC5mb250LWljb24tZGVsZXRlXCI6ICdyZXBvcnQ6Y2xlYXInXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLFxuXG4gICAgICAgIGNoaWxkVmlld1RyaWdnZXJzOiB7XG4gICAgICAgICAgICAncmVwb3J0OmNsZWFyJzogJ3JlcG9ydDpjbGVhcidcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICB2YXIgb3B0aW9uVmlldyA9IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0YWdOYW1lOiAnb3B0aW9uJyxcbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzwlLSB0aXRsZSAlPicpLFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcbiAgICAgICAgICAgIHRoaXMuJGVsLmF0dHIoJ3ZhbHVlJywgdGhpcy5tb2RlbC5pZCk7XG4gICAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgdmFyIHNlbGVjdFZpZXcgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRhZ05hbWU6ICdzZWxlY3QnLFxuXG4gICAgICAgIGNoaWxkVmlldzogb3B0aW9uVmlldyxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuYWRkQ2hpbGRWaWV3KG5ldyBvcHRpb25WaWV3KHsgbW9kZWw6IG5ldyBCYWNrYm9uZS5Nb2RlbCh7IGlkOiAnMCcsIHRpdGxlOiAnLi4uJyB9KSB9KSwgMCk7XG4gICAgICAgICAgICB0aGlzLiRlbC52YWwoJzAnKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgJ2NoYW5nZSc6ICdjaGFuZ2U6cHVibGlzaCdcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBjbGFzc05hbWU6ICd0eXBlLXJlcG9ydGluZyBhbmJyLXRhYnMnLFxuICAgICAgICB0ZW1wbGF0ZTogJyN0eXBlLXJlcG9ydGluZy1zZXR0aW5ncycsXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgIFwiY2xpY2sgbmF2PnNwYW5cIjogZnVuY3Rpb24gY2xpY2tOYXZTcGFuKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRhYigkKGUudGFyZ2V0KS5jbG9zZXN0KFwic3BhbltkYXRhLW5hbWVdXCIpLmF0dHIoXCJkYXRhLW5hbWVcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2hpbGR2aWV3Q2hhbmdlUHVibGlzaDogZnVuY3Rpb24gb25DaGlsZHZpZXdDaGFuZ2VQdWJsaXNoKHYpIHtcblxuICAgICAgICAgICAgdmFyIHdpZCA9IHYuJGVsLnZhbCgpO1xuXG4gICAgICAgICAgICBpZiAod2lkICE9PSAnMCcpIHtcblxuICAgICAgICAgICAgICAgIGlmICh2Lm9wdGlvbnMubmFtZSA9PT0gJ3B1Ymxpc2hlcnMnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ3JlcCcpLmNvbGxlY3Rpb24ucmVzZXQoKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdyA9IHYuY29sbGVjdGlvbi5nZXQod2lkKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAody5oYXMoXCJyZXF1ZXN0UGFyYW1ldGVyc1wiKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnlpZCA9IHcuZ2V0KFwicmVxdWVzdFBhcmFtZXRlcnNcIikucmlkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQoXCIubG9hZC10cmVlXCIpLnNob3coKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbCA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wudXJsID0gJy9hcGkvVHJlZS9CeVdpZGdldFEvJyArIHF1ZXJ5aWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygndHJlZScsIG5ldyB0cmVlVmlldyh7IGNvbGxlY3Rpb246IGNvbCwgbm9kZTogeyBjaGVja2JveDogZmFsc2UgfSB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wuZmV0Y2goeyByZXNldDogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLmdldENoaWxkVmlldygndHJlZScpLCAnY29udGFpbmVyOnNlbGVjdDppdGVtJywgZnVuY3Rpb24gKHYpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdUeXBlU3lzTmFtZScsIHYubW9kZWwuZ2V0KFwic3lzTmFtZVwiKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmdldCgnL2FwaS9SZXBvcnRpbmcvQnlXaWRnZXRRLycgKyBxdWVyeWlkICsgJy8nICsgdi5tb2RlbC5pZCkuZG9uZShmdW5jdGlvbiAoYSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdyZXAnKS5jb2xsZWN0aW9uLnJlc2V0KF8ubWFwKGEsIGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBpZDogYi5SZXBvcnRTeXNOYW1lLCB0aXRsZTogYi5SZXBvcnREZXNjcmlwdGlvbiB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5nZXRSZWdpb24oJ3RyZWUnKS5lbXB0eSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodi5vcHRpb25zLm5hbWUgPT09ICdyZXBvcnRzJykgdGhpcy5tb2RlbC5zZXQoJ1JlcG9ydFN5c05hbWUnLCB3aWQpO1xuICAgICAgICAgICAgfSBlbHNlIHRoaXMuZ2V0UmVnaW9uKCd0cmVlJykuZW1wdHkoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdFdmVudHM6IHt9LFxuXG4gICAgICAgIG9uQ2hpbGR2aWV3UmVwb3J0Q2xlYXI6IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3UmVwb3J0Q2xlYXIodikge1xuXG4gICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ3Nob3c6bWVzc2FnZTpjb25maXJtJywge1xuICAgICAgICAgICAgICAgIHRleHQ6IFJlc291cmNlcy5zdXJlLFxuICAgICAgICAgICAgICAgIGZ4OiBmdW5jdGlvbiBmeCgpIHtcbiAgICAgICAgICAgICAgICAgICAgdi5tb2RlbC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjdHg6IHRoaXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFjdGl2ZVRhYjogZnVuY3Rpb24gYWN0aXZlVGFiKG5hbWUpIHtcblxuICAgICAgICAgICAgdGhpcy4kKFwibmF2PnNwYW5cIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB0aGlzLiQoXCJuYXY+c3BhbltkYXRhLW5hbWU9J1wiICsgbmFtZSArIFwiJ11cIikuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB0aGlzLiQoXCJzZWN0aW9uXCIpLmhpZGUoKTtcbiAgICAgICAgICAgIHRoaXMuJChcIi5cIiArIG5hbWUpLnNob3coKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBsaXN0OiB7IGVsOiAnLmxpc3QtcmVwb3J0JywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIHB1Ymw6IHsgZWw6ICcubGlzdC1wdWJsaXNoZXJzJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIHJlcDogeyBlbDogJy50eXBlLXJlcCcsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICB0cmVlOiB7IGVsOiAnLmxvYWQtdHJlZScsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygncHVibCcsIG5ldyBzZWxlY3RWaWV3KHsgY29sbGVjdGlvbjogbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKSwgbmFtZTogJ3B1Ymxpc2hlcnMnIH0pKTtcbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygncmVwJywgbmV3IHNlbGVjdFZpZXcoeyBjb2xsZWN0aW9uOiBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbigpLCBuYW1lOiAncmVwb3J0cycgfSkpO1xuXG4gICAgICAgICAgICB2YXIgbGlzdENvbGxlY3Rpb24gPSBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgbGlzdENvbGxlY3Rpb24ubW9kZWwgPSBtb2RlbFJlcG9ydDtcbiAgICAgICAgICAgIGxpc3RDb2xsZWN0aW9uLnVybCA9ICcvYXBpL3dpZGdldC8nICsgdGhpcy5vcHRpb25zLndpZCArICcvcmVwb3J0aXRlbXMnO1xuXG4gICAgICAgICAgICB0aGlzLm1vZGVsID0gbmV3IG1vZGVsUmVwb3J0KCk7XG4gICAgICAgICAgICB0aGlzLm1vZGVsLmNvbGxlY3Rpb24gPSBsaXN0Q29sbGVjdGlvbjtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdsaXN0JywgbmV3IGxpc3RSZXBvcnRzKHsgY29sbGVjdGlvbjogbGlzdENvbGxlY3Rpb24gfSkpO1xuXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZVRhYihcImxpc3QtcmVwb3J0XCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQmVmb3JlU2hvdzogZnVuY3Rpb24gb25CZWZvcmVTaG93KCkge1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5wdWJsaXNoZXJzLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnB1Ymxpc2hlcnMuZmV0Y2goe1xuICAgICAgICAgICAgICAgICAgICByZXNldDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb24ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCcubm90aWNlJykuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygncHVibCcpLmNvbGxlY3Rpb24ucmVzZXQodGhpcy5vcHRpb25zLnB1Ymxpc2hlcnMubW9kZWxzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbGlzdCcpLmNvbGxlY3Rpb24uZmV0Y2goeyByZXNldDogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLiQoJy5ub3RpY2UnKS5odG1sKFJlc291cmNlcy5zdWJzY3JOb3RlKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdGhpcy4kKCcubm90aWNlJykuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygncHVibCcpLmNvbGxlY3Rpb24ucmVzZXQodGhpcy5vcHRpb25zLnB1Ymxpc2hlcnMubW9kZWxzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbGlzdCcpLmNvbGxlY3Rpb24uZmV0Y2goeyByZXNldDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHt9LCB7XG5cbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAobW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2xpc3QnKS5jb2xsZWN0aW9uLmFkZChtb2RlbCk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdzZXR0aW5ncy5zdWJzY3JpYmVMaXN0JywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMpIHtcblxuICAgICAgICAvLyDRgdC8LiDRgtCw0LrQttC1IHdpZGdldC53aWRnZXRWaWV3IGluY2x1ZGVcbiAgICAgICAgdmFyIGluY2x1ZGUgPSBbXCJXaWRnZXRUYWJsZVwiLCBcIldpZGdldE1hcFwiLCBcIldpZGdldEdyYXBoXCIsIFwiV2lkZ2V0UnVubmluZ1wiLCBcIldpZGdldEh0bWxcIiwgJ1dpZGdldENsb3VkJywgJ1dpZGdldFNlbU5ldCddO1xuXG4gICAgICAgIHJldHVybiBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImxpc3QtYXJlYVwiLFxuXG4gICAgICAgICAgICAgICAgZW1wdHlWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8aSBzdHlsZT1cImNvbG9yOnJlZDtmb250LXN0eWxlOml0YWxpYztcIj48JS0gUmVzb3VyY2VzLnN1YnNub3Rmb3VuZCAlPjwvaT4nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlQ29udGV4dDogeyBSZXNvdXJjZXM6IFJlc291cmNlcyB9XG5cbiAgICAgICAgICAgICAgICB9KSxcblxuICAgICAgICAgICAgICAgIGNoaWxkVmlldzogTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdpdGVtJyxcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoXCI8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSdnLWZvcm0tLWNoZWNrYm94JyBpZD0nPCUtIGlkICU+JyBuYW1lPSc8JS0gaWQgJT4nIC8+PGxhYmVsIGZvcj0nPCUtIGlkICU+Jz48JT0gdGl0bGUgJT4mbmJzcDsoPCU9IHR5cGVOYW1lICU+KTwvbGFiZWw+XCIpLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNsaWNrXCI6ICdjbGljazppdGVtJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgb25CZWZvcmVSZW5kZXI6IGZ1bmN0aW9uIG9uQmVmb3JlUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlLmluZGV4T2YodGhpcy5tb2RlbC5nZXQoXCJ0eXBlTmFtZVwiKSkgPT09IC0xKSB0aGlzLiRlbC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KSxcblxuICAgICAgICAgICAgICAgIGlzRW1wdHk6IGZ1bmN0aW9uIGlzRW1wdHkoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb24pIHJldHVybiAhdGhpcy5jb2xsZWN0aW9uLmZpbHRlcihmdW5jdGlvbiAobSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmNsdWRlLmluZGV4T2YobS5nZXQoXCJ0eXBlTmFtZVwiKSkgIT09IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkubGVuZ3RoO2Vsc2UgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGNoaWxkVmlld1RyaWdnZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnY2xpY2s6aXRlbSc6ICdjbGljazppdGVtOnN1YnNjcmliZSdcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnc2V0dGluZ3Muc3Vic2NyaWJlJywgWydzZXR0aW5ncy5zdWJzY3JpYmVMaXN0J10sIGZ1bmN0aW9uIChzdWJzY3JpYmVMaXN0KSB7XG5cbiAgICAgICAgICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8ZGl2PjwvZGl2PicpLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhOiAnZGl2J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdCA9IG5ldyBzdWJzY3JpYmVMaXN0KHsgY29sbGVjdGlvbjogdGhpcy5tb2RlbC5jb2xsZWN0aW9uIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2FyZWEnLCBsaXN0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5zZXRGaWx0ZXIoZnVuY3Rpb24gKGNoaWxkLCBpbmRleCwgY29sbGVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkLmlkICE9PSB0aGlzLm1vZGVsLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hpbGR2aWV3Q2xpY2tJdGVtU3Vic2NyaWJlOiBmdW5jdGlvbiBvbkNoaWxkdmlld0NsaWNrSXRlbVN1YnNjcmliZSh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdi4kKCdpbnB1dCcpLmlzKCc6Y2hlY2tlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5jcmVhdGUobmV3IEJhY2tib25lLk1vZGVsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2Lm1vZGVsLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHYubW9kZWwuZ2V0KCd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFBhcmFtZXRlcnM6IHYubW9kZWwuZ2V0KCdyZXF1ZXN0UGFyYW1ldGVycycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24uZ2V0KHYubW9kZWwuaWQpLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25FdmVudHM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBfY2hlY2s6IGZ1bmN0aW9uIF9jaGVjaygpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2FyZWEnKS5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uICh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb24uZmluZFdoZXJlKHsgaWQ6IHYubW9kZWwuaWQgfSkpIHYuJCgnaW5wdXQnKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7ZWxzZSB2LiQoJ2lucHV0JykucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgb25TaG93OiBmdW5jdGlvbiBvblNob3coKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb2xsZWN0aW9uLmxlbmd0aCkgdGhpcy5jb2xsZWN0aW9uLmZldGNoKHsgcmVzZXQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3dpZGdldC5jb250ZW50LmNvbnRlbnRWaWV3JywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJy9qcy9kaXN0L3ZpZGVvLWpzL3ZpZGVvLmpzJywgJy9qcy9kaXN0L2pxdWVyeS5tQ3VzdG9tU2Nyb2xsYmFyLmNvbmNhdC5taW4uanMnXSwgZnVuY3Rpb24gKFJlc291cmNlcykge1xuXG4gICAgdmFyIENvbnRlbnRNb2RlbCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7IGlkQXR0cmlidXRlOiBcIm9iamVjdF9pZFwiIH0pO1xuXG4gICAgdmFyIGl0ZW1zVmlldyA9IE1uLkNvbGxlY3Rpb25WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgY2xhc3NOYW1lOiAnYWNjb3JkaW9uJyxcblxuICAgICAgICBvbkF0dGFjaDogZnVuY3Rpb24gb25BdHRhY2goKSB7XG5cbiAgICAgICAgICAgIHRoaXMuJGVsLmNzcyh7IHBvc2l0aW9uOiAncmVsYXRpdmUnLCBvdmVyZmxvdzogJ2hpZGRlbicgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hpbGRWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2l0ZW0tY29udGVudCcsXG5cbiAgICAgICAgICAgIHRlbXBsYXRlOiB0ZW1wbGF0ZXNbJ3dpZGdldC1zb3VyY2UtY29udGVudCddLFxuICAgICAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7IFJlc291cmNlczogUmVzb3VyY2VzIH0sXG5cbiAgICAgICAgICAgIHVpOiB7XG4gICAgICAgICAgICAgICAgaGVhZDogJy5oZWFkLWNvbnRlbnQnLFxuICAgICAgICAgICAgICAgIGxvYWQ6ICcubG9hZCcsXG4gICAgICAgICAgICAgICAgcnVicmljczogJy5jYXJkLXJ1YnJpYycsXG4gICAgICAgICAgICAgICAgdXJsOiAnLmNhcmQtbGluaycsXG4gICAgICAgICAgICAgICAgcGxheTogJy5wbGF5LWJ1dHRvbidcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICAgICAgJ2NsaWNrIEB1aS5wbGF5JzogZnVuY3Rpb24gY2xpY2tVaVBsYXkoZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciAkZSA9ICQoZS50YXJnZXQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBwYXJzZUludCh0aGlzLm1vZGVsLmdldCgncGxheWluZ2F0JykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gcGFyc2VJbnQodGhpcy5tb2RlbC5nZXQoJ3BsYXlpbmd1bnRpbCcpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSB2aWRlb2pzKHRoaXMuJCgndmlkZW8nKS5nZXQoMCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkucGxheS50ZXh0KCdwYXVzZScpO1xuXG4gICAgICAgICAgICAgICAgICAgIHAucmVhZHkoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVuZCB8fCB0aGlzLmN1cnJlbnRUaW1lKCkgPCBlbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXVzZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS50ZXh0KCdwYXVzZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5wYXVzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcC5vbihcIndhaXRpbmdcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGUuYXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcC5vbihcImxvYWRlZGRhdGFcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGUucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcC5vbihcInBhdXNlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRlLnRleHQoJ3BsYXknKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgQmFja2JvbmUudHJpZ2dlcihcInN0b3JhZ2U6YWRkUGxheWVyXCIsIHAsIHRoaXMubW9kZWwuZ2V0KFwib2JqZWN0X2lkXCIpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmxpZ2h0UG9zID0gW107XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvbkJlZm9yZVJlbmRlcjogZnVuY3Rpb24gb25CZWZvcmVSZW5kZXIoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuaGFzKCd3ZWJmaWxlJykpIHRoaXMubW9kZWwuc2V0KCd3ZWJmaWxlJywgJycpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuaGFzKCdjb250ZW50Y29sbGVjdGlvbl9ydWJyaWNzJykgJiYgJC50cmltKHRoaXMubW9kZWwuZ2V0KCdjb250ZW50Y29sbGVjdGlvbl9ydWJyaWNzJykpICYmICF0aGlzLm1vZGVsLmdldCgnaGlkZVJ1YnJpY3MnKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5tb2RlbC5nZXQoJ2NvbnRlbnRjb2xsZWN0aW9uX3J1YnJpY3MnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoXy5pc0FycmF5KGMpICYmIGMubGVuZ3RoKSB0aGlzLnVpLnJ1YnJpY3MuZmluZCgncCcpLmh0bWwoYy5qb2luKCcgfCAnKSk7ZWxzZSB0aGlzLnVpLnJ1YnJpY3MuZmluZCgncCcpLnRleHQoYyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMudWkucnVicmljcy5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3VybF/QuNGB0YLQvtGH0L3QuNC60LAnKSkgdGhpcy51aS51cmwuaHRtbCgnPHNwYW4gY2xhc3M9XCJjYXJkLWxpbmstaWNvblwiPjxzdmcgY2xhc3M9XCJsaW5rLWljb25cIj48dXNlIHhsaW5rOmhyZWY9XCIjbGluay1pY29uXCI+PC91c2U+PC9zdmc+PC9zcGFuPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCInICsgdGhpcy5tb2RlbC5nZXQoJ3VybF/QuNGB0YLQvtGH0L3QuNC60LAnKSArICdcIiB0YXJnZXQ9XCJfYmxhbmtcIj4nICsgKHRoaXMubW9kZWwuZ2V0KCdtYXNzbWVkaWEnKSB8fCB0aGlzLm1vZGVsLmdldCgndXJsX9C40YHRgtC+0YfQvdC40LrQsCcpKSArICc8L2E+Jyk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvbkF0dGFjaDogZnVuY3Rpb24gb25BdHRhY2goKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgdHlwZW5hbWUgPSB0aGlzLm1vZGVsLmdldCgnc3lzdGVtdHlwZW5hbWUnKTtcblxuICAgICAgICAgICAgICAgIGlmICh0eXBlbmFtZSA9PT0gXCJBdWRpb3NvdXJjZVwiIHx8IHR5cGVuYW1lID09PSBcIlZpZGVvU291cmNlXCIpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IHZpZGVvanModGhpcy4kKCd2aWRlbycpLmdldCgwKSksXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWRlb1dpZHRoID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvSGVpZ2h0ID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzVmlkZW8gPSB0aGlzLm1vZGVsLmdldCgnc3lzdGVtdHlwZW5hbWUnKSA9PT0gXCJWaWRlb1NvdXJjZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdyA9IHRoaXMuJGVsLndpZHRoKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1ZpZGVvKSBwLmhlaWdodCgxMjgsIHRydWUpO2Vsc2UgcC5oZWlnaHQoKHRoaXMuJGVsLndpZHRoKCkgLSA4MCkgLyAzLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBwLm9uKFwibG9hZGVkZGF0YVwiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvV2lkdGggPSB0aGlzLkwudmlkZW9XaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvSGVpZ2h0ID0gdGhpcy5MLnZpZGVvSGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNWaWRlbykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHcgPCB2aWRlb1dpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gdmlkZW9XaWR0aCAvIHZpZGVvSGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb1dpZHRoID0gdyAtIDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb0hlaWdodCA9IHZpZGVvV2lkdGggLyBkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud2lkdGgodmlkZW9XaWR0aCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQodmlkZW9IZWlnaHQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5fdG9MaWdodFBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBfdG9MaWdodFBvc2l0aW9uOiBmdW5jdGlvbiBfdG9MaWdodFBvc2l0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVpLmxvYWQuY3NzKHsgd2lkdGg6IHRoaXMuJGVsLmNsb3Nlc3QoJy53aWRnZXQtY29udGFpbmVyJykud2lkdGgoKSwgaGVpZ2h0OiB0aGlzLiRlbC5jbG9zZXN0KCcud2lkZ2V0LWNvbnRhaW5lcicpLmhlaWdodCgpIC0gdGhpcy51aS5oZWFkLmhlaWdodCgpLCBvdmVyZmxvdzogJ2F1dG8nIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkLmZpbmQoXCJzcGFuW2RhdGEtb2lkXVwiKS5lYWNoKGZ1bmN0aW9uIChpLCBlKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZSkuYWRkQ2xhc3MoXCJNYXJrXCIpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5saWdodFBvcy5wdXNoKCQoZSkucG9zaXRpb24oKS50b3ApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBkID0gdGhpcy5saWdodFBvcyxcbiAgICAgICAgICAgICAgICAgICAgc3AgPSAwO1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkLm1DdXN0b21TY3JvbGxiYXIoKTtcblxuICAgICAgICAgICAgICAgIGlmIChwZC5sZW5ndGggJiYgc3AgIT09IHBkLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkubG9hZC5tQ3VzdG9tU2Nyb2xsYmFyKFwic2Nyb2xsVG9cIiwgcGRbc3BdIC0gdGhpcy51aS5sb2FkLnBvc2l0aW9uKCkudG9wIC0gMyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkLmZpbmQoXCJzcGFuW2RhdGEtb2tuZD0yXS5DXCIpLnJlbW92ZUNsYXNzKFwiQ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5sb2FkLmZpbmQoXCJzcGFuW2RhdGEtb2tuZD0yXVwiKS5lcShzcCkuYWRkQ2xhc3MoXCJDXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzcCA9PT0gcGQubGVuZ3RoIC0gMSkgc3AgPSAwO2Vsc2Ugc3ArKztcbiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy51aS5sb2FkLm1DdXN0b21TY3JvbGxiYXIoXCJzY3JvbGxUb1wiLCAwKTtcblxuICAgICAgICAgICAgICAgIC8vdGhpcy4kKFwiLmdvdG9yZXN1bHQgLnRvdGFsXCIpLmh0bWwoUmVzb3VyY2VzLlRvdGFsICsgXCImbmJzcDtcIiArIFJlc291cmNlcy5tYXRjaGVzICsgXCI6Jm5ic3A7XCIgKyBwZC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIC8vaWYgKHBkLmxlbmd0aClcbiAgICAgICAgICAgICAgICAvLyAgICB0aGlzLiQoXCIuZ290b3Jlc3VsdFwiKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgLy9lbHNlXG4gICAgICAgICAgICAgICAgLy8gICAgdGhpcy4kKFwiLmdvdG9yZXN1bHRcIikuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgfSk7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8ZGl2PjwvZGl2PicpLFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIGl0ZW1zOiB7IGVsOiAnZGl2JywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgICAgIEJhY2tib25lLnRyaWdnZXIoXCJzdG9yYWdlOmNsZWFyUGxheWVyc1wiKTtcblxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi51cmwgPSAnL2FwaS93aWRnZXQvbGlzdGVuLycgKyB0aGlzLm9wdGlvbnMucmVxdWVzdElEICsgJy9zb3VyY2UvJyArIHRoaXMubW9kZWwuaWQgKyAnLycgKyB0aGlzLm9wdGlvbnMub2JqZWN0SUQ7XG4gICAgICAgICAgICAvLycvYXBpL2RldGFpbHMvQ29udGVudFYyLycgKyB0aGlzLm9wdGlvbnMub2JqZWN0SUQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2l0ZW1zJywgbmV3IGl0ZW1zVmlldyh7IGNvbGxlY3Rpb246IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCkgfSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQXR0YWNoOiBmdW5jdGlvbiBvbkF0dGFjaCgpIHtcblxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmZldGNoKHsgcmVzZXQ6IHRydWUgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbW9kZWxFdmVudHM6IHtcblxuICAgICAgICAgICAgJ2NoYW5nZTpoZWlnaHQnOiBmdW5jdGlvbiBjaGFuZ2VIZWlnaHQoKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnaXRlbXMnKS5yZW5kZXIoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxlY3Rpb25FdmVudHM6IHtcblxuICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gcmVxdWVzdCgpIHtcblxuICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2xvYWRlcicpLnRyaWdnZXIoJ3Nob3cnLCB0aGlzLiRlbCwgeyBzcGVlZDogJ2Zhc3QnIH0pO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG8gPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdjaFcnKS5yZXF1ZXN0KCdnZXQ6cGFyYW06bW9kZWwnLCB0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIFwiV2lkZ2V0U291cmNlLk9wdGlvbnNcIiksXG4gICAgICAgICAgICAgICAgICAgIGhpZGVSdWJyaWNzID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAoby5oYXMoJ1dpZGdldFBhcmFtVmFsdWUnKSkgaGlkZVJ1YnJpY3MgPSBvLmdldCgnV2lkZ2V0UGFyYW1WYWx1ZScpLmhpZGVSdWJyaWNzO1xuXG4gICAgICAgICAgICAgICAgdmFyIG0gPSB0aGlzLmNvbGxlY3Rpb24uYXQoMCksXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gbS5nZXQoJ2l0ZW1zJyksXG4gICAgICAgICAgICAgICAgICAgIGMgPSBbXTtcblxuICAgICAgICAgICAgICAgIF8uZWFjaChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IF8uY2hhaW4oaXRlbS5kYXRhKS5tYXAoZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbbS5zeXN0ZW1OYW1lLCBtLnZhbHVlXTtcbiAgICAgICAgICAgICAgICAgICAgfSkub2JqZWN0KCkudmFsdWUoKTtcblxuICAgICAgICAgICAgICAgICAgICBhdHRyLmxpbmtzID0gaXRlbS5saW5rcztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWF0dHIudGV4dHNvdXJjZSkgYXR0ci50ZXh0c291cmNlID0gJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgYXR0ci5oaWRlUnVicmljcyA9IGhpZGVSdWJyaWNzO1xuXG4gICAgICAgICAgICAgICAgICAgIGMucHVzaChhdHRyKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdpdGVtcycpLmNvbGxlY3Rpb24ucmVzZXQoYyk7XG5cbiAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdsb2FkZXInKS50cmlnZ2VyKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyTWV0aG9kKCdjb250ZW50OmxvYWRlZCcpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKCkge1xuXG4gICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnbG9hZGVyJykudHJpZ2dlcignaGlkZScpO1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlck1ldGhvZCgnY29udGVudDpsb2FkZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICB9KTtcblxuICAgIC8vdmFyIGNvbnRlbnRUZW1wbGF0ZSA9ICc8ZGl2IGNsYXNzPVwiVG9vbHNcIj48L2Rpdj48ZGl2IGNsYXNzPVwiZ290b3Jlc3VsdFwiIGRhdGEtaWQ9XCI2NzgyRTQwQi03OTRBLTQ2N0QtQkM4RS0yMTk5MjkyMDMxN0RcIj48c3BhbiBjbGFzcz1cInRvdGFsXCI+PC9zcGFuPiZuYnNwOzxidXR0b24gY2xhc3M9XCJ1cFwiPjwlPSBSZXNvdXJjZXMuZ28gJT48L2J1dHRvbj48L2Rpdj48ZGl2IGNsYXNzPVwiUnVicmljc0xpbmtcIj48L2Rpdj48ZGl2IGNsYXNzPVwiY29udGVudFNuZXRcIj48L2Rpdj48ZGl2IGNsYXNzPVwiTG9hZFwiPjwvZGl2PicsXG5cbiAgICAvLyAgICBtZWRpYVRlbXBsYXRlID0gJzwlIGlmKHN5c3RlbXR5cGVuYW1lPT1cIlZpZGVvU291cmNlXCIpeyU+PGRpdj48dmlkZW8gaWQ9XCJ2aWRlb0ZhY3Q8JT0gb2JqZWN0X2lkICU+XCIgY2xhc3M9XCJ2aWRlby1qcyB2anMtZGVmYXVsdC1za2luIFZpZGVvc291cmNlXCIgcHJlbG9hZD1cIm5vbmVcIiBwb3N0ZXI9XCIvaW1hZ2VzL0Rpc3BsYXkxMjh4MTI4LnBuZ1wiPjxzb3VyY2Ugc3JjPVwiPCU9IE1lZGlhVXJsICU+PCUgaWYoUGxheWluZ0F0KXsgJT4jdD08JT0gUGxheWluZ0F0ICU+LDwlPSBQbGF5aW5nVW50aWwgJT48JSB9ICU+XCIgdHlwZT1cInZpZGVvL21wNFwiPjwvdmlkZW8+PG5hdj48YnV0dG9uIGNsYXNzID1cIlBsYXlcIiBkYXRhLXN0YXJ0PVwiPCU9IFBsYXlpbmdBdCAlPlwiIGRhdGEtZW5kPVwiPCU9IFBsYXlpbmdVbnRpbCAlPlwiPiZuYnNwOyA8L2J1dHRvbj48c3BhbiBjbGFzcz1cIkR1cmF0aW9uXCI+PC9zcGFuPjwvbmF2PjwvZGl2PjwlIH0gaWYoc3lzdGVtdHlwZW5hbWU9PVwiQXVkaW9zb3VyY2VcIil7ICU+PGRpdj48dmlkZW8gaWQ9XCJ2aWRlb0ZhY3Q8JT0gT2JqZWN0X0lEICU+XCIgY2xhc3M9XCJ2aWRlby1qcyB2anMtZGVmYXVsdC1za2luIEF1ZGlvc291cmNlXCIgcHJlbG9hZD1cIm5vbmVcIiBwb3N0ZXI9XCIvaW1hZ2VzL0hlYWRwaG9uZXMxMjh4MTI4LnBuZ1wiPjxzb3VyY2Ugc3JjPVwiPCU9IG1lZGlhdXJsICU+PCUgaWYoUGxheWluZ0F0KXsgJT4jdD08JT0gUGxheWluZ0F0ICU+LDwlPSBQbGF5aW5nVW50aWwgJT48JSB9ICU+XCIgdHlwZT1cImF1ZGlvL21wM1wiPjwvdmlkZW8+PG5hdj48YnV0dG9uIGNsYXNzID1cIlBsYXlcIiBkYXRhLXN0YXJ0PVwiPCU9IFBsYXlpbmdBdCAlPlwiIGRhdGEtZW5kPVwiPCU9IFBsYXlpbmdVbnRpbCAlPlwiPiZuYnNwOyA8L2J1dHRvbj48c3BhbiBjbGFzcz1cIkR1cmF0aW9uXCI+PC9zcGFuPjwvbmF2PjwvZGl2PjwlIH0gJT48JT0gdGV4dHNvdXJjZSAlPjwlPSB3ZWJmaWxlICU+PGRpdj48aT48JT0gYXV0aG9yICU+PC9pPjxici8+PCUgaWYobWFzc21lZGlhKSB7ICU+PGEgaHJlZj1cIjwlPSB1cmxf0LjRgdGC0L7Rh9C90LjQutCwICU+XCIgdGFyZ2V0PVwiX2JsYW5rXCI+PCU9IG1hc3NtZWRpYSAlPiZuYnNwOyAmcmFxdW87IDwvYT48YnIvPjwlIH0gJT48L2Rpdj4nLFxuXG4gICAgLy8gICAgdGVtcGxhdGUgPSAnPHAgY2xhc3M9XCJidXR0b25zXCI+PGJ1dHRvbiBpZD1cInNob3dPcmlnaW5hbERvY1wiIGNsYXNzPVwib3JpZ2luYWxsaW5rXCIgZGF0YS1pZD1cIjBDQTY1MEYyLThEODUtNEM3Ni04QjAyLUY0MDgwRjc1QjlERVwiPjwlPSBSZXNvdXJjZXMub3JpZ2luYWxkb2MgJT48L2J1dHRvbj4mbmJzcDsmbmJzcDsnK1xuICAgIC8vICAgICc8YnV0dG9uIGlkPVwidHJhbnNsYXRlXCIgY2xhc3M9XCJ0cmFuc1wiIGRhdGEtaWQ9XCI1Qzk0OTc0MS05QjcyLTQwRUEtQUFBNi02RkQ0NDE5QzZFODZcIj48JT0gUmVzb3VyY2VzLnRyYW5zbGF0ZSAlPjwvYnV0dG9uPiZuYnNwOyZuYnNwOycrXG4gICAgLy8gICAgJzxidXR0b24gaWQ9XCJ0b09yaWdpbmFsXCIgY2xhc3M9XCJ0cmFuc1wiIGRhdGEtaWQ9XCI1Qzk0OTc0MS05QjcyLTQwRUEtQUFBNi02RkQ0NDE5QzZFODZcIj48JT0gUmVzb3VyY2VzLnJldHVyblRleHQgJT48L2J1dHRvbj4mbmJzcDsmbmJzcDsnK1xuICAgIC8vICAgICc8YnV0dG9uIGlkPVwic2hvcnRUZXh0XCIgZGF0YS1pZD1cIjczRkNCOTFGLTJFOTktNEJGNy04NTdGLUYzRUI1OTYxMEFGRVwiPjwlPSBSZXNvdXJjZXMudmlldyAlPjwvYnV0dG9uPiZuYnNwOyZuYnNwOycrXG4gICAgLy8gICAgJzxidXR0b24gY2xhc3M9XCJzaG93U25cIiBkYXRhLWlkPVwiNEUzOEUxRjQtMzhENS00MEI1LUFBQUQtQ0NFNTgyNTEwMEFEXCI+PCU9IFJlc291cmNlcy5zaG93U05ldCAlPjwvYnV0dG9uPiZuYnNwOyZuYnNwOycrXG4gICAgLy8gICAgJzxzcGFuIGNsYXNzPVwibW9kVmlldyByaWdodFwiPjxpPjwlPSBSZXNvdXJjZXMudGl0bGVWaWV3ICU+OiA8YiBpZD1cInRpdGxlTW9kVmlld1wiPjwlPSBSZXNvdXJjZXMuc2hvcnRWaWV3ICU+PC9iPjwvaT48L3NwYW4+PC9wPic7XG5cbiAgICAvL3ZhciBEeW5hbW8gPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cbiAgICAvLyAgICBldmVudHM6IHtcbiAgICAvLyAgICAgICAgXCJjbGljayBidXR0b25cIjogXCJjbWRcIlxuICAgIC8vICAgIH0sXG5cbiAgICAvLyAgICBjbWQ6IGZ1bmN0aW9uIChlKSB7XG5cbiAgICAvLyAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIC8vICAgICAgICB2YXIgJGIgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KFwiYnV0dG9uXCIpO1xuXG4gICAgLy8gICAgICAgIGlmICgkLnRyaW0oJGIuZGF0YShcImhyZWZcIikpKSB7XG5cbiAgICAvLyAgICAgICAgICAgIHZhciByID0geyB1cmw6ICRiLmRhdGEoXCJocmVmXCIpLCBkYXRhOiB7IH0sIG1ldGhvZDogJGIuZGF0YShcInZlcmJcIikgfTtcblxuICAgIC8vICAgICAgICAgICAgaWYgKCRiLmRhdGEoXCJuYW1lXCIpID09PSBcInNob3J0VGV4dFwiKVxuICAgIC8vICAgICAgICAgICAgICAgIHRoaXMucGFyZW50LmlzTW9kZSA9ICF0aGlzLnBhcmVudC5pc01vZGU7XG5cbiAgICAvLyAgICAgICAgICAgIHRoaXMucGFyZW50LnNlbmRSZXF1ZXN0KHIsIHRoaXMucGFyZW50LnByZXBhcmUsIHRoaXMucGFyZW50KTtcblxuICAgIC8vICAgICAgICB9IGVsc2UgXG4gICAgLy8gICAgICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKCdjb250ZW50OicrJGIuZGF0YShcInJlbmRlclwiKSwgdGhpcy5wYXJlbnQuZGF0YSA/IG5ldyBDb250ZW50TW9kZWwodGhpcy5wYXJlbnQuZGF0YSkgOiB0aGlzLnBhcmVudC5tb2RlbCk7XG4gICAgLy8gICAgfSxcblxuICAgIC8vICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKG8pIHtcbiAgICAvLyAgICAgICAgdGhpcy5wYXJlbnQgPSBvLnBhcmVudDtcbiAgICAvLyAgICB9LFxuXG4gICAgLy8gICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyAgICAgICAgdGhpcy4kZWwuaHRtbChfLnRlbXBsYXRlKHRlbXBsYXRlKSh7IFJlc291cmNlczogUmVzb3VyY2VzIH0pKTtcblxuICAgIC8vICAgICAgICB0aGlzLiQoXCIjdGl0bGVNb2RWaWV3XCIpLnRleHQodGhpcy5wYXJlbnQuaXNNb2RlID8gUmVzb3VyY2VzLmZ1bGxWaWV3IDogUmVzb3VyY2VzLnNob3J0Vmlldyk7XG5cbiAgICAvLyAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24gKGxpbmspIHtcbiAgICAvLyAgICAgICAgICAgIGlmIChsaW5rLmdldChcInJlbFwiKSA9PT0gXCJ0b29sc1wiKSB0aGlzLmFkZEJ0bihsaW5rLnRvSlNPTigpKTtcbiAgICAvLyAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAvLyAgICAgICAgLy90aGlzLiQoXCJidXR0b25cIikuYnV0dG9uKCk7XG5cbiAgICAvLyAgICAgICAgdGhpcy4kKFwiLmJ1dHRvbnNcIikuc2hvdygpO1xuXG4gICAgLy8gICAgICAgIHJldHVybiB0aGlzO1xuICAgIC8vICAgIH0sXG5cbiAgICAvLyAgICBhZGRCdG46IGZ1bmN0aW9uKGxpbmspIHtcbiAgICAvLyAgICAgICAgdmFyICRiID0gdGhpcy4kKCcjJytsaW5rLmlkKTtcbiAgICAvLyAgICAgICAgaWYgKCFBcHAuY2hlY2soJGIpKVxuICAgIC8vICAgICAgICAgICAgJGIuaGlkZSgpO1xuICAgIC8vICAgICAgICBlbHNlIHtcbiAgICAvLyAgICAgICAgICAgIF8uZWFjaChsaW5rLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgLy8gICAgICAgICAgICAgICAgc3dpdGNoKGtleSkge1xuICAgIC8vICAgICAgICAgICAgICAgICAgICBjYXNlIFwiaWRcIjpcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICRiLmF0dHIoXCJkYXRhLW5hbWVcIiwgdmFsdWUpO1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBcInNob3J0VGV4dFwiKSB0aGlzLiQoXCIubW9kVmlld1wiKS5zaG93KCk7XG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgY2FzZSBcInByb21wdFwiOlxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgJGIuYXR0cihcInRpdGxlXCIsIHZhbHVlKTtcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICRiLmJ1dHRvbih7IGxhYmVsOiB2YWx1ZSB9KTtcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgIC8vICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiAkYi5hdHRyKCdkYXRhLScra2V5LCB2YWx1ZSk7XG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAvLyAgICAgICAgICAgICAgICB9XG4gICAgLy8gICAgICAgICAgICB9LHRoaXMpO1xuICAgIC8vICAgICAgICAgICAgJGIuc2hvdygpO1xuICAgIC8vICAgICAgICB9XG4gICAgLy8gICAgfSxcbiAgICAvL30pO1xuXG4gICAgLy92YXIgSXRlbSA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblxuICAgIC8vICAgIGV2ZW50czoge1xuICAgIC8vICAgICAgICBcImNsaWNrIC5nb3RvcmVzdWx0IC51cFwiOiBcInRvcmVzdWx0XCIsXG4gICAgLy8gICAgICAgIFwiY2xpY2sgLmdvdG9yZXN1bHQgLmRvd25cIjogXCJ0b3Jlc3VsdFwiXG4gICAgLy8gICAgfSxcblxuICAgIC8vICAgIHRvcmVzdWx0OiBmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyAgICAgICAgdmFyIHBkID0gdGhpcy5wZDtcbiAgICAvLyAgICAgICAgaWYgKHBkLmxlbmd0aCAmJiB0aGlzLnNwICE9PSBwZC5sZW5ndGgpIHtcblxuICAgIC8vICAgICAgICAgICAgdGhpcy4kKFwiLkxvYWRcIikubUN1c3RvbVNjcm9sbGJhcihcInNjcm9sbFRvXCIsIHBkW3RoaXMuc3BdIC0gdGhpcy4kKFwiLkxvYWRcIikucG9zaXRpb24oKS50b3AgLSAzKTtcblxuICAgIC8vICAgICAgICAgICAgdGhpcy4kKFwiLkxvYWRcIikuZmluZChcInNwYW5bZGF0YS1va25kPTJdLkNcIikucmVtb3ZlQ2xhc3MoXCJDXCIpO1xuICAgIC8vICAgICAgICAgICAgdGhpcy4kKFwiLkxvYWRcIikuZmluZChcInNwYW5bZGF0YS1va25kPTJdXCIpLmVxKHRoaXMuc3ApLmFkZENsYXNzKFwiQ1wiKTtcblxuICAgIC8vICAgICAgICAgICAgaWYgKHRoaXMuc3AgPT09IHBkLmxlbmd0aCAtIDEpIHRoaXMuc3AgPSAwO1xuICAgIC8vICAgICAgICAgICAgZWxzZSB0aGlzLnNwKys7XG5cbiAgICAvLyAgICAgICAgfSBlbHNlIHtcbiAgICAvLyAgICAgICAgICAgIHRoaXMuc3AgPSAwO1xuICAgIC8vICAgICAgICAgICAgdGhpcy4kKFwiZGl2LkxvYWRcIikubUN1c3RvbVNjcm9sbGJhcihcInNjcm9sbFRvXCIsIDApO1xuICAgIC8vICAgICAgICB9XG4gICAgLy8gICAgICAgIHRoaXMuJChcIi5nb3RvcmVzdWx0IC50b3RhbFwiKS5odG1sKFJlc291cmNlcy5Ub3RhbCArIFwiJm5ic3A7XCIgKyBSZXNvdXJjZXMubWF0Y2hlcyArIFwiOiZuYnNwO1wiICsgcGQubGVuZ3RoKTtcbiAgICAvLyAgICAgICAgaWYgKHBkLmxlbmd0aClcbiAgICAvLyAgICAgICAgICAgIHRoaXMuJChcIi5nb3RvcmVzdWx0XCIpLnNob3coKTtcbiAgICAvLyAgICAgICAgZWxzZVxuICAgIC8vICAgICAgICAgICAgdGhpcy4kKFwiLmdvdG9yZXN1bHRcIikuaGlkZSgpO1xuICAgIC8vICAgIH0sXG5cbiAgICAvLyAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAobykge1xuICAgIC8vICAgICAgICB0aGlzLm9wdGlvbnMgPSBvO1xuICAgIC8vICAgICAgICB0aGlzLnBkID0gW107XG4gICAgLy8gICAgICAgIHRoaXMuc3AgPSAwO1xuICAgIC8vICAgICAgICB0aGlzLmlzTW9kZSA9IGZhbHNlO1xuXG4gICAgLy8gICAgICAgIHRoaXMubW9kZWwuc2V0KFwiUGxheWluZ0F0XCIsdGhpcy5tb2RlbC5nZXQoXCJQbGF5aW5nQXRcIikgfHwgMCk7XG4gICAgLy8gICAgICAgIHRoaXMubW9kZWwuc2V0KFwiUGxheWluZ1VudGlsXCIsIHRoaXMubW9kZWwuZ2V0KFwiUGxheWluZ1VudGlsXCIpIHx8IDApO1xuICAgIC8vICAgIH0sXG5cbiAgICAvLyAgICBzZW5kUmVxdWVzdDogZnVuY3Rpb24gKG8sIGNhbGxiYWNrLCBjdHgpIHtcbiAgICAvLyAgICAgICAgJC5hamF4KG8pLmRvbmUoZnVuY3Rpb24gKGl0ZW0pIHsgY2FsbGJhY2suY2FsbChjdHgsIGl0ZW0pIH0pO1xuICAgIC8vICAgIH0sXG5cbiAgICAvLyAgICBwcmVwYXJlOiBmdW5jdGlvbiAoaXRlbSkge1xuXG4gICAgLy8gICAgICAgIHZhciBsaW5rcyA9IGl0ZW0ubGlua3M7XG4gICAgLy8gICAgICAgIGlmIChcIml0ZW1zXCIgaW4gaXRlbSkge1xuICAgIC8vICAgICAgICAgICAgdGhpcy5kYXRhID0gQXBwLnByZXBhcmUoaXRlbS5pdGVtcylbMF07XG4gICAgLy8gICAgICAgICAgICBsaW5rcyA9IGl0ZW0uaXRlbXNbMF0ubGlua3M7XG4gICAgLy8gICAgICAgIH0gZWxzZVxuICAgIC8vICAgICAgICAgICAgdGhpcy5kYXRhID0gQXBwLnByZXBhcmUoW2l0ZW1dKVswXTtcblxuICAgIC8vICAgICAgICB0aGlzLmluaXRUb29scyhuZXcgQmFja2JvbmUuQ29sbGVjdGlvbihsaW5rcykpO1xuXG4gICAgLy8gICAgICAgIHRoaXMuZGF0YS5QbGF5aW5nQXQgPSB0aGlzLmRhdGEuUGxheWluZ0F0IHx8IDA7XG4gICAgLy8gICAgICAgIHRoaXMuZGF0YS5QbGF5aW5nVW50aWwgPSB0aGlzLmRhdGEuUGxheWluZ1VudGlsIHx8IDA7XG5cblxuICAgIC8vICAgICAgICAvLyBiYXNpYyBzZXR0aW5ncyBzZWxlY3QgVGV4dFNvdXJjZSBvciBXZWJGaWxlXG4gICAgLy8gICAgICAgIHZhciBmaWVsZCA9IHRoaXMub3B0aW9ucy5wYXJlbnQud2lkZ2V0LmdldCgnY29udGVudFByb3AnKTtcblxuICAgIC8vICAgICAgICBpZiAoIXRoaXMubW9kZWwuaGFzKCd0ZXh0c291cmNlJykpXG4gICAgLy8gICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgndGV4dHNvdXJjZScsICcnKTtcblxuICAgIC8vICAgICAgICBpZiAoIXRoaXMubW9kZWwuaGFzKCd3ZWJmaWxlJykpXG4gICAgLy8gICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgnd2ViZmlsZScsICcnKTtcblxuICAgIC8vICAgICAgICB0aGlzLiQoXCIuTG9hZFwiKS5odG1sKF8udGVtcGxhdGUobWVkaWFUZW1wbGF0ZSkodGhpcy5kYXRhKSk7XG4gICAgLy8gICAgICAgIHRoaXMubG9hZGVkKCkuZml0TG9hZCgpLnRvcmVzdWx0KCk7XG4gICAgLy8gICAgfSxcblxuICAgIC8vICAgIGZpdEhlaWdodDogZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICAgICB2YXIgaCA9IHRoaXMuJGVsLnBhcmVudCgpLnBhcmVudCgpLmhlaWdodCgpIC0gdGhpcy4kZWwucGFyZW50KCkuZmluZChcImgzXCIpLm91dGVySGVpZ2h0KCksIC8vIGFjY29yZGlvbiAtIHBhcmVudFxuICAgIC8vICAgICAgICAgICAgZGggPSAwO1xuICAgIC8vICAgICAgICB0aGlzLiRlbC5jaGlsZHJlbihcIjpub3QoJy5Mb2FkJylcIikuZWFjaChmdW5jdGlvbihpLCBlKSB7aWYgKCQoZSkuaXMoXCI6dmlzaWJsZVwiKSkgZGggKz0gcGFyc2VJbnQoJChlKS5vdXRlckhlaWdodCgpKTt9KTtcbiAgICAvLyAgICAgICAgaWYgKGgpIHRoaXMuJChcIi5Mb2FkXCIpLmhlaWdodChoIC0gZGgpO1xuICAgIC8vICAgIH0sXG5cbiAgICAvLyAgICBpbml0VG9vbHM6ZnVuY3Rpb24oY29sKSB7XG4gICAgLy8gICAgICAgIGlmICh0aGlzLlRvb2xzKSB7XG4gICAgLy8gICAgICAgICAgICB0aGlzLlRvb2xzLnJlbW92ZSgpO1xuICAgIC8vICAgICAgICAgICAgaWYgKCF0aGlzLiQoXCIuVG9vbHNcIikuZ2V0KDApKVxuICAgIC8vICAgICAgICAgICAgICAgIHRoaXMuJGVsLnByZXBlbmQoJzxkaXYgY2xhc3M9XCJUb29sc1wiPjwvZGl2PicpO1xuICAgIC8vICAgICAgICB9XG4gICAgLy8gICAgICAgIHRoaXMuVG9vbHMgPSBuZXcgRHluYW1vKHsgY29sbGVjdGlvbjogY29sLCBwYXJlbnQ6IHRoaXMsIGVsOiB0aGlzLiQoXCIuVG9vbHNcIikgfSkucmVuZGVyKCk7XG4gICAgLy8gICAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5Ub29scywgXCJidXR0b246Y2xpY2tcIiwgdGhpcy5wcmVwYXJlKTtcbiAgICAvLyAgICB9LFxuXG4gICAgLy8gICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyAgICAgICAgdmFyIGxpbmtzID0gdGhpcy5tb2RlbC5nZXQoXCJsaW5rc1wiKSxcbiAgICAvLyAgICAgICAgICAgIGZsYWcgPSBfLmZpbmQobGlua3MsIGZ1bmN0aW9uIChsKSB7IHJldHVybiBsLnJlbCA9PT0gXCJzeXNcIiAmJiBsLmlkID09PSBcIk1vZGVcIiAmJiBsLnZhbHVlID09PSBcIjlcIiB9KTtcblxuICAgIC8vICAgICAgICB0aGlzLiRlbC5odG1sKF8udGVtcGxhdGUoY29udGVudFRlbXBsYXRlKSggeyBSZXNvdXJjZXM6IFJlc291cmNlcyB9KSk7XG5cbiAgICAvLyAgICAgICAgaWYgKCFmbGFnKSB7XG5cbiAgICAvLyAgICAgICAgICAgIHRoaXMuaW5pdFRvb2xzKG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKGxpbmtzKSk7XG5cbiAgICAvLyAgICAgICAgICAgIC8vIGJhc2ljIHNldHRpbmdzIHNlbGVjdCBUZXh0U291cmNlIG9yIFdlYkZpbGVcbiAgICAvLyAgICAgICAgICAgIHZhciBmaWVsZCA9IHRoaXMub3B0aW9ucy5wYXJlbnQud2lkZ2V0LmdldCgnY29udGVudFByb3AnKTtcblxuICAgIC8vICAgICAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmhhcygndGV4dHNvdXJjZScpKVxuICAgIC8vICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCd0ZXh0c291cmNlJywgJycpO1xuXG4gICAgLy8gICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuaGFzKCd3ZWJmaWxlJykpXG4gICAgLy8gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ3dlYmZpbGUnLCAnJyk7XG5cbiAgICAvLyAgICAgICAgICAgIHRoaXMuJChcIi5Mb2FkXCIpLmh0bWwoXy50ZW1wbGF0ZShtZWRpYVRlbXBsYXRlKSh0aGlzLm1vZGVsLnRvSlNPTigpKSk7XG5cbiAgICAvLyAgICAgICAgICAgIC8vdGhpcy4kKFwiYnV0dG9uLnVwXCIpLmJ1dHRvbih7IGxhYmVsOiBSZXNvdXJjZXMuZ28sIGljb25zOiB7IHByaW1hcnk6IFwidWktaWNvbi1zZWVrLW5leHRcIiB9LCB0ZXh0OiBmYWxzZSB9KTtcblxuICAgIC8vICAgICAgICAgICAgdGhpcy5saW5rVG9SdWJyaWNzKCk7XG5cbiAgICAvLyAgICAgICAgfSBlbHNlXG4gICAgLy8gICAgICAgICAgICB0aGlzLiQoXCIuTG9hZFwiKS5odG1sKFJlc291cmNlcy5saW1pdCk7XG5cbiAgICAvLyAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgLy8gICAgfSxcblxuICAgIC8vICAgIGZpdExvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgICAgdGhpcy4kKFwiLkxvYWRcIikubUN1c3RvbVNjcm9sbGJhcihcInNjcm9sbFRvXCIsIDApOy8vLnNjcm9sbFRvcCgwKTtcbiAgICAvLyAgICAgICAgdGhpcy5wZCA9IFtdO1xuICAgIC8vICAgICAgICB2YXIgcyA9IHRoaXM7XG4gICAgLy8gICAgICAgIHRoaXMuJChcIi5Mb2FkXCIpLmZpbmQoXCJzcGFuW2RhdGEtb2tuZD0yXVwiKS5lYWNoKGZ1bmN0aW9uKGksIGUpe1xuICAgIC8vICAgICAgICAgICAgJChlKS5hZGRDbGFzcyhcIk1hcmtcIik7XG4gICAgLy8gICAgICAgICAgICBzLnBkLnB1c2goJChlKS5wb3NpdGlvbigpLnRvcCk7XG4gICAgLy8gICAgICAgIH0pO1xuICAgIC8vICAgICAgICByZXR1cm4gdGhpcztcbiAgICAvLyAgICB9LFxuXG4gICAgLy8gICAgbG9hZGVkOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyAgICAgICAgdmFyICRzID0gdGhpcy4kZWwsXG4gICAgLy8gICAgICAgICAgICBuYW1lID0gJyN2aWRlb0ZhY3QnICsgdGhpcy5tb2RlbC5nZXQoXCJvYmplY3RfaWRcIik7XG5cbiAgICAvLyAgICAgICAgaWYgKHRoaXMuJChuYW1lKS5nZXQoMCkpIHtcbiAgICAvLyAgICAgICAgICAgIHZhciBzID0gdGhpcztcbiAgICAvLyAgICAgICAgICAgIHRoaXMuJChcImJ1dHRvbi5QbGF5XCIpXG4gICAgLy8gICAgICAgICAgICAgICAgLmJ1dHRvbih7IHRleHQ6IGZhbHNlLCBpY29uczogeyBwcmltYXJ5OiBcInVpLWljb24tcGxheVwiIH0gfSlcbiAgICAvLyAgICAgICAgICAgICAgICAuY2xpY2soZnVuY3Rpb24gKCkgeyBzLnBsYXkoKSB9KTtcblxuICAgIC8vICAgICAgICAgICAgdmFyIHAgPSB2aWRlb2pzKHRoaXMuJChuYW1lKS5nZXQoMCkpLFxuICAgIC8vICAgICAgICAgICAgICAgIHZpZGVvV2lkdGggPSAwLFxuICAgIC8vICAgICAgICAgICAgICAgIHZpZGVvSGVpZ2h0ID0gMCxcbiAgICAvLyAgICAgICAgICAgICAgICAkYyA9IHRoaXMuJChcIi5Mb2FkXCIpLFxuICAgIC8vICAgICAgICAgICAgICAgICR2ID0gdGhpcy4kKG5hbWUpO1xuXG4gICAgLy8gICAgICAgICAgICAvL3Aud2lkdGgodGhpcy4kKFwiLkxvYWRcIikud2lkdGgoKSAtIDkwLCB0cnVlKTtcbiAgICAvLyAgICAgICAgICAgIGlmICgkdi5oYXNDbGFzcyhcIkF1ZGlvc291cmNlXCIpKVxuICAgIC8vICAgICAgICAgICAgICAgIHAuaGVpZ2h0KDEyOCwgdHJ1ZSk7XG4gICAgLy8gICAgICAgICAgICBlbHNlXG4gICAgLy8gICAgICAgICAgICAgICAgcC5oZWlnaHQoKHRoaXMuJChcIi5Mb2FkXCIpLndpZHRoKCkgLSA4MCkgLyAzLCB0cnVlKTtcblxuICAgIC8vICAgICAgICAgICAgcC5vbihcImxvYWRlZGRhdGFcIiwgZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICAgICAgICAgICAgIHZpZGVvV2lkdGggPSB0aGlzLkwudmlkZW9XaWR0aDtcbiAgICAvLyAgICAgICAgICAgICAgICB2aWRlb0hlaWdodCA9IHRoaXMuTC52aWRlb0hlaWdodDtcbiAgICAvLyAgICAgICAgICAgICAgICBpZiAoISR2Lmhhc0NsYXNzKFwiQXVkaW9zb3VyY2VcIikpIHtcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgaWYgKCRzLndpZHRoKCkgPCB2aWRlb1dpZHRoKSB7XG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHZpZGVvV2lkdGggLyB2aWRlb0hlaWdodDtcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvV2lkdGggPSAkcy53aWR0aCgpIC0gMzA7XG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICB2aWRlb0hlaWdodCA9IHZpZGVvV2lkdGggLyBkO1xuICAgIC8vICAgICAgICAgICAgICAgICAgICB9XG4gICAgLy8gICAgICAgICAgICAgICAgICAgICRjLmNzcyh7IHdpZHRoOiB2aWRlb1dpZHRoICsgMjAsIGhlaWdodDogdmlkZW9IZWlnaHQgKyA1MCB9KTtcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgdGhpcy53aWR0aCh2aWRlb1dpZHRoLCB0cnVlKTtcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQodmlkZW9IZWlnaHQsIHRydWUpO1xuICAgIC8vICAgICAgICAgICAgICAgIH1cbiAgICAvLyAgICAgICAgICAgIH0pO1xuICAgIC8vICAgICAgICB9XG4gICAgLy8gICAgICAgIHRoaXMuZml0SGVpZ2h0KCk7XG4gICAgLy8gICAgICAgIHRoaXMuJChcIi5Mb2FkXCIpLm1DdXN0b21TY3JvbGxiYXIoKTsvLyB7IHNjcm9sbGJhclBvc2l0aW9uOidvdXRzaWRlJ31cbiAgICAvLyAgICAgICAgdGhpcy4kKCcubUNTQl9jb250YWluZXInKS5hdHRyKCdkaXInLCAnYXV0bycpO1xuICAgIC8vICAgICAgICByZXR1cm4gdGhpcztcbiAgICAvLyAgICB9LFxuXG4gICAgLy8gICAgcGxheTogZnVuY3Rpb24gKGUpIHtcbiAgICAvLyAgICAgICAgdmFyICRlID0gdGhpcy4kKFwiYnV0dG9uLlBsYXlcIiksXG4gICAgLy8gICAgICAgICAgICBzdGFydCA9IHBhcnNlSW50KCRlLmRhdGEoXCJzdGFydFwiKSksXG4gICAgLy8gICAgICAgICAgICBlbmQgPSBwYXJzZUludCgkZS5kYXRhKFwiZW5kXCIpKSxcbiAgICAvLyAgICAgICAgICAgIHAgPSB2aWRlb2pzKHRoaXMuJChcIiN2aWRlb0ZhY3RcIiArIHRoaXMubW9kZWwuZ2V0KFwib2JqZWN0X2lkXCIpKS5nZXQoMCkpO1xuXG4gICAgLy8gICAgICAgICRlLmJ1dHRvbigpLmJ1dHRvbihcIm9wdGlvblwiLCBcImljb25zXCIsIHsgcHJpbWFyeTogXCJ1aS1pY29uLXBhdXNlXCIgfSk7XG5cbiAgICAvLyAgICAgICAgcC5yZWFkeShmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyAgICAgICAgICAgIGlmICghZW5kIHx8IHRoaXMuY3VycmVudFRpbWUoKSA8IGVuZClcbiAgICAvLyAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXVzZWQoKSkge1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAkZS5idXR0b24oXCJvcHRpb25cIiwgXCJpY29uc1wiLCB7IHByaW1hcnk6IFwidWktaWNvbi1wYXVzZVwiIH0pO1xuICAgIC8vICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICAvLyAgICAgICAgICAgICAgICB9IGVsc2VcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xuICAgIC8vICAgICAgICAgICAgZWxzZSB7XG4gICAgLy8gICAgICAgICAgICAgICAgdGhpcy5sb2FkKCk7XG4gICAgLy8gICAgICAgICAgICAgICAgdGhpcy5wbGF5KCk7XG4gICAgLy8gICAgICAgICAgICB9XG4gICAgLy8gICAgICAgIH0pO1xuXG4gICAgLy8gICAgICAgIHAub24oXCJ3YWl0aW5nXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgICAgICAgICRlLmJ1dHRvbihcImRpc2FibGVcIik7XG4gICAgLy8gICAgICAgIH0pO1xuICAgIC8vICAgICAgICBwLm9uKFwibG9hZGVkZGF0YVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgICAgICAgICAkZS5idXR0b24oKS5idXR0b24oXCJlbmFibGVcIik7XG4gICAgLy8gICAgICAgIH0pO1xuICAgIC8vICAgICAgICBwLm9uKFwicGF1c2VcIiwgZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICAgICAgICAgJGUuYnV0dG9uKCkuYnV0dG9uKFwib3B0aW9uXCIsIFwiaWNvbnNcIiwgeyBwcmltYXJ5OiBcInVpLWljb24tcGxheVwiIH0pO1xuICAgIC8vICAgICAgICB9KTtcblxuICAgIC8vICAgICAgICBCYWNrYm9uZS50cmlnZ2VyKFwic3RvcmFnZTphZGRQbGF5ZXJcIiwgcCwgdGhpcy5tb2RlbC5nZXQoXCJvYmplY3RfaWRcIikpO1xuICAgIC8vICAgIH0sXG5cbiAgICAvLyAgICBsaW5rVG9SdWJyaWNzOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgICAgIHZhciBkYXRhID0gdGhpcy5tb2RlbC5nZXQoXCJjb250ZW50Y29sbGVjdGlvbl9ydWJyaWNzXCIpO1xuICAgIC8vICAgICAgICBpZiAoJC50cmltKGRhdGEpKVxuICAgIC8vICAgICAgICAgICAgdGhpcy4kKFwiLlJ1YnJpY3NMaW5rXCIpLmFwcGVuZCgnPGk+JyArIFJlc291cmNlcy5saW5rVG9SdWJyaWNUaXRsZSArICc6PC9pPiZuYnNwOyZuYnNwOzxiPicgKyBkYXRhICsgJzwvYj4nKTtcbiAgICAvLyAgICB9XG4gICAgLy99KTtcblxuXG4gICAgLy8gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgLy8gICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoICc8ZGl2PjwvZGl2PicgKSxcblxuICAgIC8vICAgIHJlZ2lvbnM6IHtcbiAgICAvLyAgICAgICAgYWNjb3JkaW9uOiB7IGVsOiAnZGl2JywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgIC8vICAgIH0sXG5cblxuICAgIC8vICAgIG9uUmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCAnYWNjb3JkaW9uJywgbmV3IGxpc3RJdGVtcyggeyBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24gfSkgKTsgICAgICAgICAgICBcblxuICAgIC8vICAgICAgICAvL3RoaXMuc2VhcmNoUGhyYXNlID0gQXBwLlNlbGVjdC5nZXQoXCJwYXJhbXNcIikgPyBBcHAuU2VsZWN0LmdldChcInBhcmFtc1wiKS5waHJhc2UgOiBcIlwiO1xuICAgIC8vICAgICAgICAvL3RoaXMuc2VuZFJlcXVlc3Qoe1xuICAgIC8vICAgICAgICAvLyAgICB1cmw6IHRoaXMub3B0aW9ucy51cmwgfHwgJy9hcGkvZGV0YWlscy9Db250ZW50VjIvJyArIHRoaXMub3B0aW9ucy5vYmplY3RJRCxcbiAgICAvLyAgICAgICAgLy8gICAgZGF0YTogdGhpcy5vcHRpb25zLmRhdGEgfHwgKHRoaXMuc2VhcmNoUGhyYXNlID8gJC5wYXJhbSh7IFwiaGlnaGxpZ2h0UGhyYXNlXCI6IHRoaXMuc2VhcmNoUGhyYXNlIH0pIDogW10pXG4gICAgLy8gICAgICAgIC8vfSwgdGhpcy5wcmVwYXJlLCB0aGlzKTtcblxuICAgIC8vICAgIH0sXG5cbiAgICAvLyAgICBvbkF0dGFjaDogZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICAgICB0aGlzLmNvbGxlY3Rpb24uZmV0Y2goIHsgcmVzZXQ6IHRydWUgfSk7XG4gICAgLy8gICAgfSxcblxuXG4gICAgLy8gICAgZml0U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICAgICAvL18uZWFjaCh0aGlzLml0ZW1zLCBmdW5jdGlvbiAocykgeyBzLmZpdEhlaWdodCgpIH0pO1xuICAgIC8vICAgICAgICAvL3JldHVybiB0aGlzO1xuICAgIC8vICAgIH1cblxuICAgIC8vICAgIC8vc2VuZFJlcXVlc3Q6IGZ1bmN0aW9uIChvLCBjYWxsYmFjaywgY3R4KSB7XG5cbiAgICAvLyAgICAvLyAgICB0aGlzLiRlbC5zaG93SW5kaWNhdG9yKCk7XG5cbiAgICAvLyAgICAvLyAgICAkLmFqYXgoIG8gKVxuXG4gICAgLy8gICAgLy8gICAgICAgIC5kb25lKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgLy8gICAgLy8gICAgICAgICAgICBjYWxsYmFjay5jYWxsKGN0eCwgaXRlbSk7XG4gICAgLy8gICAgLy8gICAgICAgIH0pXG5cbiAgICAvLyAgICAvLyAgICAgICAgLmFsd2F5cyhmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgLy8gICAgICAgICAgICB0aGlzLiRlbC5oaWRlSW5kaWNhdG9yKCk7XG5cbiAgICAvLyAgICAvLyAgICAgICAgICAgIGlmICh0aGlzLmNhbGxiYWNrKVxuICAgIC8vICAgIC8vICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2suY2FsbCggdGhpcy5jb250ZXh0LCB0aGlzICk7XG5cbiAgICAvLyAgICAvLyAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAvLyAgICAvL30sXG5cbiAgICAvLyAgICAvL3ByZXBhcmU6IGZ1bmN0aW9uIChpdGVtKSB7XG5cbiAgICAvLyAgICAvLyAgICB0aGlzLiRlbC5hcHBlbmQoXCI8ZGl2IGlkPSdhY2NvcmRpb24nPjwvZGl2PlwiKTtcblxuICAgIC8vICAgIC8vICAgIGlmIChcInZlcnNpb25cIiBpbiBpdGVtKSB7XG5cbiAgICAvLyAgICAvLyAgICAgICAgXy5lYWNoKGl0ZW0uaXRlbXMsIHRoaXMuYWRkT25lLCB0aGlzKTtcblxuICAgIC8vICAgIC8vICAgICAgICBpZiAoIGl0ZW0uaXRlbXMubGVuZ3RoID4gMSApIHtcblxuICAgIC8vICAgIC8vICAgICAgICAgICAgdGhpcy4kKFwiI2FjY29yZGlvblwiKS5hY2NvcmRpb24oe1xuICAgIC8vICAgIC8vICAgICAgICAgICAgICAgIGhlaWdodFN0eWxlOiBcImNvbnRlbnRcIixcbiAgICAvLyAgICAvLyAgICAgICAgICAgICAgICBjb2xsYXBzaWJsZTogdHJ1ZSxcbiAgICAvLyAgICAvLyAgICAgICAgICAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24gKCkge1xuICAgIC8vICAgIC8vICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoIFwiYWN0aW9uXCIgKTtcbiAgICAvLyAgICAvLyAgICAgICAgICAgICAgICB9XG4gICAgLy8gICAgLy8gICAgICAgICAgICB9KTtcblxuICAgIC8vICAgIC8vICAgICAgICB9XG4gICAgLy8gICAgLy8gICAgfSBlbHNlIFxuICAgIC8vICAgIC8vICAgICAgICB0aGlzLmFkZE9uZShpdGVtKTtcblxuICAgIC8vICAgIC8vICAgIGlmICh0aGlzLmNhbGxiYWNrKVxuICAgIC8vICAgIC8vICAgICAgICB0aGlzLmNhbGxiYWNrLmNhbGwodGhpcy5jb250ZXh0LCB0aGlzKTtcbiAgICAvLyAgICAvL30sXG5cbiAgICAvLyAgICAvL2FkZE9uZTogZnVuY3Rpb24gKGl0ZW0pIHtcblxuICAgIC8vICAgIC8vICAgIHZhciBtID0gbmV3IEJhY2tib25lLk1vZGVsKEFwcC5wcmVwYXJlKFtpdGVtXSlbMF0pO1xuXG4gICAgLy8gICAgLy8gICAgbS5zZXQoXCJsaW5rc1wiLCBpdGVtLmxpbmtzKTtcblxuICAgIC8vICAgIC8vICAgIHZhciBzID0gbmV3IEl0ZW0oeyBtb2RlbDogbSwgcGFyZW50OiB0aGlzIH0pLnJlbmRlcigpO1xuXG4gICAgLy8gICAgLy8gICAgaWYgKCEodGhpcy53aWRnZXQuaGFzKCdoaWRlVGl0bGUnKSAmJiB0aGlzLndpZGdldC5nZXQoJ2hpZGVUaXRsZScpKSlcbiAgICAvLyAgICAvLyAgICAgICAgdGhpcy4kKFwiI2FjY29yZGlvblwiKS5hcHBlbmQoJzxoMz4nICsgbS5nZXQoXCJkaXNwbGF5X25hbWVcIikgfHwgXCJcIiArICc8L2gzPicpO1xuXG4gICAgLy8gICAgLy8gICAgdGhpcy4kKFwiI2FjY29yZGlvblwiKS5hcHBlbmQocy4kZWwpO1xuXG4gICAgLy8gICAgLy8gICAgcy5sb2FkZWQoKS5maXRMb2FkKCkudG9yZXN1bHQoKTtcbiAgICAvLyAgICAvLyAgICB0aGlzLml0ZW1zLnB1c2gocyk7XG4gICAgLy8gICAgLy99LFxuXG5cbiAgICAvL30pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ01hc3RlckNyZWF0ZVZpZXcnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnc2V0dGluZ3Muc3Vic2NyaWJlTGlzdCcsICdyZXF1ZXN0VmlldycsICdzZXR0aW5ncy52aXN1YWxpc2F0aW9uLmNoYXJ0LmNob2ljZScsICdnL2VqUlRFVmlldycsICdzZXR0aW5ncy5kZWNvcmF0aW9uV2lkZ2V0JywgJ3N5bmNmdXNpb24nXSwgZnVuY3Rpb24gKFJlc291cmNlcywgc3Vic2NyaWJlTGlzdCwgUmVxdWVzdHMsIHZpc3VhbFZpZXcsIEh0bWxFZGl0b3IsIGRlY29yYXRpb25WaWV3KSB7XG5cbiAgICB2YXIgTUlOX1NJWkUgPSA1MDtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6ICcjd2lkZ2V0LWNyZWF0ZS10ZW1wbGF0ZScsXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgbmV4dDogJyNuZXh0JyxcbiAgICAgICAgICAgIGJhY2s6ICcjYmFjaydcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICByZXFBcmVhOiAnLnJlcXVlc3RQYXJhbT5zZWN0aW9uJyxcbiAgICAgICAgICAgIHN1YnNjckFyZWE6ICcjU3Vic2NyaWJlJyxcbiAgICAgICAgICAgIGVkaXRvcjogXCIuaHRtbEVkaXRvclwiLFxuICAgICAgICAgICAgdmlzdWFsOiBcIi52aXN1YWxpemF0aW9uXCIsXG4gICAgICAgICAgICBkZWNvcmF0aW9uOiB7IGVsOiAnI2RlY29yYXRpb24nLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5wYW5lbHMgPSB7XG4gICAgICAgICAgICAgICAgXCJEZWZhdWx0XCI6IFtcIm9uZVwiLCBcInJlcXVlc3RQYXJhbVwiLCBcImRlY29yYXRpb25cIl0sXG4gICAgICAgICAgICAgICAgXCJXaWRnZXRHcmFwaFwiOiBbXCJvbmVcIiwgXCJyZXF1ZXN0UGFyYW1cIiwgXCJ2aXN1YWxpemF0aW9uXCIsIFwiZGVjb3JhdGlvblwiXSxcbiAgICAgICAgICAgICAgICBcIldpZGdldFNvdXJjZVwiOiBbXCJvbmVcIiwgXCJyZXF1ZXN0UGFyYW1cIiwgXCJkZWNvcmF0aW9uXCIsIFwic3Vic2NyaWJlXCJdLFxuICAgICAgICAgICAgICAgIFwiV2lkZ2V0U2VtTmV0XCI6IFtcIm9uZVwiLCBcInJlcXVlc3RQYXJhbVwiLCBcImRlY29yYXRpb25cIiwgXCJzdWJzY3JpYmVcIl0sXG4gICAgICAgICAgICAgICAgXCJXaWRnZXRSZXBvcnRpbmdcIjogW1wib25lXCIsIFwicmVxdWVzdFBhcmFtXCIsIFwiZGVjb3JhdGlvblwiLCBcInN1YnNjcmliZVwiXSxcbiAgICAgICAgICAgICAgICBcIldpZGdldEh0bWxcIjogW1wib25lXCIsIFwicmVxdWVzdFBhcmFtXCIsIFwiZGVjb3JhdGlvblwiLCBcImh0bWxFZGl0b3JcIl1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuc3RlcCA9IG5ldyBCYWNrYm9uZS5Nb2RlbCh7IHN0ZXA6IDAgfSk7XG4gICAgICAgICAgICB0aGlzLnN0ZXAub24oXCJjaGFuZ2U6c3RlcFwiLCB0aGlzLmNoZWNrU3RlcCwgdGhpcyk7XG5cbiAgICAgICAgICAgIHRoaXMucHVibGlzaGVycyA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuICAgICAgICAgICAgdGhpcy5zdGVwLnNldChcInN0ZXBcIiwgMSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgIFwia2V5dXAgI3RpdGxlV2lkZ2V0XCI6IFwiY2hlY2tUaXRsZVwiLFxuXG4gICAgICAgICAgICBcImJsdXIgI3RpdGxlV2lkZ2V0XCI6IFwiY2hlY2tUaXRsZVwiLFxuXG4gICAgICAgICAgICBcIm1vdXNlb3ZlciAudHlwZXMtd2lkZ2V0IHNwYW5cIjogZnVuY3Rpb24gbW91c2VvdmVyVHlwZXNXaWRnZXRTcGFuKGUpIHtcblxuICAgICAgICAgICAgICAgIHZhciBuYW1lID0gJChlLnRhcmdldCkuY2xvc2VzdChcInNwYW5cIikuYXR0cihcImlkXCIpLFxuICAgICAgICAgICAgICAgICAgICBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBcIldpZGdldFRhYmxlXCI6IFJlc291cmNlcy5XaWRnZXRUYWJsZSxcbiAgICAgICAgICAgICAgICAgICAgXCJXaWRnZXRSdW5uaW5nXCI6IFJlc291cmNlcy5XaWRnZXRSdW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBcIldpZGdldE1hcFwiOiBSZXNvdXJjZXMuV2lkZ2V0TWFwLFxuICAgICAgICAgICAgICAgICAgICBcIldpZGdldEdyYXBoXCI6IFJlc291cmNlcy5XaWRnZXRHcmFwaCxcbiAgICAgICAgICAgICAgICAgICAgXCJXaWRnZXRDbG91ZFwiOiBSZXNvdXJjZXMuV2lkZ2V0Q2xvdWQsXG4gICAgICAgICAgICAgICAgICAgIFwiV2lkZ2V0U291cmNlXCI6IFJlc291cmNlcy5XaWRnZXRTb3VyY2UsXG4gICAgICAgICAgICAgICAgICAgIFwiV2lkZ2V0UmVwb3J0aW5nXCI6IFJlc291cmNlcy5XaWRnZXRSZXBvcnRpbmcsXG4gICAgICAgICAgICAgICAgICAgIFwiV2lkZ2V0SHRtbFwiOiBSZXNvdXJjZXMuV2lkZ2V0SHRtbCxcbiAgICAgICAgICAgICAgICAgICAgXCJXaWRnZXRTZW1OZXRcIjogUmVzb3VyY2VzLldpZGdldFNlbU5ldFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGVwLmdldChcInN0ZXBcIikgPT09IDEpIHRoaXMuJChcIi5vbmU+LmRlc2NyaXB0aW9uXCIpLmh0bWwoZGF0YVtuYW1lXSkuZmFkZUluKCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBcIm1vdXNlbGVhdmUgLnR5cGVzLXdpZGdldCBzcGFuXCI6IGZ1bmN0aW9uIG1vdXNlbGVhdmVUeXBlc1dpZGdldFNwYW4oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kKFwiLm9uZT4uZGVzY3JpcHRpb25cIikuaGlkZSgpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgXCJjbGljayAudHlwZXMtd2lkZ2V0IHNwYW5cIjogZnVuY3Rpb24gY2xpY2tUeXBlc1dpZGdldFNwYW4oYSkge1xuXG4gICAgICAgICAgICAgICAgdmFyICRzID0gJChhLnRhcmdldCkuY2xvc2VzdChcInNwYW5cIik7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldChcInR5cGVOYW1lXCIsICRzLmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0luaXRSZXF1ZXN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBcImNsaWNrIEB1aS5iYWNrXCI6IGZ1bmN0aW9uIGNsaWNrVWlCYWNrKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSB0aGlzLnN0ZXAuZ2V0KFwic3RlcFwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdGVwID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBzdGVwLS07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RlcC5zZXQoXCJzdGVwXCIsIHN0ZXApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIFwiY2xpY2sgQHVpLm5leHRcIjogJ25leHQnLFxuXG4gICAgICAgICAgICBcImNsaWNrIG5hdj5kaXZcIjogZnVuY3Rpb24gY2xpY2tOYXZEaXYoZSkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy4kKFwibmF2PmRpdlwiKS50b2dnbGVDbGFzcyhcImFjXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuJChcIi50YWItY29udGVudFwiKS50b2dnbGVDbGFzcyhcInNob3dcIik7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBcImNsaWNrICNkZWNvci1jaGJ4IHNwYW4uZm9udC1pY29uLWNoZWNrYm94XCI6IGZ1bmN0aW9uIGNsaWNrRGVjb3JDaGJ4U3BhbkZvbnRJY29uQ2hlY2tib3goZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyICRjID0gJChlLnRhcmdldCkuY2xvc2VzdChcInNwYW5cIiksXG4gICAgICAgICAgICAgICAgICAgIGlucHQgPSAkYy5maW5kKFwiaW5wdXRcIikuZ2V0KDApO1xuXG4gICAgICAgICAgICAgICAgJGMudG9nZ2xlQ2xhc3MoXCJjaGVja2VkXCIpO1xuXG4gICAgICAgICAgICAgICAgaW5wdC5jaGVja2VkID0gIWlucHQuY2hlY2tlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBtb2RlbEV2ZW50czoge1xuXG4gICAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIGNoYW5nZSgpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMudWkubmV4dC5hdHRyKCdkaXNhYmxlZCcsICF0aGlzLm1vZGVsLmlzVmFsaWQoKSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnY2hhbmdlOndpZHRoJzogZnVuY3Rpb24gY2hhbmdlV2lkdGgobSwgdikge1xuICAgICAgICAgICAgICAgIHRoaXMuJCgnaW5wdXRbbmFtZT1cIndpZHRoXCJdJykudmFsKHYpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ2NoYW5nZTpoZWlnaHQnOiBmdW5jdGlvbiBjaGFuZ2VIZWlnaHQobSwgdikge1xuICAgICAgICAgICAgICAgIHRoaXMuJCgnaW5wdXRbbmFtZT1cImhlaWdodFwiXScpLnZhbCh2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdFdmVudHM6IHtcblxuICAgICAgICAgICAgJ2NoYXJ0OnNlbGVjdGVkJzogZnVuY3Rpb24gY2hhcnRTZWxlY3RlZCh2KSB7XG4gICAgICAgICAgICAgICAgdGhpcy51aS5uZXh0LmF0dHIoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7XG5cbiAgICAgICAgICAgIHZhciBzdGVwID0gdGhpcy5zdGVwLmdldChcInN0ZXBcIik7XG4gICAgICAgICAgICBzdGVwKys7XG4gICAgICAgICAgICB0aGlzLnN0ZXAuc2V0KFwic3RlcFwiLCBzdGVwKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja1RpdGxlOiBmdW5jdGlvbiBjaGVja1RpdGxlKCkge1xuXG4gICAgICAgICAgICB0aGlzLm1vZGVsLnNldChcInRpdGxlXCIsICQudHJpbSh0aGlzLiQoXCIjdGl0bGVXaWRnZXRcIikudmFsKCkpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja1N0ZXA6IGZ1bmN0aW9uIGNoZWNrU3RlcCgpIHtcblxuICAgICAgICAgICAgdGhpcy4kZWwuY2xvc2VzdCgnLnNpZGUtcGFuZWwnKS5yZW1vdmVDbGFzcygnYmlnJyk7XG5cbiAgICAgICAgICAgIHZhciBzID0gdGhpcy5zdGVwLmdldChcInN0ZXBcIiksXG4gICAgICAgICAgICAgICAgcCA9IHRoaXMucGFuZWxzW3RoaXMubW9kZWwuZ2V0KFwidHlwZU5hbWVcIildIHx8IHRoaXMucGFuZWxzW1wiRGVmYXVsdFwiXTtcblxuICAgICAgICAgICAgaWYgKHAuaW5kZXhPZihcImh0bWxFZGl0b3JcIikgIT09IC0xICYmIHRoaXMuZ2V0UmVnaW9uKCdlZGl0b3InKS5oYXNWaWV3KCkpIHRoaXMubW9kZWwuc2V0KFwiY29udGVudEh0bWxcIiwgdGhpcy5nZXRDaGlsZFZpZXcoJ2VkaXRvcicpLmVqUlRFLmdldEh0bWwoKSk7XG5cbiAgICAgICAgICAgIGlmIChzID49IDAgJiYgcyA8PSBwLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5uZXh0LnRleHQocyA9PT0gcC5sZW5ndGggPyBSZXNvdXJjZXMuY3JlYXRlZFdpZGdldCA6IFJlc291cmNlcy5uZXh0KS5hdHRyKCdkaXNhYmxlZCcsICF0aGlzLm1vZGVsLmlzVmFsaWQoKSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVpLmJhY2suYXR0cignZGlzYWJsZWQnLCBzID09PSAxKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuJChcIi5zdGVwLXBhbmVsXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB2YXIgcGFuZWxOYW1lID0gcFtzIC0gMV07XG4gICAgICAgICAgICAgICAgdGhpcy4kKFwiLlwiICsgcGFuZWxOYW1lKS5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAocyA9PT0gMSkgdGhpcy4kKFwiLmNtZFwiKS5oaWRlKCk7ZWxzZSB0aGlzLiQoXCIuY21kXCIpLnNob3coKTtcblxuICAgICAgICAgICAgICAgIHN3aXRjaCAocGFuZWxOYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInJlcXVlc3RQYXJhbVwiOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ3JlcUFyZWEnLCBuZXcgUmVxdWVzdHMoeyBtb2RlbDogdGhpcy5tb2RlbCB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ2aXN1YWxpemF0aW9uXCI6XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmNsb3Nlc3QoJy5zaWRlLXBhbmVsJykuYWRkQ2xhc3MoJ2JpZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5uZXh0LmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ3Zpc3VhbCcsIG5ldyB2aXN1YWxWaWV3KHsgbW9kZWw6IHRoaXMubW9kZWwgfSkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwic3Vic2NyaWJlXCI6XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5nZXRSZWdpb24oJ3N1YnNjckFyZWEnKS5oYXNWaWV3KCkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcyA9IG5ldyBzdWJzY3JpYmVMaXN0KHsgY29sbGVjdGlvbjogdGhpcy5tb2RlbC5jb2xsZWN0aW9uIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRSZWdpb24oJ3N1YnNjckFyZWEnKS5zaG93KHNzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuVG8oc3MsICdjbGljazppdGVtOnN1YnNjcmliZScsIGZ1bmN0aW9uICh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF2LiQoJ2lucHV0JykuaXMoJzpjaGVja2VkJykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi4kKCdpbnB1dCcpLnByb3AoJ2NoZWNrZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVibGlzaGVycy5hZGQobmV3IEJhY2tib25lLk1vZGVsKHsgaWQ6IHYubW9kZWwuaWQsIHRpdGxlOiB2Lm1vZGVsLmdldCgndGl0bGUnKSB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuJCgnaW5wdXQnKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdWJsaXNoZXJzLnJlbW92ZSh0aGlzLnB1Ymxpc2hlcnMuZ2V0KHYubW9kZWwuaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImh0bWxFZGl0b3JcIjpcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmdldFJlZ2lvbignZWRpdG9yJykuaGFzVmlldygpKSB0aGlzLnNob3dDaGlsZFZpZXcoJ2VkaXRvcicsIG5ldyBIdG1sRWRpdG9yKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiZGVjb3JhdGlvblwiOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZ2V0UmVnaW9uKCdkZWNvcmF0aW9uJykuaGFzVmlldygpKSB0aGlzLnNob3dDaGlsZFZpZXcoJ2RlY29yYXRpb24nLCBuZXcgZGVjb3JhdGlvblZpZXcoeyBtb2RlbDogdGhpcy5tb2RlbCB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzID4gcC5sZW5ndGgpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnB1Ymxpc2hlcnMubGVuZ3RoKSB0aGlzLm1vZGVsLnNldChcInB1Ymxpc2hlcnNcIiwgdGhpcy5wdWJsaXNoZXJzLnBsdWNrKFwiaWRcIikpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nZXREZWNvcmF0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgd2luID0gJCgnbWFpbicpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHdpbi5oZWlnaHQoKSAvIDIgLSB0aGlzLm1vZGVsLmdldCgnaGVpZ2h0JykgLyAyICsgd2luLnNjcm9sbFRvcCgpLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiB3aW4ud2lkdGgoKSAvIDIgLSB0aGlzLm1vZGVsLmdldCgnd2lkdGgnKSAvIDIgKyB3aW4uc2Nyb2xsTGVmdCgpXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbGxlY3Rpb24uY3JlYXRlKHRoaXMubW9kZWwsIHsgd2FpdDogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVnaW9uKCdyZXFBcmVhJykuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFJlZ2lvbignc3Vic2NyQXJlYScpLmVtcHR5KCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoXCJjbG9zZTpsZWZ0XCIsIHRoaXMubW9kZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldERlY29yYXRpb246IGZ1bmN0aW9uIGdldERlY29yYXRpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLm1vZGVsLmdldCgnRGVjb3JhdGlvbicpIHx8IHt9LFxuICAgICAgICAgICAgICAgIHcgPSBwYXJzZUludCh0aGlzLiQoJ2lucHV0W25hbWU9XCJ3aWR0aFwiXScpLnZhbCgpKSxcbiAgICAgICAgICAgICAgICBoID0gcGFyc2VJbnQodGhpcy4kKCdpbnB1dFtuYW1lPVwiaGVpZ2h0XCJdJykudmFsKCkpO1xuXG4gICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGlzTmFOKHcpID8gdGhpcy5tb2RlbC5nZXQoJ3dpZHRoJykgOiB3IDwgTUlOX1NJWkUgPyBNSU5fU0laRSA6IHcsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBpc05hTihoKSA/IHRoaXMubW9kZWwuZ2V0KCdoZWlnaHQnKSA6IGggPCBNSU5fU0laRSA/IE1JTl9TSVpFIDogaFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3dpZGdldDptYXA6bGVnZW5kVmlldycsIFtdLCBmdW5jdGlvbiAoKSB7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiAnI3dpZGdldC1tYXAtbGVnZW5kLXRlbXBsYXRlJyxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgY29udGFpbmVyOiAnLkxlZ2VuZENvbnRhaW5lcidcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5tb2RlbC5nZXQoJ0xlZ2VuZElzVmlzaWJsZScpKSB0aGlzLiRlbC5oaWRlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtb2RlbEV2ZW50czoge1xuXG4gICAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIGNoYW5nZSgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldFBvc2l0aW9uOiBmdW5jdGlvbiBzZXRQb3NpdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIHAgPSB0aGlzLm1vZGVsLmdldCgnTGVnZW5kUG9zaXRpb24nKSB8fCAndG9wLXJpZ2h0JyxcbiAgICAgICAgICAgICAgICBfcCA9IHAuc3BsaXQoXCItXCIpLFxuICAgICAgICAgICAgICAgIGIgPSBfcFsxXSxcbiAgICAgICAgICAgICAgICBjc3MgPSB7fTtcblxuICAgICAgICAgICAgY3NzW19wWzBdXSA9IFwiMXB4XCI7XG4gICAgICAgICAgICBjc3NbYl0gPSBiID09PSBcInRvcFwiID8gMzYgKyBcInB4XCIgOiBcIjFweFwiO1xuXG4gICAgICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5mYWRlVG8oXCJoaWRlXCIsIC44KS5jc3MoY3NzKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3dpZGdldC5yZXBvcnRWaWV3JywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ1BERkpTJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMpIHtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6IGZhbHNlLFxuXG4gICAgICAgIG1vZGVsRXZlbnRzOiB7XG5cbiAgICAgICAgICAgIGNoYW5nZTogZnVuY3Rpb24gY2hhbmdlKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJQYWdlKHRoaXMucGRmKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudXJsKSB0aGlzLiRlbC5odG1sKCc8cD4nICsgUmVzb3VyY2VzLnNldHJlcG9ydCArICc8L3A+Jyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25BdHRhY2g6IGZ1bmN0aW9uIG9uQXR0YWNoKCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnVybCkgcmVxdWlyZShbXCIvanMvZGlzdC9wZGYvZGlzcGxheS9hcGkuanNcIiwgXCIvanMvZGlzdC9wZGYvZGlzcGxheS9tZXRhZGF0YS5qc1wiLCBcIi9qcy9kaXN0L3BkZi9kaXNwbGF5L2NhbnZhcy5qc1wiLCBcIi9qcy9kaXN0L3BkZi9kaXNwbGF5L3dlYmdsLmpzXCIsIFwiL2pzL2Rpc3QvcGRmL2Rpc3BsYXkvcGF0dGVybl9oZWxwZXIuanNcIiwgXCIvanMvZGlzdC9wZGYvZGlzcGxheS9mb250X2xvYWRlci5qc1wiLCBcIi9qcy9kaXN0L3BkZi9kaXNwbGF5L2Fubm90YXRpb25faGVscGVyLmpzXCJdLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBQREZKUy53b3JrZXJTcmMgPSAnL2pzL2Rpc3QvcGRmL3dvcmtlcl9sb2FkZXIuanMnO1xuXG4gICAgICAgICAgICAgICAgUERGSlMuZ2V0RG9jdW1lbnQodGhpcy5vcHRpb25zLnVybCkudGhlbihmdW5jdGlvbiAocGRmKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGRmID0gcGRmO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclBhZ2UocGRmKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW5kZXJQYWdlOiBmdW5jdGlvbiByZW5kZXJQYWdlKHBkZikge1xuXG4gICAgICAgICAgICB2YXIgdmlld2VyID0gdGhpcy4kZWwuZ2V0KDApLFxuICAgICAgICAgICAgICAgIHdpZHRoID0gdGhpcy4kZWwud2lkdGgoKSAtIDQwO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiByZW5kZXJQYWdlKGRpdiwgcGRmLCBwYWdlTnVtYmVyLCBjYWxsYmFjaykge1xuXG4gICAgICAgICAgICAgICAgcGRmLmdldFBhZ2UocGFnZU51bWJlcikudGhlbihmdW5jdGlvbiAocGFnZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzY2FsZSA9IDEuMDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gcGFnZS5nZXRWaWV3cG9ydChzY2FsZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmlld3BvcnQgPSBwYWdlLmdldFZpZXdwb3J0KHdpZHRoIC8gdmlld3BvcnQud2lkdGgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdlRGlzcGxheVdpZHRoID0gdmlld3BvcnQud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdlRGlzcGxheUhlaWdodCA9IHZpZXdwb3J0LmhlaWdodDtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZURpdkhvbGRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICBwYWdlRGl2SG9sZGVyLmNsYXNzTmFtZSA9ICdwZGZwYWdlJztcbiAgICAgICAgICAgICAgICAgICAgcGFnZURpdkhvbGRlci5zdHlsZS53aWR0aCA9IHBhZ2VEaXNwbGF5V2lkdGggKyA1ICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgcGFnZURpdkhvbGRlci5zdHlsZS5oZWlnaHQgPSBwYWdlRGlzcGxheUhlaWdodCArIDUgKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQocGFnZURpdkhvbGRlcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUHJlcGFyZSBjYW52YXMgdXNpbmcgUERGIHBhZ2UgZGltZW5zaW9uc1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHBhZ2VEaXNwbGF5V2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBwYWdlRGlzcGxheUhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgcGFnZURpdkhvbGRlci5hcHBlbmRDaGlsZChjYW52YXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciBQREYgcGFnZSBpbnRvIGNhbnZhcyBjb250ZXh0XG4gICAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJDb250ZXh0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzQ29udGV4dDogY29udGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdwb3J0OiB2aWV3cG9ydFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBwYWdlLnJlbmRlcihyZW5kZXJDb250ZXh0KS5wcm9taXNlLnRoZW4oY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcGFnZU51bWJlciA9IDE7XG4gICAgICAgICAgICByZW5kZXJQYWdlKHZpZXdlciwgcGRmLCBwYWdlTnVtYmVyKyssIGZ1bmN0aW9uIHBhZ2VSZW5kZXJpbmdDb21wbGV0ZSgpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFnZU51bWJlciA+IHBkZi5udW1QYWdlcykgcmV0dXJuOyAvLyBBbGwgcGFnZXMgcmVuZGVyZWQgXG4gICAgICAgICAgICAgICAgcmVuZGVyUGFnZSh2aWV3ZXIsIHBkZiwgcGFnZU51bWJlcisrLCBwYWdlUmVuZGVyaW5nQ29tcGxldGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZml0U2l6ZTogZnVuY3Rpb24gZml0U2l6ZSgpIHt9XG4gICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnd2lkZ2V0LnNlbW5ldC5zZW1uZXRWaWV3JywgW10sIGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBaT09NX01JTiA9IDAuMTI1LFxuICAgICAgICBaT09NX01BWCA9IDY7XG5cbiAgICB2YXIgc2VtbmV0TW9kZWwgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuXG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICBhc3RyZWU6IDAsXG4gICAgICAgICAgICBlcGFyYW06IFswLCAwLCAwXSxcbiAgICAgICAgICAgIGZpbHRlcjogbnVsbCxcbiAgICAgICAgICAgIGZpbHRlck5hbWU6IG51bGwsXG4gICAgICAgICAgICBmaWx0ZXJWYWx1ZTogbnVsbCxcbiAgICAgICAgICAgIGhlaWdodDogMCxcbiAgICAgICAgICAgIGh0bWw6ICcnLFxuICAgICAgICAgICAgbGV2ZWw6IDAsXG4gICAgICAgICAgICBzbmlkOiAtMSxcbiAgICAgICAgICAgIHRpdGxlOiAnJyxcbiAgICAgICAgICAgIHdpZHRoOiAwXG4gICAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPHN2Zz48ZyBjbGFzcz1cIndyYXBcIj48L2c+PC9zdmc+JyksXG5cbiAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICdtb3VzZW92ZXIgZy5ub2RlW2RhdGEtb2JqZWN0aWRdJzogZnVuY3Rpb24gbW91c2VvdmVyR05vZGVEYXRhT2JqZWN0aWQoZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyICRlID0gJChlLmN1cnJlbnRUYXJnZXQpLFxuICAgICAgICAgICAgICAgICAgICBpZCA9IHBhcnNlSW50KCRlLmF0dHIoJ2RhdGEtb2JqZWN0aWQnKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGlkKSAmJiBpZCkgJGUuY3NzKCdjdXJzb3InLCAncG9pbnRlcicpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ21vdXNlb3V0IGcubm9kZVtkYXRhLW9iamVjdGlkXSc6IGZ1bmN0aW9uIG1vdXNlb3V0R05vZGVEYXRhT2JqZWN0aWQoZSkge1xuICAgICAgICAgICAgICAgICQoZS5jdXJyZW50VGFyZ2V0KS5jc3MoJ2N1cnNvcicsICdkZWZhdWx0Jyk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnY2xpY2sgZy5ub2RlW2RhdGEtb2JqZWN0aWRdJzogZnVuY3Rpb24gY2xpY2tHTm9kZURhdGFPYmplY3RpZChlKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgJGUgPSAkKGUuY3VycmVudFRhcmdldCksXG4gICAgICAgICAgICAgICAgICAgIGlkID0gcGFyc2VJbnQoJGUuYXR0cignZGF0YS1vYmplY3RpZCcpKTtcblxuICAgICAgICAgICAgICAgIGlmICghaXNOYU4oaWQpICYmIGlkKSB0aGlzLnRyaWdnZXIoJ3N1YnNjcmliZXJzOnJlZmxlY3QnLCBuZXcgQmFja2JvbmUuTW9kZWwoeyAnb2JqZWN0X2lkJzogaWQsIHJlcXVlc3RJRDogdGhpcy5vcHRpb25zLlJJRCB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5tb2RlbCA9IG5ldyBzZW1uZXRNb2RlbCgpO1xuICAgICAgICAgICAgdGhpcy5tb2RlbC51cmwgPSAnL2FwaS9TZW1OZXQvJyArIHRoaXMub3B0aW9ucy5vYmplY3RJRCArICcvP3NlbW5ldGlkPS0xJmxheW91dD0nICsgdGhpcy5vcHRpb25zLndpZGdldC5nZXQoJ1NOTGF5b3V0JykgKyAnJmxldmVsPScgKyB0aGlzLm9wdGlvbnMud2lkZ2V0LmdldCgnU05MZXZlbCcpICsgJyZhc3RyZWU9JyArIHRoaXMub3B0aW9ucy53aWRnZXQuZ2V0KCdTTlN0cnVjdCcpO1xuXG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMub3B0aW9ucy53aWRnZXQsICdjaGFuZ2U6d2lkdGgnLCBmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpdFNpemUobSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm9wdGlvbnMud2lkZ2V0LCAnY2hhbmdlOmhlaWdodCcsIGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZml0U2l6ZShtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuUklEKSBjb25zb2xlLmVycm9yKCchTm90IHJlcXVlc3RJRCEnKTtcblxuICAgICAgICAgICAgJC5hamF4U2V0dGluZ3MuaGVhZGVycy5rZXkgPSAkLm1lcmdlVXJsUGFyYW0oJC5hamF4U2V0dGluZ3MuaGVhZGVycy5rZXksIHsgUklEOiB0aGlzLm9wdGlvbnMuUklEIH0pO1xuXG4gICAgICAgICAgICB0aGlzLm1vZGVsLmZldGNoKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbW9kZWxFdmVudHM6IHtcblxuICAgICAgICAgICAgJ2NoYW5nZTpodG1sJzogZnVuY3Rpb24gY2hhbmdlSHRtbChtLCB2KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyLndpZHRoKCksXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IHRoaXMub3B0aW9ucy5jb250YWluZXIuaGVpZ2h0KCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLiQoJ2cud3JhcCcpLmh0bWwoJCh2KS5odG1sKCkpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdCh0aGlzLiQoJ3N2ZycpLmdldCgwKSksXG4gICAgICAgICAgICAgICAgICAgIGcgPSBzdmcuc2VsZWN0KCdnLndyYXAnKSxcbiAgICAgICAgICAgICAgICAgICAgem9vbSA9IGQzLnpvb20oKS5zY2FsZUV4dGVudChbWk9PTV9NSU4sIFpPT01fTUFYXSkub24oXCJ6b29tXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZy5hdHRyKFwidHJhbnNmb3JtXCIsIGQzLmV2ZW50LnRyYW5zZm9ybSk7XG4gICAgICAgICAgICAgICAgfSkub24oXCJlbmRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvL3RoaXMuX3NldENlbnRlcihkMy5ldmVudC50cmFuc2Zvcm0pO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSksXG4gICAgICAgICAgICAgICAgICAgIGR4ID0gdGhpcy5tb2RlbC5nZXQoJ3dpZHRoJyksXG4gICAgICAgICAgICAgICAgICAgIGR5ID0gdGhpcy5tb2RlbC5nZXQoJ2hlaWdodCcpLFxuICAgICAgICAgICAgICAgICAgICB4ID0gZHggLyAyLFxuICAgICAgICAgICAgICAgICAgICB5ID0gZHkgLyAyLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZSA9IE1hdGgubWF4KFpPT01fTUlOLCBNYXRoLm1pbihaT09NX01BWCwgMC45IC8gTWF0aC5tYXgoZHggLyB3aWR0aCwgZHkgLyBoZWlnaHQpKSksXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZSA9IFt3aWR0aCAvIDIgLSBzY2FsZSAqIHgsIGhlaWdodCAvIDIgLSBzY2FsZSAqIHldO1xuXG4gICAgICAgICAgICAgICAgc3ZnLmF0dHIoJ3dpZHRoJywgd2lkdGgpLmF0dHIoJ2hlaWdodCcsIGhlaWdodCkuY2FsbCh6b29tKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oNzUwKS5jYWxsKHpvb20udHJhbnNmb3JtLCBkMy56b29tSWRlbnRpdHkudHJhbnNsYXRlKHRyYW5zbGF0ZVswXSwgdHJhbnNsYXRlWzFdKS5zY2FsZShzY2FsZSkpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gcmVxdWVzdCgpIHtcbiAgICAgICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdsb2FkZXInKS50cmlnZ2VyKCdzaG93JywgdGhpcy4kZWwsIHsgc3BlZWQ6ICdmYXN0JyB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHN5bmM6IGZ1bmN0aW9uIHN5bmMoKSB7XG4gICAgICAgICAgICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnbG9hZGVyJykudHJpZ2dlcignaGlkZScpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKCkge1xuICAgICAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2xvYWRlcicpLnRyaWdnZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfZml0U2l6ZTogZnVuY3Rpb24gX2ZpdFNpemUobSkge1xuXG4gICAgICAgICAgICAvL3RoaXMucmVuZGVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NldENlbnRlcjogZnVuY3Rpb24gX3NldENlbnRlcih4LCB5LCBkKSB7XG5cbiAgICAgICAgICAgIC8vINC00LvRjyDRgdC+0YXRgNCw0L3QtdC90LjRjyDQv9C+0LfQuNGG0LjQuCDQuCDQvNCw0YHRiNGC0LDQsdCwXG5cbiAgICAgICAgICAgIHZhciBtb2RlbCA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLm9wdGlvbnMud2lkZ2V0LmdldCgndGl0bGUnKSxcbiAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLm9wdGlvbnMud2lkZ2V0LmdldCgndHlwZU5hbWUnKSxcbiAgICAgICAgICAgICAgICB1aWQ6IHRoaXMub3B0aW9ucy53aWRnZXQuaWQsXG4gICAgICAgICAgICAgICAgVmlzdWFsaXphdGlvbjogdGhpcy5vcHRpb25zLndpZGdldC5nZXQoJ1Zpc3VhbGl6YXRpb24nKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG0gPSBuZXcgQmFja2JvbmUuTW9kZWwoe1xuICAgICAgICAgICAgICAgIHdpZGdldDogbW9kZWwsXG4gICAgICAgICAgICAgICAgb2JqZWN0SUQ6IHRoaXMubW9kZWwuaWQsXG4gICAgICAgICAgICAgICAgU05YOiB4LFxuICAgICAgICAgICAgICAgIFNOWTogeSxcbiAgICAgICAgICAgICAgICBTTlpvb206IGRcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtLnVybCA9IFwiL2FwaS93aWRnZXQvXCIgKyB0aGlzLm9wdGlvbnMud2lkZ2V0LmlkICsgXCIvc2V0c3RhdGVcIjtcbiAgICAgICAgICAgIG0uc2F2ZSgpO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdjaGFydHNSZXBvc2l0b3J5JywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMpIHtcblxuICAgICAgICAgICByZXR1cm4gW3sgaWQ6IDEsIG5hbWU6IFJlc291cmNlcy5nbjEsIHR5cGU6IFwiY29sdW1uXCIsIGZhbWlseTogJ1N5bmNmdXNpb25fRycgfSwgeyBpZDogMywgbmFtZTogUmVzb3VyY2VzLmduMiwgdHlwZTogXCJiYXJcIiwgZmFtaWx5OiAnU3luY2Z1c2lvbl9HJyB9LCB7IGlkOiA1LCBuYW1lOiBSZXNvdXJjZXMuZ24zLCB0eXBlOiBcInN0YWNraW5nY29sdW1uXCIsIGZhbWlseTogJ1N5bmNmdXNpb25fRycgfSwgeyBpZDogNywgbmFtZTogUmVzb3VyY2VzLmduNiwgdHlwZTogXCJsaW5lXCIsIGZhbWlseTogJ1N5bmNmdXNpb25fRycgfSwgeyBpZDogMTYsIG5hbWU6IFJlc291cmNlcy5nbjcsIHR5cGU6ICdzdGFja2luZ2NvbHVtbjEwMCcsIGZhbWlseTogJ1N5bmNmdXNpb25fRycgfSwgeyBpZDogMTEsIG5hbWU6IFJlc291cmNlcy5nbjgsIHR5cGU6ICdhcmVhJywgZmFtaWx5OiAnU3luY2Z1c2lvbl9HJyB9LCB7IGlkOiAxNSwgbmFtZTogUmVzb3VyY2VzLmduOSwgdHlwZTogJ3N0YWNraW5nYXJlYTEwMCcsIGZhbWlseTogJ1N5bmNmdXNpb25fRycgfSwgeyBpZDogNiwgbmFtZTogUmVzb3VyY2VzLmduNSwgdHlwZTogXCJwaWVcIiwgZmFtaWx5OiAnU3luY2Z1c2lvbl9QJyB9LCB7IGlkOiAyMiwgbmFtZTogUmVzb3VyY2VzLmduNCwgdHlwZTogJ2J1YmJsZScsIGZhbWlseTogJ1N5bmNmdXNpb25fVycgfSwgeyBpZDogNCwgbmFtZTogUmVzb3VyY2VzLmduMTAsIHR5cGU6IFwiYmFyX2QzXCIsIGZhbWlseTogJ0MzJyB9LCB7IGlkOiA5LCBuYW1lOiBSZXNvdXJjZXMuZ24xMSwgdHlwZTogJ2FyZWFfZDMnLCBmYW1pbHk6ICdDMycgfV07XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnc2V0dGluZ3MudmlzdWFsaXNhdGlvbi5jaGFydC5jaG9pY2UnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnc2VuZE1vZGVsJywgJ2VqQ2hhcnRWaWV3JywgJ2NoYXJ0c1JlcG9zaXRvcnknXSwgZnVuY3Rpb24gKFJlc291cmNlcywgc2VuZE1vZGVsLCBlakNoYXJ0VmlldywgcmVwb3NpdG9yeSkge1xuXG4gICAgdmFyIGxpc3RWaWV3ID0gTW4uQ29sbGVjdGlvblZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBjbGFzc05hbWU6ICdncmFwaC1wYW5lbC1ncmlkJyxcblxuICAgICAgICBjaGlsZFZpZXc6IGVqQ2hhcnRWaWV3LFxuXG4gICAgICAgIGNoaWxkVmlld09wdGlvbnM6IGZ1bmN0aW9uIGNoaWxkVmlld09wdGlvbnMobSkge1xuICAgICAgICAgICAgbS5zZXQoeyB3aWR0aDogJzMwMCcsIGhlaWdodDogJzMwMCcgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hpbGRWaWV3RXZlbnRzOiB7XG5cbiAgICAgICAgICAgICdjaGFydDpzZWxlY3RlZCc6IGZ1bmN0aW9uIGNoYXJ0U2VsZWN0ZWQodikge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgICAgICAgIGMuJGVsLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdi4kZWwuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYXJ0OnNlbGVjdGVkJywgdik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBjbGFzc05hbWU6ICdncmFwaC1wYW5lbCBzaG93JyxcblxuICAgICAgICB0ZW1wbGF0ZTogJyNjaG9pY2UtY2hhcnQtdGVtcGxhdGUnLFxuXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICB3cmFwOiB7IGVsOiAnZGl2LmdyYXBoLXBhbmVsLWdyaWQnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB2YXIgcGEgPSB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKTtcblxuICAgICAgICAgICAgdGhpcy5zZW5kTW9kZWwgPSBuZXcgc2VuZE1vZGVsKHtcbiAgICAgICAgICAgICAgICBpZDogcGEucmlkLFxuICAgICAgICAgICAgICAgIHBhcnM6IHBhLnBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgdXNlRGVmUGFyYW1zOiBwYS51c2VEZWZQYXJhbXMsXG4gICAgICAgICAgICAgICAgd2lkZ2V0OiB7XG4gICAgICAgICAgICAgICAgICAgIHVpZDogdGhpcy5tb2RlbC5pZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5tb2RlbC5nZXQoJ3RpdGxlJyksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMubW9kZWwuZ2V0KCd0eXBlTmFtZScpLFxuICAgICAgICAgICAgICAgICAgICBWaXN1YWxpemF0aW9uOiB0aGlzLm1vZGVsLmdldCgnVmlzdWFsaXphdGlvbicpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucnVsZUNvZGUpIHRoaXMuc2VuZE1vZGVsLnNldCgncnVsZUNvZGUnLCB0aGlzLm9wdGlvbnMucnVsZUNvZGUpO1xuXG4gICAgICAgICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdsb2FkZXInKS50cmlnZ2VyKCdzaG93JywgdGhpcy4kZWwpO1xuXG4gICAgICAgICAgICB0aGlzLnNlbmRNb2RlbC5mZXRjaCh7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdGhpcy5fc3VjY2Vzc0xvYWQuYmluZCh0aGlzKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3N1Y2Nlc3NMb2FkOiBmdW5jdGlvbiBfc3VjY2Vzc0xvYWQobSkge1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG0uZ2V0KCdkYXRhJykudmFyaWF0aW9ucyxcbiAgICAgICAgICAgICAgICBjaGFydHMgPSBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbigpO1xuXG4gICAgICAgICAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24gKG8pIHtcblxuICAgICAgICAgICAgICAgIHZhciBmYW1pbHkgPSBvLmZhbWlseTtcblxuICAgICAgICAgICAgICAgIF8uY2hhaW4ocmVwb3NpdG9yeSkuZmlsdGVyKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmZhbWlseSA9PT0gZmFtaWx5O1xuICAgICAgICAgICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKGIpIHtcblxuICAgICAgICAgICAgICAgICAgICBjaGFydHMuYWRkKG5ldyBCYWNrYm9uZS5Nb2RlbChfLmV4dGVuZChiLCBvKSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnd3JhcCcsIG5ldyBsaXN0Vmlldyh7IGNvbGxlY3Rpb246IGNoYXJ0cyB9KSk7XG5cbiAgICAgICAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2xvYWRlcicpLnRyaWdnZXIoJ2hpZGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdFdmVudHM6IHtcblxuICAgICAgICAgICAgJ2NoYXJ0OnNlbGVjdGVkJzogZnVuY3Rpb24gY2hhcnRTZWxlY3RlZCh2KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcnAgPSB0aGlzLm1vZGVsLmdldCgncmVxdWVzdFBhcmFtZXRlcnMnKTtcbiAgICAgICAgICAgICAgICBycC5ydWxlQ29kZSA9IHYubW9kZWwuZ2V0KCdydWxlQ29kZScpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoeyBWaXN1YWxpemF0aW9uOiB2Lm1vZGVsLmdldCgndHlwZScpIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFydDpzZWxlY3RlZCcsIHYpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdzZXR0aW5ncy52aXN1YWxpemF0aW9uLmNoYXJ0JywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ2dsb2JhbC52aWV3LmRyb3BEb3duJywgJ2dsb2JhbC5jaGFydHMuc2V0dGluZ3Ntb2RlbCcsICdnbG9iYWwuYmVoYXZpb3JzLmlucHV0JywgJ3NldHRpbmdzLmNvbG9yUm93JywgJ3NldHRpbmdzLnZpc3VhbGlzYXRpb24uY2hhcnQuY2hvaWNlJywgJ3JhZGlvLmNoYXJhY3RlcmlzdGljJywgJ1JVJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMsIGRyb3BEb3duLCBzdWJTZXR0aW5ncywgaW5wdXRCZWhhdmlvciwgY29sb3JSb3csIHZpc3VhbFZpZXcpIHtcblxuICAgIHZhciBpdGVtcyA9IFt7IGlkOiAxLCBuYW1lOiBSZXNvdXJjZXMuZ24xLCB0aXRsZTogXCJjb2x1bW5cIiB9LCB7IGlkOiAzLCBuYW1lOiBSZXNvdXJjZXMuZ24yLCB0aXRsZTogXCJiYXJcIiB9LCB7IGlkOiA1LCBuYW1lOiBSZXNvdXJjZXMuZ24zLCB0aXRsZTogXCJzdGFja2luZ2NvbHVtblwiIH0sIHsgaWQ6IDIyLCBuYW1lOiBSZXNvdXJjZXMuZ240LCB0aXRsZTogJ2J1YmJsZScgfSwgeyBpZDogNiwgbmFtZTogUmVzb3VyY2VzLmduNSwgdGl0bGU6IFwicGllXCIgfSwgeyBpZDogNywgbmFtZTogUmVzb3VyY2VzLmduNiwgdGl0bGU6IFwibGluZVwiIH0sIHsgaWQ6IDE2LCBuYW1lOiBSZXNvdXJjZXMuZ243LCB0aXRsZTogJ3N0YWNraW5nY29sdW1uMTAwJyB9LCB7IGlkOiAxMSwgbmFtZTogUmVzb3VyY2VzLmduOCwgdGl0bGU6ICdhcmVhJyB9LCB7IGlkOiAxNSwgbmFtZTogUmVzb3VyY2VzLmduOSwgdGl0bGU6ICdzdGFja2luZ2FyZWExMDAnIH0sIHsgaWQ6IDQsIG5hbWU6IFJlc291cmNlcy5nbjEwLCB0aXRsZTogXCJiYXJfZDNcIiB9LCB7IGlkOiA5LCBuYW1lOiBSZXNvdXJjZXMuZ24xMSwgdGl0bGU6ICdhcmVhX2QzJ1xuICAgICAgICAvL3sgaWQ6IDAsIG5hbWU6IFJlc291cmNlcy50YywgdGl0bGU6IFwidGFnQ2xvdWRcIiB9LFxuICAgICAgICAvL3sgaWQ6IDIsIG5hbWU6IFJlc291cmNlcy5iYXIyLCB0aXRsZTogXCJiYXIzRFwiIH0sXG4gICAgICAgIC8veyBpZDogOCwgbmFtZTogUmVzb3VyY2VzLmFyZWEgKyBcIiAoXCIgKyBSZXNvdXJjZXMuZGV0YWlsICsgXCIpXCIsIHRpdGxlOiAnc3BsaW5lJyB9LFxuICAgICAgICAvL3sgaWQ6IDEwLCBuYW1lOiAnc3RlcGxpbmUnLCB0aXRsZTogJ3N0ZXBsaW5lJyB9LFxuICAgICAgICAvL3sgaWQ6IDEyLCBuYW1lOiAnc3RlcGFyZWEnLCB0aXRsZTogJ3N0ZXBhcmVhJyB9LFxuICAgICAgICAvL3sgaWQ6IDEzLCBuYW1lOiAnc3BsaW5lYXJlYScsIHRpdGxlOiAnc3BsaW5lYXJlYScgfSxcbiAgICAgICAgLy97IGlkOiAxNCwgbmFtZTogJ3N0YWNraW5nYXJlYScsIHRpdGxlOiAnc3RhY2tpbmdhcmVhJyB9LCAgICAgICAgICBcbiAgICAgICAgLy97IGlkOiAxNywgbmFtZTogJ3N0YWNraW5nYmFyJywgdGl0bGU6ICdzdGFja2luZ2JhcicgfSxcbiAgICAgICAgLy97IGlkOiAxOCwgbmFtZTogJ2RvdWdobnV0JywgdGl0bGU6ICdkb3VnaG51dCcgfSxcbiAgICAgICAgLy97IGlkOiAyMCwgbmFtZTogJ3B5cmFtaWQnLCB0aXRsZTogJ3B5cmFtaWQnIH0sXG4gICAgICAgIC8veyBpZDogMjEsIG5hbWU6ICdmdW5uZWwnLCB0aXRsZTogJ2Z1bm5lbCcgfSxcbiAgICAgICAgLy97IGlkOiAyMywgbmFtZTogJ2NvbHVtbjNEJywgdGl0bGU6ICdjb2x1bW4zRCcgfSxcbiAgICAgICAgLy97IGlkOiAyNCwgbmFtZTogJ3N0YWNraW5nY29sdW1uM0QnLCB0aXRsZTogJ3N0YWNraW5nY29sdW1uM0QnIH0sXG4gICAgICAgIC8veyBpZDogMjUsIG5hbWU6ICdzdGFja2luZ2NvbHVtbjEwMDNEJywgdGl0bGU6ICdzdGFja2luZ2NvbHVtbjEwMDNEJyB9LFxuICAgICAgICAvL3sgaWQ6IDI2LCBuYW1lOiAnc3RhY2tpbmdiYXIzRCcsIHRpdGxlOiAnc3RhY2tpbmdiYXIzRCcgfSxcbiAgICAgICAgLy97IGlkOiAyNywgbmFtZTogJ3N0YWNraW5nYmFyMTAwM0QnLCB0aXRsZTogJ3N0YWNraW5nYmFyMTAwM0QnIH0sXG4gICAgICAgIC8veyBpZDogMjgsIG5hbWU6ICdwaWUzRCcsIHRpdGxlOiAncGllM0QnIH0sXG4gICAgICAgIC8veyBpZDogMjksIG5hbWU6ICdkb3VnaG51dDNEJywgdGl0bGU6ICdkb3VnaG51dDNEJyB9XG4gICAgfV07XG5cbiAgICAvL3ZhciBsaXN0VmlldyA9IE1uLkNvbGxlY3Rpb25WaWV3LmV4dGVuZCh7XG5cbiAgICAvLyAgICB0YWdOYW1lOiAndWwnLFxuXG4gICAgLy8gICAgY2hpbGRWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAvLyAgICAgICAgdGFnTmFtZTogJ2xpJyxcblxuICAgIC8vICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPGlucHV0IGRhdGEtaWQ9XCI8JS0gdGl0bGUgJT5cIiAgaWQ9XCI8JS0gcHJlZml4ICsgXCJfXCIgKyB0aXRsZSAlPlwiIG5hbWU9XCI8JS0gcHJlZml4ICsgXCJfY2hhcnRWaWV3XCIgJT5cIiBjbGFzcz1cImctZm9ybS0tcmFkaW8gZ2FsbGVyeSA8JS0gdGl0bGUgJT5cIiB0eXBlPVwicmFkaW9cIiAvPjxsYWJlbCBmb3I9XCI8JS0gcHJlZml4ICsgXCJfXCIgKyB0aXRsZSAlPlwiIHRpdGxlPVwiPCUtIG5hbWUgJT5cIj48L2xhYmVsPicpLFxuXG4gICAgLy8gICAgICAgIHRyaWdnZXJzOiB7XG4gICAgLy8gICAgICAgICAgICAnY2xpY2sgbGFiZWwnOiB7XG4gICAgLy8gICAgICAgICAgICAgICAgZXZlbnQ6ICdjaG9vc2U6dHlwZTpjaGFydCcsXG4gICAgLy8gICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQ6IGZhbHNlXG4gICAgLy8gICAgICAgICAgICB9XG4gICAgLy8gICAgICAgIH0sXG5cbiAgICAvLyAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCdnYWxsZXJ5XycgKyB0aGlzLm1vZGVsLmdldCgndGl0bGUnKSk7XG4gICAgLy8gICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2NoZWNrZWQnKSlcbiAgICAvLyAgICAgICAgICAgICAgICB0aGlzLiQoJ2lucHV0JykuYXR0cignY2hlY2tlZCcsICdjaGVja2VkJyk7XG4gICAgLy8gICAgICAgIH1cbiAgICAvLyAgICB9KSxcblxuICAgIC8vICAgIGNoaWxkVmlld09wdGlvbnM6IGZ1bmN0aW9uIChtKSB7XG4gICAgLy8gICAgICAgIG0uc2V0KHtcbiAgICAvLyAgICAgICAgICAgICdjaGVja2VkJzogbS5nZXQoJ3RpdGxlJykgPT09ICh0aGlzLm9wdGlvbnMuVmlzdWFsaXphdGlvbiB8fCBcImJhclwiKSxcbiAgICAvLyAgICAgICAgICAgIHByZWZpeDogdGhpcy5vcHRpb25zLnByZWZpeFxuICAgIC8vICAgICAgICB9KTtcbiAgICAvLyAgICB9LFxuXG4gICAgLy8gICAgb25SZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgICAgdGhpcy4kZWwud2lkdGgodGhpcy5jb2xsZWN0aW9uLmxlbmd0aCAqIDI0NSk7XG4gICAgLy8gICAgfSxcblxuICAgIC8vICAgIGNoaWxkVmlld1RyaWdnZXJzOiB7XG4gICAgLy8gICAgICAgICdjaG9vc2U6dHlwZTpjaGFydCc6ICdjaG9vc2U6dHlwZTpjaGFydCdcbiAgICAvLyAgICB9XG4gICAgLy99KTtcblxuICAgIHZhciBmb3JtVmlldyA9IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBiZWhhdmlvcnM6IHtcbiAgICAgICAgICAgIGlucHV0OiBpbnB1dEJlaGF2aW9yXG4gICAgICAgIH0sXG5cbiAgICAgICAgdGVtcGxhdGU6ICcjdmlzdWFsLXNldHRpbmdzLXRlbXBsYXRlJyxcbiAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7XG4gICAgICAgICAgICBSZXNvdXJjZXM6IFJlc291cmNlc1xuICAgICAgICB9LFxuXG4gICAgICAgIHVpOiB7XG4gICAgICAgICAgICBjb2x3OiAnI2NvbHVtbldpZHRoJyxcbiAgICAgICAgICAgIGNvbHM6ICcjY29sdW1uU3BhY2luZycsXG4gICAgICAgICAgICBwc2l6ZTogJyNwaWVTaXplJ1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIGxlZ2VuZFBvc2l0aW9uOiB7IGVsOiAnI2xlZ2VuZFBvc2l0aW9uJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIGF4ZXNYbGFiZWxBY3Rpb246IHsgZWw6ICcjYXhlc1hsYWJlbEFjdGlvbicsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgfSxcblxuICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgJ2NoYW5nZSBAdWkuY29sdyc6IGZ1bmN0aW9uIGNoYW5nZVVpQ29sdygpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMudWkuY29sdy5uZXh0KCdsYWJlbCcpLmZpbmQoJ3NwYW4nKS50ZXh0KHRoaXMudWkuY29sdy52YWwoKSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnY2hhbmdlIEB1aS5jb2xzJzogZnVuY3Rpb24gY2hhbmdlVWlDb2xzKCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5jb2xzLm5leHQoJ2xhYmVsJykuZmluZCgnc3BhbicpLnRleHQodGhpcy51aS5jb2xzLnZhbCgpKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdjaGFuZ2UgQHVpLnBzaXplJzogZnVuY3Rpb24gY2hhbmdlVWlQc2l6ZSgpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMudWkucHNpemUubmV4dCgnbGFiZWwnKS5maW5kKCdzcGFuJykudGV4dCh0aGlzLnVpLnBzaXplLnZhbCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbGVnZW5kUG9zaXRpb24nLCBuZXcgZHJvcERvd24oe1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFt7IGlkOiAnTGVmdCcsIHRpdGxlOiBSZXNvdXJjZXMudnMzM2xlZnQgfSwgeyBpZDogJ1RvcCcsIHRpdGxlOiBSZXNvdXJjZXMudnMzM3RvcCB9LCB7IGlkOiAnUmlnaHQnLCB0aXRsZTogUmVzb3VyY2VzLnZzMzNyaWdodCB9LCB7IGlkOiAnQm90dG9tJywgdGl0bGU6IFJlc291cmNlcy52czMzYm90dG9tIH1dKVxuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnbGVnZW5kUG9zaXRpb24nKS5zZXRDdXJyZW50KHRoaXMubW9kZWwuZ2V0KCdsZWdlbmRQb3NpdGlvbicpKS4kZWwuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnY2hhcnQnKSAhPT0gJ3BpZScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2F4ZXNYbGFiZWxBY3Rpb24nLCBuZXcgZHJvcERvd24oe1xuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uOiBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbihbeyBpZDogJ25vbmUnLCB0aXRsZTogJ05vbmUgLSAnICsgUmVzb3VyY2VzLmxwYTEgfSwgeyBpZDogJ3JvdGF0ZTkwJywgdGl0bGU6ICdSb3RhdGUgOTAgLSAnICsgUmVzb3VyY2VzLmxwYTIgfSwgeyBpZDogJ3JvdGF0ZTQ1JywgdGl0bGU6ICdSb3RhdGUgNDUgLSAnICsgUmVzb3VyY2VzLmxwYTMgfSwgeyBpZDogJ3dyYXAnLCB0aXRsZTogJ1dyYXAgLSAnICsgUmVzb3VyY2VzLmxwYTQgfSwgeyBpZDogJ3dyYXBCeVdvcmQnLCB0aXRsZTogJ1dyYXAgYnkgd29yZCAtICcgKyBSZXNvdXJjZXMubHBhNSB9LCB7IGlkOiAndHJpbScsIHRpdGxlOiAnVHJpbSAtICcgKyBSZXNvdXJjZXMubHBhNiB9LCB7IGlkOiAnaGlkZScsIHRpdGxlOiAnSGlkZSAtICcgKyBSZXNvdXJjZXMubHBhNyB9LCB7IGlkOiAnbXVsdGlwbGVSb3dzJywgdGl0bGU6ICdNdWx0aXBsZVJvd3MgLSAnICsgUmVzb3VyY2VzLmxwYTggfV0pXG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2F4ZXNYbGFiZWxBY3Rpb24nKS5zZXRDdXJyZW50KHRoaXMubW9kZWwuZ2V0KCdwcmltYXJ5WEF4aXNsYWJlbEludHJzZWN0QWN0aW9uJykpLiRlbC5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy4kKCcjJyArIHRoaXMubW9kZWwuZ2V0KCdwcmVmaXgnKSArICdfbGVnZW5kQm9yZGVyQ29sb3InKS5lakNvbG9yUGlja2VyKHtcbiAgICAgICAgICAgICAgICBsb2NhbGU6IFJlc291cmNlcy5MYW5nLFxuICAgICAgICAgICAgICAgIG1vZGVsVHlwZTogXCJwYWxldHRlXCIsXG4gICAgICAgICAgICAgICAgcHJlc2V0VHlwZTogXCJ3ZWJjb2xvcnNcIixcbiAgICAgICAgICAgICAgICBlbmFibGVPcGFjaXR5OiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbW9kZWxFdmVudHM6IHtcblxuICAgICAgICAgICAgJ2NoYW5nZTpjaGFydCc6IGZ1bmN0aW9uIGNoYW5nZUNoYXJ0KCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8aDMgY2xhc3M9XCJsaW5rXCIgaWQ9XCJjaGFuZ2UtZmFjZVwiPjwlLSBSZXNvdXJjZXMuY3RkICU+PC9oMz48YnIvPjxkaXYgY2xhc3M9XCJmYWNlLWNob29zZVwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPjwvZGl2PjxkaXYgY2xhc3M9XCJmYWNlLWZvcm1cIj48ZGl2IGNsYXNzPVwiZm9ybVwiPjwvZGl2PjxoMz48JS0gUmVzb3VyY2VzLnZzOCAlPjwvaDM+PGRpdiBpZD1cImNvbG9yLXNldHRpbmdzXCI+PC9kaXY+PC9kaXY+JyksXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgZmFjZTogJyNjaGFuZ2UtZmFjZScsXG4gICAgICAgICAgICBjaG9vc2U6ICcuZmFjZS1jaG9vc2UnLFxuICAgICAgICAgICAgZm9ybTogJy5mYWNlLWZvcm0nXG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgLy9saXN0OiAnLmNoYXJ0cy1nYWxsZXJ5JyxcbiAgICAgICAgICAgIGZvcm06IHsgZWw6ICcuZm9ybScsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICBjb2xvcjogeyBlbDogJyNjb2xvci1zZXR0aW5ncycsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICBmYWNlOiAnLmZhY2UtY2hvb3NlJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICAnY2xpY2sgQHVpLmZhY2UnOiBmdW5jdGlvbiBjbGlja1VpRmFjZSgpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnVpLmNob29zZS5pcyhcIjpoaWRkZW5cIikpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmZhY2UudGV4dChSZXNvdXJjZXMuYmFjayk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkuZm9ybS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudWkuY2hvb3NlLnNob3coKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZ2V0UmVnaW9uKCdmYWNlJykuaGFzVmlldygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2ZhY2UnLCBuZXcgdmlzdWFsVmlldyh7IG1vZGVsOiB0aGlzLm1vZGVsLCBydWxlQ29kZTogJ2FueScgfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2ZhY2UnKS4kZWwucmVtb3ZlQ2xhc3MoJ3Nob3cnKS5hZGRDbGFzcygndmlzdWFsaXNhdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmZhY2UudGV4dChSZXNvdXJjZXMuY3RkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5mb3JtLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5jaG9vc2UuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHZhciBwID0gXy5maW5kV2hlcmUodGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCB7IFdpZGdldFBhcmFtTmFtZTogdGhpcy5tb2RlbC5nZXQoJ3R5cGVOYW1lJykgKyBcIi5HaGFwaFN1YlNldHRpbmdzXCIgfSk7XG5cbiAgICAgICAgICAgIHZhciBtb2RlbCA9IG5ldyBzdWJTZXR0aW5ncygpO1xuICAgICAgICAgICAgaWYgKHApIG1vZGVsLnNldChwLldpZGdldFBhcmFtVmFsdWUpO1xuXG4gICAgICAgICAgICBtb2RlbC5zZXQoe1xuICAgICAgICAgICAgICAgIHByZWZpeDogdGhpcy5tb2RlbC5pZCxcbiAgICAgICAgICAgICAgICBjaGFydDogdGhpcy5tb2RlbC5nZXQoXCJWaXN1YWxpemF0aW9uXCIpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdmb3JtJywgbmV3IGZvcm1WaWV3KHsgbW9kZWw6IG1vZGVsIH0pKTtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdjb2xvcicsIG5ldyBjb2xvclJvdyh7IG1vZGVsOiB0aGlzLm1vZGVsLCBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24gfSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uU2hvdzogZnVuY3Rpb24gb25TaG93KCkge30sXG5cbiAgICAgICAgY2hpbGRWaWV3RXZlbnRzOiB7XG5cbiAgICAgICAgICAgICdjaGFydDpzZWxlY3RlZCc6IGZ1bmN0aW9uIGNoYXJ0U2VsZWN0ZWQodikge1xuXG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB2Lm1vZGVsLmdldCgndHlwZScpO1xuICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KFwiVmlzdWFsaXphdGlvblwiLCBuYW1lKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnZm9ybScpLm1vZGVsLnNldCgnY2hhcnQnLCBuYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZSgpIHtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSAkLkdldERhdGEodGhpcy4kZWwpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5nZXRDaGlsZFZpZXcoJ2Zvcm0nKS5nZXRSZWdpb24oJ2F4ZXNYbGFiZWxBY3Rpb24nKS5oYXNWaWV3KCkpIGRhdGEucHJpbWFyeVhBeGlzbGFiZWxJbnRyc2VjdEFjdGlvbiA9IHRoaXMuZ2V0Q2hpbGRWaWV3KCdmb3JtJykuZ2V0Q2hpbGRWaWV3KCdheGVzWGxhYmVsQWN0aW9uJykuY3VycmVudC5pZDtcblxuICAgICAgICAgICAgZGF0YS5sZWdlbmRQb3NpdGlvbiA9IHRoaXMuZ2V0Q2hpbGRWaWV3KCdmb3JtJykuZ2V0Q2hpbGRWaWV3KCdsZWdlbmRQb3NpdGlvbicpLmN1cnJlbnQuaWQ7XG5cbiAgICAgICAgICAgIHZhciBjaCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2NoVycpLFxuICAgICAgICAgICAgICAgIHAxID0gY2gucmVxdWVzdCgnZ2V0OnBhcmFtOm1vZGVsJywgdGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCBcIldpZGdldEdyYXBoLkdoYXBoU3ViU2V0dGluZ3NcIiksXG4gICAgICAgICAgICAgICAgcDIgPSBjaC5yZXF1ZXN0KCdnZXQ6cGFyYW06bW9kZWwnLCB0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksICdQYWxldHRlQnlDaGFydCcpO1xuXG4gICAgICAgICAgICBwMS5zZXQoJ1dpZGdldFBhcmFtVmFsdWUnLCBkYXRhKTtcbiAgICAgICAgICAgIHAyLnNldCgnV2lkZ2V0UGFyYW1WYWx1ZScsIHRoaXMuZ2V0Q2hpbGRWaWV3KCdjb2xvcicpLmdldENoaWxkVmlldygnbGlzdCcpLmNvbGxlY3Rpb24udG9KU09OKCkpO1xuXG4gICAgICAgICAgICB2YXIgc2F2ZUNvbGxlY3Rpb24gPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdjaFcnKS5yZXF1ZXN0KCdnZXQ6cGFyYW1zOmNvbGxlY3Rpb24nLCB0aGlzLm1vZGVsLmlkKTtcbiAgICAgICAgICAgIHNhdmVDb2xsZWN0aW9uLmFkZChbcDEsIHAyXSk7XG5cbiAgICAgICAgICAgIHNhdmVDb2xsZWN0aW9uLmZldGNoKHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoeyBDaGFyYWN0ZXJpc3RpY3M6IG0udG9KU09OKCkgfSk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3NldHRpbmdzLnZpc3VhbGl6YXRpb24uY2xvdWQnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnc2V0dGluZ3MuY29sb3JSb3cnLCAnZ2xvYmFsLnZpZXcuZHJvcERvd24nLCAnZ2xvYmFsLmJlaGF2aW9ycy5pbnB1dCddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCBjb2xvclJvdywgZHJvcERvd24sIGlucHV0QmVoYXZpb3IpIHtcblxuICAgICAgICB2YXIgZm9ybVZpZXcgPSBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICBiZWhhdmlvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBpbnB1dEJlaGF2aW9yXG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnI2Nsb3VkLWZvcm0tdGVtcGxhdGUnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGU6IHsgZWw6ICcjY2xvdWQtc2hhcGUnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uQmVmb3JlUmVuZGVyOiBmdW5jdGlvbiBvbkJlZm9yZVJlbmRlcigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmhhcygnc2hhcGVDbG91ZCcpKSB0aGlzLm1vZGVsLnNldCgnc2hhcGVDbG91ZCcsICdlbGxpcHRpYycpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnc2hhcGUnLCBuZXcgZHJvcERvd24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uOiBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbihbeyBpZDogJ2VsbGlwdGljJywgdGl0bGU6IFJlc291cmNlcy5jc2UgfSwgeyBpZDogJ3JlY3Rhbmd1bGFyJywgdGl0bGU6IFJlc291cmNlcy5jc3IgfV0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdzaGFwZScpLnNldEN1cnJlbnQodGhpcy5tb2RlbC5nZXQoJ3NoYXBlQ2xvdWQnKSkuJGVsLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICcjY2xvdWQtc2V0dGluZ3MtdGVtcGxhdGUnLFxuXG4gICAgICAgICAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHsgZWw6ICcjY29sb3Itcm93cycsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtOiB7IGVsOiAnI2Zvcm0tc2V0dGluZ3MnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBfLmZpbmRXaGVyZSh0aGlzLm1vZGVsLmdldCgnQ2hhcmFjdGVyaXN0aWNzJyksIHsgV2lkZ2V0UGFyYW1OYW1lOiBcIldpZGdldENsb3VkLlN1YlNldHRpbmdzXCIgfSkgfHwge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IG5ldyBCYWNrYm9uZS5Nb2RlbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbkZvbnRTaXplQ2xvdWQ6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhGb250U2l6ZUNsb3VkOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFwZUNsb3VkOiAnZWxsaXB0aWMnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHApIG0uc2V0KHAuV2lkZ2V0UGFyYW1WYWx1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnZm9ybScsIG5ldyBmb3JtVmlldyh7IG1vZGVsOiBtIH0pKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdjb2xvcicsIG5ldyBjb2xvclJvdyh7IG1vZGVsOiB0aGlzLm1vZGVsLCBjb2xsZWN0aW9uOiB0aGlzLmNvbGxlY3Rpb24gfSkpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uRXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblJlc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgb25TYXZlOiBmdW5jdGlvbiBvblNhdmUoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2NoVycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAxID0gY2gucmVxdWVzdCgnZ2V0OnBhcmFtOm1vZGVsJywgdGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCBcIldpZGdldENsb3VkLlN1YlNldHRpbmdzXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAyID0gY2gucmVxdWVzdCgnZ2V0OnBhcmFtOm1vZGVsJywgdGhpcy5tb2RlbC5nZXQoJ0NoYXJhY3RlcmlzdGljcycpLCAnUGFsZXR0ZUJ5Q2hhcnQnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gJC5HZXREYXRhKHRoaXMuZ2V0Q2hpbGRWaWV3KCdmb3JtJykuJGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLnNoYXBlQ2xvdWQgPSB0aGlzLmdldENoaWxkVmlldygnZm9ybScpLmdldENoaWxkVmlldygnc2hhcGUnKS5jdXJyZW50LmlkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwMS5zZXQoJ1dpZGdldFBhcmFtVmFsdWUnLCBmb3JtRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwMi5zZXQoJ1dpZGdldFBhcmFtVmFsdWUnLCB0aGlzLmdldENoaWxkVmlldygnY29sb3InKS5nZXRDaGlsZFZpZXcoJ2xpc3QnKS5jb2xsZWN0aW9uLnRvSlNPTigpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNhdmVDb2xsZWN0aW9uID0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnY2hXJykucmVxdWVzdCgnZ2V0OnBhcmFtczpjb2xsZWN0aW9uJywgdGhpcy5tb2RlbC5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29sbGVjdGlvbi5hZGQoW3AxLCBwMl0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29sbGVjdGlvbi5mZXRjaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHsgQ2hhcmFjdGVyaXN0aWNzOiBtLnRvSlNPTigpIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvblJlc2V0OiBmdW5jdGlvbiBvblJlc2V0KCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IF8uZmluZFdoZXJlKHRoaXMubW9kZWwuZ2V0KCdDaGFyYWN0ZXJpc3RpY3MnKSwgeyBXaWRnZXRQYXJhbU5hbWU6ICdQYWxldHRlQnlDaGFydCcgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwKSBfLmVhY2gocC5XaWRnZXRQYXJhbVZhbHVlLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuY29sbGVjdGlvbi5maW5kV2hlcmUoeyBvYmplY3RfaWQ6IG8ub2JqZWN0X2lkIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkgZS5zZXQoJ2NvbG9yJywgby5jb2xvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnc2V0dGluZ3MudmlzdWFsaXNhdGlvbi50YWJsZS5jb2x1bW4nLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nXSwgZnVuY3Rpb24gKFJlc291cmNlcykge1xuXG4gICAgICAgIHZhciBjb2x1bW5zQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHtcbiAgICAgICAgICAgICAgICBtb2RlbDogQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkQXR0cmlidXRlOiBcIkNvbHVtblN5c3RlbU5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFF1ZXJ5Q3VzdG9taXphdGlvblVJRDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUXVlcnlJRDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29sdW1uU3lzdGVtTmFtZTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29sdW1uVGl0bGU6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbHVtbldpZHRoOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2x1bW5Jc1Zpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlcmlhbE51bTogJydcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gTW4uQ29sbGVjdGlvblZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2xpc3QtYXJlYScsXG5cbiAgICAgICAgICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NsaWNrJzogZnVuY3Rpb24gY2xpY2soZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBjaGlsZFZpZXc6IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAncm93JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnI2NvbHVtbi1zZXR0aW5ncy10ZW1wbGF0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYXR0cignaWQnLCB0aGlzLm1vZGVsLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pLFxuXG4gICAgICAgICAgICAgICAgY2hpbGRWaWV3T3B0aW9uczogZnVuY3Rpb24gY2hpbGRWaWV3T3B0aW9ucyhtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUXVlcnlJRDogdGhpcy5tb2RlbC5nZXQoXCJyZXF1ZXN0UGFyYW1ldGVyc1wiKS5yaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWZpeDogdGhpcy5tb2RlbC5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUobykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBuZXcgY29sdW1uc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5jb21wYXJhdG9yID0gXCJTZXJpYWxOdW1cIjtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgb25CZWZvcmVSZW5kZXI6IGZ1bmN0aW9uIG9uQmVmb3JlUmVuZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLm1vZGVsLmhhcygnZmVlZCcpID8gdGhpcy5tb2RlbC5nZXQoJ2ZlZWQnKS5oZWFkIDogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlkID0gdGhpcy5tb2RlbC5nZXQoXCJyZXF1ZXN0UGFyYW1ldGVyc1wiKSA/IHRoaXMubW9kZWwuZ2V0KFwicmVxdWVzdFBhcmFtZXRlcnNcIikucmlkIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b20gPSB0aGlzLm1vZGVsLmdldChcIkNvbHVtbkN1c3RvbWl6YXRpb25zXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1ucyA9IF8ubWFwKGl0ZW1zLCBmdW5jdGlvbiAoZSwgaSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VzdG9tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2kgPSBfLmZpbmRXaGVyZShjdXN0b20sIHsgQ29sdW1uU3lzdGVtTmFtZTogZS5zeXN0ZW1OYW1lIH0pIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbGxlY3Rpb24ubW9kZWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFF1ZXJ5Q3VzdG9taXphdGlvblVJRDogY2kuUXVlcnlDdXN0b21pemF0aW9uVUlEIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUXVlcnlJRDogcmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbHVtblN5c3RlbU5hbWU6IGUuc3lzdGVtTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2x1bW5UaXRsZTogY2kuQ29sdW1uVGl0bGUgfHwgZS5kaXNwbGF5TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2x1bW5Jc1Zpc2libGU6IGNpLkNvbHVtbklzVmlzaWJsZSA9PT0gdW5kZWZpbmVkID8gZS5pc1Zpc2libGUgOiBjaS5Db2x1bW5Jc1Zpc2libGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VyaWFsTnVtOiBjaS5TZXJpYWxOdW0gfHwgaSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2x1bW5XaWR0aDogY2kuQ29sdW1uV2lkdGggfHwgJydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLnNldChjb2x1bW5zKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgb25BZGRDaGlsZDogZnVuY3Rpb24gb25BZGRDaGlsZCgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuc29ydGFibGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogJy5yb3cnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKGUsIHVpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQoXCIucm93XCIpLmVhY2goZnVuY3Rpb24gKGksIGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlID0gJChlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gdGhpcy5jb2xsZWN0aW9uLmdldCgkZS5hdHRyKCdpZCcpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5zZXQoXCJTZXJpYWxOdW1cIiwgJGUuaW5kZXgoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5maW5kKCdpbnB1dFtuYW1lPVNlcmlhbE51bV0nKS52YWwoJGUuaW5kZXgoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZShjYWxsYmFjaykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCcucm93JykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCgkLkdldERhdGEoJCh0aGlzKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvd2lkZ2V0L1wiICsgdGhpcy5tb2RlbC5nZXQoXCJyZXF1ZXN0UGFyYW1ldGVyc1wiKS5yaWQgKyBcIi9jb2xzY3VzdG9taXphdGlvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkYXRhKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChjKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLCBjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uUmVzZXQ6IGZ1bmN0aW9uIG9uUmVzZXQoY2FsbGJhY2spIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLnJlc2V0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQuZ2V0KFwiL2FwaS93aWRnZXQvXCIgKyB0aGlzLm1vZGVsLmdldChcInJlcXVlc3RQYXJhbWV0ZXJzXCIpLnJpZCArIFwiL2NvbHNjdXN0b21pemF0aW9uL2ZsdXNoXCIpLmRvbmUoZnVuY3Rpb24gKGMpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnc2V0dGluZ3MudmlzdWFsaXNhdGlvbi50YWJsZS5maWVsZHMnLCBbXSwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPGltZyAgY2xhc3MgPSBcImNhcmQtZXhhbXBsZVwiIHNyYyA9IFwiXCIgLz4nKSxcbiAgICAgICAgICAgICAgICAvL2lmKGNhcmQpIHtzcmMgPSAnLi4vLi4vSW1hZ2VzL3ZlcnRpY2FsX2NhcmQucG5nJ31cbiAgICAgICAgICAgICAgICAvL2lmKGNhcmQyKSB7c3JjID0gJy4uLy4uL0ltYWdlcy9ob3Jpem9udGFsX2NhcmQucG5nJ31cblxuICAgICAgICAgICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ2NvbnRhaW5lci1leGFtcGxlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnVmlzdWFsaXphdGlvbicpID09PSAnY2FyZCcpIHRoaXMuJCgnaW1nJykuYXR0cignc3JjJywgJy4uLy4uL0ltYWdlcy92ZXJ0aWNhbF9jYXJkLnBuZycpO2Vsc2UgdGhpcy4kKCdpbWcnKS5hdHRyKCdzcmMnLCAnLi4vLi4vSW1hZ2VzL2hvcml6b250YWxfY2FyZC5wbmcnKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgb25TYXZlOiBmdW5jdGlvbiBvblNhdmUoY2FsbGJhY2spIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3NldHRpbmdzLnZpc3VhbGl6YXRpb24udGFibGUnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnc2V0dGluZ3MudmlzdWFsaXNhdGlvbi50YWJsZS5jb2x1bW4nLCAnc2V0dGluZ3MudmlzdWFsaXNhdGlvbi50YWJsZS5maWVsZHMnLCAnZ2xvYmFsLmJlaGF2aW9ycy5pbnB1dCddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCBjb2x1bW5zT3JnLCBmaWVsZE9yZywgaW5wdXQpIHtcblxuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogY29sdW1uc09yZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcmQ6IGZpZWxkT3JnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FyZDI6IGZpZWxkT3JnXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBiZWhhdmlvcnM6IFtpbnB1dF0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnI3RhYmxlLXZpc3VhbGlzYXRpb24tdGVtcGxhdGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVDb250ZXh0OiBmdW5jdGlvbiB0ZW1wbGF0ZUNvbnRleHQoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IHRoaXMubW9kZWwuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7IGVsOiAnI2NvbnRlbnQnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsaWNrIGlucHV0JzogZnVuY3Rpb24gY2xpY2tJbnB1dChtLCB2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gdGhpcy4kKCdpbnB1dFtuYW1lPVwiVmlzdWFsaXphdGlvblwiXTpjaGVja2VkJykuYXR0cignaWQnKS5zcGxpdCgnXycpWzFdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgnVmlzdWFsaXphdGlvbicsIG5hbWUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFJlZ2lvbignY29udGVudCcpLnNob3cobmV3IGNvbnRlbnRbbmFtZV0oeyBtb2RlbDogdGhpcy5tb2RlbCB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uU2hvdzogZnVuY3Rpb24gb25TaG93KCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHRoaXMubW9kZWwuZ2V0KCdWaXN1YWxpemF0aW9uJykgfHwgJ3RhYmxlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJCgnIycgKyB0aGlzLm1vZGVsLmlkICsgJ18nICsgbmFtZSkucHJvcCgnY2hlY2tlZCcsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFJlZ2lvbignY29udGVudCcpLnNob3cobmV3IGNvbnRlbnRbbmFtZV0oeyBtb2RlbDogdGhpcy5tb2RlbCB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZSgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ2NvbnRlbnQnKS5vblNhdmUoZnVuY3Rpb24gKGMpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHsgQ29sdW1uQ3VzdG9taXphdGlvbnM6IGMgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uUmVzZXQ6IGZ1bmN0aW9uIG9uUmVzZXQoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdjb250ZW50Jykub25SZXNldChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KFwiQ29sdW1uQ3VzdG9taXphdGlvbnNcIiwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsRXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFuZ2U6ZmVlZCc6IGZ1bmN0aW9uIGNoYW5nZUZlZWQobSwgZmVlZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHRoaXMubW9kZWwuZ2V0KCdWaXN1YWxpemF0aW9uJykgfHwgJ3RhYmxlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVnaW9uKCdjb250ZW50Jykuc2hvdyhuZXcgY29udGVudFtuYW1lXSh7IG1vZGVsOiB0aGlzLm1vZGVsIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnc2V0dGluZ3MudmlzdWFsaXphdGlvbi5zZW1uZXQnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnZ2xvYmFsLnZpZXcuZHJvcERvd24nXSwgZnVuY3Rpb24gKFJlc291cmNlcywgRHJvcERvd25WaWV3KSB7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiAnI3NlbW5ldC1zZXR0aW5ncy10ZW1wbGF0ZScsXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDoge1xuICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXNcbiAgICAgICAgfSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBkZGxldmVsOiAnI2xldmVsJyxcbiAgICAgICAgICAgIGRkdHJlZTogJyNhc3RyZWUnLFxuICAgICAgICAgICAgZGRsYXlvdXQ6ICcjbGF5b3V0J1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdkZGxheW91dCcsIG5ldyBEcm9wRG93blZpZXcoe1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKFt7IHRpdGxlOiBSZXNvdXJjZXMuc25sMSwgaWQ6IDAgfSwgeyB0aXRsZTogUmVzb3VyY2VzLnNubDIsIGlkOiAxIH0sIHsgdGl0bGU6IFJlc291cmNlcy5zbmwzLCBpZDogMiB9LCB7IHRpdGxlOiBSZXNvdXJjZXMuc25sNCwgaWQ6IDMgfSwgeyB0aXRsZTogUmVzb3VyY2VzLnNubDUsIGlkOiA0IH0sIHsgdGl0bGU6IFJlc291cmNlcy5zbmw2LCBpZDogNSB9LCB7IHRpdGxlOiBSZXNvdXJjZXMuc25sNywgaWQ6IDYgfV0pLFxuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHRoaXMubW9kZWwuZ2V0KCdsYXlvdXQnKSwgbmFtZTogJ2xheW91dCdcbiAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdkZHRyZWUnLCBuZXcgRHJvcERvd25WaWV3KHtcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uOiBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbihbeyB0aXRsZTogUmVzb3VyY2VzLnNzMSwgaWQ6IDAgfSwgeyB0aXRsZTogUmVzb3VyY2VzLnNzMiwgaWQ6IDEgfSwgeyB0aXRsZTogUmVzb3VyY2VzLnNzMywgaWQ6IDIgfV0pLFxuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHRoaXMubW9kZWwuZ2V0KCdhc3RyZWUnKSwgbmFtZTogJ2FzdHJlZSdcbiAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdkZGxldmVsJywgbmV3IERyb3BEb3duVmlldyh7XG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbjogbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oW3sgdGl0bGU6ICdsZXZlbCAxJywgaWQ6IDEgfSwgeyB0aXRsZTogJ2xldmVsIDInLCBpZDogMiB9LCB7IHRpdGxlOiAnbGV2ZWwgMycsIGlkOiAzIH1dKSxcbiAgICAgICAgICAgICAgICBjdXJyZW50OiB0aGlzLm1vZGVsLmdldCgnbGV2ZWwnKSwgbmFtZTogJ2xldmVsJ1xuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5oYXMoJ1NOTGV2ZWwnKSkgdGhpcy5nZXRDaGlsZFZpZXcoJ2RkbGV2ZWwnKS5zZXRDdXJyZW50KHRoaXMubW9kZWwuZ2V0KCdTTkxldmVsJykpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5oYXMoJ1NOTGF5b3V0JykpIHRoaXMuZ2V0Q2hpbGRWaWV3KCdkZGxheW91dCcpLnNldEN1cnJlbnQodGhpcy5tb2RlbC5nZXQoJ1NOTGF5b3V0JykpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5oYXMoJ1NOU3RydWN0JykpIHRoaXMuZ2V0Q2hpbGRWaWV3KCdkZHRyZWUnKS5zZXRDdXJyZW50KHRoaXMubW9kZWwuZ2V0KCdTTlN0cnVjdCcpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZSgpIHtcblxuICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJC5HZXREYXRhKHRoaXMuJGVsKSk7XG5cbiAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7XG4gICAgICAgICAgICAgICAgU05MZXZlbDogdGhpcy5nZXRDaGlsZFZpZXcoJ2RkbGV2ZWwnKS5jdXJyZW50LmlkLFxuICAgICAgICAgICAgICAgIFNOTGF5b3V0OiB0aGlzLmdldENoaWxkVmlldygnZGRsYXlvdXQnKS5jdXJyZW50LmlkLFxuICAgICAgICAgICAgICAgIFNOU3RydWN0OiB0aGlzLmdldENoaWxkVmlldygnZGR0cmVlJykuY3VycmVudC5pZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZXNldDogZnVuY3Rpb24gb25SZXNldCgpIHt9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCd3aWRnZXRUYWJsZUNhcmQnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nXSwgZnVuY3Rpb24gKFJlc291cmNlcykge1xuXG4gICAgdmFyIGxpc3QgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNsYXNzTmFtZTogJ2NhcmQtbmV3c2Jsb2NrJyxcblxuICAgICAgICBjaGlsZFZpZXc6IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgdGFnTmFtZTogJ2FydGljbGUnLFxuXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdjYXJkLXZlcnRpY2FsJyxcblxuICAgICAgICAgICAgLy8vKmdldFRlbXBsYXRlOiBmdW5jdGlvbiAoKSB7Ki9cbiAgICAgICAgICAgIC8vICAgIHJldHVybiAnI2NhcmQtdmVydGljYWwtdmlldy10ZW1wbGF0ZSc7XG4gICAgICAgICAgICAvL30sXG4gICAgICAgICAgICBnZXRUZW1wbGF0ZTogZnVuY3Rpb24gZ2V0VGVtcGxhdGUoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52aXMgPT09ICdjYXJkMicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcjY2FyZC1ob3Jpem9udGFsLXZpZXctdGVtcGxhdGUnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAnI2NhcmQtdmVydGljYWwtdmlldy10ZW1wbGF0ZSc7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHtcbiAgICAgICAgICAgICAgICBSZXNvdXJjZXM6IFJlc291cmNlc1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAnY2xpY2sgYSc6IGZ1bmN0aW9uIGNsaWNrQShlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgICAgICd0b3VjaHN0YXJ0JzogJ3RhYmxlOnJvdzpoYW5kbGVyJyxcbiAgICAgICAgICAgICAgICAnY2xpY2snOiAndGFibGU6cm93OmhhbmRsZXInXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvbkJlZm9yZVJlbmRlcjogZnVuY3Rpb24gb25CZWZvcmVSZW5kZXIoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnZpcyA9PT0gJ2NhcmQyJykgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2NhcmQtdmVydGljYWwnKS5hZGRDbGFzcygnY2FyZC1ob3Jpem9udGFsJyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMubW9kZWwudG9KU09OKCksXG4gICAgICAgICAgICAgICAgICAgIHBkYXRlID0gRGF0ZS5wYXJzZShpdGVtLtC00LDRgtCwX9C/0YPQsdC70LjQutCw0YbQuNC4KSA/IG5ldyBEYXRlKGl0ZW0u0LTQsNGC0LBf0L/Rg9Cx0LvQuNC60LDRhtC40LgpLnRvTG9jYWxlU3RyaW5nKFJlc291cmNlcy5MYW5nKSA6ICcnO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoe1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5X25hbWU6IHRoaXMubW9kZWwuZ2V0KCdkaXNwbGF5X25hbWUnKSB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IGl0ZW0uaW1hZ2UgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgIHVybDogaXRlbS51cmxf0LjRgdGC0L7Rh9C90LjQutCwIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICBwZGF0ZTogcGRhdGUsXG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb246IGl0ZW0u0LDQvdC90L7RgtCw0YbQuNGPLFxuICAgICAgICAgICAgICAgICAgICBtYXNzbWVkaWE6IGl0ZW0ubWFzc21lZGlhLFxuICAgICAgICAgICAgICAgICAgICBydWJyaWNzOiAnJ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuaGFzKCdsaW5rcycpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBfLmdyb3VwQnkodGhpcy5tb2RlbC5nZXQoJ2xpbmtzJyksICdyZWwnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoXy5oYXMoYSwgJ3J1YnJpY19pZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdnMgPSBfLnBsdWNrKGEucnVicmljX2lkLCAndmFsdWUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdydWJyaWNzJywgdnMuam9pbignIHwgJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKF8uaGFzKGEsICd1cmxf0LjRgdGC0L7Rh9C90LjQutCwJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBocmVmID0gYS51cmxf0LjRgdGC0L7Rh9C90LjQutCwWzBdLmhyZWY7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7IHVybDogaHJlZiwgbWFzc21lZGlhOiB0aGlzLm1vZGVsLmdldCgnbWFzc21lZGlhJykgPyB0aGlzLm1vZGVsLmdldCgnbWFzc21lZGlhJykgOiBocmVmIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSxcblxuICAgICAgICBvbkJlZm9yZVJlbmRlcjogZnVuY3Rpb24gb25CZWZvcmVSZW5kZXIoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnZpcyA9PT0gJ2NhcmQyJykgdGhpcy4kZWwuYWRkQ2xhc3MoJ2hvcml6b250YWwnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdPcHRpb25zOiBmdW5jdGlvbiBjaGlsZFZpZXdPcHRpb25zKCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB2aXM6IHRoaXMub3B0aW9ucy52aXNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hpbGRWaWV3VHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICd0YWJsZTpyb3c6aGFuZGxlcic6ICd0YWJsZTpyb3c6aGFuZGxlcidcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8ZGl2PjwvZGl2PicpLFxuICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHtcbiAgICAgICAgICAgIFJlc291cmNlczogUmVzb3VyY2VzXG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgbGlzdDogeyBlbDogJ2RpdicsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblJlbmRlcjogZnVuY3Rpb24gb25SZW5kZXIoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygnbGlzdCcsIG5ldyBsaXN0KHsgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uLCB2aXM6IHRoaXMubW9kZWwuZ2V0KCdWaXN1YWxpemF0aW9uJykgfSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2hpbGR2aWV3VGFibGVSb3dIYW5kbGVyOiBmdW5jdGlvbiBvbkNoaWxkdmlld1RhYmxlUm93SGFuZGxlcih2KSB7XG5cbiAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcignY2xpY2s6aXRlbScsIHYubW9kZWwpO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCd3aWRnZXQudGFibGUuZmlsdGVyJywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJ10sIGZ1bmN0aW9uIChSZXNvdXJjZXMpIHtcblxuICAgICAgICB2YXIgbGlzdFJ1YnJpY3MgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICAgICAgZW1wdHlWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPHA+PCUtIFJlc291cmNlcy5ub3J1YnJpYyAlPjwvcD4nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlQ29udGV4dDogeyBSZXNvdXJjZXM6IFJlc291cmNlcyB9XG4gICAgICAgICAgICAgICAgfSksXG5cbiAgICAgICAgICAgICAgICBjaGlsZFZpZXc6IE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGFnTmFtZTogJ3NwYW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZy1mb3JtLS1pbnB1dCcsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8aW5wdXQgY2xhc3M9XCJnLWZvcm0tLWNoZWNrYm94XCIgdHlwZT1cImNoZWNrYm94XCIgY2hlY2tlZCBpZD1cIjwlLSB2YWx1ZSAlPlwiIG5hbWU9XCI8JS0gdmFsdWUgJT5cIiAvPjxsYWJlbCBmb3I9XCI8JS0gdmFsdWUgJT5cIj48JS0gdmFsdWUgJT48L2xhYmVsPicpLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB1aToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGJ4OiAnaW5wdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xpY2snOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6ICdjbGljazppdGVtJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFByb3BhZ2F0aW9uOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSksXG5cbiAgICAgICAgICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2NsaWNrOml0ZW0nOiAnZmlsdGVyOmFwcGx5J1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2ZpbHRlci1wYW5lbCBhbmJyLXRhYnMnLFxuXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlc1snZmlsdGVyLXBhbmVsJ10sXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVDb250ZXh0OiB7IFJlc291cmNlczogUmVzb3VyY2VzIH0sXG5cbiAgICAgICAgICAgICAgICB1aToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6ICdpbnB1dFtuYW1lPVwic2VhcmNoSW5XaWRnZXRcIl0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgclRhYjogJ3NwYW5bZGF0YS1uYW1lPVwicnVicmljcy1wYW5lbFwiXScsXG4gICAgICAgICAgICAgICAgICAgICAgICBzVGFiOiAnc3BhbltkYXRhLW5hbWU9XCJzZWFyY2gtcGFuZWxcIl0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgclBhbjogJyNydWJyaWNzLXBhbmVsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNQYW46ICcjc2VhcmNoLXBhbmVsJ1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiAnLmxpc3QtYXJlYSdcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbiA9IG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdsaXN0JywgbmV3IGxpc3RSdWJyaWNzKHsgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uIH0pKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgY2hpbGRWaWV3RXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICdmaWx0ZXI6YXBwbHknOiBmdW5jdGlvbiBmaWx0ZXJBcHBseSh2KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5tb2RlbC5zZXQoXCJoaWRlXCIsICF2LnVpLmNoYngucHJvcCgnY2hlY2tlZCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAnZmlsdGVyOmFwcGx5JzogJ2ZpbHRlcjphcHBseSdcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZXZlbnRzOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xpY2sgbmF2IHNwYW46bm90KC5yaWdodClcIjogZnVuY3Rpb24gY2xpY2tOYXZTcGFuTm90UmlnaHQoZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkcCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoXCJzcGFuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQoXCJuYXYgc3BhblwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kKFwic2VjdGlvblwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHAuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJChcInNlY3Rpb24jXCIgKyAkcC5hdHRyKFwiZGF0YS1uYW1lXCIpKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNsaWNrIG5hdiBzcGFuLnJpZ2h0XCI6IGZ1bmN0aW9uIGNsaWNrTmF2U3BhblJpZ2h0KCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnNsaWRlVG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNsaWNrIGJ1dHRvbi5zZWFyY2hcIjogZnVuY3Rpb24gY2xpY2tCdXR0b25TZWFyY2goKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IHRoaXMudWkuaW5wdXQudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkLnRyaW0odmFsKSkgdGhpcy50cmlnZ2VyTWV0aG9kKFwiZmlsdGVyOnNlYXJjaFwiLCB2YWwpO2Vsc2UgdGhpcy50cmlnZ2VyTWV0aG9kKFwiZmlsdGVyOmFwcGx5XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NsaWNrIGJ1dHRvbi5jYW5jZWwnOiBmdW5jdGlvbiBjbGlja0J1dHRvbkNhbmNlbCgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLmlucHV0LnZhbCgnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyTWV0aG9kKFwiZmlsdGVyOmFwcGx5XCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnNsaWRlVG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGhpZGVSdWJyaWNzOiBmdW5jdGlvbiBoaWRlUnVicmljcygpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5yVGFiLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWkuclBhbi5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnNUYWIuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5zUGFuLnNob3coKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgc2hvd1J1YnJpY3M6IGZ1bmN0aW9uIHNob3dSdWJyaWNzKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnJUYWIuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aS5yUGFuLnNob3coKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbmRlZmluZSgnd2lkZ2V0VGFibGVHcmlkJywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ3dpZGdldC50YWJsZS5maWx0ZXInXSwgZnVuY3Rpb24gKFJlc291cmNlcywgZmlsdGVyVmlldykge1xuXG4gICAgdmFyIHRvb2xzVmlldyA9IE1uLkNvbGxlY3Rpb25WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgY2xhc3NOYW1lOiAndG9vbHMnLFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICAnbW91c2VsZWF2ZSc6IGZ1bmN0aW9uIG1vdXNlbGVhdmUoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZWwuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoaWxkVmlldzogTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgICAgICB0YWdOYW1lOiAnc3BhbicsXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdidG4nLFxuXG4gICAgICAgICAgICBldmVudHM6IHtcblxuICAgICAgICAgICAgICAgICdtb3VzZWVudGVyIHN2Zyc6IGZ1bmN0aW9uIG1vdXNlZW50ZXJTdmcoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoXCIuYW5ici10b29sdGlwXCIpLmZhZGVJbigpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAnbW91c2VsZWF2ZSBzdmcnOiBmdW5jdGlvbiBtb3VzZWxlYXZlU3ZnKCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKFwiLmFuYnItdG9vbHRpcFwiKS5mYWRlT3V0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgdHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICAgICAndG91Y2hzdGFydCc6ICdhY3Rpb24nLFxuICAgICAgICAgICAgICAgICdjbGljayc6ICdhY3Rpb24nXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gb25BY3Rpb24oZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdyZW5kZXInKSA9PT0gXCJhY3Rpb25cIikgJC5hamF4KHsgbWV0aG9kOiB0aGlzLm1vZGVsLmdldCgndmVyYicpLCB1cmw6IHRoaXMubW9kZWwuZ2V0KCdocmVmJykgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIEJhY2tib25lLnRyaWdnZXIoXCJtZXNzYWdlOnN1Y2Nlc3NcIiwgeyB0aXRsZTogUmVzb3VyY2VzLmFsZXJ0LCBtZXNzYWdlOiBSZXNvdXJjZXMuc3VjY2VzcyB9KTtcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgICAgICAgICAgIEJhY2tib25lLnRyaWdnZXIoXCJtZXNzYWdlOndhcm5pbmdcIiwgeyB0aXRsZTogUmVzb3VyY2VzLmVycm9yLCBtZXNzYWdlOiBtLnN0YXR1cyB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGdldFRlbXBsYXRlOiBmdW5jdGlvbiBnZXRUZW1wbGF0ZSgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3JlbmRlcicpID09PSAnb3BlbicpIHJldHVybiBfLnRlbXBsYXRlKCc8YSBocmVmPVwiPCUtIGhyZWYgJT5cIiB0YXJnZXQ9XCJfYmxhbmtcIj48c3BhbiBjbGFzcz1cImFuYnItdG9vbHRpcFwiPjxzcGFuIHBvc2l0aW9uPVwiYm90dG9tXCI+PC9zcGFuPjwlLSBwcm9tcHQgJT48L3NwYW4+PHN2ZyBjbGFzcz1cInN2Zy1pY29uXCI+PHVzZSB4bGluazpocmVmPVwiIzwlLSBpZCAlPlwiIC8+PC9zdmc+PC9hPicpO2Vsc2UgcmV0dXJuIF8udGVtcGxhdGUoJzxzcGFuIGNsYXNzPVwiYW5ici10b29sdGlwXCI+PHNwYW4gcG9zaXRpb249XCJib3R0b21cIj48L3NwYW4+PCUtIHByb21wdCAlPjwvc3Bhbj48c3ZnIGNsYXNzPVwic3ZnLWljb25cIj48dXNlIHhsaW5rOmhyZWY9XCIjPCUtIGlkICU+XCIgLz48L3N2Zz4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSksXG5cbiAgICAgICAgb25SZW5kZXJDaGlsZHJlbjogZnVuY3Rpb24gb25SZW5kZXJDaGlsZHJlbigpIHtcbiAgICAgICAgICAgIHRoaXMuJGVsLndpZHRoKHRoaXMuY29sbGVjdGlvbi5sZW5ndGggKiA1MikuZGVsYXkoMTAwKS5zbGlkZURvd24oKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIHRvb2xzVGFibGVWaWV3ID0gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNsYXNzTmFtZTogJ3ByZWJsdScsXG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8ZGl2IGNsYXNzPVwiYXJyb3dcIj48L2Rpdj48ZGl2IGNsYXNzPVwidG9vbHNcIj48L2Rpdj4nKSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICB0b29sczogeyBlbDogJy50b29scycsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgJ3RvdWNoc3RhcnQnOiAncHJlcGFyZScsXG4gICAgICAgICAgICAnY2xpY2snOiAncHJlcGFyZSdcbiAgICAgICAgfSxcblxuICAgICAgICBvblByZXBhcmU6IGZ1bmN0aW9uIG9uUHJlcGFyZSgpIHtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSBfLmdyb3VwQnkodGhpcy5tb2RlbC5nZXQoJ2xpbmtzJyksICdyZWwnKS50b29scyB8fCBbXTtcbiAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygndG9vbHMnLCBuZXcgdG9vbHNWaWV3KHsgY29sbGVjdGlvbjogbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oZGF0YSkgfSkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uIHNob3codikge1xuICAgICAgICAgICAgdGhpcy5tb2RlbCA9IHYubW9kZWw7XG4gICAgICAgICAgICB0aGlzLiRlbC5jc3MoXCJ0b3BcIiwgdi4kZWwucG9zaXRpb24oKS50b3AgKyB2LiRlbC5vdXRlckhlaWdodCgpIC8gMiAtIDEwKTtcbiAgICAgICAgICAgIHRoaXMuJGVsLnNob3coKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIHJvd1ZpZXcgPSBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGFnTmFtZTogJ3RyJyxcblxuICAgICAgICBnZXRUZW1wbGF0ZTogZnVuY3Rpb24gZ2V0VGVtcGxhdGUoKSB7XG4gICAgICAgICAgICByZXR1cm4gXy50ZW1wbGF0ZSh0aGlzLm9wdGlvbnMudGVtcGwpO1xuICAgICAgICB9LFxuICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IGZ1bmN0aW9uIHRlbXBsYXRlQ29udGV4dCgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFyc2U6IHRoaXMucGFyc2VUeXBlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICAnY2xpY2sgYSc6IGZ1bmN0aW9uIGNsaWNrQShlKSB7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAndG91Y2hzdGFydCBhJzogZnVuY3Rpb24gdG91Y2hzdGFydEEoZSkge1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICdtb3VzZWVudGVyJzogJ21vdXNlOmVudGVyOnJvdycsXG4gICAgICAgICAgICAnbW91c2VsZWF2ZSc6ICdtb3VzZTpsZWF2ZTpyb3cnLFxuXG4gICAgICAgICAgICAndG91Y2hzdGFydCc6ICd0YWJsZTpyb3c6aGFuZGxlcicsXG4gICAgICAgICAgICAnY2xpY2snOiAndGFibGU6cm93OmhhbmRsZXInXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5oYXMoJ2xpbmtzJykpIHtcblxuICAgICAgICAgICAgICAgIHZhciBhID0gXy5ncm91cEJ5KHRoaXMubW9kZWwuZ2V0KCdsaW5rcycpLCAncmVsJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoYSwgJ3J1YnJpY19pZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJCgndGRbZGF0YS1jb2x1bW49XCJkaXNwbGF5X25hbWVcIl0nKS5hcHBlbmQoJzxkaXYgY2xhc3M9XCJydWJyaWNzXCI+PC9kaXY+Jyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2cyA9IF8ucGx1Y2soYS5ydWJyaWNfaWQsICd2YWx1ZScpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiQoJy5ydWJyaWNzJykuYXBwZW5kKHZzLmpvaW4oJzsgJykpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChfLmhhcyhhLCAndXJsX9C40YHRgtC+0YfQvdC40LrQsCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIF8uY2hhaW4oYVsndXJsX9C40YHRgtC+0YfQvdC40LrQsCddKS5tYXAoZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJCgndGRbZGF0YS1jb2x1bW49XCJkaXNwbGF5X25hbWVcIl0nKS5hcHBlbmQoJzxhIHRpdGxlPVwiJyArIG8ucHJvbXB0ICsgJ1wiIGhyZWY9XCInICsgby5ocmVmICsgJ1wiIHRhcmdldD1cIl9ibGFua1wiPlxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdDxzcGFuPjxzdmcgY2xhc3M9XCJsaW5rLWljb25cIj48dXNlIHhsaW5rOiBocmVmPVwiI2xpbmstaWNvblwiIC8+PC9zdmc+PC9zcGFuPlxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdDwvYT4nKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHBhcnNlVHlwZTogZnVuY3Rpb24gcGFyc2VUeXBlKHZhbHVlLCBzKSB7XG4gICAgICAgICAgICBpZiAoIXMpIHJldHVybiAnJztcbiAgICAgICAgICAgIHZhciBvdXRwdXQ7XG4gICAgICAgICAgICBzd2l0Y2ggKHMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIC8v0YbQtdC70L7Rh9C40YHQu9C10L3QvdGL0LlcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgIC8vIGRhdGUtdGltZVxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSAkLnBhcnNlRGF0ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgLy8g0LLQtdGJ0LXRgdGC0LLQtdC90L3Ri9C5XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDc6IC8vIGltYWdlICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNhc2UgMTogLy8gc3RyaW5nXG4gICAgICAgICAgICAgICAgY2FzZSAzOiAvLyBkaWN0aW9uYXJ5XG4gICAgICAgICAgICAgICAgY2FzZSA1OiAvLyBmaWxlIG5hbWVcbiAgICAgICAgICAgICAgICBjYXNlIDY6IC8vIHRleHQgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNhc2UgODogLy8gaHRtbFxuICAgICAgICAgICAgICAgIGNhc2UgOTogLy8gZ2lwZXJsaW5rXG4gICAgICAgICAgICAgICAgY2FzZSAxMDogLy8gZGF0YVxuICAgICAgICAgICAgICAgIGNhc2UgMTE6IC8vIE9MRSBkb2N1bWVudFxuICAgICAgICAgICAgICAgIGNhc2UgMTI6IC8vIHVpZFxuICAgICAgICAgICAgICAgIGNhc2UgMTM6IC8vIFZhckJpbmFyeVxuICAgICAgICAgICAgICAgIGNhc2UgMTQ6IC8vINC00LLQvtC40YfQvdGL0Lkg0YTQsNC50LtcbiAgICAgICAgICAgICAgICBjYXNlIDE1OiAvLyDQtNC10L3QtdC20L3Ri9C5XG4gICAgICAgICAgICAgICAgY2FzZSAxNjogLy8gYm9vbFxuICAgICAgICAgICAgICAgIGNhc2UgMTc6XG4gICAgICAgICAgICAgICAgICAgIC8vIGdlbyBjb29yZGluYXRlc1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBcIjxzcGFuPlwiICsgdmFsdWUgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICB2YXIgYm9keVZpZXcgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRhZ05hbWU6ICd0Ym9keScsXG5cbiAgICAgICAgY2hpbGRWaWV3OiByb3dWaWV3LFxuXG4gICAgICAgIGNoaWxkVmlld09wdGlvbnM6IGZ1bmN0aW9uIGNoaWxkVmlld09wdGlvbnMoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRlbXBsOiB0aGlzLm9wdGlvbnMudGVtcGwsXG4gICAgICAgICAgICAgICAgY29sczogdGhpcy5vcHRpb25zLmNvbHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW1wdHlWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG4gICAgICAgICAgICB0YWdOYW1lOiAndHInLFxuICAgICAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJzx0ZCBjb2xzcGFuPVwiPCUtIGNvbHNwYW4gJT5cIj48JS0gUmVzb3VyY2VzLk4gJT48L3RkPicpLFxuICAgICAgICAgICAgdGVtcGxhdGVDb250ZXh0OiBmdW5jdGlvbiB0ZW1wbGF0ZUNvbnRleHQoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgUmVzb3VyY2VzOiBSZXNvdXJjZXMsXG4gICAgICAgICAgICAgICAgICAgIGNvbHNwYW46IHRoaXMub3B0aW9ucy5jb2xzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSksXG5cbiAgICAgICAgb25DaGlsZHZpZXdUYWJsZVJvd0hhbmRsZXI6IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3VGFibGVSb3dIYW5kbGVyKHYpIHtcblxuICAgICAgICAgICAgdmFyIGN1cnJlbnRUciA9IHRoaXMuJGVsLmZpbmQoJ3RyLmN1cnJlbnQnKSxcbiAgICAgICAgICAgICAgICBmbGFnID0gdGhpcy5vcHRpb25zLmlzTWFya1NlbGVjdGVkSXRlbTtcblxuICAgICAgICAgICAgY3VycmVudFRyLnJlbW92ZUNsYXNzKCdjdXJyZW50JykuYWRkQ2xhc3MoJ3ZpZXdlZCcpO1xuXG4gICAgICAgICAgICBjdXJyZW50VHIuZmluZCgndGQnKS5lYWNoKGZ1bmN0aW9uIChpLCBlKSB7XG4gICAgICAgICAgICAgICAgJChlKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogZmxhZyA/IHRoaXMub3B0aW9ucy5kZWNvcmF0aW9uLkNvbnRhaW5lckZvcmVncm91bmRWaXNpdGVkIDogdGhpcy5vcHRpb25zLmRlY29yYXRpb24uQ29udGFpbmVyRm9yZWdyb3VuZCxcbiAgICAgICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiBmbGFnID8gdGhpcy5vcHRpb25zLmRlY29yYXRpb24uQ29udGFpbmVyQmFja2dyb3VuZFZpc2l0ZWQgOiB0aGlzLm9wdGlvbnMuZGVjb3JhdGlvbi5Db250YWluZXJCYWNrZ3JvdW5kXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICB2LiRlbC5hZGRDbGFzcygnY3VycmVudCcpLnJlbW92ZUNsYXNzKFwibmV3LXBvc3RcIik7XG5cbiAgICAgICAgICAgIHYuJGVsLmZpbmQoJ3RkJykuZWFjaChmdW5jdGlvbiAoaSwgZSkge1xuICAgICAgICAgICAgICAgICQoZSkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHRoaXMub3B0aW9ucy5kZWNvcmF0aW9uLkNvbnRhaW5lckZvcmVncm91bmRBY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogdGhpcy5vcHRpb25zLmRlY29yYXRpb24uQ29udGFpbmVyQmFja2dyb3VuZEFjdGl2ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGlsZFZpZXdUcmlnZ2Vyczoge1xuICAgICAgICAgICAgJ21vdXNlOmVudGVyOnJvdyc6ICdtb3VzZTplbnRlcjpyb3cnLFxuICAgICAgICAgICAgJ21vdXNlOmxlYXZlOnJvdyc6ICdtb3VzZTpsZWF2ZTpyb3cnLFxuICAgICAgICAgICAgJ3RhYmxlOnJvdzpoYW5kbGVyJzogJ3RhYmxlOnJvdzpoYW5kbGVyJ1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgaGVhZFZpZXcgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuICAgICAgICB0YWdOYW1lOiAndHInLFxuICAgICAgICBjaGlsZFZpZXc6IE1uLlZpZXcuZXh0ZW5kKHtcbiAgICAgICAgICAgIHRhZ05hbWU6ICd0aCcsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZSgnPCUtIGRpc3BsYXlOYW1lICU+JylcbiAgICAgICAgfSlcbiAgICB9KTtcblxuICAgIHZhciB0YWJsZVZpZXcgPSBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGFnTmFtZTogJ3RhYmxlJyxcblxuICAgICAgICBjbGFzc05hbWU6ICd3aWRnZXQtdGFibGUnLFxuXG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8dGhlYWQ+PC90aGVhZD48dGJvZHk+PC90Ym9keT48dGZvb3Q+PC90Zm9vdD4nKSxcblxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgICBoZWFkOiAndGhlYWQnLFxuICAgICAgICAgICAgYm9keTogeyBlbDogJ3Rib2R5JywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgICAgIHRoaXMudGVtcGwgPSAnJztcblxuICAgICAgICAgICAgdmFyIGNvbHVtbnMgPSB0aGlzLm1vZGVsLmdldCgnQ29sdW1uQ3VzdG9taXphdGlvbnMnKTtcbiAgICAgICAgICAgIGlmIChjb2x1bW5zKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuaGVhZCA9IF8uY2hhaW4oY29sdW1ucykuZmlsdGVyKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlLkNvbHVtbklzVmlzaWJsZTtcbiAgICAgICAgICAgICAgICB9KS5zb3J0QnkoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUuU2VyaWFsTnVtO1xuICAgICAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcGwgKz0gJzx0ZCBkYXRhLWNvbHVtbj1cIicgKyBlLkNvbHVtblN5c3RlbU5hbWUudG9Mb3dlckNhc2UoKSArICdcIj48JT0gcGFyc2UoJyArIGUuQ29sdW1uU3lzdGVtTmFtZS50b0xvd2VyQ2FzZSgpICsgJywgcHJvcFR5cGVbXCInICsgZS5Db2x1bW5TeXN0ZW1OYW1lLnRvTG93ZXJDYXNlKCkgKyAnXCJdKSAlPjwvdGQ+JztcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBkaXNwbGF5TmFtZTogZS5Db2x1bW5UaXRsZSB9O1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpLnZhbHVlKCk7XG4gICAgICAgICAgICB9IGVsc2UgXy5lYWNoKHRoaXMub3B0aW9ucy5oZWFkLCBmdW5jdGlvbiAobykge1xuXG4gICAgICAgICAgICAgICAgdGhpcy50ZW1wbCArPSAnPHRkIGRhdGEtY29sdW1uPVwiJyArIG8uc3lzdGVtTmFtZSArICdcIj48JT0gcGFyc2UoJyArIG8uc3lzdGVtTmFtZSArICcsIHByb3BUeXBlW1wiJyArIG8uc3lzdGVtTmFtZSArICdcIl0pICU+PC90ZD4nO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB0aGlzLiRlbC5jc3MoeyB3aWR0aDogXCIxMDAlXCIsIFwidGFibGUtbGF5b3V0XCI6IFwiYXV0b1wiIH0pO1xuICAgICAgICAgICAgdGhpcy4kZWwuYXR0cignZGlyJywgJ2F1dG8nKTtcblxuICAgICAgICAgICAgLy9pZiAodGhpcy5tb2RlbC5nZXQoJ3RzJykpIHtcblxuICAgICAgICAgICAgLy92YXIgaXRlbXMgPSAkLnByZXBhcmUodGhpcy5vcHRpb25zLmZlZWQuZ2V0KCdpdGVtcycpKTtcblxuICAgICAgICAgICAgLy9fLmVhY2goZmVlZC5kYXRhLCBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgLy8gICAgdmFyIGlkID0gXy5maW5kV2hlcmUoYS5kYXRhLCB7IHN5c3RlbU5hbWU6IFwiT2JqZWN0X0lEXCIgfSkudmFsdWU7XG4gICAgICAgICAgICAvLyAgICBpZiAoIV8uZmluZChpdGVtcywgZnVuY3Rpb24gKGIpIHsgcmV0dXJuIGlkID09PSBiLk9iamVjdF9JRDsgfSkpXG4gICAgICAgICAgICAvLyAgICAgICAgdGhpcy5mZWVkSXRlbXMucHVzaChhKTtcbiAgICAgICAgICAgIC8vfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIC8vaWYgKHRoaXMuZmVlZEl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgLy8gICAgdGhpcy4kKFwiLm51bWJlci11cGRhdGVcIikuY3NzKFwiZGlzcGxheVwiLCBcImlubGluZS1ibG9ja1wiKS50ZXh0KHRoaXMuZmVlZEl0ZW1zLmxlbmd0aCk7XG4gICAgICAgICAgICAvLyAgICB0aGlzLm1vZGVsLnNldChcIkl0ZW1zXCIsIHRoaXMubW9kZWwuZ2V0KFwiSXRlbXNcIikuY29uY2F0KHRoaXMuZmVlZEl0ZW1zKSk7XG4gICAgICAgICAgICAvL31cblxuICAgICAgICAgICAgLy99IGVsc2Uge1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2hlYWQnLCBuZXcgaGVhZFZpZXcoeyBjb2xsZWN0aW9uOiBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbih0aGlzLm9wdGlvbnMuaGVhZCkgfSkpO1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2JvZHknLCBuZXcgYm9keVZpZXcoe1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IHRoaXMuY29sbGVjdGlvbixcbiAgICAgICAgICAgICAgICB0ZW1wbDogdGhpcy50ZW1wbCxcbiAgICAgICAgICAgICAgICBjb2xzOiB0aGlzLm9wdGlvbnMuaGVhZC5sZW5ndGgsXG4gICAgICAgICAgICAgICAgaXNNYXJrU2VsZWN0ZWRJdGVtOiB0aGlzLm1vZGVsLmdldCgnaXNNYXJrU2VsZWN0ZWRJdGVtJyksXG4gICAgICAgICAgICAgICAgZGVjb3JhdGlvbjogdGhpcy5tb2RlbC5nZXQoJ0RlY29yYXRpb24nKVxuICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAvL31cbiAgICAgICAgfSxcblxuICAgICAgICBvbkF0dGFjaDogZnVuY3Rpb24gb25BdHRhY2goKSB7XG5cbiAgICAgICAgICAgIHRoaXMuJCgndGJvZHknKS5oZWlnaHQodGhpcy4kZWwuY2xvc2VzdCgnLmFuYnJfbGlzdCcpLmhlaWdodCgpIC0gdGhpcy4kKCd0aGVhZCcpLmhlaWdodCgpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtb2RlbEV2ZW50czoge1xuXG4gICAgICAgICAgICAnY2hhbmdlOndpZHRoJzogZnVuY3Rpb24gY2hhbmdlV2lkdGgoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kKCd0Ym9keScpLmhlaWdodCh0aGlzLiRlbC5jbG9zZXN0KCcuYW5icl9saXN0JykuaGVpZ2h0KCkgLSB0aGlzLiQoJ3RoZWFkJykuaGVpZ2h0KCkpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ2NoYW5nZTpoZWlnaHQnOiBmdW5jdGlvbiBjaGFuZ2VIZWlnaHQoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kKCd0Ym9keScpLmhlaWdodCh0aGlzLiRlbC5jbG9zZXN0KCcuYW5icl9saXN0JykuaGVpZ2h0KCkgLSB0aGlzLiQoJ3RoZWFkJykuaGVpZ2h0KCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25DaGlsZHZpZXdUYWJsZVJvd0hhbmRsZXI6IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3VGFibGVSb3dIYW5kbGVyKHYpIHtcblxuICAgICAgICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKCdjbGljazppdGVtJywgdi5tb2RlbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hpbGRWaWV3VHJpZ2dlcnM6IHtcbiAgICAgICAgICAgICdtb3VzZTplbnRlcjpyb3cnOiAnbW91c2U6ZW50ZXI6cm93JyxcbiAgICAgICAgICAgICdtb3VzZTpsZWF2ZTpyb3cnOiAnbW91c2U6bGVhdmU6cm93JyxcbiAgICAgICAgICAgICd0YWJsZTpyb3c6aGFuZGxlcic6ICd0YWJsZTpyb3c6aGFuZGxlcidcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIHRlbXBsYXRlOiBfLnRlbXBsYXRlKCc8ZGl2IGNsYXNzPVwiZmlsdGVyLXBhbmVsXCI+PC9kaXY+PHNwYW4gY2xhc3M9XCJudW1iZXItdXBkYXRlXCI+PC9zcGFuPjxkaXYgY2xhc3M9XCJwcmVibHVcIj48L2Rpdj48dGFibGU+PC90YWJsZT4nKSxcblxuICAgICAgICB1aToge1xuICAgICAgICAgICAgdXBkYXRlOiAnLm51bWJlci11cGRhdGUnXG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVnaW9uczoge1xuICAgICAgICAgICAgZmlsdGVyOiB7IGVsOiAnLmZpbHRlci1wYW5lbCcsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICB0b29sc1RhYmxlOiB7IGVsOiAnLnByZWJsdScsIHJlcGxhY2VFbGVtZW50OiB0cnVlIH0sXG4gICAgICAgICAgICB0YWJsZTogeyBlbDogJ3RhYmxlJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgLy8gMjEuMDkuMjAxNyDQstGA0LXQvNC10L3QvdC+INGB0LrRgNGL0YLQvlxuICAgICAgICAgICAgLy90aGlzLnNob3dDaGlsZFZpZXcoJ3Rvb2xzVGFibGUnLCBuZXcgdG9vbHNUYWJsZVZpZXcpO1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ2ZpbHRlcicsIG5ldyBmaWx0ZXJWaWV3KHsgbW9kZWw6IHRoaXMubW9kZWwgfSkpO1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ3RhYmxlJywgbmV3IHRhYmxlVmlldyh7XG4gICAgICAgICAgICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgIGhlYWQ6IF8uZmlsdGVyKHRoaXMubW9kZWwuZ2V0KCdmZWVkJykuaGVhZCwgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG8uaXNWaXNpYmxlO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgIHZhciBjID0gW107XG5cbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5lYWNoKGZ1bmN0aW9uIChtKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVscyA9IF8uZ3JvdXBCeShtLmdldCgnbGlua3MnKSwgXCJyZWxcIik7XG5cbiAgICAgICAgICAgICAgICBfLmVhY2gocmVscy5ydWJyaWNfaWQsIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgICAgICAgIGMucHVzaChhKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICB0aGlzLmdldENoaWxkVmlldygnZmlsdGVyJykuY29sbGVjdGlvbi5hZGQoYyk7XG5cbiAgICAgICAgICAgIGlmIChjLmxlbmd0aCkgdGhpcy5nZXRDaGlsZFZpZXcoJ2ZpbHRlcicpLnNob3dSdWJyaWNzKCk7ZWxzZSB0aGlzLmdldENoaWxkVmlldygnZmlsdGVyJykuaGlkZVJ1YnJpY3MoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkF0dGFjaDogZnVuY3Rpb24gb25BdHRhY2goKSB7XG5cbiAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCd0YWJsZScpLmdldENoaWxkVmlldygnYm9keScpLiRlbC5vbignc2Nyb2xsJywgZnVuY3Rpb24gKGUpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlck1ldGhvZCgnc2Nyb2xsOmdyaWQnKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29sbGVjdGlvbkV2ZW50czoge1xuXG4gICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShjLCBhKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoYS5hZGQpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgICAgIF8uZWFjaChhLmNoYW5nZXMuYWRkZWQsIGZ1bmN0aW9uIChtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWxzID0gXy5ncm91cEJ5KG0uZ2V0KCdsaW5rcycpLCBcInJlbFwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHJlbHMucnVicmljX2lkLCBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMucHVzaChhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNZXRob2QoJ3RhYmxlOmFkZDpydWJyaWNzOmZpbHRlcicsIGMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGNoaWxkVmlld0V2ZW50czoge1xuXG4gICAgICAgICAgICAnbW91c2U6ZW50ZXI6cm93JzogZnVuY3Rpb24gbW91c2VFbnRlclJvdyh2KSB7XG4gICAgICAgICAgICAgICAgLy90aGlzLmdldENoaWxkVmlldygndG9vbHNUYWJsZScpLnNob3codik7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnbW91c2U6bGVhdmU6cm93JzogZnVuY3Rpb24gbW91c2VMZWF2ZVJvdyh2KSB7XG4gICAgICAgICAgICAgICAgLy90aGlzLmdldENoaWxkVmlldygndG9vbHNUYWJsZScpLmhpZGUodik7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAndGFibGU6cm93OmhhbmRsZXInOiBmdW5jdGlvbiB0YWJsZVJvd0hhbmRsZXIodikge1xuXG4gICAgICAgICAgICAgICAgLy90aGlzLnRyaWdnZXJNZXRob2QoICdjaGVjazpjaGlsZCcsIHRoaXMubW9kZWwsIHYubW9kZWwgKTtcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ2ZpbHRlcjpzZWFyY2gnOiBmdW5jdGlvbiBmaWx0ZXJTZWFyY2godGV4dCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy4kKFwidGJvZHk+dHI+dGRbZGF0YS1jb2x1bW49J2Rpc3BsYXlfbmFtZSddIC5NYXJrXCIpLnJlbW92ZUNsYXNzKFwiTWFya1wiKTtcblxuICAgICAgICAgICAgICAgIHZhciBzID0gbmV3IFJlZ0V4cCh0ZXh0LCBcImlnXCIpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy4kKFwidGJvZHk+dHJcIikuZWFjaChmdW5jdGlvbiAoaSwgZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciAkYSA9ICQoZSkuZmluZChcInRkW2RhdGEtY29sdW1uPSdkaXNwbGF5X25hbWUnXVwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrID0gJGEuaHRtbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoSW5kZXggPSBjaGVjay5zZWFyY2gocyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlYXJjaEluZGV4ID09PSAtMSkgJChlKS5oaWRlKCk7ZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gJzxpIGNsYXNzPVwiTWFya1wiPicgKyBjaGVjay5tYXRjaChzKVswXSArICc8L2k+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGNoZWNrLnN1YnN0cmluZygwLCBzZWFyY2hJbmRleCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gY2hlY2suc3Vic3RyaW5nKHNlYXJjaEluZGV4ICsgdGV4dC5sZW5ndGgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dCA9IHN0YXJ0ICsgcCArIGVuZDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJGEuaHRtbChvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChlKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdmaWx0ZXI6YXBwbHknOiBmdW5jdGlvbiBmaWx0ZXJBcHBseSgpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCd0YWJsZScpLmdldENoaWxkVmlldygnYm9keScpLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24gKHYpIHtcblxuICAgICAgICAgICAgICAgICAgICB2LiRlbC5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBfLmdyb3VwQnkodi5tb2RlbC5nZXQoJ2xpbmtzJyksICdyZWwnKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcnVicyA9IGEucnVicmljX2lkO1xuICAgICAgICAgICAgICAgICAgICBpZiAocnVicykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2gocnVicywgZnVuY3Rpb24gKHIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleCA9IHRoaXMuZ2V0Q2hpbGRWaWV3KCdmaWx0ZXInKS5jb2xsZWN0aW9uLmdldChyLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXguZ2V0KCdoaWRlJykpIHYuJGVsLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLiQoXCJ0Ym9keT50cj50ZFtkYXRhLWNvbHVtbj0nZGlzcGxheV9uYW1lJ10gLk1hcmtcIikucmVtb3ZlQ2xhc3MoXCJNYXJrXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KTsiLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG4vKlxuKiBqUXVlcnkgRm9ybSBQbHVnaW47IHYyMDEzMDUyM1xuKiBodHRwOi8vanF1ZXJ5Lm1hbHN1cC5jb20vZm9ybS9cbiogQ29weXJpZ2h0IChjKSAyMDEzIE0uIEFsc3VwOyBEdWFsIGxpY2Vuc2VkOiBNSVQvR1BMXG4qIGh0dHBzOi8vZ2l0aHViLmNvbS9tYWxzdXAvZm9ybSNjb3B5cmlnaHQtYW5kLWxpY2Vuc2VcbiovXG47KGZ1bmN0aW9uIChlKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuICBmdW5jdGlvbiB0KHQpIHtcbiAgICB2YXIgciA9IHQuZGF0YTt0LmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8ICh0LnByZXZlbnREZWZhdWx0KCksIGUodGhpcykuYWpheFN1Ym1pdChyKSk7XG4gIH1mdW5jdGlvbiByKHQpIHtcbiAgICB2YXIgciA9IHQudGFyZ2V0LFxuICAgICAgICBhID0gZShyKTtpZiAoIWEuaXMoXCJbdHlwZT1zdWJtaXRdLFt0eXBlPWltYWdlXVwiKSkge1xuICAgICAgdmFyIG4gPSBhLmNsb3Nlc3QoXCJbdHlwZT1zdWJtaXRdXCIpO2lmICgwID09PSBuLmxlbmd0aCkgcmV0dXJuO3IgPSBuWzBdO1xuICAgIH12YXIgaSA9IHRoaXM7aWYgKGkuY2xrID0gciwgXCJpbWFnZVwiID09IHIudHlwZSkgaWYgKHZvaWQgMCAhPT0gdC5vZmZzZXRYKSBpLmNsa194ID0gdC5vZmZzZXRYLCBpLmNsa195ID0gdC5vZmZzZXRZO2Vsc2UgaWYgKFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZS5mbi5vZmZzZXQpIHtcbiAgICAgIHZhciBvID0gYS5vZmZzZXQoKTtpLmNsa194ID0gdC5wYWdlWCAtIG8ubGVmdCwgaS5jbGtfeSA9IHQucGFnZVkgLSBvLnRvcDtcbiAgICB9IGVsc2UgaS5jbGtfeCA9IHQucGFnZVggLSByLm9mZnNldExlZnQsIGkuY2xrX3kgPSB0LnBhZ2VZIC0gci5vZmZzZXRUb3A7c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBpLmNsayA9IGkuY2xrX3ggPSBpLmNsa195ID0gbnVsbDtcbiAgICB9LCAxMDApO1xuICB9ZnVuY3Rpb24gYSgpIHtcbiAgICBpZiAoZS5mbi5hamF4U3VibWl0LmRlYnVnKSB7XG4gICAgICB2YXIgdCA9IFwiW2pxdWVyeS5mb3JtXSBcIiArIEFycmF5LnByb3RvdHlwZS5qb2luLmNhbGwoYXJndW1lbnRzLCBcIlwiKTt3aW5kb3cuY29uc29sZSAmJiB3aW5kb3cuY29uc29sZS5sb2cgPyB3aW5kb3cuY29uc29sZS5sb2codCkgOiB3aW5kb3cub3BlcmEgJiYgd2luZG93Lm9wZXJhLnBvc3RFcnJvciAmJiB3aW5kb3cub3BlcmEucG9zdEVycm9yKHQpO1xuICAgIH1cbiAgfXZhciBuID0ge307bi5maWxlYXBpID0gdm9pZCAwICE9PSBlKFwiPGlucHV0IHR5cGU9J2ZpbGUnLz5cIikuZ2V0KDApLmZpbGVzLCBuLmZvcm1kYXRhID0gdm9pZCAwICE9PSB3aW5kb3cuRm9ybURhdGE7dmFyIGkgPSAhIWUuZm4ucHJvcDtlLmZuLmF0dHIyID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICghaSkgcmV0dXJuIHRoaXMuYXR0ci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO3ZhciBlID0gdGhpcy5wcm9wLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7cmV0dXJuIGUgJiYgZS5qcXVlcnkgfHwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IGUgOiB0aGlzLmF0dHIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfSwgZS5mbi5hamF4U3VibWl0ID0gZnVuY3Rpb24gKHQpIHtcbiAgICBmdW5jdGlvbiByKHIpIHtcbiAgICAgIHZhciBhLFxuICAgICAgICAgIG4sXG4gICAgICAgICAgaSA9IGUucGFyYW0ociwgdC50cmFkaXRpb25hbCkuc3BsaXQoXCImXCIpLFxuICAgICAgICAgIG8gPSBpLmxlbmd0aCxcbiAgICAgICAgICBzID0gW107Zm9yIChhID0gMDsgbyA+IGE7IGErKykge1xuICAgICAgICBpW2FdID0gaVthXS5yZXBsYWNlKC9cXCsvZywgXCIgXCIpLCBuID0gaVthXS5zcGxpdChcIj1cIiksIHMucHVzaChbZGVjb2RlVVJJQ29tcG9uZW50KG5bMF0pLCBkZWNvZGVVUklDb21wb25lbnQoblsxXSldKTtcbiAgICAgIH1yZXR1cm4gcztcbiAgICB9ZnVuY3Rpb24gbyhhKSB7XG4gICAgICBmb3IgKHZhciBuID0gbmV3IEZvcm1EYXRhKCksIGkgPSAwOyBhLmxlbmd0aCA+IGk7IGkrKykge1xuICAgICAgICBuLmFwcGVuZChhW2ldLm5hbWUsIGFbaV0udmFsdWUpO1xuICAgICAgfWlmICh0LmV4dHJhRGF0YSkge1xuICAgICAgICB2YXIgbyA9IHIodC5leHRyYURhdGEpO2ZvciAoaSA9IDA7IG8ubGVuZ3RoID4gaTsgaSsrKSB7XG4gICAgICAgICAgb1tpXSAmJiBuLmFwcGVuZChvW2ldWzBdLCBvW2ldWzFdKTtcbiAgICAgICAgfVxuICAgICAgfXQuZGF0YSA9IG51bGw7dmFyIHMgPSBlLmV4dGVuZCghMCwge30sIGUuYWpheFNldHRpbmdzLCB0LCB7IGNvbnRlbnRUeXBlOiAhMSwgcHJvY2Vzc0RhdGE6ICExLCBjYWNoZTogITEsIHR5cGU6IHUgfHwgXCJQT1NUXCIgfSk7dC51cGxvYWRQcm9ncmVzcyAmJiAocy54aHIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0galF1ZXJ5LmFqYXhTZXR0aW5ncy54aHIoKTtyZXR1cm4gZS51cGxvYWQgJiYgZS51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIHIgPSAwLFxuICAgICAgICAgICAgICBhID0gZS5sb2FkZWQgfHwgZS5wb3NpdGlvbixcbiAgICAgICAgICAgICAgbiA9IGUudG90YWw7ZS5sZW5ndGhDb21wdXRhYmxlICYmIChyID0gTWF0aC5jZWlsKDEwMCAqIChhIC8gbikpKSwgdC51cGxvYWRQcm9ncmVzcyhlLCBhLCBuLCByKTtcbiAgICAgICAgfSwgITEpLCBlO1xuICAgICAgfSksIHMuZGF0YSA9IG51bGw7dmFyIGwgPSBzLmJlZm9yZVNlbmQ7cmV0dXJuIHMuYmVmb3JlU2VuZCA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHQuZGF0YSA9IG4sIGwgJiYgbC5jYWxsKHRoaXMsIGUsIHQpO1xuICAgICAgfSwgZS5hamF4KHMpO1xuICAgIH1mdW5jdGlvbiBzKHIpIHtcbiAgICAgIGZ1bmN0aW9uIG4oZSkge1xuICAgICAgICB2YXIgdCA9IG51bGw7dHJ5IHtcbiAgICAgICAgICBlLmNvbnRlbnRXaW5kb3cgJiYgKHQgPSBlLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQpO1xuICAgICAgICB9IGNhdGNoIChyKSB7XG4gICAgICAgICAgYShcImNhbm5vdCBnZXQgaWZyYW1lLmNvbnRlbnRXaW5kb3cgZG9jdW1lbnQ6IFwiICsgcik7XG4gICAgICAgIH1pZiAodCkgcmV0dXJuIHQ7dHJ5IHtcbiAgICAgICAgICB0ID0gZS5jb250ZW50RG9jdW1lbnQgPyBlLmNvbnRlbnREb2N1bWVudCA6IGUuZG9jdW1lbnQ7XG4gICAgICAgIH0gY2F0Y2ggKHIpIHtcbiAgICAgICAgICBhKFwiY2Fubm90IGdldCBpZnJhbWUuY29udGVudERvY3VtZW50OiBcIiArIHIpLCB0ID0gZS5kb2N1bWVudDtcbiAgICAgICAgfXJldHVybiB0O1xuICAgICAgfWZ1bmN0aW9uIG8oKSB7XG4gICAgICAgIGZ1bmN0aW9uIHQoKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBlID0gbihnKS5yZWFkeVN0YXRlO2EoXCJzdGF0ZSA9IFwiICsgZSksIGUgJiYgXCJ1bmluaXRpYWxpemVkXCIgPT0gZS50b0xvd2VyQ2FzZSgpICYmIHNldFRpbWVvdXQodCwgNTApO1xuICAgICAgICAgIH0gY2F0Y2ggKHIpIHtcbiAgICAgICAgICAgIGEoXCJTZXJ2ZXIgYWJvcnQ6IFwiLCByLCBcIiAoXCIsIHIubmFtZSwgXCIpXCIpLCBzKEQpLCBqICYmIGNsZWFyVGltZW91dChqKSwgaiA9IHZvaWQgMDtcbiAgICAgICAgICB9XG4gICAgICAgIH12YXIgciA9IGYuYXR0cjIoXCJ0YXJnZXRcIiksXG4gICAgICAgICAgICBpID0gZi5hdHRyMihcImFjdGlvblwiKTt3LnNldEF0dHJpYnV0ZShcInRhcmdldFwiLCBkKSwgdSB8fCB3LnNldEF0dHJpYnV0ZShcIm1ldGhvZFwiLCBcIlBPU1RcIiksIGkgIT0gbS51cmwgJiYgdy5zZXRBdHRyaWJ1dGUoXCJhY3Rpb25cIiwgbS51cmwpLCBtLnNraXBFbmNvZGluZ092ZXJyaWRlIHx8IHUgJiYgIS9wb3N0L2kudGVzdCh1KSB8fCBmLmF0dHIoeyBlbmNvZGluZzogXCJtdWx0aXBhcnQvZm9ybS1kYXRhXCIsIGVuY3R5cGU6IFwibXVsdGlwYXJ0L2Zvcm0tZGF0YVwiIH0pLCBtLnRpbWVvdXQgJiYgKGogPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBUID0gITAsIHMoayk7XG4gICAgICAgIH0sIG0udGltZW91dCkpO3ZhciBvID0gW107dHJ5IHtcbiAgICAgICAgICBpZiAobS5leHRyYURhdGEpIGZvciAodmFyIGwgaW4gbS5leHRyYURhdGEpIHtcbiAgICAgICAgICAgIG0uZXh0cmFEYXRhLmhhc093blByb3BlcnR5KGwpICYmIChlLmlzUGxhaW5PYmplY3QobS5leHRyYURhdGFbbF0pICYmIG0uZXh0cmFEYXRhW2xdLmhhc093blByb3BlcnR5KFwibmFtZVwiKSAmJiBtLmV4dHJhRGF0YVtsXS5oYXNPd25Qcm9wZXJ0eShcInZhbHVlXCIpID8gby5wdXNoKGUoJzxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cIicgKyBtLmV4dHJhRGF0YVtsXS5uYW1lICsgJ1wiPicpLnZhbChtLmV4dHJhRGF0YVtsXS52YWx1ZSkuYXBwZW5kVG8odylbMF0pIDogby5wdXNoKGUoJzxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cIicgKyBsICsgJ1wiPicpLnZhbChtLmV4dHJhRGF0YVtsXSkuYXBwZW5kVG8odylbMF0pKTtcbiAgICAgICAgICB9bS5pZnJhbWVUYXJnZXQgfHwgKHYuYXBwZW5kVG8oXCJib2R5XCIpLCBnLmF0dGFjaEV2ZW50ID8gZy5hdHRhY2hFdmVudChcIm9ubG9hZFwiLCBzKSA6IGcuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgcywgITEpKSwgc2V0VGltZW91dCh0LCAxNSk7dHJ5IHtcbiAgICAgICAgICAgIHcuc3VibWl0KCk7XG4gICAgICAgICAgfSBjYXRjaCAoYykge1xuICAgICAgICAgICAgdmFyIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZm9ybVwiKS5zdWJtaXQ7cC5hcHBseSh3KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgdy5zZXRBdHRyaWJ1dGUoXCJhY3Rpb25cIiwgaSksIHIgPyB3LnNldEF0dHJpYnV0ZShcInRhcmdldFwiLCByKSA6IGYucmVtb3ZlQXR0cihcInRhcmdldFwiKSwgZShvKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgfWZ1bmN0aW9uIHModCkge1xuICAgICAgICBpZiAoIXguYWJvcnRlZCAmJiAhRikge1xuICAgICAgICAgIGlmIChNID0gbihnKSwgTSB8fCAoYShcImNhbm5vdCBhY2Nlc3MgcmVzcG9uc2UgZG9jdW1lbnRcIiksIHQgPSBEKSwgdCA9PT0gayAmJiB4KSByZXR1cm4geC5hYm9ydChcInRpbWVvdXRcIiksIFMucmVqZWN0KHgsIFwidGltZW91dFwiKSwgdm9pZCAwO2lmICh0ID09IEQgJiYgeCkgcmV0dXJuIHguYWJvcnQoXCJzZXJ2ZXIgYWJvcnRcIiksIFMucmVqZWN0KHgsIFwiZXJyb3JcIiwgXCJzZXJ2ZXIgYWJvcnRcIiksIHZvaWQgMDtpZiAoTSAmJiBNLmxvY2F0aW9uLmhyZWYgIT0gbS5pZnJhbWVTcmMgfHwgVCkge1xuICAgICAgICAgICAgZy5kZXRhY2hFdmVudCA/IGcuZGV0YWNoRXZlbnQoXCJvbmxvYWRcIiwgcykgOiBnLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIHMsICExKTt2YXIgcixcbiAgICAgICAgICAgICAgICBpID0gXCJzdWNjZXNzXCI7dHJ5IHtcbiAgICAgICAgICAgICAgaWYgKFQpIHRocm93IFwidGltZW91dFwiO3ZhciBvID0gXCJ4bWxcIiA9PSBtLmRhdGFUeXBlIHx8IE0uWE1MRG9jdW1lbnQgfHwgZS5pc1hNTERvYyhNKTtpZiAoYShcImlzWG1sPVwiICsgbyksICFvICYmIHdpbmRvdy5vcGVyYSAmJiAobnVsbCA9PT0gTS5ib2R5IHx8ICFNLmJvZHkuaW5uZXJIVE1MKSAmJiAtLU8pIHJldHVybiBhKFwicmVxdWVpbmcgb25Mb2FkIGNhbGxiYWNrLCBET00gbm90IGF2YWlsYWJsZVwiKSwgc2V0VGltZW91dChzLCAyNTApLCB2b2lkIDA7dmFyIHUgPSBNLmJvZHkgPyBNLmJvZHkgOiBNLmRvY3VtZW50RWxlbWVudDt4LnJlc3BvbnNlVGV4dCA9IHUgPyB1LmlubmVySFRNTCA6IG51bGwsIHgucmVzcG9uc2VYTUwgPSBNLlhNTERvY3VtZW50ID8gTS5YTUxEb2N1bWVudCA6IE0sIG8gJiYgKG0uZGF0YVR5cGUgPSBcInhtbFwiKSwgeC5nZXRSZXNwb25zZUhlYWRlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSB7IFwiY29udGVudC10eXBlXCI6IG0uZGF0YVR5cGUgfTtyZXR1cm4gdFtlXTtcbiAgICAgICAgICAgICAgfSwgdSAmJiAoeC5zdGF0dXMgPSBOdW1iZXIodS5nZXRBdHRyaWJ1dGUoXCJzdGF0dXNcIikpIHx8IHguc3RhdHVzLCB4LnN0YXR1c1RleHQgPSB1LmdldEF0dHJpYnV0ZShcInN0YXR1c1RleHRcIikgfHwgeC5zdGF0dXNUZXh0KTt2YXIgbCA9IChtLmRhdGFUeXBlIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICBjID0gLyhqc29ufHNjcmlwdHx0ZXh0KS8udGVzdChsKTtpZiAoYyB8fCBtLnRleHRhcmVhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGYgPSBNLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGV4dGFyZWFcIilbMF07aWYgKGYpIHgucmVzcG9uc2VUZXh0ID0gZi52YWx1ZSwgeC5zdGF0dXMgPSBOdW1iZXIoZi5nZXRBdHRyaWJ1dGUoXCJzdGF0dXNcIikpIHx8IHguc3RhdHVzLCB4LnN0YXR1c1RleHQgPSBmLmdldEF0dHJpYnV0ZShcInN0YXR1c1RleHRcIikgfHwgeC5zdGF0dXNUZXh0O2Vsc2UgaWYgKGMpIHtcbiAgICAgICAgICAgICAgICAgIHZhciBkID0gTS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInByZVwiKVswXSxcbiAgICAgICAgICAgICAgICAgICAgICBoID0gTS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImJvZHlcIilbMF07ZCA/IHgucmVzcG9uc2VUZXh0ID0gZC50ZXh0Q29udGVudCA/IGQudGV4dENvbnRlbnQgOiBkLmlubmVyVGV4dCA6IGggJiYgKHgucmVzcG9uc2VUZXh0ID0gaC50ZXh0Q29udGVudCA/IGgudGV4dENvbnRlbnQgOiBoLmlubmVyVGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2UgXCJ4bWxcIiA9PSBsICYmICF4LnJlc3BvbnNlWE1MICYmIHgucmVzcG9uc2VUZXh0ICYmICh4LnJlc3BvbnNlWE1MID0gWCh4LnJlc3BvbnNlVGV4dCkpO3RyeSB7XG4gICAgICAgICAgICAgICAgTCA9IF8oeCwgbCwgbSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGIpIHtcbiAgICAgICAgICAgICAgICBpID0gXCJwYXJzZXJlcnJvclwiLCB4LmVycm9yID0gciA9IGIgfHwgaTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoYikge1xuICAgICAgICAgICAgICBhKFwiZXJyb3IgY2F1Z2h0OiBcIiwgYiksIGkgPSBcImVycm9yXCIsIHguZXJyb3IgPSByID0gYiB8fCBpO1xuICAgICAgICAgICAgfXguYWJvcnRlZCAmJiAoYShcInVwbG9hZCBhYm9ydGVkXCIpLCBpID0gbnVsbCksIHguc3RhdHVzICYmIChpID0geC5zdGF0dXMgPj0gMjAwICYmIDMwMCA+IHguc3RhdHVzIHx8IDMwNCA9PT0geC5zdGF0dXMgPyBcInN1Y2Nlc3NcIiA6IFwiZXJyb3JcIiksIFwic3VjY2Vzc1wiID09PSBpID8gKG0uc3VjY2VzcyAmJiBtLnN1Y2Nlc3MuY2FsbChtLmNvbnRleHQsIEwsIFwic3VjY2Vzc1wiLCB4KSwgUy5yZXNvbHZlKHgucmVzcG9uc2VUZXh0LCBcInN1Y2Nlc3NcIiwgeCksIHAgJiYgZS5ldmVudC50cmlnZ2VyKFwiYWpheFN1Y2Nlc3NcIiwgW3gsIG1dKSkgOiBpICYmICh2b2lkIDAgPT09IHIgJiYgKHIgPSB4LnN0YXR1c1RleHQpLCBtLmVycm9yICYmIG0uZXJyb3IuY2FsbChtLmNvbnRleHQsIHgsIGksIHIpLCBTLnJlamVjdCh4LCBcImVycm9yXCIsIHIpLCBwICYmIGUuZXZlbnQudHJpZ2dlcihcImFqYXhFcnJvclwiLCBbeCwgbSwgcl0pKSwgcCAmJiBlLmV2ZW50LnRyaWdnZXIoXCJhamF4Q29tcGxldGVcIiwgW3gsIG1dKSwgcCAmJiAhIC0tZS5hY3RpdmUgJiYgZS5ldmVudC50cmlnZ2VyKFwiYWpheFN0b3BcIiksIG0uY29tcGxldGUgJiYgbS5jb21wbGV0ZS5jYWxsKG0uY29udGV4dCwgeCwgaSksIEYgPSAhMCwgbS50aW1lb3V0ICYmIGNsZWFyVGltZW91dChqKSwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIG0uaWZyYW1lVGFyZ2V0IHx8IHYucmVtb3ZlKCksIHgucmVzcG9uc2VYTUwgPSBudWxsO1xuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH12YXIgbCxcbiAgICAgICAgICBjLFxuICAgICAgICAgIG0sXG4gICAgICAgICAgcCxcbiAgICAgICAgICBkLFxuICAgICAgICAgIHYsXG4gICAgICAgICAgZyxcbiAgICAgICAgICB4LFxuICAgICAgICAgIGIsXG4gICAgICAgICAgeSxcbiAgICAgICAgICBULFxuICAgICAgICAgIGosXG4gICAgICAgICAgdyA9IGZbMF0sXG4gICAgICAgICAgUyA9IGUuRGVmZXJyZWQoKTtpZiAocikgZm9yIChjID0gMDsgaC5sZW5ndGggPiBjOyBjKyspIHtcbiAgICAgICAgbCA9IGUoaFtjXSksIGkgPyBsLnByb3AoXCJkaXNhYmxlZFwiLCAhMSkgOiBsLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcbiAgICAgIH1pZiAobSA9IGUuZXh0ZW5kKCEwLCB7fSwgZS5hamF4U2V0dGluZ3MsIHQpLCBtLmNvbnRleHQgPSBtLmNvbnRleHQgfHwgbSwgZCA9IFwianFGb3JtSU9cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpLCBtLmlmcmFtZVRhcmdldCA/ICh2ID0gZShtLmlmcmFtZVRhcmdldCksIHkgPSB2LmF0dHIyKFwibmFtZVwiKSwgeSA/IGQgPSB5IDogdi5hdHRyMihcIm5hbWVcIiwgZCkpIDogKHYgPSBlKCc8aWZyYW1lIG5hbWU9XCInICsgZCArICdcIiBzcmM9XCInICsgbS5pZnJhbWVTcmMgKyAnXCIgLz4nKSwgdi5jc3MoeyBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLCB0b3A6IFwiLTEwMDBweFwiLCBsZWZ0OiBcIi0xMDAwcHhcIiB9KSksIGcgPSB2WzBdLCB4ID0geyBhYm9ydGVkOiAwLCByZXNwb25zZVRleHQ6IG51bGwsIHJlc3BvbnNlWE1MOiBudWxsLCBzdGF0dXM6IDAsIHN0YXR1c1RleHQ6IFwibi9hXCIsIGdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24gZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCkge30sIGdldFJlc3BvbnNlSGVhZGVyOiBmdW5jdGlvbiBnZXRSZXNwb25zZUhlYWRlcigpIHt9LCBzZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiBzZXRSZXF1ZXN0SGVhZGVyKCkge30sIGFib3J0OiBmdW5jdGlvbiBhYm9ydCh0KSB7XG4gICAgICAgICAgdmFyIHIgPSBcInRpbWVvdXRcIiA9PT0gdCA/IFwidGltZW91dFwiIDogXCJhYm9ydGVkXCI7YShcImFib3J0aW5nIHVwbG9hZC4uLiBcIiArIHIpLCB0aGlzLmFib3J0ZWQgPSAxO3RyeSB7XG4gICAgICAgICAgICBnLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuZXhlY0NvbW1hbmQgJiYgZy5jb250ZW50V2luZG93LmRvY3VtZW50LmV4ZWNDb21tYW5kKFwiU3RvcFwiKTtcbiAgICAgICAgICB9IGNhdGNoIChuKSB7fXYuYXR0cihcInNyY1wiLCBtLmlmcmFtZVNyYyksIHguZXJyb3IgPSByLCBtLmVycm9yICYmIG0uZXJyb3IuY2FsbChtLmNvbnRleHQsIHgsIHIsIHQpLCBwICYmIGUuZXZlbnQudHJpZ2dlcihcImFqYXhFcnJvclwiLCBbeCwgbSwgcl0pLCBtLmNvbXBsZXRlICYmIG0uY29tcGxldGUuY2FsbChtLmNvbnRleHQsIHgsIHIpO1xuICAgICAgICB9IH0sIHAgPSBtLmdsb2JhbCwgcCAmJiAwID09PSBlLmFjdGl2ZSsrICYmIGUuZXZlbnQudHJpZ2dlcihcImFqYXhTdGFydFwiKSwgcCAmJiBlLmV2ZW50LnRyaWdnZXIoXCJhamF4U2VuZFwiLCBbeCwgbV0pLCBtLmJlZm9yZVNlbmQgJiYgbS5iZWZvcmVTZW5kLmNhbGwobS5jb250ZXh0LCB4LCBtKSA9PT0gITEpIHJldHVybiBtLmdsb2JhbCAmJiBlLmFjdGl2ZS0tLCBTLnJlamVjdCgpLCBTO2lmICh4LmFib3J0ZWQpIHJldHVybiBTLnJlamVjdCgpLCBTO2IgPSB3LmNsaywgYiAmJiAoeSA9IGIubmFtZSwgeSAmJiAhYi5kaXNhYmxlZCAmJiAobS5leHRyYURhdGEgPSBtLmV4dHJhRGF0YSB8fCB7fSwgbS5leHRyYURhdGFbeV0gPSBiLnZhbHVlLCBcImltYWdlXCIgPT0gYi50eXBlICYmIChtLmV4dHJhRGF0YVt5ICsgXCIueFwiXSA9IHcuY2xrX3gsIG0uZXh0cmFEYXRhW3kgKyBcIi55XCJdID0gdy5jbGtfeSkpKTt2YXIgayA9IDEsXG4gICAgICAgICAgRCA9IDIsXG4gICAgICAgICAgQSA9IGUoXCJtZXRhW25hbWU9Y3NyZi10b2tlbl1cIikuYXR0cihcImNvbnRlbnRcIiksXG4gICAgICAgICAgRSA9IGUoXCJtZXRhW25hbWU9Y3NyZi1wYXJhbV1cIikuYXR0cihcImNvbnRlbnRcIik7RSAmJiBBICYmIChtLmV4dHJhRGF0YSA9IG0uZXh0cmFEYXRhIHx8IHt9LCBtLmV4dHJhRGF0YVtFXSA9IEEpLCBtLmZvcmNlU3luYyA/IG8oKSA6IHNldFRpbWVvdXQobywgMTApO3ZhciBMLFxuICAgICAgICAgIE0sXG4gICAgICAgICAgRixcbiAgICAgICAgICBPID0gNTAsXG4gICAgICAgICAgWCA9IGUucGFyc2VYTUwgfHwgZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5BY3RpdmVYT2JqZWN0ID8gKHQgPSBuZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxET01cIiksIHQuYXN5bmMgPSBcImZhbHNlXCIsIHQubG9hZFhNTChlKSkgOiB0ID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhlLCBcInRleHQveG1sXCIpLCB0ICYmIHQuZG9jdW1lbnRFbGVtZW50ICYmIFwicGFyc2VyZXJyb3JcIiAhPSB0LmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSA/IHQgOiBudWxsO1xuICAgICAgfSxcbiAgICAgICAgICBDID0gZS5wYXJzZUpTT04gfHwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5ldmFsKFwiKFwiICsgZSArIFwiKVwiKTtcbiAgICAgIH0sXG4gICAgICAgICAgXyA9IGZ1bmN0aW9uIF8odCwgciwgYSkge1xuICAgICAgICB2YXIgbiA9IHQuZ2V0UmVzcG9uc2VIZWFkZXIoXCJjb250ZW50LXR5cGVcIikgfHwgXCJcIixcbiAgICAgICAgICAgIGkgPSBcInhtbFwiID09PSByIHx8ICFyICYmIG4uaW5kZXhPZihcInhtbFwiKSA+PSAwLFxuICAgICAgICAgICAgbyA9IGkgPyB0LnJlc3BvbnNlWE1MIDogdC5yZXNwb25zZVRleHQ7cmV0dXJuIGkgJiYgXCJwYXJzZXJlcnJvclwiID09PSBvLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSAmJiBlLmVycm9yICYmIGUuZXJyb3IoXCJwYXJzZXJlcnJvclwiKSwgYSAmJiBhLmRhdGFGaWx0ZXIgJiYgKG8gPSBhLmRhdGFGaWx0ZXIobywgcikpLCBcInN0cmluZ1wiID09IHR5cGVvZiBvICYmIChcImpzb25cIiA9PT0gciB8fCAhciAmJiBuLmluZGV4T2YoXCJqc29uXCIpID49IDAgPyBvID0gQyhvKSA6IChcInNjcmlwdFwiID09PSByIHx8ICFyICYmIG4uaW5kZXhPZihcImphdmFzY3JpcHRcIikgPj0gMCkgJiYgZS5nbG9iYWxFdmFsKG8pKSwgbztcbiAgICAgIH07cmV0dXJuIFM7XG4gICAgfWlmICghdGhpcy5sZW5ndGgpIHJldHVybiBhKFwiYWpheFN1Ym1pdDogc2tpcHBpbmcgc3VibWl0IHByb2Nlc3MgLSBubyBlbGVtZW50IHNlbGVjdGVkXCIpLCB0aGlzO3ZhciB1LFxuICAgICAgICBsLFxuICAgICAgICBjLFxuICAgICAgICBmID0gdGhpcztcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQgJiYgKHQgPSB7IHN1Y2Nlc3M6IHQgfSksIHUgPSB0LnR5cGUgfHwgdGhpcy5hdHRyMihcIm1ldGhvZFwiKSwgbCA9IHQudXJsIHx8IHRoaXMuYXR0cjIoXCJhY3Rpb25cIiksIGMgPSBcInN0cmluZ1wiID09IHR5cGVvZiBsID8gZS50cmltKGwpIDogXCJcIiwgYyA9IGMgfHwgd2luZG93LmxvY2F0aW9uLmhyZWYgfHwgXCJcIiwgYyAmJiAoYyA9IChjLm1hdGNoKC9eKFteI10rKS8pIHx8IFtdKVsxXSksIHQgPSBlLmV4dGVuZCghMCwgeyB1cmw6IGMsIHN1Y2Nlc3M6IGUuYWpheFNldHRpbmdzLnN1Y2Nlc3MsIHR5cGU6IHUgfHwgXCJHRVRcIiwgaWZyYW1lU3JjOiAvXmh0dHBzL2kudGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZiB8fCBcIlwiKSA/IFwiamF2YXNjcmlwdDpmYWxzZVwiIDogXCJhYm91dDpibGFua1wiIH0sIHQpO3ZhciBtID0ge307aWYgKHRoaXMudHJpZ2dlcihcImZvcm0tcHJlLXNlcmlhbGl6ZVwiLCBbdGhpcywgdCwgbV0pLCBtLnZldG8pIHJldHVybiBhKFwiYWpheFN1Ym1pdDogc3VibWl0IHZldG9lZCB2aWEgZm9ybS1wcmUtc2VyaWFsaXplIHRyaWdnZXJcIiksIHRoaXM7aWYgKHQuYmVmb3JlU2VyaWFsaXplICYmIHQuYmVmb3JlU2VyaWFsaXplKHRoaXMsIHQpID09PSAhMSkgcmV0dXJuIGEoXCJhamF4U3VibWl0OiBzdWJtaXQgYWJvcnRlZCB2aWEgYmVmb3JlU2VyaWFsaXplIGNhbGxiYWNrXCIpLCB0aGlzO3ZhciBwID0gdC50cmFkaXRpb25hbDt2b2lkIDAgPT09IHAgJiYgKHAgPSBlLmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbCk7dmFyIGQsXG4gICAgICAgIGggPSBbXSxcbiAgICAgICAgdiA9IHRoaXMuZm9ybVRvQXJyYXkodC5zZW1hbnRpYywgaCk7aWYgKHQuZGF0YSAmJiAodC5leHRyYURhdGEgPSB0LmRhdGEsIGQgPSBlLnBhcmFtKHQuZGF0YSwgcCkpLCB0LmJlZm9yZVN1Ym1pdCAmJiB0LmJlZm9yZVN1Ym1pdCh2LCB0aGlzLCB0KSA9PT0gITEpIHJldHVybiBhKFwiYWpheFN1Ym1pdDogc3VibWl0IGFib3J0ZWQgdmlhIGJlZm9yZVN1Ym1pdCBjYWxsYmFja1wiKSwgdGhpcztpZiAodGhpcy50cmlnZ2VyKFwiZm9ybS1zdWJtaXQtdmFsaWRhdGVcIiwgW3YsIHRoaXMsIHQsIG1dKSwgbS52ZXRvKSByZXR1cm4gYShcImFqYXhTdWJtaXQ6IHN1Ym1pdCB2ZXRvZWQgdmlhIGZvcm0tc3VibWl0LXZhbGlkYXRlIHRyaWdnZXJcIiksIHRoaXM7dmFyIGcgPSBlLnBhcmFtKHYsIHApO2QgJiYgKGcgPSBnID8gZyArIFwiJlwiICsgZCA6IGQpLCBcIkdFVFwiID09IHQudHlwZS50b1VwcGVyQ2FzZSgpID8gKHQudXJsICs9ICh0LnVybC5pbmRleE9mKFwiP1wiKSA+PSAwID8gXCImXCIgOiBcIj9cIikgKyBnLCB0LmRhdGEgPSBudWxsKSA6IHQuZGF0YSA9IGc7dmFyIHggPSBbXTtpZiAodC5yZXNldEZvcm0gJiYgeC5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIGYucmVzZXRGb3JtKCk7XG4gICAgfSksIHQuY2xlYXJGb3JtICYmIHgucHVzaChmdW5jdGlvbiAoKSB7XG4gICAgICBmLmNsZWFyRm9ybSh0LmluY2x1ZGVIaWRkZW4pO1xuICAgIH0pLCAhdC5kYXRhVHlwZSAmJiB0LnRhcmdldCkge1xuICAgICAgdmFyIGIgPSB0LnN1Y2Nlc3MgfHwgZnVuY3Rpb24gKCkge307eC5wdXNoKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgIHZhciBhID0gdC5yZXBsYWNlVGFyZ2V0ID8gXCJyZXBsYWNlV2l0aFwiIDogXCJodG1sXCI7ZSh0LnRhcmdldClbYV0ocikuZWFjaChiLCBhcmd1bWVudHMpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHQuc3VjY2VzcyAmJiB4LnB1c2godC5zdWNjZXNzKTtpZiAodC5zdWNjZXNzID0gZnVuY3Rpb24gKGUsIHIsIGEpIHtcbiAgICAgIGZvciAodmFyIG4gPSB0LmNvbnRleHQgfHwgdGhpcywgaSA9IDAsIG8gPSB4Lmxlbmd0aDsgbyA+IGk7IGkrKykge1xuICAgICAgICB4W2ldLmFwcGx5KG4sIFtlLCByLCBhIHx8IGYsIGZdKTtcbiAgICAgIH1cbiAgICB9LCB0LmVycm9yKSB7XG4gICAgICB2YXIgeSA9IHQuZXJyb3I7dC5lcnJvciA9IGZ1bmN0aW9uIChlLCByLCBhKSB7XG4gICAgICAgIHZhciBuID0gdC5jb250ZXh0IHx8IHRoaXM7eS5hcHBseShuLCBbZSwgciwgYSwgZl0pO1xuICAgICAgfTtcbiAgICB9aWYgKHQuY29tcGxldGUpIHtcbiAgICAgIHZhciBUID0gdC5jb21wbGV0ZTt0LmNvbXBsZXRlID0gZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgICAgdmFyIGEgPSB0LmNvbnRleHQgfHwgdGhpcztULmFwcGx5KGEsIFtlLCByLCBmXSk7XG4gICAgICB9O1xuICAgIH12YXIgaiA9IGUoJ2lucHV0W3R5cGU9ZmlsZV06ZW5hYmxlZFt2YWx1ZSE9XCJcIl0nLCB0aGlzKSxcbiAgICAgICAgdyA9IGoubGVuZ3RoID4gMCxcbiAgICAgICAgUyA9IFwibXVsdGlwYXJ0L2Zvcm0tZGF0YVwiLFxuICAgICAgICBrID0gZi5hdHRyKFwiZW5jdHlwZVwiKSA9PSBTIHx8IGYuYXR0cihcImVuY29kaW5nXCIpID09IFMsXG4gICAgICAgIEQgPSBuLmZpbGVhcGkgJiYgbi5mb3JtZGF0YTthKFwiZmlsZUFQSSA6XCIgKyBEKTt2YXIgQSxcbiAgICAgICAgRSA9ICh3IHx8IGspICYmICFEO3QuaWZyYW1lICE9PSAhMSAmJiAodC5pZnJhbWUgfHwgRSkgPyB0LmNsb3NlS2VlcEFsaXZlID8gZS5nZXQodC5jbG9zZUtlZXBBbGl2ZSwgZnVuY3Rpb24gKCkge1xuICAgICAgQSA9IHModik7XG4gICAgfSkgOiBBID0gcyh2KSA6IEEgPSAodyB8fCBrKSAmJiBEID8gbyh2KSA6IGUuYWpheCh0KSwgZi5yZW1vdmVEYXRhKFwianF4aHJcIikuZGF0YShcImpxeGhyXCIsIEEpO2ZvciAodmFyIEwgPSAwOyBoLmxlbmd0aCA+IEw7IEwrKykge1xuICAgICAgaFtMXSA9IG51bGw7XG4gICAgfXJldHVybiB0aGlzLnRyaWdnZXIoXCJmb3JtLXN1Ym1pdC1ub3RpZnlcIiwgW3RoaXMsIHRdKSwgdGhpcztcbiAgfSwgZS5mbi5hamF4Rm9ybSA9IGZ1bmN0aW9uIChuKSB7XG4gICAgaWYgKG4gPSBuIHx8IHt9LCBuLmRlbGVnYXRpb24gPSBuLmRlbGVnYXRpb24gJiYgZS5pc0Z1bmN0aW9uKGUuZm4ub24pLCAhbi5kZWxlZ2F0aW9uICYmIDAgPT09IHRoaXMubGVuZ3RoKSB7XG4gICAgICB2YXIgaSA9IHsgczogdGhpcy5zZWxlY3RvciwgYzogdGhpcy5jb250ZXh0IH07cmV0dXJuICFlLmlzUmVhZHkgJiYgaS5zID8gKGEoXCJET00gbm90IHJlYWR5LCBxdWV1aW5nIGFqYXhGb3JtXCIpLCBlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZShpLnMsIGkuYykuYWpheEZvcm0obik7XG4gICAgICB9KSwgdGhpcykgOiAoYShcInRlcm1pbmF0aW5nOyB6ZXJvIGVsZW1lbnRzIGZvdW5kIGJ5IHNlbGVjdG9yXCIgKyAoZS5pc1JlYWR5ID8gXCJcIiA6IFwiIChET00gbm90IHJlYWR5KVwiKSksIHRoaXMpO1xuICAgIH1yZXR1cm4gbi5kZWxlZ2F0aW9uID8gKGUoZG9jdW1lbnQpLm9mZihcInN1Ym1pdC5mb3JtLXBsdWdpblwiLCB0aGlzLnNlbGVjdG9yLCB0KS5vZmYoXCJjbGljay5mb3JtLXBsdWdpblwiLCB0aGlzLnNlbGVjdG9yLCByKS5vbihcInN1Ym1pdC5mb3JtLXBsdWdpblwiLCB0aGlzLnNlbGVjdG9yLCBuLCB0KS5vbihcImNsaWNrLmZvcm0tcGx1Z2luXCIsIHRoaXMuc2VsZWN0b3IsIG4sIHIpLCB0aGlzKSA6IHRoaXMuYWpheEZvcm1VbmJpbmQoKS5iaW5kKFwic3VibWl0LmZvcm0tcGx1Z2luXCIsIG4sIHQpLmJpbmQoXCJjbGljay5mb3JtLXBsdWdpblwiLCBuLCByKTtcbiAgfSwgZS5mbi5hamF4Rm9ybVVuYmluZCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy51bmJpbmQoXCJzdWJtaXQuZm9ybS1wbHVnaW4gY2xpY2suZm9ybS1wbHVnaW5cIik7XG4gIH0sIGUuZm4uZm9ybVRvQXJyYXkgPSBmdW5jdGlvbiAodCwgcikge1xuICAgIHZhciBhID0gW107aWYgKDAgPT09IHRoaXMubGVuZ3RoKSByZXR1cm4gYTt2YXIgaSA9IHRoaXNbMF0sXG4gICAgICAgIG8gPSB0ID8gaS5nZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikgOiBpLmVsZW1lbnRzO2lmICghbykgcmV0dXJuIGE7dmFyIHMsIHUsIGwsIGMsIGYsIG0sIHA7Zm9yIChzID0gMCwgbSA9IG8ubGVuZ3RoOyBtID4gczsgcysrKSB7XG4gICAgICBpZiAoZiA9IG9bc10sIGwgPSBmLm5hbWUsIGwgJiYgIWYuZGlzYWJsZWQpIGlmICh0ICYmIGkuY2xrICYmIFwiaW1hZ2VcIiA9PSBmLnR5cGUpIGkuY2xrID09IGYgJiYgKGEucHVzaCh7IG5hbWU6IGwsIHZhbHVlOiBlKGYpLnZhbCgpLCB0eXBlOiBmLnR5cGUgfSksIGEucHVzaCh7IG5hbWU6IGwgKyBcIi54XCIsIHZhbHVlOiBpLmNsa194IH0sIHsgbmFtZTogbCArIFwiLnlcIiwgdmFsdWU6IGkuY2xrX3kgfSkpO2Vsc2UgaWYgKGMgPSBlLmZpZWxkVmFsdWUoZiwgITApLCBjICYmIGMuY29uc3RydWN0b3IgPT0gQXJyYXkpIGZvciAociAmJiByLnB1c2goZiksIHUgPSAwLCBwID0gYy5sZW5ndGg7IHAgPiB1OyB1KyspIHtcbiAgICAgICAgYS5wdXNoKHsgbmFtZTogbCwgdmFsdWU6IGNbdV0gfSk7XG4gICAgICB9IGVsc2UgaWYgKG4uZmlsZWFwaSAmJiBcImZpbGVcIiA9PSBmLnR5cGUpIHtcbiAgICAgICAgciAmJiByLnB1c2goZik7dmFyIGQgPSBmLmZpbGVzO2lmIChkLmxlbmd0aCkgZm9yICh1ID0gMDsgZC5sZW5ndGggPiB1OyB1KyspIHtcbiAgICAgICAgICBhLnB1c2goeyBuYW1lOiBsLCB2YWx1ZTogZFt1XSwgdHlwZTogZi50eXBlIH0pO1xuICAgICAgICB9IGVsc2UgYS5wdXNoKHsgbmFtZTogbCwgdmFsdWU6IFwiXCIsIHR5cGU6IGYudHlwZSB9KTtcbiAgICAgIH0gZWxzZSBudWxsICE9PSBjICYmIGMgIT09IHZvaWQgMCAmJiAociAmJiByLnB1c2goZiksIGEucHVzaCh7IG5hbWU6IGwsIHZhbHVlOiBjLCB0eXBlOiBmLnR5cGUsIHJlcXVpcmVkOiBmLnJlcXVpcmVkIH0pKTtcbiAgICB9aWYgKCF0ICYmIGkuY2xrKSB7XG4gICAgICB2YXIgaCA9IGUoaS5jbGspLFxuICAgICAgICAgIHYgPSBoWzBdO2wgPSB2Lm5hbWUsIGwgJiYgIXYuZGlzYWJsZWQgJiYgXCJpbWFnZVwiID09IHYudHlwZSAmJiAoYS5wdXNoKHsgbmFtZTogbCwgdmFsdWU6IGgudmFsKCkgfSksIGEucHVzaCh7IG5hbWU6IGwgKyBcIi54XCIsIHZhbHVlOiBpLmNsa194IH0sIHsgbmFtZTogbCArIFwiLnlcIiwgdmFsdWU6IGkuY2xrX3kgfSkpO1xuICAgIH1yZXR1cm4gYTtcbiAgfSwgZS5mbi5mb3JtU2VyaWFsaXplID0gZnVuY3Rpb24gKHQpIHtcbiAgICByZXR1cm4gZS5wYXJhbSh0aGlzLmZvcm1Ub0FycmF5KHQpKTtcbiAgfSwgZS5mbi5maWVsZFNlcmlhbGl6ZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgdmFyIHIgPSBbXTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBhID0gdGhpcy5uYW1lO2lmIChhKSB7XG4gICAgICAgIHZhciBuID0gZS5maWVsZFZhbHVlKHRoaXMsIHQpO2lmIChuICYmIG4uY29uc3RydWN0b3IgPT0gQXJyYXkpIGZvciAodmFyIGkgPSAwLCBvID0gbi5sZW5ndGg7IG8gPiBpOyBpKyspIHtcbiAgICAgICAgICByLnB1c2goeyBuYW1lOiBhLCB2YWx1ZTogbltpXSB9KTtcbiAgICAgICAgfSBlbHNlIG51bGwgIT09IG4gJiYgbiAhPT0gdm9pZCAwICYmIHIucHVzaCh7IG5hbWU6IHRoaXMubmFtZSwgdmFsdWU6IG4gfSk7XG4gICAgICB9XG4gICAgfSksIGUucGFyYW0ocik7XG4gIH0sIGUuZm4uZmllbGRWYWx1ZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgZm9yICh2YXIgciA9IFtdLCBhID0gMCwgbiA9IHRoaXMubGVuZ3RoOyBuID4gYTsgYSsrKSB7XG4gICAgICB2YXIgaSA9IHRoaXNbYV0sXG4gICAgICAgICAgbyA9IGUuZmllbGRWYWx1ZShpLCB0KTtudWxsID09PSBvIHx8IHZvaWQgMCA9PT0gbyB8fCBvLmNvbnN0cnVjdG9yID09IEFycmF5ICYmICFvLmxlbmd0aCB8fCAoby5jb25zdHJ1Y3RvciA9PSBBcnJheSA/IGUubWVyZ2UociwgbykgOiByLnB1c2gobykpO1xuICAgIH1yZXR1cm4gcjtcbiAgfSwgZS5maWVsZFZhbHVlID0gZnVuY3Rpb24gKHQsIHIpIHtcbiAgICB2YXIgYSA9IHQubmFtZSxcbiAgICAgICAgbiA9IHQudHlwZSxcbiAgICAgICAgaSA9IHQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO2lmICh2b2lkIDAgPT09IHIgJiYgKHIgPSAhMCksIHIgJiYgKCFhIHx8IHQuZGlzYWJsZWQgfHwgXCJyZXNldFwiID09IG4gfHwgXCJidXR0b25cIiA9PSBuIHx8IChcImNoZWNrYm94XCIgPT0gbiB8fCBcInJhZGlvXCIgPT0gbikgJiYgIXQuY2hlY2tlZCB8fCAoXCJzdWJtaXRcIiA9PSBuIHx8IFwiaW1hZ2VcIiA9PSBuKSAmJiB0LmZvcm0gJiYgdC5mb3JtLmNsayAhPSB0IHx8IFwic2VsZWN0XCIgPT0gaSAmJiAtMSA9PSB0LnNlbGVjdGVkSW5kZXgpKSByZXR1cm4gbnVsbDtpZiAoXCJzZWxlY3RcIiA9PSBpKSB7XG4gICAgICB2YXIgbyA9IHQuc2VsZWN0ZWRJbmRleDtpZiAoMCA+IG8pIHJldHVybiBudWxsO2ZvciAodmFyIHMgPSBbXSwgdSA9IHQub3B0aW9ucywgbCA9IFwic2VsZWN0LW9uZVwiID09IG4sIGMgPSBsID8gbyArIDEgOiB1Lmxlbmd0aCwgZiA9IGwgPyBvIDogMDsgYyA+IGY7IGYrKykge1xuICAgICAgICB2YXIgbSA9IHVbZl07aWYgKG0uc2VsZWN0ZWQpIHtcbiAgICAgICAgICB2YXIgcCA9IG0udmFsdWU7aWYgKHAgfHwgKHAgPSBtLmF0dHJpYnV0ZXMgJiYgbS5hdHRyaWJ1dGVzLnZhbHVlICYmICFtLmF0dHJpYnV0ZXMudmFsdWUuc3BlY2lmaWVkID8gbS50ZXh0IDogbS52YWx1ZSksIGwpIHJldHVybiBwO3MucHVzaChwKTtcbiAgICAgICAgfVxuICAgICAgfXJldHVybiBzO1xuICAgIH1yZXR1cm4gZSh0KS52YWwoKTtcbiAgfSwgZS5mbi5jbGVhckZvcm0gPSBmdW5jdGlvbiAodCkge1xuICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgZShcImlucHV0LHNlbGVjdCx0ZXh0YXJlYVwiLCB0aGlzKS5jbGVhckZpZWxkcyh0KTtcbiAgICB9KTtcbiAgfSwgZS5mbi5jbGVhckZpZWxkcyA9IGUuZm4uY2xlYXJJbnB1dHMgPSBmdW5jdGlvbiAodCkge1xuICAgIHZhciByID0gL14oPzpjb2xvcnxkYXRlfGRhdGV0aW1lfGVtYWlsfG1vbnRofG51bWJlcnxwYXNzd29yZHxyYW5nZXxzZWFyY2h8dGVsfHRleHR8dGltZXx1cmx8d2VlaykkL2k7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYSA9IHRoaXMudHlwZSxcbiAgICAgICAgICBuID0gdGhpcy50YWdOYW1lLnRvTG93ZXJDYXNlKCk7ci50ZXN0KGEpIHx8IFwidGV4dGFyZWFcIiA9PSBuID8gdGhpcy52YWx1ZSA9IFwiXCIgOiBcImNoZWNrYm94XCIgPT0gYSB8fCBcInJhZGlvXCIgPT0gYSA/IHRoaXMuY2hlY2tlZCA9ICExIDogXCJzZWxlY3RcIiA9PSBuID8gdGhpcy5zZWxlY3RlZEluZGV4ID0gLTEgOiBcImZpbGVcIiA9PSBhID8gL01TSUUvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgPyBlKHRoaXMpLnJlcGxhY2VXaXRoKGUodGhpcykuY2xvbmUoITApKSA6IGUodGhpcykudmFsKFwiXCIpIDogdCAmJiAodCA9PT0gITAgJiYgL2hpZGRlbi8udGVzdChhKSB8fCBcInN0cmluZ1wiID09IHR5cGVvZiB0ICYmIGUodGhpcykuaXModCkpICYmICh0aGlzLnZhbHVlID0gXCJcIik7XG4gICAgfSk7XG4gIH0sIGUuZm4ucmVzZXRGb3JtID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgKFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdGhpcy5yZXNldCB8fCBcIm9iamVjdFwiID09IF90eXBlb2YodGhpcy5yZXNldCkgJiYgIXRoaXMucmVzZXQubm9kZVR5cGUpICYmIHRoaXMucmVzZXQoKTtcbiAgICB9KTtcbiAgfSwgZS5mbi5lbmFibGUgPSBmdW5jdGlvbiAoZSkge1xuICAgIHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSAhMCksIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmRpc2FibGVkID0gIWU7XG4gICAgfSk7XG4gIH0sIGUuZm4uc2VsZWN0ZWQgPSBmdW5jdGlvbiAodCkge1xuICAgIHJldHVybiB2b2lkIDAgPT09IHQgJiYgKHQgPSAhMCksIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgciA9IHRoaXMudHlwZTtpZiAoXCJjaGVja2JveFwiID09IHIgfHwgXCJyYWRpb1wiID09IHIpIHRoaXMuY2hlY2tlZCA9IHQ7ZWxzZSBpZiAoXCJvcHRpb25cIiA9PSB0aGlzLnRhZ05hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICB2YXIgYSA9IGUodGhpcykucGFyZW50KFwic2VsZWN0XCIpO3QgJiYgYVswXSAmJiBcInNlbGVjdC1vbmVcIiA9PSBhWzBdLnR5cGUgJiYgYS5maW5kKFwib3B0aW9uXCIpLnNlbGVjdGVkKCExKSwgdGhpcy5zZWxlY3RlZCA9IHQ7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sIGUuZm4uYWpheFN1Ym1pdC5kZWJ1ZyA9ICExO1xufSkoalF1ZXJ5KTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09IFwic3ltYm9sXCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTtcblxuKGZ1bmN0aW9uICh3aW5kb3cpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKmdsb2JhbCBkZWZpbmUsIG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSAqL1xuXG4gICAgdmFyIGMzID0geyB2ZXJzaW9uOiBcIjAuNC4xMVwiIH07XG5cbiAgICB2YXIgYzNfY2hhcnRfZm4sIGMzX2NoYXJ0X2ludGVybmFsX2ZuLCBjM19jaGFydF9pbnRlcm5hbF9heGlzX2ZuO1xuXG4gICAgZnVuY3Rpb24gQVBJKG93bmVyKSB7XG4gICAgICAgIHRoaXMub3duZXIgPSBvd25lcjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbmhlcml0KGJhc2UsIGRlcml2ZWQpIHtcblxuICAgICAgICBpZiAoT2JqZWN0LmNyZWF0ZSkge1xuICAgICAgICAgICAgZGVyaXZlZC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGJhc2UucHJvdG90eXBlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBmID0gZnVuY3Rpb24gZigpIHt9O1xuICAgICAgICAgICAgZi5wcm90b3R5cGUgPSBiYXNlLnByb3RvdHlwZTtcbiAgICAgICAgICAgIGRlcml2ZWQucHJvdG90eXBlID0gbmV3IGYoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRlcml2ZWQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gZGVyaXZlZDtcblxuICAgICAgICByZXR1cm4gZGVyaXZlZDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBDaGFydChjb25maWcpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbCA9IG5ldyBDaGFydEludGVybmFsKHRoaXMpO1xuICAgICAgICAkJC5sb2FkQ29uZmlnKGNvbmZpZyk7XG5cbiAgICAgICAgJCQuYmVmb3JlSW5pdChjb25maWcpO1xuICAgICAgICAkJC5pbml0KCk7XG4gICAgICAgICQkLmFmdGVySW5pdChjb25maWcpO1xuXG4gICAgICAgIC8vIGJpbmQgXCJ0aGlzXCIgdG8gbmVzdGVkIEFQSVxuICAgICAgICAoZnVuY3Rpb24gYmluZFRoaXMoZm4sIHRhcmdldCwgYXJnVGhpcykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoZm4pLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gZm5ba2V5XS5iaW5kKGFyZ1RoaXMpO1xuICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhmbltrZXldKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGJpbmRUaGlzKGZuW2tleV0sIHRhcmdldFtrZXldLCBhcmdUaGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkoYzNfY2hhcnRfZm4sIHRoaXMsIHRoaXMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIENoYXJ0SW50ZXJuYWwoYXBpKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgICQkLmQzID0gd2luZG93LmQzID8gd2luZG93LmQzIDogdHlwZW9mIHJlcXVpcmUgIT09ICd1bmRlZmluZWQnID8gcmVxdWlyZShcImQzXCIpIDogdW5kZWZpbmVkO1xuICAgICAgICAkJC5hcGkgPSBhcGk7XG4gICAgICAgICQkLmNvbmZpZyA9ICQkLmdldERlZmF1bHRDb25maWcoKTtcbiAgICAgICAgJCQuZGF0YSA9IHt9O1xuICAgICAgICAkJC5jYWNoZSA9IHt9O1xuICAgICAgICAkJC5heGVzID0ge307XG4gICAgfVxuXG4gICAgYzMuZ2VuZXJhdGUgPSBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ2hhcnQoY29uZmlnKTtcbiAgICB9O1xuXG4gICAgYzMuY2hhcnQgPSB7XG4gICAgICAgIGZuOiBDaGFydC5wcm90b3R5cGUsXG4gICAgICAgIGludGVybmFsOiB7XG4gICAgICAgICAgICBmbjogQ2hhcnRJbnRlcm5hbC5wcm90b3R5cGUsXG4gICAgICAgICAgICBheGlzOiB7XG4gICAgICAgICAgICAgICAgZm46IEF4aXMucHJvdG90eXBlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ZuID0gYzMuY2hhcnQuZm47XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4gPSBjMy5jaGFydC5pbnRlcm5hbC5mbjtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9heGlzX2ZuID0gYzMuY2hhcnQuaW50ZXJuYWwuYXhpcy5mbjtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmJlZm9yZUluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGNhbiBkbyBzb21ldGhpbmdcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmFmdGVySW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gY2FuIGRvIHNvbWV0aGluZ1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcblxuICAgICAgICAkJC5pbml0UGFyYW1zKCk7XG5cbiAgICAgICAgaWYgKGNvbmZpZy5kYXRhX3VybCkge1xuICAgICAgICAgICAgJCQuY29udmVydFVybFRvRGF0YShjb25maWcuZGF0YV91cmwsIGNvbmZpZy5kYXRhX21pbWVUeXBlLCBjb25maWcuZGF0YV9oZWFkZXJzLCBjb25maWcuZGF0YV9rZXlzLCAkJC5pbml0V2l0aERhdGEpO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy5kYXRhX2pzb24pIHtcbiAgICAgICAgICAgICQkLmluaXRXaXRoRGF0YSgkJC5jb252ZXJ0SnNvblRvRGF0YShjb25maWcuZGF0YV9qc29uLCBjb25maWcuZGF0YV9rZXlzKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLmRhdGFfcm93cykge1xuICAgICAgICAgICAgJCQuaW5pdFdpdGhEYXRhKCQkLmNvbnZlcnRSb3dzVG9EYXRhKGNvbmZpZy5kYXRhX3Jvd3MpKTtcbiAgICAgICAgfSBlbHNlIGlmIChjb25maWcuZGF0YV9jb2x1bW5zKSB7XG4gICAgICAgICAgICAkJC5pbml0V2l0aERhdGEoJCQuY29udmVydENvbHVtbnNUb0RhdGEoY29uZmlnLmRhdGFfY29sdW1ucykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ3VybCBvciBqc29uIG9yIHJvd3Mgb3IgY29sdW1ucyBpcyByZXF1aXJlZC4nKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0UGFyYW1zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZDMgPSAkJC5kMyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcblxuICAgICAgICAvLyBNRU1POiBjbGlwSWQgbmVlZHMgdG8gYmUgdW5pcXVlIGJlY2F1c2UgaXQgY29uZmxpY3RzIHdoZW4gbXVsdGlwbGUgY2hhcnRzIGV4aXN0XG4gICAgICAgICQkLmNsaXBJZCA9IFwiYzMtXCIgKyArbmV3IERhdGUoKSArICctY2xpcCcsICQkLmNsaXBJZEZvclhBeGlzID0gJCQuY2xpcElkICsgJy14YXhpcycsICQkLmNsaXBJZEZvcllBeGlzID0gJCQuY2xpcElkICsgJy15YXhpcycsICQkLmNsaXBJZEZvckdyaWQgPSAkJC5jbGlwSWQgKyAnLWdyaWQnLCAkJC5jbGlwSWRGb3JTdWJjaGFydCA9ICQkLmNsaXBJZCArICctc3ViY2hhcnQnLCAkJC5jbGlwUGF0aCA9ICQkLmdldENsaXBQYXRoKCQkLmNsaXBJZCksICQkLmNsaXBQYXRoRm9yWEF4aXMgPSAkJC5nZXRDbGlwUGF0aCgkJC5jbGlwSWRGb3JYQXhpcyksICQkLmNsaXBQYXRoRm9yWUF4aXMgPSAkJC5nZXRDbGlwUGF0aCgkJC5jbGlwSWRGb3JZQXhpcyk7XG4gICAgICAgICQkLmNsaXBQYXRoRm9yR3JpZCA9ICQkLmdldENsaXBQYXRoKCQkLmNsaXBJZEZvckdyaWQpLCAkJC5jbGlwUGF0aEZvclN1YmNoYXJ0ID0gJCQuZ2V0Q2xpcFBhdGgoJCQuY2xpcElkRm9yU3ViY2hhcnQpLCAkJC5kcmFnU3RhcnQgPSBudWxsO1xuICAgICAgICAkJC5kcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICAkJC5mbG93aW5nID0gZmFsc2U7XG4gICAgICAgICQkLmNhbmNlbENsaWNrID0gZmFsc2U7XG4gICAgICAgICQkLm1vdXNlb3ZlciA9IGZhbHNlO1xuICAgICAgICAkJC50cmFuc2l0aW5nID0gZmFsc2U7XG5cbiAgICAgICAgJCQuY29sb3IgPSAkJC5nZW5lcmF0ZUNvbG9yKCk7XG4gICAgICAgICQkLmxldmVsQ29sb3IgPSAkJC5nZW5lcmF0ZUxldmVsQ29sb3IoKTtcblxuICAgICAgICAkJC5kYXRhVGltZUZvcm1hdCA9IGNvbmZpZy5kYXRhX3hMb2NhbHRpbWUgPyBkMy50aW1lLmZvcm1hdCA6IGQzLnRpbWUuZm9ybWF0LnV0YztcbiAgICAgICAgJCQuYXhpc1RpbWVGb3JtYXQgPSBjb25maWcuYXhpc194X2xvY2FsdGltZSA/IGQzLnRpbWUuZm9ybWF0IDogZDMudGltZS5mb3JtYXQudXRjO1xuICAgICAgICAkJC5kZWZhdWx0QXhpc1RpbWVGb3JtYXQgPSAkJC5heGlzVGltZUZvcm1hdC5tdWx0aShbW1wiLiVMXCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZC5nZXRNaWxsaXNlY29uZHMoKTtcbiAgICAgICAgfV0sIFtcIjolU1wiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGQuZ2V0U2Vjb25kcygpO1xuICAgICAgICB9XSwgW1wiJUk6JU1cIiwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBkLmdldE1pbnV0ZXMoKTtcbiAgICAgICAgfV0sIFtcIiVJICVwXCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZC5nZXRIb3VycygpO1xuICAgICAgICB9XSwgW1wiJS1tLyUtZFwiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGQuZ2V0RGF5KCkgJiYgZC5nZXREYXRlKCkgIT09IDE7XG4gICAgICAgIH1dLCBbXCIlLW0vJS1kXCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZC5nZXREYXRlKCkgIT09IDE7XG4gICAgICAgIH1dLCBbXCIlLW0vJS1kXCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZC5nZXRNb250aCgpO1xuICAgICAgICB9XSwgW1wiJVkvJS1tLyUtZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfV1dKTtcblxuICAgICAgICAkJC5oaWRkZW5UYXJnZXRJZHMgPSBbXTtcbiAgICAgICAgJCQuaGlkZGVuTGVnZW5kSWRzID0gW107XG4gICAgICAgICQkLmZvY3VzZWRUYXJnZXRJZHMgPSBbXTtcbiAgICAgICAgJCQuZGVmb2N1c2VkVGFyZ2V0SWRzID0gW107XG5cbiAgICAgICAgJCQueE9yaWVudCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyBcImxlZnRcIiA6IFwiYm90dG9tXCI7XG4gICAgICAgICQkLnlPcmllbnQgPSBjb25maWcuYXhpc19yb3RhdGVkID8gY29uZmlnLmF4aXNfeV9pbm5lciA/IFwidG9wXCIgOiBcImJvdHRvbVwiIDogY29uZmlnLmF4aXNfeV9pbm5lciA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuICAgICAgICAkJC55Mk9yaWVudCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyBjb25maWcuYXhpc195Ml9pbm5lciA/IFwiYm90dG9tXCIgOiBcInRvcFwiIDogY29uZmlnLmF4aXNfeTJfaW5uZXIgPyBcImxlZnRcIiA6IFwicmlnaHRcIjtcbiAgICAgICAgJCQuc3ViWE9yaWVudCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyBcImxlZnRcIiA6IFwiYm90dG9tXCI7XG5cbiAgICAgICAgJCQuaXNMZWdlbmRSaWdodCA9IGNvbmZpZy5sZWdlbmRfcG9zaXRpb24gPT09ICdyaWdodCc7XG4gICAgICAgICQkLmlzTGVnZW5kSW5zZXQgPSBjb25maWcubGVnZW5kX3Bvc2l0aW9uID09PSAnaW5zZXQnO1xuICAgICAgICAkJC5pc0xlZ2VuZFRvcCA9IGNvbmZpZy5sZWdlbmRfaW5zZXRfYW5jaG9yID09PSAndG9wLWxlZnQnIHx8IGNvbmZpZy5sZWdlbmRfaW5zZXRfYW5jaG9yID09PSAndG9wLXJpZ2h0JztcbiAgICAgICAgJCQuaXNMZWdlbmRMZWZ0ID0gY29uZmlnLmxlZ2VuZF9pbnNldF9hbmNob3IgPT09ICd0b3AtbGVmdCcgfHwgY29uZmlnLmxlZ2VuZF9pbnNldF9hbmNob3IgPT09ICdib3R0b20tbGVmdCc7XG4gICAgICAgICQkLmxlZ2VuZFN0ZXAgPSAwO1xuICAgICAgICAkJC5sZWdlbmRJdGVtV2lkdGggPSAwO1xuICAgICAgICAkJC5sZWdlbmRJdGVtSGVpZ2h0ID0gMDtcblxuICAgICAgICAkJC5jdXJyZW50TWF4VGlja1dpZHRocyA9IHtcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgeTI6IDBcbiAgICAgICAgfTtcblxuICAgICAgICAkJC5yb3RhdGVkX3BhZGRpbmdfbGVmdCA9IDMwO1xuICAgICAgICAkJC5yb3RhdGVkX3BhZGRpbmdfcmlnaHQgPSBjb25maWcuYXhpc19yb3RhdGVkICYmICFjb25maWcuYXhpc194X3Nob3cgPyAwIDogMzA7XG4gICAgICAgICQkLnJvdGF0ZWRfcGFkZGluZ190b3AgPSA1O1xuXG4gICAgICAgICQkLndpdGhvdXRGYWRlSW4gPSB7fTtcblxuICAgICAgICAkJC5pbnRlcnZhbEZvck9ic2VydmVJbnNlcnRlZCA9IHVuZGVmaW5lZDtcblxuICAgICAgICAkJC5heGVzLnN1YnggPSBkMy5zZWxlY3RBbGwoW10pOyAvLyBuZWVkcyB3aGVuIGV4Y2x1ZGluZyBzdWJjaGFydC5qc1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0Q2hhcnRFbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5pdEJhcikge1xuICAgICAgICAgICAgdGhpcy5pbml0QmFyKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaW5pdExpbmUpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdExpbmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pbml0QXJjKSB7XG4gICAgICAgICAgICB0aGlzLmluaXRBcmMoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pbml0R2F1Z2UpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdEdhdWdlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaW5pdFRleHQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdFRleHQoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0V2l0aERhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZDMgPSAkJC5kMyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgdmFyIGRlZnMsXG4gICAgICAgICAgICBtYWluLFxuICAgICAgICAgICAgYmluZGluZyA9IHRydWU7XG5cbiAgICAgICAgJCQuYXhpcyA9IG5ldyBBeGlzKCQkKTtcblxuICAgICAgICBpZiAoJCQuaW5pdFBpZSkge1xuICAgICAgICAgICAgJCQuaW5pdFBpZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkJC5pbml0QnJ1c2gpIHtcbiAgICAgICAgICAgICQkLmluaXRCcnVzaCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkJC5pbml0Wm9vbSkge1xuICAgICAgICAgICAgJCQuaW5pdFpvb20oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY29uZmlnLmJpbmR0bykge1xuICAgICAgICAgICAgJCQuc2VsZWN0Q2hhcnQgPSBkMy5zZWxlY3RBbGwoW10pO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcuYmluZHRvLm5vZGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICQkLnNlbGVjdENoYXJ0ID0gY29uZmlnLmJpbmR0bztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQkLnNlbGVjdENoYXJ0ID0gZDMuc2VsZWN0KGNvbmZpZy5iaW5kdG8pO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkJC5zZWxlY3RDaGFydC5lbXB0eSgpKSB7XG4gICAgICAgICAgICAkJC5zZWxlY3RDaGFydCA9IGQzLnNlbGVjdChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkuc3R5bGUoJ29wYWNpdHknLCAwKTtcbiAgICAgICAgICAgICQkLm9ic2VydmVJbnNlcnRlZCgkJC5zZWxlY3RDaGFydCk7XG4gICAgICAgICAgICBiaW5kaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgJCQuc2VsZWN0Q2hhcnQuaHRtbChcIlwiKS5jbGFzc2VkKFwiYzNcIiwgdHJ1ZSk7XG5cbiAgICAgICAgLy8gSW5pdCBkYXRhIGFzIHRhcmdldHNcbiAgICAgICAgJCQuZGF0YS54cyA9IHt9O1xuICAgICAgICAkJC5kYXRhLnRhcmdldHMgPSAkJC5jb252ZXJ0RGF0YVRvVGFyZ2V0cyhkYXRhKTtcblxuICAgICAgICBpZiAoY29uZmlnLmRhdGFfZmlsdGVyKSB7XG4gICAgICAgICAgICAkJC5kYXRhLnRhcmdldHMgPSAkJC5kYXRhLnRhcmdldHMuZmlsdGVyKGNvbmZpZy5kYXRhX2ZpbHRlcik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdGFyZ2V0cyB0byBoaWRlIGlmIG5lZWRlZFxuICAgICAgICBpZiAoY29uZmlnLmRhdGFfaGlkZSkge1xuICAgICAgICAgICAgJCQuYWRkSGlkZGVuVGFyZ2V0SWRzKGNvbmZpZy5kYXRhX2hpZGUgPT09IHRydWUgPyAkJC5tYXBUb0lkcygkJC5kYXRhLnRhcmdldHMpIDogY29uZmlnLmRhdGFfaGlkZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZy5sZWdlbmRfaGlkZSkge1xuICAgICAgICAgICAgJCQuYWRkSGlkZGVuTGVnZW5kSWRzKGNvbmZpZy5sZWdlbmRfaGlkZSA9PT0gdHJ1ZSA/ICQkLm1hcFRvSWRzKCQkLmRhdGEudGFyZ2V0cykgOiBjb25maWcubGVnZW5kX2hpZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gd2hlbiBnYXVnZSwgaGlkZSBsZWdlbmQgLy8gVE9ETzogZml4XG4gICAgICAgIGlmICgkJC5oYXNUeXBlKCdnYXVnZScpKSB7XG4gICAgICAgICAgICBjb25maWcubGVnZW5kX3Nob3cgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEluaXQgc2l6ZXMgYW5kIHNjYWxlc1xuICAgICAgICAkJC51cGRhdGVTaXplcygpO1xuICAgICAgICAkJC51cGRhdGVTY2FsZXMoKTtcblxuICAgICAgICAvLyBTZXQgZG9tYWlucyBmb3IgZWFjaCBzY2FsZVxuICAgICAgICAkJC54LmRvbWFpbihkMy5leHRlbnQoJCQuZ2V0WERvbWFpbigkJC5kYXRhLnRhcmdldHMpKSk7XG4gICAgICAgICQkLnkuZG9tYWluKCQkLmdldFlEb21haW4oJCQuZGF0YS50YXJnZXRzLCAneScpKTtcbiAgICAgICAgJCQueTIuZG9tYWluKCQkLmdldFlEb21haW4oJCQuZGF0YS50YXJnZXRzLCAneTInKSk7XG4gICAgICAgICQkLnN1YlguZG9tYWluKCQkLnguZG9tYWluKCkpO1xuICAgICAgICAkJC5zdWJZLmRvbWFpbigkJC55LmRvbWFpbigpKTtcbiAgICAgICAgJCQuc3ViWTIuZG9tYWluKCQkLnkyLmRvbWFpbigpKTtcblxuICAgICAgICAvLyBTYXZlIG9yaWdpbmFsIHggZG9tYWluIGZvciB6b29tIHVwZGF0ZVxuICAgICAgICAkJC5vcmdYRG9tYWluID0gJCQueC5kb21haW4oKTtcblxuICAgICAgICAvLyBTZXQgaW5pdGlhbGl6ZWQgc2NhbGVzIHRvIGJydXNoIGFuZCB6b29tXG4gICAgICAgIGlmICgkJC5icnVzaCkge1xuICAgICAgICAgICAgJCQuYnJ1c2guc2NhbGUoJCQuc3ViWCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZy56b29tX2VuYWJsZWQpIHtcbiAgICAgICAgICAgICQkLnpvb20uc2NhbGUoJCQueCk7XG4gICAgICAgIH1cblxuICAgICAgICAvKi0tIEJhc2ljIEVsZW1lbnRzIC0tKi9cblxuICAgICAgICAvLyBEZWZpbmUgc3Znc1xuICAgICAgICAkJC5zdmcgPSAkJC5zZWxlY3RDaGFydC5hcHBlbmQoXCJzdmdcIikuc3R5bGUoXCJvdmVyZmxvd1wiLCBcImhpZGRlblwiKS5vbignbW91c2VlbnRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWcub25tb3VzZW92ZXIuY2FsbCgkJCk7XG4gICAgICAgIH0pLm9uKCdtb3VzZWxlYXZlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5vbm1vdXNlb3V0LmNhbGwoJCQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoJCQuY29uZmlnLnN2Z19jbGFzc25hbWUpIHtcbiAgICAgICAgICAgICQkLnN2Zy5hdHRyKCdjbGFzcycsICQkLmNvbmZpZy5zdmdfY2xhc3NuYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERlZmluZSBkZWZzXG4gICAgICAgIGRlZnMgPSAkJC5zdmcuYXBwZW5kKFwiZGVmc1wiKTtcbiAgICAgICAgJCQuY2xpcENoYXJ0ID0gJCQuYXBwZW5kQ2xpcChkZWZzLCAkJC5jbGlwSWQpO1xuICAgICAgICAkJC5jbGlwWEF4aXMgPSAkJC5hcHBlbmRDbGlwKGRlZnMsICQkLmNsaXBJZEZvclhBeGlzKTtcbiAgICAgICAgJCQuY2xpcFlBeGlzID0gJCQuYXBwZW5kQ2xpcChkZWZzLCAkJC5jbGlwSWRGb3JZQXhpcyk7XG4gICAgICAgICQkLmNsaXBHcmlkID0gJCQuYXBwZW5kQ2xpcChkZWZzLCAkJC5jbGlwSWRGb3JHcmlkKTtcbiAgICAgICAgJCQuY2xpcFN1YmNoYXJ0ID0gJCQuYXBwZW5kQ2xpcChkZWZzLCAkJC5jbGlwSWRGb3JTdWJjaGFydCk7XG4gICAgICAgICQkLnVwZGF0ZVN2Z1NpemUoKTtcblxuICAgICAgICAvLyBEZWZpbmUgcmVnaW9uc1xuICAgICAgICBtYWluID0gJCQubWFpbiA9ICQkLnN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgJCQuZ2V0VHJhbnNsYXRlKCdtYWluJykpO1xuXG4gICAgICAgIGlmICgkJC5pbml0U3ViY2hhcnQpIHtcbiAgICAgICAgICAgICQkLmluaXRTdWJjaGFydCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkJC5pbml0VG9vbHRpcCkge1xuICAgICAgICAgICAgJCQuaW5pdFRvb2x0aXAoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJCQuaW5pdExlZ2VuZCkge1xuICAgICAgICAgICAgJCQuaW5pdExlZ2VuZCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkJC5pbml0VGl0bGUpIHtcbiAgICAgICAgICAgICQkLmluaXRUaXRsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyotLSBNYWluIFJlZ2lvbiAtLSovXG5cbiAgICAgICAgLy8gdGV4dCB3aGVuIGVtcHR5XG4gICAgICAgIG1haW4uYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MudGV4dCArICcgJyArIENMQVNTLmVtcHR5KS5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIikgLy8gaG9yaXpvbnRhbCBjZW50ZXJpbmcgb2YgdGV4dCBhdCB4IHBvc2l0aW9uIGluIGFsbCBicm93c2Vycy5cbiAgICAgICAgLmF0dHIoXCJkb21pbmFudC1iYXNlbGluZVwiLCBcIm1pZGRsZVwiKTsgLy8gdmVydGljYWwgY2VudGVyaW5nIG9mIHRleHQgYXQgeSBwb3NpdGlvbiBpbiBhbGwgYnJvd3NlcnMsIGV4Y2VwdCBJRS5cblxuICAgICAgICAvLyBSZWdpb25zXG4gICAgICAgICQkLmluaXRSZWdpb24oKTtcblxuICAgICAgICAvLyBHcmlkc1xuICAgICAgICAkJC5pbml0R3JpZCgpO1xuXG4gICAgICAgIC8vIERlZmluZSBnIGZvciBjaGFydCBhcmVhXG4gICAgICAgIG1haW4uYXBwZW5kKCdnJykuYXR0cihcImNsaXAtcGF0aFwiLCAkJC5jbGlwUGF0aCkuYXR0cignY2xhc3MnLCBDTEFTUy5jaGFydCk7XG5cbiAgICAgICAgLy8gR3JpZCBsaW5lc1xuICAgICAgICBpZiAoY29uZmlnLmdyaWRfbGluZXNfZnJvbnQpIHtcbiAgICAgICAgICAgICQkLmluaXRHcmlkTGluZXMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENvdmVyIHdob2xlIHdpdGggcmVjdHMgZm9yIGV2ZW50c1xuICAgICAgICAkJC5pbml0RXZlbnRSZWN0KCk7XG5cbiAgICAgICAgLy8gRGVmaW5lIGcgZm9yIGNoYXJ0XG4gICAgICAgICQkLmluaXRDaGFydEVsZW1lbnRzKCk7XG5cbiAgICAgICAgLy8gaWYgem9vbSBwcml2aWxlZ2VkLCBpbnNlcnQgcmVjdCB0byBmb3JlZnJvbnRcbiAgICAgICAgLy8gVE9ETzogaXMgdGhpcyBuZWVkZWQ/XG4gICAgICAgIG1haW4uaW5zZXJ0KCdyZWN0JywgY29uZmlnLnpvb21fcHJpdmlsZWdlZCA/IG51bGwgOiAnZy4nICsgQ0xBU1MucmVnaW9ucykuYXR0cignY2xhc3MnLCBDTEFTUy56b29tUmVjdCkuYXR0cignd2lkdGgnLCAkJC53aWR0aCkuYXR0cignaGVpZ2h0JywgJCQuaGVpZ2h0KS5zdHlsZSgnb3BhY2l0eScsIDApLm9uKFwiZGJsY2xpY2suem9vbVwiLCBudWxsKTtcblxuICAgICAgICAvLyBTZXQgZGVmYXVsdCBleHRlbnQgaWYgZGVmaW5lZFxuICAgICAgICBpZiAoY29uZmlnLmF4aXNfeF9leHRlbnQpIHtcbiAgICAgICAgICAgICQkLmJydXNoLmV4dGVudCgkJC5nZXREZWZhdWx0RXh0ZW50KCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIEF4aXNcbiAgICAgICAgJCQuYXhpcy5pbml0KCk7XG5cbiAgICAgICAgLy8gU2V0IHRhcmdldHNcbiAgICAgICAgJCQudXBkYXRlVGFyZ2V0cygkJC5kYXRhLnRhcmdldHMpO1xuXG4gICAgICAgIC8vIERyYXcgd2l0aCB0YXJnZXRzXG4gICAgICAgIGlmIChiaW5kaW5nKSB7XG4gICAgICAgICAgICAkJC51cGRhdGVEaW1lbnNpb24oKTtcbiAgICAgICAgICAgICQkLmNvbmZpZy5vbmluaXQuY2FsbCgkJCk7XG4gICAgICAgICAgICAkJC5yZWRyYXcoe1xuICAgICAgICAgICAgICAgIHdpdGhUcmFuc2l0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB3aXRoVHJhbnNmb3JtOiB0cnVlLFxuICAgICAgICAgICAgICAgIHdpdGhVcGRhdGVYRG9tYWluOiB0cnVlLFxuICAgICAgICAgICAgICAgIHdpdGhVcGRhdGVPcmdYRG9tYWluOiB0cnVlLFxuICAgICAgICAgICAgICAgIHdpdGhUcmFuc2l0aW9uRm9yQXhpczogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQmluZCByZXNpemUgZXZlbnRcbiAgICAgICAgJCQuYmluZFJlc2l6ZSgpO1xuXG4gICAgICAgIC8vIGV4cG9ydCBlbGVtZW50IG9mIHRoZSBjaGFydFxuICAgICAgICAkJC5hcGkuZWxlbWVudCA9ICQkLnNlbGVjdENoYXJ0Lm5vZGUoKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uc21vb3RoTGluZXMgPSBmdW5jdGlvbiAoZWwsIHR5cGUpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgaWYgKHR5cGUgPT09ICdncmlkJykge1xuICAgICAgICAgICAgZWwuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGcgPSAkJC5kMy5zZWxlY3QodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIHgxID0gZy5hdHRyKCd4MScpLFxuICAgICAgICAgICAgICAgICAgICB4MiA9IGcuYXR0cigneDInKSxcbiAgICAgICAgICAgICAgICAgICAgeTEgPSBnLmF0dHIoJ3kxJyksXG4gICAgICAgICAgICAgICAgICAgIHkyID0gZy5hdHRyKCd5MicpO1xuICAgICAgICAgICAgICAgIGcuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICd4MSc6IE1hdGguY2VpbCh4MSksXG4gICAgICAgICAgICAgICAgICAgICd4Mic6IE1hdGguY2VpbCh4MiksXG4gICAgICAgICAgICAgICAgICAgICd5MSc6IE1hdGguY2VpbCh5MSksXG4gICAgICAgICAgICAgICAgICAgICd5Mic6IE1hdGguY2VpbCh5MilcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVNpemVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICB2YXIgbGVnZW5kSGVpZ2h0ID0gJCQubGVnZW5kID8gJCQuZ2V0TGVnZW5kSGVpZ2h0KCkgOiAwLFxuICAgICAgICAgICAgbGVnZW5kV2lkdGggPSAkJC5sZWdlbmQgPyAkJC5nZXRMZWdlbmRXaWR0aCgpIDogMCxcbiAgICAgICAgICAgIGxlZ2VuZEhlaWdodEZvckJvdHRvbSA9ICQkLmlzTGVnZW5kUmlnaHQgfHwgJCQuaXNMZWdlbmRJbnNldCA/IDAgOiBsZWdlbmRIZWlnaHQsXG4gICAgICAgICAgICBoYXNBcmMgPSAkJC5oYXNBcmNUeXBlKCksXG4gICAgICAgICAgICB4QXhpc0hlaWdodCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgfHwgaGFzQXJjID8gMCA6ICQkLmdldEhvcml6b250YWxBeGlzSGVpZ2h0KCd4JyksXG4gICAgICAgICAgICBzdWJjaGFydEhlaWdodCA9IGNvbmZpZy5zdWJjaGFydF9zaG93ICYmICFoYXNBcmMgPyBjb25maWcuc3ViY2hhcnRfc2l6ZV9oZWlnaHQgKyB4QXhpc0hlaWdodCA6IDA7XG5cbiAgICAgICAgJCQuY3VycmVudFdpZHRoID0gJCQuZ2V0Q3VycmVudFdpZHRoKCk7XG4gICAgICAgICQkLmN1cnJlbnRIZWlnaHQgPSAkJC5nZXRDdXJyZW50SGVpZ2h0KCk7XG5cbiAgICAgICAgLy8gZm9yIG1haW5cbiAgICAgICAgJCQubWFyZ2luID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IHtcbiAgICAgICAgICAgIHRvcDogJCQuZ2V0SG9yaXpvbnRhbEF4aXNIZWlnaHQoJ3kyJykgKyAkJC5nZXRDdXJyZW50UGFkZGluZ1RvcCgpLFxuICAgICAgICAgICAgcmlnaHQ6IGhhc0FyYyA/IDAgOiAkJC5nZXRDdXJyZW50UGFkZGluZ1JpZ2h0KCksXG4gICAgICAgICAgICBib3R0b206ICQkLmdldEhvcml6b250YWxBeGlzSGVpZ2h0KCd5JykgKyBsZWdlbmRIZWlnaHRGb3JCb3R0b20gKyAkJC5nZXRDdXJyZW50UGFkZGluZ0JvdHRvbSgpLFxuICAgICAgICAgICAgbGVmdDogc3ViY2hhcnRIZWlnaHQgKyAoaGFzQXJjID8gMCA6ICQkLmdldEN1cnJlbnRQYWRkaW5nTGVmdCgpKVxuICAgICAgICB9IDoge1xuICAgICAgICAgICAgdG9wOiA0ICsgJCQuZ2V0Q3VycmVudFBhZGRpbmdUb3AoKSwgLy8gZm9yIHRvcCB0aWNrIHRleHRcbiAgICAgICAgICAgIHJpZ2h0OiBoYXNBcmMgPyAwIDogJCQuZ2V0Q3VycmVudFBhZGRpbmdSaWdodCgpLFxuICAgICAgICAgICAgYm90dG9tOiB4QXhpc0hlaWdodCArIHN1YmNoYXJ0SGVpZ2h0ICsgbGVnZW5kSGVpZ2h0Rm9yQm90dG9tICsgJCQuZ2V0Q3VycmVudFBhZGRpbmdCb3R0b20oKSxcbiAgICAgICAgICAgIGxlZnQ6IGhhc0FyYyA/IDAgOiAkJC5nZXRDdXJyZW50UGFkZGluZ0xlZnQoKVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGZvciBzdWJjaGFydFxuICAgICAgICAkJC5tYXJnaW4yID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IHtcbiAgICAgICAgICAgIHRvcDogJCQubWFyZ2luLnRvcCxcbiAgICAgICAgICAgIHJpZ2h0OiBOYU4sXG4gICAgICAgICAgICBib3R0b206IDIwICsgbGVnZW5kSGVpZ2h0Rm9yQm90dG9tLFxuICAgICAgICAgICAgbGVmdDogJCQucm90YXRlZF9wYWRkaW5nX2xlZnRcbiAgICAgICAgfSA6IHtcbiAgICAgICAgICAgIHRvcDogJCQuY3VycmVudEhlaWdodCAtIHN1YmNoYXJ0SGVpZ2h0IC0gbGVnZW5kSGVpZ2h0Rm9yQm90dG9tLFxuICAgICAgICAgICAgcmlnaHQ6IE5hTixcbiAgICAgICAgICAgIGJvdHRvbTogeEF4aXNIZWlnaHQgKyBsZWdlbmRIZWlnaHRGb3JCb3R0b20sXG4gICAgICAgICAgICBsZWZ0OiAkJC5tYXJnaW4ubGVmdFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGZvciBsZWdlbmRcbiAgICAgICAgJCQubWFyZ2luMyA9IHtcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIHJpZ2h0OiBOYU4sXG4gICAgICAgICAgICBib3R0b206IDAsXG4gICAgICAgICAgICBsZWZ0OiAwXG4gICAgICAgIH07XG4gICAgICAgIGlmICgkJC51cGRhdGVTaXplRm9yTGVnZW5kKSB7XG4gICAgICAgICAgICAkJC51cGRhdGVTaXplRm9yTGVnZW5kKGxlZ2VuZEhlaWdodCwgbGVnZW5kV2lkdGgpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCQud2lkdGggPSAkJC5jdXJyZW50V2lkdGggLSAkJC5tYXJnaW4ubGVmdCAtICQkLm1hcmdpbi5yaWdodDtcbiAgICAgICAgJCQuaGVpZ2h0ID0gJCQuY3VycmVudEhlaWdodCAtICQkLm1hcmdpbi50b3AgLSAkJC5tYXJnaW4uYm90dG9tO1xuICAgICAgICBpZiAoJCQud2lkdGggPCAwKSB7XG4gICAgICAgICAgICAkJC53aWR0aCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCQkLmhlaWdodCA8IDApIHtcbiAgICAgICAgICAgICQkLmhlaWdodCA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICAkJC53aWR0aDIgPSBjb25maWcuYXhpc19yb3RhdGVkID8gJCQubWFyZ2luLmxlZnQgLSAkJC5yb3RhdGVkX3BhZGRpbmdfbGVmdCAtICQkLnJvdGF0ZWRfcGFkZGluZ19yaWdodCA6ICQkLndpZHRoO1xuICAgICAgICAkJC5oZWlnaHQyID0gY29uZmlnLmF4aXNfcm90YXRlZCA/ICQkLmhlaWdodCA6ICQkLmN1cnJlbnRIZWlnaHQgLSAkJC5tYXJnaW4yLnRvcCAtICQkLm1hcmdpbjIuYm90dG9tO1xuICAgICAgICBpZiAoJCQud2lkdGgyIDwgMCkge1xuICAgICAgICAgICAgJCQud2lkdGgyID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJCQuaGVpZ2h0MiA8IDApIHtcbiAgICAgICAgICAgICQkLmhlaWdodDIgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZm9yIGFyY1xuICAgICAgICAkJC5hcmNXaWR0aCA9ICQkLndpZHRoIC0gKCQkLmlzTGVnZW5kUmlnaHQgPyBsZWdlbmRXaWR0aCArIDEwIDogMCk7XG4gICAgICAgICQkLmFyY0hlaWdodCA9ICQkLmhlaWdodCAtICgkJC5pc0xlZ2VuZFJpZ2h0ID8gMCA6IDEwKTtcbiAgICAgICAgaWYgKCQkLmhhc1R5cGUoJ2dhdWdlJykgJiYgIWNvbmZpZy5nYXVnZV9mdWxsQ2lyY2xlKSB7XG4gICAgICAgICAgICAkJC5hcmNIZWlnaHQgKz0gJCQuaGVpZ2h0IC0gJCQuZ2V0R2F1Z2VMYWJlbEhlaWdodCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkJC51cGRhdGVSYWRpdXMpIHtcbiAgICAgICAgICAgICQkLnVwZGF0ZVJhZGl1cygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCQkLmlzTGVnZW5kUmlnaHQgJiYgaGFzQXJjKSB7XG4gICAgICAgICAgICAkJC5tYXJnaW4zLmxlZnQgPSAkJC5hcmNXaWR0aCAvIDIgKyAkJC5yYWRpdXNFeHBhbmRlZCAqIDEuMTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVUYXJnZXRzID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcblxuICAgICAgICAvKi0tIE1haW4gLS0qL1xuXG4gICAgICAgIC8vLS0gVGV4dCAtLS8vXG4gICAgICAgICQkLnVwZGF0ZVRhcmdldHNGb3JUZXh0KHRhcmdldHMpO1xuXG4gICAgICAgIC8vLS0gQmFyIC0tLy9cbiAgICAgICAgJCQudXBkYXRlVGFyZ2V0c0ZvckJhcih0YXJnZXRzKTtcblxuICAgICAgICAvLy0tIExpbmUgLS0vL1xuICAgICAgICAkJC51cGRhdGVUYXJnZXRzRm9yTGluZSh0YXJnZXRzKTtcblxuICAgICAgICAvLy0tIEFyYyAtLS8vXG4gICAgICAgIGlmICgkJC5oYXNBcmNUeXBlKCkgJiYgJCQudXBkYXRlVGFyZ2V0c0ZvckFyYykge1xuICAgICAgICAgICAgJCQudXBkYXRlVGFyZ2V0c0ZvckFyYyh0YXJnZXRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qLS0gU3ViIC0tKi9cblxuICAgICAgICBpZiAoJCQudXBkYXRlVGFyZ2V0c0ZvclN1YmNoYXJ0KSB7XG4gICAgICAgICAgICAkJC51cGRhdGVUYXJnZXRzRm9yU3ViY2hhcnQodGFyZ2V0cyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGYWRlLWluIGVhY2ggY2hhcnRcbiAgICAgICAgJCQuc2hvd1RhcmdldHMoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnNob3dUYXJnZXRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICAkJC5zdmcuc2VsZWN0QWxsKCcuJyArIENMQVNTLnRhcmdldCkuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuaXNUYXJnZXRUb1Nob3coZC5pZCk7XG4gICAgICAgIH0pLnRyYW5zaXRpb24oKS5kdXJhdGlvbigkJC5jb25maWcudHJhbnNpdGlvbl9kdXJhdGlvbikuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5yZWRyYXcgPSBmdW5jdGlvbiAob3B0aW9ucywgdHJhbnNpdGlvbnMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIG1haW4gPSAkJC5tYWluLFxuICAgICAgICAgICAgZDMgPSAkJC5kMyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgdmFyIGFyZWFJbmRpY2VzID0gJCQuZ2V0U2hhcGVJbmRpY2VzKCQkLmlzQXJlYVR5cGUpLFxuICAgICAgICAgICAgYmFySW5kaWNlcyA9ICQkLmdldFNoYXBlSW5kaWNlcygkJC5pc0JhclR5cGUpLFxuICAgICAgICAgICAgbGluZUluZGljZXMgPSAkJC5nZXRTaGFwZUluZGljZXMoJCQuaXNMaW5lVHlwZSk7XG4gICAgICAgIHZhciB3aXRoWSwgd2l0aFN1YmNoYXJ0LCB3aXRoVHJhbnNpdGlvbiwgd2l0aFRyYW5zaXRpb25Gb3JFeGl0LCB3aXRoVHJhbnNpdGlvbkZvckF4aXMsIHdpdGhUcmFuc2Zvcm0sIHdpdGhVcGRhdGVYRG9tYWluLCB3aXRoVXBkYXRlT3JnWERvbWFpbiwgd2l0aFRyaW1YRG9tYWluLCB3aXRoTGVnZW5kLCB3aXRoRXZlbnRSZWN0LCB3aXRoRGltZW5zaW9uLCB3aXRoVXBkYXRlWEF4aXM7XG4gICAgICAgIHZhciBoaWRlQXhpcyA9ICQkLmhhc0FyY1R5cGUoKTtcbiAgICAgICAgdmFyIGRyYXdBcmVhLCBkcmF3QmFyLCBkcmF3TGluZSwgeEZvclRleHQsIHlGb3JUZXh0O1xuICAgICAgICB2YXIgZHVyYXRpb24sIGR1cmF0aW9uRm9yRXhpdCwgZHVyYXRpb25Gb3JBeGlzO1xuICAgICAgICB2YXIgd2FpdEZvckRyYXcsIGZsb3c7XG4gICAgICAgIHZhciB0YXJnZXRzVG9TaG93ID0gJCQuZmlsdGVyVGFyZ2V0c1RvU2hvdygkJC5kYXRhLnRhcmdldHMpLFxuICAgICAgICAgICAgdGlja1ZhbHVlcyxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBpbnRlcnZhbEZvckN1bGxpbmcsXG4gICAgICAgICAgICB4RG9tYWluRm9yWm9vbTtcbiAgICAgICAgdmFyIHh2ID0gJCQueHYuYmluZCgkJCksXG4gICAgICAgICAgICBjeCxcbiAgICAgICAgICAgIGN5O1xuXG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgICB3aXRoWSA9IGdldE9wdGlvbihvcHRpb25zLCBcIndpdGhZXCIsIHRydWUpO1xuICAgICAgICB3aXRoU3ViY2hhcnQgPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoU3ViY2hhcnRcIiwgdHJ1ZSk7XG4gICAgICAgIHdpdGhUcmFuc2l0aW9uID0gZ2V0T3B0aW9uKG9wdGlvbnMsIFwid2l0aFRyYW5zaXRpb25cIiwgdHJ1ZSk7XG4gICAgICAgIHdpdGhUcmFuc2Zvcm0gPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoVHJhbnNmb3JtXCIsIGZhbHNlKTtcbiAgICAgICAgd2l0aFVwZGF0ZVhEb21haW4gPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoVXBkYXRlWERvbWFpblwiLCBmYWxzZSk7XG4gICAgICAgIHdpdGhVcGRhdGVPcmdYRG9tYWluID0gZ2V0T3B0aW9uKG9wdGlvbnMsIFwid2l0aFVwZGF0ZU9yZ1hEb21haW5cIiwgZmFsc2UpO1xuICAgICAgICB3aXRoVHJpbVhEb21haW4gPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoVHJpbVhEb21haW5cIiwgdHJ1ZSk7XG4gICAgICAgIHdpdGhVcGRhdGVYQXhpcyA9IGdldE9wdGlvbihvcHRpb25zLCBcIndpdGhVcGRhdGVYQXhpc1wiLCB3aXRoVXBkYXRlWERvbWFpbik7XG4gICAgICAgIHdpdGhMZWdlbmQgPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoTGVnZW5kXCIsIGZhbHNlKTtcbiAgICAgICAgd2l0aEV2ZW50UmVjdCA9IGdldE9wdGlvbihvcHRpb25zLCBcIndpdGhFdmVudFJlY3RcIiwgdHJ1ZSk7XG4gICAgICAgIHdpdGhEaW1lbnNpb24gPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoRGltZW5zaW9uXCIsIHRydWUpO1xuICAgICAgICB3aXRoVHJhbnNpdGlvbkZvckV4aXQgPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoVHJhbnNpdGlvbkZvckV4aXRcIiwgd2l0aFRyYW5zaXRpb24pO1xuICAgICAgICB3aXRoVHJhbnNpdGlvbkZvckF4aXMgPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoVHJhbnNpdGlvbkZvckF4aXNcIiwgd2l0aFRyYW5zaXRpb24pO1xuXG4gICAgICAgIGR1cmF0aW9uID0gd2l0aFRyYW5zaXRpb24gPyBjb25maWcudHJhbnNpdGlvbl9kdXJhdGlvbiA6IDA7XG4gICAgICAgIGR1cmF0aW9uRm9yRXhpdCA9IHdpdGhUcmFuc2l0aW9uRm9yRXhpdCA/IGR1cmF0aW9uIDogMDtcbiAgICAgICAgZHVyYXRpb25Gb3JBeGlzID0gd2l0aFRyYW5zaXRpb25Gb3JBeGlzID8gZHVyYXRpb24gOiAwO1xuXG4gICAgICAgIHRyYW5zaXRpb25zID0gdHJhbnNpdGlvbnMgfHwgJCQuYXhpcy5nZW5lcmF0ZVRyYW5zaXRpb25zKGR1cmF0aW9uRm9yQXhpcyk7XG5cbiAgICAgICAgLy8gdXBkYXRlIGxlZ2VuZCBhbmQgdHJhbnNmb3JtIGVhY2ggZ1xuICAgICAgICBpZiAod2l0aExlZ2VuZCAmJiBjb25maWcubGVnZW5kX3Nob3cpIHtcbiAgICAgICAgICAgICQkLnVwZGF0ZUxlZ2VuZCgkJC5tYXBUb0lkcygkJC5kYXRhLnRhcmdldHMpLCBvcHRpb25zLCB0cmFuc2l0aW9ucyk7XG4gICAgICAgIH0gZWxzZSBpZiAod2l0aERpbWVuc2lvbikge1xuICAgICAgICAgICAgLy8gbmVlZCB0byB1cGRhdGUgZGltZW5zaW9uIChlLmcuIGF4aXMueS50aWNrLnZhbHVlcykgYmVjYXVzZSB5IHRpY2sgdmFsdWVzIHNob3VsZCBjaGFuZ2VcbiAgICAgICAgICAgIC8vIG5vIG5lZWQgdG8gdXBkYXRlIGF4aXMgaW4gaXQgYmVjYXVzZSB0aGV5IHdpbGwgYmUgdXBkYXRlZCBpbiByZWRyYXcoKVxuICAgICAgICAgICAgJCQudXBkYXRlRGltZW5zaW9uKHRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTUVNTzogbmVlZGVkIGZvciBncmlkcyBjYWxjdWxhdGlvblxuICAgICAgICBpZiAoJCQuaXNDYXRlZ29yaXplZCgpICYmIHRhcmdldHNUb1Nob3cubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAkJC54LmRvbWFpbihbMCwgJCQuYXhlcy54LnNlbGVjdEFsbCgnLnRpY2snKS5zaXplKCldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0YXJnZXRzVG9TaG93Lmxlbmd0aCkge1xuICAgICAgICAgICAgJCQudXBkYXRlWERvbWFpbih0YXJnZXRzVG9TaG93LCB3aXRoVXBkYXRlWERvbWFpbiwgd2l0aFVwZGF0ZU9yZ1hEb21haW4sIHdpdGhUcmltWERvbWFpbik7XG4gICAgICAgICAgICBpZiAoIWNvbmZpZy5heGlzX3hfdGlja192YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICB0aWNrVmFsdWVzID0gJCQuYXhpcy51cGRhdGVYQXhpc1RpY2tWYWx1ZXModGFyZ2V0c1RvU2hvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkJC54QXhpcy50aWNrVmFsdWVzKFtdKTtcbiAgICAgICAgICAgICQkLnN1YlhBeGlzLnRpY2tWYWx1ZXMoW10pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmZpZy56b29tX3Jlc2NhbGUgJiYgIW9wdGlvbnMuZmxvdykge1xuICAgICAgICAgICAgeERvbWFpbkZvclpvb20gPSAkJC54Lm9yZ0RvbWFpbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCQueS5kb21haW4oJCQuZ2V0WURvbWFpbih0YXJnZXRzVG9TaG93LCAneScsIHhEb21haW5Gb3Jab29tKSk7XG4gICAgICAgICQkLnkyLmRvbWFpbigkJC5nZXRZRG9tYWluKHRhcmdldHNUb1Nob3csICd5MicsIHhEb21haW5Gb3Jab29tKSk7XG5cbiAgICAgICAgaWYgKCFjb25maWcuYXhpc195X3RpY2tfdmFsdWVzICYmIGNvbmZpZy5heGlzX3lfdGlja19jb3VudCkge1xuICAgICAgICAgICAgJCQueUF4aXMudGlja1ZhbHVlcygkJC5heGlzLmdlbmVyYXRlVGlja1ZhbHVlcygkJC55LmRvbWFpbigpLCBjb25maWcuYXhpc195X3RpY2tfY291bnQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbmZpZy5heGlzX3kyX3RpY2tfdmFsdWVzICYmIGNvbmZpZy5heGlzX3kyX3RpY2tfY291bnQpIHtcbiAgICAgICAgICAgICQkLnkyQXhpcy50aWNrVmFsdWVzKCQkLmF4aXMuZ2VuZXJhdGVUaWNrVmFsdWVzKCQkLnkyLmRvbWFpbigpLCBjb25maWcuYXhpc195Ml90aWNrX2NvdW50KSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBheGVzXG4gICAgICAgICQkLmF4aXMucmVkcmF3KHRyYW5zaXRpb25zLCBoaWRlQXhpcyk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGF4aXMgbGFiZWxcbiAgICAgICAgJCQuYXhpcy51cGRhdGVMYWJlbHMod2l0aFRyYW5zaXRpb24pO1xuXG4gICAgICAgIC8vIHNob3cvaGlkZSBpZiBtYW51YWwgY3VsbGluZyBuZWVkZWRcbiAgICAgICAgaWYgKCh3aXRoVXBkYXRlWERvbWFpbiB8fCB3aXRoVXBkYXRlWEF4aXMpICYmIHRhcmdldHNUb1Nob3cubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnLmF4aXNfeF90aWNrX2N1bGxpbmcgJiYgdGlja1ZhbHVlcykge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCB0aWNrVmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aWNrVmFsdWVzLmxlbmd0aCAvIGkgPCBjb25maWcuYXhpc194X3RpY2tfY3VsbGluZ19tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsRm9yQ3VsbGluZyA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkJC5zdmcuc2VsZWN0QWxsKCcuJyArIENMQVNTLmF4aXNYICsgJyAudGljayB0ZXh0JykuZWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSB0aWNrVmFsdWVzLmluZGV4T2YoZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuc3R5bGUoJ2Rpc3BsYXknLCBpbmRleCAlIGludGVydmFsRm9yQ3VsbGluZyA/ICdub25lJyA6ICdibG9jaycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQkLnN2Zy5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuYXhpc1ggKyAnIC50aWNrIHRleHQnKS5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2V0dXAgZHJhd2VyIC0gTUVNTzogdGhlc2UgbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgYXhpcyB1cGRhdGVkXG4gICAgICAgIGRyYXdBcmVhID0gJCQuZ2VuZXJhdGVEcmF3QXJlYSA/ICQkLmdlbmVyYXRlRHJhd0FyZWEoYXJlYUluZGljZXMsIGZhbHNlKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgZHJhd0JhciA9ICQkLmdlbmVyYXRlRHJhd0JhciA/ICQkLmdlbmVyYXRlRHJhd0JhcihiYXJJbmRpY2VzKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgZHJhd0xpbmUgPSAkJC5nZW5lcmF0ZURyYXdMaW5lID8gJCQuZ2VuZXJhdGVEcmF3TGluZShsaW5lSW5kaWNlcywgZmFsc2UpIDogdW5kZWZpbmVkO1xuICAgICAgICB4Rm9yVGV4dCA9ICQkLmdlbmVyYXRlWFlGb3JUZXh0KGFyZWFJbmRpY2VzLCBiYXJJbmRpY2VzLCBsaW5lSW5kaWNlcywgdHJ1ZSk7XG4gICAgICAgIHlGb3JUZXh0ID0gJCQuZ2VuZXJhdGVYWUZvclRleHQoYXJlYUluZGljZXMsIGJhckluZGljZXMsIGxpbmVJbmRpY2VzLCBmYWxzZSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHN1YiBkb21haW5cbiAgICAgICAgaWYgKHdpdGhZKSB7XG4gICAgICAgICAgICAkJC5zdWJZLmRvbWFpbigkJC5nZXRZRG9tYWluKHRhcmdldHNUb1Nob3csICd5JykpO1xuICAgICAgICAgICAgJCQuc3ViWTIuZG9tYWluKCQkLmdldFlEb21haW4odGFyZ2V0c1RvU2hvdywgJ3kyJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8geGdyaWQgZm9jdXNcbiAgICAgICAgJCQudXBkYXRlWGdyaWRGb2N1cygpO1xuXG4gICAgICAgIC8vIERhdGEgZW1wdHkgbGFiZWwgcG9zaXRpb25pbmcgYW5kIHRleHQuXG4gICAgICAgIG1haW4uc2VsZWN0KFwidGV4dC5cIiArIENMQVNTLnRleHQgKyAnLicgKyBDTEFTUy5lbXB0eSkuYXR0cihcInhcIiwgJCQud2lkdGggLyAyKS5hdHRyKFwieVwiLCAkJC5oZWlnaHQgLyAyKS50ZXh0KGNvbmZpZy5kYXRhX2VtcHR5X2xhYmVsX3RleHQpLnRyYW5zaXRpb24oKS5zdHlsZSgnb3BhY2l0eScsIHRhcmdldHNUb1Nob3cubGVuZ3RoID8gMCA6IDEpO1xuXG4gICAgICAgIC8vIGdyaWRcbiAgICAgICAgJCQudXBkYXRlR3JpZChkdXJhdGlvbik7XG5cbiAgICAgICAgLy8gcmVjdCBmb3IgcmVnaW9uc1xuICAgICAgICAkJC51cGRhdGVSZWdpb24oZHVyYXRpb24pO1xuXG4gICAgICAgIC8vIGJhcnNcbiAgICAgICAgJCQudXBkYXRlQmFyKGR1cmF0aW9uRm9yRXhpdCk7XG5cbiAgICAgICAgLy8gbGluZXMsIGFyZWFzIGFuZCBjcmljbGVzXG4gICAgICAgICQkLnVwZGF0ZUxpbmUoZHVyYXRpb25Gb3JFeGl0KTtcbiAgICAgICAgJCQudXBkYXRlQXJlYShkdXJhdGlvbkZvckV4aXQpO1xuICAgICAgICAkJC51cGRhdGVDaXJjbGUoKTtcblxuICAgICAgICAvLyB0ZXh0XG4gICAgICAgIGlmICgkJC5oYXNEYXRhTGFiZWwoKSkge1xuICAgICAgICAgICAgJCQudXBkYXRlVGV4dChkdXJhdGlvbkZvckV4aXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGl0bGVcbiAgICAgICAgaWYgKCQkLnJlZHJhd1RpdGxlKSB7XG4gICAgICAgICAgICAkJC5yZWRyYXdUaXRsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYXJjXG4gICAgICAgIGlmICgkJC5yZWRyYXdBcmMpIHtcbiAgICAgICAgICAgICQkLnJlZHJhd0FyYyhkdXJhdGlvbiwgZHVyYXRpb25Gb3JFeGl0LCB3aXRoVHJhbnNmb3JtKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHN1YmNoYXJ0XG4gICAgICAgIGlmICgkJC5yZWRyYXdTdWJjaGFydCkge1xuICAgICAgICAgICAgJCQucmVkcmF3U3ViY2hhcnQod2l0aFN1YmNoYXJ0LCB0cmFuc2l0aW9ucywgZHVyYXRpb24sIGR1cmF0aW9uRm9yRXhpdCwgYXJlYUluZGljZXMsIGJhckluZGljZXMsIGxpbmVJbmRpY2VzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNpcmNsZXMgZm9yIHNlbGVjdFxuICAgICAgICBtYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5zZWxlY3RlZENpcmNsZXMpLmZpbHRlcigkJC5pc0JhclR5cGUuYmluZCgkJCkpLnNlbGVjdEFsbCgnY2lyY2xlJykucmVtb3ZlKCk7XG5cbiAgICAgICAgLy8gZXZlbnQgcmVjdHMgd2lsbCByZWRyYXduIHdoZW4gZmxvdyBjYWxsZWRcbiAgICAgICAgaWYgKGNvbmZpZy5pbnRlcmFjdGlvbl9lbmFibGVkICYmICFvcHRpb25zLmZsb3cgJiYgd2l0aEV2ZW50UmVjdCkge1xuICAgICAgICAgICAgJCQucmVkcmF3RXZlbnRSZWN0KCk7XG4gICAgICAgICAgICBpZiAoJCQudXBkYXRlWm9vbSkge1xuICAgICAgICAgICAgICAgICQkLnVwZGF0ZVpvb20oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHVwZGF0ZSBjaXJjbGVZIGJhc2VkIG9uIHVwZGF0ZWQgcGFyYW1ldGVyc1xuICAgICAgICAkJC51cGRhdGVDaXJjbGVZKCk7XG5cbiAgICAgICAgLy8gZ2VuZXJhdGUgY2lyY2xlIHgveSBmdW5jdGlvbnMgZGVwZW5kaW5nIG9uIHVwZGF0ZWQgcGFyYW1zXG4gICAgICAgIGN4ID0gKCQkLmNvbmZpZy5heGlzX3JvdGF0ZWQgPyAkJC5jaXJjbGVZIDogJCQuY2lyY2xlWCkuYmluZCgkJCk7XG4gICAgICAgIGN5ID0gKCQkLmNvbmZpZy5heGlzX3JvdGF0ZWQgPyAkJC5jaXJjbGVYIDogJCQuY2lyY2xlWSkuYmluZCgkJCk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuZmxvdykge1xuICAgICAgICAgICAgZmxvdyA9ICQkLmdlbmVyYXRlRmxvdyh7XG4gICAgICAgICAgICAgICAgdGFyZ2V0czogdGFyZ2V0c1RvU2hvdyxcbiAgICAgICAgICAgICAgICBmbG93OiBvcHRpb25zLmZsb3csXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IG9wdGlvbnMuZmxvdy5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBkcmF3QmFyOiBkcmF3QmFyLFxuICAgICAgICAgICAgICAgIGRyYXdMaW5lOiBkcmF3TGluZSxcbiAgICAgICAgICAgICAgICBkcmF3QXJlYTogZHJhd0FyZWEsXG4gICAgICAgICAgICAgICAgY3g6IGN4LFxuICAgICAgICAgICAgICAgIGN5OiBjeSxcbiAgICAgICAgICAgICAgICB4djogeHYsXG4gICAgICAgICAgICAgICAgeEZvclRleHQ6IHhGb3JUZXh0LFxuICAgICAgICAgICAgICAgIHlGb3JUZXh0OiB5Rm9yVGV4dFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKGR1cmF0aW9uIHx8IGZsb3cpICYmICQkLmlzVGFiVmlzaWJsZSgpKSB7XG4gICAgICAgICAgICAvLyBPbmx5IHVzZSB0cmFuc2l0aW9uIGlmIHRhYiB2aXNpYmxlLiBTZWUgIzkzOC5cbiAgICAgICAgICAgIC8vIHRyYW5zaXRpb24gc2hvdWxkIGJlIGRlcml2ZWQgZnJvbSBvbmUgdHJhbnNpdGlvblxuICAgICAgICAgICAgZDMudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdHJhbnNpdGlvbnNUb1dhaXQgPSBbXTtcblxuICAgICAgICAgICAgICAgIC8vIHJlZHJhdyBhbmQgZ2F0aGVyIHRyYW5zaXRpb25zXG4gICAgICAgICAgICAgICAgWyQkLnJlZHJhd0JhcihkcmF3QmFyLCB0cnVlKSwgJCQucmVkcmF3TGluZShkcmF3TGluZSwgdHJ1ZSksICQkLnJlZHJhd0FyZWEoZHJhd0FyZWEsIHRydWUpLCAkJC5yZWRyYXdDaXJjbGUoY3gsIGN5LCB0cnVlKSwgJCQucmVkcmF3VGV4dCh4Rm9yVGV4dCwgeUZvclRleHQsIG9wdGlvbnMuZmxvdywgdHJ1ZSksICQkLnJlZHJhd1JlZ2lvbih0cnVlKSwgJCQucmVkcmF3R3JpZCh0cnVlKV0uZm9yRWFjaChmdW5jdGlvbiAodHJhbnNpdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAodHJhbnNpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbnNUb1dhaXQucHVzaCh0cmFuc2l0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBXYWl0IGZvciBlbmQgb2YgdHJhbnNpdGlvbnMgdG8gY2FsbCBmbG93IGFuZCBvbnJlbmRlcmVkIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgd2FpdEZvckRyYXcgPSAkJC5nZW5lcmF0ZVdhaXQoKTtcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uc1RvV2FpdC5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgIHdhaXRGb3JEcmF3LmFkZCh0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLmNhbGwod2FpdEZvckRyYXcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmxvdykge1xuICAgICAgICAgICAgICAgICAgICBmbG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjb25maWcub25yZW5kZXJlZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25maWcub25yZW5kZXJlZC5jYWxsKCQkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQkLnJlZHJhd0JhcihkcmF3QmFyKTtcbiAgICAgICAgICAgICQkLnJlZHJhd0xpbmUoZHJhd0xpbmUpO1xuICAgICAgICAgICAgJCQucmVkcmF3QXJlYShkcmF3QXJlYSk7XG4gICAgICAgICAgICAkJC5yZWRyYXdDaXJjbGUoY3gsIGN5KTtcbiAgICAgICAgICAgICQkLnJlZHJhd1RleHQoeEZvclRleHQsIHlGb3JUZXh0LCBvcHRpb25zLmZsb3cpO1xuICAgICAgICAgICAgJCQucmVkcmF3UmVnaW9uKCk7XG4gICAgICAgICAgICAkJC5yZWRyYXdHcmlkKCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnLm9ucmVuZGVyZWQpIHtcbiAgICAgICAgICAgICAgICBjb25maWcub25yZW5kZXJlZC5jYWxsKCQkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHVwZGF0ZSBmYWRlaW4gY29uZGl0aW9uXG4gICAgICAgICQkLm1hcFRvSWRzKCQkLmRhdGEudGFyZ2V0cykuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICQkLndpdGhvdXRGYWRlSW5baWRdID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZUFuZFJlZHJhdyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB0cmFuc2l0aW9ucztcbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgIC8vIHNhbWUgd2l0aCByZWRyYXdcbiAgICAgICAgb3B0aW9ucy53aXRoVHJhbnNpdGlvbiA9IGdldE9wdGlvbihvcHRpb25zLCBcIndpdGhUcmFuc2l0aW9uXCIsIHRydWUpO1xuICAgICAgICBvcHRpb25zLndpdGhUcmFuc2Zvcm0gPSBnZXRPcHRpb24ob3B0aW9ucywgXCJ3aXRoVHJhbnNmb3JtXCIsIGZhbHNlKTtcbiAgICAgICAgb3B0aW9ucy53aXRoTGVnZW5kID0gZ2V0T3B0aW9uKG9wdGlvbnMsIFwid2l0aExlZ2VuZFwiLCBmYWxzZSk7XG4gICAgICAgIC8vIE5PVCBzYW1lIHdpdGggcmVkcmF3XG4gICAgICAgIG9wdGlvbnMud2l0aFVwZGF0ZVhEb21haW4gPSB0cnVlO1xuICAgICAgICBvcHRpb25zLndpdGhVcGRhdGVPcmdYRG9tYWluID0gdHJ1ZTtcbiAgICAgICAgb3B0aW9ucy53aXRoVHJhbnNpdGlvbkZvckV4aXQgPSBmYWxzZTtcbiAgICAgICAgb3B0aW9ucy53aXRoVHJhbnNpdGlvbkZvclRyYW5zZm9ybSA9IGdldE9wdGlvbihvcHRpb25zLCBcIndpdGhUcmFuc2l0aW9uRm9yVHJhbnNmb3JtXCIsIG9wdGlvbnMud2l0aFRyYW5zaXRpb24pO1xuICAgICAgICAvLyBNRU1POiB0aGlzIG5lZWRzIHRvIGJlIGNhbGxlZCBiZWZvcmUgdXBkYXRlTGVnZW5kIGFuZCBpdCBtZWFucyB0aGlzIEFMV0FZUyBuZWVkcyB0byBiZSBjYWxsZWQpXG4gICAgICAgICQkLnVwZGF0ZVNpemVzKCk7XG4gICAgICAgIC8vIE1FTU86IGNhbGxlZCBpbiB1cGRhdGVMZWdlbmQgaW4gcmVkcmF3IGlmIHdpdGhMZWdlbmRcbiAgICAgICAgaWYgKCEob3B0aW9ucy53aXRoTGVnZW5kICYmIGNvbmZpZy5sZWdlbmRfc2hvdykpIHtcbiAgICAgICAgICAgIHRyYW5zaXRpb25zID0gJCQuYXhpcy5nZW5lcmF0ZVRyYW5zaXRpb25zKG9wdGlvbnMud2l0aFRyYW5zaXRpb25Gb3JBeGlzID8gY29uZmlnLnRyYW5zaXRpb25fZHVyYXRpb24gOiAwKTtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBzY2FsZXNcbiAgICAgICAgICAgICQkLnVwZGF0ZVNjYWxlcygpO1xuICAgICAgICAgICAgJCQudXBkYXRlU3ZnU2l6ZSgpO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGcgcG9zaXRpb25zXG4gICAgICAgICAgICAkJC50cmFuc2Zvcm1BbGwob3B0aW9ucy53aXRoVHJhbnNpdGlvbkZvclRyYW5zZm9ybSwgdHJhbnNpdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIERyYXcgd2l0aCBuZXcgc2l6ZXMgJiBzY2FsZXNcbiAgICAgICAgJCQucmVkcmF3KG9wdGlvbnMsIHRyYW5zaXRpb25zKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlZHJhd1dpdGhvdXRSZXNjYWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlZHJhdyh7XG4gICAgICAgICAgICB3aXRoWTogZmFsc2UsXG4gICAgICAgICAgICB3aXRoU3ViY2hhcnQ6IGZhbHNlLFxuICAgICAgICAgICAgd2l0aEV2ZW50UmVjdDogZmFsc2UsXG4gICAgICAgICAgICB3aXRoVHJhbnNpdGlvbkZvckF4aXM6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc1RpbWVTZXJpZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5heGlzX3hfdHlwZSA9PT0gJ3RpbWVzZXJpZXMnO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNDYXRlZ29yaXplZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmF4aXNfeF90eXBlLmluZGV4T2YoJ2NhdGVnb3InKSA+PSAwO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNDdXN0b21YID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICByZXR1cm4gISQkLmlzVGltZVNlcmllcygpICYmIChjb25maWcuZGF0YV94IHx8IG5vdEVtcHR5KGNvbmZpZy5kYXRhX3hzKSk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzVGltZVNlcmllc1kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5heGlzX3lfdHlwZSA9PT0gJ3RpbWVzZXJpZXMnO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRUcmFuc2xhdGUgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB4LFxuICAgICAgICAgICAgeTtcbiAgICAgICAgaWYgKHRhcmdldCA9PT0gJ21haW4nKSB7XG4gICAgICAgICAgICB4ID0gYXNIYWxmUGl4ZWwoJCQubWFyZ2luLmxlZnQpO1xuICAgICAgICAgICAgeSA9IGFzSGFsZlBpeGVsKCQkLm1hcmdpbi50b3ApO1xuICAgICAgICB9IGVsc2UgaWYgKHRhcmdldCA9PT0gJ2NvbnRleHQnKSB7XG4gICAgICAgICAgICB4ID0gYXNIYWxmUGl4ZWwoJCQubWFyZ2luMi5sZWZ0KTtcbiAgICAgICAgICAgIHkgPSBhc0hhbGZQaXhlbCgkJC5tYXJnaW4yLnRvcCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0ID09PSAnbGVnZW5kJykge1xuICAgICAgICAgICAgeCA9ICQkLm1hcmdpbjMubGVmdDtcbiAgICAgICAgICAgIHkgPSAkJC5tYXJnaW4zLnRvcDtcbiAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgPT09ICd4Jykge1xuICAgICAgICAgICAgeCA9IDA7XG4gICAgICAgICAgICB5ID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IDAgOiAkJC5oZWlnaHQ7XG4gICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0ID09PSAneScpIHtcbiAgICAgICAgICAgIHggPSAwO1xuICAgICAgICAgICAgeSA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAkJC5oZWlnaHQgOiAwO1xuICAgICAgICB9IGVsc2UgaWYgKHRhcmdldCA9PT0gJ3kyJykge1xuICAgICAgICAgICAgeCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAwIDogJCQud2lkdGg7XG4gICAgICAgICAgICB5ID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IDEgOiAwO1xuICAgICAgICB9IGVsc2UgaWYgKHRhcmdldCA9PT0gJ3N1YngnKSB7XG4gICAgICAgICAgICB4ID0gMDtcbiAgICAgICAgICAgIHkgPSBjb25maWcuYXhpc19yb3RhdGVkID8gMCA6ICQkLmhlaWdodDI7XG4gICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0ID09PSAnYXJjJykge1xuICAgICAgICAgICAgeCA9ICQkLmFyY1dpZHRoIC8gMjtcbiAgICAgICAgICAgIHkgPSAkJC5hcmNIZWlnaHQgLyAyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBcInRyYW5zbGF0ZShcIiArIHggKyBcIixcIiArIHkgKyBcIilcIjtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmluaXRpYWxPcGFjaXR5ID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGQudmFsdWUgIT09IG51bGwgJiYgdGhpcy53aXRob3V0RmFkZUluW2QuaWRdID8gMSA6IDA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0aWFsT3BhY2l0eUZvckNpcmNsZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBkLnZhbHVlICE9PSBudWxsICYmIHRoaXMud2l0aG91dEZhZGVJbltkLmlkXSA/IHRoaXMub3BhY2l0eUZvckNpcmNsZShkKSA6IDA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5vcGFjaXR5Rm9yQ2lyY2xlID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIG9wYWNpdHkgPSB0aGlzLmNvbmZpZy5wb2ludF9zaG93ID8gMSA6IDA7XG4gICAgICAgIHJldHVybiBpc1ZhbHVlKGQudmFsdWUpID8gdGhpcy5pc1NjYXR0ZXJUeXBlKGQpID8gMC41IDogb3BhY2l0eSA6IDA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5vcGFjaXR5Rm9yVGV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzRGF0YUxhYmVsKCkgPyAxIDogMDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnh4ID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGQgPyB0aGlzLngoZC54KSA6IG51bGw7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi54diA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICB2YWx1ZSA9IGQudmFsdWU7XG4gICAgICAgIGlmICgkJC5pc1RpbWVTZXJpZXMoKSkge1xuICAgICAgICAgICAgdmFsdWUgPSAkJC5wYXJzZURhdGUoZC52YWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoJCQuaXNDYXRlZ29yaXplZCgpICYmIHR5cGVvZiBkLnZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdmFsdWUgPSAkJC5jb25maWcuYXhpc194X2NhdGVnb3JpZXMuaW5kZXhPZihkLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTWF0aC5jZWlsKCQkLngodmFsdWUpKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnl2ID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHlTY2FsZSA9IGQuYXhpcyAmJiBkLmF4aXMgPT09ICd5MicgPyAkJC55MiA6ICQkLnk7XG4gICAgICAgIHJldHVybiBNYXRoLmNlaWwoeVNjYWxlKGQudmFsdWUpKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnN1Ynh4ID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGQgPyB0aGlzLnN1YlgoZC54KSA6IG51bGw7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnRyYW5zZm9ybU1haW4gPSBmdW5jdGlvbiAod2l0aFRyYW5zaXRpb24sIHRyYW5zaXRpb25zKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICB4QXhpcyxcbiAgICAgICAgICAgIHlBeGlzLFxuICAgICAgICAgICAgeTJBeGlzO1xuICAgICAgICBpZiAodHJhbnNpdGlvbnMgJiYgdHJhbnNpdGlvbnMuYXhpc1gpIHtcbiAgICAgICAgICAgIHhBeGlzID0gdHJhbnNpdGlvbnMuYXhpc1g7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB4QXhpcyA9ICQkLm1haW4uc2VsZWN0KCcuJyArIENMQVNTLmF4aXNYKTtcbiAgICAgICAgICAgIGlmICh3aXRoVHJhbnNpdGlvbikge1xuICAgICAgICAgICAgICAgIHhBeGlzID0geEF4aXMudHJhbnNpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0cmFuc2l0aW9ucyAmJiB0cmFuc2l0aW9ucy5heGlzWSkge1xuICAgICAgICAgICAgeUF4aXMgPSB0cmFuc2l0aW9ucy5heGlzWTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHlBeGlzID0gJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MuYXhpc1kpO1xuICAgICAgICAgICAgaWYgKHdpdGhUcmFuc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgeUF4aXMgPSB5QXhpcy50cmFuc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRyYW5zaXRpb25zICYmIHRyYW5zaXRpb25zLmF4aXNZMikge1xuICAgICAgICAgICAgeTJBeGlzID0gdHJhbnNpdGlvbnMuYXhpc1kyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeTJBeGlzID0gJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MuYXhpc1kyKTtcbiAgICAgICAgICAgIGlmICh3aXRoVHJhbnNpdGlvbikge1xuICAgICAgICAgICAgICAgIHkyQXhpcyA9IHkyQXhpcy50cmFuc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgKHdpdGhUcmFuc2l0aW9uID8gJCQubWFpbi50cmFuc2l0aW9uKCkgOiAkJC5tYWluKS5hdHRyKFwidHJhbnNmb3JtXCIsICQkLmdldFRyYW5zbGF0ZSgnbWFpbicpKTtcbiAgICAgICAgeEF4aXMuYXR0cihcInRyYW5zZm9ybVwiLCAkJC5nZXRUcmFuc2xhdGUoJ3gnKSk7XG4gICAgICAgIHlBeGlzLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgJCQuZ2V0VHJhbnNsYXRlKCd5JykpO1xuICAgICAgICB5MkF4aXMuYXR0cihcInRyYW5zZm9ybVwiLCAkJC5nZXRUcmFuc2xhdGUoJ3kyJykpO1xuICAgICAgICAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5jaGFydEFyY3MpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgJCQuZ2V0VHJhbnNsYXRlKCdhcmMnKSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi50cmFuc2Zvcm1BbGwgPSBmdW5jdGlvbiAod2l0aFRyYW5zaXRpb24sIHRyYW5zaXRpb25zKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgICQkLnRyYW5zZm9ybU1haW4od2l0aFRyYW5zaXRpb24sIHRyYW5zaXRpb25zKTtcbiAgICAgICAgaWYgKCQkLmNvbmZpZy5zdWJjaGFydF9zaG93KSB7XG4gICAgICAgICAgICAkJC50cmFuc2Zvcm1Db250ZXh0KHdpdGhUcmFuc2l0aW9uLCB0cmFuc2l0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCQkLmxlZ2VuZCkge1xuICAgICAgICAgICAgJCQudHJhbnNmb3JtTGVnZW5kKHdpdGhUcmFuc2l0aW9uKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVTdmdTaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgYnJ1c2ggPSAkJC5zdmcuc2VsZWN0KFwiLmMzLWJydXNoIC5iYWNrZ3JvdW5kXCIpO1xuICAgICAgICAkJC5zdmcuYXR0cignd2lkdGgnLCAkJC5jdXJyZW50V2lkdGgpLmF0dHIoJ2hlaWdodCcsICQkLmN1cnJlbnRIZWlnaHQpO1xuICAgICAgICAkJC5zdmcuc2VsZWN0QWxsKFsnIycgKyAkJC5jbGlwSWQsICcjJyArICQkLmNsaXBJZEZvckdyaWRdKS5zZWxlY3QoJ3JlY3QnKS5hdHRyKCd3aWR0aCcsICQkLndpZHRoKS5hdHRyKCdoZWlnaHQnLCAkJC5oZWlnaHQpO1xuICAgICAgICAkJC5zdmcuc2VsZWN0KCcjJyArICQkLmNsaXBJZEZvclhBeGlzKS5zZWxlY3QoJ3JlY3QnKS5hdHRyKCd4JywgJCQuZ2V0WEF4aXNDbGlwWC5iaW5kKCQkKSkuYXR0cigneScsICQkLmdldFhBeGlzQ2xpcFkuYmluZCgkJCkpLmF0dHIoJ3dpZHRoJywgJCQuZ2V0WEF4aXNDbGlwV2lkdGguYmluZCgkJCkpLmF0dHIoJ2hlaWdodCcsICQkLmdldFhBeGlzQ2xpcEhlaWdodC5iaW5kKCQkKSk7XG4gICAgICAgICQkLnN2Zy5zZWxlY3QoJyMnICsgJCQuY2xpcElkRm9yWUF4aXMpLnNlbGVjdCgncmVjdCcpLmF0dHIoJ3gnLCAkJC5nZXRZQXhpc0NsaXBYLmJpbmQoJCQpKS5hdHRyKCd5JywgJCQuZ2V0WUF4aXNDbGlwWS5iaW5kKCQkKSkuYXR0cignd2lkdGgnLCAkJC5nZXRZQXhpc0NsaXBXaWR0aC5iaW5kKCQkKSkuYXR0cignaGVpZ2h0JywgJCQuZ2V0WUF4aXNDbGlwSGVpZ2h0LmJpbmQoJCQpKTtcbiAgICAgICAgJCQuc3ZnLnNlbGVjdCgnIycgKyAkJC5jbGlwSWRGb3JTdWJjaGFydCkuc2VsZWN0KCdyZWN0JykuYXR0cignd2lkdGgnLCAkJC53aWR0aCkuYXR0cignaGVpZ2h0JywgYnJ1c2guc2l6ZSgpID8gYnJ1c2guYXR0cignaGVpZ2h0JykgOiAwKTtcbiAgICAgICAgJCQuc3ZnLnNlbGVjdCgnLicgKyBDTEFTUy56b29tUmVjdCkuYXR0cignd2lkdGgnLCAkJC53aWR0aCkuYXR0cignaGVpZ2h0JywgJCQuaGVpZ2h0KTtcbiAgICAgICAgLy8gTUVNTzogcGFyZW50IGRpdidzIGhlaWdodCB3aWxsIGJlIGJpZ2dlciB0aGFuIHN2ZyB3aGVuIDwhRE9DVFlQRSBodG1sPlxuICAgICAgICAkJC5zZWxlY3RDaGFydC5zdHlsZSgnbWF4LWhlaWdodCcsICQkLmN1cnJlbnRIZWlnaHQgKyBcInB4XCIpO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVEaW1lbnNpb24gPSBmdW5jdGlvbiAod2l0aG91dEF4aXMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgaWYgKCF3aXRob3V0QXhpcykge1xuICAgICAgICAgICAgaWYgKCQkLmNvbmZpZy5heGlzX3JvdGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAkJC5heGVzLnguY2FsbCgkJC54QXhpcyk7XG4gICAgICAgICAgICAgICAgJCQuYXhlcy5zdWJ4LmNhbGwoJCQuc3ViWEF4aXMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkJC5heGVzLnkuY2FsbCgkJC55QXhpcyk7XG4gICAgICAgICAgICAgICAgJCQuYXhlcy55Mi5jYWxsKCQkLnkyQXhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgJCQudXBkYXRlU2l6ZXMoKTtcbiAgICAgICAgJCQudXBkYXRlU2NhbGVzKCk7XG4gICAgICAgICQkLnVwZGF0ZVN2Z1NpemUoKTtcbiAgICAgICAgJCQudHJhbnNmb3JtQWxsKGZhbHNlKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ub2JzZXJ2ZUluc2VydGVkID0gZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgb2JzZXJ2ZXI7XG4gICAgICAgIGlmICh0eXBlb2YgTXV0YXRpb25PYnNlcnZlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmVycm9yKFwiTXV0YXRpb25PYnNlcnZlciBub3QgZGVmaW5lZC5cIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAobXV0YXRpb25zKSB7XG4gICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobXV0YXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2NoaWxkTGlzdCcgJiYgbXV0YXRpb24ucHJldmlvdXNTaWJsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbmVlZCB0byB3YWl0IGZvciBjb21wbGV0aW9uIG9mIGxvYWQgYmVjYXVzZSBzaXplIGNhbGN1bGF0aW9uIHJlcXVpcmVzIHRoZSBhY3R1YWwgc2l6ZXMgZGV0ZXJtaW5lZCBhZnRlciB0aGF0IGNvbXBsZXRpb25cbiAgICAgICAgICAgICAgICAgICAgJCQuaW50ZXJ2YWxGb3JPYnNlcnZlSW5zZXJ0ZWQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFyZW50Tm9kZSB3aWxsIE5PVCBiZSBudWxsIHdoZW4gY29tcGxldGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0aW9uLm5vZGUoKS5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoJCQuaW50ZXJ2YWxGb3JPYnNlcnZlSW5zZXJ0ZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQkLnVwZGF0ZURpbWVuc2lvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkJC5icnVzaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkJC5icnVzaC51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCQuY29uZmlnLm9uaW5pdC5jYWxsKCQkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkJC5yZWRyYXcoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoVHJhbnNmb3JtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoVXBkYXRlWERvbWFpbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aFVwZGF0ZU9yZ1hEb21haW46IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGhUcmFuc2l0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aFRyYW5zaXRpb25Gb3JUcmFuc2Zvcm06IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoTGVnZW5kOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uLnRyYW5zaXRpb24oKS5zdHlsZSgnb3BhY2l0eScsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKHNlbGVjdGlvbi5ub2RlKCksIHsgYXR0cmlidXRlczogdHJ1ZSwgY2hpbGRMaXN0OiB0cnVlLCBjaGFyYWN0ZXJEYXRhOiB0cnVlIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5iaW5kUmVzaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuXG4gICAgICAgICQkLnJlc2l6ZUZ1bmN0aW9uID0gJCQuZ2VuZXJhdGVSZXNpemUoKTtcblxuICAgICAgICAkJC5yZXNpemVGdW5jdGlvbi5hZGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uZmlnLm9ucmVzaXplLmNhbGwoJCQpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGNvbmZpZy5yZXNpemVfYXV0bykge1xuICAgICAgICAgICAgJCQucmVzaXplRnVuY3Rpb24uYWRkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCQucmVzaXplVGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoJCQucmVzaXplVGltZW91dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQkLnJlc2l6ZVRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSAkJC5yZXNpemVUaW1lb3V0O1xuICAgICAgICAgICAgICAgICAgICAkJC5hcGkuZmx1c2goKTtcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgJCQucmVzaXplRnVuY3Rpb24uYWRkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbmZpZy5vbnJlc2l6ZWQuY2FsbCgkJCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh3aW5kb3cuYXR0YWNoRXZlbnQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5hdHRhY2hFdmVudCgnb25yZXNpemUnLCAkJC5yZXNpemVGdW5jdGlvbik7XG4gICAgICAgIH0gZWxzZSBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAkJC5yZXNpemVGdW5jdGlvbiwgZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gZmFsbGJhY2sgdG8gdGhpcywgaWYgdGhpcyBpcyBhIHZlcnkgb2xkIGJyb3dzZXJcbiAgICAgICAgICAgIHZhciB3cmFwcGVyID0gd2luZG93Lm9ucmVzaXplO1xuICAgICAgICAgICAgaWYgKCF3cmFwcGVyKSB7XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgd3JhcHBlciB0aGF0IHdpbGwgY2FsbCBhbGwgY2hhcnRzXG4gICAgICAgICAgICAgICAgd3JhcHBlciA9ICQkLmdlbmVyYXRlUmVzaXplKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCF3cmFwcGVyLmFkZCB8fCAhd3JhcHBlci5yZW1vdmUpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGVyZSBpcyBhbHJlYWR5IGEgaGFuZGxlciByZWdpc3RlcmVkLCBtYWtlIHN1cmUgd2UgY2FsbCBpdCB0b29cbiAgICAgICAgICAgICAgICB3cmFwcGVyID0gJCQuZ2VuZXJhdGVSZXNpemUoKTtcbiAgICAgICAgICAgICAgICB3cmFwcGVyLmFkZCh3aW5kb3cub25yZXNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYWRkIHRoaXMgZ3JhcGggdG8gdGhlIHdyYXBwZXIsIHdlIHdpbGwgYmUgcmVtb3ZlZCBpZiB0aGUgdXNlciBjYWxscyBkZXN0cm95XG4gICAgICAgICAgICB3cmFwcGVyLmFkZCgkJC5yZXNpemVGdW5jdGlvbik7XG4gICAgICAgICAgICB3aW5kb3cub25yZXNpemUgPSB3cmFwcGVyO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlUmVzaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmVzaXplRnVuY3Rpb25zID0gW107XG4gICAgICAgIGZ1bmN0aW9uIGNhbGxSZXNpemVGdW5jdGlvbnMoKSB7XG4gICAgICAgICAgICByZXNpemVGdW5jdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgIGYoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxSZXNpemVGdW5jdGlvbnMuYWRkID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgIHJlc2l6ZUZ1bmN0aW9ucy5wdXNoKGYpO1xuICAgICAgICB9O1xuICAgICAgICBjYWxsUmVzaXplRnVuY3Rpb25zLnJlbW92ZSA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc2l6ZUZ1bmN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChyZXNpemVGdW5jdGlvbnNbaV0gPT09IGYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplRnVuY3Rpb25zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FsbFJlc2l6ZUZ1bmN0aW9ucztcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZW5kYWxsID0gZnVuY3Rpb24gKHRyYW5zaXRpb24sIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBuID0gMDtcbiAgICAgICAgdHJhbnNpdGlvbi5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICsrbjtcbiAgICAgICAgfSkuZWFjaChcImVuZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoISAtLW4pIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlV2FpdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyYW5zaXRpb25zVG9XYWl0ID0gW10sXG4gICAgICAgICAgICBmID0gZnVuY3Rpb24gZih0cmFuc2l0aW9uLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBkb25lID0gMDtcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uc1RvV2FpdC5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0LmVtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC50cmFuc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChkb25lID09PSB0cmFuc2l0aW9uc1RvV2FpdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgfTtcbiAgICAgICAgZi5hZGQgPSBmdW5jdGlvbiAodHJhbnNpdGlvbikge1xuICAgICAgICAgICAgdHJhbnNpdGlvbnNUb1dhaXQucHVzaCh0cmFuc2l0aW9uKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGY7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnBhcnNlRGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBwYXJzZWREYXRlO1xuICAgICAgICBpZiAoZGF0ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgIHBhcnNlZERhdGUgPSBkYXRlO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcGFyc2VkRGF0ZSA9ICQkLmRhdGFUaW1lRm9ybWF0KCQkLmNvbmZpZy5kYXRhX3hGb3JtYXQpLnBhcnNlKGRhdGUpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRlID09PSAnbnVtYmVyJyAmJiAhaXNOYU4oZGF0ZSkpIHtcbiAgICAgICAgICAgIHBhcnNlZERhdGUgPSBuZXcgRGF0ZSgrZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwYXJzZWREYXRlIHx8IGlzTmFOKCtwYXJzZWREYXRlKSkge1xuICAgICAgICAgICAgd2luZG93LmNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcGFyc2UgeCAnXCIgKyBkYXRlICsgXCInIHRvIERhdGUgb2JqZWN0XCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJzZWREYXRlO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc1RhYlZpc2libGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBoaWRkZW47XG4gICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQuaGlkZGVuICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAvLyBPcGVyYSAxMi4xMCBhbmQgRmlyZWZveCAxOCBhbmQgbGF0ZXIgc3VwcG9ydFxuICAgICAgICAgICAgaGlkZGVuID0gXCJoaWRkZW5cIjtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnQubW96SGlkZGVuICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICBoaWRkZW4gPSBcIm1vekhpZGRlblwiO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudC5tc0hpZGRlbiAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgaGlkZGVuID0gXCJtc0hpZGRlblwiO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudC53ZWJraXRIaWRkZW4gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIGhpZGRlbiA9IFwid2Via2l0SGlkZGVuXCI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZG9jdW1lbnRbaGlkZGVuXSA/IGZhbHNlIDogdHJ1ZTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0RGVmYXVsdENvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgIGJpbmR0bzogJyNjaGFydCcsXG4gICAgICAgICAgICBzdmdfY2xhc3NuYW1lOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBzaXplX3dpZHRoOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBzaXplX2hlaWdodDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGFkZGluZ19sZWZ0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBwYWRkaW5nX3JpZ2h0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBwYWRkaW5nX3RvcDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGFkZGluZ19ib3R0b206IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHJlc2l6ZV9hdXRvOiB0cnVlLFxuICAgICAgICAgICAgem9vbV9lbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgIHpvb21fZXh0ZW50OiB1bmRlZmluZWQsXG4gICAgICAgICAgICB6b29tX3ByaXZpbGVnZWQ6IGZhbHNlLFxuICAgICAgICAgICAgem9vbV9yZXNjYWxlOiBmYWxzZSxcbiAgICAgICAgICAgIHpvb21fb256b29tOiBmdW5jdGlvbiB6b29tX29uem9vbSgpIHt9LFxuICAgICAgICAgICAgem9vbV9vbnpvb21zdGFydDogZnVuY3Rpb24gem9vbV9vbnpvb21zdGFydCgpIHt9LFxuICAgICAgICAgICAgem9vbV9vbnpvb21lbmQ6IGZ1bmN0aW9uIHpvb21fb256b29tZW5kKCkge30sXG4gICAgICAgICAgICB6b29tX3hfbWluOiB1bmRlZmluZWQsXG4gICAgICAgICAgICB6b29tX3hfbWF4OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBpbnRlcmFjdGlvbl9icmlnaHRlbjogdHJ1ZSxcbiAgICAgICAgICAgIGludGVyYWN0aW9uX2VuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBvbm1vdXNlb3ZlcjogZnVuY3Rpb24gb25tb3VzZW92ZXIoKSB7fSxcbiAgICAgICAgICAgIG9ubW91c2VvdXQ6IGZ1bmN0aW9uIG9ubW91c2VvdXQoKSB7fSxcbiAgICAgICAgICAgIG9ucmVzaXplOiBmdW5jdGlvbiBvbnJlc2l6ZSgpIHt9LFxuICAgICAgICAgICAgb25yZXNpemVkOiBmdW5jdGlvbiBvbnJlc2l6ZWQoKSB7fSxcbiAgICAgICAgICAgIG9uaW5pdDogZnVuY3Rpb24gb25pbml0KCkge30sXG4gICAgICAgICAgICBvbnJlbmRlcmVkOiBmdW5jdGlvbiBvbnJlbmRlcmVkKCkge30sXG4gICAgICAgICAgICB0cmFuc2l0aW9uX2R1cmF0aW9uOiAzNTAsXG4gICAgICAgICAgICBkYXRhX3g6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRhdGFfeHM6IHt9LFxuICAgICAgICAgICAgZGF0YV94Rm9ybWF0OiAnJVktJW0tJWQnLFxuICAgICAgICAgICAgZGF0YV94TG9jYWx0aW1lOiB0cnVlLFxuICAgICAgICAgICAgZGF0YV94U29ydDogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGFfaWRDb252ZXJ0ZXI6IGZ1bmN0aW9uIGRhdGFfaWRDb252ZXJ0ZXIoaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YV9uYW1lczoge30sXG4gICAgICAgICAgICBkYXRhX2NsYXNzZXM6IHt9LFxuICAgICAgICAgICAgZGF0YV9ncm91cHM6IFtdLFxuICAgICAgICAgICAgZGF0YV9heGVzOiB7fSxcbiAgICAgICAgICAgIGRhdGFfdHlwZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGF0YV90eXBlczoge30sXG4gICAgICAgICAgICBkYXRhX2xhYmVsczoge30sXG4gICAgICAgICAgICBkYXRhX29yZGVyOiAnZGVzYycsXG4gICAgICAgICAgICBkYXRhX3JlZ2lvbnM6IHt9LFxuICAgICAgICAgICAgZGF0YV9jb2xvcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGF0YV9jb2xvcnM6IHt9LFxuICAgICAgICAgICAgZGF0YV9oaWRlOiBmYWxzZSxcbiAgICAgICAgICAgIGRhdGFfZmlsdGVyOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBkYXRhX3NlbGVjdGlvbl9lbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgIGRhdGFfc2VsZWN0aW9uX2dyb3VwZWQ6IGZhbHNlLFxuICAgICAgICAgICAgZGF0YV9zZWxlY3Rpb25faXNzZWxlY3RhYmxlOiBmdW5jdGlvbiBkYXRhX3NlbGVjdGlvbl9pc3NlbGVjdGFibGUoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGF0YV9zZWxlY3Rpb25fbXVsdGlwbGU6IHRydWUsXG4gICAgICAgICAgICBkYXRhX3NlbGVjdGlvbl9kcmFnZ2FibGU6IGZhbHNlLFxuICAgICAgICAgICAgZGF0YV9vbmNsaWNrOiBmdW5jdGlvbiBkYXRhX29uY2xpY2soKSB7fSxcbiAgICAgICAgICAgIGRhdGFfb25tb3VzZW92ZXI6IGZ1bmN0aW9uIGRhdGFfb25tb3VzZW92ZXIoKSB7fSxcbiAgICAgICAgICAgIGRhdGFfb25tb3VzZW91dDogZnVuY3Rpb24gZGF0YV9vbm1vdXNlb3V0KCkge30sXG4gICAgICAgICAgICBkYXRhX29uc2VsZWN0ZWQ6IGZ1bmN0aW9uIGRhdGFfb25zZWxlY3RlZCgpIHt9LFxuICAgICAgICAgICAgZGF0YV9vbnVuc2VsZWN0ZWQ6IGZ1bmN0aW9uIGRhdGFfb251bnNlbGVjdGVkKCkge30sXG4gICAgICAgICAgICBkYXRhX3VybDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGF0YV9oZWFkZXJzOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBkYXRhX2pzb246IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRhdGFfcm93czogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGF0YV9jb2x1bW5zOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBkYXRhX21pbWVUeXBlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBkYXRhX2tleXM6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIC8vIGNvbmZpZ3VyYXRpb24gZm9yIG5vIHBsb3QtYWJsZSBkYXRhIHN1cHBsaWVkLlxuICAgICAgICAgICAgZGF0YV9lbXB0eV9sYWJlbF90ZXh0OiBcIlwiLFxuICAgICAgICAgICAgLy8gc3ViY2hhcnRcbiAgICAgICAgICAgIHN1YmNoYXJ0X3Nob3c6IGZhbHNlLFxuICAgICAgICAgICAgc3ViY2hhcnRfc2l6ZV9oZWlnaHQ6IDYwLFxuICAgICAgICAgICAgc3ViY2hhcnRfYXhpc194X3Nob3c6IHRydWUsXG4gICAgICAgICAgICBzdWJjaGFydF9vbmJydXNoOiBmdW5jdGlvbiBzdWJjaGFydF9vbmJydXNoKCkge30sXG4gICAgICAgICAgICAvLyBjb2xvclxuICAgICAgICAgICAgY29sb3JfcGF0dGVybjogW10sXG4gICAgICAgICAgICBjb2xvcl90aHJlc2hvbGQ6IHt9LFxuICAgICAgICAgICAgLy8gbGVnZW5kXG4gICAgICAgICAgICBsZWdlbmRfc2hvdzogdHJ1ZSxcbiAgICAgICAgICAgIGxlZ2VuZF9oaWRlOiBmYWxzZSxcbiAgICAgICAgICAgIGxlZ2VuZF9wb3NpdGlvbjogJ2JvdHRvbScsXG4gICAgICAgICAgICBsZWdlbmRfaW5zZXRfYW5jaG9yOiAndG9wLWxlZnQnLFxuICAgICAgICAgICAgbGVnZW5kX2luc2V0X3g6IDEwLFxuICAgICAgICAgICAgbGVnZW5kX2luc2V0X3k6IDAsXG4gICAgICAgICAgICBsZWdlbmRfaW5zZXRfc3RlcDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgbGVnZW5kX2l0ZW1fb25jbGljazogdW5kZWZpbmVkLFxuICAgICAgICAgICAgbGVnZW5kX2l0ZW1fb25tb3VzZW92ZXI6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGxlZ2VuZF9pdGVtX29ubW91c2VvdXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGxlZ2VuZF9lcXVhbGx5OiBmYWxzZSxcbiAgICAgICAgICAgIGxlZ2VuZF9wYWRkaW5nOiAwLFxuICAgICAgICAgICAgbGVnZW5kX2l0ZW1fdGlsZV93aWR0aDogMTAsXG4gICAgICAgICAgICBsZWdlbmRfaXRlbV90aWxlX2hlaWdodDogMTAsXG4gICAgICAgICAgICAvLyBheGlzXG4gICAgICAgICAgICBheGlzX3JvdGF0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgYXhpc194X3Nob3c6IHRydWUsXG4gICAgICAgICAgICBheGlzX3hfdHlwZTogJ2luZGV4ZWQnLFxuICAgICAgICAgICAgYXhpc194X2xvY2FsdGltZTogdHJ1ZSxcbiAgICAgICAgICAgIGF4aXNfeF9jYXRlZ29yaWVzOiBbXSxcbiAgICAgICAgICAgIGF4aXNfeF90aWNrX2NlbnRlcmVkOiBmYWxzZSxcbiAgICAgICAgICAgIGF4aXNfeF90aWNrX2Zvcm1hdDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXhpc194X3RpY2tfY3VsbGluZzoge30sXG4gICAgICAgICAgICBheGlzX3hfdGlja19jdWxsaW5nX21heDogMTAsXG4gICAgICAgICAgICBheGlzX3hfdGlja19jb3VudDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXhpc194X3RpY2tfZml0OiB0cnVlLFxuICAgICAgICAgICAgYXhpc194X3RpY2tfdmFsdWVzOiBudWxsLFxuICAgICAgICAgICAgYXhpc194X3RpY2tfcm90YXRlOiAwLFxuICAgICAgICAgICAgYXhpc194X3RpY2tfb3V0ZXI6IHRydWUsXG4gICAgICAgICAgICBheGlzX3hfdGlja19tdWx0aWxpbmU6IHRydWUsXG4gICAgICAgICAgICBheGlzX3hfdGlja193aWR0aDogbnVsbCxcbiAgICAgICAgICAgIGF4aXNfeF9tYXg6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGF4aXNfeF9taW46IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGF4aXNfeF9wYWRkaW5nOiB7fSxcbiAgICAgICAgICAgIGF4aXNfeF9oZWlnaHQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGF4aXNfeF9leHRlbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGF4aXNfeF9sYWJlbDoge30sXG4gICAgICAgICAgICBheGlzX3lfc2hvdzogdHJ1ZSxcbiAgICAgICAgICAgIGF4aXNfeV90eXBlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3lfbWF4OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3lfbWluOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3lfaW52ZXJ0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgYXhpc195X2NlbnRlcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXhpc195X2lubmVyOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3lfbGFiZWw6IHt9LFxuICAgICAgICAgICAgYXhpc195X3RpY2tfZm9ybWF0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3lfdGlja19vdXRlcjogdHJ1ZSxcbiAgICAgICAgICAgIGF4aXNfeV90aWNrX3ZhbHVlczogbnVsbCxcbiAgICAgICAgICAgIGF4aXNfeV90aWNrX3JvdGF0ZTogMCxcbiAgICAgICAgICAgIGF4aXNfeV90aWNrX2NvdW50OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3lfdGlja190aW1lX3ZhbHVlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3lfdGlja190aW1lX2ludGVydmFsOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3lfcGFkZGluZzoge30sXG4gICAgICAgICAgICBheGlzX3lfZGVmYXVsdDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXhpc195Ml9zaG93OiBmYWxzZSxcbiAgICAgICAgICAgIGF4aXNfeTJfbWF4OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3kyX21pbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXhpc195Ml9pbnZlcnRlZDogZmFsc2UsXG4gICAgICAgICAgICBheGlzX3kyX2NlbnRlcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXhpc195Ml9pbm5lcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXhpc195Ml9sYWJlbDoge30sXG4gICAgICAgICAgICBheGlzX3kyX3RpY2tfZm9ybWF0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3kyX3RpY2tfb3V0ZXI6IHRydWUsXG4gICAgICAgICAgICBheGlzX3kyX3RpY2tfdmFsdWVzOiBudWxsLFxuICAgICAgICAgICAgYXhpc195Ml90aWNrX2NvdW50OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBheGlzX3kyX3BhZGRpbmc6IHt9LFxuICAgICAgICAgICAgYXhpc195Ml9kZWZhdWx0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAvLyBncmlkXG4gICAgICAgICAgICBncmlkX3hfc2hvdzogZmFsc2UsXG4gICAgICAgICAgICBncmlkX3hfdHlwZTogJ3RpY2snLFxuICAgICAgICAgICAgZ3JpZF94X2xpbmVzOiBbXSxcbiAgICAgICAgICAgIGdyaWRfeV9zaG93OiBmYWxzZSxcbiAgICAgICAgICAgIC8vIG5vdCB1c2VkXG4gICAgICAgICAgICAvLyBncmlkX3lfdHlwZTogJ3RpY2snLFxuICAgICAgICAgICAgZ3JpZF95X2xpbmVzOiBbXSxcbiAgICAgICAgICAgIGdyaWRfeV90aWNrczogMTAsXG4gICAgICAgICAgICBncmlkX2ZvY3VzX3Nob3c6IHRydWUsXG4gICAgICAgICAgICBncmlkX2xpbmVzX2Zyb250OiB0cnVlLFxuICAgICAgICAgICAgLy8gcG9pbnQgLSBwb2ludCBvZiBlYWNoIGRhdGFcbiAgICAgICAgICAgIHBvaW50X3Nob3c6IHRydWUsXG4gICAgICAgICAgICBwb2ludF9yOiAyLjUsXG4gICAgICAgICAgICBwb2ludF9zZW5zaXRpdml0eTogMTAsXG4gICAgICAgICAgICBwb2ludF9mb2N1c19leHBhbmRfZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICAgIHBvaW50X2ZvY3VzX2V4cGFuZF9yOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBwb2ludF9zZWxlY3RfcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgLy8gbGluZVxuICAgICAgICAgICAgbGluZV9jb25uZWN0TnVsbDogZmFsc2UsXG4gICAgICAgICAgICBsaW5lX3N0ZXBfdHlwZTogJ3N0ZXAnLFxuICAgICAgICAgICAgLy8gYmFyXG4gICAgICAgICAgICBiYXJfd2lkdGg6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGJhcl93aWR0aF9yYXRpbzogMC42LFxuICAgICAgICAgICAgYmFyX3dpZHRoX21heDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYmFyX3plcm9iYXNlZDogdHJ1ZSxcbiAgICAgICAgICAgIC8vIGFyZWFcbiAgICAgICAgICAgIGFyZWFfemVyb2Jhc2VkOiB0cnVlLFxuICAgICAgICAgICAgYXJlYV9hYm92ZTogZmFsc2UsXG4gICAgICAgICAgICAvLyBwaWVcbiAgICAgICAgICAgIHBpZV9sYWJlbF9zaG93OiB0cnVlLFxuICAgICAgICAgICAgcGllX2xhYmVsX2Zvcm1hdDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGllX2xhYmVsX3RocmVzaG9sZDogMC4wNSxcbiAgICAgICAgICAgIHBpZV9sYWJlbF9yYXRpbzogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGllX2V4cGFuZDoge30sXG4gICAgICAgICAgICBwaWVfZXhwYW5kX2R1cmF0aW9uOiA1MCxcbiAgICAgICAgICAgIC8vIGdhdWdlXG4gICAgICAgICAgICBnYXVnZV9mdWxsQ2lyY2xlOiBmYWxzZSxcbiAgICAgICAgICAgIGdhdWdlX2xhYmVsX3Nob3c6IHRydWUsXG4gICAgICAgICAgICBnYXVnZV9sYWJlbF9mb3JtYXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGdhdWdlX21pbjogMCxcbiAgICAgICAgICAgIGdhdWdlX21heDogMTAwLFxuICAgICAgICAgICAgZ2F1Z2Vfc3RhcnRpbmdBbmdsZTogLTEgKiBNYXRoLlBJIC8gMixcbiAgICAgICAgICAgIGdhdWdlX3VuaXRzOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBnYXVnZV93aWR0aDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZ2F1Z2VfZXhwYW5kOiB7fSxcbiAgICAgICAgICAgIGdhdWdlX2V4cGFuZF9kdXJhdGlvbjogNTAsXG4gICAgICAgICAgICAvLyBkb251dFxuICAgICAgICAgICAgZG9udXRfbGFiZWxfc2hvdzogdHJ1ZSxcbiAgICAgICAgICAgIGRvbnV0X2xhYmVsX2Zvcm1hdDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZG9udXRfbGFiZWxfdGhyZXNob2xkOiAwLjA1LFxuICAgICAgICAgICAgZG9udXRfbGFiZWxfcmF0aW86IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRvbnV0X3dpZHRoOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBkb251dF90aXRsZTogXCJcIixcbiAgICAgICAgICAgIGRvbnV0X2V4cGFuZDoge30sXG4gICAgICAgICAgICBkb251dF9leHBhbmRfZHVyYXRpb246IDUwLFxuICAgICAgICAgICAgLy8gc3BsaW5lXG4gICAgICAgICAgICBzcGxpbmVfaW50ZXJwb2xhdGlvbl90eXBlOiAnY2FyZGluYWwnLFxuICAgICAgICAgICAgLy8gcmVnaW9uIC0gcmVnaW9uIHRvIGNoYW5nZSBzdHlsZVxuICAgICAgICAgICAgcmVnaW9uczogW10sXG4gICAgICAgICAgICAvLyB0b29sdGlwIC0gc2hvdyB3aGVuIG1vdXNlb3ZlciBvbiBlYWNoIGRhdGFcbiAgICAgICAgICAgIHRvb2x0aXBfc2hvdzogdHJ1ZSxcbiAgICAgICAgICAgIHRvb2x0aXBfZ3JvdXBlZDogdHJ1ZSxcbiAgICAgICAgICAgIHRvb2x0aXBfZm9ybWF0X3RpdGxlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICB0b29sdGlwX2Zvcm1hdF9uYW1lOiB1bmRlZmluZWQsXG4gICAgICAgICAgICB0b29sdGlwX2Zvcm1hdF92YWx1ZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgdG9vbHRpcF9wb3NpdGlvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgdG9vbHRpcF9jb250ZW50czogZnVuY3Rpb24gdG9vbHRpcF9jb250ZW50cyhkLCBkZWZhdWx0VGl0bGVGb3JtYXQsIGRlZmF1bHRWYWx1ZUZvcm1hdCwgY29sb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRUb29sdGlwQ29udGVudCA/IHRoaXMuZ2V0VG9vbHRpcENvbnRlbnQoZCwgZGVmYXVsdFRpdGxlRm9ybWF0LCBkZWZhdWx0VmFsdWVGb3JtYXQsIGNvbG9yKSA6ICcnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvb2x0aXBfaW5pdF9zaG93OiBmYWxzZSxcbiAgICAgICAgICAgIHRvb2x0aXBfaW5pdF94OiAwLFxuICAgICAgICAgICAgdG9vbHRpcF9pbml0X3Bvc2l0aW9uOiB7IHRvcDogJzBweCcsIGxlZnQ6ICc1MHB4JyB9LFxuICAgICAgICAgICAgdG9vbHRpcF9vbnNob3c6IGZ1bmN0aW9uIHRvb2x0aXBfb25zaG93KCkge30sXG4gICAgICAgICAgICB0b29sdGlwX29uaGlkZTogZnVuY3Rpb24gdG9vbHRpcF9vbmhpZGUoKSB7fSxcbiAgICAgICAgICAgIC8vIHRpdGxlXG4gICAgICAgICAgICB0aXRsZV90ZXh0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICB0aXRsZV9wYWRkaW5nOiB7XG4gICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICAgICAgICAgIGJvdHRvbTogMCxcbiAgICAgICAgICAgICAgICBsZWZ0OiAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGl0bGVfcG9zaXRpb246ICd0b3AtY2VudGVyJ1xuICAgICAgICB9O1xuXG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMuYWRkaXRpb25hbENvbmZpZykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBjb25maWdba2V5XSA9IHRoaXMuYWRkaXRpb25hbENvbmZpZ1trZXldO1xuICAgICAgICB9LCB0aGlzKTtcblxuICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uYWRkaXRpb25hbENvbmZpZyA9IHt9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ubG9hZENvbmZpZyA9IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgdmFyIHRoaXNfY29uZmlnID0gdGhpcy5jb25maWcsXG4gICAgICAgICAgICB0YXJnZXQsXG4gICAgICAgICAgICBrZXlzLFxuICAgICAgICAgICAgcmVhZDtcbiAgICAgICAgZnVuY3Rpb24gZmluZCgpIHtcbiAgICAgICAgICAgIHZhciBrZXkgPSBrZXlzLnNoaWZ0KCk7XG4gICAgICAgICAgICAvLyAgICAgICAgY29uc29sZS5sb2coXCJrZXkgPT5cIiwga2V5LCBcIiwgdGFyZ2V0ID0+XCIsIHRhcmdldCk7XG4gICAgICAgICAgICBpZiAoa2V5ICYmIHRhcmdldCAmJiAodHlwZW9mIHRhcmdldCA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YodGFyZ2V0KSkgPT09ICdvYmplY3QnICYmIGtleSBpbiB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXRba2V5XTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmluZCgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgha2V5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBPYmplY3Qua2V5cyh0aGlzX2NvbmZpZykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB0YXJnZXQgPSBjb25maWc7XG4gICAgICAgICAgICBrZXlzID0ga2V5LnNwbGl0KCdfJyk7XG4gICAgICAgICAgICByZWFkID0gZmluZCgpO1xuICAgICAgICAgICAgLy8gICAgICAgIGNvbnNvbGUubG9nKFwiQ09ORklHIDogXCIsIGtleSwgcmVhZCk7XG4gICAgICAgICAgICBpZiAoaXNEZWZpbmVkKHJlYWQpKSB7XG4gICAgICAgICAgICAgICAgdGhpc19jb25maWdba2V5XSA9IHJlYWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRTY2FsZSA9IGZ1bmN0aW9uIChtaW4sIG1heCwgZm9yVGltZXNlcmllcykge1xuICAgICAgICByZXR1cm4gKGZvclRpbWVzZXJpZXMgPyB0aGlzLmQzLnRpbWUuc2NhbGUoKSA6IHRoaXMuZDMuc2NhbGUubGluZWFyKCkpLnJhbmdlKFttaW4sIG1heF0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WCA9IGZ1bmN0aW9uIChtaW4sIG1heCwgZG9tYWluLCBvZmZzZXQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHNjYWxlID0gJCQuZ2V0U2NhbGUobWluLCBtYXgsICQkLmlzVGltZVNlcmllcygpKSxcbiAgICAgICAgICAgIF9zY2FsZSA9IGRvbWFpbiA/IHNjYWxlLmRvbWFpbihkb21haW4pIDogc2NhbGUsXG4gICAgICAgICAgICBrZXk7XG4gICAgICAgIC8vIERlZmluZSBjdXN0b21pemVkIHNjYWxlIGlmIGNhdGVnb3JpemVkIGF4aXNcbiAgICAgICAgaWYgKCQkLmlzQ2F0ZWdvcml6ZWQoKSkge1xuICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzY2FsZSA9IGZ1bmN0aW9uIHNjYWxlKGQsIHJhdykge1xuICAgICAgICAgICAgICAgIHZhciB2ID0gX3NjYWxlKGQpICsgb2Zmc2V0KGQpO1xuICAgICAgICAgICAgICAgIHJldHVybiByYXcgPyB2IDogTWF0aC5jZWlsKHYpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNjYWxlID0gZnVuY3Rpb24gc2NhbGUoZCwgcmF3KSB7XG4gICAgICAgICAgICAgICAgdmFyIHYgPSBfc2NhbGUoZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJhdyA/IHYgOiBNYXRoLmNlaWwodik7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIGRlZmluZSBmdW5jdGlvbnNcbiAgICAgICAgZm9yIChrZXkgaW4gX3NjYWxlKSB7XG4gICAgICAgICAgICBzY2FsZVtrZXldID0gX3NjYWxlW2tleV07XG4gICAgICAgIH1cbiAgICAgICAgc2NhbGUub3JnRG9tYWluID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9zY2FsZS5kb21haW4oKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gZGVmaW5lIGN1c3RvbSBkb21haW4oKSBmb3IgY2F0ZWdvcml6ZWQgYXhpc1xuICAgICAgICBpZiAoJCQuaXNDYXRlZ29yaXplZCgpKSB7XG4gICAgICAgICAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbiAoZG9tYWluKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbWFpbiA9IHRoaXMub3JnRG9tYWluKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbZG9tYWluWzBdLCBkb21haW5bMV0gKyAxXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3NjYWxlLmRvbWFpbihkb21haW4pO1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNjYWxlO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WSA9IGZ1bmN0aW9uIChtaW4sIG1heCwgZG9tYWluKSB7XG4gICAgICAgIHZhciBzY2FsZSA9IHRoaXMuZ2V0U2NhbGUobWluLCBtYXgsIHRoaXMuaXNUaW1lU2VyaWVzWSgpKTtcbiAgICAgICAgaWYgKGRvbWFpbikge1xuICAgICAgICAgICAgc2NhbGUuZG9tYWluKGRvbWFpbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNjYWxlO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WVNjYWxlID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmF4aXMuZ2V0SWQoaWQpID09PSAneTInID8gdGhpcy55MiA6IHRoaXMueTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFN1YllTY2FsZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5heGlzLmdldElkKGlkKSA9PT0gJ3kyJyA/IHRoaXMuc3ViWTIgOiB0aGlzLnN1Ylk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVTY2FsZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBmb3JJbml0ID0gISQkLng7XG4gICAgICAgIC8vIHVwZGF0ZSBlZGdlc1xuICAgICAgICAkJC54TWluID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IDEgOiAwO1xuICAgICAgICAkJC54TWF4ID0gY29uZmlnLmF4aXNfcm90YXRlZCA/ICQkLmhlaWdodCA6ICQkLndpZHRoO1xuICAgICAgICAkJC55TWluID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IDAgOiAkJC5oZWlnaHQ7XG4gICAgICAgICQkLnlNYXggPSBjb25maWcuYXhpc19yb3RhdGVkID8gJCQud2lkdGggOiAxO1xuICAgICAgICAkJC5zdWJYTWluID0gJCQueE1pbjtcbiAgICAgICAgJCQuc3ViWE1heCA9ICQkLnhNYXg7XG4gICAgICAgICQkLnN1YllNaW4gPSBjb25maWcuYXhpc19yb3RhdGVkID8gMCA6ICQkLmhlaWdodDI7XG4gICAgICAgICQkLnN1YllNYXggPSBjb25maWcuYXhpc19yb3RhdGVkID8gJCQud2lkdGgyIDogMTtcbiAgICAgICAgLy8gdXBkYXRlIHNjYWxlc1xuICAgICAgICAkJC54ID0gJCQuZ2V0WCgkJC54TWluLCAkJC54TWF4LCBmb3JJbml0ID8gdW5kZWZpbmVkIDogJCQueC5vcmdEb21haW4oKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLnhBeGlzLnRpY2tPZmZzZXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQkLnkgPSAkJC5nZXRZKCQkLnlNaW4sICQkLnlNYXgsIGZvckluaXQgPyBjb25maWcuYXhpc195X2RlZmF1bHQgOiAkJC55LmRvbWFpbigpKTtcbiAgICAgICAgJCQueTIgPSAkJC5nZXRZKCQkLnlNaW4sICQkLnlNYXgsIGZvckluaXQgPyBjb25maWcuYXhpc195Ml9kZWZhdWx0IDogJCQueTIuZG9tYWluKCkpO1xuICAgICAgICAkJC5zdWJYID0gJCQuZ2V0WCgkJC54TWluLCAkJC54TWF4LCAkJC5vcmdYRG9tYWluLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGQgJSAxID8gMCA6ICQkLnN1YlhBeGlzLnRpY2tPZmZzZXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQkLnN1YlkgPSAkJC5nZXRZKCQkLnN1YllNaW4sICQkLnN1YllNYXgsIGZvckluaXQgPyBjb25maWcuYXhpc195X2RlZmF1bHQgOiAkJC5zdWJZLmRvbWFpbigpKTtcbiAgICAgICAgJCQuc3ViWTIgPSAkJC5nZXRZKCQkLnN1YllNaW4sICQkLnN1YllNYXgsIGZvckluaXQgPyBjb25maWcuYXhpc195Ml9kZWZhdWx0IDogJCQuc3ViWTIuZG9tYWluKCkpO1xuICAgICAgICAvLyB1cGRhdGUgYXhlc1xuICAgICAgICAkJC54QXhpc1RpY2tGb3JtYXQgPSAkJC5heGlzLmdldFhBeGlzVGlja0Zvcm1hdCgpO1xuICAgICAgICAkJC54QXhpc1RpY2tWYWx1ZXMgPSAkJC5heGlzLmdldFhBeGlzVGlja1ZhbHVlcygpO1xuICAgICAgICAkJC55QXhpc1RpY2tWYWx1ZXMgPSAkJC5heGlzLmdldFlBeGlzVGlja1ZhbHVlcygpO1xuICAgICAgICAkJC55MkF4aXNUaWNrVmFsdWVzID0gJCQuYXhpcy5nZXRZMkF4aXNUaWNrVmFsdWVzKCk7XG5cbiAgICAgICAgJCQueEF4aXMgPSAkJC5heGlzLmdldFhBeGlzKCQkLngsICQkLnhPcmllbnQsICQkLnhBeGlzVGlja0Zvcm1hdCwgJCQueEF4aXNUaWNrVmFsdWVzLCBjb25maWcuYXhpc194X3RpY2tfb3V0ZXIpO1xuICAgICAgICAkJC5zdWJYQXhpcyA9ICQkLmF4aXMuZ2V0WEF4aXMoJCQuc3ViWCwgJCQuc3ViWE9yaWVudCwgJCQueEF4aXNUaWNrRm9ybWF0LCAkJC54QXhpc1RpY2tWYWx1ZXMsIGNvbmZpZy5heGlzX3hfdGlja19vdXRlcik7XG4gICAgICAgICQkLnlBeGlzID0gJCQuYXhpcy5nZXRZQXhpcygkJC55LCAkJC55T3JpZW50LCBjb25maWcuYXhpc195X3RpY2tfZm9ybWF0LCAkJC55QXhpc1RpY2tWYWx1ZXMsIGNvbmZpZy5heGlzX3lfdGlja19vdXRlcik7XG4gICAgICAgICQkLnkyQXhpcyA9ICQkLmF4aXMuZ2V0WUF4aXMoJCQueTIsICQkLnkyT3JpZW50LCBjb25maWcuYXhpc195Ml90aWNrX2Zvcm1hdCwgJCQueTJBeGlzVGlja1ZhbHVlcywgY29uZmlnLmF4aXNfeTJfdGlja19vdXRlcik7XG5cbiAgICAgICAgLy8gU2V0IGluaXRpYWxpemVkIHNjYWxlcyB0byBicnVzaCBhbmQgem9vbVxuICAgICAgICBpZiAoIWZvckluaXQpIHtcbiAgICAgICAgICAgIGlmICgkJC5icnVzaCkge1xuICAgICAgICAgICAgICAgICQkLmJydXNoLnNjYWxlKCQkLnN1YlgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbmZpZy56b29tX2VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAkJC56b29tLnNjYWxlKCQkLngpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSBmb3IgYXJjXG4gICAgICAgIGlmICgkJC51cGRhdGVBcmMpIHtcbiAgICAgICAgICAgICQkLnVwZGF0ZUFyYygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFlEb21haW5NaW4gPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgaWRzID0gJCQubWFwVG9JZHModGFyZ2V0cyksXG4gICAgICAgICAgICB5cyA9ICQkLmdldFZhbHVlc0FzSWRLZXllZCh0YXJnZXRzKSxcbiAgICAgICAgICAgIGosXG4gICAgICAgICAgICBrLFxuICAgICAgICAgICAgYmFzZUlkLFxuICAgICAgICAgICAgaWRzSW5Hcm91cCxcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgaGFzTmVnYXRpdmVWYWx1ZTtcbiAgICAgICAgaWYgKGNvbmZpZy5kYXRhX2dyb3Vwcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBoYXNOZWdhdGl2ZVZhbHVlID0gJCQuaGFzTmVnYXRpdmVWYWx1ZUluVGFyZ2V0cyh0YXJnZXRzKTtcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBjb25maWcuZGF0YV9ncm91cHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAvLyBEZXRlcm1pbmUgYmFzZUlkXG4gICAgICAgICAgICAgICAgaWRzSW5Hcm91cCA9IGNvbmZpZy5kYXRhX2dyb3Vwc1tqXS5maWx0ZXIoZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpZHMuaW5kZXhPZihpZCkgPj0gMDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoaWRzSW5Hcm91cC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJhc2VJZCA9IGlkc0luR3JvdXBbMF07XG4gICAgICAgICAgICAgICAgLy8gQ29uc2lkZXIgbmVnYXRpdmUgdmFsdWVzXG4gICAgICAgICAgICAgICAgaWYgKGhhc05lZ2F0aXZlVmFsdWUgJiYgeXNbYmFzZUlkXSkge1xuICAgICAgICAgICAgICAgICAgICB5c1tiYXNlSWRdLmZvckVhY2goZnVuY3Rpb24gKHYsIGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHlzW2Jhc2VJZF1baV0gPSB2IDwgMCA/IHYgOiAwO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ29tcHV0ZSBtaW5cbiAgICAgICAgICAgICAgICBmb3IgKGsgPSAxOyBrIDwgaWRzSW5Hcm91cC5sZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgICAgICAgICBpZCA9IGlkc0luR3JvdXBba107XG4gICAgICAgICAgICAgICAgICAgIGlmICgheXNbaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB5c1tpZF0uZm9yRWFjaChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQkLmF4aXMuZ2V0SWQoaWQpID09PSAkJC5heGlzLmdldElkKGJhc2VJZCkgJiYgeXNbYmFzZUlkXSAmJiAhKGhhc05lZ2F0aXZlVmFsdWUgJiYgK3YgPiAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlzW2Jhc2VJZF1baV0gKz0gK3Y7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJCQuZDMubWluKE9iamVjdC5rZXlzKHlzKS5tYXAoZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgcmV0dXJuICQkLmQzLm1pbih5c1trZXldKTtcbiAgICAgICAgfSkpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WURvbWFpbk1heCA9IGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBpZHMgPSAkJC5tYXBUb0lkcyh0YXJnZXRzKSxcbiAgICAgICAgICAgIHlzID0gJCQuZ2V0VmFsdWVzQXNJZEtleWVkKHRhcmdldHMpLFxuICAgICAgICAgICAgaixcbiAgICAgICAgICAgIGssXG4gICAgICAgICAgICBiYXNlSWQsXG4gICAgICAgICAgICBpZHNJbkdyb3VwLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICBoYXNQb3NpdGl2ZVZhbHVlO1xuICAgICAgICBpZiAoY29uZmlnLmRhdGFfZ3JvdXBzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGhhc1Bvc2l0aXZlVmFsdWUgPSAkJC5oYXNQb3NpdGl2ZVZhbHVlSW5UYXJnZXRzKHRhcmdldHMpO1xuICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNvbmZpZy5kYXRhX2dyb3Vwcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIC8vIERldGVybWluZSBiYXNlSWRcbiAgICAgICAgICAgICAgICBpZHNJbkdyb3VwID0gY29uZmlnLmRhdGFfZ3JvdXBzW2pdLmZpbHRlcihmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkcy5pbmRleE9mKGlkKSA+PSAwO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChpZHNJbkdyb3VwLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYmFzZUlkID0gaWRzSW5Hcm91cFswXTtcbiAgICAgICAgICAgICAgICAvLyBDb25zaWRlciBwb3NpdGl2ZSB2YWx1ZXNcbiAgICAgICAgICAgICAgICBpZiAoaGFzUG9zaXRpdmVWYWx1ZSAmJiB5c1tiYXNlSWRdKSB7XG4gICAgICAgICAgICAgICAgICAgIHlzW2Jhc2VJZF0uZm9yRWFjaChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgeXNbYmFzZUlkXVtpXSA9IHYgPiAwID8gdiA6IDA7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBDb21wdXRlIG1heFxuICAgICAgICAgICAgICAgIGZvciAoayA9IDE7IGsgPCBpZHNJbkdyb3VwLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkID0gaWRzSW5Hcm91cFtrXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF5c1tpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHlzW2lkXS5mb3JFYWNoKGZ1bmN0aW9uICh2LCBpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCQuYXhpcy5nZXRJZChpZCkgPT09ICQkLmF4aXMuZ2V0SWQoYmFzZUlkKSAmJiB5c1tiYXNlSWRdICYmICEoaGFzUG9zaXRpdmVWYWx1ZSAmJiArdiA8IDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeXNbYmFzZUlkXVtpXSArPSArdjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkJC5kMy5tYXgoT2JqZWN0LmtleXMoeXMpLm1hcChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuZDMubWF4KHlzW2tleV0pO1xuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRZRG9tYWluID0gZnVuY3Rpb24gKHRhcmdldHMsIGF4aXNJZCwgeERvbWFpbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgdGFyZ2V0c0J5QXhpc0lkID0gdGFyZ2V0cy5maWx0ZXIoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5heGlzLmdldElkKHQuaWQpID09PSBheGlzSWQ7XG4gICAgICAgIH0pLFxuICAgICAgICAgICAgeVRhcmdldHMgPSB4RG9tYWluID8gJCQuZmlsdGVyQnlYRG9tYWluKHRhcmdldHNCeUF4aXNJZCwgeERvbWFpbikgOiB0YXJnZXRzQnlBeGlzSWQsXG4gICAgICAgICAgICB5TWluID0gYXhpc0lkID09PSAneTInID8gY29uZmlnLmF4aXNfeTJfbWluIDogY29uZmlnLmF4aXNfeV9taW4sXG4gICAgICAgICAgICB5TWF4ID0gYXhpc0lkID09PSAneTInID8gY29uZmlnLmF4aXNfeTJfbWF4IDogY29uZmlnLmF4aXNfeV9tYXgsXG4gICAgICAgICAgICB5RG9tYWluTWluID0gJCQuZ2V0WURvbWFpbk1pbih5VGFyZ2V0cyksXG4gICAgICAgICAgICB5RG9tYWluTWF4ID0gJCQuZ2V0WURvbWFpbk1heCh5VGFyZ2V0cyksXG4gICAgICAgICAgICBkb21haW4sXG4gICAgICAgICAgICBkb21haW5MZW5ndGgsXG4gICAgICAgICAgICBwYWRkaW5nLFxuICAgICAgICAgICAgcGFkZGluZ190b3AsXG4gICAgICAgICAgICBwYWRkaW5nX2JvdHRvbSxcbiAgICAgICAgICAgIGNlbnRlciA9IGF4aXNJZCA9PT0gJ3kyJyA/IGNvbmZpZy5heGlzX3kyX2NlbnRlciA6IGNvbmZpZy5heGlzX3lfY2VudGVyLFxuICAgICAgICAgICAgeURvbWFpbkFicyxcbiAgICAgICAgICAgIGxlbmd0aHMsXG4gICAgICAgICAgICBkaWZmLFxuICAgICAgICAgICAgcmF0aW8sXG4gICAgICAgICAgICBpc0FsbFBvc2l0aXZlLFxuICAgICAgICAgICAgaXNBbGxOZWdhdGl2ZSxcbiAgICAgICAgICAgIGlzWmVyb0Jhc2VkID0gJCQuaGFzVHlwZSgnYmFyJywgeVRhcmdldHMpICYmIGNvbmZpZy5iYXJfemVyb2Jhc2VkIHx8ICQkLmhhc1R5cGUoJ2FyZWEnLCB5VGFyZ2V0cykgJiYgY29uZmlnLmFyZWFfemVyb2Jhc2VkLFxuICAgICAgICAgICAgaXNJbnZlcnRlZCA9IGF4aXNJZCA9PT0gJ3kyJyA/IGNvbmZpZy5heGlzX3kyX2ludmVydGVkIDogY29uZmlnLmF4aXNfeV9pbnZlcnRlZCxcbiAgICAgICAgICAgIHNob3dIb3Jpem9udGFsRGF0YUxhYmVsID0gJCQuaGFzRGF0YUxhYmVsKCkgJiYgY29uZmlnLmF4aXNfcm90YXRlZCxcbiAgICAgICAgICAgIHNob3dWZXJ0aWNhbERhdGFMYWJlbCA9ICQkLmhhc0RhdGFMYWJlbCgpICYmICFjb25maWcuYXhpc19yb3RhdGVkO1xuXG4gICAgICAgIC8vIE1FTU86IGF2b2lkIGludmVydGluZyBkb21haW4gdW5leHBlY3RlZGx5XG4gICAgICAgIHlEb21haW5NaW4gPSBpc1ZhbHVlKHlNaW4pID8geU1pbiA6IGlzVmFsdWUoeU1heCkgPyB5RG9tYWluTWluIDwgeU1heCA/IHlEb21haW5NaW4gOiB5TWF4IC0gMTAgOiB5RG9tYWluTWluO1xuICAgICAgICB5RG9tYWluTWF4ID0gaXNWYWx1ZSh5TWF4KSA/IHlNYXggOiBpc1ZhbHVlKHlNaW4pID8geU1pbiA8IHlEb21haW5NYXggPyB5RG9tYWluTWF4IDogeU1pbiArIDEwIDogeURvbWFpbk1heDtcblxuICAgICAgICBpZiAoeVRhcmdldHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAvLyB1c2UgY3VycmVudCBkb21haW4gaWYgdGFyZ2V0IG9mIGF4aXNJZCBpcyBub25lXG4gICAgICAgICAgICByZXR1cm4gYXhpc0lkID09PSAneTInID8gJCQueTIuZG9tYWluKCkgOiAkJC55LmRvbWFpbigpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc05hTih5RG9tYWluTWluKSkge1xuICAgICAgICAgICAgLy8gc2V0IG1pbmltdW0gdG8gemVybyB3aGVuIG5vdCBudW1iZXJcbiAgICAgICAgICAgIHlEb21haW5NaW4gPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc05hTih5RG9tYWluTWF4KSkge1xuICAgICAgICAgICAgLy8gc2V0IG1heGltdW0gdG8gaGF2ZSBzYW1lIHZhbHVlIGFzIHlEb21haW5NaW5cbiAgICAgICAgICAgIHlEb21haW5NYXggPSB5RG9tYWluTWluO1xuICAgICAgICB9XG4gICAgICAgIGlmICh5RG9tYWluTWluID09PSB5RG9tYWluTWF4KSB7XG4gICAgICAgICAgICB5RG9tYWluTWluIDwgMCA/IHlEb21haW5NYXggPSAwIDogeURvbWFpbk1pbiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaXNBbGxQb3NpdGl2ZSA9IHlEb21haW5NaW4gPj0gMCAmJiB5RG9tYWluTWF4ID49IDA7XG4gICAgICAgIGlzQWxsTmVnYXRpdmUgPSB5RG9tYWluTWluIDw9IDAgJiYgeURvbWFpbk1heCA8PSAwO1xuXG4gICAgICAgIC8vIENhbmNlbCB6ZXJvYmFzZWQgaWYgYXhpc18qX21pbiAvIGF4aXNfKl9tYXggc3BlY2lmaWVkXG4gICAgICAgIGlmIChpc1ZhbHVlKHlNaW4pICYmIGlzQWxsUG9zaXRpdmUgfHwgaXNWYWx1ZSh5TWF4KSAmJiBpc0FsbE5lZ2F0aXZlKSB7XG4gICAgICAgICAgICBpc1plcm9CYXNlZCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQmFyL0FyZWEgY2hhcnQgc2hvdWxkIGJlIDAtYmFzZWQgaWYgYWxsIHBvc2l0aXZlfG5lZ2F0aXZlXG4gICAgICAgIGlmIChpc1plcm9CYXNlZCkge1xuICAgICAgICAgICAgaWYgKGlzQWxsUG9zaXRpdmUpIHtcbiAgICAgICAgICAgICAgICB5RG9tYWluTWluID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0FsbE5lZ2F0aXZlKSB7XG4gICAgICAgICAgICAgICAgeURvbWFpbk1heCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBkb21haW5MZW5ndGggPSBNYXRoLmFicyh5RG9tYWluTWF4IC0geURvbWFpbk1pbik7XG4gICAgICAgIHBhZGRpbmcgPSBwYWRkaW5nX3RvcCA9IHBhZGRpbmdfYm90dG9tID0gZG9tYWluTGVuZ3RoICogMC4xO1xuXG4gICAgICAgIGlmICh0eXBlb2YgY2VudGVyICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgeURvbWFpbkFicyA9IE1hdGgubWF4KE1hdGguYWJzKHlEb21haW5NaW4pLCBNYXRoLmFicyh5RG9tYWluTWF4KSk7XG4gICAgICAgICAgICB5RG9tYWluTWF4ID0gY2VudGVyICsgeURvbWFpbkFicztcbiAgICAgICAgICAgIHlEb21haW5NaW4gPSBjZW50ZXIgLSB5RG9tYWluQWJzO1xuICAgICAgICB9XG4gICAgICAgIC8vIGFkZCBwYWRkaW5nIGZvciBkYXRhIGxhYmVsXG4gICAgICAgIGlmIChzaG93SG9yaXpvbnRhbERhdGFMYWJlbCkge1xuICAgICAgICAgICAgbGVuZ3RocyA9ICQkLmdldERhdGFMYWJlbExlbmd0aCh5RG9tYWluTWluLCB5RG9tYWluTWF4LCAnd2lkdGgnKTtcbiAgICAgICAgICAgIGRpZmYgPSBkaWZmRG9tYWluKCQkLnkucmFuZ2UoKSk7XG4gICAgICAgICAgICByYXRpbyA9IFtsZW5ndGhzWzBdIC8gZGlmZiwgbGVuZ3Roc1sxXSAvIGRpZmZdO1xuICAgICAgICAgICAgcGFkZGluZ190b3AgKz0gZG9tYWluTGVuZ3RoICogKHJhdGlvWzFdIC8gKDEgLSByYXRpb1swXSAtIHJhdGlvWzFdKSk7XG4gICAgICAgICAgICBwYWRkaW5nX2JvdHRvbSArPSBkb21haW5MZW5ndGggKiAocmF0aW9bMF0gLyAoMSAtIHJhdGlvWzBdIC0gcmF0aW9bMV0pKTtcbiAgICAgICAgfSBlbHNlIGlmIChzaG93VmVydGljYWxEYXRhTGFiZWwpIHtcbiAgICAgICAgICAgIGxlbmd0aHMgPSAkJC5nZXREYXRhTGFiZWxMZW5ndGgoeURvbWFpbk1pbiwgeURvbWFpbk1heCwgJ2hlaWdodCcpO1xuICAgICAgICAgICAgcGFkZGluZ190b3AgKz0gJCQuYXhpcy5jb252ZXJ0UGl4ZWxzVG9BeGlzUGFkZGluZyhsZW5ndGhzWzFdLCBkb21haW5MZW5ndGgpO1xuICAgICAgICAgICAgcGFkZGluZ19ib3R0b20gKz0gJCQuYXhpcy5jb252ZXJ0UGl4ZWxzVG9BeGlzUGFkZGluZyhsZW5ndGhzWzBdLCBkb21haW5MZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChheGlzSWQgPT09ICd5JyAmJiBub3RFbXB0eShjb25maWcuYXhpc195X3BhZGRpbmcpKSB7XG4gICAgICAgICAgICBwYWRkaW5nX3RvcCA9ICQkLmF4aXMuZ2V0UGFkZGluZyhjb25maWcuYXhpc195X3BhZGRpbmcsICd0b3AnLCBwYWRkaW5nX3RvcCwgZG9tYWluTGVuZ3RoKTtcbiAgICAgICAgICAgIHBhZGRpbmdfYm90dG9tID0gJCQuYXhpcy5nZXRQYWRkaW5nKGNvbmZpZy5heGlzX3lfcGFkZGluZywgJ2JvdHRvbScsIHBhZGRpbmdfYm90dG9tLCBkb21haW5MZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChheGlzSWQgPT09ICd5MicgJiYgbm90RW1wdHkoY29uZmlnLmF4aXNfeTJfcGFkZGluZykpIHtcbiAgICAgICAgICAgIHBhZGRpbmdfdG9wID0gJCQuYXhpcy5nZXRQYWRkaW5nKGNvbmZpZy5heGlzX3kyX3BhZGRpbmcsICd0b3AnLCBwYWRkaW5nX3RvcCwgZG9tYWluTGVuZ3RoKTtcbiAgICAgICAgICAgIHBhZGRpbmdfYm90dG9tID0gJCQuYXhpcy5nZXRQYWRkaW5nKGNvbmZpZy5heGlzX3kyX3BhZGRpbmcsICdib3R0b20nLCBwYWRkaW5nX2JvdHRvbSwgZG9tYWluTGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBCYXIvQXJlYSBjaGFydCBzaG91bGQgYmUgMC1iYXNlZCBpZiBhbGwgcG9zaXRpdmV8bmVnYXRpdmVcbiAgICAgICAgaWYgKGlzWmVyb0Jhc2VkKSB7XG4gICAgICAgICAgICBpZiAoaXNBbGxQb3NpdGl2ZSkge1xuICAgICAgICAgICAgICAgIHBhZGRpbmdfYm90dG9tID0geURvbWFpbk1pbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0FsbE5lZ2F0aXZlKSB7XG4gICAgICAgICAgICAgICAgcGFkZGluZ190b3AgPSAteURvbWFpbk1heDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkb21haW4gPSBbeURvbWFpbk1pbiAtIHBhZGRpbmdfYm90dG9tLCB5RG9tYWluTWF4ICsgcGFkZGluZ190b3BdO1xuICAgICAgICByZXR1cm4gaXNJbnZlcnRlZCA/IGRvbWFpbi5yZXZlcnNlKCkgOiBkb21haW47XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRYRG9tYWluTWluID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgcmV0dXJuIGlzRGVmaW5lZChjb25maWcuYXhpc194X21pbikgPyAkJC5pc1RpbWVTZXJpZXMoKSA/IHRoaXMucGFyc2VEYXRlKGNvbmZpZy5heGlzX3hfbWluKSA6IGNvbmZpZy5heGlzX3hfbWluIDogJCQuZDMubWluKHRhcmdldHMsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuZDMubWluKHQudmFsdWVzLCBmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgIHJldHVybiB2Lng7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRYRG9tYWluTWF4ID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgcmV0dXJuIGlzRGVmaW5lZChjb25maWcuYXhpc194X21heCkgPyAkJC5pc1RpbWVTZXJpZXMoKSA/IHRoaXMucGFyc2VEYXRlKGNvbmZpZy5heGlzX3hfbWF4KSA6IGNvbmZpZy5heGlzX3hfbWF4IDogJCQuZDMubWF4KHRhcmdldHMsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuZDMubWF4KHQudmFsdWVzLCBmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgIHJldHVybiB2Lng7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRYRG9tYWluUGFkZGluZyA9IGZ1bmN0aW9uIChkb21haW4pIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGRpZmYgPSBkb21haW5bMV0gLSBkb21haW5bMF0sXG4gICAgICAgICAgICBtYXhEYXRhQ291bnQsXG4gICAgICAgICAgICBwYWRkaW5nLFxuICAgICAgICAgICAgcGFkZGluZ0xlZnQsXG4gICAgICAgICAgICBwYWRkaW5nUmlnaHQ7XG4gICAgICAgIGlmICgkJC5pc0NhdGVnb3JpemVkKCkpIHtcbiAgICAgICAgICAgIHBhZGRpbmcgPSAwO1xuICAgICAgICB9IGVsc2UgaWYgKCQkLmhhc1R5cGUoJ2JhcicpKSB7XG4gICAgICAgICAgICBtYXhEYXRhQ291bnQgPSAkJC5nZXRNYXhEYXRhQ291bnQoKTtcbiAgICAgICAgICAgIHBhZGRpbmcgPSBtYXhEYXRhQ291bnQgPiAxID8gZGlmZiAvIChtYXhEYXRhQ291bnQgLSAxKSAvIDIgOiAwLjU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwYWRkaW5nID0gZGlmZiAqIDAuMDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF90eXBlb2YoY29uZmlnLmF4aXNfeF9wYWRkaW5nKSA9PT0gJ29iamVjdCcgJiYgbm90RW1wdHkoY29uZmlnLmF4aXNfeF9wYWRkaW5nKSkge1xuICAgICAgICAgICAgcGFkZGluZ0xlZnQgPSBpc1ZhbHVlKGNvbmZpZy5heGlzX3hfcGFkZGluZy5sZWZ0KSA/IGNvbmZpZy5heGlzX3hfcGFkZGluZy5sZWZ0IDogcGFkZGluZztcbiAgICAgICAgICAgIHBhZGRpbmdSaWdodCA9IGlzVmFsdWUoY29uZmlnLmF4aXNfeF9wYWRkaW5nLnJpZ2h0KSA/IGNvbmZpZy5heGlzX3hfcGFkZGluZy5yaWdodCA6IHBhZGRpbmc7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZy5heGlzX3hfcGFkZGluZyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHBhZGRpbmdMZWZ0ID0gcGFkZGluZ1JpZ2h0ID0gY29uZmlnLmF4aXNfeF9wYWRkaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFkZGluZ0xlZnQgPSBwYWRkaW5nUmlnaHQgPSBwYWRkaW5nO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGxlZnQ6IHBhZGRpbmdMZWZ0LCByaWdodDogcGFkZGluZ1JpZ2h0IH07XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRYRG9tYWluID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHhEb21haW4gPSBbJCQuZ2V0WERvbWFpbk1pbih0YXJnZXRzKSwgJCQuZ2V0WERvbWFpbk1heCh0YXJnZXRzKV0sXG4gICAgICAgICAgICBmaXJzdFggPSB4RG9tYWluWzBdLFxuICAgICAgICAgICAgbGFzdFggPSB4RG9tYWluWzFdLFxuICAgICAgICAgICAgcGFkZGluZyA9ICQkLmdldFhEb21haW5QYWRkaW5nKHhEb21haW4pLFxuICAgICAgICAgICAgbWluID0gMCxcbiAgICAgICAgICAgIG1heCA9IDA7XG4gICAgICAgIC8vIHNob3cgY2VudGVyIG9mIHggZG9tYWluIGlmIG1pbiBhbmQgbWF4IGFyZSB0aGUgc2FtZVxuICAgICAgICBpZiAoZmlyc3RYIC0gbGFzdFggPT09IDAgJiYgISQkLmlzQ2F0ZWdvcml6ZWQoKSkge1xuICAgICAgICAgICAgaWYgKCQkLmlzVGltZVNlcmllcygpKSB7XG4gICAgICAgICAgICAgICAgZmlyc3RYID0gbmV3IERhdGUoZmlyc3RYLmdldFRpbWUoKSAqIDAuNSk7XG4gICAgICAgICAgICAgICAgbGFzdFggPSBuZXcgRGF0ZShsYXN0WC5nZXRUaW1lKCkgKiAxLjUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaXJzdFggPSBmaXJzdFggPT09IDAgPyAxIDogZmlyc3RYICogMC41O1xuICAgICAgICAgICAgICAgIGxhc3RYID0gbGFzdFggPT09IDAgPyAtMSA6IGxhc3RYICogMS41O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChmaXJzdFggfHwgZmlyc3RYID09PSAwKSB7XG4gICAgICAgICAgICBtaW4gPSAkJC5pc1RpbWVTZXJpZXMoKSA/IG5ldyBEYXRlKGZpcnN0WC5nZXRUaW1lKCkgLSBwYWRkaW5nLmxlZnQpIDogZmlyc3RYIC0gcGFkZGluZy5sZWZ0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYXN0WCB8fCBsYXN0WCA9PT0gMCkge1xuICAgICAgICAgICAgbWF4ID0gJCQuaXNUaW1lU2VyaWVzKCkgPyBuZXcgRGF0ZShsYXN0WC5nZXRUaW1lKCkgKyBwYWRkaW5nLnJpZ2h0KSA6IGxhc3RYICsgcGFkZGluZy5yaWdodDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW21pbiwgbWF4XTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVhEb21haW4gPSBmdW5jdGlvbiAodGFyZ2V0cywgd2l0aFVwZGF0ZVhEb21haW4sIHdpdGhVcGRhdGVPcmdYRG9tYWluLCB3aXRoVHJpbSwgZG9tYWluKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG5cbiAgICAgICAgaWYgKHdpdGhVcGRhdGVPcmdYRG9tYWluKSB7XG4gICAgICAgICAgICAkJC54LmRvbWFpbihkb21haW4gPyBkb21haW4gOiAkJC5kMy5leHRlbnQoJCQuZ2V0WERvbWFpbih0YXJnZXRzKSkpO1xuICAgICAgICAgICAgJCQub3JnWERvbWFpbiA9ICQkLnguZG9tYWluKCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnLnpvb21fZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICQkLnpvb20uc2NhbGUoJCQueCkudXBkYXRlU2NhbGVFeHRlbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQkLnN1YlguZG9tYWluKCQkLnguZG9tYWluKCkpO1xuICAgICAgICAgICAgaWYgKCQkLmJydXNoKSB7XG4gICAgICAgICAgICAgICAgJCQuYnJ1c2guc2NhbGUoJCQuc3ViWCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdpdGhVcGRhdGVYRG9tYWluKSB7XG4gICAgICAgICAgICAkJC54LmRvbWFpbihkb21haW4gPyBkb21haW4gOiAhJCQuYnJ1c2ggfHwgJCQuYnJ1c2guZW1wdHkoKSA/ICQkLm9yZ1hEb21haW4gOiAkJC5icnVzaC5leHRlbnQoKSk7XG4gICAgICAgICAgICBpZiAoY29uZmlnLnpvb21fZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICQkLnpvb20uc2NhbGUoJCQueCkudXBkYXRlU2NhbGVFeHRlbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRyaW0gZG9tYWluIHdoZW4gdG9vIGJpZyBieSB6b29tIG1vdXNlbW92ZSBldmVudFxuICAgICAgICBpZiAod2l0aFRyaW0pIHtcbiAgICAgICAgICAgICQkLnguZG9tYWluKCQkLnRyaW1YRG9tYWluKCQkLngub3JnRG9tYWluKCkpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAkJC54LmRvbWFpbigpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udHJpbVhEb21haW4gPSBmdW5jdGlvbiAoZG9tYWluKSB7XG4gICAgICAgIHZhciB6b29tRG9tYWluID0gdGhpcy5nZXRab29tRG9tYWluKCksXG4gICAgICAgICAgICBtaW4gPSB6b29tRG9tYWluWzBdLFxuICAgICAgICAgICAgbWF4ID0gem9vbURvbWFpblsxXTtcbiAgICAgICAgaWYgKGRvbWFpblswXSA8PSBtaW4pIHtcbiAgICAgICAgICAgIGRvbWFpblsxXSA9ICtkb21haW5bMV0gKyAobWluIC0gZG9tYWluWzBdKTtcbiAgICAgICAgICAgIGRvbWFpblswXSA9IG1pbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWF4IDw9IGRvbWFpblsxXSkge1xuICAgICAgICAgICAgZG9tYWluWzBdID0gK2RvbWFpblswXSAtIChkb21haW5bMV0gLSBtYXgpO1xuICAgICAgICAgICAgZG9tYWluWzFdID0gbWF4O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkb21haW47XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzWCA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5kYXRhX3ggJiYga2V5ID09PSBjb25maWcuZGF0YV94IHx8IG5vdEVtcHR5KGNvbmZpZy5kYXRhX3hzKSAmJiBoYXNWYWx1ZShjb25maWcuZGF0YV94cywga2V5KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzTm90WCA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLmlzWChrZXkpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WEtleSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICByZXR1cm4gY29uZmlnLmRhdGFfeCA/IGNvbmZpZy5kYXRhX3ggOiBub3RFbXB0eShjb25maWcuZGF0YV94cykgPyBjb25maWcuZGF0YV94c1tpZF0gOiBudWxsO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WFZhbHVlc09mWEtleSA9IGZ1bmN0aW9uIChrZXksIHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHhWYWx1ZXMsXG4gICAgICAgICAgICBpZHMgPSB0YXJnZXRzICYmIG5vdEVtcHR5KHRhcmdldHMpID8gJCQubWFwVG9JZHModGFyZ2V0cykgOiBbXTtcbiAgICAgICAgaWRzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICBpZiAoJCQuZ2V0WEtleShpZCkgPT09IGtleSkge1xuICAgICAgICAgICAgICAgIHhWYWx1ZXMgPSAkJC5kYXRhLnhzW2lkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB4VmFsdWVzO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0SW5kZXhCeVggPSBmdW5jdGlvbiAoeCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZGF0YSA9ICQkLmZpbHRlckJ5WCgkJC5kYXRhLnRhcmdldHMsIHgpO1xuICAgICAgICByZXR1cm4gZGF0YS5sZW5ndGggPyBkYXRhWzBdLmluZGV4IDogbnVsbDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFhWYWx1ZSA9IGZ1bmN0aW9uIChpZCwgaSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gaWQgaW4gJCQuZGF0YS54cyAmJiAkJC5kYXRhLnhzW2lkXSAmJiBpc1ZhbHVlKCQkLmRhdGEueHNbaWRdW2ldKSA/ICQkLmRhdGEueHNbaWRdW2ldIDogaTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldE90aGVyVGFyZ2V0WHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBpZHNGb3JYID0gT2JqZWN0LmtleXMoJCQuZGF0YS54cyk7XG4gICAgICAgIHJldHVybiBpZHNGb3JYLmxlbmd0aCA/ICQkLmRhdGEueHNbaWRzRm9yWFswXV0gOiBudWxsO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0T3RoZXJUYXJnZXRYID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHZhciB4cyA9IHRoaXMuZ2V0T3RoZXJUYXJnZXRYcygpO1xuICAgICAgICByZXR1cm4geHMgJiYgaW5kZXggPCB4cy5sZW5ndGggPyB4c1tpbmRleF0gOiBudWxsO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uYWRkWHMgPSBmdW5jdGlvbiAoeHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgT2JqZWN0LmtleXMoeHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAkJC5jb25maWcuZGF0YV94c1tpZF0gPSB4c1tpZF07XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaGFzTXVsdGlwbGVYID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmQzLnNldChPYmplY3Qua2V5cyh4cykubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmV0dXJuIHhzW2lkXTtcbiAgICAgICAgfSkpLnNpemUoKSA+IDE7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc011bHRpcGxlWCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5vdEVtcHR5KHRoaXMuY29uZmlnLmRhdGFfeHMpIHx8ICF0aGlzLmNvbmZpZy5kYXRhX3hTb3J0IHx8IHRoaXMuaGFzVHlwZSgnc2NhdHRlcicpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uYWRkTmFtZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBuYW1lO1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgbmFtZSA9ICQkLmNvbmZpZy5kYXRhX25hbWVzW2RhdGEuaWRdO1xuICAgICAgICAgICAgZGF0YS5uYW1lID0gbmFtZSAhPT0gdW5kZWZpbmVkID8gbmFtZSA6IGRhdGEuaWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRWYWx1ZU9uSW5kZXggPSBmdW5jdGlvbiAodmFsdWVzLCBpbmRleCkge1xuICAgICAgICB2YXIgdmFsdWVPbkluZGV4ID0gdmFsdWVzLmZpbHRlcihmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgcmV0dXJuIHYuaW5kZXggPT09IGluZGV4O1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHZhbHVlT25JbmRleC5sZW5ndGggPyB2YWx1ZU9uSW5kZXhbMF0gOiBudWxsO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlVGFyZ2V0WCA9IGZ1bmN0aW9uICh0YXJnZXRzLCB4KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIHRhcmdldHMuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgdC52YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgICAgIHYueCA9ICQkLmdlbmVyYXRlVGFyZ2V0WCh4W2ldLCB0LmlkLCBpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJCQuZGF0YS54c1t0LmlkXSA9IHg7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlVGFyZ2V0WHMgPSBmdW5jdGlvbiAodGFyZ2V0cywgeHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICBpZiAoeHNbdC5pZF0pIHtcbiAgICAgICAgICAgICAgICAkJC51cGRhdGVUYXJnZXRYKFt0XSwgeHNbdC5pZF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlVGFyZ2V0WCA9IGZ1bmN0aW9uIChyYXdYLCBpZCwgaW5kZXgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHg7XG4gICAgICAgIGlmICgkJC5pc1RpbWVTZXJpZXMoKSkge1xuICAgICAgICAgICAgeCA9IHJhd1ggPyAkJC5wYXJzZURhdGUocmF3WCkgOiAkJC5wYXJzZURhdGUoJCQuZ2V0WFZhbHVlKGlkLCBpbmRleCkpO1xuICAgICAgICB9IGVsc2UgaWYgKCQkLmlzQ3VzdG9tWCgpICYmICEkJC5pc0NhdGVnb3JpemVkKCkpIHtcbiAgICAgICAgICAgIHggPSBpc1ZhbHVlKHJhd1gpID8gK3Jhd1ggOiAkJC5nZXRYVmFsdWUoaWQsIGluZGV4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHggPSBpbmRleDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNsb25lVGFyZ2V0ID0gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IHRhcmdldC5pZCxcbiAgICAgICAgICAgIGlkX29yZzogdGFyZ2V0LmlkX29yZyxcbiAgICAgICAgICAgIHZhbHVlczogdGFyZ2V0LnZhbHVlcy5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyB4OiBkLngsIHZhbHVlOiBkLnZhbHVlLCBpZDogZC5pZCB9O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVhzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICBpZiAoJCQuZGF0YS50YXJnZXRzLmxlbmd0aCkge1xuICAgICAgICAgICAgJCQueHMgPSBbXTtcbiAgICAgICAgICAgICQkLmRhdGEudGFyZ2V0c1swXS52YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgICQkLnhzW3YuaW5kZXhdID0gdi54O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFByZXZYID0gZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgdmFyIHggPSB0aGlzLnhzW2kgLSAxXTtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiB4ICE9PSAndW5kZWZpbmVkJyA/IHggOiBudWxsO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0TmV4dFggPSBmdW5jdGlvbiAoaSkge1xuICAgICAgICB2YXIgeCA9IHRoaXMueHNbaSArIDFdO1xuICAgICAgICByZXR1cm4gdHlwZW9mIHggIT09ICd1bmRlZmluZWQnID8geCA6IG51bGw7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRNYXhEYXRhQ291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIHJldHVybiAkJC5kMy5tYXgoJCQuZGF0YS50YXJnZXRzLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIHQudmFsdWVzLmxlbmd0aDtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRNYXhEYXRhQ291bnRUYXJnZXQgPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICB2YXIgbGVuZ3RoID0gdGFyZ2V0cy5sZW5ndGgsXG4gICAgICAgICAgICBtYXggPSAwLFxuICAgICAgICAgICAgbWF4VGFyZ2V0O1xuICAgICAgICBpZiAobGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHQudmFsdWVzLmxlbmd0aCA+IG1heCkge1xuICAgICAgICAgICAgICAgICAgICBtYXhUYXJnZXQgPSB0O1xuICAgICAgICAgICAgICAgICAgICBtYXggPSB0LnZhbHVlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtYXhUYXJnZXQgPSBsZW5ndGggPyB0YXJnZXRzWzBdIDogbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWF4VGFyZ2V0O1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0RWRnZVggPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gIXRhcmdldHMubGVuZ3RoID8gWzAsIDBdIDogWyQkLmQzLm1pbih0YXJnZXRzLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIHQudmFsdWVzWzBdLng7XG4gICAgICAgIH0pLCAkJC5kMy5tYXgodGFyZ2V0cywgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0LnZhbHVlc1t0LnZhbHVlcy5sZW5ndGggLSAxXS54O1xuICAgICAgICB9KV07XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5tYXBUb0lkcyA9IGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXRzLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGQuaWQ7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ubWFwVG9UYXJnZXRJZHMgPSBmdW5jdGlvbiAoaWRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBpZHMgPyBbXS5jb25jYXQoaWRzKSA6ICQkLm1hcFRvSWRzKCQkLmRhdGEudGFyZ2V0cyk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5oYXNUYXJnZXQgPSBmdW5jdGlvbiAodGFyZ2V0cywgaWQpIHtcbiAgICAgICAgdmFyIGlkcyA9IHRoaXMubWFwVG9JZHModGFyZ2V0cyksXG4gICAgICAgICAgICBpO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoaWRzW2ldID09PSBpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzVGFyZ2V0VG9TaG93ID0gZnVuY3Rpb24gKHRhcmdldElkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpZGRlblRhcmdldElkcy5pbmRleE9mKHRhcmdldElkKSA8IDA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc0xlZ2VuZFRvU2hvdyA9IGZ1bmN0aW9uICh0YXJnZXRJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oaWRkZW5MZWdlbmRJZHMuaW5kZXhPZih0YXJnZXRJZCkgPCAwO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZmlsdGVyVGFyZ2V0c1RvU2hvdyA9IGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIHJldHVybiB0YXJnZXRzLmZpbHRlcihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLmlzVGFyZ2V0VG9TaG93KHQuaWQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLm1hcFRhcmdldHNUb1VuaXF1ZVhzID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgdmFyIHhzID0gJCQuZDMuc2V0KCQkLmQzLm1lcmdlKHRhcmdldHMubWFwKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gdC52YWx1ZXMubWFwKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICt2Lng7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpKS52YWx1ZXMoKTtcbiAgICAgICAgeHMgPSAkJC5pc1RpbWVTZXJpZXMoKSA/IHhzLm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCt4KTtcbiAgICAgICAgfSkgOiB4cy5tYXAoZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgIHJldHVybiAreDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB4cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IGEgPj0gYiA/IDAgOiBOYU47XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uYWRkSGlkZGVuVGFyZ2V0SWRzID0gZnVuY3Rpb24gKHRhcmdldElkcykge1xuICAgICAgICB0aGlzLmhpZGRlblRhcmdldElkcyA9IHRoaXMuaGlkZGVuVGFyZ2V0SWRzLmNvbmNhdCh0YXJnZXRJZHMpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVtb3ZlSGlkZGVuVGFyZ2V0SWRzID0gZnVuY3Rpb24gKHRhcmdldElkcykge1xuICAgICAgICB0aGlzLmhpZGRlblRhcmdldElkcyA9IHRoaXMuaGlkZGVuVGFyZ2V0SWRzLmZpbHRlcihmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRJZHMuaW5kZXhPZihpZCkgPCAwO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmFkZEhpZGRlbkxlZ2VuZElkcyA9IGZ1bmN0aW9uICh0YXJnZXRJZHMpIHtcbiAgICAgICAgdGhpcy5oaWRkZW5MZWdlbmRJZHMgPSB0aGlzLmhpZGRlbkxlZ2VuZElkcy5jb25jYXQodGFyZ2V0SWRzKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlbW92ZUhpZGRlbkxlZ2VuZElkcyA9IGZ1bmN0aW9uICh0YXJnZXRJZHMpIHtcbiAgICAgICAgdGhpcy5oaWRkZW5MZWdlbmRJZHMgPSB0aGlzLmhpZGRlbkxlZ2VuZElkcy5maWx0ZXIoZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0SWRzLmluZGV4T2YoaWQpIDwgMDtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRWYWx1ZXNBc0lkS2V5ZWQgPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICB2YXIgeXMgPSB7fTtcbiAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICB5c1t0LmlkXSA9IFtdO1xuICAgICAgICAgICAgdC52YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgIHlzW3QuaWRdLnB1c2godi52YWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB5cztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNoZWNrVmFsdWVJblRhcmdldHMgPSBmdW5jdGlvbiAodGFyZ2V0cywgY2hlY2tlcikge1xuICAgICAgICB2YXIgaWRzID0gT2JqZWN0LmtleXModGFyZ2V0cyksXG4gICAgICAgICAgICBpLFxuICAgICAgICAgICAgaixcbiAgICAgICAgICAgIHZhbHVlcztcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFsdWVzID0gdGFyZ2V0c1tpZHNbaV1dLnZhbHVlcztcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB2YWx1ZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoY2hlY2tlcih2YWx1ZXNbal0udmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5oYXNOZWdhdGl2ZVZhbHVlSW5UYXJnZXRzID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tWYWx1ZUluVGFyZ2V0cyh0YXJnZXRzLCBmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgcmV0dXJuIHYgPCAwO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmhhc1Bvc2l0aXZlVmFsdWVJblRhcmdldHMgPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGVja1ZhbHVlSW5UYXJnZXRzKHRhcmdldHMsIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICByZXR1cm4gdiA+IDA7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNPcmRlckRlc2MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZztcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBjb25maWcuZGF0YV9vcmRlciA9PT0gJ3N0cmluZycgJiYgY29uZmlnLmRhdGFfb3JkZXIudG9Mb3dlckNhc2UoKSA9PT0gJ2Rlc2MnO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNPcmRlckFzYyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuICAgICAgICByZXR1cm4gdHlwZW9mIGNvbmZpZy5kYXRhX29yZGVyID09PSAnc3RyaW5nJyAmJiBjb25maWcuZGF0YV9vcmRlci50b0xvd2VyQ2FzZSgpID09PSAnYXNjJztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLm9yZGVyVGFyZ2V0cyA9IGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBvcmRlckFzYyA9ICQkLmlzT3JkZXJBc2MoKSxcbiAgICAgICAgICAgIG9yZGVyRGVzYyA9ICQkLmlzT3JkZXJEZXNjKCk7XG4gICAgICAgIGlmIChvcmRlckFzYyB8fCBvcmRlckRlc2MpIHtcbiAgICAgICAgICAgIHRhcmdldHMuc29ydChmdW5jdGlvbiAodDEsIHQyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlZHVjZXIgPSBmdW5jdGlvbiByZWR1Y2VyKHAsIGMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHAgKyBNYXRoLmFicyhjLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciB0MVN1bSA9IHQxLnZhbHVlcy5yZWR1Y2UocmVkdWNlciwgMCksXG4gICAgICAgICAgICAgICAgICAgIHQyU3VtID0gdDIudmFsdWVzLnJlZHVjZShyZWR1Y2VyLCAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXJBc2MgPyB0MlN1bSAtIHQxU3VtIDogdDFTdW0gLSB0MlN1bTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGlzRnVuY3Rpb24oY29uZmlnLmRhdGFfb3JkZXIpKSB7XG4gICAgICAgICAgICB0YXJnZXRzLnNvcnQoY29uZmlnLmRhdGFfb3JkZXIpO1xuICAgICAgICB9IC8vIFRPRE86IGFjY2VwdCBuYW1lIGFycmF5IGZvciBvcmRlclxuICAgICAgICByZXR1cm4gdGFyZ2V0cztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmZpbHRlckJ5WCA9IGZ1bmN0aW9uICh0YXJnZXRzLCB4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmQzLm1lcmdlKHRhcmdldHMubWFwKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gdC52YWx1ZXM7XG4gICAgICAgIH0pKS5maWx0ZXIoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgIHJldHVybiB2LnggLSB4ID09PSAwO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmZpbHRlclJlbW92ZU51bGwgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gZGF0YS5maWx0ZXIoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBpc1ZhbHVlKGQudmFsdWUpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmZpbHRlckJ5WERvbWFpbiA9IGZ1bmN0aW9uICh0YXJnZXRzLCB4RG9tYWluKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXRzLm1hcChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpZDogdC5pZCxcbiAgICAgICAgICAgICAgICBpZF9vcmc6IHQuaWRfb3JnLFxuICAgICAgICAgICAgICAgIHZhbHVlczogdC52YWx1ZXMuZmlsdGVyKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB4RG9tYWluWzBdIDw9IHYueCAmJiB2LnggPD0geERvbWFpblsxXTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5oYXNEYXRhTGFiZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZztcbiAgICAgICAgaWYgKHR5cGVvZiBjb25maWcuZGF0YV9sYWJlbHMgPT09ICdib29sZWFuJyAmJiBjb25maWcuZGF0YV9sYWJlbHMpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKF90eXBlb2YoY29uZmlnLmRhdGFfbGFiZWxzKSA9PT0gJ29iamVjdCcgJiYgbm90RW1wdHkoY29uZmlnLmRhdGFfbGFiZWxzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0RGF0YUxhYmVsTGVuZ3RoID0gZnVuY3Rpb24gKG1pbiwgbWF4LCBrZXkpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGxlbmd0aHMgPSBbMCwgMF0sXG4gICAgICAgICAgICBwYWRkaW5nQ29lZiA9IDEuMztcbiAgICAgICAgJCQuc2VsZWN0Q2hhcnQuc2VsZWN0KCdzdmcnKS5zZWxlY3RBbGwoJy5kdW1teScpLmRhdGEoW21pbiwgbWF4XSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuZGF0YUxhYmVsRm9ybWF0KGQuaWQpKGQpO1xuICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICBsZW5ndGhzW2ldID0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVtrZXldICogcGFkZGluZ0NvZWY7XG4gICAgICAgIH0pLnJlbW92ZSgpO1xuICAgICAgICByZXR1cm4gbGVuZ3RocztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzTm9uZUFyYyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc1RhcmdldCh0aGlzLmRhdGEudGFyZ2V0cywgZC5pZCk7XG4gICAgfSwgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNBcmMgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gJ2RhdGEnIGluIGQgJiYgdGhpcy5oYXNUYXJnZXQodGhpcy5kYXRhLnRhcmdldHMsIGQuZGF0YS5pZCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5maW5kU2FtZVhPZlZhbHVlcyA9IGZ1bmN0aW9uICh2YWx1ZXMsIGluZGV4KSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgdGFyZ2V0WCA9IHZhbHVlc1tpbmRleF0ueCxcbiAgICAgICAgICAgIHNhbWVzID0gW107XG4gICAgICAgIGZvciAoaSA9IGluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGlmICh0YXJnZXRYICE9PSB2YWx1ZXNbaV0ueCkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2FtZXMucHVzaCh2YWx1ZXNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoaSA9IGluZGV4OyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGFyZ2V0WCAhPT0gdmFsdWVzW2ldLngpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNhbWVzLnB1c2godmFsdWVzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2FtZXM7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmZpbmRDbG9zZXN0RnJvbVRhcmdldHMgPSBmdW5jdGlvbiAodGFyZ2V0cywgcG9zKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjYW5kaWRhdGVzO1xuXG4gICAgICAgIC8vIG1hcCB0byBhcnJheSBvZiBjbG9zZXN0IHBvaW50cyBvZiBlYWNoIHRhcmdldFxuICAgICAgICBjYW5kaWRhdGVzID0gdGFyZ2V0cy5tYXAoZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLmZpbmRDbG9zZXN0KHRhcmdldC52YWx1ZXMsIHBvcyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGRlY2lkZSBjbG9zZXN0IHBvaW50IGFuZCByZXR1cm5cbiAgICAgICAgcmV0dXJuICQkLmZpbmRDbG9zZXN0KGNhbmRpZGF0ZXMsIHBvcyk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5maW5kQ2xvc2VzdCA9IGZ1bmN0aW9uICh2YWx1ZXMsIHBvcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgbWluRGlzdCA9ICQkLmNvbmZpZy5wb2ludF9zZW5zaXRpdml0eSxcbiAgICAgICAgICAgIGNsb3Nlc3Q7XG5cbiAgICAgICAgLy8gZmluZCBtb3VzZW92ZXJpbmcgYmFyXG4gICAgICAgIHZhbHVlcy5maWx0ZXIoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgIHJldHVybiB2ICYmICQkLmlzQmFyVHlwZSh2LmlkKTtcbiAgICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgdmFyIHNoYXBlID0gJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MuYmFycyArICQkLmdldFRhcmdldFNlbGVjdG9yU3VmZml4KHYuaWQpICsgJyAuJyArIENMQVNTLmJhciArICctJyArIHYuaW5kZXgpLm5vZGUoKTtcbiAgICAgICAgICAgIGlmICghY2xvc2VzdCAmJiAkJC5pc1dpdGhpbkJhcihzaGFwZSkpIHtcbiAgICAgICAgICAgICAgICBjbG9zZXN0ID0gdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZmluZCBjbG9zZXN0IHBvaW50IGZyb20gbm9uLWJhclxuICAgICAgICB2YWx1ZXMuZmlsdGVyKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICByZXR1cm4gdiAmJiAhJCQuaXNCYXJUeXBlKHYuaWQpO1xuICAgICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICB2YXIgZCA9ICQkLmRpc3QodiwgcG9zKTtcbiAgICAgICAgICAgIGlmIChkIDwgbWluRGlzdCkge1xuICAgICAgICAgICAgICAgIG1pbkRpc3QgPSBkO1xuICAgICAgICAgICAgICAgIGNsb3Nlc3QgPSB2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gY2xvc2VzdDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmRpc3QgPSBmdW5jdGlvbiAoZGF0YSwgcG9zKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB4SW5kZXggPSBjb25maWcuYXhpc19yb3RhdGVkID8gMSA6IDAsXG4gICAgICAgICAgICB5SW5kZXggPSBjb25maWcuYXhpc19yb3RhdGVkID8gMCA6IDEsXG4gICAgICAgICAgICB5ID0gJCQuY2lyY2xlWShkYXRhLCBkYXRhLmluZGV4KSxcbiAgICAgICAgICAgIHggPSAkJC54KGRhdGEueCk7XG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coeCAtIHBvc1t4SW5kZXhdLCAyKSArIE1hdGgucG93KHkgLSBwb3NbeUluZGV4XSwgMikpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY29udmVydFZhbHVlc1RvU3RlcCA9IGZ1bmN0aW9uICh2YWx1ZXMpIHtcbiAgICAgICAgdmFyIGNvbnZlcnRlZCA9IFtdLmNvbmNhdCh2YWx1ZXMpLFxuICAgICAgICAgICAgaTtcblxuICAgICAgICBpZiAoIXRoaXMuaXNDYXRlZ29yaXplZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChpID0gdmFsdWVzLmxlbmd0aCArIDE7IDAgPCBpOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnZlcnRlZFtpXSA9IGNvbnZlcnRlZFtpIC0gMV07XG4gICAgICAgIH1cblxuICAgICAgICBjb252ZXJ0ZWRbMF0gPSB7XG4gICAgICAgICAgICB4OiBjb252ZXJ0ZWRbMF0ueCAtIDEsXG4gICAgICAgICAgICB2YWx1ZTogY29udmVydGVkWzBdLnZhbHVlLFxuICAgICAgICAgICAgaWQ6IGNvbnZlcnRlZFswXS5pZFxuICAgICAgICB9O1xuICAgICAgICBjb252ZXJ0ZWRbdmFsdWVzLmxlbmd0aCArIDFdID0ge1xuICAgICAgICAgICAgeDogY29udmVydGVkW3ZhbHVlcy5sZW5ndGhdLnggKyAxLFxuICAgICAgICAgICAgdmFsdWU6IGNvbnZlcnRlZFt2YWx1ZXMubGVuZ3RoXS52YWx1ZSxcbiAgICAgICAgICAgIGlkOiBjb252ZXJ0ZWRbdmFsdWVzLmxlbmd0aF0uaWRcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gY29udmVydGVkO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlRGF0YUF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAobmFtZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGN1cnJlbnQgPSBjb25maWdbJ2RhdGFfJyArIG5hbWVdO1xuICAgICAgICBpZiAodHlwZW9mIGF0dHJzID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICBjdXJyZW50W2lkXSA9IGF0dHJzW2lkXTtcbiAgICAgICAgfSk7XG4gICAgICAgICQkLnJlZHJhdyh7IHdpdGhMZWdlbmQ6IHRydWUgfSk7XG4gICAgICAgIHJldHVybiBjdXJyZW50O1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jb252ZXJ0VXJsVG9EYXRhID0gZnVuY3Rpb24gKHVybCwgbWltZVR5cGUsIGhlYWRlcnMsIGtleXMsIGRvbmUpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHR5cGUgPSBtaW1lVHlwZSA/IG1pbWVUeXBlIDogJ2Nzdic7XG4gICAgICAgIHZhciByZXEgPSAkJC5kMy54aHIodXJsKTtcbiAgICAgICAgaWYgKGhlYWRlcnMpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGhlYWRlcnMpLmZvckVhY2goZnVuY3Rpb24gKGhlYWRlcikge1xuICAgICAgICAgICAgICAgIHJlcS5oZWFkZXIoaGVhZGVyLCBoZWFkZXJzW2hlYWRlcl0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVxLmdldChmdW5jdGlvbiAoZXJyb3IsIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBkO1xuICAgICAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLnJlc3BvbnNlVVJMICsgJyAnICsgZXJyb3Iuc3RhdHVzICsgJyAoJyArIGVycm9yLnN0YXR1c1RleHQgKyAnKScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdqc29uJykge1xuICAgICAgICAgICAgICAgIGQgPSAkJC5jb252ZXJ0SnNvblRvRGF0YShKU09OLnBhcnNlKGRhdGEucmVzcG9uc2UpLCBrZXlzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3RzdicpIHtcbiAgICAgICAgICAgICAgICBkID0gJCQuY29udmVydFRzdlRvRGF0YShkYXRhLnJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZCA9ICQkLmNvbnZlcnRDc3ZUb0RhdGEoZGF0YS5yZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb25lLmNhbGwoJCQsIGQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNvbnZlcnRYc3ZUb0RhdGEgPSBmdW5jdGlvbiAoeHN2LCBwYXJzZXIpIHtcbiAgICAgICAgdmFyIHJvd3MgPSBwYXJzZXIucGFyc2VSb3dzKHhzdiksXG4gICAgICAgICAgICBkO1xuICAgICAgICBpZiAocm93cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIGQgPSBbe31dO1xuICAgICAgICAgICAgcm93c1swXS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIGRbMF1baWRdID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZCA9IHBhcnNlci5wYXJzZSh4c3YpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY29udmVydENzdlRvRGF0YSA9IGZ1bmN0aW9uIChjc3YpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydFhzdlRvRGF0YShjc3YsIHRoaXMuZDMuY3N2KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNvbnZlcnRUc3ZUb0RhdGEgPSBmdW5jdGlvbiAodHN2KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRYc3ZUb0RhdGEodHN2LCB0aGlzLmQzLnRzdik7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jb252ZXJ0SnNvblRvRGF0YSA9IGZ1bmN0aW9uIChqc29uLCBrZXlzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBuZXdfcm93cyA9IFtdLFxuICAgICAgICAgICAgdGFyZ2V0S2V5cyxcbiAgICAgICAgICAgIGRhdGE7XG4gICAgICAgIGlmIChrZXlzKSB7XG4gICAgICAgICAgICAvLyB3aGVuIGtleXMgc3BlY2lmaWVkLCBqc29uIHdvdWxkIGJlIGFuIGFycmF5IHRoYXQgaW5jbHVkZXMgb2JqZWN0c1xuICAgICAgICAgICAgaWYgKGtleXMueCkge1xuICAgICAgICAgICAgICAgIHRhcmdldEtleXMgPSBrZXlzLnZhbHVlLmNvbmNhdChrZXlzLngpO1xuICAgICAgICAgICAgICAgICQkLmNvbmZpZy5kYXRhX3ggPSBrZXlzLng7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhcmdldEtleXMgPSBrZXlzLnZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3X3Jvd3MucHVzaCh0YXJnZXRLZXlzKTtcbiAgICAgICAgICAgIGpzb24uZm9yRWFjaChmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgIHZhciBuZXdfcm93ID0gW107XG4gICAgICAgICAgICAgICAgdGFyZ2V0S2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29udmVydCB1bmRlZmluZWQgdG8gbnVsbCBiZWNhdXNlIHVuZGVmaW5lZCBkYXRhIHdpbGwgYmUgcmVtb3ZlZCBpbiBjb252ZXJ0RGF0YVRvVGFyZ2V0cygpXG4gICAgICAgICAgICAgICAgICAgIHZhciB2ID0gJCQuZmluZFZhbHVlSW5Kc29uKG8sIGtleSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1VuZGVmaW5lZCh2KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbmV3X3Jvdy5wdXNoKHYpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG5ld19yb3dzLnB1c2gobmV3X3Jvdyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRhdGEgPSAkJC5jb252ZXJ0Um93c1RvRGF0YShuZXdfcm93cyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhqc29uKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICAgICBuZXdfcm93cy5wdXNoKFtrZXldLmNvbmNhdChqc29uW2tleV0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGF0YSA9ICQkLmNvbnZlcnRDb2x1bW5zVG9EYXRhKG5ld19yb3dzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmZpbmRWYWx1ZUluSnNvbiA9IGZ1bmN0aW9uIChvYmplY3QsIHBhdGgpIHtcbiAgICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvXFxbKFxcdyspXFxdL2csICcuJDEnKTsgLy8gY29udmVydCBpbmRleGVzIHRvIHByb3BlcnRpZXMgKHJlcGxhY2UgW10gd2l0aCAuKVxuICAgICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9eXFwuLywgJycpOyAvLyBzdHJpcCBhIGxlYWRpbmcgZG90XG4gICAgICAgIHZhciBwYXRoQXJyYXkgPSBwYXRoLnNwbGl0KCcuJyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aEFycmF5Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgayA9IHBhdGhBcnJheVtpXTtcbiAgICAgICAgICAgIGlmIChrIGluIG9iamVjdCkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFtrXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jb252ZXJ0Um93c1RvRGF0YSA9IGZ1bmN0aW9uIChyb3dzKSB7XG4gICAgICAgIHZhciBrZXlzID0gcm93c1swXSxcbiAgICAgICAgICAgIG5ld19yb3cgPSB7fSxcbiAgICAgICAgICAgIG5ld19yb3dzID0gW10sXG4gICAgICAgICAgICBpLFxuICAgICAgICAgICAgajtcbiAgICAgICAgZm9yIChpID0gMTsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIG5ld19yb3cgPSB7fTtcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCByb3dzW2ldLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzVW5kZWZpbmVkKHJvd3NbaV1bal0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNvdXJjZSBkYXRhIGlzIG1pc3NpbmcgYSBjb21wb25lbnQgYXQgKFwiICsgaSArIFwiLFwiICsgaiArIFwiKSFcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5ld19yb3dba2V5c1tqXV0gPSByb3dzW2ldW2pdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3X3Jvd3MucHVzaChuZXdfcm93KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3X3Jvd3M7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jb252ZXJ0Q29sdW1uc1RvRGF0YSA9IGZ1bmN0aW9uIChjb2x1bW5zKSB7XG4gICAgICAgIHZhciBuZXdfcm93cyA9IFtdLFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIGosXG4gICAgICAgICAgICBrZXk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb2x1bW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBrZXkgPSBjb2x1bW5zW2ldWzBdO1xuICAgICAgICAgICAgZm9yIChqID0gMTsgaiA8IGNvbHVtbnNbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNVbmRlZmluZWQobmV3X3Jvd3NbaiAtIDFdKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdfcm93c1tqIC0gMV0gPSB7fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlzVW5kZWZpbmVkKGNvbHVtbnNbaV1bal0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNvdXJjZSBkYXRhIGlzIG1pc3NpbmcgYSBjb21wb25lbnQgYXQgKFwiICsgaSArIFwiLFwiICsgaiArIFwiKSFcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5ld19yb3dzW2ogLSAxXVtrZXldID0gY29sdW1uc1tpXVtqXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3X3Jvd3M7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jb252ZXJ0RGF0YVRvVGFyZ2V0cyA9IGZ1bmN0aW9uIChkYXRhLCBhcHBlbmRYcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgaWRzID0gJCQuZDMua2V5cyhkYXRhWzBdKS5maWx0ZXIoJCQuaXNOb3RYLCAkJCksXG4gICAgICAgICAgICB4cyA9ICQkLmQzLmtleXMoZGF0YVswXSkuZmlsdGVyKCQkLmlzWCwgJCQpLFxuICAgICAgICAgICAgdGFyZ2V0cztcblxuICAgICAgICAvLyBzYXZlIHggZm9yIHVwZGF0ZSBkYXRhIGJ5IGxvYWQgd2hlbiBjdXN0b20geCBhbmQgYzMueCBBUElcbiAgICAgICAgaWRzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICB2YXIgeEtleSA9ICQkLmdldFhLZXkoaWQpO1xuXG4gICAgICAgICAgICBpZiAoJCQuaXNDdXN0b21YKCkgfHwgJCQuaXNUaW1lU2VyaWVzKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiBpbmNsdWRlZCBpbiBpbnB1dCBkYXRhXG4gICAgICAgICAgICAgICAgaWYgKHhzLmluZGV4T2YoeEtleSkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICAkJC5kYXRhLnhzW2lkXSA9IChhcHBlbmRYcyAmJiAkJC5kYXRhLnhzW2lkXSA/ICQkLmRhdGEueHNbaWRdIDogW10pLmNvbmNhdChkYXRhLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRbeEtleV07XG4gICAgICAgICAgICAgICAgICAgIH0pLmZpbHRlcihpc1ZhbHVlKS5tYXAoZnVuY3Rpb24gKHJhd1gsIGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkJC5nZW5lcmF0ZVRhcmdldFgocmF3WCwgaWQsIGkpO1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCBpbmNsdWRlZCBpbiBpbnB1dCBkYXRhLCBmaW5kIGZyb20gcHJlbG9hZGVkIGRhdGEgb2Ygb3RoZXIgaWQncyB4XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnLmRhdGFfeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCQuZGF0YS54c1tpZF0gPSAkJC5nZXRPdGhlclRhcmdldFhzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm90IGluY2x1ZGVkIGluIGlucHV0IGRhdGEsIGZpbmQgZnJvbSBwcmVsb2FkZWQgZGF0YVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChub3RFbXB0eShjb25maWcuZGF0YV94cykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkJC5kYXRhLnhzW2lkXSA9ICQkLmdldFhWYWx1ZXNPZlhLZXkoeEtleSwgJCQuZGF0YS50YXJnZXRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBNRU1POiBpZiBubyB4IGluY2x1ZGVkLCB1c2Ugc2FtZSB4IG9mIGN1cnJlbnQgd2lsbCBiZSB1c2VkXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQkLmRhdGEueHNbaWRdID0gZGF0YS5tYXAoZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGNoZWNrIHggaXMgZGVmaW5lZFxuICAgICAgICBpZHMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIGlmICghJCQuZGF0YS54c1tpZF0pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3ggaXMgbm90IGRlZmluZWQgZm9yIGlkID0gXCInICsgaWQgKyAnXCIuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGNvbnZlcnQgdG8gdGFyZ2V0XG4gICAgICAgIHRhcmdldHMgPSBpZHMubWFwKGZ1bmN0aW9uIChpZCwgaW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBjb252ZXJ0ZWRJZCA9IGNvbmZpZy5kYXRhX2lkQ29udmVydGVyKGlkKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IGNvbnZlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkX29yZzogaWQsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBkYXRhLm1hcChmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgeEtleSA9ICQkLmdldFhLZXkoaWQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmF3WCA9IGRbeEtleV0sXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGRbaWRdICE9PSBudWxsICYmICFpc05hTihkW2lkXSkgPyArZFtpZF0gOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgeDtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXNlIHggYXMgY2F0ZWdvcmllcyBpZiBjdXN0b20geCBhbmQgY2F0ZWdvcml6ZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQkLmlzQ3VzdG9tWCgpICYmICQkLmlzQ2F0ZWdvcml6ZWQoKSAmJiBpbmRleCA9PT0gMCAmJiAhaXNVbmRlZmluZWQocmF3WCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCAmJiBpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmF4aXNfeF9jYXRlZ29yaWVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB4ID0gY29uZmlnLmF4aXNfeF9jYXRlZ29yaWVzLmluZGV4T2YocmF3WCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoeCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gY29uZmlnLmF4aXNfeF9jYXRlZ29yaWVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXhpc194X2NhdGVnb3JpZXMucHVzaChyYXdYKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHggPSAkJC5nZW5lcmF0ZVRhcmdldFgocmF3WCwgaWQsIGkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIG1hcmsgYXMgeCA9IHVuZGVmaW5lZCBpZiB2YWx1ZSBpcyB1bmRlZmluZWQgYW5kIGZpbHRlciB0byByZW1vdmUgYWZ0ZXIgbWFwcGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1VuZGVmaW5lZChkW2lkXSkgfHwgJCQuZGF0YS54c1tpZF0ubGVuZ3RoIDw9IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHggPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgeDogeCwgdmFsdWU6IHZhbHVlLCBpZDogY29udmVydGVkSWQgfTtcbiAgICAgICAgICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzRGVmaW5lZCh2LngpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBmaW5pc2ggdGFyZ2V0c1xuICAgICAgICB0YXJnZXRzLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgLy8gc29ydCB2YWx1ZXMgYnkgaXRzIHhcbiAgICAgICAgICAgIGlmIChjb25maWcuZGF0YV94U29ydCkge1xuICAgICAgICAgICAgICAgIHQudmFsdWVzID0gdC52YWx1ZXMuc29ydChmdW5jdGlvbiAodjEsIHYyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB4MSA9IHYxLnggfHwgdjEueCA9PT0gMCA/IHYxLnggOiBJbmZpbml0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHgyID0gdjIueCB8fCB2Mi54ID09PSAwID8gdjIueCA6IEluZmluaXR5O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geDEgLSB4MjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGluZGV4aW5nIGVhY2ggdmFsdWVcbiAgICAgICAgICAgIGkgPSAwO1xuICAgICAgICAgICAgdC52YWx1ZXMuZm9yRWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgIHYuaW5kZXggPSBpKys7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIHRoaXMgbmVlZHMgdG8gYmUgc29ydGVkIGJlY2F1c2UgaXRzIGluZGV4IGFuZCB2YWx1ZS5pbmRleCBpcyBpZGVudGljYWxcbiAgICAgICAgICAgICQkLmRhdGEueHNbdC5pZF0uc29ydChmdW5jdGlvbiAodjEsIHYyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHYxIC0gdjI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gY2FjaGUgaW5mb3JtYXRpb24gYWJvdXQgdmFsdWVzXG4gICAgICAgICQkLmhhc05lZ2F0aXZlVmFsdWUgPSAkJC5oYXNOZWdhdGl2ZVZhbHVlSW5UYXJnZXRzKHRhcmdldHMpO1xuICAgICAgICAkJC5oYXNQb3NpdGl2ZVZhbHVlID0gJCQuaGFzUG9zaXRpdmVWYWx1ZUluVGFyZ2V0cyh0YXJnZXRzKTtcblxuICAgICAgICAvLyBzZXQgdGFyZ2V0IHR5cGVzXG4gICAgICAgIGlmIChjb25maWcuZGF0YV90eXBlKSB7XG4gICAgICAgICAgICAkJC5zZXRUYXJnZXRUeXBlKCQkLm1hcFRvSWRzKHRhcmdldHMpLmZpbHRlcihmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIShpZCBpbiBjb25maWcuZGF0YV90eXBlcyk7XG4gICAgICAgICAgICB9KSwgY29uZmlnLmRhdGFfdHlwZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjYWNoZSBhcyBvcmlnaW5hbCBpZCBrZXllZFxuICAgICAgICB0YXJnZXRzLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICQkLmFkZENhY2hlKGQuaWRfb3JnLCBkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRhcmdldHM7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmxvYWQgPSBmdW5jdGlvbiAodGFyZ2V0cywgYXJncykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICBpZiAodGFyZ2V0cykge1xuICAgICAgICAgICAgLy8gZmlsdGVyIGxvYWRpbmcgdGFyZ2V0cyBpZiBuZWVkZWRcbiAgICAgICAgICAgIGlmIChhcmdzLmZpbHRlcikge1xuICAgICAgICAgICAgICAgIHRhcmdldHMgPSB0YXJnZXRzLmZpbHRlcihhcmdzLmZpbHRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBzZXQgdHlwZSBpZiBhcmdzLnR5cGVzIHx8IGFyZ3MudHlwZSBzcGVjaWZpZWRcbiAgICAgICAgICAgIGlmIChhcmdzLnR5cGUgfHwgYXJncy50eXBlcykge1xuICAgICAgICAgICAgICAgIHRhcmdldHMuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IGFyZ3MudHlwZXMgJiYgYXJncy50eXBlc1t0LmlkXSA/IGFyZ3MudHlwZXNbdC5pZF0gOiBhcmdzLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgICQkLnNldFRhcmdldFR5cGUodC5pZCwgdHlwZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBVcGRhdGUvQWRkIGRhdGFcbiAgICAgICAgICAgICQkLmRhdGEudGFyZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLmlkID09PSB0YXJnZXRzW2ldLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnZhbHVlcyA9IHRhcmdldHNbaV0udmFsdWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0cy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJCQuZGF0YS50YXJnZXRzID0gJCQuZGF0YS50YXJnZXRzLmNvbmNhdCh0YXJnZXRzKTsgLy8gYWRkIHJlbWFpbmVkXG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdGFyZ2V0c1xuICAgICAgICAkJC51cGRhdGVUYXJnZXRzKCQkLmRhdGEudGFyZ2V0cyk7XG5cbiAgICAgICAgLy8gUmVkcmF3IHdpdGggbmV3IHRhcmdldHNcbiAgICAgICAgJCQucmVkcmF3KHsgd2l0aFVwZGF0ZU9yZ1hEb21haW46IHRydWUsIHdpdGhVcGRhdGVYRG9tYWluOiB0cnVlLCB3aXRoTGVnZW5kOiB0cnVlIH0pO1xuXG4gICAgICAgIGlmIChhcmdzLmRvbmUpIHtcbiAgICAgICAgICAgIGFyZ3MuZG9uZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5sb2FkRnJvbUFyZ3MgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICBpZiAoYXJncy5kYXRhKSB7XG4gICAgICAgICAgICAkJC5sb2FkKCQkLmNvbnZlcnREYXRhVG9UYXJnZXRzKGFyZ3MuZGF0YSksIGFyZ3MpO1xuICAgICAgICB9IGVsc2UgaWYgKGFyZ3MudXJsKSB7XG4gICAgICAgICAgICAkJC5jb252ZXJ0VXJsVG9EYXRhKGFyZ3MudXJsLCBhcmdzLm1pbWVUeXBlLCBhcmdzLmhlYWRlcnMsIGFyZ3Mua2V5cywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkJC5sb2FkKCQkLmNvbnZlcnREYXRhVG9UYXJnZXRzKGRhdGEpLCBhcmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGFyZ3MuanNvbikge1xuICAgICAgICAgICAgJCQubG9hZCgkJC5jb252ZXJ0RGF0YVRvVGFyZ2V0cygkJC5jb252ZXJ0SnNvblRvRGF0YShhcmdzLmpzb24sIGFyZ3Mua2V5cykpLCBhcmdzKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzLnJvd3MpIHtcbiAgICAgICAgICAgICQkLmxvYWQoJCQuY29udmVydERhdGFUb1RhcmdldHMoJCQuY29udmVydFJvd3NUb0RhdGEoYXJncy5yb3dzKSksIGFyZ3MpO1xuICAgICAgICB9IGVsc2UgaWYgKGFyZ3MuY29sdW1ucykge1xuICAgICAgICAgICAgJCQubG9hZCgkJC5jb252ZXJ0RGF0YVRvVGFyZ2V0cygkJC5jb252ZXJ0Q29sdW1uc1RvRGF0YShhcmdzLmNvbHVtbnMpKSwgYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkJC5sb2FkKG51bGwsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51bmxvYWQgPSBmdW5jdGlvbiAodGFyZ2V0SWRzLCBkb25lKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIGlmICghZG9uZSkge1xuICAgICAgICAgICAgZG9uZSA9IGZ1bmN0aW9uIGRvbmUoKSB7fTtcbiAgICAgICAgfVxuICAgICAgICAvLyBmaWx0ZXIgZXhpc3RpbmcgdGFyZ2V0XG4gICAgICAgIHRhcmdldElkcyA9IHRhcmdldElkcy5maWx0ZXIoZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuaGFzVGFyZ2V0KCQkLmRhdGEudGFyZ2V0cywgaWQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gSWYgbm8gdGFyZ2V0LCBjYWxsIGRvbmUgYW5kIHJldHVyblxuICAgICAgICBpZiAoIXRhcmdldElkcyB8fCB0YXJnZXRJZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgJCQuc3ZnLnNlbGVjdEFsbCh0YXJnZXRJZHMubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLnNlbGVjdG9yVGFyZ2V0KGlkKTtcbiAgICAgICAgfSkpLnRyYW5zaXRpb24oKS5zdHlsZSgnb3BhY2l0eScsIDApLnJlbW92ZSgpLmNhbGwoJCQuZW5kYWxsLCBkb25lKTtcbiAgICAgICAgdGFyZ2V0SWRzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAvLyBSZXNldCBmYWRlaW4gZm9yIGZ1dHVyZSBsb2FkXG4gICAgICAgICAgICAkJC53aXRob3V0RmFkZUluW2lkXSA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHRhcmdldCdzIGVsZW1lbnRzXG4gICAgICAgICAgICBpZiAoJCQubGVnZW5kKSB7XG4gICAgICAgICAgICAgICAgJCQubGVnZW5kLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5sZWdlbmRJdGVtICsgJCQuZ2V0VGFyZ2V0U2VsZWN0b3JTdWZmaXgoaWQpKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0YXJnZXRcbiAgICAgICAgICAgICQkLmRhdGEudGFyZ2V0cyA9ICQkLmRhdGEudGFyZ2V0cy5maWx0ZXIoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdC5pZCAhPT0gaWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNhdGVnb3J5TmFtZSA9IGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZztcbiAgICAgICAgcmV0dXJuIGkgPCBjb25maWcuYXhpc194X2NhdGVnb3JpZXMubGVuZ3RoID8gY29uZmlnLmF4aXNfeF9jYXRlZ29yaWVzW2ldIDogaTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaW5pdEV2ZW50UmVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MuY2hhcnQpLmFwcGVuZChcImdcIikuYXR0cihcImNsYXNzXCIsIENMQVNTLmV2ZW50UmVjdHMpLnN0eWxlKCdmaWxsLW9wYWNpdHknLCAwKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlZHJhd0V2ZW50UmVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGV2ZW50UmVjdFVwZGF0ZSxcbiAgICAgICAgICAgIG1heERhdGFDb3VudFRhcmdldCxcbiAgICAgICAgICAgIGlzTXVsdGlwbGVYID0gJCQuaXNNdWx0aXBsZVgoKTtcblxuICAgICAgICAvLyByZWN0cyBmb3IgbW91c2VvdmVyXG4gICAgICAgIHZhciBldmVudFJlY3RzID0gJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MuZXZlbnRSZWN0cykuc3R5bGUoJ2N1cnNvcicsIGNvbmZpZy56b29tX2VuYWJsZWQgPyBjb25maWcuYXhpc19yb3RhdGVkID8gJ25zLXJlc2l6ZScgOiAnZXctcmVzaXplJyA6IG51bGwpLmNsYXNzZWQoQ0xBU1MuZXZlbnRSZWN0c011bHRpcGxlLCBpc011bHRpcGxlWCkuY2xhc3NlZChDTEFTUy5ldmVudFJlY3RzU2luZ2xlLCAhaXNNdWx0aXBsZVgpO1xuXG4gICAgICAgIC8vIGNsZWFyIG9sZCByZWN0c1xuICAgICAgICBldmVudFJlY3RzLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5ldmVudFJlY3QpLnJlbW92ZSgpO1xuXG4gICAgICAgIC8vIG9wZW4gYXMgcHVibGljIHZhcmlhYmxlXG4gICAgICAgICQkLmV2ZW50UmVjdCA9IGV2ZW50UmVjdHMuc2VsZWN0QWxsKCcuJyArIENMQVNTLmV2ZW50UmVjdCk7XG5cbiAgICAgICAgaWYgKGlzTXVsdGlwbGVYKSB7XG4gICAgICAgICAgICBldmVudFJlY3RVcGRhdGUgPSAkJC5ldmVudFJlY3QuZGF0YShbMF0pO1xuICAgICAgICAgICAgLy8gZW50ZXIgOiBvbmx5IG9uZSByZWN0IHdpbGwgYmUgYWRkZWRcbiAgICAgICAgICAgICQkLmdlbmVyYXRlRXZlbnRSZWN0c0Zvck11bHRpcGxlWHMoZXZlbnRSZWN0VXBkYXRlLmVudGVyKCkpO1xuICAgICAgICAgICAgLy8gdXBkYXRlXG4gICAgICAgICAgICAkJC51cGRhdGVFdmVudFJlY3QoZXZlbnRSZWN0VXBkYXRlKTtcbiAgICAgICAgICAgIC8vIGV4aXQgOiBub3QgbmVlZGVkIGJlY2F1c2UgYWx3YXlzIG9ubHkgb25lIHJlY3QgZXhpc3RzXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBTZXQgZGF0YSBhbmQgdXBkYXRlICQkLmV2ZW50UmVjdFxuICAgICAgICAgICAgbWF4RGF0YUNvdW50VGFyZ2V0ID0gJCQuZ2V0TWF4RGF0YUNvdW50VGFyZ2V0KCQkLmRhdGEudGFyZ2V0cyk7XG4gICAgICAgICAgICBldmVudFJlY3RzLmRhdHVtKG1heERhdGFDb3VudFRhcmdldCA/IG1heERhdGFDb3VudFRhcmdldC52YWx1ZXMgOiBbXSk7XG4gICAgICAgICAgICAkJC5ldmVudFJlY3QgPSBldmVudFJlY3RzLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5ldmVudFJlY3QpO1xuICAgICAgICAgICAgZXZlbnRSZWN0VXBkYXRlID0gJCQuZXZlbnRSZWN0LmRhdGEoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gZW50ZXJcbiAgICAgICAgICAgICQkLmdlbmVyYXRlRXZlbnRSZWN0c0ZvclNpbmdsZVgoZXZlbnRSZWN0VXBkYXRlLmVudGVyKCkpO1xuICAgICAgICAgICAgLy8gdXBkYXRlXG4gICAgICAgICAgICAkJC51cGRhdGVFdmVudFJlY3QoZXZlbnRSZWN0VXBkYXRlKTtcbiAgICAgICAgICAgIC8vIGV4aXRcbiAgICAgICAgICAgIGV2ZW50UmVjdFVwZGF0ZS5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZUV2ZW50UmVjdCA9IGZ1bmN0aW9uIChldmVudFJlY3RVcGRhdGUpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIHgsXG4gICAgICAgICAgICB5LFxuICAgICAgICAgICAgdyxcbiAgICAgICAgICAgIGgsXG4gICAgICAgICAgICByZWN0VyxcbiAgICAgICAgICAgIHJlY3RYO1xuXG4gICAgICAgIC8vIHNldCB1cGRhdGUgc2VsZWN0aW9uIGlmIG51bGxcbiAgICAgICAgZXZlbnRSZWN0VXBkYXRlID0gZXZlbnRSZWN0VXBkYXRlIHx8ICQkLmV2ZW50UmVjdC5kYXRhKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCQkLmlzTXVsdGlwbGVYKCkpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IHJvdGF0ZWQgbm90IHN1cHBvcnRlZCB5ZXRcbiAgICAgICAgICAgIHggPSAwO1xuICAgICAgICAgICAgeSA9IDA7XG4gICAgICAgICAgICB3ID0gJCQud2lkdGg7XG4gICAgICAgICAgICBoID0gJCQuaGVpZ2h0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCgkJC5pc0N1c3RvbVgoKSB8fCAkJC5pc1RpbWVTZXJpZXMoKSkgJiYgISQkLmlzQ2F0ZWdvcml6ZWQoKSkge1xuXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIGluZGV4IGZvciB4IHRoYXQgaXMgdXNlZCBieSBwcmV2WCBhbmQgbmV4dFhcbiAgICAgICAgICAgICAgICAkJC51cGRhdGVYcygpO1xuXG4gICAgICAgICAgICAgICAgcmVjdFcgPSBmdW5jdGlvbiByZWN0VyhkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcmV2WCA9ICQkLmdldFByZXZYKGQuaW5kZXgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dFggPSAkJC5nZXROZXh0WChkLmluZGV4KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSB0aGlzIGlzIGEgc2luZ2xlIGRhdGEgcG9pbnQgbWFrZSB0aGUgZXZlbnRSZWN0IGZ1bGwgd2lkdGggKG9yIGhlaWdodClcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZYID09PSBudWxsICYmIG5leHRYID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmF4aXNfcm90YXRlZCA/ICQkLmhlaWdodCA6ICQkLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZYID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2WCA9ICQkLnguZG9tYWluKClbMF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRYID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0WCA9ICQkLnguZG9tYWluKClbMV07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoMCwgKCQkLngobmV4dFgpIC0gJCQueChwcmV2WCkpIC8gMik7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZWN0WCA9IGZ1bmN0aW9uIHJlY3RYKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByZXZYID0gJCQuZ2V0UHJldlgoZC5pbmRleCksXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0WCA9ICQkLmdldE5leHRYKGQuaW5kZXgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1ggPSAkJC5kYXRhLnhzW2QuaWRdW2QuaW5kZXhdO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIHRoaXMgaXMgYSBzaW5nbGUgZGF0YSBwb2ludCBwb3NpdGlvbiB0aGUgZXZlbnRSZWN0IGF0IDBcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZYID09PSBudWxsICYmIG5leHRYID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmV2WCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldlggPSAkJC54LmRvbWFpbigpWzBdO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkJC54KHRoaXNYKSArICQkLngocHJldlgpKSAvIDI7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVjdFcgPSAkJC5nZXRFdmVudFJlY3RXaWR0aCgpO1xuICAgICAgICAgICAgICAgIHJlY3RYID0gZnVuY3Rpb24gcmVjdFgoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJCQueChkLngpIC0gcmVjdFcgLyAyO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB4ID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IDAgOiByZWN0WDtcbiAgICAgICAgICAgIHkgPSBjb25maWcuYXhpc19yb3RhdGVkID8gcmVjdFggOiAwO1xuICAgICAgICAgICAgdyA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAkJC53aWR0aCA6IHJlY3RXO1xuICAgICAgICAgICAgaCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyByZWN0VyA6ICQkLmhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIGV2ZW50UmVjdFVwZGF0ZS5hdHRyKCdjbGFzcycsICQkLmNsYXNzRXZlbnQuYmluZCgkJCkpLmF0dHIoXCJ4XCIsIHgpLmF0dHIoXCJ5XCIsIHkpLmF0dHIoXCJ3aWR0aFwiLCB3KS5hdHRyKFwiaGVpZ2h0XCIsIGgpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2VuZXJhdGVFdmVudFJlY3RzRm9yU2luZ2xlWCA9IGZ1bmN0aW9uIChldmVudFJlY3RFbnRlcikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZDMgPSAkJC5kMyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgZXZlbnRSZWN0RW50ZXIuYXBwZW5kKFwicmVjdFwiKS5hdHRyKFwiY2xhc3NcIiwgJCQuY2xhc3NFdmVudC5iaW5kKCQkKSkuc3R5bGUoXCJjdXJzb3JcIiwgY29uZmlnLmRhdGFfc2VsZWN0aW9uX2VuYWJsZWQgJiYgY29uZmlnLmRhdGFfc2VsZWN0aW9uX2dyb3VwZWQgPyBcInBvaW50ZXJcIiA6IG51bGwpLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gZC5pbmRleDtcblxuICAgICAgICAgICAgaWYgKCQkLmRyYWdnaW5nIHx8ICQkLmZsb3dpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IC8vIGRvIG5vdGhpbmcgd2hpbGUgZHJhZ2dpbmcvZmxvd2luZ1xuICAgICAgICAgICAgaWYgKCQkLmhhc0FyY1R5cGUoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRXhwYW5kIHNoYXBlcyBmb3Igc2VsZWN0aW9uXG4gICAgICAgICAgICBpZiAoY29uZmlnLnBvaW50X2ZvY3VzX2V4cGFuZF9lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgJCQuZXhwYW5kQ2lyY2xlcyhpbmRleCwgbnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkJC5leHBhbmRCYXJzKGluZGV4LCBudWxsLCB0cnVlKTtcblxuICAgICAgICAgICAgLy8gQ2FsbCBldmVudCBoYW5kbGVyXG4gICAgICAgICAgICAkJC5tYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5zaGFwZSArICctJyArIGluZGV4KS5lYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmRhdGFfb25tb3VzZW92ZXIuY2FsbCgkJC5hcGksIGQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSBkLmluZGV4O1xuICAgICAgICAgICAgaWYgKCEkJC5jb25maWcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IC8vIGNoYXJ0IGlzIGRlc3Ryb3llZFxuICAgICAgICAgICAgaWYgKCQkLmhhc0FyY1R5cGUoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQkLmhpZGVYR3JpZEZvY3VzKCk7XG4gICAgICAgICAgICAkJC5oaWRlVG9vbHRpcCgpO1xuICAgICAgICAgICAgLy8gVW5kbyBleHBhbmRlZCBzaGFwZXNcbiAgICAgICAgICAgICQkLnVuZXhwYW5kQ2lyY2xlcygpO1xuICAgICAgICAgICAgJCQudW5leHBhbmRCYXJzKCk7XG4gICAgICAgICAgICAvLyBDYWxsIGV2ZW50IGhhbmRsZXJcbiAgICAgICAgICAgICQkLm1haW4uc2VsZWN0QWxsKCcuJyArIENMQVNTLnNoYXBlICsgJy0nICsgaW5kZXgpLmVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICBjb25maWcuZGF0YV9vbm1vdXNlb3V0LmNhbGwoJCQuYXBpLCBkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KS5vbignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZERhdGEsXG4gICAgICAgICAgICAgICAgaW5kZXggPSBkLmluZGV4LFxuICAgICAgICAgICAgICAgIGV2ZW50UmVjdCA9ICQkLnN2Zy5zZWxlY3QoJy4nICsgQ0xBU1MuZXZlbnRSZWN0ICsgJy0nICsgaW5kZXgpO1xuXG4gICAgICAgICAgICBpZiAoJCQuZHJhZ2dpbmcgfHwgJCQuZmxvd2luZykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gLy8gZG8gbm90aGluZyB3aGlsZSBkcmFnZ2luZy9mbG93aW5nXG4gICAgICAgICAgICBpZiAoJCQuaGFzQXJjVHlwZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoJCQuaXNTdGVwVHlwZShkKSAmJiAkJC5jb25maWcubGluZV9zdGVwX3R5cGUgPT09ICdzdGVwLWFmdGVyJyAmJiBkMy5tb3VzZSh0aGlzKVswXSA8ICQkLngoJCQuZ2V0WFZhbHVlKGQuaWQsIGluZGV4KSkpIHtcbiAgICAgICAgICAgICAgICBpbmRleCAtPSAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTaG93IHRvb2x0aXBcbiAgICAgICAgICAgIHNlbGVjdGVkRGF0YSA9ICQkLmZpbHRlclRhcmdldHNUb1Nob3coJCQuZGF0YS50YXJnZXRzKS5tYXAoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJCQuYWRkTmFtZSgkJC5nZXRWYWx1ZU9uSW5kZXgodC52YWx1ZXMsIGluZGV4KSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGNvbmZpZy50b29sdGlwX2dyb3VwZWQpIHtcbiAgICAgICAgICAgICAgICAkJC5zaG93VG9vbHRpcChzZWxlY3RlZERhdGEsIHRoaXMpO1xuICAgICAgICAgICAgICAgICQkLnNob3dYR3JpZEZvY3VzKHNlbGVjdGVkRGF0YSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjb25maWcudG9vbHRpcF9ncm91cGVkICYmICghY29uZmlnLmRhdGFfc2VsZWN0aW9uX2VuYWJsZWQgfHwgY29uZmlnLmRhdGFfc2VsZWN0aW9uX2dyb3VwZWQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkJC5tYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5zaGFwZSArICctJyArIGluZGV4KS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuY2xhc3NlZChDTEFTUy5FWFBBTkRFRCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5kYXRhX3NlbGVjdGlvbl9lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UmVjdC5zdHlsZSgnY3Vyc29yJywgY29uZmlnLmRhdGFfc2VsZWN0aW9uX2dyb3VwZWQgPyAncG9pbnRlcicgOiBudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFjb25maWcudG9vbHRpcF9ncm91cGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICQkLmhpZGVYR3JpZEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICQkLmhpZGVUb29sdGlwKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghY29uZmlnLmRhdGFfc2VsZWN0aW9uX2dyb3VwZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQkLnVuZXhwYW5kQ2lyY2xlcyhpbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkJC51bmV4cGFuZEJhcnMoaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQkLmlzV2l0aGluU2hhcGUodGhpcywgZCk7XG4gICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5kYXRhX3NlbGVjdGlvbl9lbmFibGVkICYmIChjb25maWcuZGF0YV9zZWxlY3Rpb25fZ3JvdXBlZCB8fCBjb25maWcuZGF0YV9zZWxlY3Rpb25faXNzZWxlY3RhYmxlKGQpKSkge1xuICAgICAgICAgICAgICAgICAgICBldmVudFJlY3Quc3R5bGUoJ2N1cnNvcicsICdwb2ludGVyJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghY29uZmlnLnRvb2x0aXBfZ3JvdXBlZCkge1xuICAgICAgICAgICAgICAgICAgICAkJC5zaG93VG9vbHRpcChbZF0sIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAkJC5zaG93WEdyaWRGb2N1cyhbZF0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLnBvaW50X2ZvY3VzX2V4cGFuZF9lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkJC5leHBhbmRDaXJjbGVzKGluZGV4LCBkLmlkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkJC5leHBhbmRCYXJzKGluZGV4LCBkLmlkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IGQuaW5kZXg7XG4gICAgICAgICAgICBpZiAoJCQuaGFzQXJjVHlwZSgpIHx8ICEkJC50b2dnbGVTaGFwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgkJC5jYW5jZWxDbGljaykge1xuICAgICAgICAgICAgICAgICQkLmNhbmNlbENsaWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCQkLmlzU3RlcFR5cGUoZCkgJiYgY29uZmlnLmxpbmVfc3RlcF90eXBlID09PSAnc3RlcC1hZnRlcicgJiYgZDMubW91c2UodGhpcylbMF0gPCAkJC54KCQkLmdldFhWYWx1ZShkLmlkLCBpbmRleCkpKSB7XG4gICAgICAgICAgICAgICAgaW5kZXggLT0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQkLm1haW4uc2VsZWN0QWxsKCcuJyArIENMQVNTLnNoYXBlICsgJy0nICsgaW5kZXgpLmVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmRhdGFfc2VsZWN0aW9uX2dyb3VwZWQgfHwgJCQuaXNXaXRoaW5TaGFwZSh0aGlzLCBkKSkge1xuICAgICAgICAgICAgICAgICAgICAkJC50b2dnbGVTaGFwZSh0aGlzLCBkLCBpbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICQkLmNvbmZpZy5kYXRhX29uY2xpY2suY2FsbCgkJC5hcGksIGQsIHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KS5jYWxsKGNvbmZpZy5kYXRhX3NlbGVjdGlvbl9kcmFnZ2FibGUgJiYgJCQuZHJhZyA/IGQzLmJlaGF2aW9yLmRyYWcoKS5vcmlnaW4oT2JqZWN0KS5vbignZHJhZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQkLmRyYWcoZDMubW91c2UodGhpcykpO1xuICAgICAgICB9KS5vbignZHJhZ3N0YXJ0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCQuZHJhZ3N0YXJ0KGQzLm1vdXNlKHRoaXMpKTtcbiAgICAgICAgfSkub24oJ2RyYWdlbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkJC5kcmFnZW5kKCk7XG4gICAgICAgIH0pIDogZnVuY3Rpb24gKCkge30pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZW5lcmF0ZUV2ZW50UmVjdHNGb3JNdWx0aXBsZVhzID0gZnVuY3Rpb24gKGV2ZW50UmVjdEVudGVyKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBkMyA9ICQkLmQzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuXG4gICAgICAgIGZ1bmN0aW9uIG1vdXNlb3V0KCkge1xuICAgICAgICAgICAgJCQuc3ZnLnNlbGVjdCgnLicgKyBDTEFTUy5ldmVudFJlY3QpLnN0eWxlKCdjdXJzb3InLCBudWxsKTtcbiAgICAgICAgICAgICQkLmhpZGVYR3JpZEZvY3VzKCk7XG4gICAgICAgICAgICAkJC5oaWRlVG9vbHRpcCgpO1xuICAgICAgICAgICAgJCQudW5leHBhbmRDaXJjbGVzKCk7XG4gICAgICAgICAgICAkJC51bmV4cGFuZEJhcnMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGV2ZW50UmVjdEVudGVyLmFwcGVuZCgncmVjdCcpLmF0dHIoJ3gnLCAwKS5hdHRyKCd5JywgMCkuYXR0cignd2lkdGgnLCAkJC53aWR0aCkuYXR0cignaGVpZ2h0JywgJCQuaGVpZ2h0KS5hdHRyKCdjbGFzcycsIENMQVNTLmV2ZW50UmVjdCkub24oJ21vdXNlb3V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCEkJC5jb25maWcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IC8vIGNoYXJ0IGlzIGRlc3Ryb3llZFxuICAgICAgICAgICAgaWYgKCQkLmhhc0FyY1R5cGUoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vdXNlb3V0KCk7XG4gICAgICAgIH0pLm9uKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0c1RvU2hvdyA9ICQkLmZpbHRlclRhcmdldHNUb1Nob3coJCQuZGF0YS50YXJnZXRzKTtcbiAgICAgICAgICAgIHZhciBtb3VzZSwgY2xvc2VzdCwgc2FtZVhEYXRhLCBzZWxlY3RlZERhdGE7XG5cbiAgICAgICAgICAgIGlmICgkJC5kcmFnZ2luZykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gLy8gZG8gbm90aGluZyB3aGVuIGRyYWdnaW5nXG4gICAgICAgICAgICBpZiAoJCQuaGFzQXJjVHlwZSh0YXJnZXRzVG9TaG93KSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbW91c2UgPSBkMy5tb3VzZSh0aGlzKTtcbiAgICAgICAgICAgIGNsb3Nlc3QgPSAkJC5maW5kQ2xvc2VzdEZyb21UYXJnZXRzKHRhcmdldHNUb1Nob3csIG1vdXNlKTtcblxuICAgICAgICAgICAgaWYgKCQkLm1vdXNlb3ZlciAmJiAoIWNsb3Nlc3QgfHwgY2xvc2VzdC5pZCAhPT0gJCQubW91c2VvdmVyLmlkKSkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5kYXRhX29ubW91c2VvdXQuY2FsbCgkJC5hcGksICQkLm1vdXNlb3Zlcik7XG4gICAgICAgICAgICAgICAgJCQubW91c2VvdmVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWNsb3Nlc3QpIHtcbiAgICAgICAgICAgICAgICBtb3VzZW91dCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCQkLmlzU2NhdHRlclR5cGUoY2xvc2VzdCkgfHwgIWNvbmZpZy50b29sdGlwX2dyb3VwZWQpIHtcbiAgICAgICAgICAgICAgICBzYW1lWERhdGEgPSBbY2xvc2VzdF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNhbWVYRGF0YSA9ICQkLmZpbHRlckJ5WCh0YXJnZXRzVG9TaG93LCBjbG9zZXN0LngpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzaG93IHRvb2x0aXAgd2hlbiBjdXJzb3IgaXMgY2xvc2UgdG8gc29tZSBwb2ludFxuICAgICAgICAgICAgc2VsZWN0ZWREYXRhID0gc2FtZVhEYXRhLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkJC5hZGROYW1lKGQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkJC5zaG93VG9vbHRpcChzZWxlY3RlZERhdGEsIHRoaXMpO1xuXG4gICAgICAgICAgICAvLyBleHBhbmQgcG9pbnRzXG4gICAgICAgICAgICBpZiAoY29uZmlnLnBvaW50X2ZvY3VzX2V4cGFuZF9lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgJCQuZXhwYW5kQ2lyY2xlcyhjbG9zZXN0LmluZGV4LCBjbG9zZXN0LmlkLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQkLmV4cGFuZEJhcnMoY2xvc2VzdC5pbmRleCwgY2xvc2VzdC5pZCwgdHJ1ZSk7XG5cbiAgICAgICAgICAgIC8vIFNob3cgeGdyaWQgZm9jdXMgbGluZVxuICAgICAgICAgICAgJCQuc2hvd1hHcmlkRm9jdXMoc2VsZWN0ZWREYXRhKTtcblxuICAgICAgICAgICAgLy8gU2hvdyBjdXJzb3IgYXMgcG9pbnRlciBpZiBwb2ludCBpcyBjbG9zZSB0byBtb3VzZSBwb3NpdGlvblxuICAgICAgICAgICAgaWYgKCQkLmlzQmFyVHlwZShjbG9zZXN0LmlkKSB8fCAkJC5kaXN0KGNsb3Nlc3QsIG1vdXNlKSA8IGNvbmZpZy5wb2ludF9zZW5zaXRpdml0eSkge1xuICAgICAgICAgICAgICAgICQkLnN2Zy5zZWxlY3QoJy4nICsgQ0xBU1MuZXZlbnRSZWN0KS5zdHlsZSgnY3Vyc29yJywgJ3BvaW50ZXInKTtcbiAgICAgICAgICAgICAgICBpZiAoISQkLm1vdXNlb3Zlcikge1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuZGF0YV9vbm1vdXNlb3Zlci5jYWxsKCQkLmFwaSwgY2xvc2VzdCk7XG4gICAgICAgICAgICAgICAgICAgICQkLm1vdXNlb3ZlciA9IGNsb3Nlc3Q7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0c1RvU2hvdyA9ICQkLmZpbHRlclRhcmdldHNUb1Nob3coJCQuZGF0YS50YXJnZXRzKTtcbiAgICAgICAgICAgIHZhciBtb3VzZSwgY2xvc2VzdDtcbiAgICAgICAgICAgIGlmICgkJC5oYXNBcmNUeXBlKHRhcmdldHNUb1Nob3cpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtb3VzZSA9IGQzLm1vdXNlKHRoaXMpO1xuICAgICAgICAgICAgY2xvc2VzdCA9ICQkLmZpbmRDbG9zZXN0RnJvbVRhcmdldHModGFyZ2V0c1RvU2hvdywgbW91c2UpO1xuICAgICAgICAgICAgaWYgKCFjbG9zZXN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gc2VsZWN0IGlmIHNlbGVjdGlvbiBlbmFibGVkXG4gICAgICAgICAgICBpZiAoJCQuaXNCYXJUeXBlKGNsb3Nlc3QuaWQpIHx8ICQkLmRpc3QoY2xvc2VzdCwgbW91c2UpIDwgY29uZmlnLnBvaW50X3NlbnNpdGl2aXR5KSB7XG4gICAgICAgICAgICAgICAgJCQubWFpbi5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2hhcGVzICsgJCQuZ2V0VGFyZ2V0U2VsZWN0b3JTdWZmaXgoY2xvc2VzdC5pZCkpLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5zaGFwZSArICctJyArIGNsb3Nlc3QuaW5kZXgpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmRhdGFfc2VsZWN0aW9uX2dyb3VwZWQgfHwgJCQuaXNXaXRoaW5TaGFwZSh0aGlzLCBjbG9zZXN0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCQudG9nZ2xlU2hhcGUodGhpcywgY2xvc2VzdCwgY2xvc2VzdC5pbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkJC5jb25maWcuZGF0YV9vbmNsaWNrLmNhbGwoJCQuYXBpLCBjbG9zZXN0LCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS5jYWxsKGNvbmZpZy5kYXRhX3NlbGVjdGlvbl9kcmFnZ2FibGUgJiYgJCQuZHJhZyA/IGQzLmJlaGF2aW9yLmRyYWcoKS5vcmlnaW4oT2JqZWN0KS5vbignZHJhZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQkLmRyYWcoZDMubW91c2UodGhpcykpO1xuICAgICAgICB9KS5vbignZHJhZ3N0YXJ0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCQuZHJhZ3N0YXJ0KGQzLm1vdXNlKHRoaXMpKTtcbiAgICAgICAgfSkub24oJ2RyYWdlbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkJC5kcmFnZW5kKCk7XG4gICAgICAgIH0pIDogZnVuY3Rpb24gKCkge30pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uICh0eXBlLCBpbmRleCwgbW91c2UpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHNlbGVjdG9yID0gJy4nICsgQ0xBU1MuZXZlbnRSZWN0ICsgKCEkJC5pc011bHRpcGxlWCgpID8gJy0nICsgaW5kZXggOiAnJyksXG4gICAgICAgICAgICBldmVudFJlY3QgPSAkJC5tYWluLnNlbGVjdChzZWxlY3Rvcikubm9kZSgpLFxuICAgICAgICAgICAgYm94ID0gZXZlbnRSZWN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgeCA9IGJveC5sZWZ0ICsgKG1vdXNlID8gbW91c2VbMF0gOiAwKSxcbiAgICAgICAgICAgIHkgPSBib3gudG9wICsgKG1vdXNlID8gbW91c2VbMV0gOiAwKSxcbiAgICAgICAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJNb3VzZUV2ZW50c1wiKTtcblxuICAgICAgICBldmVudC5pbml0TW91c2VFdmVudCh0eXBlLCB0cnVlLCB0cnVlLCB3aW5kb3csIDAsIHgsIHksIHgsIHksIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCBudWxsKTtcbiAgICAgICAgZXZlbnRSZWN0LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRDdXJyZW50V2lkdGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIHJldHVybiBjb25maWcuc2l6ZV93aWR0aCA/IGNvbmZpZy5zaXplX3dpZHRoIDogJCQuZ2V0UGFyZW50V2lkdGgoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldEN1cnJlbnRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBoID0gY29uZmlnLnNpemVfaGVpZ2h0ID8gY29uZmlnLnNpemVfaGVpZ2h0IDogJCQuZ2V0UGFyZW50SGVpZ2h0KCk7XG4gICAgICAgIHJldHVybiBoID4gMCA/IGggOiAzMjAgLyAoJCQuaGFzVHlwZSgnZ2F1Z2UnKSAmJiAhY29uZmlnLmdhdWdlX2Z1bGxDaXJjbGUgPyAyIDogMSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRDdXJyZW50UGFkZGluZ1RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIHBhZGRpbmcgPSBpc1ZhbHVlKGNvbmZpZy5wYWRkaW5nX3RvcCkgPyBjb25maWcucGFkZGluZ190b3AgOiAwO1xuICAgICAgICBpZiAoJCQudGl0bGUgJiYgJCQudGl0bGUubm9kZSgpKSB7XG4gICAgICAgICAgICBwYWRkaW5nICs9ICQkLmdldFRpdGxlUGFkZGluZygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYWRkaW5nO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0Q3VycmVudFBhZGRpbmdCb3R0b20gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZztcbiAgICAgICAgcmV0dXJuIGlzVmFsdWUoY29uZmlnLnBhZGRpbmdfYm90dG9tKSA/IGNvbmZpZy5wYWRkaW5nX2JvdHRvbSA6IDA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRDdXJyZW50UGFkZGluZ0xlZnQgPSBmdW5jdGlvbiAod2l0aG91dFJlY29tcHV0ZSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICBpZiAoaXNWYWx1ZShjb25maWcucGFkZGluZ19sZWZ0KSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5wYWRkaW5nX2xlZnQ7XG4gICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLmF4aXNfcm90YXRlZCkge1xuICAgICAgICAgICAgcmV0dXJuICFjb25maWcuYXhpc194X3Nob3cgPyAxIDogTWF0aC5tYXgoY2VpbDEwKCQkLmdldEF4aXNXaWR0aEJ5QXhpc0lkKCd4Jywgd2l0aG91dFJlY29tcHV0ZSkpLCA0MCk7XG4gICAgICAgIH0gZWxzZSBpZiAoIWNvbmZpZy5heGlzX3lfc2hvdyB8fCBjb25maWcuYXhpc195X2lubmVyKSB7XG4gICAgICAgICAgICAvLyAmJiAhY29uZmlnLmF4aXNfcm90YXRlZFxuICAgICAgICAgICAgcmV0dXJuICQkLmF4aXMuZ2V0WUF4aXNMYWJlbFBvc2l0aW9uKCkuaXNPdXRlciA/IDMwIDogMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjZWlsMTAoJCQuZ2V0QXhpc1dpZHRoQnlBeGlzSWQoJ3knLCB3aXRob3V0UmVjb21wdXRlKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldEN1cnJlbnRQYWRkaW5nUmlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBkZWZhdWx0UGFkZGluZyA9IDEwLFxuICAgICAgICAgICAgbGVnZW5kV2lkdGhPblJpZ2h0ID0gJCQuaXNMZWdlbmRSaWdodCA/ICQkLmdldExlZ2VuZFdpZHRoKCkgKyAyMCA6IDA7XG4gICAgICAgIGlmIChpc1ZhbHVlKGNvbmZpZy5wYWRkaW5nX3JpZ2h0KSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5wYWRkaW5nX3JpZ2h0ICsgMTsgLy8gMSBpcyBuZWVkZWQgbm90IHRvIGhpZGUgdGljayBsaW5lXG4gICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLmF4aXNfcm90YXRlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRQYWRkaW5nICsgbGVnZW5kV2lkdGhPblJpZ2h0O1xuICAgICAgICB9IGVsc2UgaWYgKCFjb25maWcuYXhpc195Ml9zaG93IHx8IGNvbmZpZy5heGlzX3kyX2lubmVyKSB7XG4gICAgICAgICAgICAvLyAmJiAhY29uZmlnLmF4aXNfcm90YXRlZFxuICAgICAgICAgICAgcmV0dXJuIDIgKyBsZWdlbmRXaWR0aE9uUmlnaHQgKyAoJCQuYXhpcy5nZXRZMkF4aXNMYWJlbFBvc2l0aW9uKCkuaXNPdXRlciA/IDIwIDogMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gY2VpbDEwKCQkLmdldEF4aXNXaWR0aEJ5QXhpc0lkKCd5MicpKSArIGxlZ2VuZFdpZHRoT25SaWdodDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRQYXJlbnRSZWN0VmFsdWUgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLnNlbGVjdENoYXJ0Lm5vZGUoKSxcbiAgICAgICAgICAgIHY7XG4gICAgICAgIHdoaWxlIChwYXJlbnQgJiYgcGFyZW50LnRhZ05hbWUgIT09ICdCT0RZJykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB2ID0gcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpW2tleV07XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3dpZHRoJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBJbiBJRSBpbiBjZXJ0YWluIGNhc2VzIGdldEJvdW5kaW5nQ2xpZW50UmVjdFxuICAgICAgICAgICAgICAgICAgICAvLyB3aWxsIGNhdXNlIGFuIFwidW5zcGVjaWZpZWQgZXJyb3JcIlxuICAgICAgICAgICAgICAgICAgICB2ID0gcGFyZW50Lm9mZnNldFdpZHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2KSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFBhcmVudFdpZHRoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRQYXJlbnRSZWN0VmFsdWUoJ3dpZHRoJyk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRQYXJlbnRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBoID0gdGhpcy5zZWxlY3RDaGFydC5zdHlsZSgnaGVpZ2h0Jyk7XG4gICAgICAgIHJldHVybiBoLmluZGV4T2YoJ3B4JykgPiAwID8gK2gucmVwbGFjZSgncHgnLCAnJykgOiAwO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRTdmdMZWZ0ID0gZnVuY3Rpb24gKHdpdGhvdXRSZWNvbXB1dGUpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGhhc0xlZnRBeGlzUmVjdCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgfHwgIWNvbmZpZy5heGlzX3JvdGF0ZWQgJiYgIWNvbmZpZy5heGlzX3lfaW5uZXIsXG4gICAgICAgICAgICBsZWZ0QXhpc0NsYXNzID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IENMQVNTLmF4aXNYIDogQ0xBU1MuYXhpc1ksXG4gICAgICAgICAgICBsZWZ0QXhpcyA9ICQkLm1haW4uc2VsZWN0KCcuJyArIGxlZnRBeGlzQ2xhc3MpLm5vZGUoKSxcbiAgICAgICAgICAgIHN2Z1JlY3QgPSBsZWZ0QXhpcyAmJiBoYXNMZWZ0QXhpc1JlY3QgPyBsZWZ0QXhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IHsgcmlnaHQ6IDAgfSxcbiAgICAgICAgICAgIGNoYXJ0UmVjdCA9ICQkLnNlbGVjdENoYXJ0Lm5vZGUoKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIGhhc0FyYyA9ICQkLmhhc0FyY1R5cGUoKSxcbiAgICAgICAgICAgIHN2Z0xlZnQgPSBzdmdSZWN0LnJpZ2h0IC0gY2hhcnRSZWN0LmxlZnQgLSAoaGFzQXJjID8gMCA6ICQkLmdldEN1cnJlbnRQYWRkaW5nTGVmdCh3aXRob3V0UmVjb21wdXRlKSk7XG4gICAgICAgIHJldHVybiBzdmdMZWZ0ID4gMCA/IHN2Z0xlZnQgOiAwO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRBeGlzV2lkdGhCeUF4aXNJZCA9IGZ1bmN0aW9uIChpZCwgd2l0aG91dFJlY29tcHV0ZSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgcG9zaXRpb24gPSAkJC5heGlzLmdldExhYmVsUG9zaXRpb25CeUlkKGlkKTtcbiAgICAgICAgcmV0dXJuICQkLmF4aXMuZ2V0TWF4VGlja1dpZHRoKGlkLCB3aXRob3V0UmVjb21wdXRlKSArIChwb3NpdGlvbi5pc0lubmVyID8gMjAgOiA0MCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRIb3Jpem9udGFsQXhpc0hlaWdodCA9IGZ1bmN0aW9uIChheGlzSWQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGggPSAzMDtcbiAgICAgICAgaWYgKGF4aXNJZCA9PT0gJ3gnICYmICFjb25maWcuYXhpc194X3Nob3cpIHtcbiAgICAgICAgICAgIHJldHVybiA4O1xuICAgICAgICB9XG4gICAgICAgIGlmIChheGlzSWQgPT09ICd4JyAmJiBjb25maWcuYXhpc194X2hlaWdodCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5heGlzX3hfaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChheGlzSWQgPT09ICd5JyAmJiAhY29uZmlnLmF4aXNfeV9zaG93KSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmxlZ2VuZF9zaG93ICYmICEkJC5pc0xlZ2VuZFJpZ2h0ICYmICEkJC5pc0xlZ2VuZEluc2V0ID8gMTAgOiAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChheGlzSWQgPT09ICd5MicgJiYgIWNvbmZpZy5heGlzX3kyX3Nob3cpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5yb3RhdGVkX3BhZGRpbmdfdG9wO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhbGN1bGF0ZSB4IGF4aXMgaGVpZ2h0IHdoZW4gdGljayByb3RhdGVkXG4gICAgICAgIGlmIChheGlzSWQgPT09ICd4JyAmJiAhY29uZmlnLmF4aXNfcm90YXRlZCAmJiBjb25maWcuYXhpc194X3RpY2tfcm90YXRlKSB7XG4gICAgICAgICAgICBoID0gMzAgKyAkJC5heGlzLmdldE1heFRpY2tXaWR0aChheGlzSWQpICogTWF0aC5jb3MoTWF0aC5QSSAqICg5MCAtIGNvbmZpZy5heGlzX3hfdGlja19yb3RhdGUpIC8gMTgwKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDYWxjdWxhdGUgeSBheGlzIGhlaWdodCB3aGVuIHRpY2sgcm90YXRlZFxuICAgICAgICBpZiAoYXhpc0lkID09PSAneScgJiYgY29uZmlnLmF4aXNfcm90YXRlZCAmJiBjb25maWcuYXhpc195X3RpY2tfcm90YXRlKSB7XG4gICAgICAgICAgICBoID0gMzAgKyAkJC5heGlzLmdldE1heFRpY2tXaWR0aChheGlzSWQpICogTWF0aC5jb3MoTWF0aC5QSSAqICg5MCAtIGNvbmZpZy5heGlzX3lfdGlja19yb3RhdGUpIC8gMTgwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaCArICgkJC5heGlzLmdldExhYmVsUG9zaXRpb25CeUlkKGF4aXNJZCkuaXNJbm5lciA/IDAgOiAxMCkgKyAoYXhpc0lkID09PSAneTInID8gLTEwIDogMCk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldEV2ZW50UmVjdFdpZHRoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgoMCwgdGhpcy54QXhpcy50aWNrSW50ZXJ2YWwoKSk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFNoYXBlSW5kaWNlcyA9IGZ1bmN0aW9uICh0eXBlRmlsdGVyKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBpbmRpY2VzID0ge30sXG4gICAgICAgICAgICBpID0gMCxcbiAgICAgICAgICAgIGosXG4gICAgICAgICAgICBrO1xuICAgICAgICAkJC5maWx0ZXJUYXJnZXRzVG9TaG93KCQkLmRhdGEudGFyZ2V0cy5maWx0ZXIodHlwZUZpbHRlciwgJCQpKS5mb3JFYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgY29uZmlnLmRhdGFfZ3JvdXBzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5kYXRhX2dyb3Vwc1tqXS5pbmRleE9mKGQuaWQpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGNvbmZpZy5kYXRhX2dyb3Vwc1tqXS5sZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmRhdGFfZ3JvdXBzW2pdW2tdIGluIGluZGljZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGljZXNbZC5pZF0gPSBpbmRpY2VzW2NvbmZpZy5kYXRhX2dyb3Vwc1tqXVtrXV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1VuZGVmaW5lZChpbmRpY2VzW2QuaWRdKSkge1xuICAgICAgICAgICAgICAgIGluZGljZXNbZC5pZF0gPSBpKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpbmRpY2VzLl9fbWF4X18gPSBpIC0gMTtcbiAgICAgICAgcmV0dXJuIGluZGljZXM7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRTaGFwZVggPSBmdW5jdGlvbiAob2Zmc2V0LCB0YXJnZXRzTnVtLCBpbmRpY2VzLCBpc1N1Yikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgc2NhbGUgPSBpc1N1YiA/ICQkLnN1YlggOiAkJC54O1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IGQuaWQgaW4gaW5kaWNlcyA/IGluZGljZXNbZC5pZF0gOiAwO1xuICAgICAgICAgICAgcmV0dXJuIGQueCB8fCBkLnggPT09IDAgPyBzY2FsZShkLngpIC0gb2Zmc2V0ICogKHRhcmdldHNOdW0gLyAyIC0gaW5kZXgpIDogMDtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFNoYXBlWSA9IGZ1bmN0aW9uIChpc1N1Yikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciBzY2FsZSA9IGlzU3ViID8gJCQuZ2V0U3ViWVNjYWxlKGQuaWQpIDogJCQuZ2V0WVNjYWxlKGQuaWQpO1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlKGQudmFsdWUpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0U2hhcGVPZmZzZXQgPSBmdW5jdGlvbiAodHlwZUZpbHRlciwgaW5kaWNlcywgaXNTdWIpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHRhcmdldHMgPSAkJC5vcmRlclRhcmdldHMoJCQuZmlsdGVyVGFyZ2V0c1RvU2hvdygkJC5kYXRhLnRhcmdldHMuZmlsdGVyKHR5cGVGaWx0ZXIsICQkKSkpLFxuICAgICAgICAgICAgdGFyZ2V0SWRzID0gdGFyZ2V0cy5tYXAoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0LmlkO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICB2YXIgc2NhbGUgPSBpc1N1YiA/ICQkLmdldFN1YllTY2FsZShkLmlkKSA6ICQkLmdldFlTY2FsZShkLmlkKSxcbiAgICAgICAgICAgICAgICB5MCA9IHNjYWxlKDApLFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IHkwO1xuICAgICAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlcyA9ICQkLmlzU3RlcFR5cGUoZCkgPyAkJC5jb252ZXJ0VmFsdWVzVG9TdGVwKHQudmFsdWVzKSA6IHQudmFsdWVzO1xuICAgICAgICAgICAgICAgIGlmICh0LmlkID09PSBkLmlkIHx8IGluZGljZXNbdC5pZF0gIT09IGluZGljZXNbZC5pZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0SWRzLmluZGV4T2YodC5pZCkgPCB0YXJnZXRJZHMuaW5kZXhPZihkLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgeCB2YWx1ZXMgbGluZSB1cFxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1tpXSA9PT0gJ3VuZGVmaW5lZCcgfHwgK3ZhbHVlc1tpXS54ICE9PSArZC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBcIitcIiBmb3IgdGltZXNlcmllc1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm90LCB0cnkgdG8gZmluZCB0aGUgdmFsdWUgdGhhdCBkb2VzIGxpbmUgdXBcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2LCBqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYueCA9PT0gZC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBqO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChpIGluIHZhbHVlcyAmJiB2YWx1ZXNbaV0udmFsdWUgKiBkLnZhbHVlID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSBzY2FsZSh2YWx1ZXNbaV0udmFsdWUpIC0geTA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBvZmZzZXQ7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc1dpdGhpblNoYXBlID0gZnVuY3Rpb24gKHRoYXQsIGQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHNoYXBlID0gJCQuZDMuc2VsZWN0KHRoYXQpLFxuICAgICAgICAgICAgaXNXaXRoaW47XG4gICAgICAgIGlmICghJCQuaXNUYXJnZXRUb1Nob3coZC5pZCkpIHtcbiAgICAgICAgICAgIGlzV2l0aGluID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAodGhhdC5ub2RlTmFtZSA9PT0gJ2NpcmNsZScpIHtcbiAgICAgICAgICAgIGlzV2l0aGluID0gJCQuaXNTdGVwVHlwZShkKSA/ICQkLmlzV2l0aGluU3RlcCh0aGF0LCAkJC5nZXRZU2NhbGUoZC5pZCkoZC52YWx1ZSkpIDogJCQuaXNXaXRoaW5DaXJjbGUodGhhdCwgJCQucG9pbnRTZWxlY3RSKGQpICogMS41KTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGF0Lm5vZGVOYW1lID09PSAncGF0aCcpIHtcbiAgICAgICAgICAgIGlzV2l0aGluID0gc2hhcGUuY2xhc3NlZChDTEFTUy5iYXIpID8gJCQuaXNXaXRoaW5CYXIodGhhdCkgOiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc1dpdGhpbjtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0SW50ZXJwb2xhdGUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgaW50ZXJwb2xhdGlvbiA9ICQkLmlzSW50ZXJwb2xhdGlvblR5cGUoJCQuY29uZmlnLnNwbGluZV9pbnRlcnBvbGF0aW9uX3R5cGUpID8gJCQuY29uZmlnLnNwbGluZV9pbnRlcnBvbGF0aW9uX3R5cGUgOiAnY2FyZGluYWwnO1xuICAgICAgICByZXR1cm4gJCQuaXNTcGxpbmVUeXBlKGQpID8gaW50ZXJwb2xhdGlvbiA6ICQkLmlzU3RlcFR5cGUoZCkgPyAkJC5jb25maWcubGluZV9zdGVwX3R5cGUgOiBcImxpbmVhclwiO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0TGluZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MuY2hhcnQpLmFwcGVuZChcImdcIikuYXR0cihcImNsYXNzXCIsIENMQVNTLmNoYXJ0TGluZXMpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlVGFyZ2V0c0ZvckxpbmUgPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgbWFpbkxpbmVVcGRhdGUsXG4gICAgICAgICAgICBtYWluTGluZUVudGVyLFxuICAgICAgICAgICAgY2xhc3NDaGFydExpbmUgPSAkJC5jbGFzc0NoYXJ0TGluZS5iaW5kKCQkKSxcbiAgICAgICAgICAgIGNsYXNzTGluZXMgPSAkJC5jbGFzc0xpbmVzLmJpbmQoJCQpLFxuICAgICAgICAgICAgY2xhc3NBcmVhcyA9ICQkLmNsYXNzQXJlYXMuYmluZCgkJCksXG4gICAgICAgICAgICBjbGFzc0NpcmNsZXMgPSAkJC5jbGFzc0NpcmNsZXMuYmluZCgkJCksXG4gICAgICAgICAgICBjbGFzc0ZvY3VzID0gJCQuY2xhc3NGb2N1cy5iaW5kKCQkKTtcbiAgICAgICAgbWFpbkxpbmVVcGRhdGUgPSAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5jaGFydExpbmVzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuY2hhcnRMaW5lKS5kYXRhKHRhcmdldHMpLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBjbGFzc0NoYXJ0TGluZShkKSArIGNsYXNzRm9jdXMoZCk7XG4gICAgICAgIH0pO1xuICAgICAgICBtYWluTGluZUVudGVyID0gbWFpbkxpbmVVcGRhdGUuZW50ZXIoKS5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsIGNsYXNzQ2hhcnRMaW5lKS5zdHlsZSgnb3BhY2l0eScsIDApLnN0eWxlKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpO1xuICAgICAgICAvLyBMaW5lcyBmb3IgZWFjaCBkYXRhXG4gICAgICAgIG1haW5MaW5lRW50ZXIuYXBwZW5kKCdnJykuYXR0cihcImNsYXNzXCIsIGNsYXNzTGluZXMpO1xuICAgICAgICAvLyBBcmVhc1xuICAgICAgICBtYWluTGluZUVudGVyLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgY2xhc3NBcmVhcyk7XG4gICAgICAgIC8vIENpcmNsZXMgZm9yIGVhY2ggZGF0YSBwb2ludCBvbiBsaW5lc1xuICAgICAgICBtYWluTGluZUVudGVyLmFwcGVuZCgnZycpLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLmdlbmVyYXRlQ2xhc3MoQ0xBU1Muc2VsZWN0ZWRDaXJjbGVzLCBkLmlkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIG1haW5MaW5lRW50ZXIuYXBwZW5kKCdnJykuYXR0cihcImNsYXNzXCIsIGNsYXNzQ2lyY2xlcykuc3R5bGUoXCJjdXJzb3JcIiwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuZGF0YV9zZWxlY3Rpb25faXNzZWxlY3RhYmxlKGQpID8gXCJwb2ludGVyXCIgOiBudWxsO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gVXBkYXRlIGRhdGUgZm9yIHNlbGVjdGVkIGNpcmNsZXNcbiAgICAgICAgdGFyZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAkJC5tYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5zZWxlY3RlZENpcmNsZXMgKyAkJC5nZXRUYXJnZXRTZWxlY3RvclN1ZmZpeCh0LmlkKSkuc2VsZWN0QWxsKCcuJyArIENMQVNTLnNlbGVjdGVkQ2lyY2xlKS5lYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgZC52YWx1ZSA9IHQudmFsdWVzW2QuaW5kZXhdLnZhbHVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBNRU1POiBjYW4gbm90IGtlZXAgc2FtZSBjb2xvci4uLlxuICAgICAgICAvL21haW5MaW5lVXBkYXRlLmV4aXQoKS5yZW1vdmUoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZUxpbmUgPSBmdW5jdGlvbiAoZHVyYXRpb25Gb3JFeGl0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgICQkLm1haW5MaW5lID0gJCQubWFpbi5zZWxlY3RBbGwoJy4nICsgQ0xBU1MubGluZXMpLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5saW5lKS5kYXRhKCQkLmxpbmVEYXRhLmJpbmQoJCQpKTtcbiAgICAgICAgJCQubWFpbkxpbmUuZW50ZXIoKS5hcHBlbmQoJ3BhdGgnKS5hdHRyKCdjbGFzcycsICQkLmNsYXNzTGluZS5iaW5kKCQkKSkuc3R5bGUoXCJzdHJva2VcIiwgJCQuY29sb3IpO1xuICAgICAgICAkJC5tYWluTGluZS5zdHlsZShcIm9wYWNpdHlcIiwgJCQuaW5pdGlhbE9wYWNpdHkuYmluZCgkJCkpLnN0eWxlKCdzaGFwZS1yZW5kZXJpbmcnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLmlzU3RlcFR5cGUoZCkgPyAnY3Jpc3BFZGdlcycgOiAnJztcbiAgICAgICAgfSkuYXR0cigndHJhbnNmb3JtJywgbnVsbCk7XG4gICAgICAgICQkLm1haW5MaW5lLmV4aXQoKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oZHVyYXRpb25Gb3JFeGl0KS5zdHlsZSgnb3BhY2l0eScsIDApLnJlbW92ZSgpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVkcmF3TGluZSA9IGZ1bmN0aW9uIChkcmF3TGluZSwgd2l0aFRyYW5zaXRpb24pIHtcbiAgICAgICAgcmV0dXJuIFsod2l0aFRyYW5zaXRpb24gPyB0aGlzLm1haW5MaW5lLnRyYW5zaXRpb24oTWF0aC5yYW5kb20oKS50b1N0cmluZygpKSA6IHRoaXMubWFpbkxpbmUpLmF0dHIoXCJkXCIsIGRyYXdMaW5lKS5zdHlsZShcInN0cm9rZVwiLCB0aGlzLmNvbG9yKS5zdHlsZShcIm9wYWNpdHlcIiwgMSldO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2VuZXJhdGVEcmF3TGluZSA9IGZ1bmN0aW9uIChsaW5lSW5kaWNlcywgaXNTdWIpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGxpbmUgPSAkJC5kMy5zdmcubGluZSgpLFxuICAgICAgICAgICAgZ2V0UG9pbnRzID0gJCQuZ2VuZXJhdGVHZXRMaW5lUG9pbnRzKGxpbmVJbmRpY2VzLCBpc1N1YiksXG4gICAgICAgICAgICB5U2NhbGVHZXR0ZXIgPSBpc1N1YiA/ICQkLmdldFN1YllTY2FsZSA6ICQkLmdldFlTY2FsZSxcbiAgICAgICAgICAgIHhWYWx1ZSA9IGZ1bmN0aW9uIHhWYWx1ZShkKSB7XG4gICAgICAgICAgICByZXR1cm4gKGlzU3ViID8gJCQuc3VieHggOiAkJC54eCkuY2FsbCgkJCwgZCk7XG4gICAgICAgIH0sXG4gICAgICAgICAgICB5VmFsdWUgPSBmdW5jdGlvbiB5VmFsdWUoZCwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5kYXRhX2dyb3Vwcy5sZW5ndGggPiAwID8gZ2V0UG9pbnRzKGQsIGkpWzBdWzFdIDogeVNjYWxlR2V0dGVyLmNhbGwoJCQsIGQuaWQpKGQudmFsdWUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGxpbmUgPSBjb25maWcuYXhpc19yb3RhdGVkID8gbGluZS54KHlWYWx1ZSkueSh4VmFsdWUpIDogbGluZS54KHhWYWx1ZSkueSh5VmFsdWUpO1xuICAgICAgICBpZiAoIWNvbmZpZy5saW5lX2Nvbm5lY3ROdWxsKSB7XG4gICAgICAgICAgICBsaW5lID0gbGluZS5kZWZpbmVkKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQudmFsdWUgIT0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGNvbmZpZy5saW5lX2Nvbm5lY3ROdWxsID8gJCQuZmlsdGVyUmVtb3ZlTnVsbChkLnZhbHVlcykgOiBkLnZhbHVlcyxcbiAgICAgICAgICAgICAgICB4ID0gaXNTdWIgPyAkJC54IDogJCQuc3ViWCxcbiAgICAgICAgICAgICAgICB5ID0geVNjYWxlR2V0dGVyLmNhbGwoJCQsIGQuaWQpLFxuICAgICAgICAgICAgICAgIHgwID0gMCxcbiAgICAgICAgICAgICAgICB5MCA9IDAsXG4gICAgICAgICAgICAgICAgcGF0aDtcbiAgICAgICAgICAgIGlmICgkJC5pc0xpbmVUeXBlKGQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5kYXRhX3JlZ2lvbnNbZC5pZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcGF0aCA9ICQkLmxpbmVXaXRoUmVnaW9ucyh2YWx1ZXMsIHgsIHksIGNvbmZpZy5kYXRhX3JlZ2lvbnNbZC5pZF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkJC5pc1N0ZXBUeXBlKGQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSAkJC5jb252ZXJ0VmFsdWVzVG9TdGVwKHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcGF0aCA9IGxpbmUuaW50ZXJwb2xhdGUoJCQuZ2V0SW50ZXJwb2xhdGUoZCkpKHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIHgwID0geCh2YWx1ZXNbMF0ueCk7XG4gICAgICAgICAgICAgICAgICAgIHkwID0geSh2YWx1ZXNbMF0udmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwYXRoID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IFwiTSBcIiArIHkwICsgXCIgXCIgKyB4MCA6IFwiTSBcIiArIHgwICsgXCIgXCIgKyB5MDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwYXRoID8gcGF0aCA6IFwiTSAwIDBcIjtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlR2V0TGluZVBvaW50cyA9IGZ1bmN0aW9uIChsaW5lSW5kaWNlcywgaXNTdWIpIHtcbiAgICAgICAgLy8gcGFydGlhbCBkdXBsaWNhdGlvbiBvZiBnZW5lcmF0ZUdldEJhclBvaW50c1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgbGluZVRhcmdldHNOdW0gPSBsaW5lSW5kaWNlcy5fX21heF9fICsgMSxcbiAgICAgICAgICAgIHggPSAkJC5nZXRTaGFwZVgoMCwgbGluZVRhcmdldHNOdW0sIGxpbmVJbmRpY2VzLCAhIWlzU3ViKSxcbiAgICAgICAgICAgIHkgPSAkJC5nZXRTaGFwZVkoISFpc1N1YiksXG4gICAgICAgICAgICBsaW5lT2Zmc2V0ID0gJCQuZ2V0U2hhcGVPZmZzZXQoJCQuaXNMaW5lVHlwZSwgbGluZUluZGljZXMsICEhaXNTdWIpLFxuICAgICAgICAgICAgeVNjYWxlID0gaXNTdWIgPyAkJC5nZXRTdWJZU2NhbGUgOiAkJC5nZXRZU2NhbGU7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgdmFyIHkwID0geVNjYWxlLmNhbGwoJCQsIGQuaWQpKDApLFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IGxpbmVPZmZzZXQoZCwgaSkgfHwgeTAsXG4gICAgICAgICAgICAgICAgLy8gb2Zmc2V0IGlzIGZvciBzdGFja2VkIGFyZWEgY2hhcnRcbiAgICAgICAgICAgIHBvc1ggPSB4KGQpLFxuICAgICAgICAgICAgICAgIHBvc1kgPSB5KGQpO1xuICAgICAgICAgICAgLy8gZml4IHBvc1kgbm90IHRvIG92ZXJmbG93IG9wcG9zaXRlIHF1YWRyYW50XG4gICAgICAgICAgICBpZiAoY29uZmlnLmF4aXNfcm90YXRlZCkge1xuICAgICAgICAgICAgICAgIGlmICgwIDwgZC52YWx1ZSAmJiBwb3NZIDwgeTAgfHwgZC52YWx1ZSA8IDAgJiYgeTAgPCBwb3NZKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvc1kgPSB5MDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAxIHBvaW50IHRoYXQgbWFya3MgdGhlIGxpbmUgcG9zaXRpb25cbiAgICAgICAgICAgIHJldHVybiBbW3Bvc1gsIHBvc1kgLSAoeTAgLSBvZmZzZXQpXSwgW3Bvc1gsIHBvc1kgLSAoeTAgLSBvZmZzZXQpXSwgLy8gbmVlZGVkIGZvciBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBbcG9zWCwgcG9zWSAtICh5MCAtIG9mZnNldCldLCAvLyBuZWVkZWQgZm9yIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgIFtwb3NYLCBwb3NZIC0gKHkwIC0gb2Zmc2V0KV0gLy8gbmVlZGVkIGZvciBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBdO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5saW5lV2l0aFJlZ2lvbnMgPSBmdW5jdGlvbiAoZCwgeCwgeSwgX3JlZ2lvbnMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIHByZXYgPSAtMSxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBqLFxuICAgICAgICAgICAgcyA9IFwiTVwiLFxuICAgICAgICAgICAgc1dpdGhSZWdpb24sXG4gICAgICAgICAgICB4cCxcbiAgICAgICAgICAgIHlwLFxuICAgICAgICAgICAgZHgsXG4gICAgICAgICAgICBkeSxcbiAgICAgICAgICAgIGRkLFxuICAgICAgICAgICAgZGlmZixcbiAgICAgICAgICAgIGRpZmZ4MixcbiAgICAgICAgICAgIHhPZmZzZXQgPSAkJC5pc0NhdGVnb3JpemVkKCkgPyAwLjUgOiAwLFxuICAgICAgICAgICAgeFZhbHVlLFxuICAgICAgICAgICAgeVZhbHVlLFxuICAgICAgICAgICAgcmVnaW9ucyA9IFtdO1xuXG4gICAgICAgIGZ1bmN0aW9uIGlzV2l0aGluUmVnaW9ucyh4LCByZWdpb25zKSB7XG4gICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByZWdpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lvbnNbaV0uc3RhcnQgPCB4ICYmIHggPD0gcmVnaW9uc1tpXS5lbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgc3RhcnQvZW5kIG9mIHJlZ2lvbnNcbiAgICAgICAgaWYgKGlzRGVmaW5lZChfcmVnaW9ucykpIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBfcmVnaW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHJlZ2lvbnNbaV0gPSB7fTtcbiAgICAgICAgICAgICAgICBpZiAoaXNVbmRlZmluZWQoX3JlZ2lvbnNbaV0uc3RhcnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbnNbaV0uc3RhcnQgPSBkWzBdLng7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVnaW9uc1tpXS5zdGFydCA9ICQkLmlzVGltZVNlcmllcygpID8gJCQucGFyc2VEYXRlKF9yZWdpb25zW2ldLnN0YXJ0KSA6IF9yZWdpb25zW2ldLnN0YXJ0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXNVbmRlZmluZWQoX3JlZ2lvbnNbaV0uZW5kKSkge1xuICAgICAgICAgICAgICAgICAgICByZWdpb25zW2ldLmVuZCA9IGRbZC5sZW5ndGggLSAxXS54O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlZ2lvbnNbaV0uZW5kID0gJCQuaXNUaW1lU2VyaWVzKCkgPyAkJC5wYXJzZURhdGUoX3JlZ2lvbnNbaV0uZW5kKSA6IF9yZWdpb25zW2ldLmVuZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgc2NhbGVzXG4gICAgICAgIHhWYWx1ZSA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIHkoZC52YWx1ZSk7XG4gICAgICAgIH0gOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIHgoZC54KTtcbiAgICAgICAgfTtcbiAgICAgICAgeVZhbHVlID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4geChkLngpO1xuICAgICAgICB9IDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiB5KGQudmFsdWUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIERlZmluZSBzdmcgZ2VuZXJhdG9yIGZ1bmN0aW9uIGZvciByZWdpb25cbiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVNKHBvaW50cykge1xuICAgICAgICAgICAgcmV0dXJuICdNJyArIHBvaW50c1swXVswXSArICcgJyArIHBvaW50c1swXVsxXSArICcgJyArIHBvaW50c1sxXVswXSArICcgJyArIHBvaW50c1sxXVsxXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJCQuaXNUaW1lU2VyaWVzKCkpIHtcbiAgICAgICAgICAgIHNXaXRoUmVnaW9uID0gZnVuY3Rpb24gc1dpdGhSZWdpb24oZDAsIGQxLCBqLCBkaWZmKSB7XG4gICAgICAgICAgICAgICAgdmFyIHgwID0gZDAueC5nZXRUaW1lKCksXG4gICAgICAgICAgICAgICAgICAgIHhfZGlmZiA9IGQxLnggLSBkMC54LFxuICAgICAgICAgICAgICAgICAgICB4djAgPSBuZXcgRGF0ZSh4MCArIHhfZGlmZiAqIGopLFxuICAgICAgICAgICAgICAgICAgICB4djEgPSBuZXcgRGF0ZSh4MCArIHhfZGlmZiAqIChqICsgZGlmZikpLFxuICAgICAgICAgICAgICAgICAgICBwb2ludHM7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5heGlzX3JvdGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gW1t5KHlwKGopKSwgeCh4djApXSwgW3koeXAoaiArIGRpZmYpKSwgeCh4djEpXV07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gW1t4KHh2MCksIHkoeXAoaikpXSwgW3goeHYxKSwgeSh5cChqICsgZGlmZikpXV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZU0ocG9pbnRzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzV2l0aFJlZ2lvbiA9IGZ1bmN0aW9uIHNXaXRoUmVnaW9uKGQwLCBkMSwgaiwgZGlmZikge1xuICAgICAgICAgICAgICAgIHZhciBwb2ludHM7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5heGlzX3JvdGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gW1t5KHlwKGopLCB0cnVlKSwgeCh4cChqKSldLCBbeSh5cChqICsgZGlmZiksIHRydWUpLCB4KHhwKGogKyBkaWZmKSldXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSBbW3goeHAoaiksIHRydWUpLCB5KHlwKGopKV0sIFt4KHhwKGogKyBkaWZmKSwgdHJ1ZSksIHkoeXAoaiArIGRpZmYpKV1dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVNKHBvaW50cyk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGVcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGQubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgLy8gRHJhdyBhcyBub3JtYWxcbiAgICAgICAgICAgIGlmIChpc1VuZGVmaW5lZChyZWdpb25zKSB8fCAhaXNXaXRoaW5SZWdpb25zKGRbaV0ueCwgcmVnaW9ucykpIHtcbiAgICAgICAgICAgICAgICBzICs9IFwiIFwiICsgeFZhbHVlKGRbaV0pICsgXCIgXCIgKyB5VmFsdWUoZFtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBEcmF3IHdpdGggcmVnaW9uIC8vIFRPRE86IEZpeCBmb3IgaG9yaXpvdGFsIGNoYXJ0c1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHhwID0gJCQuZ2V0U2NhbGUoZFtpIC0gMV0ueCArIHhPZmZzZXQsIGRbaV0ueCArIHhPZmZzZXQsICQkLmlzVGltZVNlcmllcygpKTtcbiAgICAgICAgICAgICAgICAgICAgeXAgPSAkJC5nZXRTY2FsZShkW2kgLSAxXS52YWx1ZSwgZFtpXS52YWx1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZHggPSB4KGRbaV0ueCkgLSB4KGRbaSAtIDFdLngpO1xuICAgICAgICAgICAgICAgICAgICBkeSA9IHkoZFtpXS52YWx1ZSkgLSB5KGRbaSAtIDFdLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgZGQgPSBNYXRoLnNxcnQoTWF0aC5wb3coZHgsIDIpICsgTWF0aC5wb3coZHksIDIpKTtcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IDIgLyBkZDtcbiAgICAgICAgICAgICAgICAgICAgZGlmZngyID0gZGlmZiAqIDI7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gZGlmZjsgaiA8PSAxOyBqICs9IGRpZmZ4Mikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBzV2l0aFJlZ2lvbihkW2kgLSAxXSwgZFtpXSwgaiwgZGlmZik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBwcmV2ID0gZFtpXS54O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHM7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZUFyZWEgPSBmdW5jdGlvbiAoZHVyYXRpb25Gb3JFeGl0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBkMyA9ICQkLmQzO1xuICAgICAgICAkJC5tYWluQXJlYSA9ICQkLm1haW4uc2VsZWN0QWxsKCcuJyArIENMQVNTLmFyZWFzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuYXJlYSkuZGF0YSgkJC5saW5lRGF0YS5iaW5kKCQkKSk7XG4gICAgICAgICQkLm1haW5BcmVhLmVudGVyKCkuYXBwZW5kKCdwYXRoJykuYXR0cihcImNsYXNzXCIsICQkLmNsYXNzQXJlYS5iaW5kKCQkKSkuc3R5bGUoXCJmaWxsXCIsICQkLmNvbG9yKS5zdHlsZShcIm9wYWNpdHlcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCQub3JnQXJlYU9wYWNpdHkgPSArZDMuc2VsZWN0KHRoaXMpLnN0eWxlKCdvcGFjaXR5Jyk7cmV0dXJuIDA7XG4gICAgICAgIH0pO1xuICAgICAgICAkJC5tYWluQXJlYS5zdHlsZShcIm9wYWNpdHlcIiwgJCQub3JnQXJlYU9wYWNpdHkpO1xuICAgICAgICAkJC5tYWluQXJlYS5leGl0KCkudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uRm9yRXhpdCkuc3R5bGUoJ29wYWNpdHknLCAwKS5yZW1vdmUoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlZHJhd0FyZWEgPSBmdW5jdGlvbiAoZHJhd0FyZWEsIHdpdGhUcmFuc2l0aW9uKSB7XG4gICAgICAgIHJldHVybiBbKHdpdGhUcmFuc2l0aW9uID8gdGhpcy5tYWluQXJlYS50cmFuc2l0aW9uKE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKSkgOiB0aGlzLm1haW5BcmVhKS5hdHRyKFwiZFwiLCBkcmF3QXJlYSkuc3R5bGUoXCJmaWxsXCIsIHRoaXMuY29sb3IpLnN0eWxlKFwib3BhY2l0eVwiLCB0aGlzLm9yZ0FyZWFPcGFjaXR5KV07XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZW5lcmF0ZURyYXdBcmVhID0gZnVuY3Rpb24gKGFyZWFJbmRpY2VzLCBpc1N1Yikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgYXJlYSA9ICQkLmQzLnN2Zy5hcmVhKCksXG4gICAgICAgICAgICBnZXRQb2ludHMgPSAkJC5nZW5lcmF0ZUdldEFyZWFQb2ludHMoYXJlYUluZGljZXMsIGlzU3ViKSxcbiAgICAgICAgICAgIHlTY2FsZUdldHRlciA9IGlzU3ViID8gJCQuZ2V0U3ViWVNjYWxlIDogJCQuZ2V0WVNjYWxlLFxuICAgICAgICAgICAgeFZhbHVlID0gZnVuY3Rpb24geFZhbHVlKGQpIHtcbiAgICAgICAgICAgIHJldHVybiAoaXNTdWIgPyAkJC5zdWJ4eCA6ICQkLnh4KS5jYWxsKCQkLCBkKTtcbiAgICAgICAgfSxcbiAgICAgICAgICAgIHZhbHVlMCA9IGZ1bmN0aW9uIHZhbHVlMChkLCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmRhdGFfZ3JvdXBzLmxlbmd0aCA+IDAgPyBnZXRQb2ludHMoZCwgaSlbMF1bMV0gOiB5U2NhbGVHZXR0ZXIuY2FsbCgkJCwgZC5pZCkoJCQuZ2V0QXJlYUJhc2VWYWx1ZShkLmlkKSk7XG4gICAgICAgIH0sXG4gICAgICAgICAgICB2YWx1ZTEgPSBmdW5jdGlvbiB2YWx1ZTEoZCwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5kYXRhX2dyb3Vwcy5sZW5ndGggPiAwID8gZ2V0UG9pbnRzKGQsIGkpWzFdWzFdIDogeVNjYWxlR2V0dGVyLmNhbGwoJCQsIGQuaWQpKGQudmFsdWUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGFyZWEgPSBjb25maWcuYXhpc19yb3RhdGVkID8gYXJlYS54MCh2YWx1ZTApLngxKHZhbHVlMSkueSh4VmFsdWUpIDogYXJlYS54KHhWYWx1ZSkueTAoY29uZmlnLmFyZWFfYWJvdmUgPyAwIDogdmFsdWUwKS55MSh2YWx1ZTEpO1xuICAgICAgICBpZiAoIWNvbmZpZy5saW5lX2Nvbm5lY3ROdWxsKSB7XG4gICAgICAgICAgICBhcmVhID0gYXJlYS5kZWZpbmVkKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQudmFsdWUgIT09IG51bGw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGNvbmZpZy5saW5lX2Nvbm5lY3ROdWxsID8gJCQuZmlsdGVyUmVtb3ZlTnVsbChkLnZhbHVlcykgOiBkLnZhbHVlcyxcbiAgICAgICAgICAgICAgICB4MCA9IDAsXG4gICAgICAgICAgICAgICAgeTAgPSAwLFxuICAgICAgICAgICAgICAgIHBhdGg7XG4gICAgICAgICAgICBpZiAoJCQuaXNBcmVhVHlwZShkKSkge1xuICAgICAgICAgICAgICAgIGlmICgkJC5pc1N0ZXBUeXBlKGQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9ICQkLmNvbnZlcnRWYWx1ZXNUb1N0ZXAodmFsdWVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGF0aCA9IGFyZWEuaW50ZXJwb2xhdGUoJCQuZ2V0SW50ZXJwb2xhdGUoZCkpKHZhbHVlcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgeDAgPSAkJC54KHZhbHVlc1swXS54KTtcbiAgICAgICAgICAgICAgICAgICAgeTAgPSAkJC5nZXRZU2NhbGUoZC5pZCkodmFsdWVzWzBdLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGF0aCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyBcIk0gXCIgKyB5MCArIFwiIFwiICsgeDAgOiBcIk0gXCIgKyB4MCArIFwiIFwiICsgeTA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcGF0aCA/IHBhdGggOiBcIk0gMCAwXCI7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRBcmVhQmFzZVZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlR2V0QXJlYVBvaW50cyA9IGZ1bmN0aW9uIChhcmVhSW5kaWNlcywgaXNTdWIpIHtcbiAgICAgICAgLy8gcGFydGlhbCBkdXBsaWNhdGlvbiBvZiBnZW5lcmF0ZUdldEJhclBvaW50c1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgYXJlYVRhcmdldHNOdW0gPSBhcmVhSW5kaWNlcy5fX21heF9fICsgMSxcbiAgICAgICAgICAgIHggPSAkJC5nZXRTaGFwZVgoMCwgYXJlYVRhcmdldHNOdW0sIGFyZWFJbmRpY2VzLCAhIWlzU3ViKSxcbiAgICAgICAgICAgIHkgPSAkJC5nZXRTaGFwZVkoISFpc1N1YiksXG4gICAgICAgICAgICBhcmVhT2Zmc2V0ID0gJCQuZ2V0U2hhcGVPZmZzZXQoJCQuaXNBcmVhVHlwZSwgYXJlYUluZGljZXMsICEhaXNTdWIpLFxuICAgICAgICAgICAgeVNjYWxlID0gaXNTdWIgPyAkJC5nZXRTdWJZU2NhbGUgOiAkJC5nZXRZU2NhbGU7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgdmFyIHkwID0geVNjYWxlLmNhbGwoJCQsIGQuaWQpKDApLFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IGFyZWFPZmZzZXQoZCwgaSkgfHwgeTAsXG4gICAgICAgICAgICAgICAgLy8gb2Zmc2V0IGlzIGZvciBzdGFja2VkIGFyZWEgY2hhcnRcbiAgICAgICAgICAgIHBvc1ggPSB4KGQpLFxuICAgICAgICAgICAgICAgIHBvc1kgPSB5KGQpO1xuICAgICAgICAgICAgLy8gZml4IHBvc1kgbm90IHRvIG92ZXJmbG93IG9wcG9zaXRlIHF1YWRyYW50XG4gICAgICAgICAgICBpZiAoY29uZmlnLmF4aXNfcm90YXRlZCkge1xuICAgICAgICAgICAgICAgIGlmICgwIDwgZC52YWx1ZSAmJiBwb3NZIDwgeTAgfHwgZC52YWx1ZSA8IDAgJiYgeTAgPCBwb3NZKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvc1kgPSB5MDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAxIHBvaW50IHRoYXQgbWFya3MgdGhlIGFyZWEgcG9zaXRpb25cbiAgICAgICAgICAgIHJldHVybiBbW3Bvc1gsIG9mZnNldF0sIFtwb3NYLCBwb3NZIC0gKHkwIC0gb2Zmc2V0KV0sIFtwb3NYLCBwb3NZIC0gKHkwIC0gb2Zmc2V0KV0sIC8vIG5lZWRlZCBmb3IgY29tcGF0aWJpbGl0eVxuICAgICAgICAgICAgW3Bvc1gsIG9mZnNldF0gLy8gbmVlZGVkIGZvciBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBdO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVDaXJjbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgICQkLm1haW5DaXJjbGUgPSAkJC5tYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5jaXJjbGVzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuY2lyY2xlKS5kYXRhKCQkLmxpbmVPclNjYXR0ZXJEYXRhLmJpbmQoJCQpKTtcbiAgICAgICAgJCQubWFpbkNpcmNsZS5lbnRlcigpLmFwcGVuZChcImNpcmNsZVwiKS5hdHRyKFwiY2xhc3NcIiwgJCQuY2xhc3NDaXJjbGUuYmluZCgkJCkpLmF0dHIoXCJyXCIsICQkLnBvaW50Ui5iaW5kKCQkKSkuc3R5bGUoXCJmaWxsXCIsICQkLmNvbG9yKTtcbiAgICAgICAgJCQubWFpbkNpcmNsZS5zdHlsZShcIm9wYWNpdHlcIiwgJCQuaW5pdGlhbE9wYWNpdHlGb3JDaXJjbGUuYmluZCgkJCkpO1xuICAgICAgICAkJC5tYWluQ2lyY2xlLmV4aXQoKS5yZW1vdmUoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlZHJhd0NpcmNsZSA9IGZ1bmN0aW9uIChjeCwgY3ksIHdpdGhUcmFuc2l0aW9uKSB7XG4gICAgICAgIHZhciBzZWxlY3RlZENpcmNsZXMgPSB0aGlzLm1haW4uc2VsZWN0QWxsKCcuJyArIENMQVNTLnNlbGVjdGVkQ2lyY2xlKTtcbiAgICAgICAgcmV0dXJuIFsod2l0aFRyYW5zaXRpb24gPyB0aGlzLm1haW5DaXJjbGUudHJhbnNpdGlvbihNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCkpIDogdGhpcy5tYWluQ2lyY2xlKS5zdHlsZSgnb3BhY2l0eScsIHRoaXMub3BhY2l0eUZvckNpcmNsZS5iaW5kKHRoaXMpKS5zdHlsZShcImZpbGxcIiwgdGhpcy5jb2xvcikuYXR0cihcImN4XCIsIGN4KS5hdHRyKFwiY3lcIiwgY3kpLCAod2l0aFRyYW5zaXRpb24gPyBzZWxlY3RlZENpcmNsZXMudHJhbnNpdGlvbihNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCkpIDogc2VsZWN0ZWRDaXJjbGVzKS5hdHRyKFwiY3hcIiwgY3gpLmF0dHIoXCJjeVwiLCBjeSldO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2lyY2xlWCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBkLnggfHwgZC54ID09PSAwID8gdGhpcy54KGQueCkgOiBudWxsO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlQ2lyY2xlWSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGxpbmVJbmRpY2VzLFxuICAgICAgICAgICAgZ2V0UG9pbnRzO1xuICAgICAgICBpZiAoJCQuY29uZmlnLmRhdGFfZ3JvdXBzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxpbmVJbmRpY2VzID0gJCQuZ2V0U2hhcGVJbmRpY2VzKCQkLmlzTGluZVR5cGUpLCBnZXRQb2ludHMgPSAkJC5nZW5lcmF0ZUdldExpbmVQb2ludHMobGluZUluZGljZXMpO1xuICAgICAgICAgICAgJCQuY2lyY2xlWSA9IGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFBvaW50cyhkLCBpKVswXVsxXTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkJC5jaXJjbGVZID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJCQuZ2V0WVNjYWxlKGQuaWQpKGQudmFsdWUpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0Q2lyY2xlcyA9IGZ1bmN0aW9uIChpLCBpZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGlkID8gJCQubWFpbi5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuY2lyY2xlcyArICQkLmdldFRhcmdldFNlbGVjdG9yU3VmZml4KGlkKSkgOiAkJC5tYWluKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuY2lyY2xlICsgKGlzVmFsdWUoaSkgPyAnLScgKyBpIDogJycpKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmV4cGFuZENpcmNsZXMgPSBmdW5jdGlvbiAoaSwgaWQsIHJlc2V0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICByID0gJCQucG9pbnRFeHBhbmRlZFIuYmluZCgkJCk7XG4gICAgICAgIGlmIChyZXNldCkge1xuICAgICAgICAgICAgJCQudW5leHBhbmRDaXJjbGVzKCk7XG4gICAgICAgIH1cbiAgICAgICAgJCQuZ2V0Q2lyY2xlcyhpLCBpZCkuY2xhc3NlZChDTEFTUy5FWFBBTkRFRCwgdHJ1ZSkuYXR0cigncicsIHIpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udW5leHBhbmRDaXJjbGVzID0gZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHIgPSAkJC5wb2ludFIuYmluZCgkJCk7XG4gICAgICAgICQkLmdldENpcmNsZXMoaSkuZmlsdGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5kMy5zZWxlY3QodGhpcykuY2xhc3NlZChDTEFTUy5FWFBBTkRFRCk7XG4gICAgICAgIH0pLmNsYXNzZWQoQ0xBU1MuRVhQQU5ERUQsIGZhbHNlKS5hdHRyKCdyJywgcik7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5wb2ludFIgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICByZXR1cm4gJCQuaXNTdGVwVHlwZShkKSA/IDAgOiBpc0Z1bmN0aW9uKGNvbmZpZy5wb2ludF9yKSA/IGNvbmZpZy5wb2ludF9yKGQpIDogY29uZmlnLnBvaW50X3I7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5wb2ludEV4cGFuZGVkUiA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIHJldHVybiBjb25maWcucG9pbnRfZm9jdXNfZXhwYW5kX2VuYWJsZWQgPyBjb25maWcucG9pbnRfZm9jdXNfZXhwYW5kX3IgPyBjb25maWcucG9pbnRfZm9jdXNfZXhwYW5kX3IgOiAkJC5wb2ludFIoZCkgKiAxLjc1IDogJCQucG9pbnRSKGQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucG9pbnRTZWxlY3RSID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgcmV0dXJuIGlzRnVuY3Rpb24oY29uZmlnLnBvaW50X3NlbGVjdF9yKSA/IGNvbmZpZy5wb2ludF9zZWxlY3RfcihkKSA6IGNvbmZpZy5wb2ludF9zZWxlY3RfciA/IGNvbmZpZy5wb2ludF9zZWxlY3RfciA6ICQkLnBvaW50UihkKSAqIDQ7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc1dpdGhpbkNpcmNsZSA9IGZ1bmN0aW9uICh0aGF0LCByKSB7XG4gICAgICAgIHZhciBkMyA9IHRoaXMuZDMsXG4gICAgICAgICAgICBtb3VzZSA9IGQzLm1vdXNlKHRoYXQpLFxuICAgICAgICAgICAgZDNfdGhpcyA9IGQzLnNlbGVjdCh0aGF0KSxcbiAgICAgICAgICAgIGN4ID0gK2QzX3RoaXMuYXR0cihcImN4XCIpLFxuICAgICAgICAgICAgY3kgPSArZDNfdGhpcy5hdHRyKFwiY3lcIik7XG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3coY3ggLSBtb3VzZVswXSwgMikgKyBNYXRoLnBvdyhjeSAtIG1vdXNlWzFdLCAyKSkgPCByO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNXaXRoaW5TdGVwID0gZnVuY3Rpb24gKHRoYXQsIHkpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguYWJzKHkgLSB0aGlzLmQzLm1vdXNlKHRoYXQpWzFdKSA8IDMwO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0QmFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5jaGFydCkuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MuY2hhcnRCYXJzKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVRhcmdldHNGb3JCYXIgPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgbWFpbkJhclVwZGF0ZSxcbiAgICAgICAgICAgIG1haW5CYXJFbnRlcixcbiAgICAgICAgICAgIGNsYXNzQ2hhcnRCYXIgPSAkJC5jbGFzc0NoYXJ0QmFyLmJpbmQoJCQpLFxuICAgICAgICAgICAgY2xhc3NCYXJzID0gJCQuY2xhc3NCYXJzLmJpbmQoJCQpLFxuICAgICAgICAgICAgY2xhc3NGb2N1cyA9ICQkLmNsYXNzRm9jdXMuYmluZCgkJCk7XG4gICAgICAgIG1haW5CYXJVcGRhdGUgPSAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5jaGFydEJhcnMpLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5jaGFydEJhcikuZGF0YSh0YXJnZXRzKS5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gY2xhc3NDaGFydEJhcihkKSArIGNsYXNzRm9jdXMoZCk7XG4gICAgICAgIH0pO1xuICAgICAgICBtYWluQmFyRW50ZXIgPSBtYWluQmFyVXBkYXRlLmVudGVyKCkuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCBjbGFzc0NoYXJ0QmFyKS5zdHlsZSgnb3BhY2l0eScsIDApLnN0eWxlKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpO1xuICAgICAgICAvLyBCYXJzIGZvciBlYWNoIGRhdGFcbiAgICAgICAgbWFpbkJhckVudGVyLmFwcGVuZCgnZycpLmF0dHIoXCJjbGFzc1wiLCBjbGFzc0JhcnMpLnN0eWxlKFwiY3Vyc29yXCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmRhdGFfc2VsZWN0aW9uX2lzc2VsZWN0YWJsZShkKSA/IFwicG9pbnRlclwiIDogbnVsbDtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVCYXIgPSBmdW5jdGlvbiAoZHVyYXRpb25Gb3JFeGl0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBiYXJEYXRhID0gJCQuYmFyRGF0YS5iaW5kKCQkKSxcbiAgICAgICAgICAgIGNsYXNzQmFyID0gJCQuY2xhc3NCYXIuYmluZCgkJCksXG4gICAgICAgICAgICBpbml0aWFsT3BhY2l0eSA9ICQkLmluaXRpYWxPcGFjaXR5LmJpbmQoJCQpLFxuICAgICAgICAgICAgY29sb3IgPSBmdW5jdGlvbiBjb2xvcihkKSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuY29sb3IoZC5pZCk7XG4gICAgICAgIH07XG4gICAgICAgICQkLm1haW5CYXIgPSAkJC5tYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5iYXJzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuYmFyKS5kYXRhKGJhckRhdGEpO1xuICAgICAgICAkJC5tYWluQmFyLmVudGVyKCkuYXBwZW5kKCdwYXRoJykuYXR0cihcImNsYXNzXCIsIGNsYXNzQmFyKS5zdHlsZShcInN0cm9rZVwiLCBjb2xvcikuc3R5bGUoXCJmaWxsXCIsIGNvbG9yKTtcbiAgICAgICAgJCQubWFpbkJhci5zdHlsZShcIm9wYWNpdHlcIiwgaW5pdGlhbE9wYWNpdHkpO1xuICAgICAgICAkJC5tYWluQmFyLmV4aXQoKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oZHVyYXRpb25Gb3JFeGl0KS5zdHlsZSgnb3BhY2l0eScsIDApLnJlbW92ZSgpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVkcmF3QmFyID0gZnVuY3Rpb24gKGRyYXdCYXIsIHdpdGhUcmFuc2l0aW9uKSB7XG4gICAgICAgIHJldHVybiBbKHdpdGhUcmFuc2l0aW9uID8gdGhpcy5tYWluQmFyLnRyYW5zaXRpb24oTWF0aC5yYW5kb20oKS50b1N0cmluZygpKSA6IHRoaXMubWFpbkJhcikuYXR0cignZCcsIGRyYXdCYXIpLnN0eWxlKFwiZmlsbFwiLCB0aGlzLmNvbG9yKS5zdHlsZShcIm9wYWNpdHlcIiwgMSldO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0QmFyVyA9IGZ1bmN0aW9uIChheGlzLCBiYXJUYXJnZXRzTnVtKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB3ID0gdHlwZW9mIGNvbmZpZy5iYXJfd2lkdGggPT09ICdudW1iZXInID8gY29uZmlnLmJhcl93aWR0aCA6IGJhclRhcmdldHNOdW0gPyBheGlzLnRpY2tJbnRlcnZhbCgpICogY29uZmlnLmJhcl93aWR0aF9yYXRpbyAvIGJhclRhcmdldHNOdW0gOiAwO1xuICAgICAgICByZXR1cm4gY29uZmlnLmJhcl93aWR0aF9tYXggJiYgdyA+IGNvbmZpZy5iYXJfd2lkdGhfbWF4ID8gY29uZmlnLmJhcl93aWR0aF9tYXggOiB3O1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0QmFycyA9IGZ1bmN0aW9uIChpLCBpZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gKGlkID8gJCQubWFpbi5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuYmFycyArICQkLmdldFRhcmdldFNlbGVjdG9yU3VmZml4KGlkKSkgOiAkJC5tYWluKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuYmFyICsgKGlzVmFsdWUoaSkgPyAnLScgKyBpIDogJycpKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmV4cGFuZEJhcnMgPSBmdW5jdGlvbiAoaSwgaWQsIHJlc2V0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIGlmIChyZXNldCkge1xuICAgICAgICAgICAgJCQudW5leHBhbmRCYXJzKCk7XG4gICAgICAgIH1cbiAgICAgICAgJCQuZ2V0QmFycyhpLCBpZCkuY2xhc3NlZChDTEFTUy5FWFBBTkRFRCwgdHJ1ZSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51bmV4cGFuZEJhcnMgPSBmdW5jdGlvbiAoaSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICAkJC5nZXRCYXJzKGkpLmNsYXNzZWQoQ0xBU1MuRVhQQU5ERUQsIGZhbHNlKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlRHJhd0JhciA9IGZ1bmN0aW9uIChiYXJJbmRpY2VzLCBpc1N1Yikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgZ2V0UG9pbnRzID0gJCQuZ2VuZXJhdGVHZXRCYXJQb2ludHMoYmFySW5kaWNlcywgaXNTdWIpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIC8vIDQgcG9pbnRzIHRoYXQgbWFrZSBhIGJhclxuICAgICAgICAgICAgdmFyIHBvaW50cyA9IGdldFBvaW50cyhkLCBpKTtcblxuICAgICAgICAgICAgLy8gc3dpdGNoIHBvaW50cyBpZiBheGlzIGlzIHJvdGF0ZWQsIG5vdCBhcHBsaWNhYmxlIGZvciBzdWIgY2hhcnRcbiAgICAgICAgICAgIHZhciBpbmRleFggPSBjb25maWcuYXhpc19yb3RhdGVkID8gMSA6IDA7XG4gICAgICAgICAgICB2YXIgaW5kZXhZID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IDAgOiAxO1xuXG4gICAgICAgICAgICB2YXIgcGF0aCA9ICdNICcgKyBwb2ludHNbMF1baW5kZXhYXSArICcsJyArIHBvaW50c1swXVtpbmRleFldICsgJyAnICsgJ0wnICsgcG9pbnRzWzFdW2luZGV4WF0gKyAnLCcgKyBwb2ludHNbMV1baW5kZXhZXSArICcgJyArICdMJyArIHBvaW50c1syXVtpbmRleFhdICsgJywnICsgcG9pbnRzWzJdW2luZGV4WV0gKyAnICcgKyAnTCcgKyBwb2ludHNbM11baW5kZXhYXSArICcsJyArIHBvaW50c1szXVtpbmRleFldICsgJyAnICsgJ3onO1xuXG4gICAgICAgICAgICByZXR1cm4gcGF0aDtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlR2V0QmFyUG9pbnRzID0gZnVuY3Rpb24gKGJhckluZGljZXMsIGlzU3ViKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBheGlzID0gaXNTdWIgPyAkJC5zdWJYQXhpcyA6ICQkLnhBeGlzLFxuICAgICAgICAgICAgYmFyVGFyZ2V0c051bSA9IGJhckluZGljZXMuX19tYXhfXyArIDEsXG4gICAgICAgICAgICBiYXJXID0gJCQuZ2V0QmFyVyhheGlzLCBiYXJUYXJnZXRzTnVtKSxcbiAgICAgICAgICAgIGJhclggPSAkJC5nZXRTaGFwZVgoYmFyVywgYmFyVGFyZ2V0c051bSwgYmFySW5kaWNlcywgISFpc1N1YiksXG4gICAgICAgICAgICBiYXJZID0gJCQuZ2V0U2hhcGVZKCEhaXNTdWIpLFxuICAgICAgICAgICAgYmFyT2Zmc2V0ID0gJCQuZ2V0U2hhcGVPZmZzZXQoJCQuaXNCYXJUeXBlLCBiYXJJbmRpY2VzLCAhIWlzU3ViKSxcbiAgICAgICAgICAgIHlTY2FsZSA9IGlzU3ViID8gJCQuZ2V0U3ViWVNjYWxlIDogJCQuZ2V0WVNjYWxlO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIHZhciB5MCA9IHlTY2FsZS5jYWxsKCQkLCBkLmlkKSgwKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBiYXJPZmZzZXQoZCwgaSkgfHwgeTAsXG4gICAgICAgICAgICAgICAgLy8gb2Zmc2V0IGlzIGZvciBzdGFja2VkIGJhciBjaGFydFxuICAgICAgICAgICAgcG9zWCA9IGJhclgoZCksXG4gICAgICAgICAgICAgICAgcG9zWSA9IGJhclkoZCk7XG4gICAgICAgICAgICAvLyBmaXggcG9zWSBub3QgdG8gb3ZlcmZsb3cgb3Bwb3NpdGUgcXVhZHJhbnRcbiAgICAgICAgICAgIGlmICgkJC5jb25maWcuYXhpc19yb3RhdGVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKDAgPCBkLnZhbHVlICYmIHBvc1kgPCB5MCB8fCBkLnZhbHVlIDwgMCAmJiB5MCA8IHBvc1kpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zWSA9IHkwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIDQgcG9pbnRzIHRoYXQgbWFrZSBhIGJhclxuICAgICAgICAgICAgcmV0dXJuIFtbcG9zWCwgb2Zmc2V0XSwgW3Bvc1gsIHBvc1kgLSAoeTAgLSBvZmZzZXQpXSwgW3Bvc1ggKyBiYXJXLCBwb3NZIC0gKHkwIC0gb2Zmc2V0KV0sIFtwb3NYICsgYmFyVywgb2Zmc2V0XV07XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc1dpdGhpbkJhciA9IGZ1bmN0aW9uICh0aGF0KSB7XG4gICAgICAgIHZhciBtb3VzZSA9IHRoaXMuZDMubW91c2UodGhhdCksXG4gICAgICAgICAgICBib3ggPSB0aGF0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgc2VnMCA9IHRoYXQucGF0aFNlZ0xpc3QuZ2V0SXRlbSgwKSxcbiAgICAgICAgICAgIHNlZzEgPSB0aGF0LnBhdGhTZWdMaXN0LmdldEl0ZW0oMSksXG4gICAgICAgICAgICB4ID0gTWF0aC5taW4oc2VnMC54LCBzZWcxLngpLFxuICAgICAgICAgICAgeSA9IE1hdGgubWluKHNlZzAueSwgc2VnMS55KSxcbiAgICAgICAgICAgIHcgPSBib3gud2lkdGgsXG4gICAgICAgICAgICBoID0gYm94LmhlaWdodCxcbiAgICAgICAgICAgIG9mZnNldCA9IDIsXG4gICAgICAgICAgICBzeCA9IHggLSBvZmZzZXQsXG4gICAgICAgICAgICBleCA9IHggKyB3ICsgb2Zmc2V0LFxuICAgICAgICAgICAgc3kgPSB5ICsgaCArIG9mZnNldCxcbiAgICAgICAgICAgIGV5ID0geSAtIG9mZnNldDtcbiAgICAgICAgcmV0dXJuIHN4IDwgbW91c2VbMF0gJiYgbW91c2VbMF0gPCBleCAmJiBleSA8IG1vdXNlWzFdICYmIG1vdXNlWzFdIDwgc3k7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmluaXRUZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5jaGFydCkuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MuY2hhcnRUZXh0cyk7XG4gICAgICAgICQkLm1haW5UZXh0ID0gJCQuZDMuc2VsZWN0QWxsKFtdKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVRhcmdldHNGb3JUZXh0ID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIG1haW5UZXh0VXBkYXRlLFxuICAgICAgICAgICAgbWFpblRleHRFbnRlcixcbiAgICAgICAgICAgIGNsYXNzQ2hhcnRUZXh0ID0gJCQuY2xhc3NDaGFydFRleHQuYmluZCgkJCksXG4gICAgICAgICAgICBjbGFzc1RleHRzID0gJCQuY2xhc3NUZXh0cy5iaW5kKCQkKSxcbiAgICAgICAgICAgIGNsYXNzRm9jdXMgPSAkJC5jbGFzc0ZvY3VzLmJpbmQoJCQpO1xuICAgICAgICBtYWluVGV4dFVwZGF0ZSA9ICQkLm1haW4uc2VsZWN0KCcuJyArIENMQVNTLmNoYXJ0VGV4dHMpLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5jaGFydFRleHQpLmRhdGEodGFyZ2V0cykuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNsYXNzQ2hhcnRUZXh0KGQpICsgY2xhc3NGb2N1cyhkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIG1haW5UZXh0RW50ZXIgPSBtYWluVGV4dFVwZGF0ZS5lbnRlcigpLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgY2xhc3NDaGFydFRleHQpLnN0eWxlKCdvcGFjaXR5JywgMCkuc3R5bGUoXCJwb2ludGVyLWV2ZW50c1wiLCBcIm5vbmVcIik7XG4gICAgICAgIG1haW5UZXh0RW50ZXIuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCBjbGFzc1RleHRzKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVRleHQgPSBmdW5jdGlvbiAoZHVyYXRpb25Gb3JFeGl0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBiYXJPckxpbmVEYXRhID0gJCQuYmFyT3JMaW5lRGF0YS5iaW5kKCQkKSxcbiAgICAgICAgICAgIGNsYXNzVGV4dCA9ICQkLmNsYXNzVGV4dC5iaW5kKCQkKTtcbiAgICAgICAgJCQubWFpblRleHQgPSAkJC5tYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy50ZXh0cykuc2VsZWN0QWxsKCcuJyArIENMQVNTLnRleHQpLmRhdGEoYmFyT3JMaW5lRGF0YSk7XG4gICAgICAgICQkLm1haW5UZXh0LmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cihcImNsYXNzXCIsIGNsYXNzVGV4dCkuYXR0cigndGV4dC1hbmNob3InLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyBkLnZhbHVlIDwgMCA/ICdlbmQnIDogJ3N0YXJ0JyA6ICdtaWRkbGUnO1xuICAgICAgICB9KS5zdHlsZShcInN0cm9rZVwiLCAnbm9uZScpLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLmNvbG9yKGQpO1xuICAgICAgICB9KS5zdHlsZShcImZpbGwtb3BhY2l0eVwiLCAwKTtcbiAgICAgICAgJCQubWFpblRleHQudGV4dChmdW5jdGlvbiAoZCwgaSwgaikge1xuICAgICAgICAgICAgcmV0dXJuICQkLmRhdGFMYWJlbEZvcm1hdChkLmlkKShkLnZhbHVlLCBkLmlkLCBpLCBqKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQkLm1haW5UZXh0LmV4aXQoKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oZHVyYXRpb25Gb3JFeGl0KS5zdHlsZSgnZmlsbC1vcGFjaXR5JywgMCkucmVtb3ZlKCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5yZWRyYXdUZXh0ID0gZnVuY3Rpb24gKHhGb3JUZXh0LCB5Rm9yVGV4dCwgZm9yRmxvdywgd2l0aFRyYW5zaXRpb24pIHtcbiAgICAgICAgcmV0dXJuIFsod2l0aFRyYW5zaXRpb24gPyB0aGlzLm1haW5UZXh0LnRyYW5zaXRpb24oKSA6IHRoaXMubWFpblRleHQpLmF0dHIoJ3gnLCB4Rm9yVGV4dCkuYXR0cigneScsIHlGb3JUZXh0KS5zdHlsZShcImZpbGxcIiwgdGhpcy5jb2xvcikuc3R5bGUoXCJmaWxsLW9wYWNpdHlcIiwgZm9yRmxvdyA/IDAgOiB0aGlzLm9wYWNpdHlGb3JUZXh0LmJpbmQodGhpcykpXTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFRleHRSZWN0ID0gZnVuY3Rpb24gKHRleHQsIGNscywgZWxlbWVudCkge1xuICAgICAgICB2YXIgZHVtbXkgPSB0aGlzLmQzLnNlbGVjdCgnYm9keScpLmFwcGVuZCgnZGl2JykuY2xhc3NlZCgnYzMnLCB0cnVlKSxcbiAgICAgICAgICAgIHN2ZyA9IGR1bW15LmFwcGVuZChcInN2Z1wiKS5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKS5zdHlsZSgncG9zaXRpb24nLCAnZml4ZWQnKS5zdHlsZSgndG9wJywgMCkuc3R5bGUoJ2xlZnQnLCAwKSxcbiAgICAgICAgICAgIGZvbnQgPSB0aGlzLmQzLnNlbGVjdChlbGVtZW50KS5zdHlsZSgnZm9udCcpLFxuICAgICAgICAgICAgcmVjdDtcbiAgICAgICAgc3ZnLnNlbGVjdEFsbCgnLmR1bW15JykuZGF0YShbdGV4dF0pLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuY2xhc3NlZChjbHMgPyBjbHMgOiBcIlwiLCB0cnVlKS5zdHlsZSgnZm9udCcsIGZvbnQpLnRleHQodGV4dCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZWN0ID0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGR1bW15LnJlbW92ZSgpO1xuICAgICAgICByZXR1cm4gcmVjdDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlWFlGb3JUZXh0ID0gZnVuY3Rpb24gKGFyZWFJbmRpY2VzLCBiYXJJbmRpY2VzLCBsaW5lSW5kaWNlcywgZm9yWCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZ2V0QXJlYVBvaW50cyA9ICQkLmdlbmVyYXRlR2V0QXJlYVBvaW50cyhhcmVhSW5kaWNlcywgZmFsc2UpLFxuICAgICAgICAgICAgZ2V0QmFyUG9pbnRzID0gJCQuZ2VuZXJhdGVHZXRCYXJQb2ludHMoYmFySW5kaWNlcywgZmFsc2UpLFxuICAgICAgICAgICAgZ2V0TGluZVBvaW50cyA9ICQkLmdlbmVyYXRlR2V0TGluZVBvaW50cyhsaW5lSW5kaWNlcywgZmFsc2UpLFxuICAgICAgICAgICAgZ2V0dGVyID0gZm9yWCA/ICQkLmdldFhGb3JUZXh0IDogJCQuZ2V0WUZvclRleHQ7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgdmFyIGdldFBvaW50cyA9ICQkLmlzQXJlYVR5cGUoZCkgPyBnZXRBcmVhUG9pbnRzIDogJCQuaXNCYXJUeXBlKGQpID8gZ2V0QmFyUG9pbnRzIDogZ2V0TGluZVBvaW50cztcbiAgICAgICAgICAgIHJldHVybiBnZXR0ZXIuY2FsbCgkJCwgZ2V0UG9pbnRzKGQsIGkpLCBkLCB0aGlzKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFhGb3JUZXh0ID0gZnVuY3Rpb24gKHBvaW50cywgZCwgdGV4dEVsZW1lbnQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGJveCA9IHRleHRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgeFBvcyxcbiAgICAgICAgICAgIHBhZGRpbmc7XG4gICAgICAgIGlmICgkJC5jb25maWcuYXhpc19yb3RhdGVkKSB7XG4gICAgICAgICAgICBwYWRkaW5nID0gJCQuaXNCYXJUeXBlKGQpID8gNCA6IDY7XG4gICAgICAgICAgICB4UG9zID0gcG9pbnRzWzJdWzFdICsgcGFkZGluZyAqIChkLnZhbHVlIDwgMCA/IC0xIDogMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB4UG9zID0gJCQuaGFzVHlwZSgnYmFyJykgPyAocG9pbnRzWzJdWzBdICsgcG9pbnRzWzBdWzBdKSAvIDIgOiBwb2ludHNbMF1bMF07XG4gICAgICAgIH1cbiAgICAgICAgLy8gc2hvdyBsYWJlbHMgcmVnYXJkbGVzcyBvZiB0aGUgZG9tYWluIGlmIHZhbHVlIGlzIG51bGxcbiAgICAgICAgaWYgKGQudmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGlmICh4UG9zID4gJCQud2lkdGgpIHtcbiAgICAgICAgICAgICAgICB4UG9zID0gJCQud2lkdGggLSBib3gud2lkdGg7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHhQb3MgPCAwKSB7XG4gICAgICAgICAgICAgICAgeFBvcyA9IDQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHhQb3M7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRZRm9yVGV4dCA9IGZ1bmN0aW9uIChwb2ludHMsIGQsIHRleHRFbGVtZW50KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBib3ggPSB0ZXh0RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIHlQb3M7XG4gICAgICAgIGlmICgkJC5jb25maWcuYXhpc19yb3RhdGVkKSB7XG4gICAgICAgICAgICB5UG9zID0gKHBvaW50c1swXVswXSArIHBvaW50c1syXVswXSArIGJveC5oZWlnaHQgKiAwLjYpIC8gMjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHlQb3MgPSBwb2ludHNbMl1bMV07XG4gICAgICAgICAgICBpZiAoZC52YWx1ZSA8IDAgfHwgZC52YWx1ZSA9PT0gMCAmJiAhJCQuaGFzUG9zaXRpdmVWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHlQb3MgKz0gYm94LmhlaWdodDtcbiAgICAgICAgICAgICAgICBpZiAoJCQuaXNCYXJUeXBlKGQpICYmICQkLmlzU2FmYXJpKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgeVBvcyAtPSAzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoISQkLmlzQmFyVHlwZShkKSAmJiAkJC5pc0Nocm9tZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHlQb3MgKz0gMztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHlQb3MgKz0gJCQuaXNCYXJUeXBlKGQpID8gLTMgOiAtNjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBzaG93IGxhYmVscyByZWdhcmRsZXNzIG9mIHRoZSBkb21haW4gaWYgdmFsdWUgaXMgbnVsbFxuICAgICAgICBpZiAoZC52YWx1ZSA9PT0gbnVsbCAmJiAhJCQuY29uZmlnLmF4aXNfcm90YXRlZCkge1xuICAgICAgICAgICAgaWYgKHlQb3MgPCBib3guaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgeVBvcyA9IGJveC5oZWlnaHQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHlQb3MgPiB0aGlzLmhlaWdodCkge1xuICAgICAgICAgICAgICAgIHlQb3MgPSB0aGlzLmhlaWdodCAtIDQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHlQb3M7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnNldFRhcmdldFR5cGUgPSBmdW5jdGlvbiAodGFyZ2V0SWRzLCB0eXBlKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgICQkLm1hcFRvVGFyZ2V0SWRzKHRhcmdldElkcykuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICQkLndpdGhvdXRGYWRlSW5baWRdID0gdHlwZSA9PT0gY29uZmlnLmRhdGFfdHlwZXNbaWRdO1xuICAgICAgICAgICAgY29uZmlnLmRhdGFfdHlwZXNbaWRdID0gdHlwZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghdGFyZ2V0SWRzKSB7XG4gICAgICAgICAgICBjb25maWcuZGF0YV90eXBlID0gdHlwZTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaGFzVHlwZSA9IGZ1bmN0aW9uICh0eXBlLCB0YXJnZXRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICB0eXBlcyA9ICQkLmNvbmZpZy5kYXRhX3R5cGVzLFxuICAgICAgICAgICAgaGFzID0gZmFsc2U7XG4gICAgICAgIHRhcmdldHMgPSB0YXJnZXRzIHx8ICQkLmRhdGEudGFyZ2V0cztcbiAgICAgICAgaWYgKHRhcmdldHMgJiYgdGFyZ2V0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRhcmdldHMuZm9yRWFjaChmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSB0eXBlc1t0YXJnZXQuaWRdO1xuICAgICAgICAgICAgICAgIGlmICh0ICYmIHQuaW5kZXhPZih0eXBlKSA+PSAwIHx8ICF0ICYmIHR5cGUgPT09ICdsaW5lJykge1xuICAgICAgICAgICAgICAgICAgICBoYXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKE9iamVjdC5rZXlzKHR5cGVzKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHR5cGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlc1tpZF0gPT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhhcyA9ICQkLmNvbmZpZy5kYXRhX3R5cGUgPT09IHR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGhhcztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmhhc0FyY1R5cGUgPSBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXNUeXBlKCdwaWUnLCB0YXJnZXRzKSB8fCB0aGlzLmhhc1R5cGUoJ2RvbnV0JywgdGFyZ2V0cykgfHwgdGhpcy5oYXNUeXBlKCdnYXVnZScsIHRhcmdldHMpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNMaW5lVHlwZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZyxcbiAgICAgICAgICAgIGlkID0gaXNTdHJpbmcoZCkgPyBkIDogZC5pZDtcbiAgICAgICAgcmV0dXJuICFjb25maWcuZGF0YV90eXBlc1tpZF0gfHwgWydsaW5lJywgJ3NwbGluZScsICdhcmVhJywgJ2FyZWEtc3BsaW5lJywgJ3N0ZXAnLCAnYXJlYS1zdGVwJ10uaW5kZXhPZihjb25maWcuZGF0YV90eXBlc1tpZF0pID49IDA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc1N0ZXBUeXBlID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIGlkID0gaXNTdHJpbmcoZCkgPyBkIDogZC5pZDtcbiAgICAgICAgcmV0dXJuIFsnc3RlcCcsICdhcmVhLXN0ZXAnXS5pbmRleE9mKHRoaXMuY29uZmlnLmRhdGFfdHlwZXNbaWRdKSA+PSAwO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNTcGxpbmVUeXBlID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIGlkID0gaXNTdHJpbmcoZCkgPyBkIDogZC5pZDtcbiAgICAgICAgcmV0dXJuIFsnc3BsaW5lJywgJ2FyZWEtc3BsaW5lJ10uaW5kZXhPZih0aGlzLmNvbmZpZy5kYXRhX3R5cGVzW2lkXSkgPj0gMDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzQXJlYVR5cGUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgaWQgPSBpc1N0cmluZyhkKSA/IGQgOiBkLmlkO1xuICAgICAgICByZXR1cm4gWydhcmVhJywgJ2FyZWEtc3BsaW5lJywgJ2FyZWEtc3RlcCddLmluZGV4T2YodGhpcy5jb25maWcuZGF0YV90eXBlc1tpZF0pID49IDA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc0JhclR5cGUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgaWQgPSBpc1N0cmluZyhkKSA/IGQgOiBkLmlkO1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuZGF0YV90eXBlc1tpZF0gPT09ICdiYXInO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNTY2F0dGVyVHlwZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciBpZCA9IGlzU3RyaW5nKGQpID8gZCA6IGQuaWQ7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5kYXRhX3R5cGVzW2lkXSA9PT0gJ3NjYXR0ZXInO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNQaWVUeXBlID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIGlkID0gaXNTdHJpbmcoZCkgPyBkIDogZC5pZDtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmRhdGFfdHlwZXNbaWRdID09PSAncGllJztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzR2F1Z2VUeXBlID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIGlkID0gaXNTdHJpbmcoZCkgPyBkIDogZC5pZDtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmRhdGFfdHlwZXNbaWRdID09PSAnZ2F1Z2UnO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNEb251dFR5cGUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgaWQgPSBpc1N0cmluZyhkKSA/IGQgOiBkLmlkO1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuZGF0YV90eXBlc1tpZF0gPT09ICdkb251dCc7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc0FyY1R5cGUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc1BpZVR5cGUoZCkgfHwgdGhpcy5pc0RvbnV0VHlwZShkKSB8fCB0aGlzLmlzR2F1Z2VUeXBlKGQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ubGluZURhdGEgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0xpbmVUeXBlKGQpID8gW2RdIDogW107XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5hcmNEYXRhID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNBcmNUeXBlKGQuZGF0YSkgPyBbZF0gOiBbXTtcbiAgICB9O1xuICAgIC8qIG5vdCB1c2VkXG4gICAgIGZ1bmN0aW9uIHNjYXR0ZXJEYXRhKGQpIHtcbiAgICAgcmV0dXJuIGlzU2NhdHRlclR5cGUoZCkgPyBkLnZhbHVlcyA6IFtdO1xuICAgICB9XG4gICAgICovXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uYmFyRGF0YSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzQmFyVHlwZShkKSA/IGQudmFsdWVzIDogW107XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5saW5lT3JTY2F0dGVyRGF0YSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzTGluZVR5cGUoZCkgfHwgdGhpcy5pc1NjYXR0ZXJUeXBlKGQpID8gZC52YWx1ZXMgOiBbXTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmJhck9yTGluZURhdGEgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0JhclR5cGUoZCkgfHwgdGhpcy5pc0xpbmVUeXBlKGQpID8gZC52YWx1ZXMgOiBbXTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzSW50ZXJwb2xhdGlvblR5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICByZXR1cm4gWydsaW5lYXInLCAnbGluZWFyLWNsb3NlZCcsICdiYXNpcycsICdiYXNpcy1vcGVuJywgJ2Jhc2lzLWNsb3NlZCcsICdidW5kbGUnLCAnY2FyZGluYWwnLCAnY2FyZGluYWwtb3BlbicsICdjYXJkaW5hbC1jbG9zZWQnLCAnbW9ub3RvbmUnXS5pbmRleE9mKHR5cGUpID49IDA7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmluaXRHcmlkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgZDMgPSAkJC5kMztcbiAgICAgICAgJCQuZ3JpZCA9ICQkLm1haW4uYXBwZW5kKCdnJykuYXR0cihcImNsaXAtcGF0aFwiLCAkJC5jbGlwUGF0aEZvckdyaWQpLmF0dHIoJ2NsYXNzJywgQ0xBU1MuZ3JpZCk7XG4gICAgICAgIGlmIChjb25maWcuZ3JpZF94X3Nob3cpIHtcbiAgICAgICAgICAgICQkLmdyaWQuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MueGdyaWRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnLmdyaWRfeV9zaG93KSB7XG4gICAgICAgICAgICAkJC5ncmlkLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgQ0xBU1MueWdyaWRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnLmdyaWRfZm9jdXNfc2hvdykge1xuICAgICAgICAgICAgJCQuZ3JpZC5hcHBlbmQoJ2cnKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MueGdyaWRGb2N1cykuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBDTEFTUy54Z3JpZEZvY3VzKTtcbiAgICAgICAgfVxuICAgICAgICAkJC54Z3JpZCA9IGQzLnNlbGVjdEFsbChbXSk7XG4gICAgICAgIGlmICghY29uZmlnLmdyaWRfbGluZXNfZnJvbnQpIHtcbiAgICAgICAgICAgICQkLmluaXRHcmlkTGluZXMoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaW5pdEdyaWRMaW5lcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGQzID0gJCQuZDM7XG4gICAgICAgICQkLmdyaWRMaW5lcyA9ICQkLm1haW4uYXBwZW5kKCdnJykuYXR0cihcImNsaXAtcGF0aFwiLCAkJC5jbGlwUGF0aEZvckdyaWQpLmF0dHIoJ2NsYXNzJywgQ0xBU1MuZ3JpZCArICcgJyArIENMQVNTLmdyaWRMaW5lcyk7XG4gICAgICAgICQkLmdyaWRMaW5lcy5hcHBlbmQoJ2cnKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MueGdyaWRMaW5lcyk7XG4gICAgICAgICQkLmdyaWRMaW5lcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsIENMQVNTLnlncmlkTGluZXMpO1xuICAgICAgICAkJC54Z3JpZExpbmVzID0gZDMuc2VsZWN0QWxsKFtdKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVhHcmlkID0gZnVuY3Rpb24gKHdpdGhvdXRVcGRhdGUpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGQzID0gJCQuZDMsXG4gICAgICAgICAgICB4Z3JpZERhdGEgPSAkJC5nZW5lcmF0ZUdyaWREYXRhKGNvbmZpZy5ncmlkX3hfdHlwZSwgJCQueCksXG4gICAgICAgICAgICB0aWNrT2Zmc2V0ID0gJCQuaXNDYXRlZ29yaXplZCgpID8gJCQueEF4aXMudGlja09mZnNldCgpIDogMDtcblxuICAgICAgICAkJC54Z3JpZEF0dHIgPSBjb25maWcuYXhpc19yb3RhdGVkID8ge1xuICAgICAgICAgICAgJ3gxJzogMCxcbiAgICAgICAgICAgICd4Mic6ICQkLndpZHRoLFxuICAgICAgICAgICAgJ3kxJzogZnVuY3Rpb24geTEoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkJC54KGQpIC0gdGlja09mZnNldDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAneTInOiBmdW5jdGlvbiB5MihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQkLngoZCkgLSB0aWNrT2Zmc2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IDoge1xuICAgICAgICAgICAgJ3gxJzogZnVuY3Rpb24geDEoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkJC54KGQpICsgdGlja09mZnNldDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAneDInOiBmdW5jdGlvbiB4MihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQkLngoZCkgKyB0aWNrT2Zmc2V0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICd5MSc6IDAsXG4gICAgICAgICAgICAneTInOiAkJC5oZWlnaHRcbiAgICAgICAgfTtcblxuICAgICAgICAkJC54Z3JpZCA9ICQkLm1haW4uc2VsZWN0KCcuJyArIENMQVNTLnhncmlkcykuc2VsZWN0QWxsKCcuJyArIENMQVNTLnhncmlkKS5kYXRhKHhncmlkRGF0YSk7XG4gICAgICAgICQkLnhncmlkLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cihcImNsYXNzXCIsIENMQVNTLnhncmlkKTtcbiAgICAgICAgaWYgKCF3aXRob3V0VXBkYXRlKSB7XG4gICAgICAgICAgICAkJC54Z3JpZC5hdHRyKCQkLnhncmlkQXR0cikuc3R5bGUoXCJvcGFjaXR5XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gK2QzLnNlbGVjdCh0aGlzKS5hdHRyKGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAneTEnIDogJ3gxJykgPT09IChjb25maWcuYXhpc19yb3RhdGVkID8gJCQuaGVpZ2h0IDogMCkgPyAwIDogMTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgICQkLnhncmlkLmV4aXQoKS5yZW1vdmUoKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlWUdyaWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBncmlkVmFsdWVzID0gJCQueUF4aXMudGlja1ZhbHVlcygpIHx8ICQkLnkudGlja3MoY29uZmlnLmdyaWRfeV90aWNrcyk7XG4gICAgICAgICQkLnlncmlkID0gJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MueWdyaWRzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MueWdyaWQpLmRhdGEoZ3JpZFZhbHVlcyk7XG4gICAgICAgICQkLnlncmlkLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBDTEFTUy55Z3JpZCk7XG4gICAgICAgICQkLnlncmlkLmF0dHIoXCJ4MVwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gJCQueSA6IDApLmF0dHIoXCJ4MlwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gJCQueSA6ICQkLndpZHRoKS5hdHRyKFwieTFcIiwgY29uZmlnLmF4aXNfcm90YXRlZCA/IDAgOiAkJC55KS5hdHRyKFwieTJcIiwgY29uZmlnLmF4aXNfcm90YXRlZCA/ICQkLmhlaWdodCA6ICQkLnkpO1xuICAgICAgICAkJC55Z3JpZC5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgICQkLnNtb290aExpbmVzKCQkLnlncmlkLCAnZ3JpZCcpO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5ncmlkVGV4dEFuY2hvciA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBkLnBvc2l0aW9uID8gZC5wb3NpdGlvbiA6IFwiZW5kXCI7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5ncmlkVGV4dER4ID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGQucG9zaXRpb24gPT09ICdzdGFydCcgPyA0IDogZC5wb3NpdGlvbiA9PT0gJ21pZGRsZScgPyAwIDogLTQ7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi54R3JpZFRleHRYID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGQucG9zaXRpb24gPT09ICdzdGFydCcgPyAtdGhpcy5oZWlnaHQgOiBkLnBvc2l0aW9uID09PSAnbWlkZGxlJyA/IC10aGlzLmhlaWdodCAvIDIgOiAwO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ueUdyaWRUZXh0WCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBkLnBvc2l0aW9uID09PSAnc3RhcnQnID8gMCA6IGQucG9zaXRpb24gPT09ICdtaWRkbGUnID8gdGhpcy53aWR0aCAvIDIgOiB0aGlzLndpZHRoO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlR3JpZCA9IGZ1bmN0aW9uIChkdXJhdGlvbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgbWFpbiA9ICQkLm1haW4sXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB4Z3JpZExpbmUsXG4gICAgICAgICAgICB5Z3JpZExpbmUsXG4gICAgICAgICAgICB5djtcblxuICAgICAgICAvLyBoaWRlIGlmIGFyYyB0eXBlXG4gICAgICAgICQkLmdyaWQuc3R5bGUoJ3Zpc2liaWxpdHknLCAkJC5oYXNBcmNUeXBlKCkgPyAnaGlkZGVuJyA6ICd2aXNpYmxlJyk7XG5cbiAgICAgICAgbWFpbi5zZWxlY3QoJ2xpbmUuJyArIENMQVNTLnhncmlkRm9jdXMpLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgICAgICAgaWYgKGNvbmZpZy5ncmlkX3hfc2hvdykge1xuICAgICAgICAgICAgJCQudXBkYXRlWEdyaWQoKTtcbiAgICAgICAgfVxuICAgICAgICAkJC54Z3JpZExpbmVzID0gbWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MueGdyaWRMaW5lcykuc2VsZWN0QWxsKCcuJyArIENMQVNTLnhncmlkTGluZSkuZGF0YShjb25maWcuZ3JpZF94X2xpbmVzKTtcbiAgICAgICAgLy8gZW50ZXJcbiAgICAgICAgeGdyaWRMaW5lID0gJCQueGdyaWRMaW5lcy5lbnRlcigpLmFwcGVuZCgnZycpLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIENMQVNTLnhncmlkTGluZSArIChkWydjbGFzcyddID8gJyAnICsgZFsnY2xhc3MnXSA6ICcnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHhncmlkTGluZS5hcHBlbmQoJ2xpbmUnKS5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XG4gICAgICAgIHhncmlkTGluZS5hcHBlbmQoJ3RleHQnKS5hdHRyKFwidGV4dC1hbmNob3JcIiwgJCQuZ3JpZFRleHRBbmNob3IpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY29uZmlnLmF4aXNfcm90YXRlZCA/IFwiXCIgOiBcInJvdGF0ZSgtOTApXCIpLmF0dHIoJ2R4JywgJCQuZ3JpZFRleHREeCkuYXR0cignZHknLCAtNSkuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xuICAgICAgICAvLyB1ZHBhdGVcbiAgICAgICAgLy8gZG9uZSBpbiBkMy50cmFuc2l0aW9uKCkgb2YgdGhlIGVuZCBvZiB0aGlzIGZ1bmN0aW9uXG4gICAgICAgIC8vIGV4aXRcbiAgICAgICAgJCQueGdyaWRMaW5lcy5leGl0KCkudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uKS5zdHlsZShcIm9wYWNpdHlcIiwgMCkucmVtb3ZlKCk7XG5cbiAgICAgICAgLy8gWS1HcmlkXG4gICAgICAgIGlmIChjb25maWcuZ3JpZF95X3Nob3cpIHtcbiAgICAgICAgICAgICQkLnVwZGF0ZVlHcmlkKCk7XG4gICAgICAgIH1cbiAgICAgICAgJCQueWdyaWRMaW5lcyA9IG1haW4uc2VsZWN0KCcuJyArIENMQVNTLnlncmlkTGluZXMpLnNlbGVjdEFsbCgnLicgKyBDTEFTUy55Z3JpZExpbmUpLmRhdGEoY29uZmlnLmdyaWRfeV9saW5lcyk7XG4gICAgICAgIC8vIGVudGVyXG4gICAgICAgIHlncmlkTGluZSA9ICQkLnlncmlkTGluZXMuZW50ZXIoKS5hcHBlbmQoJ2cnKS5hdHRyKFwiY2xhc3NcIiwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBDTEFTUy55Z3JpZExpbmUgKyAoZFsnY2xhc3MnXSA/ICcgJyArIGRbJ2NsYXNzJ10gOiAnJyk7XG4gICAgICAgIH0pO1xuICAgICAgICB5Z3JpZExpbmUuYXBwZW5kKCdsaW5lJykuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xuICAgICAgICB5Z3JpZExpbmUuYXBwZW5kKCd0ZXh0JykuYXR0cihcInRleHQtYW5jaG9yXCIsICQkLmdyaWRUZXh0QW5jaG9yKS5hdHRyKFwidHJhbnNmb3JtXCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyBcInJvdGF0ZSgtOTApXCIgOiBcIlwiKS5hdHRyKCdkeCcsICQkLmdyaWRUZXh0RHgpLmF0dHIoJ2R5JywgLTUpLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcbiAgICAgICAgLy8gdXBkYXRlXG4gICAgICAgIHl2ID0gJCQueXYuYmluZCgkJCk7XG4gICAgICAgICQkLnlncmlkTGluZXMuc2VsZWN0KCdsaW5lJykudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uKS5hdHRyKFwieDFcIiwgY29uZmlnLmF4aXNfcm90YXRlZCA/IHl2IDogMCkuYXR0cihcIngyXCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyB5diA6ICQkLndpZHRoKS5hdHRyKFwieTFcIiwgY29uZmlnLmF4aXNfcm90YXRlZCA/IDAgOiB5dikuYXR0cihcInkyXCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAkJC5oZWlnaHQgOiB5dikuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xuICAgICAgICAkJC55Z3JpZExpbmVzLnNlbGVjdCgndGV4dCcpLnRyYW5zaXRpb24oKS5kdXJhdGlvbihkdXJhdGlvbikuYXR0cihcInhcIiwgY29uZmlnLmF4aXNfcm90YXRlZCA/ICQkLnhHcmlkVGV4dFguYmluZCgkJCkgOiAkJC55R3JpZFRleHRYLmJpbmQoJCQpKS5hdHRyKFwieVwiLCB5dikudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGQudGV4dDtcbiAgICAgICAgfSkuc3R5bGUoXCJvcGFjaXR5XCIsIDEpO1xuICAgICAgICAvLyBleGl0XG4gICAgICAgICQkLnlncmlkTGluZXMuZXhpdCgpLnRyYW5zaXRpb24oKS5kdXJhdGlvbihkdXJhdGlvbikuc3R5bGUoXCJvcGFjaXR5XCIsIDApLnJlbW92ZSgpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVkcmF3R3JpZCA9IGZ1bmN0aW9uICh3aXRoVHJhbnNpdGlvbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgeHYgPSAkJC54di5iaW5kKCQkKSxcbiAgICAgICAgICAgIGxpbmVzID0gJCQueGdyaWRMaW5lcy5zZWxlY3QoJ2xpbmUnKSxcbiAgICAgICAgICAgIHRleHRzID0gJCQueGdyaWRMaW5lcy5zZWxlY3QoJ3RleHQnKTtcbiAgICAgICAgcmV0dXJuIFsod2l0aFRyYW5zaXRpb24gPyBsaW5lcy50cmFuc2l0aW9uKCkgOiBsaW5lcykuYXR0cihcIngxXCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAwIDogeHYpLmF0dHIoXCJ4MlwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gJCQud2lkdGggOiB4dikuYXR0cihcInkxXCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyB4diA6IDApLmF0dHIoXCJ5MlwiLCBjb25maWcuYXhpc19yb3RhdGVkID8geHYgOiAkJC5oZWlnaHQpLnN0eWxlKFwib3BhY2l0eVwiLCAxKSwgKHdpdGhUcmFuc2l0aW9uID8gdGV4dHMudHJhbnNpdGlvbigpIDogdGV4dHMpLmF0dHIoXCJ4XCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAkJC55R3JpZFRleHRYLmJpbmQoJCQpIDogJCQueEdyaWRUZXh0WC5iaW5kKCQkKSkuYXR0cihcInlcIiwgeHYpLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBkLnRleHQ7XG4gICAgICAgIH0pLnN0eWxlKFwib3BhY2l0eVwiLCAxKV07XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5zaG93WEdyaWRGb2N1cyA9IGZ1bmN0aW9uIChzZWxlY3RlZERhdGEpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGRhdGFUb1Nob3cgPSBzZWxlY3RlZERhdGEuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZCAmJiBpc1ZhbHVlKGQudmFsdWUpO1xuICAgICAgICB9KSxcbiAgICAgICAgICAgIGZvY3VzRWwgPSAkJC5tYWluLnNlbGVjdEFsbCgnbGluZS4nICsgQ0xBU1MueGdyaWRGb2N1cyksXG4gICAgICAgICAgICB4eCA9ICQkLnh4LmJpbmQoJCQpO1xuICAgICAgICBpZiAoIWNvbmZpZy50b29sdGlwX3Nob3cpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBIaWRlIHdoZW4gc2NhdHRlciBwbG90IGV4aXN0c1xuICAgICAgICBpZiAoJCQuaGFzVHlwZSgnc2NhdHRlcicpIHx8ICQkLmhhc0FyY1R5cGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvY3VzRWwuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKS5kYXRhKFtkYXRhVG9TaG93WzBdXSkuYXR0cihjb25maWcuYXhpc19yb3RhdGVkID8gJ3kxJyA6ICd4MScsIHh4KS5hdHRyKGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAneTInIDogJ3gyJywgeHgpO1xuICAgICAgICAkJC5zbW9vdGhMaW5lcyhmb2N1c0VsLCAnZ3JpZCcpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaGlkZVhHcmlkRm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubWFpbi5zZWxlY3QoJ2xpbmUuJyArIENMQVNTLnhncmlkRm9jdXMpLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVhncmlkRm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgICQkLm1haW4uc2VsZWN0KCdsaW5lLicgKyBDTEFTUy54Z3JpZEZvY3VzKS5hdHRyKFwieDFcIiwgY29uZmlnLmF4aXNfcm90YXRlZCA/IDAgOiAtMTApLmF0dHIoXCJ4MlwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gJCQud2lkdGggOiAtMTApLmF0dHIoXCJ5MVwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gLTEwIDogMCkuYXR0cihcInkyXCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAtMTAgOiAkJC5oZWlnaHQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2VuZXJhdGVHcmlkRGF0YSA9IGZ1bmN0aW9uICh0eXBlLCBzY2FsZSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZ3JpZERhdGEgPSBbXSxcbiAgICAgICAgICAgIHhEb21haW4sXG4gICAgICAgICAgICBmaXJzdFllYXIsXG4gICAgICAgICAgICBsYXN0WWVhcixcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICB0aWNrTnVtID0gJCQubWFpbi5zZWxlY3QoXCIuXCIgKyBDTEFTUy5heGlzWCkuc2VsZWN0QWxsKCcudGljaycpLnNpemUoKTtcbiAgICAgICAgaWYgKHR5cGUgPT09ICd5ZWFyJykge1xuICAgICAgICAgICAgeERvbWFpbiA9ICQkLmdldFhEb21haW4oKTtcbiAgICAgICAgICAgIGZpcnN0WWVhciA9IHhEb21haW5bMF0uZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgICAgIGxhc3RZZWFyID0geERvbWFpblsxXS5nZXRGdWxsWWVhcigpO1xuICAgICAgICAgICAgZm9yIChpID0gZmlyc3RZZWFyOyBpIDw9IGxhc3RZZWFyOyBpKyspIHtcbiAgICAgICAgICAgICAgICBncmlkRGF0YS5wdXNoKG5ldyBEYXRlKGkgKyAnLTAxLTAxIDAwOjAwOjAwJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ3JpZERhdGEgPSBzY2FsZS50aWNrcygxMCk7XG4gICAgICAgICAgICBpZiAoZ3JpZERhdGEubGVuZ3RoID4gdGlja051bSkge1xuICAgICAgICAgICAgICAgIC8vIHVzZSBvbmx5IGludFxuICAgICAgICAgICAgICAgIGdyaWREYXRhID0gZ3JpZERhdGEuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXCJcIiArIGQpLmluZGV4T2YoJy4nKSA8IDA7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdyaWREYXRhO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0R3JpZEZpbHRlclRvUmVtb3ZlID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICByZXR1cm4gcGFyYW1zID8gZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgW10uY29uY2F0KHBhcmFtcykuZm9yRWFjaChmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICBpZiAoJ3ZhbHVlJyBpbiBwYXJhbSAmJiBsaW5lLnZhbHVlID09PSBwYXJhbS52YWx1ZSB8fCAnY2xhc3MnIGluIHBhcmFtICYmIGxpbmVbJ2NsYXNzJ10gPT09IHBhcmFtWydjbGFzcyddKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmb3VuZDtcbiAgICAgICAgfSA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVtb3ZlR3JpZExpbmVzID0gZnVuY3Rpb24gKHBhcmFtcywgZm9yWCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgdG9SZW1vdmUgPSAkJC5nZXRHcmlkRmlsdGVyVG9SZW1vdmUocGFyYW1zKSxcbiAgICAgICAgICAgIHRvU2hvdyA9IGZ1bmN0aW9uIHRvU2hvdyhsaW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gIXRvUmVtb3ZlKGxpbmUpO1xuICAgICAgICB9LFxuICAgICAgICAgICAgY2xhc3NMaW5lcyA9IGZvclggPyBDTEFTUy54Z3JpZExpbmVzIDogQ0xBU1MueWdyaWRMaW5lcyxcbiAgICAgICAgICAgIGNsYXNzTGluZSA9IGZvclggPyBDTEFTUy54Z3JpZExpbmUgOiBDTEFTUy55Z3JpZExpbmU7XG4gICAgICAgICQkLm1haW4uc2VsZWN0KCcuJyArIGNsYXNzTGluZXMpLnNlbGVjdEFsbCgnLicgKyBjbGFzc0xpbmUpLmZpbHRlcih0b1JlbW92ZSkudHJhbnNpdGlvbigpLmR1cmF0aW9uKGNvbmZpZy50cmFuc2l0aW9uX2R1cmF0aW9uKS5zdHlsZSgnb3BhY2l0eScsIDApLnJlbW92ZSgpO1xuICAgICAgICBpZiAoZm9yWCkge1xuICAgICAgICAgICAgY29uZmlnLmdyaWRfeF9saW5lcyA9IGNvbmZpZy5ncmlkX3hfbGluZXMuZmlsdGVyKHRvU2hvdyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25maWcuZ3JpZF95X2xpbmVzID0gY29uZmlnLmdyaWRfeV9saW5lcy5maWx0ZXIodG9TaG93KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0VG9vbHRpcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGk7XG4gICAgICAgICQkLnRvb2x0aXAgPSAkJC5zZWxlY3RDaGFydC5zdHlsZShcInBvc2l0aW9uXCIsIFwicmVsYXRpdmVcIikuYXBwZW5kKFwiZGl2XCIpLmF0dHIoJ2NsYXNzJywgQ0xBU1MudG9vbHRpcENvbnRhaW5lcikuc3R5bGUoXCJwb3NpdGlvblwiLCBcImFic29sdXRlXCIpLnN0eWxlKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICAgIC8vIFNob3cgdG9vbHRpcCBpZiBuZWVkZWRcbiAgICAgICAgaWYgKGNvbmZpZy50b29sdGlwX2luaXRfc2hvdykge1xuICAgICAgICAgICAgaWYgKCQkLmlzVGltZVNlcmllcygpICYmIGlzU3RyaW5nKGNvbmZpZy50b29sdGlwX2luaXRfeCkpIHtcbiAgICAgICAgICAgICAgICBjb25maWcudG9vbHRpcF9pbml0X3ggPSAkJC5wYXJzZURhdGUoY29uZmlnLnRvb2x0aXBfaW5pdF94KTtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgJCQuZGF0YS50YXJnZXRzWzBdLnZhbHVlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJCQuZGF0YS50YXJnZXRzWzBdLnZhbHVlc1tpXS54IC0gY29uZmlnLnRvb2x0aXBfaW5pdF94ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25maWcudG9vbHRpcF9pbml0X3ggPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCQudG9vbHRpcC5odG1sKGNvbmZpZy50b29sdGlwX2NvbnRlbnRzLmNhbGwoJCQsICQkLmRhdGEudGFyZ2V0cy5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJCQuYWRkTmFtZShkLnZhbHVlc1tjb25maWcudG9vbHRpcF9pbml0X3hdKTtcbiAgICAgICAgICAgIH0pLCAkJC5heGlzLmdldFhBeGlzVGlja0Zvcm1hdCgpLCAkJC5nZXRZRm9ybWF0KCQkLmhhc0FyY1R5cGUoKSksICQkLmNvbG9yKSk7XG4gICAgICAgICAgICAkJC50b29sdGlwLnN0eWxlKFwidG9wXCIsIGNvbmZpZy50b29sdGlwX2luaXRfcG9zaXRpb24udG9wKS5zdHlsZShcImxlZnRcIiwgY29uZmlnLnRvb2x0aXBfaW5pdF9wb3NpdGlvbi5sZWZ0KS5zdHlsZShcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0VG9vbHRpcENvbnRlbnQgPSBmdW5jdGlvbiAoZCwgZGVmYXVsdFRpdGxlRm9ybWF0LCBkZWZhdWx0VmFsdWVGb3JtYXQsIGNvbG9yKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB0aXRsZUZvcm1hdCA9IGNvbmZpZy50b29sdGlwX2Zvcm1hdF90aXRsZSB8fCBkZWZhdWx0VGl0bGVGb3JtYXQsXG4gICAgICAgICAgICBuYW1lRm9ybWF0ID0gY29uZmlnLnRvb2x0aXBfZm9ybWF0X25hbWUgfHwgZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBuYW1lO1xuICAgICAgICB9LFxuICAgICAgICAgICAgdmFsdWVGb3JtYXQgPSBjb25maWcudG9vbHRpcF9mb3JtYXRfdmFsdWUgfHwgZGVmYXVsdFZhbHVlRm9ybWF0LFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGJnY29sb3IsXG4gICAgICAgICAgICBvcmRlckFzYyA9ICQkLmlzT3JkZXJBc2MoKTtcblxuICAgICAgICBpZiAoY29uZmlnLmRhdGFfZ3JvdXBzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgZC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgdmFyIHYxID0gYSA/IGEudmFsdWUgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB2MiA9IGIgPyBiLnZhbHVlIDogbnVsbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXJBc2MgPyB2MSAtIHYyIDogdjIgLSB2MTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGlkcyA9ICQkLm9yZGVyVGFyZ2V0cygkJC5kYXRhLnRhcmdldHMpLm1hcChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpLmlkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICB2YXIgdjEgPSBhID8gYS52YWx1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHYyID0gYiA/IGIudmFsdWUgOiBudWxsO1xuICAgICAgICAgICAgICAgIGlmICh2MSA+IDAgJiYgdjIgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHYxID0gYSA/IGlkcy5pbmRleE9mKGEuaWQpIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdjIgPSBiID8gaWRzLmluZGV4T2YoYi5pZCkgOiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXJBc2MgPyB2MSAtIHYyIDogdjIgLSB2MTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICghKGRbaV0gJiYgKGRbaV0udmFsdWUgfHwgZFtpXS52YWx1ZSA9PT0gMCkpKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGV4dCkge1xuICAgICAgICAgICAgICAgIHRpdGxlID0gc2FuaXRpc2UodGl0bGVGb3JtYXQgPyB0aXRsZUZvcm1hdChkW2ldLngpIDogZFtpXS54KTtcbiAgICAgICAgICAgICAgICB0ZXh0ID0gXCI8dGFibGUgY2xhc3M9J1wiICsgJCQuQ0xBU1MudG9vbHRpcCArIFwiJz5cIiArICh0aXRsZSB8fCB0aXRsZSA9PT0gMCA/IFwiPHRyPjx0aCBjb2xzcGFuPScyJz5cIiArIHRpdGxlICsgXCI8L3RoPjwvdHI+XCIgOiBcIlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFsdWUgPSBzYW5pdGlzZSh2YWx1ZUZvcm1hdChkW2ldLnZhbHVlLCBkW2ldLnJhdGlvLCBkW2ldLmlkLCBkW2ldLmluZGV4LCBkKSk7XG4gICAgICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIFNraXAgZWxlbWVudHMgd2hlbiB0aGVpciBuYW1lIGlzIHNldCB0byBudWxsXG4gICAgICAgICAgICAgICAgaWYgKGRbaV0ubmFtZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmFtZSA9IHNhbml0aXNlKG5hbWVGb3JtYXQoZFtpXS5uYW1lLCBkW2ldLnJhdGlvLCBkW2ldLmlkLCBkW2ldLmluZGV4KSk7XG4gICAgICAgICAgICAgICAgYmdjb2xvciA9ICQkLmxldmVsQ29sb3IgPyAkJC5sZXZlbENvbG9yKGRbaV0udmFsdWUpIDogY29sb3IoZFtpXS5pZCk7XG5cbiAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiPHRyIGNsYXNzPSdcIiArICQkLkNMQVNTLnRvb2x0aXBOYW1lICsgXCItXCIgKyAkJC5nZXRUYXJnZXRTZWxlY3RvclN1ZmZpeChkW2ldLmlkKSArIFwiJz5cIjtcbiAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiPHRkIGNsYXNzPSduYW1lJz48c3BhbiBzdHlsZT0nYmFja2dyb3VuZC1jb2xvcjpcIiArIGJnY29sb3IgKyBcIic+PC9zcGFuPlwiICsgbmFtZSArIFwiPC90ZD5cIjtcbiAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiPHRkIGNsYXNzPSd2YWx1ZSc+XCIgKyB2YWx1ZSArIFwiPC90ZD5cIjtcbiAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiPC90cj5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGV4dCArIFwiPC90YWJsZT5cIjtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnRvb2x0aXBQb3NpdGlvbiA9IGZ1bmN0aW9uIChkYXRhVG9TaG93LCB0V2lkdGgsIHRIZWlnaHQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGQzID0gJCQuZDM7XG4gICAgICAgIHZhciBzdmdMZWZ0LCB0b29sdGlwTGVmdCwgdG9vbHRpcFJpZ2h0LCB0b29sdGlwVG9wLCBjaGFydFJpZ2h0O1xuICAgICAgICB2YXIgZm9yQXJjID0gJCQuaGFzQXJjVHlwZSgpLFxuICAgICAgICAgICAgbW91c2UgPSBkMy5tb3VzZShlbGVtZW50KTtcbiAgICAgICAgLy8gRGV0ZXJtaW4gdG9vbHRpcCBwb3NpdGlvblxuICAgICAgICBpZiAoZm9yQXJjKSB7XG4gICAgICAgICAgICB0b29sdGlwTGVmdCA9ICgkJC53aWR0aCAtICgkJC5pc0xlZ2VuZFJpZ2h0ID8gJCQuZ2V0TGVnZW5kV2lkdGgoKSA6IDApKSAvIDIgKyBtb3VzZVswXTtcbiAgICAgICAgICAgIHRvb2x0aXBUb3AgPSAkJC5oZWlnaHQgLyAyICsgbW91c2VbMV0gKyAyMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN2Z0xlZnQgPSAkJC5nZXRTdmdMZWZ0KHRydWUpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZy5heGlzX3JvdGF0ZWQpIHtcbiAgICAgICAgICAgICAgICB0b29sdGlwTGVmdCA9IHN2Z0xlZnQgKyBtb3VzZVswXSArIDEwMDtcbiAgICAgICAgICAgICAgICB0b29sdGlwUmlnaHQgPSB0b29sdGlwTGVmdCArIHRXaWR0aDtcbiAgICAgICAgICAgICAgICBjaGFydFJpZ2h0ID0gJCQuY3VycmVudFdpZHRoIC0gJCQuZ2V0Q3VycmVudFBhZGRpbmdSaWdodCgpO1xuICAgICAgICAgICAgICAgIHRvb2x0aXBUb3AgPSAkJC54KGRhdGFUb1Nob3dbMF0ueCkgKyAyMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdG9vbHRpcExlZnQgPSBzdmdMZWZ0ICsgJCQuZ2V0Q3VycmVudFBhZGRpbmdMZWZ0KHRydWUpICsgJCQueChkYXRhVG9TaG93WzBdLngpICsgMjA7XG4gICAgICAgICAgICAgICAgdG9vbHRpcFJpZ2h0ID0gdG9vbHRpcExlZnQgKyB0V2lkdGg7XG4gICAgICAgICAgICAgICAgY2hhcnRSaWdodCA9IHN2Z0xlZnQgKyAkJC5jdXJyZW50V2lkdGggLSAkJC5nZXRDdXJyZW50UGFkZGluZ1JpZ2h0KCk7XG4gICAgICAgICAgICAgICAgdG9vbHRpcFRvcCA9IG1vdXNlWzFdICsgMTU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0b29sdGlwUmlnaHQgPiBjaGFydFJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgLy8gMjAgaXMgbmVlZGVkIGZvciBGaXJlZm94IHRvIGtlZXAgdG9vbHRpcCB3aWR0aFxuICAgICAgICAgICAgICAgIHRvb2x0aXBMZWZ0IC09IHRvb2x0aXBSaWdodCAtIGNoYXJ0UmlnaHQgKyAyMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0b29sdGlwVG9wICsgdEhlaWdodCA+ICQkLmN1cnJlbnRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB0b29sdGlwVG9wIC09IHRIZWlnaHQgKyAzMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodG9vbHRpcFRvcCA8IDApIHtcbiAgICAgICAgICAgIHRvb2x0aXBUb3AgPSAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHRvcDogdG9vbHRpcFRvcCwgbGVmdDogdG9vbHRpcExlZnQgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnNob3dUb29sdGlwID0gZnVuY3Rpb24gKHNlbGVjdGVkRGF0YSwgZWxlbWVudCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICB2YXIgdFdpZHRoLCB0SGVpZ2h0LCBwb3NpdGlvbjtcbiAgICAgICAgdmFyIGZvckFyYyA9ICQkLmhhc0FyY1R5cGUoKSxcbiAgICAgICAgICAgIGRhdGFUb1Nob3cgPSBzZWxlY3RlZERhdGEuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZCAmJiBpc1ZhbHVlKGQudmFsdWUpO1xuICAgICAgICB9KSxcbiAgICAgICAgICAgIHBvc2l0aW9uRnVuY3Rpb24gPSBjb25maWcudG9vbHRpcF9wb3NpdGlvbiB8fCBjM19jaGFydF9pbnRlcm5hbF9mbi50b29sdGlwUG9zaXRpb247XG4gICAgICAgIGlmIChkYXRhVG9TaG93Lmxlbmd0aCA9PT0gMCB8fCAhY29uZmlnLnRvb2x0aXBfc2hvdykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgICQkLnRvb2x0aXAuaHRtbChjb25maWcudG9vbHRpcF9jb250ZW50cy5jYWxsKCQkLCBzZWxlY3RlZERhdGEsICQkLmF4aXMuZ2V0WEF4aXNUaWNrRm9ybWF0KCksICQkLmdldFlGb3JtYXQoZm9yQXJjKSwgJCQuY29sb3IpKS5zdHlsZShcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcblxuICAgICAgICAvLyBHZXQgdG9vbHRpcCBkaW1lbnNpb25zXG4gICAgICAgIHRXaWR0aCA9ICQkLnRvb2x0aXAucHJvcGVydHkoJ29mZnNldFdpZHRoJyk7XG4gICAgICAgIHRIZWlnaHQgPSAkJC50b29sdGlwLnByb3BlcnR5KCdvZmZzZXRIZWlnaHQnKTtcblxuICAgICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uRnVuY3Rpb24uY2FsbCh0aGlzLCBkYXRhVG9TaG93LCB0V2lkdGgsIHRIZWlnaHQsIGVsZW1lbnQpO1xuICAgICAgICAvLyBTZXQgdG9vbHRpcFxuICAgICAgICAkJC50b29sdGlwLnN0eWxlKFwidG9wXCIsIHBvc2l0aW9uLnRvcCArIFwicHhcIikuc3R5bGUoXCJsZWZ0XCIsIHBvc2l0aW9uLmxlZnQgKyAncHgnKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmhpZGVUb29sdGlwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRvb2x0aXAuc3R5bGUoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaW5pdExlZ2VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgJCQubGVnZW5kSXRlbVRleHRCb3ggPSB7fTtcbiAgICAgICAgJCQubGVnZW5kSGFzUmVuZGVyZWQgPSBmYWxzZTtcbiAgICAgICAgJCQubGVnZW5kID0gJCQuc3ZnLmFwcGVuZChcImdcIikuYXR0cihcInRyYW5zZm9ybVwiLCAkJC5nZXRUcmFuc2xhdGUoJ2xlZ2VuZCcpKTtcbiAgICAgICAgaWYgKCEkJC5jb25maWcubGVnZW5kX3Nob3cpIHtcbiAgICAgICAgICAgICQkLmxlZ2VuZC5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgICAgICQkLmhpZGRlbkxlZ2VuZElkcyA9ICQkLm1hcFRvSWRzKCQkLmRhdGEudGFyZ2V0cyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gTUVNTzogY2FsbCBoZXJlIHRvIHVwZGF0ZSBsZWdlbmQgYm94IGFuZCB0cmFubGF0ZSBmb3IgYWxsXG4gICAgICAgIC8vIE1FTU86IHRyYW5zbGF0ZSB3aWxsIGJlIHVwYXRlZCBieSB0aGlzLCBzbyB0cmFuc2Zvcm0gbm90IG5lZWRlZCBpbiB1cGRhdGVMZWdlbmQoKVxuICAgICAgICAkJC51cGRhdGVMZWdlbmRXaXRoRGVmYXVsdHMoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZUxlZ2VuZFdpdGhEZWZhdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgJCQudXBkYXRlTGVnZW5kKCQkLm1hcFRvSWRzKCQkLmRhdGEudGFyZ2V0cyksIHsgd2l0aFRyYW5zZm9ybTogZmFsc2UsIHdpdGhUcmFuc2l0aW9uRm9yVHJhbnNmb3JtOiBmYWxzZSwgd2l0aFRyYW5zaXRpb246IGZhbHNlIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlU2l6ZUZvckxlZ2VuZCA9IGZ1bmN0aW9uIChsZWdlbmRIZWlnaHQsIGxlZ2VuZFdpZHRoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBpbnNldExlZ2VuZFBvc2l0aW9uID0ge1xuICAgICAgICAgICAgdG9wOiAkJC5pc0xlZ2VuZFRvcCA/ICQkLmdldEN1cnJlbnRQYWRkaW5nVG9wKCkgKyBjb25maWcubGVnZW5kX2luc2V0X3kgKyA1LjUgOiAkJC5jdXJyZW50SGVpZ2h0IC0gbGVnZW5kSGVpZ2h0IC0gJCQuZ2V0Q3VycmVudFBhZGRpbmdCb3R0b20oKSAtIGNvbmZpZy5sZWdlbmRfaW5zZXRfeSxcbiAgICAgICAgICAgIGxlZnQ6ICQkLmlzTGVnZW5kTGVmdCA/ICQkLmdldEN1cnJlbnRQYWRkaW5nTGVmdCgpICsgY29uZmlnLmxlZ2VuZF9pbnNldF94ICsgMC41IDogJCQuY3VycmVudFdpZHRoIC0gbGVnZW5kV2lkdGggLSAkJC5nZXRDdXJyZW50UGFkZGluZ1JpZ2h0KCkgLSBjb25maWcubGVnZW5kX2luc2V0X3ggKyAwLjVcbiAgICAgICAgfTtcblxuICAgICAgICAkJC5tYXJnaW4zID0ge1xuICAgICAgICAgICAgdG9wOiAkJC5pc0xlZ2VuZFJpZ2h0ID8gMCA6ICQkLmlzTGVnZW5kSW5zZXQgPyBpbnNldExlZ2VuZFBvc2l0aW9uLnRvcCA6ICQkLmN1cnJlbnRIZWlnaHQgLSBsZWdlbmRIZWlnaHQsXG4gICAgICAgICAgICByaWdodDogTmFOLFxuICAgICAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICAgICAgbGVmdDogJCQuaXNMZWdlbmRSaWdodCA/ICQkLmN1cnJlbnRXaWR0aCAtIGxlZ2VuZFdpZHRoIDogJCQuaXNMZWdlbmRJbnNldCA/IGluc2V0TGVnZW5kUG9zaXRpb24ubGVmdCA6IDBcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnRyYW5zZm9ybUxlZ2VuZCA9IGZ1bmN0aW9uICh3aXRoVHJhbnNpdGlvbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICAod2l0aFRyYW5zaXRpb24gPyAkJC5sZWdlbmQudHJhbnNpdGlvbigpIDogJCQubGVnZW5kKS5hdHRyKFwidHJhbnNmb3JtXCIsICQkLmdldFRyYW5zbGF0ZSgnbGVnZW5kJykpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlTGVnZW5kU3RlcCA9IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICAgIHRoaXMubGVnZW5kU3RlcCA9IHN0ZXA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVMZWdlbmRJdGVtV2lkdGggPSBmdW5jdGlvbiAodykge1xuICAgICAgICB0aGlzLmxlZ2VuZEl0ZW1XaWR0aCA9IHc7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVMZWdlbmRJdGVtSGVpZ2h0ID0gZnVuY3Rpb24gKGgpIHtcbiAgICAgICAgdGhpcy5sZWdlbmRJdGVtSGVpZ2h0ID0gaDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldExlZ2VuZFdpZHRoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gJCQuY29uZmlnLmxlZ2VuZF9zaG93ID8gJCQuaXNMZWdlbmRSaWdodCB8fCAkJC5pc0xlZ2VuZEluc2V0ID8gJCQubGVnZW5kSXRlbVdpZHRoICogKCQkLmxlZ2VuZFN0ZXAgKyAxKSA6ICQkLmN1cnJlbnRXaWR0aCA6IDA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRMZWdlbmRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBoID0gMDtcbiAgICAgICAgaWYgKCQkLmNvbmZpZy5sZWdlbmRfc2hvdykge1xuICAgICAgICAgICAgaWYgKCQkLmlzTGVnZW5kUmlnaHQpIHtcbiAgICAgICAgICAgICAgICBoID0gJCQuY3VycmVudEhlaWdodDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaCA9IE1hdGgubWF4KDIwLCAkJC5sZWdlbmRJdGVtSGVpZ2h0KSAqICgkJC5sZWdlbmRTdGVwICsgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGg7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5vcGFjaXR5Rm9yTGVnZW5kID0gZnVuY3Rpb24gKGxlZ2VuZEl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGxlZ2VuZEl0ZW0uY2xhc3NlZChDTEFTUy5sZWdlbmRJdGVtSGlkZGVuKSA/IG51bGwgOiAxO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ub3BhY2l0eUZvclVuZm9jdXNlZExlZ2VuZCA9IGZ1bmN0aW9uIChsZWdlbmRJdGVtKSB7XG4gICAgICAgIHJldHVybiBsZWdlbmRJdGVtLmNsYXNzZWQoQ0xBU1MubGVnZW5kSXRlbUhpZGRlbikgPyBudWxsIDogMC4zO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udG9nZ2xlRm9jdXNMZWdlbmQgPSBmdW5jdGlvbiAodGFyZ2V0SWRzLCBmb2N1cykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICB0YXJnZXRJZHMgPSAkJC5tYXBUb1RhcmdldElkcyh0YXJnZXRJZHMpO1xuICAgICAgICAkJC5sZWdlbmQuc2VsZWN0QWxsKCcuJyArIENMQVNTLmxlZ2VuZEl0ZW0pLmZpbHRlcihmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRJZHMuaW5kZXhPZihpZCkgPj0gMDtcbiAgICAgICAgfSkuY2xhc3NlZChDTEFTUy5sZWdlbmRJdGVtRm9jdXNlZCwgZm9jdXMpLnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDApLnN0eWxlKCdvcGFjaXR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG9wYWNpdHkgPSBmb2N1cyA/ICQkLm9wYWNpdHlGb3JMZWdlbmQgOiAkJC5vcGFjaXR5Rm9yVW5mb2N1c2VkTGVnZW5kO1xuICAgICAgICAgICAgcmV0dXJuIG9wYWNpdHkuY2FsbCgkJCwgJCQuZDMuc2VsZWN0KHRoaXMpKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5yZXZlcnRMZWdlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBkMyA9ICQkLmQzO1xuICAgICAgICAkJC5sZWdlbmQuc2VsZWN0QWxsKCcuJyArIENMQVNTLmxlZ2VuZEl0ZW0pLmNsYXNzZWQoQ0xBU1MubGVnZW5kSXRlbUZvY3VzZWQsIGZhbHNlKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwKS5zdHlsZSgnb3BhY2l0eScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5vcGFjaXR5Rm9yTGVnZW5kKGQzLnNlbGVjdCh0aGlzKSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uc2hvd0xlZ2VuZCA9IGZ1bmN0aW9uICh0YXJnZXRJZHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgaWYgKCFjb25maWcubGVnZW5kX3Nob3cpIHtcbiAgICAgICAgICAgIGNvbmZpZy5sZWdlbmRfc2hvdyA9IHRydWU7XG4gICAgICAgICAgICAkJC5sZWdlbmQuc3R5bGUoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuICAgICAgICAgICAgaWYgKCEkJC5sZWdlbmRIYXNSZW5kZXJlZCkge1xuICAgICAgICAgICAgICAgICQkLnVwZGF0ZUxlZ2VuZFdpdGhEZWZhdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgICQkLnJlbW92ZUhpZGRlbkxlZ2VuZElkcyh0YXJnZXRJZHMpO1xuICAgICAgICAkJC5sZWdlbmQuc2VsZWN0QWxsKCQkLnNlbGVjdG9yTGVnZW5kcyh0YXJnZXRJZHMpKS5zdHlsZSgndmlzaWJpbGl0eScsICd2aXNpYmxlJykudHJhbnNpdGlvbigpLnN0eWxlKCdvcGFjaXR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLm9wYWNpdHlGb3JMZWdlbmQoJCQuZDMuc2VsZWN0KHRoaXMpKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5oaWRlTGVnZW5kID0gZnVuY3Rpb24gKHRhcmdldElkcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICBpZiAoY29uZmlnLmxlZ2VuZF9zaG93ICYmIGlzRW1wdHkodGFyZ2V0SWRzKSkge1xuICAgICAgICAgICAgY29uZmlnLmxlZ2VuZF9zaG93ID0gZmFsc2U7XG4gICAgICAgICAgICAkJC5sZWdlbmQuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIH1cbiAgICAgICAgJCQuYWRkSGlkZGVuTGVnZW5kSWRzKHRhcmdldElkcyk7XG4gICAgICAgICQkLmxlZ2VuZC5zZWxlY3RBbGwoJCQuc2VsZWN0b3JMZWdlbmRzKHRhcmdldElkcykpLnN0eWxlKCdvcGFjaXR5JywgMCkuc3R5bGUoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGVhckxlZ2VuZEl0ZW1UZXh0Qm94Q2FjaGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubGVnZW5kSXRlbVRleHRCb3ggPSB7fTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZUxlZ2VuZCA9IGZ1bmN0aW9uICh0YXJnZXRJZHMsIG9wdGlvbnMsIHRyYW5zaXRpb25zKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIHZhciB4Rm9yTGVnZW5kLCB4Rm9yTGVnZW5kVGV4dCwgeEZvckxlZ2VuZFJlY3QsIHlGb3JMZWdlbmQsIHlGb3JMZWdlbmRUZXh0LCB5Rm9yTGVnZW5kUmVjdCwgeDFGb3JMZWdlbmRUaWxlLCB4MkZvckxlZ2VuZFRpbGUsIHlGb3JMZWdlbmRUaWxlO1xuICAgICAgICB2YXIgcGFkZGluZ1RvcCA9IDQsXG4gICAgICAgICAgICBwYWRkaW5nUmlnaHQgPSAxMCxcbiAgICAgICAgICAgIG1heFdpZHRoID0gMCxcbiAgICAgICAgICAgIG1heEhlaWdodCA9IDAsXG4gICAgICAgICAgICBwb3NNaW4gPSAxMCxcbiAgICAgICAgICAgIHRpbGVXaWR0aCA9IGNvbmZpZy5sZWdlbmRfaXRlbV90aWxlX3dpZHRoICsgNTtcbiAgICAgICAgdmFyIGwsXG4gICAgICAgICAgICB0b3RhbExlbmd0aCA9IDAsXG4gICAgICAgICAgICBvZmZzZXRzID0ge30sXG4gICAgICAgICAgICB3aWR0aHMgPSB7fSxcbiAgICAgICAgICAgIGhlaWdodHMgPSB7fSxcbiAgICAgICAgICAgIG1hcmdpbnMgPSBbMF0sXG4gICAgICAgICAgICBzdGVwcyA9IHt9LFxuICAgICAgICAgICAgc3RlcCA9IDA7XG4gICAgICAgIHZhciB3aXRoVHJhbnNpdGlvbiwgd2l0aFRyYW5zaXRpb25Gb3JUcmFuc2Zvcm07XG4gICAgICAgIHZhciB0ZXh0cywgcmVjdHMsIHRpbGVzLCBiYWNrZ3JvdW5kO1xuXG4gICAgICAgIC8vIFNraXAgZWxlbWVudHMgd2hlbiB0aGVpciBuYW1lIGlzIHNldCB0byBudWxsXG4gICAgICAgIHRhcmdldElkcyA9IHRhcmdldElkcy5maWx0ZXIoZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gIWlzRGVmaW5lZChjb25maWcuZGF0YV9uYW1lc1tpZF0pIHx8IGNvbmZpZy5kYXRhX25hbWVzW2lkXSAhPT0gbnVsbDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgIHdpdGhUcmFuc2l0aW9uID0gZ2V0T3B0aW9uKG9wdGlvbnMsIFwid2l0aFRyYW5zaXRpb25cIiwgdHJ1ZSk7XG4gICAgICAgIHdpdGhUcmFuc2l0aW9uRm9yVHJhbnNmb3JtID0gZ2V0T3B0aW9uKG9wdGlvbnMsIFwid2l0aFRyYW5zaXRpb25Gb3JUcmFuc2Zvcm1cIiwgdHJ1ZSk7XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VGV4dEJveCh0ZXh0RWxlbWVudCwgaWQpIHtcbiAgICAgICAgICAgIGlmICghJCQubGVnZW5kSXRlbVRleHRCb3hbaWRdKSB7XG4gICAgICAgICAgICAgICAgJCQubGVnZW5kSXRlbVRleHRCb3hbaWRdID0gJCQuZ2V0VGV4dFJlY3QodGV4dEVsZW1lbnQudGV4dENvbnRlbnQsIENMQVNTLmxlZ2VuZEl0ZW0sIHRleHRFbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkJC5sZWdlbmRJdGVtVGV4dEJveFtpZF07XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVQb3NpdGlvbnModGV4dEVsZW1lbnQsIGlkLCBpbmRleCkge1xuICAgICAgICAgICAgdmFyIHJlc2V0ID0gaW5kZXggPT09IDAsXG4gICAgICAgICAgICAgICAgaXNMYXN0ID0gaW5kZXggPT09IHRhcmdldElkcy5sZW5ndGggLSAxLFxuICAgICAgICAgICAgICAgIGJveCA9IGdldFRleHRCb3godGV4dEVsZW1lbnQsIGlkKSxcbiAgICAgICAgICAgICAgICBpdGVtV2lkdGggPSBib3gud2lkdGggKyB0aWxlV2lkdGggKyAoaXNMYXN0ICYmICEoJCQuaXNMZWdlbmRSaWdodCB8fCAkJC5pc0xlZ2VuZEluc2V0KSA/IDAgOiBwYWRkaW5nUmlnaHQpICsgY29uZmlnLmxlZ2VuZF9wYWRkaW5nLFxuICAgICAgICAgICAgICAgIGl0ZW1IZWlnaHQgPSBib3guaGVpZ2h0ICsgcGFkZGluZ1RvcCxcbiAgICAgICAgICAgICAgICBpdGVtTGVuZ3RoID0gJCQuaXNMZWdlbmRSaWdodCB8fCAkJC5pc0xlZ2VuZEluc2V0ID8gaXRlbUhlaWdodCA6IGl0ZW1XaWR0aCxcbiAgICAgICAgICAgICAgICBhcmVhTGVuZ3RoID0gJCQuaXNMZWdlbmRSaWdodCB8fCAkJC5pc0xlZ2VuZEluc2V0ID8gJCQuZ2V0TGVnZW5kSGVpZ2h0KCkgOiAkJC5nZXRMZWdlbmRXaWR0aCgpLFxuICAgICAgICAgICAgICAgIG1hcmdpbixcbiAgICAgICAgICAgICAgICBtYXhMZW5ndGg7XG5cbiAgICAgICAgICAgIC8vIE1FTU86IGNhcmUgYWJvdXQgY29uZGlmaW9uIG9mIHN0ZXAsIHRvdGFsTGVuZ3RoXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZXMoaWQsIHdpdGhvdXRTdGVwKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF3aXRob3V0U3RlcCkge1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4gPSAoYXJlYUxlbmd0aCAtIHRvdGFsTGVuZ3RoIC0gaXRlbUxlbmd0aCkgLyAyO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWFyZ2luIDwgcG9zTWluKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW4gPSAoYXJlYUxlbmd0aCAtIGl0ZW1MZW5ndGgpIC8gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXArKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGVwc1tpZF0gPSBzdGVwO1xuICAgICAgICAgICAgICAgIG1hcmdpbnNbc3RlcF0gPSAkJC5pc0xlZ2VuZEluc2V0ID8gMTAgOiBtYXJnaW47XG4gICAgICAgICAgICAgICAgb2Zmc2V0c1tpZF0gPSB0b3RhbExlbmd0aDtcbiAgICAgICAgICAgICAgICB0b3RhbExlbmd0aCArPSBpdGVtTGVuZ3RoO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzZXQpIHtcbiAgICAgICAgICAgICAgICB0b3RhbExlbmd0aCA9IDA7XG4gICAgICAgICAgICAgICAgc3RlcCA9IDA7XG4gICAgICAgICAgICAgICAgbWF4V2lkdGggPSAwO1xuICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IDA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjb25maWcubGVnZW5kX3Nob3cgJiYgISQkLmlzTGVnZW5kVG9TaG93KGlkKSkge1xuICAgICAgICAgICAgICAgIHdpZHRoc1tpZF0gPSBoZWlnaHRzW2lkXSA9IHN0ZXBzW2lkXSA9IG9mZnNldHNbaWRdID0gMDtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdpZHRoc1tpZF0gPSBpdGVtV2lkdGg7XG4gICAgICAgICAgICBoZWlnaHRzW2lkXSA9IGl0ZW1IZWlnaHQ7XG5cbiAgICAgICAgICAgIGlmICghbWF4V2lkdGggfHwgaXRlbVdpZHRoID49IG1heFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgbWF4V2lkdGggPSBpdGVtV2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIW1heEhlaWdodCB8fCBpdGVtSGVpZ2h0ID49IG1heEhlaWdodCkge1xuICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IGl0ZW1IZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtYXhMZW5ndGggPSAkJC5pc0xlZ2VuZFJpZ2h0IHx8ICQkLmlzTGVnZW5kSW5zZXQgPyBtYXhIZWlnaHQgOiBtYXhXaWR0aDtcblxuICAgICAgICAgICAgaWYgKGNvbmZpZy5sZWdlbmRfZXF1YWxseSkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHdpZHRocykuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGhzW2lkXSA9IG1heFdpZHRoO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGhlaWdodHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodHNbaWRdID0gbWF4SGVpZ2h0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG1hcmdpbiA9IChhcmVhTGVuZ3RoIC0gbWF4TGVuZ3RoICogdGFyZ2V0SWRzLmxlbmd0aCkgLyAyO1xuICAgICAgICAgICAgICAgIGlmIChtYXJnaW4gPCBwb3NNaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxMZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgICAgICBzdGVwID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SWRzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVWYWx1ZXMoaWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVWYWx1ZXMoaWQsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlVmFsdWVzKGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkJC5pc0xlZ2VuZEluc2V0KSB7XG4gICAgICAgICAgICBzdGVwID0gY29uZmlnLmxlZ2VuZF9pbnNldF9zdGVwID8gY29uZmlnLmxlZ2VuZF9pbnNldF9zdGVwIDogdGFyZ2V0SWRzLmxlbmd0aDtcbiAgICAgICAgICAgICQkLnVwZGF0ZUxlZ2VuZFN0ZXAoc3RlcCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJCQuaXNMZWdlbmRSaWdodCkge1xuICAgICAgICAgICAgeEZvckxlZ2VuZCA9IGZ1bmN0aW9uIHhGb3JMZWdlbmQoaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF4V2lkdGggKiBzdGVwc1tpZF07XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeUZvckxlZ2VuZCA9IGZ1bmN0aW9uIHlGb3JMZWdlbmQoaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFyZ2luc1tzdGVwc1tpZF1dICsgb2Zmc2V0c1tpZF07XG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2UgaWYgKCQkLmlzTGVnZW5kSW5zZXQpIHtcbiAgICAgICAgICAgIHhGb3JMZWdlbmQgPSBmdW5jdGlvbiB4Rm9yTGVnZW5kKGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1heFdpZHRoICogc3RlcHNbaWRdICsgMTA7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeUZvckxlZ2VuZCA9IGZ1bmN0aW9uIHlGb3JMZWdlbmQoaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFyZ2luc1tzdGVwc1tpZF1dICsgb2Zmc2V0c1tpZF07XG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeEZvckxlZ2VuZCA9IGZ1bmN0aW9uIHhGb3JMZWdlbmQoaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFyZ2luc1tzdGVwc1tpZF1dICsgb2Zmc2V0c1tpZF07XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeUZvckxlZ2VuZCA9IGZ1bmN0aW9uIHlGb3JMZWdlbmQoaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF4SGVpZ2h0ICogc3RlcHNbaWRdO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICB4Rm9yTGVnZW5kVGV4dCA9IGZ1bmN0aW9uIHhGb3JMZWdlbmRUZXh0KGlkLCBpKSB7XG4gICAgICAgICAgICByZXR1cm4geEZvckxlZ2VuZChpZCwgaSkgKyA0ICsgY29uZmlnLmxlZ2VuZF9pdGVtX3RpbGVfd2lkdGg7XG4gICAgICAgIH07XG4gICAgICAgIHlGb3JMZWdlbmRUZXh0ID0gZnVuY3Rpb24geUZvckxlZ2VuZFRleHQoaWQsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiB5Rm9yTGVnZW5kKGlkLCBpKSArIDk7XG4gICAgICAgIH07XG4gICAgICAgIHhGb3JMZWdlbmRSZWN0ID0gZnVuY3Rpb24geEZvckxlZ2VuZFJlY3QoaWQsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiB4Rm9yTGVnZW5kKGlkLCBpKTtcbiAgICAgICAgfTtcbiAgICAgICAgeUZvckxlZ2VuZFJlY3QgPSBmdW5jdGlvbiB5Rm9yTGVnZW5kUmVjdChpZCwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIHlGb3JMZWdlbmQoaWQsIGkpIC0gNTtcbiAgICAgICAgfTtcbiAgICAgICAgeDFGb3JMZWdlbmRUaWxlID0gZnVuY3Rpb24geDFGb3JMZWdlbmRUaWxlKGlkLCBpKSB7XG4gICAgICAgICAgICByZXR1cm4geEZvckxlZ2VuZChpZCwgaSkgLSAyO1xuICAgICAgICB9O1xuICAgICAgICB4MkZvckxlZ2VuZFRpbGUgPSBmdW5jdGlvbiB4MkZvckxlZ2VuZFRpbGUoaWQsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiB4Rm9yTGVnZW5kKGlkLCBpKSAtIDIgKyBjb25maWcubGVnZW5kX2l0ZW1fdGlsZV93aWR0aDtcbiAgICAgICAgfTtcbiAgICAgICAgeUZvckxlZ2VuZFRpbGUgPSBmdW5jdGlvbiB5Rm9yTGVnZW5kVGlsZShpZCwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIHlGb3JMZWdlbmQoaWQsIGkpICsgNDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBEZWZpbmUgZyBmb3IgbGVnZW5kIGFyZWFcbiAgICAgICAgbCA9ICQkLmxlZ2VuZC5zZWxlY3RBbGwoJy4nICsgQ0xBU1MubGVnZW5kSXRlbSkuZGF0YSh0YXJnZXRJZHMpLmVudGVyKCkuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5nZW5lcmF0ZUNsYXNzKENMQVNTLmxlZ2VuZEl0ZW0sIGlkKTtcbiAgICAgICAgfSkuc3R5bGUoJ3Zpc2liaWxpdHknLCBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5pc0xlZ2VuZFRvU2hvdyhpZCkgPyAndmlzaWJsZScgOiAnaGlkZGVuJztcbiAgICAgICAgfSkuc3R5bGUoJ2N1cnNvcicsICdwb2ludGVyJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnLmxlZ2VuZF9pdGVtX29uY2xpY2spIHtcbiAgICAgICAgICAgICAgICBjb25maWcubGVnZW5kX2l0ZW1fb25jbGljay5jYWxsKCQkLCBpZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICgkJC5kMy5ldmVudC5hbHRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgJCQuYXBpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJCQuYXBpLnNob3coaWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQkLmFwaS50b2dnbGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAkJC5pc1RhcmdldFRvU2hvdyhpZCkgPyAkJC5hcGkuZm9jdXMoaWQpIDogJCQuYXBpLnJldmVydCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgaWYgKGNvbmZpZy5sZWdlbmRfaXRlbV9vbm1vdXNlb3Zlcikge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5sZWdlbmRfaXRlbV9vbm1vdXNlb3Zlci5jYWxsKCQkLCBpZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQkLmQzLnNlbGVjdCh0aGlzKS5jbGFzc2VkKENMQVNTLmxlZ2VuZEl0ZW1Gb2N1c2VkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBpZiAoISQkLnRyYW5zaXRpbmcgJiYgJCQuaXNUYXJnZXRUb1Nob3coaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICQkLmFwaS5mb2N1cyhpZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIGlmIChjb25maWcubGVnZW5kX2l0ZW1fb25tb3VzZW91dCkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5sZWdlbmRfaXRlbV9vbm1vdXNlb3V0LmNhbGwoJCQsIGlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCQuZDMuc2VsZWN0KHRoaXMpLmNsYXNzZWQoQ0xBU1MubGVnZW5kSXRlbUZvY3VzZWQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAkJC5hcGkucmV2ZXJ0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBsLmFwcGVuZCgndGV4dCcpLnRleHQoZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNEZWZpbmVkKGNvbmZpZy5kYXRhX25hbWVzW2lkXSkgPyBjb25maWcuZGF0YV9uYW1lc1tpZF0gOiBpZDtcbiAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAoaWQsIGkpIHtcbiAgICAgICAgICAgIHVwZGF0ZVBvc2l0aW9ucyh0aGlzLCBpZCwgaSk7XG4gICAgICAgIH0pLnN0eWxlKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpLmF0dHIoJ3gnLCAkJC5pc0xlZ2VuZFJpZ2h0IHx8ICQkLmlzTGVnZW5kSW5zZXQgPyB4Rm9yTGVnZW5kVGV4dCA6IC0yMDApLmF0dHIoJ3knLCAkJC5pc0xlZ2VuZFJpZ2h0IHx8ICQkLmlzTGVnZW5kSW5zZXQgPyAtMjAwIDogeUZvckxlZ2VuZFRleHQpO1xuICAgICAgICBsLmFwcGVuZCgncmVjdCcpLmF0dHIoXCJjbGFzc1wiLCBDTEFTUy5sZWdlbmRJdGVtRXZlbnQpLnN0eWxlKCdmaWxsLW9wYWNpdHknLCAwKS5hdHRyKCd4JywgJCQuaXNMZWdlbmRSaWdodCB8fCAkJC5pc0xlZ2VuZEluc2V0ID8geEZvckxlZ2VuZFJlY3QgOiAtMjAwKS5hdHRyKCd5JywgJCQuaXNMZWdlbmRSaWdodCB8fCAkJC5pc0xlZ2VuZEluc2V0ID8gLTIwMCA6IHlGb3JMZWdlbmRSZWN0KTtcbiAgICAgICAgbC5hcHBlbmQoJ2xpbmUnKS5hdHRyKCdjbGFzcycsIENMQVNTLmxlZ2VuZEl0ZW1UaWxlKS5zdHlsZSgnc3Ryb2tlJywgJCQuY29sb3IpLnN0eWxlKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpLmF0dHIoJ3gxJywgJCQuaXNMZWdlbmRSaWdodCB8fCAkJC5pc0xlZ2VuZEluc2V0ID8geDFGb3JMZWdlbmRUaWxlIDogLTIwMCkuYXR0cigneTEnLCAkJC5pc0xlZ2VuZFJpZ2h0IHx8ICQkLmlzTGVnZW5kSW5zZXQgPyAtMjAwIDogeUZvckxlZ2VuZFRpbGUpLmF0dHIoJ3gyJywgJCQuaXNMZWdlbmRSaWdodCB8fCAkJC5pc0xlZ2VuZEluc2V0ID8geDJGb3JMZWdlbmRUaWxlIDogLTIwMCkuYXR0cigneTInLCAkJC5pc0xlZ2VuZFJpZ2h0IHx8ICQkLmlzTGVnZW5kSW5zZXQgPyAtMjAwIDogeUZvckxlZ2VuZFRpbGUpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIGNvbmZpZy5sZWdlbmRfaXRlbV90aWxlX2hlaWdodCk7XG5cbiAgICAgICAgLy8gU2V0IGJhY2tncm91bmQgZm9yIGluc2V0IGxlZ2VuZFxuICAgICAgICBiYWNrZ3JvdW5kID0gJCQubGVnZW5kLnNlbGVjdCgnLicgKyBDTEFTUy5sZWdlbmRCYWNrZ3JvdW5kICsgJyByZWN0Jyk7XG4gICAgICAgIGlmICgkJC5pc0xlZ2VuZEluc2V0ICYmIG1heFdpZHRoID4gMCAmJiBiYWNrZ3JvdW5kLnNpemUoKSA9PT0gMCkge1xuICAgICAgICAgICAgYmFja2dyb3VuZCA9ICQkLmxlZ2VuZC5pbnNlcnQoJ2cnLCAnLicgKyBDTEFTUy5sZWdlbmRJdGVtKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MubGVnZW5kQmFja2dyb3VuZCkuYXBwZW5kKCdyZWN0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICB0ZXh0cyA9ICQkLmxlZ2VuZC5zZWxlY3RBbGwoJ3RleHQnKS5kYXRhKHRhcmdldElkcykudGV4dChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBpc0RlZmluZWQoY29uZmlnLmRhdGFfbmFtZXNbaWRdKSA/IGNvbmZpZy5kYXRhX25hbWVzW2lkXSA6IGlkO1xuICAgICAgICB9KSAvLyBNRU1POiBuZWVkZWQgZm9yIHVwZGF0ZVxuICAgICAgICAuZWFjaChmdW5jdGlvbiAoaWQsIGkpIHtcbiAgICAgICAgICAgIHVwZGF0ZVBvc2l0aW9ucyh0aGlzLCBpZCwgaSk7XG4gICAgICAgIH0pO1xuICAgICAgICAod2l0aFRyYW5zaXRpb24gPyB0ZXh0cy50cmFuc2l0aW9uKCkgOiB0ZXh0cykuYXR0cigneCcsIHhGb3JMZWdlbmRUZXh0KS5hdHRyKCd5JywgeUZvckxlZ2VuZFRleHQpO1xuXG4gICAgICAgIHJlY3RzID0gJCQubGVnZW5kLnNlbGVjdEFsbCgncmVjdC4nICsgQ0xBU1MubGVnZW5kSXRlbUV2ZW50KS5kYXRhKHRhcmdldElkcyk7XG4gICAgICAgICh3aXRoVHJhbnNpdGlvbiA/IHJlY3RzLnRyYW5zaXRpb24oKSA6IHJlY3RzKS5hdHRyKCd3aWR0aCcsIGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmV0dXJuIHdpZHRoc1tpZF07XG4gICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGhlaWdodHNbaWRdO1xuICAgICAgICB9KS5hdHRyKCd4JywgeEZvckxlZ2VuZFJlY3QpLmF0dHIoJ3knLCB5Rm9yTGVnZW5kUmVjdCk7XG5cbiAgICAgICAgdGlsZXMgPSAkJC5sZWdlbmQuc2VsZWN0QWxsKCdsaW5lLicgKyBDTEFTUy5sZWdlbmRJdGVtVGlsZSkuZGF0YSh0YXJnZXRJZHMpO1xuICAgICAgICAod2l0aFRyYW5zaXRpb24gPyB0aWxlcy50cmFuc2l0aW9uKCkgOiB0aWxlcykuc3R5bGUoJ3N0cm9rZScsICQkLmNvbG9yKS5hdHRyKCd4MScsIHgxRm9yTGVnZW5kVGlsZSkuYXR0cigneTEnLCB5Rm9yTGVnZW5kVGlsZSkuYXR0cigneDInLCB4MkZvckxlZ2VuZFRpbGUpLmF0dHIoJ3kyJywgeUZvckxlZ2VuZFRpbGUpO1xuXG4gICAgICAgIGlmIChiYWNrZ3JvdW5kKSB7XG4gICAgICAgICAgICAod2l0aFRyYW5zaXRpb24gPyBiYWNrZ3JvdW5kLnRyYW5zaXRpb24oKSA6IGJhY2tncm91bmQpLmF0dHIoJ2hlaWdodCcsICQkLmdldExlZ2VuZEhlaWdodCgpIC0gMTIpLmF0dHIoJ3dpZHRoJywgbWF4V2lkdGggKiAoc3RlcCArIDEpICsgMTApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG9nZ2xlIGxlZ2VuZCBzdGF0ZVxuICAgICAgICAkJC5sZWdlbmQuc2VsZWN0QWxsKCcuJyArIENMQVNTLmxlZ2VuZEl0ZW0pLmNsYXNzZWQoQ0xBU1MubGVnZW5kSXRlbUhpZGRlbiwgZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gISQkLmlzVGFyZ2V0VG9TaG93KGlkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGFsbCB0byByZWZsZWN0IGNoYW5nZSBvZiBsZWdlbmRcbiAgICAgICAgJCQudXBkYXRlTGVnZW5kSXRlbVdpZHRoKG1heFdpZHRoKTtcbiAgICAgICAgJCQudXBkYXRlTGVnZW5kSXRlbUhlaWdodChtYXhIZWlnaHQpO1xuICAgICAgICAkJC51cGRhdGVMZWdlbmRTdGVwKHN0ZXApO1xuICAgICAgICAvLyBVcGRhdGUgc2l6ZSBhbmQgc2NhbGVcbiAgICAgICAgJCQudXBkYXRlU2l6ZXMoKTtcbiAgICAgICAgJCQudXBkYXRlU2NhbGVzKCk7XG4gICAgICAgICQkLnVwZGF0ZVN2Z1NpemUoKTtcbiAgICAgICAgLy8gVXBkYXRlIGcgcG9zaXRpb25zXG4gICAgICAgICQkLnRyYW5zZm9ybUFsbCh3aXRoVHJhbnNpdGlvbkZvclRyYW5zZm9ybSwgdHJhbnNpdGlvbnMpO1xuICAgICAgICAkJC5sZWdlbmRIYXNSZW5kZXJlZCA9IHRydWU7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmluaXRUaXRsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgJCQudGl0bGUgPSAkJC5zdmcuYXBwZW5kKFwidGV4dFwiKS50ZXh0KCQkLmNvbmZpZy50aXRsZV90ZXh0KS5hdHRyKFwiY2xhc3NcIiwgJCQuQ0xBU1MudGl0bGUpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVkcmF3VGl0bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgICQkLnRpdGxlLmF0dHIoXCJ4XCIsICQkLnhGb3JUaXRsZS5iaW5kKCQkKSkuYXR0cihcInlcIiwgJCQueUZvclRpdGxlLmJpbmQoJCQpKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnhGb3JUaXRsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIHBvc2l0aW9uID0gY29uZmlnLnRpdGxlX3Bvc2l0aW9uIHx8ICdsZWZ0JyxcbiAgICAgICAgICAgIHg7XG4gICAgICAgIGlmIChwb3NpdGlvbi5pbmRleE9mKCdyaWdodCcpID49IDApIHtcbiAgICAgICAgICAgIHggPSAkJC5jdXJyZW50V2lkdGggLSAkJC5nZXRUZXh0UmVjdCgkJC50aXRsZS5ub2RlKCkudGV4dENvbnRlbnQsICQkLkNMQVNTLnRpdGxlLCAkJC50aXRsZS5ub2RlKCkpLndpZHRoIC0gY29uZmlnLnRpdGxlX3BhZGRpbmcucmlnaHQ7XG4gICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24uaW5kZXhPZignY2VudGVyJykgPj0gMCkge1xuICAgICAgICAgICAgeCA9ICgkJC5jdXJyZW50V2lkdGggLSAkJC5nZXRUZXh0UmVjdCgkJC50aXRsZS5ub2RlKCkudGV4dENvbnRlbnQsICQkLkNMQVNTLnRpdGxlLCAkJC50aXRsZS5ub2RlKCkpLndpZHRoKSAvIDI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBsZWZ0XG4gICAgICAgICAgICB4ID0gY29uZmlnLnRpdGxlX3BhZGRpbmcubGVmdDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnlGb3JUaXRsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgcmV0dXJuICQkLmNvbmZpZy50aXRsZV9wYWRkaW5nLnRvcCArICQkLmdldFRleHRSZWN0KCQkLnRpdGxlLm5vZGUoKS50ZXh0Q29udGVudCwgJCQuQ0xBU1MudGl0bGUsICQkLnRpdGxlLm5vZGUoKSkuaGVpZ2h0O1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0VGl0bGVQYWRkaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gJCQueUZvclRpdGxlKCkgKyAkJC5jb25maWcudGl0bGVfcGFkZGluZy5ib3R0b207XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIEF4aXMob3duZXIpIHtcbiAgICAgICAgQVBJLmNhbGwodGhpcywgb3duZXIpO1xuICAgIH1cblxuICAgIGluaGVyaXQoQVBJLCBBeGlzKTtcblxuICAgIEF4aXMucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBpbml0KCkge1xuXG4gICAgICAgIHZhciAkJCA9IHRoaXMub3duZXIsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBtYWluID0gJCQubWFpbjtcbiAgICAgICAgJCQuYXhlcy54ID0gbWFpbi5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBDTEFTUy5heGlzICsgJyAnICsgQ0xBU1MuYXhpc1gpLmF0dHIoXCJjbGlwLXBhdGhcIiwgJCQuY2xpcFBhdGhGb3JYQXhpcykuYXR0cihcInRyYW5zZm9ybVwiLCAkJC5nZXRUcmFuc2xhdGUoJ3gnKSkuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIGNvbmZpZy5heGlzX3hfc2hvdyA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nKTtcbiAgICAgICAgJCQuYXhlcy54LmFwcGVuZChcInRleHRcIikuYXR0cihcImNsYXNzXCIsIENMQVNTLmF4aXNYTGFiZWwpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgY29uZmlnLmF4aXNfcm90YXRlZCA/IFwicm90YXRlKC05MClcIiA6IFwiXCIpLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgdGhpcy50ZXh0QW5jaG9yRm9yWEF4aXNMYWJlbC5iaW5kKHRoaXMpKTtcbiAgICAgICAgJCQuYXhlcy55ID0gbWFpbi5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBDTEFTUy5heGlzICsgJyAnICsgQ0xBU1MuYXhpc1kpLmF0dHIoXCJjbGlwLXBhdGhcIiwgY29uZmlnLmF4aXNfeV9pbm5lciA/IFwiXCIgOiAkJC5jbGlwUGF0aEZvcllBeGlzKS5hdHRyKFwidHJhbnNmb3JtXCIsICQkLmdldFRyYW5zbGF0ZSgneScpKS5zdHlsZShcInZpc2liaWxpdHlcIiwgY29uZmlnLmF4aXNfeV9zaG93ID8gJ3Zpc2libGUnIDogJ2hpZGRlbicpO1xuICAgICAgICAkJC5heGVzLnkuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MuYXhpc1lMYWJlbCkuYXR0cihcInRyYW5zZm9ybVwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gXCJcIiA6IFwicm90YXRlKC05MClcIikuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCB0aGlzLnRleHRBbmNob3JGb3JZQXhpc0xhYmVsLmJpbmQodGhpcykpO1xuXG4gICAgICAgICQkLmF4ZXMueTIgPSBtYWluLmFwcGVuZChcImdcIikuYXR0cihcImNsYXNzXCIsIENMQVNTLmF4aXMgKyAnICcgKyBDTEFTUy5heGlzWTIpXG4gICAgICAgIC8vIGNsaXAtcGF0aD9cbiAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgJCQuZ2V0VHJhbnNsYXRlKCd5MicpKS5zdHlsZShcInZpc2liaWxpdHlcIiwgY29uZmlnLmF4aXNfeTJfc2hvdyA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nKTtcbiAgICAgICAgJCQuYXhlcy55Mi5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJjbGFzc1wiLCBDTEFTUy5heGlzWTJMYWJlbCkuYXR0cihcInRyYW5zZm9ybVwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gXCJcIiA6IFwicm90YXRlKC05MClcIikuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCB0aGlzLnRleHRBbmNob3JGb3JZMkF4aXNMYWJlbC5iaW5kKHRoaXMpKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmdldFhBeGlzID0gZnVuY3Rpb24gZ2V0WEF4aXMoc2NhbGUsIG9yaWVudCwgdGlja0Zvcm1hdCwgdGlja1ZhbHVlcywgd2l0aE91dGVyVGljaywgd2l0aG91dFRyYW5zaXRpb24sIHdpdGhvdXRSb3RhdGVUaWNrVGV4dCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLm93bmVyLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgYXhpc1BhcmFtcyA9IHtcbiAgICAgICAgICAgIGlzQ2F0ZWdvcnk6ICQkLmlzQ2F0ZWdvcml6ZWQoKSxcbiAgICAgICAgICAgIHdpdGhPdXRlclRpY2s6IHdpdGhPdXRlclRpY2ssXG4gICAgICAgICAgICB0aWNrTXVsdGlsaW5lOiBjb25maWcuYXhpc194X3RpY2tfbXVsdGlsaW5lLFxuICAgICAgICAgICAgdGlja1dpZHRoOiBjb25maWcuYXhpc194X3RpY2tfd2lkdGgsXG4gICAgICAgICAgICB0aWNrVGV4dFJvdGF0ZTogd2l0aG91dFJvdGF0ZVRpY2tUZXh0ID8gMCA6IGNvbmZpZy5heGlzX3hfdGlja19yb3RhdGUsXG4gICAgICAgICAgICB3aXRob3V0VHJhbnNpdGlvbjogd2l0aG91dFRyYW5zaXRpb25cbiAgICAgICAgfSxcbiAgICAgICAgICAgIGF4aXMgPSBjM19heGlzKCQkLmQzLCBheGlzUGFyYW1zKS5zY2FsZShzY2FsZSkub3JpZW50KG9yaWVudCk7XG5cbiAgICAgICAgaWYgKCQkLmlzVGltZVNlcmllcygpICYmIHRpY2tWYWx1ZXMgJiYgdHlwZW9mIHRpY2tWYWx1ZXMgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgdGlja1ZhbHVlcyA9IHRpY2tWYWx1ZXMubWFwKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQkLnBhcnNlRGF0ZSh2KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHRpY2tcbiAgICAgICAgYXhpcy50aWNrRm9ybWF0KHRpY2tGb3JtYXQpLnRpY2tWYWx1ZXModGlja1ZhbHVlcyk7XG4gICAgICAgIGlmICgkJC5pc0NhdGVnb3JpemVkKCkpIHtcbiAgICAgICAgICAgIGF4aXMudGlja0NlbnRlcmVkKGNvbmZpZy5heGlzX3hfdGlja19jZW50ZXJlZCk7XG4gICAgICAgICAgICBpZiAoaXNFbXB0eShjb25maWcuYXhpc194X3RpY2tfY3VsbGluZykpIHtcbiAgICAgICAgICAgICAgICBjb25maWcuYXhpc194X3RpY2tfY3VsbGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGF4aXM7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS51cGRhdGVYQXhpc1RpY2tWYWx1ZXMgPSBmdW5jdGlvbiB1cGRhdGVYQXhpc1RpY2tWYWx1ZXModGFyZ2V0cywgYXhpcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLm93bmVyLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgdGlja1ZhbHVlcztcbiAgICAgICAgaWYgKGNvbmZpZy5heGlzX3hfdGlja19maXQgfHwgY29uZmlnLmF4aXNfeF90aWNrX2NvdW50KSB7XG4gICAgICAgICAgICB0aWNrVmFsdWVzID0gdGhpcy5nZW5lcmF0ZVRpY2tWYWx1ZXMoJCQubWFwVGFyZ2V0c1RvVW5pcXVlWHModGFyZ2V0cyksIGNvbmZpZy5heGlzX3hfdGlja19jb3VudCwgJCQuaXNUaW1lU2VyaWVzKCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChheGlzKSB7XG4gICAgICAgICAgICBheGlzLnRpY2tWYWx1ZXModGlja1ZhbHVlcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkJC54QXhpcy50aWNrVmFsdWVzKHRpY2tWYWx1ZXMpO1xuICAgICAgICAgICAgJCQuc3ViWEF4aXMudGlja1ZhbHVlcyh0aWNrVmFsdWVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGlja1ZhbHVlcztcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmdldFlBeGlzID0gZnVuY3Rpb24gZ2V0WUF4aXMoc2NhbGUsIG9yaWVudCwgdGlja0Zvcm1hdCwgdGlja1ZhbHVlcywgd2l0aE91dGVyVGljaywgd2l0aG91dFRyYW5zaXRpb24sIHdpdGhvdXRSb3RhdGVUaWNrVGV4dCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLm93bmVyLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgYXhpc1BhcmFtcyA9IHtcbiAgICAgICAgICAgIHdpdGhPdXRlclRpY2s6IHdpdGhPdXRlclRpY2ssXG4gICAgICAgICAgICB3aXRob3V0VHJhbnNpdGlvbjogd2l0aG91dFRyYW5zaXRpb24sXG4gICAgICAgICAgICB0aWNrVGV4dFJvdGF0ZTogd2l0aG91dFJvdGF0ZVRpY2tUZXh0ID8gMCA6IGNvbmZpZy5heGlzX3lfdGlja19yb3RhdGVcbiAgICAgICAgfSxcbiAgICAgICAgICAgIGF4aXMgPSBjM19heGlzKCQkLmQzLCBheGlzUGFyYW1zKS5zY2FsZShzY2FsZSkub3JpZW50KG9yaWVudCkudGlja0Zvcm1hdCh0aWNrRm9ybWF0KTtcbiAgICAgICAgaWYgKCQkLmlzVGltZVNlcmllc1koKSkge1xuICAgICAgICAgICAgYXhpcy50aWNrcygkJC5kMy50aW1lW2NvbmZpZy5heGlzX3lfdGlja190aW1lX3ZhbHVlXSwgY29uZmlnLmF4aXNfeV90aWNrX3RpbWVfaW50ZXJ2YWwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXhpcy50aWNrVmFsdWVzKHRpY2tWYWx1ZXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBheGlzO1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUuZ2V0SWQgPSBmdW5jdGlvbiBnZXRJZChpZCkge1xuICAgICAgICB2YXIgY29uZmlnID0gdGhpcy5vd25lci5jb25maWc7XG4gICAgICAgIHJldHVybiBpZCBpbiBjb25maWcuZGF0YV9heGVzID8gY29uZmlnLmRhdGFfYXhlc1tpZF0gOiAneSc7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5nZXRYQXhpc1RpY2tGb3JtYXQgPSBmdW5jdGlvbiBnZXRYQXhpc1RpY2tGb3JtYXQoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMub3duZXIsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBmb3JtYXQgPSAkJC5pc1RpbWVTZXJpZXMoKSA/ICQkLmRlZmF1bHRBeGlzVGltZUZvcm1hdCA6ICQkLmlzQ2F0ZWdvcml6ZWQoKSA/ICQkLmNhdGVnb3J5TmFtZSA6IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICByZXR1cm4gdiA8IDAgPyB2LnRvRml4ZWQoMCkgOiB2O1xuICAgICAgICB9O1xuICAgICAgICBpZiAoY29uZmlnLmF4aXNfeF90aWNrX2Zvcm1hdCkge1xuICAgICAgICAgICAgaWYgKGlzRnVuY3Rpb24oY29uZmlnLmF4aXNfeF90aWNrX2Zvcm1hdCkpIHtcbiAgICAgICAgICAgICAgICBmb3JtYXQgPSBjb25maWcuYXhpc194X3RpY2tfZm9ybWF0O1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkJC5pc1RpbWVTZXJpZXMoKSkge1xuICAgICAgICAgICAgICAgIGZvcm1hdCA9IGZ1bmN0aW9uIGZvcm1hdChkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlID8gJCQuYXhpc1RpbWVGb3JtYXQoY29uZmlnLmF4aXNfeF90aWNrX2Zvcm1hdCkoZGF0ZSkgOiBcIlwiO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzRnVuY3Rpb24oZm9ybWF0KSA/IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0LmNhbGwoJCQsIHYpO1xuICAgICAgICB9IDogZm9ybWF0O1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUuZ2V0VGlja1ZhbHVlcyA9IGZ1bmN0aW9uIGdldFRpY2tWYWx1ZXModGlja1ZhbHVlcywgYXhpcykge1xuICAgICAgICByZXR1cm4gdGlja1ZhbHVlcyA/IHRpY2tWYWx1ZXMgOiBheGlzID8gYXhpcy50aWNrVmFsdWVzKCkgOiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5nZXRYQXhpc1RpY2tWYWx1ZXMgPSBmdW5jdGlvbiBnZXRYQXhpc1RpY2tWYWx1ZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFRpY2tWYWx1ZXModGhpcy5vd25lci5jb25maWcuYXhpc194X3RpY2tfdmFsdWVzLCB0aGlzLm93bmVyLnhBeGlzKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmdldFlBeGlzVGlja1ZhbHVlcyA9IGZ1bmN0aW9uIGdldFlBeGlzVGlja1ZhbHVlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VGlja1ZhbHVlcyh0aGlzLm93bmVyLmNvbmZpZy5heGlzX3lfdGlja192YWx1ZXMsIHRoaXMub3duZXIueUF4aXMpO1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUuZ2V0WTJBeGlzVGlja1ZhbHVlcyA9IGZ1bmN0aW9uIGdldFkyQXhpc1RpY2tWYWx1ZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFRpY2tWYWx1ZXModGhpcy5vd25lci5jb25maWcuYXhpc195Ml90aWNrX3ZhbHVlcywgdGhpcy5vd25lci55MkF4aXMpO1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUuZ2V0TGFiZWxPcHRpb25CeUF4aXNJZCA9IGZ1bmN0aW9uIGdldExhYmVsT3B0aW9uQnlBeGlzSWQoYXhpc0lkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMub3duZXIsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBvcHRpb247XG4gICAgICAgIGlmIChheGlzSWQgPT09ICd5Jykge1xuICAgICAgICAgICAgb3B0aW9uID0gY29uZmlnLmF4aXNfeV9sYWJlbDtcbiAgICAgICAgfSBlbHNlIGlmIChheGlzSWQgPT09ICd5MicpIHtcbiAgICAgICAgICAgIG9wdGlvbiA9IGNvbmZpZy5heGlzX3kyX2xhYmVsO1xuICAgICAgICB9IGVsc2UgaWYgKGF4aXNJZCA9PT0gJ3gnKSB7XG4gICAgICAgICAgICBvcHRpb24gPSBjb25maWcuYXhpc194X2xhYmVsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvcHRpb247XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5nZXRMYWJlbFRleHQgPSBmdW5jdGlvbiBnZXRMYWJlbFRleHQoYXhpc0lkKSB7XG4gICAgICAgIHZhciBvcHRpb24gPSB0aGlzLmdldExhYmVsT3B0aW9uQnlBeGlzSWQoYXhpc0lkKTtcbiAgICAgICAgcmV0dXJuIGlzU3RyaW5nKG9wdGlvbikgPyBvcHRpb24gOiBvcHRpb24gPyBvcHRpb24udGV4dCA6IG51bGw7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5zZXRMYWJlbFRleHQgPSBmdW5jdGlvbiBzZXRMYWJlbFRleHQoYXhpc0lkLCB0ZXh0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMub3duZXIsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBvcHRpb24gPSB0aGlzLmdldExhYmVsT3B0aW9uQnlBeGlzSWQoYXhpc0lkKTtcbiAgICAgICAgaWYgKGlzU3RyaW5nKG9wdGlvbikpIHtcbiAgICAgICAgICAgIGlmIChheGlzSWQgPT09ICd5Jykge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5heGlzX3lfbGFiZWwgPSB0ZXh0O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChheGlzSWQgPT09ICd5MicpIHtcbiAgICAgICAgICAgICAgICBjb25maWcuYXhpc195Ml9sYWJlbCA9IHRleHQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGF4aXNJZCA9PT0gJ3gnKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmF4aXNfeF9sYWJlbCA9IHRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9uKSB7XG4gICAgICAgICAgICBvcHRpb24udGV4dCA9IHRleHQ7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmdldExhYmVsUG9zaXRpb24gPSBmdW5jdGlvbiBnZXRMYWJlbFBvc2l0aW9uKGF4aXNJZCwgZGVmYXVsdFBvc2l0aW9uKSB7XG4gICAgICAgIHZhciBvcHRpb24gPSB0aGlzLmdldExhYmVsT3B0aW9uQnlBeGlzSWQoYXhpc0lkKSxcbiAgICAgICAgICAgIHBvc2l0aW9uID0gb3B0aW9uICYmICh0eXBlb2Ygb3B0aW9uID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihvcHRpb24pKSA9PT0gJ29iamVjdCcgJiYgb3B0aW9uLnBvc2l0aW9uID8gb3B0aW9uLnBvc2l0aW9uIDogZGVmYXVsdFBvc2l0aW9uO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNJbm5lcjogcG9zaXRpb24uaW5kZXhPZignaW5uZXInKSA+PSAwLFxuICAgICAgICAgICAgaXNPdXRlcjogcG9zaXRpb24uaW5kZXhPZignb3V0ZXInKSA+PSAwLFxuICAgICAgICAgICAgaXNMZWZ0OiBwb3NpdGlvbi5pbmRleE9mKCdsZWZ0JykgPj0gMCxcbiAgICAgICAgICAgIGlzQ2VudGVyOiBwb3NpdGlvbi5pbmRleE9mKCdjZW50ZXInKSA+PSAwLFxuICAgICAgICAgICAgaXNSaWdodDogcG9zaXRpb24uaW5kZXhPZigncmlnaHQnKSA+PSAwLFxuICAgICAgICAgICAgaXNUb3A6IHBvc2l0aW9uLmluZGV4T2YoJ3RvcCcpID49IDAsXG4gICAgICAgICAgICBpc01pZGRsZTogcG9zaXRpb24uaW5kZXhPZignbWlkZGxlJykgPj0gMCxcbiAgICAgICAgICAgIGlzQm90dG9tOiBwb3NpdGlvbi5pbmRleE9mKCdib3R0b20nKSA+PSAwXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5nZXRYQXhpc0xhYmVsUG9zaXRpb24gPSBmdW5jdGlvbiBnZXRYQXhpc0xhYmVsUG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldExhYmVsUG9zaXRpb24oJ3gnLCB0aGlzLm93bmVyLmNvbmZpZy5heGlzX3JvdGF0ZWQgPyAnaW5uZXItdG9wJyA6ICdpbm5lci1yaWdodCcpO1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUuZ2V0WUF4aXNMYWJlbFBvc2l0aW9uID0gZnVuY3Rpb24gZ2V0WUF4aXNMYWJlbFBvc2l0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRMYWJlbFBvc2l0aW9uKCd5JywgdGhpcy5vd25lci5jb25maWcuYXhpc19yb3RhdGVkID8gJ2lubmVyLXJpZ2h0JyA6ICdpbm5lci10b3AnKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmdldFkyQXhpc0xhYmVsUG9zaXRpb24gPSBmdW5jdGlvbiBnZXRZMkF4aXNMYWJlbFBvc2l0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRMYWJlbFBvc2l0aW9uKCd5MicsIHRoaXMub3duZXIuY29uZmlnLmF4aXNfcm90YXRlZCA/ICdpbm5lci1yaWdodCcgOiAnaW5uZXItdG9wJyk7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5nZXRMYWJlbFBvc2l0aW9uQnlJZCA9IGZ1bmN0aW9uIGdldExhYmVsUG9zaXRpb25CeUlkKGlkKSB7XG4gICAgICAgIHJldHVybiBpZCA9PT0gJ3kyJyA/IHRoaXMuZ2V0WTJBeGlzTGFiZWxQb3NpdGlvbigpIDogaWQgPT09ICd5JyA/IHRoaXMuZ2V0WUF4aXNMYWJlbFBvc2l0aW9uKCkgOiB0aGlzLmdldFhBeGlzTGFiZWxQb3NpdGlvbigpO1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUudGV4dEZvclhBeGlzTGFiZWwgPSBmdW5jdGlvbiB0ZXh0Rm9yWEF4aXNMYWJlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGFiZWxUZXh0KCd4Jyk7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS50ZXh0Rm9yWUF4aXNMYWJlbCA9IGZ1bmN0aW9uIHRleHRGb3JZQXhpc0xhYmVsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRMYWJlbFRleHQoJ3knKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLnRleHRGb3JZMkF4aXNMYWJlbCA9IGZ1bmN0aW9uIHRleHRGb3JZMkF4aXNMYWJlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGFiZWxUZXh0KCd5MicpO1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUueEZvckF4aXNMYWJlbCA9IGZ1bmN0aW9uIHhGb3JBeGlzTGFiZWwoZm9ySG9yaXpvbnRhbCwgcG9zaXRpb24pIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5vd25lcjtcbiAgICAgICAgaWYgKGZvckhvcml6b250YWwpIHtcbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbi5pc0xlZnQgPyAwIDogcG9zaXRpb24uaXNDZW50ZXIgPyAkJC53aWR0aCAvIDIgOiAkJC53aWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbi5pc0JvdHRvbSA/IC0kJC5oZWlnaHQgOiBwb3NpdGlvbi5pc01pZGRsZSA/IC0kJC5oZWlnaHQgLyAyIDogMDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUuZHhGb3JBeGlzTGFiZWwgPSBmdW5jdGlvbiBkeEZvckF4aXNMYWJlbChmb3JIb3Jpem9udGFsLCBwb3NpdGlvbikge1xuICAgICAgICBpZiAoZm9ySG9yaXpvbnRhbCkge1xuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uLmlzTGVmdCA/IFwiMC41ZW1cIiA6IHBvc2l0aW9uLmlzUmlnaHQgPyBcIi0wLjVlbVwiIDogXCIwXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24uaXNUb3AgPyBcIi0wLjVlbVwiIDogcG9zaXRpb24uaXNCb3R0b20gPyBcIjAuNWVtXCIgOiBcIjBcIjtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUudGV4dEFuY2hvckZvckF4aXNMYWJlbCA9IGZ1bmN0aW9uIHRleHRBbmNob3JGb3JBeGlzTGFiZWwoZm9ySG9yaXpvbnRhbCwgcG9zaXRpb24pIHtcbiAgICAgICAgaWYgKGZvckhvcml6b250YWwpIHtcbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbi5pc0xlZnQgPyAnc3RhcnQnIDogcG9zaXRpb24uaXNDZW50ZXIgPyAnbWlkZGxlJyA6ICdlbmQnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uLmlzQm90dG9tID8gJ3N0YXJ0JyA6IHBvc2l0aW9uLmlzTWlkZGxlID8gJ21pZGRsZScgOiAnZW5kJztcbiAgICAgICAgfVxuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUueEZvclhBeGlzTGFiZWwgPSBmdW5jdGlvbiB4Rm9yWEF4aXNMYWJlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMueEZvckF4aXNMYWJlbCghdGhpcy5vd25lci5jb25maWcuYXhpc19yb3RhdGVkLCB0aGlzLmdldFhBeGlzTGFiZWxQb3NpdGlvbigpKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLnhGb3JZQXhpc0xhYmVsID0gZnVuY3Rpb24geEZvcllBeGlzTGFiZWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnhGb3JBeGlzTGFiZWwodGhpcy5vd25lci5jb25maWcuYXhpc19yb3RhdGVkLCB0aGlzLmdldFlBeGlzTGFiZWxQb3NpdGlvbigpKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLnhGb3JZMkF4aXNMYWJlbCA9IGZ1bmN0aW9uIHhGb3JZMkF4aXNMYWJlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMueEZvckF4aXNMYWJlbCh0aGlzLm93bmVyLmNvbmZpZy5heGlzX3JvdGF0ZWQsIHRoaXMuZ2V0WTJBeGlzTGFiZWxQb3NpdGlvbigpKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmR4Rm9yWEF4aXNMYWJlbCA9IGZ1bmN0aW9uIGR4Rm9yWEF4aXNMYWJlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZHhGb3JBeGlzTGFiZWwoIXRoaXMub3duZXIuY29uZmlnLmF4aXNfcm90YXRlZCwgdGhpcy5nZXRYQXhpc0xhYmVsUG9zaXRpb24oKSk7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5keEZvcllBeGlzTGFiZWwgPSBmdW5jdGlvbiBkeEZvcllBeGlzTGFiZWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmR4Rm9yQXhpc0xhYmVsKHRoaXMub3duZXIuY29uZmlnLmF4aXNfcm90YXRlZCwgdGhpcy5nZXRZQXhpc0xhYmVsUG9zaXRpb24oKSk7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5keEZvclkyQXhpc0xhYmVsID0gZnVuY3Rpb24gZHhGb3JZMkF4aXNMYWJlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZHhGb3JBeGlzTGFiZWwodGhpcy5vd25lci5jb25maWcuYXhpc19yb3RhdGVkLCB0aGlzLmdldFkyQXhpc0xhYmVsUG9zaXRpb24oKSk7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5keUZvclhBeGlzTGFiZWwgPSBmdW5jdGlvbiBkeUZvclhBeGlzTGFiZWwoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMub3duZXIsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuZ2V0WEF4aXNMYWJlbFBvc2l0aW9uKCk7XG4gICAgICAgIGlmIChjb25maWcuYXhpc19yb3RhdGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24uaXNJbm5lciA/IFwiMS4yZW1cIiA6IC0yNSAtIHRoaXMuZ2V0TWF4VGlja1dpZHRoKCd4Jyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24uaXNJbm5lciA/IFwiLTAuNWVtXCIgOiBjb25maWcuYXhpc194X2hlaWdodCA/IGNvbmZpZy5heGlzX3hfaGVpZ2h0IC0gMTAgOiBcIjNlbVwiO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5keUZvcllBeGlzTGFiZWwgPSBmdW5jdGlvbiBkeUZvcllBeGlzTGFiZWwoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMub3duZXIsXG4gICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuZ2V0WUF4aXNMYWJlbFBvc2l0aW9uKCk7XG4gICAgICAgIGlmICgkJC5jb25maWcuYXhpc19yb3RhdGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24uaXNJbm5lciA/IFwiLTAuNWVtXCIgOiBcIjNlbVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uLmlzSW5uZXIgPyBcIjEuMmVtXCIgOiAtMTAgLSAoJCQuY29uZmlnLmF4aXNfeV9pbm5lciA/IDAgOiB0aGlzLmdldE1heFRpY2tXaWR0aCgneScpICsgMTApO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5keUZvclkyQXhpc0xhYmVsID0gZnVuY3Rpb24gZHlGb3JZMkF4aXNMYWJlbCgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5vd25lcixcbiAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5nZXRZMkF4aXNMYWJlbFBvc2l0aW9uKCk7XG4gICAgICAgIGlmICgkJC5jb25maWcuYXhpc19yb3RhdGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24uaXNJbm5lciA/IFwiMS4yZW1cIiA6IFwiLTIuMmVtXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24uaXNJbm5lciA/IFwiLTAuNWVtXCIgOiAxNSArICgkJC5jb25maWcuYXhpc195Ml9pbm5lciA/IDAgOiB0aGlzLmdldE1heFRpY2tXaWR0aCgneTInKSArIDE1KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUudGV4dEFuY2hvckZvclhBeGlzTGFiZWwgPSBmdW5jdGlvbiB0ZXh0QW5jaG9yRm9yWEF4aXNMYWJlbCgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5vd25lcjtcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dEFuY2hvckZvckF4aXNMYWJlbCghJCQuY29uZmlnLmF4aXNfcm90YXRlZCwgdGhpcy5nZXRYQXhpc0xhYmVsUG9zaXRpb24oKSk7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS50ZXh0QW5jaG9yRm9yWUF4aXNMYWJlbCA9IGZ1bmN0aW9uIHRleHRBbmNob3JGb3JZQXhpc0xhYmVsKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLm93bmVyO1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0QW5jaG9yRm9yQXhpc0xhYmVsKCQkLmNvbmZpZy5heGlzX3JvdGF0ZWQsIHRoaXMuZ2V0WUF4aXNMYWJlbFBvc2l0aW9uKCkpO1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUudGV4dEFuY2hvckZvclkyQXhpc0xhYmVsID0gZnVuY3Rpb24gdGV4dEFuY2hvckZvclkyQXhpc0xhYmVsKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLm93bmVyO1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0QW5jaG9yRm9yQXhpc0xhYmVsKCQkLmNvbmZpZy5heGlzX3JvdGF0ZWQsIHRoaXMuZ2V0WTJBeGlzTGFiZWxQb3NpdGlvbigpKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmdldE1heFRpY2tXaWR0aCA9IGZ1bmN0aW9uIGdldE1heFRpY2tXaWR0aChpZCwgd2l0aG91dFJlY29tcHV0ZSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLm93bmVyLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgbWF4V2lkdGggPSAwLFxuICAgICAgICAgICAgdGFyZ2V0c1RvU2hvdyxcbiAgICAgICAgICAgIHNjYWxlLFxuICAgICAgICAgICAgYXhpcyxcbiAgICAgICAgICAgIGR1bW15LFxuICAgICAgICAgICAgc3ZnO1xuICAgICAgICBpZiAod2l0aG91dFJlY29tcHV0ZSAmJiAkJC5jdXJyZW50TWF4VGlja1dpZHRoc1tpZF0pIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5jdXJyZW50TWF4VGlja1dpZHRoc1tpZF07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCQkLnN2Zykge1xuICAgICAgICAgICAgdGFyZ2V0c1RvU2hvdyA9ICQkLmZpbHRlclRhcmdldHNUb1Nob3coJCQuZGF0YS50YXJnZXRzKTtcbiAgICAgICAgICAgIGlmIChpZCA9PT0gJ3knKSB7XG4gICAgICAgICAgICAgICAgc2NhbGUgPSAkJC55LmNvcHkoKS5kb21haW4oJCQuZ2V0WURvbWFpbih0YXJnZXRzVG9TaG93LCAneScpKTtcbiAgICAgICAgICAgICAgICBheGlzID0gdGhpcy5nZXRZQXhpcyhzY2FsZSwgJCQueU9yaWVudCwgY29uZmlnLmF4aXNfeV90aWNrX2Zvcm1hdCwgJCQueUF4aXNUaWNrVmFsdWVzLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAneTInKSB7XG4gICAgICAgICAgICAgICAgc2NhbGUgPSAkJC55Mi5jb3B5KCkuZG9tYWluKCQkLmdldFlEb21haW4odGFyZ2V0c1RvU2hvdywgJ3kyJykpO1xuICAgICAgICAgICAgICAgIGF4aXMgPSB0aGlzLmdldFlBeGlzKHNjYWxlLCAkJC55Mk9yaWVudCwgY29uZmlnLmF4aXNfeTJfdGlja19mb3JtYXQsICQkLnkyQXhpc1RpY2tWYWx1ZXMsIGZhbHNlLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2NhbGUgPSAkJC54LmNvcHkoKS5kb21haW4oJCQuZ2V0WERvbWFpbih0YXJnZXRzVG9TaG93KSk7XG4gICAgICAgICAgICAgICAgYXhpcyA9IHRoaXMuZ2V0WEF4aXMoc2NhbGUsICQkLnhPcmllbnQsICQkLnhBeGlzVGlja0Zvcm1hdCwgJCQueEF4aXNUaWNrVmFsdWVzLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVYQXhpc1RpY2tWYWx1ZXModGFyZ2V0c1RvU2hvdywgYXhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkdW1teSA9ICQkLmQzLnNlbGVjdCgnYm9keScpLmFwcGVuZCgnZGl2JykuY2xhc3NlZCgnYzMnLCB0cnVlKTtcbiAgICAgICAgICAgIHN2ZyA9IGR1bW15LmFwcGVuZChcInN2Z1wiKS5zdHlsZSgndmlzaWJpbGl0eScsICdoaWRkZW4nKS5zdHlsZSgncG9zaXRpb24nLCAnZml4ZWQnKS5zdHlsZSgndG9wJywgMCkuc3R5bGUoJ2xlZnQnLCAwKSwgc3ZnLmFwcGVuZCgnZycpLmNhbGwoYXhpcykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCQuZDMuc2VsZWN0KHRoaXMpLnNlbGVjdEFsbCgndGV4dCcpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYm94ID0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heFdpZHRoIDwgYm94LndpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aCA9IGJveC53aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGR1bW15LnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgJCQuY3VycmVudE1heFRpY2tXaWR0aHNbaWRdID0gbWF4V2lkdGggPD0gMCA/ICQkLmN1cnJlbnRNYXhUaWNrV2lkdGhzW2lkXSA6IG1heFdpZHRoO1xuICAgICAgICByZXR1cm4gJCQuY3VycmVudE1heFRpY2tXaWR0aHNbaWRdO1xuICAgIH07XG5cbiAgICBBeGlzLnByb3RvdHlwZS51cGRhdGVMYWJlbHMgPSBmdW5jdGlvbiB1cGRhdGVMYWJlbHMod2l0aFRyYW5zaXRpb24pIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5vd25lcjtcbiAgICAgICAgdmFyIGF4aXNYTGFiZWwgPSAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5heGlzWCArICcgLicgKyBDTEFTUy5heGlzWExhYmVsKSxcbiAgICAgICAgICAgIGF4aXNZTGFiZWwgPSAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5heGlzWSArICcgLicgKyBDTEFTUy5heGlzWUxhYmVsKSxcbiAgICAgICAgICAgIGF4aXNZMkxhYmVsID0gJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MuYXhpc1kyICsgJyAuJyArIENMQVNTLmF4aXNZMkxhYmVsKTtcbiAgICAgICAgKHdpdGhUcmFuc2l0aW9uID8gYXhpc1hMYWJlbC50cmFuc2l0aW9uKCkgOiBheGlzWExhYmVsKS5hdHRyKFwieFwiLCB0aGlzLnhGb3JYQXhpc0xhYmVsLmJpbmQodGhpcykpLmF0dHIoXCJkeFwiLCB0aGlzLmR4Rm9yWEF4aXNMYWJlbC5iaW5kKHRoaXMpKS5hdHRyKFwiZHlcIiwgdGhpcy5keUZvclhBeGlzTGFiZWwuYmluZCh0aGlzKSkudGV4dCh0aGlzLnRleHRGb3JYQXhpc0xhYmVsLmJpbmQodGhpcykpO1xuICAgICAgICAod2l0aFRyYW5zaXRpb24gPyBheGlzWUxhYmVsLnRyYW5zaXRpb24oKSA6IGF4aXNZTGFiZWwpLmF0dHIoXCJ4XCIsIHRoaXMueEZvcllBeGlzTGFiZWwuYmluZCh0aGlzKSkuYXR0cihcImR4XCIsIHRoaXMuZHhGb3JZQXhpc0xhYmVsLmJpbmQodGhpcykpLmF0dHIoXCJkeVwiLCB0aGlzLmR5Rm9yWUF4aXNMYWJlbC5iaW5kKHRoaXMpKS50ZXh0KHRoaXMudGV4dEZvcllBeGlzTGFiZWwuYmluZCh0aGlzKSk7XG4gICAgICAgICh3aXRoVHJhbnNpdGlvbiA/IGF4aXNZMkxhYmVsLnRyYW5zaXRpb24oKSA6IGF4aXNZMkxhYmVsKS5hdHRyKFwieFwiLCB0aGlzLnhGb3JZMkF4aXNMYWJlbC5iaW5kKHRoaXMpKS5hdHRyKFwiZHhcIiwgdGhpcy5keEZvclkyQXhpc0xhYmVsLmJpbmQodGhpcykpLmF0dHIoXCJkeVwiLCB0aGlzLmR5Rm9yWTJBeGlzTGFiZWwuYmluZCh0aGlzKSkudGV4dCh0aGlzLnRleHRGb3JZMkF4aXNMYWJlbC5iaW5kKHRoaXMpKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmdldFBhZGRpbmcgPSBmdW5jdGlvbiBnZXRQYWRkaW5nKHBhZGRpbmcsIGtleSwgZGVmYXVsdFZhbHVlLCBkb21haW5MZW5ndGgpIHtcbiAgICAgICAgdmFyIHAgPSB0eXBlb2YgcGFkZGluZyA9PT0gJ251bWJlcicgPyBwYWRkaW5nIDogcGFkZGluZ1trZXldO1xuICAgICAgICBpZiAoIWlzVmFsdWUocCkpIHtcbiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZGRpbmcudW5pdCA9PT0gJ3JhdGlvJykge1xuICAgICAgICAgICAgcmV0dXJuIHBhZGRpbmdba2V5XSAqIGRvbWFpbkxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICAvLyBhc3N1bWUgcGFkZGluZyBpcyBwaXhlbHMgaWYgdW5pdCBpcyBub3Qgc3BlY2lmaWVkXG4gICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRQaXhlbHNUb0F4aXNQYWRkaW5nKHAsIGRvbWFpbkxlbmd0aCk7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5jb252ZXJ0UGl4ZWxzVG9BeGlzUGFkZGluZyA9IGZ1bmN0aW9uIGNvbnZlcnRQaXhlbHNUb0F4aXNQYWRkaW5nKHBpeGVscywgZG9tYWluTGVuZ3RoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMub3duZXIsXG4gICAgICAgICAgICBsZW5ndGggPSAkJC5jb25maWcuYXhpc19yb3RhdGVkID8gJCQud2lkdGggOiAkJC5oZWlnaHQ7XG4gICAgICAgIHJldHVybiBkb21haW5MZW5ndGggKiAocGl4ZWxzIC8gbGVuZ3RoKTtcbiAgICB9O1xuICAgIEF4aXMucHJvdG90eXBlLmdlbmVyYXRlVGlja1ZhbHVlcyA9IGZ1bmN0aW9uIGdlbmVyYXRlVGlja1ZhbHVlcyh2YWx1ZXMsIHRpY2tDb3VudCwgZm9yVGltZVNlcmllcykge1xuICAgICAgICB2YXIgdGlja1ZhbHVlcyA9IHZhbHVlcyxcbiAgICAgICAgICAgIHRhcmdldENvdW50LFxuICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICBjb3VudCxcbiAgICAgICAgICAgIGludGVydmFsLFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIHRpY2tWYWx1ZTtcbiAgICAgICAgaWYgKHRpY2tDb3VudCkge1xuICAgICAgICAgICAgdGFyZ2V0Q291bnQgPSBpc0Z1bmN0aW9uKHRpY2tDb3VudCkgPyB0aWNrQ291bnQoKSA6IHRpY2tDb3VudDtcbiAgICAgICAgICAgIC8vIGNvbXB1dGUgdGlja3MgYWNjb3JkaW5nIHRvIHRpY2tDb3VudFxuICAgICAgICAgICAgaWYgKHRhcmdldENvdW50ID09PSAxKSB7XG4gICAgICAgICAgICAgICAgdGlja1ZhbHVlcyA9IFt2YWx1ZXNbMF1dO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXRDb3VudCA9PT0gMikge1xuICAgICAgICAgICAgICAgIHRpY2tWYWx1ZXMgPSBbdmFsdWVzWzBdLCB2YWx1ZXNbdmFsdWVzLmxlbmd0aCAtIDFdXTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0Q291bnQgPiAyKSB7XG4gICAgICAgICAgICAgICAgY291bnQgPSB0YXJnZXRDb3VudCAtIDI7XG4gICAgICAgICAgICAgICAgc3RhcnQgPSB2YWx1ZXNbMF07XG4gICAgICAgICAgICAgICAgZW5kID0gdmFsdWVzW3ZhbHVlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbCA9IChlbmQgLSBzdGFydCkgLyAoY291bnQgKyAxKTtcbiAgICAgICAgICAgICAgICAvLyByZS1jb25zdHJ1Y3QgdW5pcXVlIHZhbHVlc1xuICAgICAgICAgICAgICAgIHRpY2tWYWx1ZXMgPSBbc3RhcnRdO1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpY2tWYWx1ZSA9ICtzdGFydCArIGludGVydmFsICogKGkgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgdGlja1ZhbHVlcy5wdXNoKGZvclRpbWVTZXJpZXMgPyBuZXcgRGF0ZSh0aWNrVmFsdWUpIDogdGlja1ZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGlja1ZhbHVlcy5wdXNoKGVuZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFmb3JUaW1lU2VyaWVzKSB7XG4gICAgICAgICAgICB0aWNrVmFsdWVzID0gdGlja1ZhbHVlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRpY2tWYWx1ZXM7XG4gICAgfTtcbiAgICBBeGlzLnByb3RvdHlwZS5nZW5lcmF0ZVRyYW5zaXRpb25zID0gZnVuY3Rpb24gZ2VuZXJhdGVUcmFuc2l0aW9ucyhkdXJhdGlvbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLm93bmVyLFxuICAgICAgICAgICAgYXhlcyA9ICQkLmF4ZXM7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBheGlzWDogZHVyYXRpb24gPyBheGVzLngudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uKSA6IGF4ZXMueCxcbiAgICAgICAgICAgIGF4aXNZOiBkdXJhdGlvbiA/IGF4ZXMueS50cmFuc2l0aW9uKCkuZHVyYXRpb24oZHVyYXRpb24pIDogYXhlcy55LFxuICAgICAgICAgICAgYXhpc1kyOiBkdXJhdGlvbiA/IGF4ZXMueTIudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uKSA6IGF4ZXMueTIsXG4gICAgICAgICAgICBheGlzU3ViWDogZHVyYXRpb24gPyBheGVzLnN1YngudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uKSA6IGF4ZXMuc3VieFxuICAgICAgICB9O1xuICAgIH07XG4gICAgQXhpcy5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gcmVkcmF3KHRyYW5zaXRpb25zLCBpc0hpZGRlbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLm93bmVyO1xuICAgICAgICAkJC5heGVzLnguc3R5bGUoXCJvcGFjaXR5XCIsIGlzSGlkZGVuID8gMCA6IDEpO1xuICAgICAgICAkJC5heGVzLnkuc3R5bGUoXCJvcGFjaXR5XCIsIGlzSGlkZGVuID8gMCA6IDEpO1xuICAgICAgICAkJC5heGVzLnkyLnN0eWxlKFwib3BhY2l0eVwiLCBpc0hpZGRlbiA/IDAgOiAxKTtcbiAgICAgICAgJCQuYXhlcy5zdWJ4LnN0eWxlKFwib3BhY2l0eVwiLCBpc0hpZGRlbiA/IDAgOiAxKTtcbiAgICAgICAgdHJhbnNpdGlvbnMuYXhpc1guY2FsbCgkJC54QXhpcyk7XG4gICAgICAgIHRyYW5zaXRpb25zLmF4aXNZLmNhbGwoJCQueUF4aXMpO1xuICAgICAgICB0cmFuc2l0aW9ucy5heGlzWTIuY2FsbCgkJC55MkF4aXMpO1xuICAgICAgICB0cmFuc2l0aW9ucy5heGlzU3ViWC5jYWxsKCQkLnN1YlhBeGlzKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0Q2xpcFBhdGggPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIGlzSUU5ID0gd2luZG93Lm5hdmlnYXRvci5hcHBWZXJzaW9uLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIm1zaWUgOS5cIikgPj0gMDtcbiAgICAgICAgcmV0dXJuIFwidXJsKFwiICsgKGlzSUU5ID8gXCJcIiA6IGRvY3VtZW50LlVSTC5zcGxpdCgnIycpWzBdKSArIFwiI1wiICsgaWQgKyBcIilcIjtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmFwcGVuZENsaXAgPSBmdW5jdGlvbiAocGFyZW50LCBpZCkge1xuICAgICAgICByZXR1cm4gcGFyZW50LmFwcGVuZChcImNsaXBQYXRoXCIpLmF0dHIoXCJpZFwiLCBpZCkuYXBwZW5kKFwicmVjdFwiKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldEF4aXNDbGlwWCA9IGZ1bmN0aW9uIChmb3JIb3Jpem9udGFsKSB7XG4gICAgICAgIC8vIGF4aXMgbGluZSB3aWR0aCArIHBhZGRpbmcgZm9yIGxlZnRcbiAgICAgICAgdmFyIGxlZnQgPSBNYXRoLm1heCgzMCwgdGhpcy5tYXJnaW4ubGVmdCk7XG4gICAgICAgIHJldHVybiBmb3JIb3Jpem9udGFsID8gLSgxICsgbGVmdCkgOiAtKGxlZnQgLSAxKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldEF4aXNDbGlwWSA9IGZ1bmN0aW9uIChmb3JIb3Jpem9udGFsKSB7XG4gICAgICAgIHJldHVybiBmb3JIb3Jpem9udGFsID8gLTIwIDogLXRoaXMubWFyZ2luLnRvcDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFhBeGlzQ2xpcFggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIHJldHVybiAkJC5nZXRBeGlzQ2xpcFgoISQkLmNvbmZpZy5heGlzX3JvdGF0ZWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WEF4aXNDbGlwWSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgcmV0dXJuICQkLmdldEF4aXNDbGlwWSghJCQuY29uZmlnLmF4aXNfcm90YXRlZCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRZQXhpc0NsaXBYID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gJCQuY29uZmlnLmF4aXNfeV9pbm5lciA/IC0xIDogJCQuZ2V0QXhpc0NsaXBYKCQkLmNvbmZpZy5heGlzX3JvdGF0ZWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WUF4aXNDbGlwWSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgcmV0dXJuICQkLmdldEF4aXNDbGlwWSgkJC5jb25maWcuYXhpc19yb3RhdGVkKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldEF4aXNDbGlwV2lkdGggPSBmdW5jdGlvbiAoZm9ySG9yaXpvbnRhbCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgbGVmdCA9IE1hdGgubWF4KDMwLCAkJC5tYXJnaW4ubGVmdCksXG4gICAgICAgICAgICByaWdodCA9IE1hdGgubWF4KDMwLCAkJC5tYXJnaW4ucmlnaHQpO1xuICAgICAgICAvLyB3aWR0aCArIGF4aXMgbGluZSB3aWR0aCArIHBhZGRpbmcgZm9yIGxlZnQvcmlnaHRcbiAgICAgICAgcmV0dXJuIGZvckhvcml6b250YWwgPyAkJC53aWR0aCArIDIgKyBsZWZ0ICsgcmlnaHQgOiAkJC5tYXJnaW4ubGVmdCArIDIwO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0QXhpc0NsaXBIZWlnaHQgPSBmdW5jdGlvbiAoZm9ySG9yaXpvbnRhbCkge1xuICAgICAgICAvLyBsZXNzIHRoYW4gMjAgaXMgbm90IGVub3VnaCB0byBzaG93IHRoZSBheGlzIGxhYmVsICdvdXRlcicgd2l0aG91dCBsZWdlbmRcbiAgICAgICAgcmV0dXJuIChmb3JIb3Jpem9udGFsID8gdGhpcy5tYXJnaW4uYm90dG9tIDogdGhpcy5tYXJnaW4udG9wICsgdGhpcy5oZWlnaHQpICsgMjA7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRYQXhpc0NsaXBXaWR0aCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgcmV0dXJuICQkLmdldEF4aXNDbGlwV2lkdGgoISQkLmNvbmZpZy5heGlzX3JvdGF0ZWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WEF4aXNDbGlwSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gJCQuZ2V0QXhpc0NsaXBIZWlnaHQoISQkLmNvbmZpZy5heGlzX3JvdGF0ZWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WUF4aXNDbGlwV2lkdGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIHJldHVybiAkJC5nZXRBeGlzQ2xpcFdpZHRoKCQkLmNvbmZpZy5heGlzX3JvdGF0ZWQpICsgKCQkLmNvbmZpZy5heGlzX3lfaW5uZXIgPyAyMCA6IDApO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0WUF4aXNDbGlwSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gJCQuZ2V0QXhpc0NsaXBIZWlnaHQoJCQuY29uZmlnLmF4aXNfcm90YXRlZCk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmluaXRQaWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBkMyA9ICQkLmQzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICAkJC5waWUgPSBkMy5sYXlvdXQucGllKCkudmFsdWUoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBkLnZhbHVlcy5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYSArIGIudmFsdWU7XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghY29uZmlnLmRhdGFfb3JkZXIpIHtcbiAgICAgICAgICAgICQkLnBpZS5zb3J0KG51bGwpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVJhZGl1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIHcgPSBjb25maWcuZ2F1Z2Vfd2lkdGggfHwgY29uZmlnLmRvbnV0X3dpZHRoO1xuICAgICAgICAkJC5yYWRpdXNFeHBhbmRlZCA9IE1hdGgubWluKCQkLmFyY1dpZHRoLCAkJC5hcmNIZWlnaHQpIC8gMjtcbiAgICAgICAgJCQucmFkaXVzID0gJCQucmFkaXVzRXhwYW5kZWQgKiAwLjk1O1xuICAgICAgICAkJC5pbm5lclJhZGl1c1JhdGlvID0gdyA/ICgkJC5yYWRpdXMgLSB3KSAvICQkLnJhZGl1cyA6IDAuNjtcbiAgICAgICAgJCQuaW5uZXJSYWRpdXMgPSAkJC5oYXNUeXBlKCdkb251dCcpIHx8ICQkLmhhc1R5cGUoJ2dhdWdlJykgPyAkJC5yYWRpdXMgKiAkJC5pbm5lclJhZGl1c1JhdGlvIDogMDtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlQXJjID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICAkJC5zdmdBcmMgPSAkJC5nZXRTdmdBcmMoKTtcbiAgICAgICAgJCQuc3ZnQXJjRXhwYW5kZWQgPSAkJC5nZXRTdmdBcmNFeHBhbmRlZCgpO1xuICAgICAgICAkJC5zdmdBcmNFeHBhbmRlZFN1YiA9ICQkLmdldFN2Z0FyY0V4cGFuZGVkKDAuOTgpO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVBbmdsZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBmb3VuZCA9IGZhbHNlLFxuICAgICAgICAgICAgaW5kZXggPSAwLFxuICAgICAgICAgICAgZ01pbixcbiAgICAgICAgICAgIGdNYXgsXG4gICAgICAgICAgICBnVGljLFxuICAgICAgICAgICAgZ1ZhbHVlO1xuXG4gICAgICAgIGlmICghY29uZmlnKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgICQkLnBpZSgkJC5maWx0ZXJUYXJnZXRzVG9TaG93KCQkLmRhdGEudGFyZ2V0cykpLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIGlmICghZm91bmQgJiYgdC5kYXRhLmlkID09PSBkLmRhdGEuaWQpIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgZCA9IHQ7XG4gICAgICAgICAgICAgICAgZC5pbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpc05hTihkLnN0YXJ0QW5nbGUpKSB7XG4gICAgICAgICAgICBkLnN0YXJ0QW5nbGUgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc05hTihkLmVuZEFuZ2xlKSkge1xuICAgICAgICAgICAgZC5lbmRBbmdsZSA9IGQuc3RhcnRBbmdsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJCQuaXNHYXVnZVR5cGUoZC5kYXRhKSkge1xuICAgICAgICAgICAgZ01pbiA9IGNvbmZpZy5nYXVnZV9taW47XG4gICAgICAgICAgICBnTWF4ID0gY29uZmlnLmdhdWdlX21heDtcbiAgICAgICAgICAgIGdUaWMgPSBNYXRoLlBJICogKGNvbmZpZy5nYXVnZV9mdWxsQ2lyY2xlID8gMiA6IDEpIC8gKGdNYXggLSBnTWluKTtcbiAgICAgICAgICAgIGdWYWx1ZSA9IGQudmFsdWUgPCBnTWluID8gMCA6IGQudmFsdWUgPCBnTWF4ID8gZC52YWx1ZSAtIGdNaW4gOiBnTWF4IC0gZ01pbjtcbiAgICAgICAgICAgIGQuc3RhcnRBbmdsZSA9IGNvbmZpZy5nYXVnZV9zdGFydGluZ0FuZ2xlO1xuICAgICAgICAgICAgZC5lbmRBbmdsZSA9IGQuc3RhcnRBbmdsZSArIGdUaWMgKiBnVmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZvdW5kID8gZCA6IG51bGw7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFN2Z0FyYyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGFyYyA9ICQkLmQzLnN2Zy5hcmMoKS5vdXRlclJhZGl1cygkJC5yYWRpdXMpLmlubmVyUmFkaXVzKCQkLmlubmVyUmFkaXVzKSxcbiAgICAgICAgICAgIG5ld0FyYyA9IGZ1bmN0aW9uIG5ld0FyYyhkLCB3aXRob3V0VXBkYXRlKSB7XG4gICAgICAgICAgICB2YXIgdXBkYXRlZDtcbiAgICAgICAgICAgIGlmICh3aXRob3V0VXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFyYyhkKTtcbiAgICAgICAgICAgIH0gLy8gZm9yIGludGVycG9sYXRlXG4gICAgICAgICAgICB1cGRhdGVkID0gJCQudXBkYXRlQW5nbGUoZCk7XG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlZCA/IGFyYyh1cGRhdGVkKSA6IFwiTSAwIDBcIjtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gVE9ETzogZXh0ZW5kcyBhbGwgZnVuY3Rpb25cbiAgICAgICAgbmV3QXJjLmNlbnRyb2lkID0gYXJjLmNlbnRyb2lkO1xuICAgICAgICByZXR1cm4gbmV3QXJjO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRTdmdBcmNFeHBhbmRlZCA9IGZ1bmN0aW9uIChyYXRlKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBhcmMgPSAkJC5kMy5zdmcuYXJjKCkub3V0ZXJSYWRpdXMoJCQucmFkaXVzRXhwYW5kZWQgKiAocmF0ZSA/IHJhdGUgOiAxKSkuaW5uZXJSYWRpdXMoJCQuaW5uZXJSYWRpdXMpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciB1cGRhdGVkID0gJCQudXBkYXRlQW5nbGUoZCk7XG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlZCA/IGFyYyh1cGRhdGVkKSA6IFwiTSAwIDBcIjtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0QXJjID0gZnVuY3Rpb24gKGQsIHdpdGhvdXRVcGRhdGUsIGZvcmNlKSB7XG4gICAgICAgIHJldHVybiBmb3JjZSB8fCB0aGlzLmlzQXJjVHlwZShkLmRhdGEpID8gdGhpcy5zdmdBcmMoZCwgd2l0aG91dFVwZGF0ZSkgOiBcIk0gMCAwXCI7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnRyYW5zZm9ybUZvckFyY0xhYmVsID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIHVwZGF0ZWQgPSAkJC51cGRhdGVBbmdsZShkKSxcbiAgICAgICAgICAgIGMsXG4gICAgICAgICAgICB4LFxuICAgICAgICAgICAgeSxcbiAgICAgICAgICAgIGgsXG4gICAgICAgICAgICByYXRpbyxcbiAgICAgICAgICAgIHRyYW5zbGF0ZSA9IFwiXCI7XG4gICAgICAgIGlmICh1cGRhdGVkICYmICEkJC5oYXNUeXBlKCdnYXVnZScpKSB7XG4gICAgICAgICAgICBjID0gdGhpcy5zdmdBcmMuY2VudHJvaWQodXBkYXRlZCk7XG4gICAgICAgICAgICB4ID0gaXNOYU4oY1swXSkgPyAwIDogY1swXTtcbiAgICAgICAgICAgIHkgPSBpc05hTihjWzFdKSA/IDAgOiBjWzFdO1xuICAgICAgICAgICAgaCA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTtcbiAgICAgICAgICAgIGlmICgkJC5oYXNUeXBlKCdkb251dCcpICYmIGNvbmZpZy5kb251dF9sYWJlbF9yYXRpbykge1xuICAgICAgICAgICAgICAgIHJhdGlvID0gaXNGdW5jdGlvbihjb25maWcuZG9udXRfbGFiZWxfcmF0aW8pID8gY29uZmlnLmRvbnV0X2xhYmVsX3JhdGlvKGQsICQkLnJhZGl1cywgaCkgOiBjb25maWcuZG9udXRfbGFiZWxfcmF0aW87XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCQkLmhhc1R5cGUoJ3BpZScpICYmIGNvbmZpZy5waWVfbGFiZWxfcmF0aW8pIHtcbiAgICAgICAgICAgICAgICByYXRpbyA9IGlzRnVuY3Rpb24oY29uZmlnLnBpZV9sYWJlbF9yYXRpbykgPyBjb25maWcucGllX2xhYmVsX3JhdGlvKGQsICQkLnJhZGl1cywgaCkgOiBjb25maWcucGllX2xhYmVsX3JhdGlvO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByYXRpbyA9ICQkLnJhZGl1cyAmJiBoID8gKDM2IC8gJCQucmFkaXVzID4gMC4zNzUgPyAxLjE3NSAtIDM2IC8gJCQucmFkaXVzIDogMC44KSAqICQkLnJhZGl1cyAvIGggOiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJhbnNsYXRlID0gXCJ0cmFuc2xhdGUoXCIgKyB4ICogcmF0aW8gKyAnLCcgKyB5ICogcmF0aW8gKyBcIilcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJhbnNsYXRlO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRBcmNSYXRpbyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB3aG9sZSA9IE1hdGguUEkgKiAoJCQuaGFzVHlwZSgnZ2F1Z2UnKSAmJiAhY29uZmlnLmdhdWdlX2Z1bGxDaXJjbGUgPyAxIDogMik7XG4gICAgICAgIHJldHVybiBkID8gKGQuZW5kQW5nbGUgLSBkLnN0YXJ0QW5nbGUpIC8gd2hvbGUgOiBudWxsO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jb252ZXJ0VG9BcmNEYXRhID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkTmFtZSh7XG4gICAgICAgICAgICBpZDogZC5kYXRhLmlkLFxuICAgICAgICAgICAgdmFsdWU6IGQudmFsdWUsXG4gICAgICAgICAgICByYXRpbzogdGhpcy5nZXRBcmNSYXRpbyhkKSxcbiAgICAgICAgICAgIGluZGV4OiBkLmluZGV4XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi50ZXh0Rm9yQXJjTGFiZWwgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgdXBkYXRlZCxcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgcmF0aW8sXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIGZvcm1hdDtcbiAgICAgICAgaWYgKCEkJC5zaG91bGRTaG93QXJjTGFiZWwoKSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlZCA9ICQkLnVwZGF0ZUFuZ2xlKGQpO1xuICAgICAgICB2YWx1ZSA9IHVwZGF0ZWQgPyB1cGRhdGVkLnZhbHVlIDogbnVsbDtcbiAgICAgICAgcmF0aW8gPSAkJC5nZXRBcmNSYXRpbyh1cGRhdGVkKTtcbiAgICAgICAgaWQgPSBkLmRhdGEuaWQ7XG4gICAgICAgIGlmICghJCQuaGFzVHlwZSgnZ2F1Z2UnKSAmJiAhJCQubWVldHNBcmNMYWJlbFRocmVzaG9sZChyYXRpbykpIHtcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIGZvcm1hdCA9ICQkLmdldEFyY0xhYmVsRm9ybWF0KCk7XG4gICAgICAgIHJldHVybiBmb3JtYXQgPyBmb3JtYXQodmFsdWUsIHJhdGlvLCBpZCkgOiAkJC5kZWZhdWx0QXJjVmFsdWVGb3JtYXQodmFsdWUsIHJhdGlvKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZXhwYW5kQXJjID0gZnVuY3Rpb24gKHRhcmdldElkcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgaW50ZXJ2YWw7XG5cbiAgICAgICAgLy8gTUVNTzogYXZvaWQgdG8gY2FuY2VsIHRyYW5zaXRpb25cbiAgICAgICAgaWYgKCQkLnRyYW5zaXRpbmcpIHtcbiAgICAgICAgICAgIGludGVydmFsID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoISQkLnRyYW5zaXRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJCQubGVnZW5kLnNlbGVjdEFsbCgnLmMzLWxlZ2VuZC1pdGVtLWZvY3VzZWQnKS5zaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkJC5leHBhbmRBcmModGFyZ2V0SWRzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRhcmdldElkcyA9ICQkLm1hcFRvVGFyZ2V0SWRzKHRhcmdldElkcyk7XG5cbiAgICAgICAgJCQuc3ZnLnNlbGVjdEFsbCgkJC5zZWxlY3RvclRhcmdldHModGFyZ2V0SWRzLCAnLicgKyBDTEFTUy5jaGFydEFyYykpLmVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmICghJCQuc2hvdWxkRXhwYW5kKGQuZGF0YS5pZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkJC5kMy5zZWxlY3QodGhpcykuc2VsZWN0QWxsKCdwYXRoJykudHJhbnNpdGlvbigpLmR1cmF0aW9uKCQkLmV4cGFuZER1cmF0aW9uKGQuZGF0YS5pZCkpLmF0dHIoXCJkXCIsICQkLnN2Z0FyY0V4cGFuZGVkKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oJCQuZXhwYW5kRHVyYXRpb24oZC5kYXRhLmlkKSAqIDIpLmF0dHIoXCJkXCIsICQkLnN2Z0FyY0V4cGFuZGVkU3ViKS5lYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQkLmlzRG9udXRUeXBlKGQuZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2FsbGJhY2sgaGVyZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udW5leHBhbmRBcmMgPSBmdW5jdGlvbiAodGFyZ2V0SWRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCQkLnRyYW5zaXRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRhcmdldElkcyA9ICQkLm1hcFRvVGFyZ2V0SWRzKHRhcmdldElkcyk7XG5cbiAgICAgICAgJCQuc3ZnLnNlbGVjdEFsbCgkJC5zZWxlY3RvclRhcmdldHModGFyZ2V0SWRzLCAnLicgKyBDTEFTUy5jaGFydEFyYykpLnNlbGVjdEFsbCgncGF0aCcpLnRyYW5zaXRpb24oKS5kdXJhdGlvbihmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLmV4cGFuZER1cmF0aW9uKGQuZGF0YS5pZCk7XG4gICAgICAgIH0pLmF0dHIoXCJkXCIsICQkLnN2Z0FyYyk7XG4gICAgICAgICQkLnN2Zy5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuYXJjKS5zdHlsZShcIm9wYWNpdHlcIiwgMSk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmV4cGFuZER1cmF0aW9uID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG5cbiAgICAgICAgaWYgKCQkLmlzRG9udXRUeXBlKGlkKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5kb251dF9leHBhbmRfZHVyYXRpb247XG4gICAgICAgIH0gZWxzZSBpZiAoJCQuaXNHYXVnZVR5cGUoaWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmdhdWdlX2V4cGFuZF9kdXJhdGlvbjtcbiAgICAgICAgfSBlbHNlIGlmICgkJC5pc1BpZVR5cGUoaWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLnBpZV9leHBhbmRfZHVyYXRpb247XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gNTA7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uc2hvdWxkRXhwYW5kID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIHJldHVybiAkJC5pc0RvbnV0VHlwZShpZCkgJiYgY29uZmlnLmRvbnV0X2V4cGFuZCB8fCAkJC5pc0dhdWdlVHlwZShpZCkgJiYgY29uZmlnLmdhdWdlX2V4cGFuZCB8fCAkJC5pc1BpZVR5cGUoaWQpICYmIGNvbmZpZy5waWVfZXhwYW5kO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5zaG91bGRTaG93QXJjTGFiZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBzaG91bGRTaG93ID0gdHJ1ZTtcbiAgICAgICAgaWYgKCQkLmhhc1R5cGUoJ2RvbnV0JykpIHtcbiAgICAgICAgICAgIHNob3VsZFNob3cgPSBjb25maWcuZG9udXRfbGFiZWxfc2hvdztcbiAgICAgICAgfSBlbHNlIGlmICgkJC5oYXNUeXBlKCdwaWUnKSkge1xuICAgICAgICAgICAgc2hvdWxkU2hvdyA9IGNvbmZpZy5waWVfbGFiZWxfc2hvdztcbiAgICAgICAgfVxuICAgICAgICAvLyB3aGVuIGdhdWdlLCBhbHdheXMgdHJ1ZVxuICAgICAgICByZXR1cm4gc2hvdWxkU2hvdztcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ubWVldHNBcmNMYWJlbFRocmVzaG9sZCA9IGZ1bmN0aW9uIChyYXRpbykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgdGhyZXNob2xkID0gJCQuaGFzVHlwZSgnZG9udXQnKSA/IGNvbmZpZy5kb251dF9sYWJlbF90aHJlc2hvbGQgOiBjb25maWcucGllX2xhYmVsX3RocmVzaG9sZDtcbiAgICAgICAgcmV0dXJuIHJhdGlvID49IHRocmVzaG9sZDtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0QXJjTGFiZWxGb3JtYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBmb3JtYXQgPSBjb25maWcucGllX2xhYmVsX2Zvcm1hdDtcbiAgICAgICAgaWYgKCQkLmhhc1R5cGUoJ2dhdWdlJykpIHtcbiAgICAgICAgICAgIGZvcm1hdCA9IGNvbmZpZy5nYXVnZV9sYWJlbF9mb3JtYXQ7XG4gICAgICAgIH0gZWxzZSBpZiAoJCQuaGFzVHlwZSgnZG9udXQnKSkge1xuICAgICAgICAgICAgZm9ybWF0ID0gY29uZmlnLmRvbnV0X2xhYmVsX2Zvcm1hdDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZm9ybWF0O1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRBcmNUaXRsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgcmV0dXJuICQkLmhhc1R5cGUoJ2RvbnV0JykgPyAkJC5jb25maWcuZG9udXRfdGl0bGUgOiBcIlwiO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVUYXJnZXRzRm9yQXJjID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIG1haW4gPSAkJC5tYWluLFxuICAgICAgICAgICAgbWFpblBpZVVwZGF0ZSxcbiAgICAgICAgICAgIG1haW5QaWVFbnRlcixcbiAgICAgICAgICAgIGNsYXNzQ2hhcnRBcmMgPSAkJC5jbGFzc0NoYXJ0QXJjLmJpbmQoJCQpLFxuICAgICAgICAgICAgY2xhc3NBcmNzID0gJCQuY2xhc3NBcmNzLmJpbmQoJCQpLFxuICAgICAgICAgICAgY2xhc3NGb2N1cyA9ICQkLmNsYXNzRm9jdXMuYmluZCgkJCk7XG4gICAgICAgIG1haW5QaWVVcGRhdGUgPSBtYWluLnNlbGVjdCgnLicgKyBDTEFTUy5jaGFydEFyY3MpLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5jaGFydEFyYykuZGF0YSgkJC5waWUodGFyZ2V0cykpLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNsYXNzQ2hhcnRBcmMoZCkgKyBjbGFzc0ZvY3VzKGQuZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgICBtYWluUGllRW50ZXIgPSBtYWluUGllVXBkYXRlLmVudGVyKCkuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgY2xhc3NDaGFydEFyYyk7XG4gICAgICAgIG1haW5QaWVFbnRlci5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsIGNsYXNzQXJjcyk7XG4gICAgICAgIG1haW5QaWVFbnRlci5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJkeVwiLCAkJC5oYXNUeXBlKCdnYXVnZScpID8gXCItLjFlbVwiIDogXCIuMzVlbVwiKS5zdHlsZShcIm9wYWNpdHlcIiwgMCkuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKS5zdHlsZShcInBvaW50ZXItZXZlbnRzXCIsIFwibm9uZVwiKTtcbiAgICAgICAgLy8gTUVNTzogY2FuIG5vdCBrZWVwIHNhbWUgY29sb3IuLi4sIGJ1dCBub3QgYmFkIHRvIHVwZGF0ZSBjb2xvciBpbiByZWRyYXdcbiAgICAgICAgLy9tYWluUGllVXBkYXRlLmV4aXQoKS5yZW1vdmUoKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaW5pdEFyYyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgJCQuYXJjcyA9ICQkLm1haW4uc2VsZWN0KCcuJyArIENMQVNTLmNoYXJ0KS5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBDTEFTUy5jaGFydEFyY3MpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgJCQuZ2V0VHJhbnNsYXRlKCdhcmMnKSk7XG4gICAgICAgICQkLmFyY3MuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCBDTEFTUy5jaGFydEFyY3NUaXRsZSkuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKS50ZXh0KCQkLmdldEFyY1RpdGxlKCkpO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5yZWRyYXdBcmMgPSBmdW5jdGlvbiAoZHVyYXRpb24sIGR1cmF0aW9uRm9yRXhpdCwgd2l0aFRyYW5zZm9ybSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZDMgPSAkJC5kMyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIG1haW4gPSAkJC5tYWluLFxuICAgICAgICAgICAgbWFpbkFyYztcbiAgICAgICAgbWFpbkFyYyA9IG1haW4uc2VsZWN0QWxsKCcuJyArIENMQVNTLmFyY3MpLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5hcmMpLmRhdGEoJCQuYXJjRGF0YS5iaW5kKCQkKSk7XG4gICAgICAgIG1haW5BcmMuZW50ZXIoKS5hcHBlbmQoJ3BhdGgnKS5hdHRyKFwiY2xhc3NcIiwgJCQuY2xhc3NBcmMuYmluZCgkJCkpLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLmNvbG9yKGQuZGF0YSk7XG4gICAgICAgIH0pLnN0eWxlKFwiY3Vyc29yXCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmludGVyYWN0aW9uX2VuYWJsZWQgJiYgY29uZmlnLmRhdGFfc2VsZWN0aW9uX2lzc2VsZWN0YWJsZShkKSA/IFwicG9pbnRlclwiIDogbnVsbDtcbiAgICAgICAgfSkuc3R5bGUoXCJvcGFjaXR5XCIsIDApLmVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmICgkJC5pc0dhdWdlVHlwZShkLmRhdGEpKSB7XG4gICAgICAgICAgICAgICAgZC5zdGFydEFuZ2xlID0gZC5lbmRBbmdsZSA9IGNvbmZpZy5nYXVnZV9zdGFydGluZ0FuZ2xlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY3VycmVudCA9IGQ7XG4gICAgICAgIH0pO1xuICAgICAgICBtYWluQXJjLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiAhJCQuaXNHYXVnZVR5cGUoZC5kYXRhKSAmJiB3aXRoVHJhbnNmb3JtID8gXCJzY2FsZSgwKVwiIDogXCJcIjtcbiAgICAgICAgfSkuc3R5bGUoXCJvcGFjaXR5XCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gZCA9PT0gdGhpcy5fY3VycmVudCA/IDAgOiAxO1xuICAgICAgICB9KS5vbignbW91c2VvdmVyJywgY29uZmlnLmludGVyYWN0aW9uX2VuYWJsZWQgPyBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIHVwZGF0ZWQsIGFyY0RhdGE7XG4gICAgICAgICAgICBpZiAoJCQudHJhbnNpdGluZykge1xuICAgICAgICAgICAgICAgIC8vIHNraXAgd2hpbGUgdHJhbnNpdGluZ1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHVwZGF0ZWQgPSAkJC51cGRhdGVBbmdsZShkKTtcbiAgICAgICAgICAgIGlmICh1cGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgYXJjRGF0YSA9ICQkLmNvbnZlcnRUb0FyY0RhdGEodXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgLy8gdHJhbnNpdGlvbnNcbiAgICAgICAgICAgICAgICAkJC5leHBhbmRBcmModXBkYXRlZC5kYXRhLmlkKTtcbiAgICAgICAgICAgICAgICAkJC5hcGkuZm9jdXModXBkYXRlZC5kYXRhLmlkKTtcbiAgICAgICAgICAgICAgICAkJC50b2dnbGVGb2N1c0xlZ2VuZCh1cGRhdGVkLmRhdGEuaWQsIHRydWUpO1xuICAgICAgICAgICAgICAgICQkLmNvbmZpZy5kYXRhX29ubW91c2VvdmVyKGFyY0RhdGEsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IDogbnVsbCkub24oJ21vdXNlbW92ZScsIGNvbmZpZy5pbnRlcmFjdGlvbl9lbmFibGVkID8gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciB1cGRhdGVkID0gJCQudXBkYXRlQW5nbGUoZCksXG4gICAgICAgICAgICAgICAgYXJjRGF0YSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZERhdGE7XG4gICAgICAgICAgICBpZiAodXBkYXRlZCkge1xuICAgICAgICAgICAgICAgIGFyY0RhdGEgPSAkJC5jb252ZXJ0VG9BcmNEYXRhKHVwZGF0ZWQpLCBzZWxlY3RlZERhdGEgPSBbYXJjRGF0YV07XG4gICAgICAgICAgICAgICAgJCQuc2hvd1Rvb2x0aXAoc2VsZWN0ZWREYXRhLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSA6IG51bGwpLm9uKCdtb3VzZW91dCcsIGNvbmZpZy5pbnRlcmFjdGlvbl9lbmFibGVkID8gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciB1cGRhdGVkLCBhcmNEYXRhO1xuICAgICAgICAgICAgaWYgKCQkLnRyYW5zaXRpbmcpIHtcbiAgICAgICAgICAgICAgICAvLyBza2lwIHdoaWxlIHRyYW5zaXRpbmdcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1cGRhdGVkID0gJCQudXBkYXRlQW5nbGUoZCk7XG4gICAgICAgICAgICBpZiAodXBkYXRlZCkge1xuICAgICAgICAgICAgICAgIGFyY0RhdGEgPSAkJC5jb252ZXJ0VG9BcmNEYXRhKHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgIC8vIHRyYW5zaXRpb25zXG4gICAgICAgICAgICAgICAgJCQudW5leHBhbmRBcmModXBkYXRlZC5kYXRhLmlkKTtcbiAgICAgICAgICAgICAgICAkJC5hcGkucmV2ZXJ0KCk7XG4gICAgICAgICAgICAgICAgJCQucmV2ZXJ0TGVnZW5kKCk7XG4gICAgICAgICAgICAgICAgJCQuaGlkZVRvb2x0aXAoKTtcbiAgICAgICAgICAgICAgICAkJC5jb25maWcuZGF0YV9vbm1vdXNlb3V0KGFyY0RhdGEsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IDogbnVsbCkub24oJ2NsaWNrJywgY29uZmlnLmludGVyYWN0aW9uX2VuYWJsZWQgPyBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgdmFyIHVwZGF0ZWQgPSAkJC51cGRhdGVBbmdsZShkKSxcbiAgICAgICAgICAgICAgICBhcmNEYXRhO1xuICAgICAgICAgICAgaWYgKHVwZGF0ZWQpIHtcbiAgICAgICAgICAgICAgICBhcmNEYXRhID0gJCQuY29udmVydFRvQXJjRGF0YSh1cGRhdGVkKTtcbiAgICAgICAgICAgICAgICBpZiAoJCQudG9nZ2xlU2hhcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgJCQudG9nZ2xlU2hhcGUodGhpcywgYXJjRGF0YSwgaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQkLmNvbmZpZy5kYXRhX29uY2xpY2suY2FsbCgkJC5hcGksIGFyY0RhdGEsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IDogbnVsbCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkJC50cmFuc2l0aW5nID0gdHJ1ZTtcbiAgICAgICAgfSkudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uKS5hdHRyVHdlZW4oXCJkXCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICB2YXIgdXBkYXRlZCA9ICQkLnVwZGF0ZUFuZ2xlKGQpLFxuICAgICAgICAgICAgICAgIGludGVycG9sYXRlO1xuICAgICAgICAgICAgaWYgKCF1cGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiTSAwIDBcIjtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnQgPT09IGQpIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50ID0ge1xuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEFuZ2xlOiBNYXRoLlBJKjIsXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIGVuZEFuZ2xlOiBNYXRoLlBJKjIsXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc05hTih0aGlzLl9jdXJyZW50LnN0YXJ0QW5nbGUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudC5zdGFydEFuZ2xlID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc05hTih0aGlzLl9jdXJyZW50LmVuZEFuZ2xlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnQuZW5kQW5nbGUgPSB0aGlzLl9jdXJyZW50LnN0YXJ0QW5nbGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbnRlcnBvbGF0ZSA9IGQzLmludGVycG9sYXRlKHRoaXMuX2N1cnJlbnQsIHVwZGF0ZWQpO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudCA9IGludGVycG9sYXRlKDApO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGludGVycG9sYXRlZCA9IGludGVycG9sYXRlKHQpO1xuICAgICAgICAgICAgICAgIGludGVycG9sYXRlZC5kYXRhID0gZC5kYXRhOyAvLyBkYXRhLmlkIHdpbGwgYmUgdXBkYXRlZCBieSBpbnRlcnBvcmF0b3JcbiAgICAgICAgICAgICAgICByZXR1cm4gJCQuZ2V0QXJjKGludGVycG9sYXRlZCwgdHJ1ZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KS5hdHRyKFwidHJhbnNmb3JtXCIsIHdpdGhUcmFuc2Zvcm0gPyBcInNjYWxlKDEpXCIgOiBcIlwiKS5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5sZXZlbENvbG9yID8gJCQubGV2ZWxDb2xvcihkLmRhdGEudmFsdWVzWzBdLnZhbHVlKSA6ICQkLmNvbG9yKGQuZGF0YS5pZCk7XG4gICAgICAgIH0pIC8vIFdoZXJlIGdhdWdlIHJlYWRpbmcgY29sb3Igd291bGQgcmVjZWl2ZSBjdXN0b21pemF0aW9uLlxuICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDEpLmNhbGwoJCQuZW5kYWxsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkJC50cmFuc2l0aW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICBtYWluQXJjLmV4aXQoKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oZHVyYXRpb25Gb3JFeGl0KS5zdHlsZSgnb3BhY2l0eScsIDApLnJlbW92ZSgpO1xuICAgICAgICBtYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5jaGFydEFyYykuc2VsZWN0KCd0ZXh0Jykuc3R5bGUoXCJvcGFjaXR5XCIsIDApLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5pc0dhdWdlVHlwZShkLmRhdGEpID8gQ0xBU1MuZ2F1Z2VWYWx1ZSA6ICcnO1xuICAgICAgICB9KS50ZXh0KCQkLnRleHRGb3JBcmNMYWJlbC5iaW5kKCQkKSkuYXR0cihcInRyYW5zZm9ybVwiLCAkJC50cmFuc2Zvcm1Gb3JBcmNMYWJlbC5iaW5kKCQkKSkuc3R5bGUoJ2ZvbnQtc2l6ZScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuaXNHYXVnZVR5cGUoZC5kYXRhKSA/IE1hdGgucm91bmQoJCQucmFkaXVzIC8gNSkgKyAncHgnIDogJyc7XG4gICAgICAgIH0pLnRyYW5zaXRpb24oKS5kdXJhdGlvbihkdXJhdGlvbikuc3R5bGUoXCJvcGFjaXR5XCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuaXNUYXJnZXRUb1Nob3coZC5kYXRhLmlkKSAmJiAkJC5pc0FyY1R5cGUoZC5kYXRhKSA/IDEgOiAwO1xuICAgICAgICB9KTtcbiAgICAgICAgbWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MuY2hhcnRBcmNzVGl0bGUpLnN0eWxlKFwib3BhY2l0eVwiLCAkJC5oYXNUeXBlKCdkb251dCcpIHx8ICQkLmhhc1R5cGUoJ2dhdWdlJykgPyAxIDogMCk7XG5cbiAgICAgICAgaWYgKCQkLmhhc1R5cGUoJ2dhdWdlJykpIHtcbiAgICAgICAgICAgICQkLmFyY3Muc2VsZWN0KCcuJyArIENMQVNTLmNoYXJ0QXJjc0JhY2tncm91bmQpLmF0dHIoXCJkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogW3sgdmFsdWU6IGNvbmZpZy5nYXVnZV9tYXggfV0sXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5nbGU6IGNvbmZpZy5nYXVnZV9zdGFydGluZ0FuZ2xlLFxuICAgICAgICAgICAgICAgICAgICBlbmRBbmdsZTogLTEgKiBjb25maWcuZ2F1Z2Vfc3RhcnRpbmdBbmdsZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuICQkLmdldEFyYyhkLCB0cnVlLCB0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJCQuYXJjcy5zZWxlY3QoJy4nICsgQ0xBU1MuY2hhcnRBcmNzR2F1Z2VVbml0KS5hdHRyKFwiZHlcIiwgXCIuNzVlbVwiKS50ZXh0KGNvbmZpZy5nYXVnZV9sYWJlbF9zaG93ID8gY29uZmlnLmdhdWdlX3VuaXRzIDogJycpO1xuICAgICAgICAgICAgJCQuYXJjcy5zZWxlY3QoJy4nICsgQ0xBU1MuY2hhcnRBcmNzR2F1Z2VNaW4pLmF0dHIoXCJkeFwiLCAtMSAqICgkJC5pbm5lclJhZGl1cyArICgkJC5yYWRpdXMgLSAkJC5pbm5lclJhZGl1cykgLyAoY29uZmlnLmdhdWdlX2Z1bGxDaXJjbGUgPyAxIDogMikpICsgXCJweFwiKS5hdHRyKFwiZHlcIiwgXCIxLjJlbVwiKS50ZXh0KGNvbmZpZy5nYXVnZV9sYWJlbF9zaG93ID8gY29uZmlnLmdhdWdlX21pbiA6ICcnKTtcbiAgICAgICAgICAgICQkLmFyY3Muc2VsZWN0KCcuJyArIENMQVNTLmNoYXJ0QXJjc0dhdWdlTWF4KS5hdHRyKFwiZHhcIiwgJCQuaW5uZXJSYWRpdXMgKyAoJCQucmFkaXVzIC0gJCQuaW5uZXJSYWRpdXMpIC8gKGNvbmZpZy5nYXVnZV9mdWxsQ2lyY2xlID8gMSA6IDIpICsgXCJweFwiKS5hdHRyKFwiZHlcIiwgXCIxLjJlbVwiKS50ZXh0KGNvbmZpZy5nYXVnZV9sYWJlbF9zaG93ID8gY29uZmlnLmdhdWdlX21heCA6ICcnKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaW5pdEdhdWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJjcyA9IHRoaXMuYXJjcztcbiAgICAgICAgaWYgKHRoaXMuaGFzVHlwZSgnZ2F1Z2UnKSkge1xuICAgICAgICAgICAgYXJjcy5hcHBlbmQoJ3BhdGgnKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MuY2hhcnRBcmNzQmFja2dyb3VuZCk7XG4gICAgICAgICAgICBhcmNzLmFwcGVuZChcInRleHRcIikuYXR0cihcImNsYXNzXCIsIENMQVNTLmNoYXJ0QXJjc0dhdWdlVW5pdCkuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKS5zdHlsZShcInBvaW50ZXItZXZlbnRzXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgIGFyY3MuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MuY2hhcnRBcmNzR2F1Z2VNaW4pLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIikuc3R5bGUoXCJwb2ludGVyLWV2ZW50c1wiLCBcIm5vbmVcIik7XG4gICAgICAgICAgICBhcmNzLmFwcGVuZChcInRleHRcIikuYXR0cihcImNsYXNzXCIsIENMQVNTLmNoYXJ0QXJjc0dhdWdlTWF4KS5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpLnN0eWxlKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZXRHYXVnZUxhYmVsSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuZ2F1Z2VfbGFiZWxfc2hvdyA/IDIwIDogMDtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaW5pdFJlZ2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgJCQucmVnaW9uID0gJCQubWFpbi5hcHBlbmQoJ2cnKS5hdHRyKFwiY2xpcC1wYXRoXCIsICQkLmNsaXBQYXRoKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MucmVnaW9ucyk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51cGRhdGVSZWdpb24gPSBmdW5jdGlvbiAoZHVyYXRpb24pIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcblxuICAgICAgICAvLyBoaWRlIGlmIGFyYyB0eXBlXG4gICAgICAgICQkLnJlZ2lvbi5zdHlsZSgndmlzaWJpbGl0eScsICQkLmhhc0FyY1R5cGUoKSA/ICdoaWRkZW4nIDogJ3Zpc2libGUnKTtcblxuICAgICAgICAkJC5tYWluUmVnaW9uID0gJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MucmVnaW9ucykuc2VsZWN0QWxsKCcuJyArIENMQVNTLnJlZ2lvbikuZGF0YShjb25maWcucmVnaW9ucyk7XG4gICAgICAgICQkLm1haW5SZWdpb24uZW50ZXIoKS5hcHBlbmQoJ2cnKS5hcHBlbmQoJ3JlY3QnKS5zdHlsZShcImZpbGwtb3BhY2l0eVwiLCAwKTtcbiAgICAgICAgJCQubWFpblJlZ2lvbi5hdHRyKCdjbGFzcycsICQkLmNsYXNzUmVnaW9uLmJpbmQoJCQpKTtcbiAgICAgICAgJCQubWFpblJlZ2lvbi5leGl0KCkudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uKS5zdHlsZShcIm9wYWNpdHlcIiwgMCkucmVtb3ZlKCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5yZWRyYXdSZWdpb24gPSBmdW5jdGlvbiAod2l0aFRyYW5zaXRpb24pIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIHJlZ2lvbnMgPSAkJC5tYWluUmVnaW9uLnNlbGVjdEFsbCgncmVjdCcpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gZGF0YSBpcyBiaW5kZWQgdG8gZyBhbmQgaXQncyBub3QgdHJhbnNmZXJyZWQgdG8gcmVjdCAoY2hpbGQgbm9kZSkgYXV0b21hdGljYWxseSxcbiAgICAgICAgICAgIC8vIHRoZW4gZGF0YSBvZiBlYWNoIHJlY3QgaGFzIHRvIGJlIHVwZGF0ZWQgbWFudWFsbHkuXG4gICAgICAgICAgICAvLyBUT0RPOiB0aGVyZSBzaG91bGQgYmUgbW9yZSBlZmZpY2llbnQgd2F5IHRvIHNvbHZlIHRoaXM/XG4gICAgICAgICAgICB2YXIgcGFyZW50RGF0YSA9ICQkLmQzLnNlbGVjdCh0aGlzLnBhcmVudE5vZGUpLmRhdHVtKCk7XG4gICAgICAgICAgICAkJC5kMy5zZWxlY3QodGhpcykuZGF0dW0ocGFyZW50RGF0YSk7XG4gICAgICAgIH0pLFxuICAgICAgICAgICAgeCA9ICQkLnJlZ2lvblguYmluZCgkJCksXG4gICAgICAgICAgICB5ID0gJCQucmVnaW9uWS5iaW5kKCQkKSxcbiAgICAgICAgICAgIHcgPSAkJC5yZWdpb25XaWR0aC5iaW5kKCQkKSxcbiAgICAgICAgICAgIGggPSAkJC5yZWdpb25IZWlnaHQuYmluZCgkJCk7XG4gICAgICAgIHJldHVybiBbKHdpdGhUcmFuc2l0aW9uID8gcmVnaW9ucy50cmFuc2l0aW9uKCkgOiByZWdpb25zKS5hdHRyKFwieFwiLCB4KS5hdHRyKFwieVwiLCB5KS5hdHRyKFwid2lkdGhcIiwgdykuYXR0cihcImhlaWdodFwiLCBoKS5zdHlsZShcImZpbGwtb3BhY2l0eVwiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGlzVmFsdWUoZC5vcGFjaXR5KSA/IGQub3BhY2l0eSA6IDAuMTtcbiAgICAgICAgfSldO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVnaW9uWCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB4UG9zLFxuICAgICAgICAgICAgeVNjYWxlID0gZC5heGlzID09PSAneScgPyAkJC55IDogJCQueTI7XG4gICAgICAgIGlmIChkLmF4aXMgPT09ICd5JyB8fCBkLmF4aXMgPT09ICd5MicpIHtcbiAgICAgICAgICAgIHhQb3MgPSBjb25maWcuYXhpc19yb3RhdGVkID8gJ3N0YXJ0JyBpbiBkID8geVNjYWxlKGQuc3RhcnQpIDogMCA6IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB4UG9zID0gY29uZmlnLmF4aXNfcm90YXRlZCA/IDAgOiAnc3RhcnQnIGluIGQgPyAkJC54KCQkLmlzVGltZVNlcmllcygpID8gJCQucGFyc2VEYXRlKGQuc3RhcnQpIDogZC5zdGFydCkgOiAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB4UG9zO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVnaW9uWSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB5UG9zLFxuICAgICAgICAgICAgeVNjYWxlID0gZC5heGlzID09PSAneScgPyAkJC55IDogJCQueTI7XG4gICAgICAgIGlmIChkLmF4aXMgPT09ICd5JyB8fCBkLmF4aXMgPT09ICd5MicpIHtcbiAgICAgICAgICAgIHlQb3MgPSBjb25maWcuYXhpc19yb3RhdGVkID8gMCA6ICdlbmQnIGluIGQgPyB5U2NhbGUoZC5lbmQpIDogMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHlQb3MgPSBjb25maWcuYXhpc19yb3RhdGVkID8gJ3N0YXJ0JyBpbiBkID8gJCQueCgkJC5pc1RpbWVTZXJpZXMoKSA/ICQkLnBhcnNlRGF0ZShkLnN0YXJ0KSA6IGQuc3RhcnQpIDogMCA6IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHlQb3M7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5yZWdpb25XaWR0aCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBzdGFydCA9ICQkLnJlZ2lvblgoZCksXG4gICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICB5U2NhbGUgPSBkLmF4aXMgPT09ICd5JyA/ICQkLnkgOiAkJC55MjtcbiAgICAgICAgaWYgKGQuYXhpcyA9PT0gJ3knIHx8IGQuYXhpcyA9PT0gJ3kyJykge1xuICAgICAgICAgICAgZW5kID0gY29uZmlnLmF4aXNfcm90YXRlZCA/ICdlbmQnIGluIGQgPyB5U2NhbGUoZC5lbmQpIDogJCQud2lkdGggOiAkJC53aWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVuZCA9IGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAkJC53aWR0aCA6ICdlbmQnIGluIGQgPyAkJC54KCQkLmlzVGltZVNlcmllcygpID8gJCQucGFyc2VEYXRlKGQuZW5kKSA6IGQuZW5kKSA6ICQkLndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbmQgPCBzdGFydCA/IDAgOiBlbmQgLSBzdGFydDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlZ2lvbkhlaWdodCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBzdGFydCA9IHRoaXMucmVnaW9uWShkKSxcbiAgICAgICAgICAgIGVuZCxcbiAgICAgICAgICAgIHlTY2FsZSA9IGQuYXhpcyA9PT0gJ3knID8gJCQueSA6ICQkLnkyO1xuICAgICAgICBpZiAoZC5heGlzID09PSAneScgfHwgZC5heGlzID09PSAneTInKSB7XG4gICAgICAgICAgICBlbmQgPSBjb25maWcuYXhpc19yb3RhdGVkID8gJCQuaGVpZ2h0IDogJ3N0YXJ0JyBpbiBkID8geVNjYWxlKGQuc3RhcnQpIDogJCQuaGVpZ2h0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZW5kID0gY29uZmlnLmF4aXNfcm90YXRlZCA/ICdlbmQnIGluIGQgPyAkJC54KCQkLmlzVGltZVNlcmllcygpID8gJCQucGFyc2VEYXRlKGQuZW5kKSA6IGQuZW5kKSA6ICQkLmhlaWdodCA6ICQkLmhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZW5kIDwgc3RhcnQgPyAwIDogZW5kIC0gc3RhcnQ7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc1JlZ2lvbk9uWCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiAhZC5heGlzIHx8IGQuYXhpcyA9PT0gJ3gnO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5kcmFnID0gZnVuY3Rpb24gKG1vdXNlKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBtYWluID0gJCQubWFpbixcbiAgICAgICAgICAgIGQzID0gJCQuZDM7XG4gICAgICAgIHZhciBzeCwgc3ksIG14LCBteSwgbWluWCwgbWF4WCwgbWluWSwgbWF4WTtcblxuICAgICAgICBpZiAoJCQuaGFzQXJjVHlwZSgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb25maWcuZGF0YV9zZWxlY3Rpb25fZW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IC8vIGRvIG5vdGhpbmcgaWYgbm90IHNlbGVjdGFibGVcbiAgICAgICAgaWYgKGNvbmZpZy56b29tX2VuYWJsZWQgJiYgISQkLnpvb20uYWx0RG9tYWluKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gLy8gc2tpcCBpZiB6b29tYWJsZSBiZWNhdXNlIG9mIGNvbmZsaWN0IGRyYWcgZGVoYXZpb3JcbiAgICAgICAgaWYgKCFjb25maWcuZGF0YV9zZWxlY3Rpb25fbXVsdGlwbGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBza2lwIHdoZW4gc2luZ2xlIHNlbGVjdGlvbiBiZWNhdXNlIGRyYWcgaXMgdXNlZCBmb3IgbXVsdGlwbGUgc2VsZWN0aW9uXG5cbiAgICAgICAgc3ggPSAkJC5kcmFnU3RhcnRbMF07XG4gICAgICAgIHN5ID0gJCQuZHJhZ1N0YXJ0WzFdO1xuICAgICAgICBteCA9IG1vdXNlWzBdO1xuICAgICAgICBteSA9IG1vdXNlWzFdO1xuICAgICAgICBtaW5YID0gTWF0aC5taW4oc3gsIG14KTtcbiAgICAgICAgbWF4WCA9IE1hdGgubWF4KHN4LCBteCk7XG4gICAgICAgIG1pblkgPSBjb25maWcuZGF0YV9zZWxlY3Rpb25fZ3JvdXBlZCA/ICQkLm1hcmdpbi50b3AgOiBNYXRoLm1pbihzeSwgbXkpO1xuICAgICAgICBtYXhZID0gY29uZmlnLmRhdGFfc2VsZWN0aW9uX2dyb3VwZWQgPyAkJC5oZWlnaHQgOiBNYXRoLm1heChzeSwgbXkpO1xuXG4gICAgICAgIG1haW4uc2VsZWN0KCcuJyArIENMQVNTLmRyYWdhcmVhKS5hdHRyKCd4JywgbWluWCkuYXR0cigneScsIG1pblkpLmF0dHIoJ3dpZHRoJywgbWF4WCAtIG1pblgpLmF0dHIoJ2hlaWdodCcsIG1heFkgLSBtaW5ZKTtcbiAgICAgICAgLy8gVE9ETzogYmluYXJ5IHNlYXJjaCB3aGVuIG11bHRpcGxlIHhzXG4gICAgICAgIG1haW4uc2VsZWN0QWxsKCcuJyArIENMQVNTLnNoYXBlcykuc2VsZWN0QWxsKCcuJyArIENMQVNTLnNoYXBlKS5maWx0ZXIoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuZGF0YV9zZWxlY3Rpb25faXNzZWxlY3RhYmxlKGQpO1xuICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICB2YXIgc2hhcGUgPSBkMy5zZWxlY3QodGhpcyksXG4gICAgICAgICAgICAgICAgaXNTZWxlY3RlZCA9IHNoYXBlLmNsYXNzZWQoQ0xBU1MuU0VMRUNURUQpLFxuICAgICAgICAgICAgICAgIGlzSW5jbHVkZWQgPSBzaGFwZS5jbGFzc2VkKENMQVNTLklOQ0xVREVEKSxcbiAgICAgICAgICAgICAgICBfeCxcbiAgICAgICAgICAgICAgICBfeSxcbiAgICAgICAgICAgICAgICBfdyxcbiAgICAgICAgICAgICAgICBfaCxcbiAgICAgICAgICAgICAgICB0b2dnbGUsXG4gICAgICAgICAgICAgICAgaXNXaXRoaW4gPSBmYWxzZSxcbiAgICAgICAgICAgICAgICBib3g7XG4gICAgICAgICAgICBpZiAoc2hhcGUuY2xhc3NlZChDTEFTUy5jaXJjbGUpKSB7XG4gICAgICAgICAgICAgICAgX3ggPSBzaGFwZS5hdHRyKFwiY3hcIikgKiAxO1xuICAgICAgICAgICAgICAgIF95ID0gc2hhcGUuYXR0cihcImN5XCIpICogMTtcbiAgICAgICAgICAgICAgICB0b2dnbGUgPSAkJC50b2dnbGVQb2ludDtcbiAgICAgICAgICAgICAgICBpc1dpdGhpbiA9IG1pblggPCBfeCAmJiBfeCA8IG1heFggJiYgbWluWSA8IF95ICYmIF95IDwgbWF4WTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hhcGUuY2xhc3NlZChDTEFTUy5iYXIpKSB7XG4gICAgICAgICAgICAgICAgYm94ID0gZ2V0UGF0aEJveCh0aGlzKTtcbiAgICAgICAgICAgICAgICBfeCA9IGJveC54O1xuICAgICAgICAgICAgICAgIF95ID0gYm94Lnk7XG4gICAgICAgICAgICAgICAgX3cgPSBib3gud2lkdGg7XG4gICAgICAgICAgICAgICAgX2ggPSBib3guaGVpZ2h0O1xuICAgICAgICAgICAgICAgIHRvZ2dsZSA9ICQkLnRvZ2dsZVBhdGg7XG4gICAgICAgICAgICAgICAgaXNXaXRoaW4gPSAhKG1heFggPCBfeCB8fCBfeCArIF93IDwgbWluWCkgJiYgIShtYXhZIDwgX3kgfHwgX3kgKyBfaCA8IG1pblkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBsaW5lL2FyZWEgc2VsZWN0aW9uIG5vdCBzdXBwb3J0ZWQgeWV0XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzV2l0aGluIF4gaXNJbmNsdWRlZCkge1xuICAgICAgICAgICAgICAgIHNoYXBlLmNsYXNzZWQoQ0xBU1MuSU5DTFVERUQsICFpc0luY2x1ZGVkKTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBpbmNsdWRlZC91bmluY2x1ZGVkIGNhbGxiYWNrIGhlcmVcbiAgICAgICAgICAgICAgICBzaGFwZS5jbGFzc2VkKENMQVNTLlNFTEVDVEVELCAhaXNTZWxlY3RlZCk7XG4gICAgICAgICAgICAgICAgdG9nZ2xlLmNhbGwoJCQsICFpc1NlbGVjdGVkLCBzaGFwZSwgZCwgaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5kcmFnc3RhcnQgPSBmdW5jdGlvbiAobW91c2UpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgaWYgKCQkLmhhc0FyY1R5cGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29uZmlnLmRhdGFfc2VsZWN0aW9uX2VuYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBkbyBub3RoaW5nIGlmIG5vdCBzZWxlY3RhYmxlXG4gICAgICAgICQkLmRyYWdTdGFydCA9IG1vdXNlO1xuICAgICAgICAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5jaGFydCkuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCBDTEFTUy5kcmFnYXJlYSkuc3R5bGUoJ29wYWNpdHknLCAwLjEpO1xuICAgICAgICAkJC5kcmFnZ2luZyA9IHRydWU7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmRyYWdlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIGlmICgkJC5oYXNBcmNUeXBlKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbmZpZy5kYXRhX3NlbGVjdGlvbl9lbmFibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gLy8gZG8gbm90aGluZyBpZiBub3Qgc2VsZWN0YWJsZVxuICAgICAgICAkJC5tYWluLnNlbGVjdCgnLicgKyBDTEFTUy5kcmFnYXJlYSkudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMCkuc3R5bGUoJ29wYWNpdHknLCAwKS5yZW1vdmUoKTtcbiAgICAgICAgJCQubWFpbi5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2hhcGUpLmNsYXNzZWQoQ0xBU1MuSU5DTFVERUQsIGZhbHNlKTtcbiAgICAgICAgJCQuZHJhZ2dpbmcgPSBmYWxzZTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uc2VsZWN0UG9pbnQgPSBmdW5jdGlvbiAodGFyZ2V0LCBkLCBpKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBjeCA9IChjb25maWcuYXhpc19yb3RhdGVkID8gJCQuY2lyY2xlWSA6ICQkLmNpcmNsZVgpLmJpbmQoJCQpLFxuICAgICAgICAgICAgY3kgPSAoY29uZmlnLmF4aXNfcm90YXRlZCA/ICQkLmNpcmNsZVggOiAkJC5jaXJjbGVZKS5iaW5kKCQkKSxcbiAgICAgICAgICAgIHIgPSAkJC5wb2ludFNlbGVjdFIuYmluZCgkJCk7XG4gICAgICAgIGNvbmZpZy5kYXRhX29uc2VsZWN0ZWQuY2FsbCgkJC5hcGksIGQsIHRhcmdldC5ub2RlKCkpO1xuICAgICAgICAvLyBhZGQgc2VsZWN0ZWQtY2lyY2xlIG9uIGxvdyBsYXllciBnXG4gICAgICAgICQkLm1haW4uc2VsZWN0KCcuJyArIENMQVNTLnNlbGVjdGVkQ2lyY2xlcyArICQkLmdldFRhcmdldFNlbGVjdG9yU3VmZml4KGQuaWQpKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2VsZWN0ZWRDaXJjbGUgKyAnLScgKyBpKS5kYXRhKFtkXSkuZW50ZXIoKS5hcHBlbmQoJ2NpcmNsZScpLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJCQuZ2VuZXJhdGVDbGFzcyhDTEFTUy5zZWxlY3RlZENpcmNsZSwgaSk7XG4gICAgICAgIH0pLmF0dHIoXCJjeFwiLCBjeCkuYXR0cihcImN5XCIsIGN5KS5hdHRyKFwic3Ryb2tlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5jb2xvcihkKTtcbiAgICAgICAgfSkuYXR0cihcInJcIiwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5wb2ludFNlbGVjdFIoZCkgKiAxLjQ7XG4gICAgICAgIH0pLnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDApLmF0dHIoXCJyXCIsIHIpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udW5zZWxlY3RQb2ludCA9IGZ1bmN0aW9uICh0YXJnZXQsIGQsIGkpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgJCQuY29uZmlnLmRhdGFfb251bnNlbGVjdGVkLmNhbGwoJCQuYXBpLCBkLCB0YXJnZXQubm9kZSgpKTtcbiAgICAgICAgLy8gcmVtb3ZlIHNlbGVjdGVkLWNpcmNsZSBmcm9tIGxvdyBsYXllciBnXG4gICAgICAgICQkLm1haW4uc2VsZWN0KCcuJyArIENMQVNTLnNlbGVjdGVkQ2lyY2xlcyArICQkLmdldFRhcmdldFNlbGVjdG9yU3VmZml4KGQuaWQpKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2VsZWN0ZWRDaXJjbGUgKyAnLScgKyBpKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwKS5hdHRyKCdyJywgMCkucmVtb3ZlKCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi50b2dnbGVQb2ludCA9IGZ1bmN0aW9uIChzZWxlY3RlZCwgdGFyZ2V0LCBkLCBpKSB7XG4gICAgICAgIHNlbGVjdGVkID8gdGhpcy5zZWxlY3RQb2ludCh0YXJnZXQsIGQsIGkpIDogdGhpcy51bnNlbGVjdFBvaW50KHRhcmdldCwgZCwgaSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5zZWxlY3RQYXRoID0gZnVuY3Rpb24gKHRhcmdldCwgZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICAkJC5jb25maWcuZGF0YV9vbnNlbGVjdGVkLmNhbGwoJCQsIGQsIHRhcmdldC5ub2RlKCkpO1xuICAgICAgICBpZiAoJCQuY29uZmlnLmludGVyYWN0aW9uX2JyaWdodGVuKSB7XG4gICAgICAgICAgICB0YXJnZXQudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMCkuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJCQuZDMucmdiKCQkLmNvbG9yKGQpKS5icmlnaHRlcigwLjc1KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi51bnNlbGVjdFBhdGggPSBmdW5jdGlvbiAodGFyZ2V0LCBkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgICQkLmNvbmZpZy5kYXRhX29udW5zZWxlY3RlZC5jYWxsKCQkLCBkLCB0YXJnZXQubm9kZSgpKTtcbiAgICAgICAgaWYgKCQkLmNvbmZpZy5pbnRlcmFjdGlvbl9icmlnaHRlbikge1xuICAgICAgICAgICAgdGFyZ2V0LnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDApLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQkLmNvbG9yKGQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnRvZ2dsZVBhdGggPSBmdW5jdGlvbiAoc2VsZWN0ZWQsIHRhcmdldCwgZCwgaSkge1xuICAgICAgICBzZWxlY3RlZCA/IHRoaXMuc2VsZWN0UGF0aCh0YXJnZXQsIGQsIGkpIDogdGhpcy51bnNlbGVjdFBhdGgodGFyZ2V0LCBkLCBpKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFRvZ2dsZSA9IGZ1bmN0aW9uICh0aGF0LCBkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICB0b2dnbGU7XG4gICAgICAgIGlmICh0aGF0Lm5vZGVOYW1lID09PSAnY2lyY2xlJykge1xuICAgICAgICAgICAgaWYgKCQkLmlzU3RlcFR5cGUoZCkpIHtcbiAgICAgICAgICAgICAgICAvLyBjaXJjbGUgaXMgaGlkZGVuIGluIHN0ZXAgY2hhcnQsIHNvIHRyZWF0IGFzIHdpdGhpbiB0aGUgY2xpY2sgYXJlYVxuICAgICAgICAgICAgICAgIHRvZ2dsZSA9IGZ1bmN0aW9uIHRvZ2dsZSgpIHt9OyAvLyBUT0RPOiBob3cgdG8gc2VsZWN0IHN0ZXAgY2hhcnQ/XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRvZ2dsZSA9ICQkLnRvZ2dsZVBvaW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoYXQubm9kZU5hbWUgPT09ICdwYXRoJykge1xuICAgICAgICAgICAgdG9nZ2xlID0gJCQudG9nZ2xlUGF0aDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG9nZ2xlO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udG9nZ2xlU2hhcGUgPSBmdW5jdGlvbiAodGhhdCwgZCwgaSkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZDMgPSAkJC5kMyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIHNoYXBlID0gZDMuc2VsZWN0KHRoYXQpLFxuICAgICAgICAgICAgaXNTZWxlY3RlZCA9IHNoYXBlLmNsYXNzZWQoQ0xBU1MuU0VMRUNURUQpLFxuICAgICAgICAgICAgdG9nZ2xlID0gJCQuZ2V0VG9nZ2xlKHRoYXQsIGQpLmJpbmQoJCQpO1xuXG4gICAgICAgIGlmIChjb25maWcuZGF0YV9zZWxlY3Rpb25fZW5hYmxlZCAmJiBjb25maWcuZGF0YV9zZWxlY3Rpb25faXNzZWxlY3RhYmxlKGQpKSB7XG4gICAgICAgICAgICBpZiAoIWNvbmZpZy5kYXRhX3NlbGVjdGlvbl9tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICQkLm1haW4uc2VsZWN0QWxsKCcuJyArIENMQVNTLnNoYXBlcyArIChjb25maWcuZGF0YV9zZWxlY3Rpb25fZ3JvdXBlZCA/ICQkLmdldFRhcmdldFNlbGVjdG9yU3VmZml4KGQuaWQpIDogXCJcIikpLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5zaGFwZSkuZWFjaChmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2hhcGUgPSBkMy5zZWxlY3QodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzaGFwZS5jbGFzc2VkKENMQVNTLlNFTEVDVEVEKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlKGZhbHNlLCBzaGFwZS5jbGFzc2VkKENMQVNTLlNFTEVDVEVELCBmYWxzZSksIGQsIGkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzaGFwZS5jbGFzc2VkKENMQVNTLlNFTEVDVEVELCAhaXNTZWxlY3RlZCk7XG4gICAgICAgICAgICB0b2dnbGUoIWlzU2VsZWN0ZWQsIHNoYXBlLCBkLCBpKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0QnJ1c2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBkMyA9ICQkLmQzO1xuICAgICAgICAkJC5icnVzaCA9IGQzLnN2Zy5icnVzaCgpLm9uKFwiYnJ1c2hcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCQucmVkcmF3Rm9yQnJ1c2goKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQkLmJydXNoLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkJC5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgJCQuY29udGV4dC5zZWxlY3QoJy4nICsgQ0xBU1MuYnJ1c2gpLmNhbGwodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICAgICAgJCQuYnJ1c2guc2NhbGUgPSBmdW5jdGlvbiAoc2NhbGUpIHtcbiAgICAgICAgICAgIHJldHVybiAkJC5jb25maWcuYXhpc19yb3RhdGVkID8gdGhpcy55KHNjYWxlKSA6IHRoaXMueChzY2FsZSk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0U3ViY2hhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBjb250ZXh0ID0gJCQuY29udGV4dCA9ICQkLnN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgJCQuZ2V0VHJhbnNsYXRlKCdjb250ZXh0JykpLFxuICAgICAgICAgICAgdmlzaWJpbGl0eSA9IGNvbmZpZy5zdWJjaGFydF9zaG93ID8gJ3Zpc2libGUnIDogJ2hpZGRlbic7XG5cbiAgICAgICAgY29udGV4dC5zdHlsZSgndmlzaWJpbGl0eScsIHZpc2liaWxpdHkpO1xuXG4gICAgICAgIC8vIERlZmluZSBnIGZvciBjaGFydCBhcmVhXG4gICAgICAgIGNvbnRleHQuYXBwZW5kKCdnJykuYXR0cihcImNsaXAtcGF0aFwiLCAkJC5jbGlwUGF0aEZvclN1YmNoYXJ0KS5hdHRyKCdjbGFzcycsIENMQVNTLmNoYXJ0KTtcblxuICAgICAgICAvLyBEZWZpbmUgZyBmb3IgYmFyIGNoYXJ0IGFyZWFcbiAgICAgICAgY29udGV4dC5zZWxlY3QoJy4nICsgQ0xBU1MuY2hhcnQpLmFwcGVuZChcImdcIikuYXR0cihcImNsYXNzXCIsIENMQVNTLmNoYXJ0QmFycyk7XG5cbiAgICAgICAgLy8gRGVmaW5lIGcgZm9yIGxpbmUgY2hhcnQgYXJlYVxuICAgICAgICBjb250ZXh0LnNlbGVjdCgnLicgKyBDTEFTUy5jaGFydCkuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgQ0xBU1MuY2hhcnRMaW5lcyk7XG5cbiAgICAgICAgLy8gQWRkIGV4dGVudCByZWN0IGZvciBCcnVzaFxuICAgICAgICBjb250ZXh0LmFwcGVuZChcImdcIikuYXR0cihcImNsaXAtcGF0aFwiLCAkJC5jbGlwUGF0aCkuYXR0cihcImNsYXNzXCIsIENMQVNTLmJydXNoKS5jYWxsKCQkLmJydXNoKTtcblxuICAgICAgICAvLyBBVFRFTlRJT046IFRoaXMgbXVzdCBiZSBjYWxsZWQgQUZURVIgY2hhcnQgYWRkZWRcbiAgICAgICAgLy8gQWRkIEF4aXNcbiAgICAgICAgJCQuYXhlcy5zdWJ4ID0gY29udGV4dC5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBDTEFTUy5heGlzWCkuYXR0cihcInRyYW5zZm9ybVwiLCAkJC5nZXRUcmFuc2xhdGUoJ3N1YngnKSkuYXR0cihcImNsaXAtcGF0aFwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gXCJcIiA6ICQkLmNsaXBQYXRoRm9yWEF4aXMpLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBjb25maWcuc3ViY2hhcnRfYXhpc194X3Nob3cgPyB2aXNpYmlsaXR5IDogJ2hpZGRlbicpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlVGFyZ2V0c0ZvclN1YmNoYXJ0ID0gZnVuY3Rpb24gKHRhcmdldHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbnRleHQgPSAkJC5jb250ZXh0LFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgY29udGV4dExpbmVFbnRlcixcbiAgICAgICAgICAgIGNvbnRleHRMaW5lVXBkYXRlLFxuICAgICAgICAgICAgY29udGV4dEJhckVudGVyLFxuICAgICAgICAgICAgY29udGV4dEJhclVwZGF0ZSxcbiAgICAgICAgICAgIGNsYXNzQ2hhcnRCYXIgPSAkJC5jbGFzc0NoYXJ0QmFyLmJpbmQoJCQpLFxuICAgICAgICAgICAgY2xhc3NCYXJzID0gJCQuY2xhc3NCYXJzLmJpbmQoJCQpLFxuICAgICAgICAgICAgY2xhc3NDaGFydExpbmUgPSAkJC5jbGFzc0NoYXJ0TGluZS5iaW5kKCQkKSxcbiAgICAgICAgICAgIGNsYXNzTGluZXMgPSAkJC5jbGFzc0xpbmVzLmJpbmQoJCQpLFxuICAgICAgICAgICAgY2xhc3NBcmVhcyA9ICQkLmNsYXNzQXJlYXMuYmluZCgkJCk7XG5cbiAgICAgICAgaWYgKGNvbmZpZy5zdWJjaGFydF9zaG93KSB7XG4gICAgICAgICAgICAvLy0tIEJhciAtLS8vXG4gICAgICAgICAgICBjb250ZXh0QmFyVXBkYXRlID0gY29udGV4dC5zZWxlY3QoJy4nICsgQ0xBU1MuY2hhcnRCYXJzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuY2hhcnRCYXIpLmRhdGEodGFyZ2V0cykuYXR0cignY2xhc3MnLCBjbGFzc0NoYXJ0QmFyKTtcbiAgICAgICAgICAgIGNvbnRleHRCYXJFbnRlciA9IGNvbnRleHRCYXJVcGRhdGUuZW50ZXIoKS5hcHBlbmQoJ2cnKS5zdHlsZSgnb3BhY2l0eScsIDApLmF0dHIoJ2NsYXNzJywgY2xhc3NDaGFydEJhcik7XG4gICAgICAgICAgICAvLyBCYXJzIGZvciBlYWNoIGRhdGFcbiAgICAgICAgICAgIGNvbnRleHRCYXJFbnRlci5hcHBlbmQoJ2cnKS5hdHRyKFwiY2xhc3NcIiwgY2xhc3NCYXJzKTtcblxuICAgICAgICAgICAgLy8tLSBMaW5lIC0tLy9cbiAgICAgICAgICAgIGNvbnRleHRMaW5lVXBkYXRlID0gY29udGV4dC5zZWxlY3QoJy4nICsgQ0xBU1MuY2hhcnRMaW5lcykuc2VsZWN0QWxsKCcuJyArIENMQVNTLmNoYXJ0TGluZSkuZGF0YSh0YXJnZXRzKS5hdHRyKCdjbGFzcycsIGNsYXNzQ2hhcnRMaW5lKTtcbiAgICAgICAgICAgIGNvbnRleHRMaW5lRW50ZXIgPSBjb250ZXh0TGluZVVwZGF0ZS5lbnRlcigpLmFwcGVuZCgnZycpLnN0eWxlKCdvcGFjaXR5JywgMCkuYXR0cignY2xhc3MnLCBjbGFzc0NoYXJ0TGluZSk7XG4gICAgICAgICAgICAvLyBMaW5lcyBmb3IgZWFjaCBkYXRhXG4gICAgICAgICAgICBjb250ZXh0TGluZUVudGVyLmFwcGVuZChcImdcIikuYXR0cihcImNsYXNzXCIsIGNsYXNzTGluZXMpO1xuICAgICAgICAgICAgLy8gQXJlYVxuICAgICAgICAgICAgY29udGV4dExpbmVFbnRlci5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBjbGFzc0FyZWFzKTtcblxuICAgICAgICAgICAgLy8tLSBCcnVzaCAtLS8vXG4gICAgICAgICAgICBjb250ZXh0LnNlbGVjdEFsbCgnLicgKyBDTEFTUy5icnVzaCArICcgcmVjdCcpLmF0dHIoY29uZmlnLmF4aXNfcm90YXRlZCA/IFwid2lkdGhcIiA6IFwiaGVpZ2h0XCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAkJC53aWR0aDIgOiAkJC5oZWlnaHQyKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlQmFyRm9yU3ViY2hhcnQgPSBmdW5jdGlvbiAoZHVyYXRpb25Gb3JFeGl0KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgICQkLmNvbnRleHRCYXIgPSAkJC5jb250ZXh0LnNlbGVjdEFsbCgnLicgKyBDTEFTUy5iYXJzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MuYmFyKS5kYXRhKCQkLmJhckRhdGEuYmluZCgkJCkpO1xuICAgICAgICAkJC5jb250ZXh0QmFyLmVudGVyKCkuYXBwZW5kKCdwYXRoJykuYXR0cihcImNsYXNzXCIsICQkLmNsYXNzQmFyLmJpbmQoJCQpKS5zdHlsZShcInN0cm9rZVwiLCAnbm9uZScpLnN0eWxlKFwiZmlsbFwiLCAkJC5jb2xvcik7XG4gICAgICAgICQkLmNvbnRleHRCYXIuc3R5bGUoXCJvcGFjaXR5XCIsICQkLmluaXRpYWxPcGFjaXR5LmJpbmQoJCQpKTtcbiAgICAgICAgJCQuY29udGV4dEJhci5leGl0KCkudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uRm9yRXhpdCkuc3R5bGUoJ29wYWNpdHknLCAwKS5yZW1vdmUoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlZHJhd0JhckZvclN1YmNoYXJ0ID0gZnVuY3Rpb24gKGRyYXdCYXJPblN1Yiwgd2l0aFRyYW5zaXRpb24sIGR1cmF0aW9uKSB7XG4gICAgICAgICh3aXRoVHJhbnNpdGlvbiA/IHRoaXMuY29udGV4dEJhci50cmFuc2l0aW9uKE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKSkuZHVyYXRpb24oZHVyYXRpb24pIDogdGhpcy5jb250ZXh0QmFyKS5hdHRyKCdkJywgZHJhd0Jhck9uU3ViKS5zdHlsZSgnb3BhY2l0eScsIDEpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlTGluZUZvclN1YmNoYXJ0ID0gZnVuY3Rpb24gKGR1cmF0aW9uRm9yRXhpdCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICAkJC5jb250ZXh0TGluZSA9ICQkLmNvbnRleHQuc2VsZWN0QWxsKCcuJyArIENMQVNTLmxpbmVzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1MubGluZSkuZGF0YSgkJC5saW5lRGF0YS5iaW5kKCQkKSk7XG4gICAgICAgICQkLmNvbnRleHRMaW5lLmVudGVyKCkuYXBwZW5kKCdwYXRoJykuYXR0cignY2xhc3MnLCAkJC5jbGFzc0xpbmUuYmluZCgkJCkpLnN0eWxlKCdzdHJva2UnLCAkJC5jb2xvcik7XG4gICAgICAgICQkLmNvbnRleHRMaW5lLnN0eWxlKFwib3BhY2l0eVwiLCAkJC5pbml0aWFsT3BhY2l0eS5iaW5kKCQkKSk7XG4gICAgICAgICQkLmNvbnRleHRMaW5lLmV4aXQoKS50cmFuc2l0aW9uKCkuZHVyYXRpb24oZHVyYXRpb25Gb3JFeGl0KS5zdHlsZSgnb3BhY2l0eScsIDApLnJlbW92ZSgpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVkcmF3TGluZUZvclN1YmNoYXJ0ID0gZnVuY3Rpb24gKGRyYXdMaW5lT25TdWIsIHdpdGhUcmFuc2l0aW9uLCBkdXJhdGlvbikge1xuICAgICAgICAod2l0aFRyYW5zaXRpb24gPyB0aGlzLmNvbnRleHRMaW5lLnRyYW5zaXRpb24oTWF0aC5yYW5kb20oKS50b1N0cmluZygpKS5kdXJhdGlvbihkdXJhdGlvbikgOiB0aGlzLmNvbnRleHRMaW5lKS5hdHRyKFwiZFwiLCBkcmF3TGluZU9uU3ViKS5zdHlsZSgnb3BhY2l0eScsIDEpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4udXBkYXRlQXJlYUZvclN1YmNoYXJ0ID0gZnVuY3Rpb24gKGR1cmF0aW9uRm9yRXhpdCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZDMgPSAkJC5kMztcbiAgICAgICAgJCQuY29udGV4dEFyZWEgPSAkJC5jb250ZXh0LnNlbGVjdEFsbCgnLicgKyBDTEFTUy5hcmVhcykuc2VsZWN0QWxsKCcuJyArIENMQVNTLmFyZWEpLmRhdGEoJCQubGluZURhdGEuYmluZCgkJCkpO1xuICAgICAgICAkJC5jb250ZXh0QXJlYS5lbnRlcigpLmFwcGVuZCgncGF0aCcpLmF0dHIoXCJjbGFzc1wiLCAkJC5jbGFzc0FyZWEuYmluZCgkJCkpLnN0eWxlKFwiZmlsbFwiLCAkJC5jb2xvcikuc3R5bGUoXCJvcGFjaXR5XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQkLm9yZ0FyZWFPcGFjaXR5ID0gK2QzLnNlbGVjdCh0aGlzKS5zdHlsZSgnb3BhY2l0eScpO3JldHVybiAwO1xuICAgICAgICB9KTtcbiAgICAgICAgJCQuY29udGV4dEFyZWEuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xuICAgICAgICAkJC5jb250ZXh0QXJlYS5leGl0KCkudHJhbnNpdGlvbigpLmR1cmF0aW9uKGR1cmF0aW9uRm9yRXhpdCkuc3R5bGUoJ29wYWNpdHknLCAwKS5yZW1vdmUoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlZHJhd0FyZWFGb3JTdWJjaGFydCA9IGZ1bmN0aW9uIChkcmF3QXJlYU9uU3ViLCB3aXRoVHJhbnNpdGlvbiwgZHVyYXRpb24pIHtcbiAgICAgICAgKHdpdGhUcmFuc2l0aW9uID8gdGhpcy5jb250ZXh0QXJlYS50cmFuc2l0aW9uKE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKSkuZHVyYXRpb24oZHVyYXRpb24pIDogdGhpcy5jb250ZXh0QXJlYSkuYXR0cihcImRcIiwgZHJhd0FyZWFPblN1Yikuc3R5bGUoXCJmaWxsXCIsIHRoaXMuY29sb3IpLnN0eWxlKFwib3BhY2l0eVwiLCB0aGlzLm9yZ0FyZWFPcGFjaXR5KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnJlZHJhd1N1YmNoYXJ0ID0gZnVuY3Rpb24gKHdpdGhTdWJjaGFydCwgdHJhbnNpdGlvbnMsIGR1cmF0aW9uLCBkdXJhdGlvbkZvckV4aXQsIGFyZWFJbmRpY2VzLCBiYXJJbmRpY2VzLCBsaW5lSW5kaWNlcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZDMgPSAkJC5kMyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGRyYXdBcmVhT25TdWIsXG4gICAgICAgICAgICBkcmF3QmFyT25TdWIsXG4gICAgICAgICAgICBkcmF3TGluZU9uU3ViO1xuXG4gICAgICAgICQkLmNvbnRleHQuc3R5bGUoJ3Zpc2liaWxpdHknLCBjb25maWcuc3ViY2hhcnRfc2hvdyA/ICd2aXNpYmxlJyA6ICdoaWRkZW4nKTtcblxuICAgICAgICAvLyBzdWJjaGFydFxuICAgICAgICBpZiAoY29uZmlnLnN1YmNoYXJ0X3Nob3cpIHtcbiAgICAgICAgICAgIC8vIHJlZmxlY3QgbWFpbiBjaGFydCB0byBleHRlbnQgb24gc3ViY2hhcnQgaWYgem9vbWVkXG4gICAgICAgICAgICBpZiAoZDMuZXZlbnQgJiYgZDMuZXZlbnQudHlwZSA9PT0gJ3pvb20nKSB7XG4gICAgICAgICAgICAgICAgJCQuYnJ1c2guZXh0ZW50KCQkLngub3JnRG9tYWluKCkpLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdXBkYXRlIHN1YmNoYXJ0IGVsZW1lbnRzIGlmIG5lZWRlZFxuICAgICAgICAgICAgaWYgKHdpdGhTdWJjaGFydCkge1xuXG4gICAgICAgICAgICAgICAgLy8gZXh0ZW50IHJlY3RcbiAgICAgICAgICAgICAgICBpZiAoISQkLmJydXNoLmVtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgJCQuYnJ1c2guZXh0ZW50KCQkLngub3JnRG9tYWluKCkpLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBzZXR1cCBkcmF3ZXIgLSBNRU1POiB0aGlzIG11c3QgYmUgY2FsbGVkIGFmdGVyIGF4aXMgdXBkYXRlZFxuICAgICAgICAgICAgICAgIGRyYXdBcmVhT25TdWIgPSAkJC5nZW5lcmF0ZURyYXdBcmVhKGFyZWFJbmRpY2VzLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBkcmF3QmFyT25TdWIgPSAkJC5nZW5lcmF0ZURyYXdCYXIoYmFySW5kaWNlcywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgZHJhd0xpbmVPblN1YiA9ICQkLmdlbmVyYXRlRHJhd0xpbmUobGluZUluZGljZXMsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgJCQudXBkYXRlQmFyRm9yU3ViY2hhcnQoZHVyYXRpb24pO1xuICAgICAgICAgICAgICAgICQkLnVwZGF0ZUxpbmVGb3JTdWJjaGFydChkdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgJCQudXBkYXRlQXJlYUZvclN1YmNoYXJ0KGR1cmF0aW9uKTtcblxuICAgICAgICAgICAgICAgICQkLnJlZHJhd0JhckZvclN1YmNoYXJ0KGRyYXdCYXJPblN1YiwgZHVyYXRpb24sIGR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICAkJC5yZWRyYXdMaW5lRm9yU3ViY2hhcnQoZHJhd0xpbmVPblN1YiwgZHVyYXRpb24sIGR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICAkJC5yZWRyYXdBcmVhRm9yU3ViY2hhcnQoZHJhd0FyZWFPblN1YiwgZHVyYXRpb24sIGR1cmF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVkcmF3Rm9yQnJ1c2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICB4ID0gJCQueDtcbiAgICAgICAgJCQucmVkcmF3KHtcbiAgICAgICAgICAgIHdpdGhUcmFuc2l0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgIHdpdGhZOiAkJC5jb25maWcuem9vbV9yZXNjYWxlLFxuICAgICAgICAgICAgd2l0aFN1YmNoYXJ0OiBmYWxzZSxcbiAgICAgICAgICAgIHdpdGhVcGRhdGVYRG9tYWluOiB0cnVlLFxuICAgICAgICAgICAgd2l0aERpbWVuc2lvbjogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgICQkLmNvbmZpZy5zdWJjaGFydF9vbmJydXNoLmNhbGwoJCQuYXBpLCB4Lm9yZ0RvbWFpbigpKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnRyYW5zZm9ybUNvbnRleHQgPSBmdW5jdGlvbiAod2l0aFRyYW5zaXRpb24sIHRyYW5zaXRpb25zKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBzdWJYQXhpcztcbiAgICAgICAgaWYgKHRyYW5zaXRpb25zICYmIHRyYW5zaXRpb25zLmF4aXNTdWJYKSB7XG4gICAgICAgICAgICBzdWJYQXhpcyA9IHRyYW5zaXRpb25zLmF4aXNTdWJYO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3ViWEF4aXMgPSAkJC5jb250ZXh0LnNlbGVjdCgnLicgKyBDTEFTUy5heGlzWCk7XG4gICAgICAgICAgICBpZiAod2l0aFRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgICAgICBzdWJYQXhpcyA9IHN1YlhBeGlzLnRyYW5zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAkJC5jb250ZXh0LmF0dHIoXCJ0cmFuc2Zvcm1cIiwgJCQuZ2V0VHJhbnNsYXRlKCdjb250ZXh0JykpO1xuICAgICAgICBzdWJYQXhpcy5hdHRyKFwidHJhbnNmb3JtXCIsICQkLmdldFRyYW5zbGF0ZSgnc3VieCcpKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldERlZmF1bHRFeHRlbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBleHRlbnQgPSBpc0Z1bmN0aW9uKGNvbmZpZy5heGlzX3hfZXh0ZW50KSA/IGNvbmZpZy5heGlzX3hfZXh0ZW50KCQkLmdldFhEb21haW4oJCQuZGF0YS50YXJnZXRzKSkgOiBjb25maWcuYXhpc194X2V4dGVudDtcbiAgICAgICAgaWYgKCQkLmlzVGltZVNlcmllcygpKSB7XG4gICAgICAgICAgICBleHRlbnQgPSBbJCQucGFyc2VEYXRlKGV4dGVudFswXSksICQkLnBhcnNlRGF0ZShleHRlbnRbMV0pXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXh0ZW50O1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pbml0Wm9vbSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGQzID0gJCQuZDMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBzdGFydEV2ZW50O1xuXG4gICAgICAgICQkLnpvb20gPSBkMy5iZWhhdmlvci56b29tKCkub24oXCJ6b29tc3RhcnRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhcnRFdmVudCA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50O1xuICAgICAgICAgICAgJCQuem9vbS5hbHREb21haW4gPSBkMy5ldmVudC5zb3VyY2VFdmVudC5hbHRLZXkgPyAkJC54Lm9yZ0RvbWFpbigpIDogbnVsbDtcbiAgICAgICAgICAgIGNvbmZpZy56b29tX29uem9vbXN0YXJ0LmNhbGwoJCQuYXBpLCBkMy5ldmVudC5zb3VyY2VFdmVudCk7XG4gICAgICAgIH0pLm9uKFwiem9vbVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkJC5yZWRyYXdGb3Jab29tLmNhbGwoJCQpO1xuICAgICAgICB9KS5vbignem9vbWVuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBldmVudCA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50O1xuICAgICAgICAgICAgLy8gaWYgY2xpY2ssIGRvIG5vdGhpbmcuIG90aGVyd2lzZSwgY2xpY2sgaW50ZXJhY3Rpb24gd2lsbCBiZSBjYW5jZWxlZC5cbiAgICAgICAgICAgIGlmIChldmVudCAmJiBzdGFydEV2ZW50LmNsaWVudFggPT09IGV2ZW50LmNsaWVudFggJiYgc3RhcnRFdmVudC5jbGllbnRZID09PSBldmVudC5jbGllbnRZKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCQucmVkcmF3RXZlbnRSZWN0KCk7XG4gICAgICAgICAgICAkJC51cGRhdGVab29tKCk7XG4gICAgICAgICAgICBjb25maWcuem9vbV9vbnpvb21lbmQuY2FsbCgkJC5hcGksICQkLngub3JnRG9tYWluKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgJCQuem9vbS5zY2FsZSA9IGZ1bmN0aW9uIChzY2FsZSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyB0aGlzLnkoc2NhbGUpIDogdGhpcy54KHNjYWxlKTtcbiAgICAgICAgfTtcbiAgICAgICAgJCQuem9vbS5vcmdTY2FsZUV4dGVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBleHRlbnQgPSBjb25maWcuem9vbV9leHRlbnQgPyBjb25maWcuem9vbV9leHRlbnQgOiBbMSwgMTBdO1xuICAgICAgICAgICAgcmV0dXJuIFtleHRlbnRbMF0sIE1hdGgubWF4KCQkLmdldE1heERhdGFDb3VudCgpIC8gZXh0ZW50WzFdLCBleHRlbnRbMV0pXTtcbiAgICAgICAgfTtcbiAgICAgICAgJCQuem9vbS51cGRhdGVTY2FsZUV4dGVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciByYXRpbyA9IGRpZmZEb21haW4oJCQueC5vcmdEb21haW4oKSkgLyBkaWZmRG9tYWluKCQkLmdldFpvb21Eb21haW4oKSksXG4gICAgICAgICAgICAgICAgZXh0ZW50ID0gdGhpcy5vcmdTY2FsZUV4dGVudCgpO1xuICAgICAgICAgICAgdGhpcy5zY2FsZUV4dGVudChbZXh0ZW50WzBdICogcmF0aW8sIGV4dGVudFsxXSAqIHJhdGlvXSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFpvb21Eb21haW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBkMyA9ICQkLmQzLFxuICAgICAgICAgICAgbWluID0gZDMubWluKFskJC5vcmdYRG9tYWluWzBdLCBjb25maWcuem9vbV94X21pbl0pLFxuICAgICAgICAgICAgbWF4ID0gZDMubWF4KFskJC5vcmdYRG9tYWluWzFdLCBjb25maWcuem9vbV94X21heF0pO1xuICAgICAgICByZXR1cm4gW21pbiwgbWF4XTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnVwZGF0ZVpvb20gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICB6ID0gJCQuY29uZmlnLnpvb21fZW5hYmxlZCA/ICQkLnpvb20gOiBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1Muem9vbVJlY3QpLmNhbGwoeikub24oXCJkYmxjbGljay56b29tXCIsIG51bGwpO1xuICAgICAgICAkJC5tYWluLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5ldmVudFJlY3QpLmNhbGwoeikub24oXCJkYmxjbGljay56b29tXCIsIG51bGwpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4ucmVkcmF3Rm9yWm9vbSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGQzID0gJCQuZDMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICB6b29tID0gJCQuem9vbSxcbiAgICAgICAgICAgIHggPSAkJC54O1xuICAgICAgICBpZiAoIWNvbmZpZy56b29tX2VuYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJCQuZmlsdGVyVGFyZ2V0c1RvU2hvdygkJC5kYXRhLnRhcmdldHMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkMy5ldmVudC5zb3VyY2VFdmVudC50eXBlID09PSAnbW91c2Vtb3ZlJyAmJiB6b29tLmFsdERvbWFpbikge1xuICAgICAgICAgICAgeC5kb21haW4oem9vbS5hbHREb21haW4pO1xuICAgICAgICAgICAgem9vbS5zY2FsZSh4KS51cGRhdGVTY2FsZUV4dGVudCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkJC5pc0NhdGVnb3JpemVkKCkgJiYgeC5vcmdEb21haW4oKVswXSA9PT0gJCQub3JnWERvbWFpblswXSkge1xuICAgICAgICAgICAgeC5kb21haW4oWyQkLm9yZ1hEb21haW5bMF0gLSAxZS0xMCwgeC5vcmdEb21haW4oKVsxXV0pO1xuICAgICAgICB9XG4gICAgICAgICQkLnJlZHJhdyh7XG4gICAgICAgICAgICB3aXRoVHJhbnNpdGlvbjogZmFsc2UsXG4gICAgICAgICAgICB3aXRoWTogY29uZmlnLnpvb21fcmVzY2FsZSxcbiAgICAgICAgICAgIHdpdGhTdWJjaGFydDogZmFsc2UsXG4gICAgICAgICAgICB3aXRoRXZlbnRSZWN0OiBmYWxzZSxcbiAgICAgICAgICAgIHdpdGhEaW1lbnNpb246IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZDMuZXZlbnQuc291cmNlRXZlbnQudHlwZSA9PT0gJ21vdXNlbW92ZScpIHtcbiAgICAgICAgICAgICQkLmNhbmNlbENsaWNrID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25maWcuem9vbV9vbnpvb20uY2FsbCgkJC5hcGksIHgub3JnRG9tYWluKCkpO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZW5lcmF0ZUNvbG9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgZDMgPSAkJC5kMyxcbiAgICAgICAgICAgIGNvbG9ycyA9IGNvbmZpZy5kYXRhX2NvbG9ycyxcbiAgICAgICAgICAgIHBhdHRlcm4gPSBub3RFbXB0eShjb25maWcuY29sb3JfcGF0dGVybikgPyBjb25maWcuY29sb3JfcGF0dGVybiA6IGQzLnNjYWxlLmNhdGVnb3J5MTAoKS5yYW5nZSgpLFxuICAgICAgICAgICAgY2FsbGJhY2sgPSBjb25maWcuZGF0YV9jb2xvcixcbiAgICAgICAgICAgIGlkcyA9IFtdO1xuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgdmFyIGlkID0gZC5pZCB8fCBkLmRhdGEgJiYgZC5kYXRhLmlkIHx8IGQsXG4gICAgICAgICAgICAgICAgY29sb3I7XG5cbiAgICAgICAgICAgIC8vIGlmIGNhbGxiYWNrIGZ1bmN0aW9uIGlzIHByb3ZpZGVkXG4gICAgICAgICAgICBpZiAoY29sb3JzW2lkXSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSBjb2xvcnNbaWRdKGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gaWYgc3BlY2lmaWVkLCBjaG9vc2UgdGhhdCBjb2xvclxuICAgICAgICAgICAgZWxzZSBpZiAoY29sb3JzW2lkXSkge1xuICAgICAgICAgICAgICAgICAgICBjb2xvciA9IGNvbG9yc1tpZF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCBzcGVjaWZpZWQsIGNob29zZSBmcm9tIHBhdHRlcm5cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHMuaW5kZXhPZihpZCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRzLnB1c2goaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBwYXR0ZXJuW2lkcy5pbmRleE9mKGlkKSAlIHBhdHRlcm4ubGVuZ3RoXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yc1tpZF0gPSBjb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24gPyBjYWxsYmFjayhjb2xvciwgZCkgOiBjb2xvcjtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlTGV2ZWxDb2xvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcyxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZyxcbiAgICAgICAgICAgIGNvbG9ycyA9IGNvbmZpZy5jb2xvcl9wYXR0ZXJuLFxuICAgICAgICAgICAgdGhyZXNob2xkID0gY29uZmlnLmNvbG9yX3RocmVzaG9sZCxcbiAgICAgICAgICAgIGFzVmFsdWUgPSB0aHJlc2hvbGQudW5pdCA9PT0gJ3ZhbHVlJyxcbiAgICAgICAgICAgIHZhbHVlcyA9IHRocmVzaG9sZC52YWx1ZXMgJiYgdGhyZXNob2xkLnZhbHVlcy5sZW5ndGggPyB0aHJlc2hvbGQudmFsdWVzIDogW10sXG4gICAgICAgICAgICBtYXggPSB0aHJlc2hvbGQubWF4IHx8IDEwMDtcbiAgICAgICAgcmV0dXJuIG5vdEVtcHR5KGNvbmZpZy5jb2xvcl90aHJlc2hvbGQpID8gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgICAgICB2LFxuICAgICAgICAgICAgICAgIGNvbG9yID0gY29sb3JzW2NvbG9ycy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2ID0gYXNWYWx1ZSA/IHZhbHVlIDogdmFsdWUgKiAxMDAgLyBtYXg7XG4gICAgICAgICAgICAgICAgaWYgKHYgPCB2YWx1ZXNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBjb2xvcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb2xvcjtcbiAgICAgICAgfSA6IG51bGw7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFlGb3JtYXQgPSBmdW5jdGlvbiAoZm9yQXJjKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBmb3JtYXRGb3JZID0gZm9yQXJjICYmICEkJC5oYXNUeXBlKCdnYXVnZScpID8gJCQuZGVmYXVsdEFyY1ZhbHVlRm9ybWF0IDogJCQueUZvcm1hdCxcbiAgICAgICAgICAgIGZvcm1hdEZvclkyID0gZm9yQXJjICYmICEkJC5oYXNUeXBlKCdnYXVnZScpID8gJCQuZGVmYXVsdEFyY1ZhbHVlRm9ybWF0IDogJCQueTJGb3JtYXQ7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodiwgcmF0aW8sIGlkKSB7XG4gICAgICAgICAgICB2YXIgZm9ybWF0ID0gJCQuYXhpcy5nZXRJZChpZCkgPT09ICd5MicgPyBmb3JtYXRGb3JZMiA6IGZvcm1hdEZvclk7XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0LmNhbGwoJCQsIHYsIHJhdGlvKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnlGb3JtYXQgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgZm9ybWF0ID0gY29uZmlnLmF4aXNfeV90aWNrX2Zvcm1hdCA/IGNvbmZpZy5heGlzX3lfdGlja19mb3JtYXQgOiAkJC5kZWZhdWx0VmFsdWVGb3JtYXQ7XG4gICAgICAgIHJldHVybiBmb3JtYXQodik7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi55MkZvcm1hdCA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBmb3JtYXQgPSBjb25maWcuYXhpc195Ml90aWNrX2Zvcm1hdCA/IGNvbmZpZy5heGlzX3kyX3RpY2tfZm9ybWF0IDogJCQuZGVmYXVsdFZhbHVlRm9ybWF0O1xuICAgICAgICByZXR1cm4gZm9ybWF0KHYpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uZGVmYXVsdFZhbHVlRm9ybWF0ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgcmV0dXJuIGlzVmFsdWUodikgPyArdiA6IFwiXCI7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5kZWZhdWx0QXJjVmFsdWVGb3JtYXQgPSBmdW5jdGlvbiAodiwgcmF0aW8pIHtcbiAgICAgICAgcmV0dXJuIChyYXRpbyAqIDEwMCkudG9GaXhlZCgxKSArICclJztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmRhdGFMYWJlbEZvcm1hdCA9IGZ1bmN0aW9uICh0YXJnZXRJZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgZGF0YV9sYWJlbHMgPSAkJC5jb25maWcuZGF0YV9sYWJlbHMsXG4gICAgICAgICAgICBmb3JtYXQsXG4gICAgICAgICAgICBkZWZhdWx0Rm9ybWF0ID0gZnVuY3Rpb24gZGVmYXVsdEZvcm1hdCh2KSB7XG4gICAgICAgICAgICByZXR1cm4gaXNWYWx1ZSh2KSA/ICt2IDogXCJcIjtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gZmluZCBmb3JtYXQgYWNjb3JkaW5nIHRvIGF4aXMgaWRcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhX2xhYmVscy5mb3JtYXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGZvcm1hdCA9IGRhdGFfbGFiZWxzLmZvcm1hdDtcbiAgICAgICAgfSBlbHNlIGlmIChfdHlwZW9mKGRhdGFfbGFiZWxzLmZvcm1hdCkgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBpZiAoZGF0YV9sYWJlbHMuZm9ybWF0W3RhcmdldElkXSkge1xuICAgICAgICAgICAgICAgIGZvcm1hdCA9IGRhdGFfbGFiZWxzLmZvcm1hdFt0YXJnZXRJZF0gPT09IHRydWUgPyBkZWZhdWx0Rm9ybWF0IDogZGF0YV9sYWJlbHMuZm9ybWF0W3RhcmdldElkXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0ID0gZnVuY3Rpb24gZm9ybWF0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvcm1hdCA9IGRlZmF1bHRGb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZvcm1hdDtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uaGFzQ2FjaGVzID0gZnVuY3Rpb24gKGlkcykge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKCEoaWRzW2ldIGluIHRoaXMuY2FjaGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uYWRkQ2FjaGUgPSBmdW5jdGlvbiAoaWQsIHRhcmdldCkge1xuICAgICAgICB0aGlzLmNhY2hlW2lkXSA9IHRoaXMuY2xvbmVUYXJnZXQodGFyZ2V0KTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldENhY2hlcyA9IGZ1bmN0aW9uIChpZHMpIHtcbiAgICAgICAgdmFyIHRhcmdldHMgPSBbXSxcbiAgICAgICAgICAgIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChpZHNbaV0gaW4gdGhpcy5jYWNoZSkge1xuICAgICAgICAgICAgICAgIHRhcmdldHMucHVzaCh0aGlzLmNsb25lVGFyZ2V0KHRoaXMuY2FjaGVbaWRzW2ldXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0YXJnZXRzO1xuICAgIH07XG5cbiAgICB2YXIgQ0xBU1MgPSBjM19jaGFydF9pbnRlcm5hbF9mbi5DTEFTUyA9IHtcbiAgICAgICAgdGFyZ2V0OiAnYzMtdGFyZ2V0JyxcbiAgICAgICAgY2hhcnQ6ICdjMy1jaGFydCcsXG4gICAgICAgIGNoYXJ0TGluZTogJ2MzLWNoYXJ0LWxpbmUnLFxuICAgICAgICBjaGFydExpbmVzOiAnYzMtY2hhcnQtbGluZXMnLFxuICAgICAgICBjaGFydEJhcjogJ2MzLWNoYXJ0LWJhcicsXG4gICAgICAgIGNoYXJ0QmFyczogJ2MzLWNoYXJ0LWJhcnMnLFxuICAgICAgICBjaGFydFRleHQ6ICdjMy1jaGFydC10ZXh0JyxcbiAgICAgICAgY2hhcnRUZXh0czogJ2MzLWNoYXJ0LXRleHRzJyxcbiAgICAgICAgY2hhcnRBcmM6ICdjMy1jaGFydC1hcmMnLFxuICAgICAgICBjaGFydEFyY3M6ICdjMy1jaGFydC1hcmNzJyxcbiAgICAgICAgY2hhcnRBcmNzVGl0bGU6ICdjMy1jaGFydC1hcmNzLXRpdGxlJyxcbiAgICAgICAgY2hhcnRBcmNzQmFja2dyb3VuZDogJ2MzLWNoYXJ0LWFyY3MtYmFja2dyb3VuZCcsXG4gICAgICAgIGNoYXJ0QXJjc0dhdWdlVW5pdDogJ2MzLWNoYXJ0LWFyY3MtZ2F1Z2UtdW5pdCcsXG4gICAgICAgIGNoYXJ0QXJjc0dhdWdlTWF4OiAnYzMtY2hhcnQtYXJjcy1nYXVnZS1tYXgnLFxuICAgICAgICBjaGFydEFyY3NHYXVnZU1pbjogJ2MzLWNoYXJ0LWFyY3MtZ2F1Z2UtbWluJyxcbiAgICAgICAgc2VsZWN0ZWRDaXJjbGU6ICdjMy1zZWxlY3RlZC1jaXJjbGUnLFxuICAgICAgICBzZWxlY3RlZENpcmNsZXM6ICdjMy1zZWxlY3RlZC1jaXJjbGVzJyxcbiAgICAgICAgZXZlbnRSZWN0OiAnYzMtZXZlbnQtcmVjdCcsXG4gICAgICAgIGV2ZW50UmVjdHM6ICdjMy1ldmVudC1yZWN0cycsXG4gICAgICAgIGV2ZW50UmVjdHNTaW5nbGU6ICdjMy1ldmVudC1yZWN0cy1zaW5nbGUnLFxuICAgICAgICBldmVudFJlY3RzTXVsdGlwbGU6ICdjMy1ldmVudC1yZWN0cy1tdWx0aXBsZScsXG4gICAgICAgIHpvb21SZWN0OiAnYzMtem9vbS1yZWN0JyxcbiAgICAgICAgYnJ1c2g6ICdjMy1icnVzaCcsXG4gICAgICAgIGZvY3VzZWQ6ICdjMy1mb2N1c2VkJyxcbiAgICAgICAgZGVmb2N1c2VkOiAnYzMtZGVmb2N1c2VkJyxcbiAgICAgICAgcmVnaW9uOiAnYzMtcmVnaW9uJyxcbiAgICAgICAgcmVnaW9uczogJ2MzLXJlZ2lvbnMnLFxuICAgICAgICB0aXRsZTogJ2MzLXRpdGxlJyxcbiAgICAgICAgdG9vbHRpcENvbnRhaW5lcjogJ2MzLXRvb2x0aXAtY29udGFpbmVyJyxcbiAgICAgICAgdG9vbHRpcDogJ2MzLXRvb2x0aXAnLFxuICAgICAgICB0b29sdGlwTmFtZTogJ2MzLXRvb2x0aXAtbmFtZScsXG4gICAgICAgIHNoYXBlOiAnYzMtc2hhcGUnLFxuICAgICAgICBzaGFwZXM6ICdjMy1zaGFwZXMnLFxuICAgICAgICBsaW5lOiAnYzMtbGluZScsXG4gICAgICAgIGxpbmVzOiAnYzMtbGluZXMnLFxuICAgICAgICBiYXI6ICdjMy1iYXInLFxuICAgICAgICBiYXJzOiAnYzMtYmFycycsXG4gICAgICAgIGNpcmNsZTogJ2MzLWNpcmNsZScsXG4gICAgICAgIGNpcmNsZXM6ICdjMy1jaXJjbGVzJyxcbiAgICAgICAgYXJjOiAnYzMtYXJjJyxcbiAgICAgICAgYXJjczogJ2MzLWFyY3MnLFxuICAgICAgICBhcmVhOiAnYzMtYXJlYScsXG4gICAgICAgIGFyZWFzOiAnYzMtYXJlYXMnLFxuICAgICAgICBlbXB0eTogJ2MzLWVtcHR5JyxcbiAgICAgICAgdGV4dDogJ2MzLXRleHQnLFxuICAgICAgICB0ZXh0czogJ2MzLXRleHRzJyxcbiAgICAgICAgZ2F1Z2VWYWx1ZTogJ2MzLWdhdWdlLXZhbHVlJyxcbiAgICAgICAgZ3JpZDogJ2MzLWdyaWQnLFxuICAgICAgICBncmlkTGluZXM6ICdjMy1ncmlkLWxpbmVzJyxcbiAgICAgICAgeGdyaWQ6ICdjMy14Z3JpZCcsXG4gICAgICAgIHhncmlkczogJ2MzLXhncmlkcycsXG4gICAgICAgIHhncmlkTGluZTogJ2MzLXhncmlkLWxpbmUnLFxuICAgICAgICB4Z3JpZExpbmVzOiAnYzMteGdyaWQtbGluZXMnLFxuICAgICAgICB4Z3JpZEZvY3VzOiAnYzMteGdyaWQtZm9jdXMnLFxuICAgICAgICB5Z3JpZDogJ2MzLXlncmlkJyxcbiAgICAgICAgeWdyaWRzOiAnYzMteWdyaWRzJyxcbiAgICAgICAgeWdyaWRMaW5lOiAnYzMteWdyaWQtbGluZScsXG4gICAgICAgIHlncmlkTGluZXM6ICdjMy15Z3JpZC1saW5lcycsXG4gICAgICAgIGF4aXM6ICdjMy1heGlzJyxcbiAgICAgICAgYXhpc1g6ICdjMy1heGlzLXgnLFxuICAgICAgICBheGlzWExhYmVsOiAnYzMtYXhpcy14LWxhYmVsJyxcbiAgICAgICAgYXhpc1k6ICdjMy1heGlzLXknLFxuICAgICAgICBheGlzWUxhYmVsOiAnYzMtYXhpcy15LWxhYmVsJyxcbiAgICAgICAgYXhpc1kyOiAnYzMtYXhpcy15MicsXG4gICAgICAgIGF4aXNZMkxhYmVsOiAnYzMtYXhpcy15Mi1sYWJlbCcsXG4gICAgICAgIGxlZ2VuZEJhY2tncm91bmQ6ICdjMy1sZWdlbmQtYmFja2dyb3VuZCcsXG4gICAgICAgIGxlZ2VuZEl0ZW06ICdjMy1sZWdlbmQtaXRlbScsXG4gICAgICAgIGxlZ2VuZEl0ZW1FdmVudDogJ2MzLWxlZ2VuZC1pdGVtLWV2ZW50JyxcbiAgICAgICAgbGVnZW5kSXRlbVRpbGU6ICdjMy1sZWdlbmQtaXRlbS10aWxlJyxcbiAgICAgICAgbGVnZW5kSXRlbUhpZGRlbjogJ2MzLWxlZ2VuZC1pdGVtLWhpZGRlbicsXG4gICAgICAgIGxlZ2VuZEl0ZW1Gb2N1c2VkOiAnYzMtbGVnZW5kLWl0ZW0tZm9jdXNlZCcsXG4gICAgICAgIGRyYWdhcmVhOiAnYzMtZHJhZ2FyZWEnLFxuICAgICAgICBFWFBBTkRFRDogJ19leHBhbmRlZF8nLFxuICAgICAgICBTRUxFQ1RFRDogJ19zZWxlY3RlZF8nLFxuICAgICAgICBJTkNMVURFRDogJ19pbmNsdWRlZF8nXG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5nZW5lcmF0ZUNsYXNzID0gZnVuY3Rpb24gKHByZWZpeCwgdGFyZ2V0SWQpIHtcbiAgICAgICAgcmV0dXJuIFwiIFwiICsgcHJlZml4ICsgXCIgXCIgKyBwcmVmaXggKyB0aGlzLmdldFRhcmdldFNlbGVjdG9yU3VmZml4KHRhcmdldElkKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNsYXNzVGV4dCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlQ2xhc3MoQ0xBU1MudGV4dCwgZC5pbmRleCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc1RleHRzID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDbGFzcyhDTEFTUy50ZXh0cywgZC5pZCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc1NoYXBlID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDbGFzcyhDTEFTUy5zaGFwZSwgZC5pbmRleCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc1NoYXBlcyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlQ2xhc3MoQ0xBU1Muc2hhcGVzLCBkLmlkKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNsYXNzTGluZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsYXNzU2hhcGUoZCkgKyB0aGlzLmdlbmVyYXRlQ2xhc3MoQ0xBU1MubGluZSwgZC5pZCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc0xpbmVzID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xhc3NTaGFwZXMoZCkgKyB0aGlzLmdlbmVyYXRlQ2xhc3MoQ0xBU1MubGluZXMsIGQuaWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2xhc3NDaXJjbGUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jbGFzc1NoYXBlKGQpICsgdGhpcy5nZW5lcmF0ZUNsYXNzKENMQVNTLmNpcmNsZSwgZC5pbmRleCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc0NpcmNsZXMgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jbGFzc1NoYXBlcyhkKSArIHRoaXMuZ2VuZXJhdGVDbGFzcyhDTEFTUy5jaXJjbGVzLCBkLmlkKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNsYXNzQmFyID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xhc3NTaGFwZShkKSArIHRoaXMuZ2VuZXJhdGVDbGFzcyhDTEFTUy5iYXIsIGQuaW5kZXgpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2xhc3NCYXJzID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xhc3NTaGFwZXMoZCkgKyB0aGlzLmdlbmVyYXRlQ2xhc3MoQ0xBU1MuYmFycywgZC5pZCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc0FyYyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsYXNzU2hhcGUoZC5kYXRhKSArIHRoaXMuZ2VuZXJhdGVDbGFzcyhDTEFTUy5hcmMsIGQuZGF0YS5pZCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc0FyY3MgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jbGFzc1NoYXBlcyhkLmRhdGEpICsgdGhpcy5nZW5lcmF0ZUNsYXNzKENMQVNTLmFyY3MsIGQuZGF0YS5pZCk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc0FyZWEgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jbGFzc1NoYXBlKGQpICsgdGhpcy5nZW5lcmF0ZUNsYXNzKENMQVNTLmFyZWEsIGQuaWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2xhc3NBcmVhcyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsYXNzU2hhcGVzKGQpICsgdGhpcy5nZW5lcmF0ZUNsYXNzKENMQVNTLmFyZWFzLCBkLmlkKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNsYXNzUmVnaW9uID0gZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDbGFzcyhDTEFTUy5yZWdpb24sIGkpICsgJyAnICsgKCdjbGFzcycgaW4gZCA/IGRbJ2NsYXNzJ10gOiAnJyk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc0V2ZW50ID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDbGFzcyhDTEFTUy5ldmVudFJlY3QsIGQuaW5kZXgpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2xhc3NUYXJnZXQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcztcbiAgICAgICAgdmFyIGFkZGl0aW9uYWxDbGFzc1N1ZmZpeCA9ICQkLmNvbmZpZy5kYXRhX2NsYXNzZXNbaWRdLFxuICAgICAgICAgICAgYWRkaXRpb25hbENsYXNzID0gJyc7XG4gICAgICAgIGlmIChhZGRpdGlvbmFsQ2xhc3NTdWZmaXgpIHtcbiAgICAgICAgICAgIGFkZGl0aW9uYWxDbGFzcyA9ICcgJyArIENMQVNTLnRhcmdldCArICctJyArIGFkZGl0aW9uYWxDbGFzc1N1ZmZpeDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJCQuZ2VuZXJhdGVDbGFzcyhDTEFTUy50YXJnZXQsIGlkKSArIGFkZGl0aW9uYWxDbGFzcztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNsYXNzRm9jdXMgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jbGFzc0ZvY3VzZWQoZCkgKyB0aGlzLmNsYXNzRGVmb2N1c2VkKGQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2xhc3NGb2N1c2VkID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuICcgJyArICh0aGlzLmZvY3VzZWRUYXJnZXRJZHMuaW5kZXhPZihkLmlkKSA+PSAwID8gQ0xBU1MuZm9jdXNlZCA6ICcnKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNsYXNzRGVmb2N1c2VkID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuICcgJyArICh0aGlzLmRlZm9jdXNlZFRhcmdldElkcy5pbmRleE9mKGQuaWQpID49IDAgPyBDTEFTUy5kZWZvY3VzZWQgOiAnJyk7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5jbGFzc0NoYXJ0VGV4dCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBDTEFTUy5jaGFydFRleHQgKyB0aGlzLmNsYXNzVGFyZ2V0KGQuaWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2xhc3NDaGFydExpbmUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gQ0xBU1MuY2hhcnRMaW5lICsgdGhpcy5jbGFzc1RhcmdldChkLmlkKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmNsYXNzQ2hhcnRCYXIgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gQ0xBU1MuY2hhcnRCYXIgKyB0aGlzLmNsYXNzVGFyZ2V0KGQuaWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2xhc3NDaGFydEFyYyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBDTEFTUy5jaGFydEFyYyArIHRoaXMuY2xhc3NUYXJnZXQoZC5kYXRhLmlkKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldFRhcmdldFNlbGVjdG9yU3VmZml4ID0gZnVuY3Rpb24gKHRhcmdldElkKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXRJZCB8fCB0YXJnZXRJZCA9PT0gMCA/ICgnLScgKyB0YXJnZXRJZCkucmVwbGFjZSgvW1xccz8hQCMkJV4mKigpXz0rLC48PidcIjo7XFxbXFxdXFwvfH5ge31cXFxcXS9nLCAnLScpIDogJyc7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5zZWxlY3RvclRhcmdldCA9IGZ1bmN0aW9uIChpZCwgcHJlZml4KSB7XG4gICAgICAgIHJldHVybiAocHJlZml4IHx8ICcnKSArICcuJyArIENMQVNTLnRhcmdldCArIHRoaXMuZ2V0VGFyZ2V0U2VsZWN0b3JTdWZmaXgoaWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uc2VsZWN0b3JUYXJnZXRzID0gZnVuY3Rpb24gKGlkcywgcHJlZml4KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXM7XG4gICAgICAgIGlkcyA9IGlkcyB8fCBbXTtcbiAgICAgICAgcmV0dXJuIGlkcy5sZW5ndGggPyBpZHMubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLnNlbGVjdG9yVGFyZ2V0KGlkLCBwcmVmaXgpO1xuICAgICAgICB9KSA6IG51bGw7XG4gICAgfTtcbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5zZWxlY3RvckxlZ2VuZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICByZXR1cm4gJy4nICsgQ0xBU1MubGVnZW5kSXRlbSArIHRoaXMuZ2V0VGFyZ2V0U2VsZWN0b3JTdWZmaXgoaWQpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfaW50ZXJuYWxfZm4uc2VsZWN0b3JMZWdlbmRzID0gZnVuY3Rpb24gKGlkcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gaWRzICYmIGlkcy5sZW5ndGggPyBpZHMubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmV0dXJuICQkLnNlbGVjdG9yTGVnZW5kKGlkKTtcbiAgICAgICAgfSkgOiBudWxsO1xuICAgIH07XG5cbiAgICB2YXIgaXNWYWx1ZSA9IGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzVmFsdWUgPSBmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdiB8fCB2ID09PSAwO1xuICAgIH0sXG4gICAgICAgIGlzRnVuY3Rpb24gPSBjM19jaGFydF9pbnRlcm5hbF9mbi5pc0Z1bmN0aW9uID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBvID09PSAnZnVuY3Rpb24nO1xuICAgIH0sXG4gICAgICAgIGlzU3RyaW5nID0gYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNTdHJpbmcgPSBmdW5jdGlvbiAobykge1xuICAgICAgICByZXR1cm4gdHlwZW9mIG8gPT09ICdzdHJpbmcnO1xuICAgIH0sXG4gICAgICAgIGlzVW5kZWZpbmVkID0gYzNfY2hhcnRfaW50ZXJuYWxfZm4uaXNVbmRlZmluZWQgPSBmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHYgPT09ICd1bmRlZmluZWQnO1xuICAgIH0sXG4gICAgICAgIGlzRGVmaW5lZCA9IGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzRGVmaW5lZCA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgdiAhPT0gJ3VuZGVmaW5lZCc7XG4gICAgfSxcbiAgICAgICAgY2VpbDEwID0gYzNfY2hhcnRfaW50ZXJuYWxfZm4uY2VpbDEwID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguY2VpbCh2IC8gMTApICogMTA7XG4gICAgfSxcbiAgICAgICAgYXNIYWxmUGl4ZWwgPSBjM19jaGFydF9pbnRlcm5hbF9mbi5hc0hhbGZQaXhlbCA9IGZ1bmN0aW9uIChuKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmNlaWwobikgKyAwLjU7XG4gICAgfSxcbiAgICAgICAgZGlmZkRvbWFpbiA9IGMzX2NoYXJ0X2ludGVybmFsX2ZuLmRpZmZEb21haW4gPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gZFsxXSAtIGRbMF07XG4gICAgfSxcbiAgICAgICAgaXNFbXB0eSA9IGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzRW1wdHkgPSBmdW5jdGlvbiAobykge1xuICAgICAgICByZXR1cm4gdHlwZW9mIG8gPT09ICd1bmRlZmluZWQnIHx8IG8gPT09IG51bGwgfHwgaXNTdHJpbmcobykgJiYgby5sZW5ndGggPT09IDAgfHwgKHR5cGVvZiBvID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihvKSkgPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKG8pLmxlbmd0aCA9PT0gMDtcbiAgICB9LFxuICAgICAgICBub3RFbXB0eSA9IGMzX2NoYXJ0X2ludGVybmFsX2ZuLm5vdEVtcHR5ID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuICFjM19jaGFydF9pbnRlcm5hbF9mbi5pc0VtcHR5KG8pO1xuICAgIH0sXG4gICAgICAgIGdldE9wdGlvbiA9IGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdldE9wdGlvbiA9IGZ1bmN0aW9uIChvcHRpb25zLCBrZXksIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICByZXR1cm4gaXNEZWZpbmVkKG9wdGlvbnNba2V5XSkgPyBvcHRpb25zW2tleV0gOiBkZWZhdWx0VmFsdWU7XG4gICAgfSxcbiAgICAgICAgaGFzVmFsdWUgPSBjM19jaGFydF9pbnRlcm5hbF9mbi5oYXNWYWx1ZSA9IGZ1bmN0aW9uIChkaWN0LCB2YWx1ZSkge1xuICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgT2JqZWN0LmtleXMoZGljdCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBpZiAoZGljdFtrZXldID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmb3VuZDtcbiAgICB9LFxuICAgICAgICBzYW5pdGlzZSA9IGMzX2NoYXJ0X2ludGVybmFsX2ZuLnNhbml0aXNlID0gZnVuY3Rpb24gKHN0cikge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHN0ciA9PT0gJ3N0cmluZycgPyBzdHIucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKSA6IHN0cjtcbiAgICB9LFxuICAgICAgICBnZXRQYXRoQm94ID0gYzNfY2hhcnRfaW50ZXJuYWxfZm4uZ2V0UGF0aEJveCA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gICAgICAgIHZhciBib3ggPSBwYXRoLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgICAgICAgaXRlbXMgPSBbcGF0aC5wYXRoU2VnTGlzdC5nZXRJdGVtKDApLCBwYXRoLnBhdGhTZWdMaXN0LmdldEl0ZW0oMSldLFxuICAgICAgICAgICAgbWluWCA9IGl0ZW1zWzBdLngsXG4gICAgICAgICAgICBtaW5ZID0gTWF0aC5taW4oaXRlbXNbMF0ueSwgaXRlbXNbMV0ueSk7XG4gICAgICAgIHJldHVybiB7IHg6IG1pblgsIHk6IG1pblksIHdpZHRoOiBib3gud2lkdGgsIGhlaWdodDogYm94LmhlaWdodCB9O1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi5mb2N1cyA9IGZ1bmN0aW9uICh0YXJnZXRJZHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbCxcbiAgICAgICAgICAgIGNhbmRpZGF0ZXM7XG5cbiAgICAgICAgdGFyZ2V0SWRzID0gJCQubWFwVG9UYXJnZXRJZHModGFyZ2V0SWRzKTtcbiAgICAgICAgY2FuZGlkYXRlcyA9ICQkLnN2Zy5zZWxlY3RBbGwoJCQuc2VsZWN0b3JUYXJnZXRzKHRhcmdldElkcy5maWx0ZXIoJCQuaXNUYXJnZXRUb1Nob3csICQkKSkpLCB0aGlzLnJldmVydCgpO1xuICAgICAgICB0aGlzLmRlZm9jdXMoKTtcbiAgICAgICAgY2FuZGlkYXRlcy5jbGFzc2VkKENMQVNTLmZvY3VzZWQsIHRydWUpLmNsYXNzZWQoQ0xBU1MuZGVmb2N1c2VkLCBmYWxzZSk7XG4gICAgICAgIGlmICgkJC5oYXNBcmNUeXBlKCkpIHtcbiAgICAgICAgICAgICQkLmV4cGFuZEFyYyh0YXJnZXRJZHMpO1xuICAgICAgICB9XG4gICAgICAgICQkLnRvZ2dsZUZvY3VzTGVnZW5kKHRhcmdldElkcywgdHJ1ZSk7XG5cbiAgICAgICAgJCQuZm9jdXNlZFRhcmdldElkcyA9IHRhcmdldElkcztcbiAgICAgICAgJCQuZGVmb2N1c2VkVGFyZ2V0SWRzID0gJCQuZGVmb2N1c2VkVGFyZ2V0SWRzLmZpbHRlcihmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRJZHMuaW5kZXhPZihpZCkgPCAwO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4uZGVmb2N1cyA9IGZ1bmN0aW9uICh0YXJnZXRJZHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbCxcbiAgICAgICAgICAgIGNhbmRpZGF0ZXM7XG5cbiAgICAgICAgdGFyZ2V0SWRzID0gJCQubWFwVG9UYXJnZXRJZHModGFyZ2V0SWRzKTtcbiAgICAgICAgY2FuZGlkYXRlcyA9ICQkLnN2Zy5zZWxlY3RBbGwoJCQuc2VsZWN0b3JUYXJnZXRzKHRhcmdldElkcy5maWx0ZXIoJCQuaXNUYXJnZXRUb1Nob3csICQkKSkpLCBjYW5kaWRhdGVzLmNsYXNzZWQoQ0xBU1MuZm9jdXNlZCwgZmFsc2UpLmNsYXNzZWQoQ0xBU1MuZGVmb2N1c2VkLCB0cnVlKTtcbiAgICAgICAgaWYgKCQkLmhhc0FyY1R5cGUoKSkge1xuICAgICAgICAgICAgJCQudW5leHBhbmRBcmModGFyZ2V0SWRzKTtcbiAgICAgICAgfVxuICAgICAgICAkJC50b2dnbGVGb2N1c0xlZ2VuZCh0YXJnZXRJZHMsIGZhbHNlKTtcblxuICAgICAgICAkJC5mb2N1c2VkVGFyZ2V0SWRzID0gJCQuZm9jdXNlZFRhcmdldElkcy5maWx0ZXIoZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0SWRzLmluZGV4T2YoaWQpIDwgMDtcbiAgICAgICAgfSk7XG4gICAgICAgICQkLmRlZm9jdXNlZFRhcmdldElkcyA9IHRhcmdldElkcztcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4ucmV2ZXJ0ID0gZnVuY3Rpb24gKHRhcmdldElkcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgY2FuZGlkYXRlcztcblxuICAgICAgICB0YXJnZXRJZHMgPSAkJC5tYXBUb1RhcmdldElkcyh0YXJnZXRJZHMpO1xuICAgICAgICBjYW5kaWRhdGVzID0gJCQuc3ZnLnNlbGVjdEFsbCgkJC5zZWxlY3RvclRhcmdldHModGFyZ2V0SWRzKSk7IC8vIHNob3VsZCBiZSBmb3IgYWxsIHRhcmdldHNcblxuICAgICAgICBjYW5kaWRhdGVzLmNsYXNzZWQoQ0xBU1MuZm9jdXNlZCwgZmFsc2UpLmNsYXNzZWQoQ0xBU1MuZGVmb2N1c2VkLCBmYWxzZSk7XG4gICAgICAgIGlmICgkJC5oYXNBcmNUeXBlKCkpIHtcbiAgICAgICAgICAgICQkLnVuZXhwYW5kQXJjKHRhcmdldElkcyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCQkLmNvbmZpZy5sZWdlbmRfc2hvdykge1xuICAgICAgICAgICAgJCQuc2hvd0xlZ2VuZCh0YXJnZXRJZHMuZmlsdGVyKCQkLmlzTGVnZW5kVG9TaG93LmJpbmQoJCQpKSk7XG4gICAgICAgICAgICAkJC5sZWdlbmQuc2VsZWN0QWxsKCQkLnNlbGVjdG9yTGVnZW5kcyh0YXJnZXRJZHMpKS5maWx0ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkJC5kMy5zZWxlY3QodGhpcykuY2xhc3NlZChDTEFTUy5sZWdlbmRJdGVtRm9jdXNlZCk7XG4gICAgICAgICAgICB9KS5jbGFzc2VkKENMQVNTLmxlZ2VuZEl0ZW1Gb2N1c2VkLCBmYWxzZSk7XG4gICAgICAgIH1cblxuICAgICAgICAkJC5mb2N1c2VkVGFyZ2V0SWRzID0gW107XG4gICAgICAgICQkLmRlZm9jdXNlZFRhcmdldElkcyA9IFtdO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi5zaG93ID0gZnVuY3Rpb24gKHRhcmdldElkcywgb3B0aW9ucykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgdGFyZ2V0cztcblxuICAgICAgICB0YXJnZXRJZHMgPSAkJC5tYXBUb1RhcmdldElkcyh0YXJnZXRJZHMpO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgICAkJC5yZW1vdmVIaWRkZW5UYXJnZXRJZHModGFyZ2V0SWRzKTtcbiAgICAgICAgdGFyZ2V0cyA9ICQkLnN2Zy5zZWxlY3RBbGwoJCQuc2VsZWN0b3JUYXJnZXRzKHRhcmdldElkcykpO1xuXG4gICAgICAgIHRhcmdldHMudHJhbnNpdGlvbigpLnN0eWxlKCdvcGFjaXR5JywgMSwgJ2ltcG9ydGFudCcpLmNhbGwoJCQuZW5kYWxsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0YXJnZXRzLnN0eWxlKCdvcGFjaXR5JywgbnVsbCkuc3R5bGUoJ29wYWNpdHknLCAxKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMud2l0aExlZ2VuZCkge1xuICAgICAgICAgICAgJCQuc2hvd0xlZ2VuZCh0YXJnZXRJZHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCQucmVkcmF3KHsgd2l0aFVwZGF0ZU9yZ1hEb21haW46IHRydWUsIHdpdGhVcGRhdGVYRG9tYWluOiB0cnVlLCB3aXRoTGVnZW5kOiB0cnVlIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi5oaWRlID0gZnVuY3Rpb24gKHRhcmdldElkcywgb3B0aW9ucykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgdGFyZ2V0cztcblxuICAgICAgICB0YXJnZXRJZHMgPSAkJC5tYXBUb1RhcmdldElkcyh0YXJnZXRJZHMpO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgICAkJC5hZGRIaWRkZW5UYXJnZXRJZHModGFyZ2V0SWRzKTtcbiAgICAgICAgdGFyZ2V0cyA9ICQkLnN2Zy5zZWxlY3RBbGwoJCQuc2VsZWN0b3JUYXJnZXRzKHRhcmdldElkcykpO1xuXG4gICAgICAgIHRhcmdldHMudHJhbnNpdGlvbigpLnN0eWxlKCdvcGFjaXR5JywgMCwgJ2ltcG9ydGFudCcpLmNhbGwoJCQuZW5kYWxsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0YXJnZXRzLnN0eWxlKCdvcGFjaXR5JywgbnVsbCkuc3R5bGUoJ29wYWNpdHknLCAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMud2l0aExlZ2VuZCkge1xuICAgICAgICAgICAgJCQuaGlkZUxlZ2VuZCh0YXJnZXRJZHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCQucmVkcmF3KHsgd2l0aFVwZGF0ZU9yZ1hEb21haW46IHRydWUsIHdpdGhVcGRhdGVYRG9tYWluOiB0cnVlLCB3aXRoTGVnZW5kOiB0cnVlIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi50b2dnbGUgPSBmdW5jdGlvbiAodGFyZ2V0SWRzLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcyxcbiAgICAgICAgICAgICQkID0gdGhpcy5pbnRlcm5hbDtcbiAgICAgICAgJCQubWFwVG9UYXJnZXRJZHModGFyZ2V0SWRzKS5mb3JFYWNoKGZ1bmN0aW9uICh0YXJnZXRJZCkge1xuICAgICAgICAgICAgJCQuaXNUYXJnZXRUb1Nob3codGFyZ2V0SWQpID8gdGhhdC5oaWRlKHRhcmdldElkLCBvcHRpb25zKSA6IHRoYXQuc2hvdyh0YXJnZXRJZCwgb3B0aW9ucyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi56b29tID0gZnVuY3Rpb24gKGRvbWFpbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsO1xuICAgICAgICBpZiAoZG9tYWluKSB7XG4gICAgICAgICAgICBpZiAoJCQuaXNUaW1lU2VyaWVzKCkpIHtcbiAgICAgICAgICAgICAgICBkb21haW4gPSBkb21haW4ubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkJC5wYXJzZURhdGUoeCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkJC5icnVzaC5leHRlbnQoZG9tYWluKTtcbiAgICAgICAgICAgICQkLnJlZHJhdyh7IHdpdGhVcGRhdGVYRG9tYWluOiB0cnVlLCB3aXRoWTogJCQuY29uZmlnLnpvb21fcmVzY2FsZSB9KTtcbiAgICAgICAgICAgICQkLmNvbmZpZy56b29tX29uem9vbS5jYWxsKHRoaXMsICQkLngub3JnRG9tYWluKCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkJC5icnVzaC5leHRlbnQoKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ZuLnpvb20uZW5hYmxlID0gZnVuY3Rpb24gKGVuYWJsZWQpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbDtcbiAgICAgICAgJCQuY29uZmlnLnpvb21fZW5hYmxlZCA9IGVuYWJsZWQ7XG4gICAgICAgICQkLnVwZGF0ZUFuZFJlZHJhdygpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4udW56b29tID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsO1xuICAgICAgICAkJC5icnVzaC5jbGVhcigpLnVwZGF0ZSgpO1xuICAgICAgICAkJC5yZWRyYXcoeyB3aXRoVXBkYXRlWERvbWFpbjogdHJ1ZSB9KTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4uem9vbS5tYXggPSBmdW5jdGlvbiAobWF4KSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBkMyA9ICQkLmQzO1xuICAgICAgICBpZiAobWF4ID09PSAwIHx8IG1heCkge1xuICAgICAgICAgICAgY29uZmlnLnpvb21feF9tYXggPSBkMy5tYXgoWyQkLm9yZ1hEb21haW5bMV0sIG1heF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy56b29tX3hfbWF4O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ZuLnpvb20ubWluID0gZnVuY3Rpb24gKG1pbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgZDMgPSAkJC5kMztcbiAgICAgICAgaWYgKG1pbiA9PT0gMCB8fCBtaW4pIHtcbiAgICAgICAgICAgIGNvbmZpZy56b29tX3hfbWluID0gZDMubWluKFskJC5vcmdYRG9tYWluWzBdLCBtaW5dKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuem9vbV94X21pbjtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi56b29tLnJhbmdlID0gZnVuY3Rpb24gKHJhbmdlKSB7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoaXNEZWZpbmVkKHJhbmdlLm1heCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRvbWFpbi5tYXgocmFuZ2UubWF4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0RlZmluZWQocmFuZ2UubWluKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZG9tYWluLm1pbihyYW5nZS5taW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBtYXg6IHRoaXMuZG9tYWluLm1heCgpLFxuICAgICAgICAgICAgICAgIG1pbjogdGhpcy5kb21haW4ubWluKClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4ubG9hZCA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIC8vIHVwZGF0ZSB4cyBpZiBzcGVjaWZpZWRcbiAgICAgICAgaWYgKGFyZ3MueHMpIHtcbiAgICAgICAgICAgICQkLmFkZFhzKGFyZ3MueHMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSBuYW1lcyBpZiBleGlzdHNcbiAgICAgICAgaWYgKCduYW1lcycgaW4gYXJncykge1xuICAgICAgICAgICAgYzNfY2hhcnRfZm4uZGF0YS5uYW1lcy5iaW5kKHRoaXMpKGFyZ3MubmFtZXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSBjbGFzc2VzIGlmIGV4aXN0c1xuICAgICAgICBpZiAoJ2NsYXNzZXMnIGluIGFyZ3MpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGFyZ3MuY2xhc3NlcykuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICBjb25maWcuZGF0YV9jbGFzc2VzW2lkXSA9IGFyZ3MuY2xhc3Nlc1tpZF07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyB1cGRhdGUgY2F0ZWdvcmllcyBpZiBleGlzdHNcbiAgICAgICAgaWYgKCdjYXRlZ29yaWVzJyBpbiBhcmdzICYmICQkLmlzQ2F0ZWdvcml6ZWQoKSkge1xuICAgICAgICAgICAgY29uZmlnLmF4aXNfeF9jYXRlZ29yaWVzID0gYXJncy5jYXRlZ29yaWVzO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSBheGVzIGlmIGV4aXN0c1xuICAgICAgICBpZiAoJ2F4ZXMnIGluIGFyZ3MpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGFyZ3MuYXhlcykuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICBjb25maWcuZGF0YV9heGVzW2lkXSA9IGFyZ3MuYXhlc1tpZF07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyB1cGRhdGUgY29sb3JzIGlmIGV4aXN0c1xuICAgICAgICBpZiAoJ2NvbG9ycycgaW4gYXJncykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoYXJncy5jb2xvcnMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmRhdGFfY29sb3JzW2lkXSA9IGFyZ3MuY29sb3JzW2lkXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVzZSBjYWNoZSBpZiBleGlzdHNcbiAgICAgICAgaWYgKCdjYWNoZUlkcycgaW4gYXJncyAmJiAkJC5oYXNDYWNoZXMoYXJncy5jYWNoZUlkcykpIHtcbiAgICAgICAgICAgICQkLmxvYWQoJCQuZ2V0Q2FjaGVzKGFyZ3MuY2FjaGVJZHMpLCBhcmdzLmRvbmUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVubG9hZCBpZiBuZWVkZWRcbiAgICAgICAgaWYgKCd1bmxvYWQnIGluIGFyZ3MpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IGRvIG5vdCB1bmxvYWQgaWYgdGFyZ2V0IHdpbGwgbG9hZCAoaW5jbHVkZWQgaW4gdXJsL3Jvd3MvY29sdW1ucylcbiAgICAgICAgICAgICQkLnVubG9hZCgkJC5tYXBUb1RhcmdldElkcyh0eXBlb2YgYXJncy51bmxvYWQgPT09ICdib29sZWFuJyAmJiBhcmdzLnVubG9hZCA/IG51bGwgOiBhcmdzLnVubG9hZCksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkJC5sb2FkRnJvbUFyZ3MoYXJncyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQkLmxvYWRGcm9tQXJncyhhcmdzKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi51bmxvYWQgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsO1xuICAgICAgICBhcmdzID0gYXJncyB8fCB7fTtcbiAgICAgICAgaWYgKGFyZ3MgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgYXJncyA9IHsgaWRzOiBhcmdzIH07XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyZ3MgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBhcmdzID0geyBpZHM6IFthcmdzXSB9O1xuICAgICAgICB9XG4gICAgICAgICQkLnVubG9hZCgkJC5tYXBUb1RhcmdldElkcyhhcmdzLmlkcyksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQkLnJlZHJhdyh7IHdpdGhVcGRhdGVPcmdYRG9tYWluOiB0cnVlLCB3aXRoVXBkYXRlWERvbWFpbjogdHJ1ZSwgd2l0aExlZ2VuZDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIGlmIChhcmdzLmRvbmUpIHtcbiAgICAgICAgICAgICAgICBhcmdzLmRvbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ZuLmZsb3cgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgdGFyZ2V0cyxcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBub3Rmb3VuZElkcyA9IFtdLFxuICAgICAgICAgICAgb3JnRGF0YUNvdW50ID0gJCQuZ2V0TWF4RGF0YUNvdW50KCksXG4gICAgICAgICAgICBkYXRhQ291bnQsXG4gICAgICAgICAgICBkb21haW4sXG4gICAgICAgICAgICBiYXNlVGFyZ2V0LFxuICAgICAgICAgICAgYmFzZVZhbHVlLFxuICAgICAgICAgICAgbGVuZ3RoID0gMCxcbiAgICAgICAgICAgIHRhaWwgPSAwLFxuICAgICAgICAgICAgZGlmZixcbiAgICAgICAgICAgIHRvO1xuXG4gICAgICAgIGlmIChhcmdzLmpzb24pIHtcbiAgICAgICAgICAgIGRhdGEgPSAkJC5jb252ZXJ0SnNvblRvRGF0YShhcmdzLmpzb24sIGFyZ3Mua2V5cyk7XG4gICAgICAgIH0gZWxzZSBpZiAoYXJncy5yb3dzKSB7XG4gICAgICAgICAgICBkYXRhID0gJCQuY29udmVydFJvd3NUb0RhdGEoYXJncy5yb3dzKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzLmNvbHVtbnMpIHtcbiAgICAgICAgICAgIGRhdGEgPSAkJC5jb252ZXJ0Q29sdW1uc1RvRGF0YShhcmdzLmNvbHVtbnMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldHMgPSAkJC5jb252ZXJ0RGF0YVRvVGFyZ2V0cyhkYXRhLCB0cnVlKTtcblxuICAgICAgICAvLyBVcGRhdGUvQWRkIGRhdGFcbiAgICAgICAgJCQuZGF0YS50YXJnZXRzLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlLFxuICAgICAgICAgICAgICAgIGksXG4gICAgICAgICAgICAgICAgajtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHQuaWQgPT09IHRhcmdldHNbaV0uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0LnZhbHVlc1t0LnZhbHVlcy5sZW5ndGggLSAxXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFpbCA9IHQudmFsdWVzW3QudmFsdWVzLmxlbmd0aCAtIDFdLmluZGV4ICsgMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSB0YXJnZXRzW2ldLnZhbHVlcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRzW2ldLnZhbHVlc1tqXS5pbmRleCA9IHRhaWwgKyBqO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkJC5pc1RpbWVTZXJpZXMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldHNbaV0udmFsdWVzW2pdLnggPSB0YWlsICsgajtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0LnZhbHVlcyA9IHQudmFsdWVzLmNvbmNhdCh0YXJnZXRzW2ldLnZhbHVlcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0cy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgICAgICBub3Rmb3VuZElkcy5wdXNoKHQuaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBcHBlbmQgbnVsbCBmb3Igbm90IGZvdW5kIHRhcmdldHNcbiAgICAgICAgJCQuZGF0YS50YXJnZXRzLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHZhciBpLCBqO1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG5vdGZvdW5kSWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHQuaWQgPT09IG5vdGZvdW5kSWRzW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhaWwgPSB0LnZhbHVlc1t0LnZhbHVlcy5sZW5ndGggLSAxXS5pbmRleCArIDE7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBsZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC52YWx1ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHRhaWwgKyBqLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6ICQkLmlzVGltZVNlcmllcygpID8gJCQuZ2V0T3RoZXJUYXJnZXRYKHRhaWwgKyBqKSA6IHRhaWwgKyBqLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBudWxsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgbnVsbCB2YWx1ZXMgZm9yIG5ldyB0YXJnZXRcbiAgICAgICAgaWYgKCQkLmRhdGEudGFyZ2V0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRhcmdldHMuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgIHZhciBpLFxuICAgICAgICAgICAgICAgICAgICBtaXNzaW5nID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChpID0gJCQuZGF0YS50YXJnZXRzWzBdLnZhbHVlc1swXS5pbmRleDsgaSA8IHRhaWw7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBtaXNzaW5nLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6ICQkLmlzVGltZVNlcmllcygpID8gJCQuZ2V0T3RoZXJUYXJnZXRYKGkpIDogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0LnZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIHYuaW5kZXggKz0gdGFpbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkJC5pc1RpbWVTZXJpZXMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdi54ICs9IHRhaWw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0LnZhbHVlcyA9IG1pc3NpbmcuY29uY2F0KHQudmFsdWVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgICQkLmRhdGEudGFyZ2V0cyA9ICQkLmRhdGEudGFyZ2V0cy5jb25jYXQodGFyZ2V0cyk7IC8vIGFkZCByZW1haW5lZFxuXG4gICAgICAgIC8vIGNoZWNrIGRhdGEgY291bnQgYmVjYXVzZSBiZWhhdmlvciBuZWVkcyB0byBjaGFuZ2Ugd2hlbiBpdCdzIG9ubHkgb25lXG4gICAgICAgIGRhdGFDb3VudCA9ICQkLmdldE1heERhdGFDb3VudCgpO1xuICAgICAgICBiYXNlVGFyZ2V0ID0gJCQuZGF0YS50YXJnZXRzWzBdO1xuICAgICAgICBiYXNlVmFsdWUgPSBiYXNlVGFyZ2V0LnZhbHVlc1swXTtcblxuICAgICAgICAvLyBVcGRhdGUgbGVuZ3RoIHRvIGZsb3cgaWYgbmVlZGVkXG4gICAgICAgIGlmIChpc0RlZmluZWQoYXJncy50bykpIHtcbiAgICAgICAgICAgIGxlbmd0aCA9IDA7XG4gICAgICAgICAgICB0byA9ICQkLmlzVGltZVNlcmllcygpID8gJCQucGFyc2VEYXRlKGFyZ3MudG8pIDogYXJncy50bztcbiAgICAgICAgICAgIGJhc2VUYXJnZXQudmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICBpZiAodi54IDwgdG8pIHtcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNEZWZpbmVkKGFyZ3MubGVuZ3RoKSkge1xuICAgICAgICAgICAgbGVuZ3RoID0gYXJncy5sZW5ndGg7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBvbmx5IG9uZSBkYXRhLCB1cGRhdGUgdGhlIGRvbWFpbiB0byBmbG93IGZyb20gbGVmdCBlZGdlIG9mIHRoZSBjaGFydFxuICAgICAgICBpZiAoIW9yZ0RhdGFDb3VudCkge1xuICAgICAgICAgICAgaWYgKCQkLmlzVGltZVNlcmllcygpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGJhc2VUYXJnZXQudmFsdWVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IGJhc2VUYXJnZXQudmFsdWVzW2Jhc2VUYXJnZXQudmFsdWVzLmxlbmd0aCAtIDFdLnggLSBiYXNlVmFsdWUueDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWZmID0gYmFzZVZhbHVlLnggLSAkJC5nZXRYRG9tYWluKCQkLmRhdGEudGFyZ2V0cylbMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkaWZmID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRvbWFpbiA9IFtiYXNlVmFsdWUueCAtIGRpZmYsIGJhc2VWYWx1ZS54XTtcbiAgICAgICAgICAgICQkLnVwZGF0ZVhEb21haW4obnVsbCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIGRvbWFpbik7XG4gICAgICAgIH0gZWxzZSBpZiAob3JnRGF0YUNvdW50ID09PSAxKSB7XG4gICAgICAgICAgICBpZiAoJCQuaXNUaW1lU2VyaWVzKCkpIHtcbiAgICAgICAgICAgICAgICBkaWZmID0gKGJhc2VUYXJnZXQudmFsdWVzW2Jhc2VUYXJnZXQudmFsdWVzLmxlbmd0aCAtIDFdLnggLSBiYXNlVmFsdWUueCkgLyAyO1xuICAgICAgICAgICAgICAgIGRvbWFpbiA9IFtuZXcgRGF0ZSgrYmFzZVZhbHVlLnggLSBkaWZmKSwgbmV3IERhdGUoK2Jhc2VWYWx1ZS54ICsgZGlmZildO1xuICAgICAgICAgICAgICAgICQkLnVwZGF0ZVhEb21haW4obnVsbCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIGRvbWFpbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdGFyZ2V0c1xuICAgICAgICAkJC51cGRhdGVUYXJnZXRzKCQkLmRhdGEudGFyZ2V0cyk7XG5cbiAgICAgICAgLy8gUmVkcmF3IHdpdGggbmV3IHRhcmdldHNcbiAgICAgICAgJCQucmVkcmF3KHtcbiAgICAgICAgICAgIGZsb3c6IHtcbiAgICAgICAgICAgICAgICBpbmRleDogYmFzZVZhbHVlLmluZGV4LFxuICAgICAgICAgICAgICAgIGxlbmd0aDogbGVuZ3RoLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBpc1ZhbHVlKGFyZ3MuZHVyYXRpb24pID8gYXJncy5kdXJhdGlvbiA6ICQkLmNvbmZpZy50cmFuc2l0aW9uX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGRvbmU6IGFyZ3MuZG9uZSxcbiAgICAgICAgICAgICAgICBvcmdEYXRhQ291bnQ6IG9yZ0RhdGFDb3VudFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdpdGhMZWdlbmQ6IHRydWUsXG4gICAgICAgICAgICB3aXRoVHJhbnNpdGlvbjogb3JnRGF0YUNvdW50ID4gMSxcbiAgICAgICAgICAgIHdpdGhUcmltWERvbWFpbjogZmFsc2UsXG4gICAgICAgICAgICB3aXRoVXBkYXRlWEF4aXM6IHRydWVcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmdlbmVyYXRlRmxvdyA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWcsXG4gICAgICAgICAgICBkMyA9ICQkLmQzO1xuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0cyA9IGFyZ3MudGFyZ2V0cyxcbiAgICAgICAgICAgICAgICBmbG93ID0gYXJncy5mbG93LFxuICAgICAgICAgICAgICAgIGRyYXdCYXIgPSBhcmdzLmRyYXdCYXIsXG4gICAgICAgICAgICAgICAgZHJhd0xpbmUgPSBhcmdzLmRyYXdMaW5lLFxuICAgICAgICAgICAgICAgIGRyYXdBcmVhID0gYXJncy5kcmF3QXJlYSxcbiAgICAgICAgICAgICAgICBjeCA9IGFyZ3MuY3gsXG4gICAgICAgICAgICAgICAgY3kgPSBhcmdzLmN5LFxuICAgICAgICAgICAgICAgIHh2ID0gYXJncy54dixcbiAgICAgICAgICAgICAgICB4Rm9yVGV4dCA9IGFyZ3MueEZvclRleHQsXG4gICAgICAgICAgICAgICAgeUZvclRleHQgPSBhcmdzLnlGb3JUZXh0LFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gYXJncy5kdXJhdGlvbjtcblxuICAgICAgICAgICAgdmFyIHRyYW5zbGF0ZVgsXG4gICAgICAgICAgICAgICAgc2NhbGVYID0gMSxcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm0sXG4gICAgICAgICAgICAgICAgZmxvd0luZGV4ID0gZmxvdy5pbmRleCxcbiAgICAgICAgICAgICAgICBmbG93TGVuZ3RoID0gZmxvdy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgZmxvd1N0YXJ0ID0gJCQuZ2V0VmFsdWVPbkluZGV4KCQkLmRhdGEudGFyZ2V0c1swXS52YWx1ZXMsIGZsb3dJbmRleCksXG4gICAgICAgICAgICAgICAgZmxvd0VuZCA9ICQkLmdldFZhbHVlT25JbmRleCgkJC5kYXRhLnRhcmdldHNbMF0udmFsdWVzLCBmbG93SW5kZXggKyBmbG93TGVuZ3RoKSxcbiAgICAgICAgICAgICAgICBvcmdEb21haW4gPSAkJC54LmRvbWFpbigpLFxuICAgICAgICAgICAgICAgIGRvbWFpbixcbiAgICAgICAgICAgICAgICBkdXJhdGlvbkZvckZsb3cgPSBmbG93LmR1cmF0aW9uIHx8IGR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGRvbmUgPSBmbG93LmRvbmUgfHwgZnVuY3Rpb24gKCkge30sXG4gICAgICAgICAgICAgICAgd2FpdCA9ICQkLmdlbmVyYXRlV2FpdCgpO1xuXG4gICAgICAgICAgICB2YXIgeGdyaWQgPSAkJC54Z3JpZCB8fCBkMy5zZWxlY3RBbGwoW10pLFxuICAgICAgICAgICAgICAgIHhncmlkTGluZXMgPSAkJC54Z3JpZExpbmVzIHx8IGQzLnNlbGVjdEFsbChbXSksXG4gICAgICAgICAgICAgICAgbWFpblJlZ2lvbiA9ICQkLm1haW5SZWdpb24gfHwgZDMuc2VsZWN0QWxsKFtdKSxcbiAgICAgICAgICAgICAgICBtYWluVGV4dCA9ICQkLm1haW5UZXh0IHx8IGQzLnNlbGVjdEFsbChbXSksXG4gICAgICAgICAgICAgICAgbWFpbkJhciA9ICQkLm1haW5CYXIgfHwgZDMuc2VsZWN0QWxsKFtdKSxcbiAgICAgICAgICAgICAgICBtYWluTGluZSA9ICQkLm1haW5MaW5lIHx8IGQzLnNlbGVjdEFsbChbXSksXG4gICAgICAgICAgICAgICAgbWFpbkFyZWEgPSAkJC5tYWluQXJlYSB8fCBkMy5zZWxlY3RBbGwoW10pLFxuICAgICAgICAgICAgICAgIG1haW5DaXJjbGUgPSAkJC5tYWluQ2lyY2xlIHx8IGQzLnNlbGVjdEFsbChbXSk7XG5cbiAgICAgICAgICAgIC8vIHNldCBmbGFnXG4gICAgICAgICAgICAkJC5mbG93aW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgLy8gcmVtb3ZlIGhlYWQgZGF0YSBhZnRlciByZW5kZXJlZFxuICAgICAgICAgICAgJCQuZGF0YS50YXJnZXRzLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICBkLnZhbHVlcy5zcGxpY2UoMCwgZmxvd0xlbmd0aCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gdXBkYXRlIHggZG9tYWluIHRvIGdlbmVyYXRlIGF4aXMgZWxlbWVudHMgZm9yIGZsb3dcbiAgICAgICAgICAgIGRvbWFpbiA9ICQkLnVwZGF0ZVhEb21haW4odGFyZ2V0cywgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAvLyB1cGRhdGUgZWxlbWVudHMgcmVsYXRlZCB0byB4IHNjYWxlXG4gICAgICAgICAgICBpZiAoJCQudXBkYXRlWEdyaWQpIHtcbiAgICAgICAgICAgICAgICAkJC51cGRhdGVYR3JpZCh0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZ2VuZXJhdGUgdHJhbnNmb3JtIHRvIGZsb3dcbiAgICAgICAgICAgIGlmICghZmxvdy5vcmdEYXRhQ291bnQpIHtcbiAgICAgICAgICAgICAgICAvLyBpZiBlbXB0eVxuICAgICAgICAgICAgICAgIGlmICgkJC5kYXRhLnRhcmdldHNbMF0udmFsdWVzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGVYID0gJCQueChvcmdEb21haW5bMF0pIC0gJCQueChkb21haW5bMF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkJC5pc1RpbWVTZXJpZXMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd1N0YXJ0ID0gJCQuZ2V0VmFsdWVPbkluZGV4KCQkLmRhdGEudGFyZ2V0c1swXS52YWx1ZXMsIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxvd0VuZCA9ICQkLmdldFZhbHVlT25JbmRleCgkJC5kYXRhLnRhcmdldHNbMF0udmFsdWVzLCAkJC5kYXRhLnRhcmdldHNbMF0udmFsdWVzLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlWCA9ICQkLngoZmxvd1N0YXJ0LngpIC0gJCQueChmbG93RW5kLngpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlWCA9IGRpZmZEb21haW4oZG9tYWluKSAvIDI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZsb3cub3JnRGF0YUNvdW50ID09PSAxIHx8IChmbG93U3RhcnQgJiYgZmxvd1N0YXJ0LngpID09PSAoZmxvd0VuZCAmJiBmbG93RW5kLngpKSB7XG4gICAgICAgICAgICAgICAgdHJhbnNsYXRlWCA9ICQkLngob3JnRG9tYWluWzBdKSAtICQkLngoZG9tYWluWzBdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCQkLmlzVGltZVNlcmllcygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZVggPSAkJC54KG9yZ0RvbWFpblswXSkgLSAkJC54KGRvbWFpblswXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRlWCA9ICQkLngoZmxvd1N0YXJ0LngpIC0gJCQueChmbG93RW5kLngpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNjYWxlWCA9IGRpZmZEb21haW4ob3JnRG9tYWluKSAvIGRpZmZEb21haW4oZG9tYWluKTtcbiAgICAgICAgICAgIHRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoJyArIHRyYW5zbGF0ZVggKyAnLDApIHNjYWxlKCcgKyBzY2FsZVggKyAnLDEpJztcblxuICAgICAgICAgICAgJCQuaGlkZVhHcmlkRm9jdXMoKTtcblxuICAgICAgICAgICAgZDMudHJhbnNpdGlvbigpLmVhc2UoJ2xpbmVhcicpLmR1cmF0aW9uKGR1cmF0aW9uRm9yRmxvdykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgd2FpdC5hZGQoJCQuYXhlcy54LnRyYW5zaXRpb24oKS5jYWxsKCQkLnhBeGlzKSk7XG4gICAgICAgICAgICAgICAgd2FpdC5hZGQobWFpbkJhci50cmFuc2l0aW9uKCkuYXR0cigndHJhbnNmb3JtJywgdHJhbnNmb3JtKSk7XG4gICAgICAgICAgICAgICAgd2FpdC5hZGQobWFpbkxpbmUudHJhbnNpdGlvbigpLmF0dHIoJ3RyYW5zZm9ybScsIHRyYW5zZm9ybSkpO1xuICAgICAgICAgICAgICAgIHdhaXQuYWRkKG1haW5BcmVhLnRyYW5zaXRpb24oKS5hdHRyKCd0cmFuc2Zvcm0nLCB0cmFuc2Zvcm0pKTtcbiAgICAgICAgICAgICAgICB3YWl0LmFkZChtYWluQ2lyY2xlLnRyYW5zaXRpb24oKS5hdHRyKCd0cmFuc2Zvcm0nLCB0cmFuc2Zvcm0pKTtcbiAgICAgICAgICAgICAgICB3YWl0LmFkZChtYWluVGV4dC50cmFuc2l0aW9uKCkuYXR0cigndHJhbnNmb3JtJywgdHJhbnNmb3JtKSk7XG4gICAgICAgICAgICAgICAgd2FpdC5hZGQobWFpblJlZ2lvbi5maWx0ZXIoJCQuaXNSZWdpb25PblgpLnRyYW5zaXRpb24oKS5hdHRyKCd0cmFuc2Zvcm0nLCB0cmFuc2Zvcm0pKTtcbiAgICAgICAgICAgICAgICB3YWl0LmFkZCh4Z3JpZC50cmFuc2l0aW9uKCkuYXR0cigndHJhbnNmb3JtJywgdHJhbnNmb3JtKSk7XG4gICAgICAgICAgICAgICAgd2FpdC5hZGQoeGdyaWRMaW5lcy50cmFuc2l0aW9uKCkuYXR0cigndHJhbnNmb3JtJywgdHJhbnNmb3JtKSk7XG4gICAgICAgICAgICB9KS5jYWxsKHdhaXQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgICAgICAgICAgc2hhcGVzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIHRleHRzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UmVjdHMgPSBbXTtcblxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBmbG93ZWQgZWxlbWVudHNcbiAgICAgICAgICAgICAgICBpZiAoZmxvd0xlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmxvd0xlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaGFwZXMucHVzaCgnLicgKyBDTEFTUy5zaGFwZSArICctJyArIChmbG93SW5kZXggKyBpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0cy5wdXNoKCcuJyArIENMQVNTLnRleHQgKyAnLScgKyAoZmxvd0luZGV4ICsgaSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRSZWN0cy5wdXNoKCcuJyArIENMQVNTLmV2ZW50UmVjdCArICctJyArIChmbG93SW5kZXggKyBpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJCQuc3ZnLnNlbGVjdEFsbCgnLicgKyBDTEFTUy5zaGFwZXMpLnNlbGVjdEFsbChzaGFwZXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAkJC5zdmcuc2VsZWN0QWxsKCcuJyArIENMQVNTLnRleHRzKS5zZWxlY3RBbGwodGV4dHMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAkJC5zdmcuc2VsZWN0QWxsKCcuJyArIENMQVNTLmV2ZW50UmVjdHMpLnNlbGVjdEFsbChldmVudFJlY3RzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgJCQuc3ZnLnNlbGVjdCgnLicgKyBDTEFTUy54Z3JpZCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gZHJhdyBhZ2FpbiBmb3IgcmVtb3ZpbmcgZmxvd2VkIGVsZW1lbnRzIGFuZCByZXZlcnRpbmcgYXR0clxuICAgICAgICAgICAgICAgIHhncmlkLmF0dHIoJ3RyYW5zZm9ybScsIG51bGwpLmF0dHIoJCQueGdyaWRBdHRyKTtcbiAgICAgICAgICAgICAgICB4Z3JpZExpbmVzLmF0dHIoJ3RyYW5zZm9ybScsIG51bGwpO1xuICAgICAgICAgICAgICAgIHhncmlkTGluZXMuc2VsZWN0KCdsaW5lJykuYXR0cihcIngxXCIsIGNvbmZpZy5heGlzX3JvdGF0ZWQgPyAwIDogeHYpLmF0dHIoXCJ4MlwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gJCQud2lkdGggOiB4dik7XG4gICAgICAgICAgICAgICAgeGdyaWRMaW5lcy5zZWxlY3QoJ3RleHQnKS5hdHRyKFwieFwiLCBjb25maWcuYXhpc19yb3RhdGVkID8gJCQud2lkdGggOiAwKS5hdHRyKFwieVwiLCB4dik7XG4gICAgICAgICAgICAgICAgbWFpbkJhci5hdHRyKCd0cmFuc2Zvcm0nLCBudWxsKS5hdHRyKFwiZFwiLCBkcmF3QmFyKTtcbiAgICAgICAgICAgICAgICBtYWluTGluZS5hdHRyKCd0cmFuc2Zvcm0nLCBudWxsKS5hdHRyKFwiZFwiLCBkcmF3TGluZSk7XG4gICAgICAgICAgICAgICAgbWFpbkFyZWEuYXR0cigndHJhbnNmb3JtJywgbnVsbCkuYXR0cihcImRcIiwgZHJhd0FyZWEpO1xuICAgICAgICAgICAgICAgIG1haW5DaXJjbGUuYXR0cigndHJhbnNmb3JtJywgbnVsbCkuYXR0cihcImN4XCIsIGN4KS5hdHRyKFwiY3lcIiwgY3kpO1xuICAgICAgICAgICAgICAgIG1haW5UZXh0LmF0dHIoJ3RyYW5zZm9ybScsIG51bGwpLmF0dHIoJ3gnLCB4Rm9yVGV4dCkuYXR0cigneScsIHlGb3JUZXh0KS5zdHlsZSgnZmlsbC1vcGFjaXR5JywgJCQub3BhY2l0eUZvclRleHQuYmluZCgkJCkpO1xuICAgICAgICAgICAgICAgIG1haW5SZWdpb24uYXR0cigndHJhbnNmb3JtJywgbnVsbCk7XG4gICAgICAgICAgICAgICAgbWFpblJlZ2lvbi5zZWxlY3QoJ3JlY3QnKS5maWx0ZXIoJCQuaXNSZWdpb25PblgpLmF0dHIoXCJ4XCIsICQkLnJlZ2lvblguYmluZCgkJCkpLmF0dHIoXCJ3aWR0aFwiLCAkJC5yZWdpb25XaWR0aC5iaW5kKCQkKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmludGVyYWN0aW9uX2VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJCQucmVkcmF3RXZlbnRSZWN0KCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gY2FsbGJhY2sgZm9yIGVuZCBvZiBmbG93XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuXG4gICAgICAgICAgICAgICAgJCQuZmxvd2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ZuLnNlbGVjdGVkID0gZnVuY3Rpb24gKHRhcmdldElkKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBkMyA9ICQkLmQzO1xuICAgICAgICByZXR1cm4gZDMubWVyZ2UoJCQubWFpbi5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2hhcGVzICsgJCQuZ2V0VGFyZ2V0U2VsZWN0b3JTdWZmaXgodGFyZ2V0SWQpKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2hhcGUpLmZpbHRlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZDMuc2VsZWN0KHRoaXMpLmNsYXNzZWQoQ0xBU1MuU0VMRUNURUQpO1xuICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBkLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gZC5fX2RhdGFfXztyZXR1cm4gZGF0YS5kYXRhID8gZGF0YS5kYXRhIDogZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9mbi5zZWxlY3QgPSBmdW5jdGlvbiAoaWRzLCBpbmRpY2VzLCByZXNldE90aGVyKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBkMyA9ICQkLmQzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICBpZiAoIWNvbmZpZy5kYXRhX3NlbGVjdGlvbl9lbmFibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgJCQubWFpbi5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2hhcGVzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2hhcGUpLmVhY2goZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIHZhciBzaGFwZSA9IGQzLnNlbGVjdCh0aGlzKSxcbiAgICAgICAgICAgICAgICBpZCA9IGQuZGF0YSA/IGQuZGF0YS5pZCA6IGQuaWQsXG4gICAgICAgICAgICAgICAgdG9nZ2xlID0gJCQuZ2V0VG9nZ2xlKHRoaXMsIGQpLmJpbmQoJCQpLFxuICAgICAgICAgICAgICAgIGlzVGFyZ2V0SWQgPSBjb25maWcuZGF0YV9zZWxlY3Rpb25fZ3JvdXBlZCB8fCAhaWRzIHx8IGlkcy5pbmRleE9mKGlkKSA+PSAwLFxuICAgICAgICAgICAgICAgIGlzVGFyZ2V0SW5kZXggPSAhaW5kaWNlcyB8fCBpbmRpY2VzLmluZGV4T2YoaSkgPj0gMCxcbiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkID0gc2hhcGUuY2xhc3NlZChDTEFTUy5TRUxFQ1RFRCk7XG4gICAgICAgICAgICAvLyBsaW5lL2FyZWEgc2VsZWN0aW9uIG5vdCBzdXBwb3J0ZWQgeWV0XG4gICAgICAgICAgICBpZiAoc2hhcGUuY2xhc3NlZChDTEFTUy5saW5lKSB8fCBzaGFwZS5jbGFzc2VkKENMQVNTLmFyZWEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzVGFyZ2V0SWQgJiYgaXNUYXJnZXRJbmRleCkge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWcuZGF0YV9zZWxlY3Rpb25faXNzZWxlY3RhYmxlKGQpICYmICFpc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZSh0cnVlLCBzaGFwZS5jbGFzc2VkKENMQVNTLlNFTEVDVEVELCB0cnVlKSwgZCwgaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChpc0RlZmluZWQocmVzZXRPdGhlcikgJiYgcmVzZXRPdGhlcikge1xuICAgICAgICAgICAgICAgIGlmIChpc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZShmYWxzZSwgc2hhcGUuY2xhc3NlZChDTEFTUy5TRUxFQ1RFRCwgZmFsc2UpLCBkLCBpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4udW5zZWxlY3QgPSBmdW5jdGlvbiAoaWRzLCBpbmRpY2VzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBkMyA9ICQkLmQzLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICBpZiAoIWNvbmZpZy5kYXRhX3NlbGVjdGlvbl9lbmFibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgJCQubWFpbi5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2hhcGVzKS5zZWxlY3RBbGwoJy4nICsgQ0xBU1Muc2hhcGUpLmVhY2goZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIHZhciBzaGFwZSA9IGQzLnNlbGVjdCh0aGlzKSxcbiAgICAgICAgICAgICAgICBpZCA9IGQuZGF0YSA/IGQuZGF0YS5pZCA6IGQuaWQsXG4gICAgICAgICAgICAgICAgdG9nZ2xlID0gJCQuZ2V0VG9nZ2xlKHRoaXMsIGQpLmJpbmQoJCQpLFxuICAgICAgICAgICAgICAgIGlzVGFyZ2V0SWQgPSBjb25maWcuZGF0YV9zZWxlY3Rpb25fZ3JvdXBlZCB8fCAhaWRzIHx8IGlkcy5pbmRleE9mKGlkKSA+PSAwLFxuICAgICAgICAgICAgICAgIGlzVGFyZ2V0SW5kZXggPSAhaW5kaWNlcyB8fCBpbmRpY2VzLmluZGV4T2YoaSkgPj0gMCxcbiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkID0gc2hhcGUuY2xhc3NlZChDTEFTUy5TRUxFQ1RFRCk7XG4gICAgICAgICAgICAvLyBsaW5lL2FyZWEgc2VsZWN0aW9uIG5vdCBzdXBwb3J0ZWQgeWV0XG4gICAgICAgICAgICBpZiAoc2hhcGUuY2xhc3NlZChDTEFTUy5saW5lKSB8fCBzaGFwZS5jbGFzc2VkKENMQVNTLmFyZWEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzVGFyZ2V0SWQgJiYgaXNUYXJnZXRJbmRleCkge1xuICAgICAgICAgICAgICAgIGlmIChjb25maWcuZGF0YV9zZWxlY3Rpb25faXNzZWxlY3RhYmxlKGQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGUoZmFsc2UsIHNoYXBlLmNsYXNzZWQoQ0xBU1MuU0VMRUNURUQsIGZhbHNlKSwgZCwgaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi50cmFuc2Zvcm0gPSBmdW5jdGlvbiAodHlwZSwgdGFyZ2V0SWRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBvcHRpb25zID0gWydwaWUnLCAnZG9udXQnXS5pbmRleE9mKHR5cGUpID49IDAgPyB7IHdpdGhUcmFuc2Zvcm06IHRydWUgfSA6IG51bGw7XG4gICAgICAgICQkLnRyYW5zZm9ybVRvKHRhcmdldElkcywgdHlwZSwgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLnRyYW5zZm9ybVRvID0gZnVuY3Rpb24gKHRhcmdldElkcywgdHlwZSwgb3B0aW9uc0ZvclJlZHJhdykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLFxuICAgICAgICAgICAgd2l0aFRyYW5zaXRpb25Gb3JBeGlzID0gISQkLmhhc0FyY1R5cGUoKSxcbiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zRm9yUmVkcmF3IHx8IHsgd2l0aFRyYW5zaXRpb25Gb3JBeGlzOiB3aXRoVHJhbnNpdGlvbkZvckF4aXMgfTtcbiAgICAgICAgb3B0aW9ucy53aXRoVHJhbnNpdGlvbkZvclRyYW5zZm9ybSA9IGZhbHNlO1xuICAgICAgICAkJC50cmFuc2l0aW5nID0gZmFsc2U7XG4gICAgICAgICQkLnNldFRhcmdldFR5cGUodGFyZ2V0SWRzLCB0eXBlKTtcbiAgICAgICAgJCQudXBkYXRlVGFyZ2V0cygkJC5kYXRhLnRhcmdldHMpOyAvLyB0aGlzIGlzIG5lZWRlZCB3aGVuIHRyYW5zZm9ybWluZyB0byBhcmNcbiAgICAgICAgJCQudXBkYXRlQW5kUmVkcmF3KG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi5ncm91cHMgPSBmdW5jdGlvbiAoZ3JvdXBzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIGlmIChpc1VuZGVmaW5lZChncm91cHMpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmRhdGFfZ3JvdXBzO1xuICAgICAgICB9XG4gICAgICAgIGNvbmZpZy5kYXRhX2dyb3VwcyA9IGdyb3VwcztcbiAgICAgICAgJCQucmVkcmF3KCk7XG4gICAgICAgIHJldHVybiBjb25maWcuZGF0YV9ncm91cHM7XG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ZuLnhncmlkcyA9IGZ1bmN0aW9uIChncmlkcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICBpZiAoIWdyaWRzKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmdyaWRfeF9saW5lcztcbiAgICAgICAgfVxuICAgICAgICBjb25maWcuZ3JpZF94X2xpbmVzID0gZ3JpZHM7XG4gICAgICAgICQkLnJlZHJhd1dpdGhvdXRSZXNjYWxlKCk7XG4gICAgICAgIHJldHVybiBjb25maWcuZ3JpZF94X2xpbmVzO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4ueGdyaWRzLmFkZCA9IGZ1bmN0aW9uIChncmlkcykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsO1xuICAgICAgICByZXR1cm4gdGhpcy54Z3JpZHMoJCQuY29uZmlnLmdyaWRfeF9saW5lcy5jb25jYXQoZ3JpZHMgPyBncmlkcyA6IFtdKSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9mbi54Z3JpZHMucmVtb3ZlID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAvLyBUT0RPOiBtdWx0aXBsZVxuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsO1xuICAgICAgICAkJC5yZW1vdmVHcmlkTGluZXMocGFyYW1zLCB0cnVlKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4ueWdyaWRzID0gZnVuY3Rpb24gKGdyaWRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIGlmICghZ3JpZHMpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWcuZ3JpZF95X2xpbmVzO1xuICAgICAgICB9XG4gICAgICAgIGNvbmZpZy5ncmlkX3lfbGluZXMgPSBncmlkcztcbiAgICAgICAgJCQucmVkcmF3V2l0aG91dFJlc2NhbGUoKTtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5ncmlkX3lfbGluZXM7XG4gICAgfTtcbiAgICBjM19jaGFydF9mbi55Z3JpZHMuYWRkID0gZnVuY3Rpb24gKGdyaWRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWw7XG4gICAgICAgIHJldHVybiB0aGlzLnlncmlkcygkJC5jb25maWcuZ3JpZF95X2xpbmVzLmNvbmNhdChncmlkcyA/IGdyaWRzIDogW10pKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ZuLnlncmlkcy5yZW1vdmUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIC8vIFRPRE86IG11bHRpcGxlXG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWw7XG4gICAgICAgICQkLnJlbW92ZUdyaWRMaW5lcyhwYXJhbXMsIGZhbHNlKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4ucmVnaW9ucyA9IGZ1bmN0aW9uIChyZWdpb25zKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBjb25maWcgPSAkJC5jb25maWc7XG4gICAgICAgIGlmICghcmVnaW9ucykge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5yZWdpb25zO1xuICAgICAgICB9XG4gICAgICAgIGNvbmZpZy5yZWdpb25zID0gcmVnaW9ucztcbiAgICAgICAgJCQucmVkcmF3V2l0aG91dFJlc2NhbGUoKTtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5yZWdpb25zO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4ucmVnaW9ucy5hZGQgPSBmdW5jdGlvbiAocmVnaW9ucykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICBpZiAoIXJlZ2lvbnMpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWcucmVnaW9ucztcbiAgICAgICAgfVxuICAgICAgICBjb25maWcucmVnaW9ucyA9IGNvbmZpZy5yZWdpb25zLmNvbmNhdChyZWdpb25zKTtcbiAgICAgICAgJCQucmVkcmF3V2l0aG91dFJlc2NhbGUoKTtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5yZWdpb25zO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4ucmVnaW9ucy5yZW1vdmUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnLFxuICAgICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgICBjbGFzc2VzLFxuICAgICAgICAgICAgcmVnaW9ucztcblxuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgZHVyYXRpb24gPSAkJC5nZXRPcHRpb24ob3B0aW9ucywgXCJkdXJhdGlvblwiLCBjb25maWcudHJhbnNpdGlvbl9kdXJhdGlvbik7XG4gICAgICAgIGNsYXNzZXMgPSAkJC5nZXRPcHRpb24ob3B0aW9ucywgXCJjbGFzc2VzXCIsIFtDTEFTUy5yZWdpb25dKTtcblxuICAgICAgICByZWdpb25zID0gJCQubWFpbi5zZWxlY3QoJy4nICsgQ0xBU1MucmVnaW9ucykuc2VsZWN0QWxsKGNsYXNzZXMubWFwKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gJy4nICsgYztcbiAgICAgICAgfSkpO1xuICAgICAgICAoZHVyYXRpb24gPyByZWdpb25zLnRyYW5zaXRpb24oKS5kdXJhdGlvbihkdXJhdGlvbikgOiByZWdpb25zKS5zdHlsZSgnb3BhY2l0eScsIDApLnJlbW92ZSgpO1xuXG4gICAgICAgIGNvbmZpZy5yZWdpb25zID0gY29uZmlnLnJlZ2lvbnMuZmlsdGVyKGZ1bmN0aW9uIChyZWdpb24pIHtcbiAgICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKCFyZWdpb25bJ2NsYXNzJ10pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZ2lvblsnY2xhc3MnXS5zcGxpdCgnICcpLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2xhc3Nlcy5pbmRleE9mKGMpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuICFmb3VuZDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGNvbmZpZy5yZWdpb25zO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi5kYXRhID0gZnVuY3Rpb24gKHRhcmdldElkcykge1xuICAgICAgICB2YXIgdGFyZ2V0cyA9IHRoaXMuaW50ZXJuYWwuZGF0YS50YXJnZXRzO1xuICAgICAgICByZXR1cm4gdHlwZW9mIHRhcmdldElkcyA9PT0gJ3VuZGVmaW5lZCcgPyB0YXJnZXRzIDogdGFyZ2V0cy5maWx0ZXIoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBbXS5jb25jYXQodGFyZ2V0SWRzKS5pbmRleE9mKHQuaWQpID49IDA7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4uZGF0YS5zaG93biA9IGZ1bmN0aW9uICh0YXJnZXRJZHMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWwuZmlsdGVyVGFyZ2V0c1RvU2hvdyh0aGlzLmRhdGEodGFyZ2V0SWRzKSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9mbi5kYXRhLnZhbHVlcyA9IGZ1bmN0aW9uICh0YXJnZXRJZCkge1xuICAgICAgICB2YXIgdGFyZ2V0cyxcbiAgICAgICAgICAgIHZhbHVlcyA9IG51bGw7XG4gICAgICAgIGlmICh0YXJnZXRJZCkge1xuICAgICAgICAgICAgdGFyZ2V0cyA9IHRoaXMuZGF0YSh0YXJnZXRJZCk7XG4gICAgICAgICAgICB2YWx1ZXMgPSB0YXJnZXRzWzBdID8gdGFyZ2V0c1swXS52YWx1ZXMubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQudmFsdWU7XG4gICAgICAgICAgICB9KSA6IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ZuLmRhdGEubmFtZXMgPSBmdW5jdGlvbiAobmFtZXMpIHtcbiAgICAgICAgdGhpcy5pbnRlcm5hbC5jbGVhckxlZ2VuZEl0ZW1UZXh0Qm94Q2FjaGUoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWwudXBkYXRlRGF0YUF0dHJpYnV0ZXMoJ25hbWVzJywgbmFtZXMpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4uZGF0YS5jb2xvcnMgPSBmdW5jdGlvbiAoY29sb3JzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmludGVybmFsLnVwZGF0ZURhdGFBdHRyaWJ1dGVzKCdjb2xvcnMnLCBjb2xvcnMpO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4uZGF0YS5heGVzID0gZnVuY3Rpb24gKGF4ZXMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWwudXBkYXRlRGF0YUF0dHJpYnV0ZXMoJ2F4ZXMnLCBheGVzKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4uY2F0ZWdvcnkgPSBmdW5jdGlvbiAoaSwgY2F0ZWdvcnkpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbCxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBjb25maWcuYXhpc194X2NhdGVnb3JpZXNbaV0gPSBjYXRlZ29yeTtcbiAgICAgICAgICAgICQkLnJlZHJhdygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25maWcuYXhpc194X2NhdGVnb3JpZXNbaV07XG4gICAgfTtcbiAgICBjM19jaGFydF9mbi5jYXRlZ29yaWVzID0gZnVuY3Rpb24gKGNhdGVnb3JpZXMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbCxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnLmF4aXNfeF9jYXRlZ29yaWVzO1xuICAgICAgICB9XG4gICAgICAgIGNvbmZpZy5heGlzX3hfY2F0ZWdvcmllcyA9IGNhdGVnb3JpZXM7XG4gICAgICAgICQkLnJlZHJhdygpO1xuICAgICAgICByZXR1cm4gY29uZmlnLmF4aXNfeF9jYXRlZ29yaWVzO1xuICAgIH07XG5cbiAgICAvLyBUT0RPOiBmaXhcbiAgICBjM19jaGFydF9mbi5jb2xvciA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsO1xuICAgICAgICByZXR1cm4gJCQuY29sb3IoaWQpOyAvLyBtb3JlIHBhdHRlcm5zXG4gICAgfTtcblxuICAgIGMzX2NoYXJ0X2ZuLnggPSBmdW5jdGlvbiAoeCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsO1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgJCQudXBkYXRlVGFyZ2V0WCgkJC5kYXRhLnRhcmdldHMsIHgpO1xuICAgICAgICAgICAgJCQucmVkcmF3KHsgd2l0aFVwZGF0ZU9yZ1hEb21haW46IHRydWUsIHdpdGhVcGRhdGVYRG9tYWluOiB0cnVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkJC5kYXRhLnhzO1xuICAgIH07XG4gICAgYzNfY2hhcnRfZm4ueHMgPSBmdW5jdGlvbiAoeHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbDtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICQkLnVwZGF0ZVRhcmdldFhzKCQkLmRhdGEudGFyZ2V0cywgeHMpO1xuICAgICAgICAgICAgJCQucmVkcmF3KHsgd2l0aFVwZGF0ZU9yZ1hEb21haW46IHRydWUsIHdpdGhVcGRhdGVYRG9tYWluOiB0cnVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkJC5kYXRhLnhzO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi5heGlzID0gZnVuY3Rpb24gKCkge307XG4gICAgYzNfY2hhcnRfZm4uYXhpcy5sYWJlbHMgPSBmdW5jdGlvbiAobGFiZWxzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWw7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhsYWJlbHMpLmZvckVhY2goZnVuY3Rpb24gKGF4aXNJZCkge1xuICAgICAgICAgICAgICAgICQkLmF4aXMuc2V0TGFiZWxUZXh0KGF4aXNJZCwgbGFiZWxzW2F4aXNJZF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkJC5heGlzLnVwZGF0ZUxhYmVscygpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRPRE86IHJldHVybiBzb21lIHZhbHVlcz9cbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ZuLmF4aXMubWF4ID0gZnVuY3Rpb24gKG1heCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKCh0eXBlb2YgbWF4ID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihtYXgpKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNWYWx1ZShtYXgueCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmF4aXNfeF9tYXggPSBtYXgueDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlzVmFsdWUobWF4LnkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5heGlzX3lfbWF4ID0gbWF4Lnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpc1ZhbHVlKG1heC55MikpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmF4aXNfeTJfbWF4ID0gbWF4LnkyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmF4aXNfeV9tYXggPSBjb25maWcuYXhpc195Ml9tYXggPSBtYXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkJC5yZWRyYXcoeyB3aXRoVXBkYXRlT3JnWERvbWFpbjogdHJ1ZSwgd2l0aFVwZGF0ZVhEb21haW46IHRydWUgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHg6IGNvbmZpZy5heGlzX3hfbWF4LFxuICAgICAgICAgICAgICAgIHk6IGNvbmZpZy5heGlzX3lfbWF4LFxuICAgICAgICAgICAgICAgIHkyOiBjb25maWcuYXhpc195Ml9tYXhcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ZuLmF4aXMubWluID0gZnVuY3Rpb24gKG1pbikge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsLFxuICAgICAgICAgICAgY29uZmlnID0gJCQuY29uZmlnO1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKCh0eXBlb2YgbWluID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihtaW4pKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNWYWx1ZShtaW4ueCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmF4aXNfeF9taW4gPSBtaW4ueDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlzVmFsdWUobWluLnkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5heGlzX3lfbWluID0gbWluLnk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpc1ZhbHVlKG1pbi55MikpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmF4aXNfeTJfbWluID0gbWluLnkyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmF4aXNfeV9taW4gPSBjb25maWcuYXhpc195Ml9taW4gPSBtaW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkJC5yZWRyYXcoeyB3aXRoVXBkYXRlT3JnWERvbWFpbjogdHJ1ZSwgd2l0aFVwZGF0ZVhEb21haW46IHRydWUgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHg6IGNvbmZpZy5heGlzX3hfbWluLFxuICAgICAgICAgICAgICAgIHk6IGNvbmZpZy5heGlzX3lfbWluLFxuICAgICAgICAgICAgICAgIHkyOiBjb25maWcuYXhpc195Ml9taW5cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ZuLmF4aXMucmFuZ2UgPSBmdW5jdGlvbiAocmFuZ2UpIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChpc0RlZmluZWQocmFuZ2UubWF4KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXhpcy5tYXgocmFuZ2UubWF4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0RlZmluZWQocmFuZ2UubWluKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXhpcy5taW4ocmFuZ2UubWluKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbWF4OiB0aGlzLmF4aXMubWF4KCksXG4gICAgICAgICAgICAgICAgbWluOiB0aGlzLmF4aXMubWluKClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4ubGVnZW5kID0gZnVuY3Rpb24gKCkge307XG4gICAgYzNfY2hhcnRfZm4ubGVnZW5kLnNob3cgPSBmdW5jdGlvbiAodGFyZ2V0SWRzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWw7XG4gICAgICAgICQkLnNob3dMZWdlbmQoJCQubWFwVG9UYXJnZXRJZHModGFyZ2V0SWRzKSk7XG4gICAgICAgICQkLnVwZGF0ZUFuZFJlZHJhdyh7IHdpdGhMZWdlbmQ6IHRydWUgfSk7XG4gICAgfTtcbiAgICBjM19jaGFydF9mbi5sZWdlbmQuaGlkZSA9IGZ1bmN0aW9uICh0YXJnZXRJZHMpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbDtcbiAgICAgICAgJCQuaGlkZUxlZ2VuZCgkJC5tYXBUb1RhcmdldElkcyh0YXJnZXRJZHMpKTtcbiAgICAgICAgJCQudXBkYXRlQW5kUmVkcmF3KHsgd2l0aExlZ2VuZDogdHJ1ZSB9KTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4ucmVzaXplID0gZnVuY3Rpb24gKHNpemUpIHtcbiAgICAgICAgdmFyICQkID0gdGhpcy5pbnRlcm5hbCxcbiAgICAgICAgICAgIGNvbmZpZyA9ICQkLmNvbmZpZztcbiAgICAgICAgY29uZmlnLnNpemVfd2lkdGggPSBzaXplID8gc2l6ZS53aWR0aCA6IG51bGw7XG4gICAgICAgIGNvbmZpZy5zaXplX2hlaWdodCA9IHNpemUgPyBzaXplLmhlaWdodCA6IG51bGw7XG4gICAgICAgIHRoaXMuZmx1c2goKTtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4uZmx1c2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWw7XG4gICAgICAgICQkLnVwZGF0ZUFuZFJlZHJhdyh7IHdpdGhMZWdlbmQ6IHRydWUsIHdpdGhUcmFuc2l0aW9uOiBmYWxzZSwgd2l0aFRyYW5zaXRpb25Gb3JUcmFuc2Zvcm06IGZhbHNlIH0pO1xuICAgIH07XG5cbiAgICBjM19jaGFydF9mbi5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJCQgPSB0aGlzLmludGVybmFsO1xuXG4gICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKCQkLmludGVydmFsRm9yT2JzZXJ2ZUluc2VydGVkKTtcblxuICAgICAgICBpZiAoJCQucmVzaXplVGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KCQkLnJlc2l6ZVRpbWVvdXQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdpbmRvdy5kZXRhY2hFdmVudCkge1xuICAgICAgICAgICAgd2luZG93LmRldGFjaEV2ZW50KCdvbnJlc2l6ZScsICQkLnJlc2l6ZUZ1bmN0aW9uKTtcbiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICQkLnJlc2l6ZUZ1bmN0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB3cmFwcGVyID0gd2luZG93Lm9ucmVzaXplO1xuICAgICAgICAgICAgLy8gY2hlY2sgaWYgbm8gb25lIGVsc2UgcmVtb3ZlZCBvdXIgd3JhcHBlciBhbmQgcmVtb3ZlIG91ciByZXNpemVGdW5jdGlvbiBmcm9tIGl0XG4gICAgICAgICAgICBpZiAod3JhcHBlciAmJiB3cmFwcGVyLmFkZCAmJiB3cmFwcGVyLnJlbW92ZSkge1xuICAgICAgICAgICAgICAgIHdyYXBwZXIucmVtb3ZlKCQkLnJlc2l6ZUZ1bmN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICQkLnNlbGVjdENoYXJ0LmNsYXNzZWQoJ2MzJywgZmFsc2UpLmh0bWwoXCJcIik7XG5cbiAgICAgICAgLy8gTUVNTzogdGhpcyBpcyBuZWVkZWQgYmVjYXVzZSB0aGUgcmVmZXJlbmNlIG9mIHNvbWUgZWxlbWVudHMgd2lsbCBub3QgYmUgcmVsZWFzZWQsIHRoZW4gbWVtb3J5IGxlYWsgd2lsbCBoYXBwZW4uXG4gICAgICAgIE9iamVjdC5rZXlzKCQkKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICQkW2tleV0gPSBudWxsO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuXG4gICAgYzNfY2hhcnRfZm4udG9vbHRpcCA9IGZ1bmN0aW9uICgpIHt9O1xuICAgIGMzX2NoYXJ0X2ZuLnRvb2x0aXAuc2hvdyA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgIHZhciAkJCA9IHRoaXMuaW50ZXJuYWwsXG4gICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgIG1vdXNlO1xuXG4gICAgICAgIC8vIGRldGVybWluZSBtb3VzZSBwb3NpdGlvbiBvbiB0aGUgY2hhcnRcbiAgICAgICAgaWYgKGFyZ3MubW91c2UpIHtcbiAgICAgICAgICAgIG1vdXNlID0gYXJncy5tb3VzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGRldGVybWluZSBmb2N1cyBkYXRhXG4gICAgICAgIGlmIChhcmdzLmRhdGEpIHtcbiAgICAgICAgICAgIGlmICgkJC5pc011bHRpcGxlWCgpKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgbXVsdGlwbGUgeHMsIHRhcmdldCBwb2ludCB3aWxsIGJlIGRldGVybWluZWQgYnkgbW91c2VcbiAgICAgICAgICAgICAgICBtb3VzZSA9IFskJC54KGFyZ3MuZGF0YS54KSwgJCQuZ2V0WVNjYWxlKGFyZ3MuZGF0YS5pZCkoYXJncy5kYXRhLnZhbHVlKV07XG4gICAgICAgICAgICAgICAgaW5kZXggPSBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiB3aGVuIHRvb2x0aXBfZ3JvdXBlZCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgaW5kZXggPSBpc1ZhbHVlKGFyZ3MuZGF0YS5pbmRleCkgPyBhcmdzLmRhdGEuaW5kZXggOiAkJC5nZXRJbmRleEJ5WChhcmdzLmRhdGEueCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyZ3MueCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGluZGV4ID0gJCQuZ2V0SW5kZXhCeVgoYXJncy54KTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYXJncy5pbmRleCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGluZGV4ID0gYXJncy5pbmRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGVtdWxhdGUgbW91c2UgZXZlbnRzIHRvIHNob3dcbiAgICAgICAgJCQuZGlzcGF0Y2hFdmVudCgnbW91c2VvdmVyJywgaW5kZXgsIG1vdXNlKTtcbiAgICAgICAgJCQuZGlzcGF0Y2hFdmVudCgnbW91c2Vtb3ZlJywgaW5kZXgsIG1vdXNlKTtcblxuICAgICAgICAkJC5jb25maWcudG9vbHRpcF9vbnNob3cuY2FsbCgkJCwgYXJncy5kYXRhKTtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ZuLnRvb2x0aXAuaGlkZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVE9ETzogZ2V0IHRhcmdldCBkYXRhIGJ5IGNoZWNraW5nIHRoZSBzdGF0ZSBvZiBmb2N1c1xuICAgICAgICB0aGlzLmludGVybmFsLmRpc3BhdGNoRXZlbnQoJ21vdXNlb3V0JywgMCk7XG5cbiAgICAgICAgdGhpcy5pbnRlcm5hbC5jb25maWcudG9vbHRpcF9vbmhpZGUuY2FsbCh0aGlzKTtcbiAgICB9O1xuXG4gICAgLy8gRmVhdHVyZXM6XG4gICAgLy8gMS4gY2F0ZWdvcnkgYXhpc1xuICAgIC8vIDIuIGNlaWwgdmFsdWVzIG9mIHRyYW5zbGF0ZS94L3kgdG8gaW50IGZvciBoYWxmIHBpeGVsIGFudGlhbGlhc2luZ1xuICAgIC8vIDMuIG11bHRpbGluZSB0aWNrIHRleHRcbiAgICB2YXIgdGlja1RleHRDaGFyU2l6ZTtcbiAgICBmdW5jdGlvbiBjM19heGlzKGQzLCBwYXJhbXMpIHtcbiAgICAgICAgdmFyIHNjYWxlID0gZDMuc2NhbGUubGluZWFyKCksXG4gICAgICAgICAgICBvcmllbnQgPSBcImJvdHRvbVwiLFxuICAgICAgICAgICAgaW5uZXJUaWNrU2l6ZSA9IDYsXG4gICAgICAgICAgICBvdXRlclRpY2tTaXplLFxuICAgICAgICAgICAgdGlja1BhZGRpbmcgPSAzLFxuICAgICAgICAgICAgdGlja1ZhbHVlcyA9IG51bGwsXG4gICAgICAgICAgICB0aWNrRm9ybWF0LFxuICAgICAgICAgICAgdGlja0FyZ3VtZW50cztcblxuICAgICAgICB2YXIgdGlja09mZnNldCA9IDAsXG4gICAgICAgICAgICB0aWNrQ3VsbGluZyA9IHRydWUsXG4gICAgICAgICAgICB0aWNrQ2VudGVyZWQ7XG5cbiAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuICAgICAgICBvdXRlclRpY2tTaXplID0gcGFyYW1zLndpdGhPdXRlclRpY2sgPyA2IDogMDtcblxuICAgICAgICBmdW5jdGlvbiBheGlzWChzZWxlY3Rpb24sIHgpIHtcbiAgICAgICAgICAgIHNlbGVjdGlvbi5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgTWF0aC5jZWlsKHgoZCkgKyB0aWNrT2Zmc2V0KSArIFwiLCAwKVwiO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gYXhpc1koc2VsZWN0aW9uLCB5KSB7XG4gICAgICAgICAgICBzZWxlY3Rpb24uYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcInRyYW5zbGF0ZSgwLFwiICsgTWF0aC5jZWlsKHkoZCkpICsgXCIpXCI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzY2FsZUV4dGVudChkb21haW4pIHtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IGRvbWFpblswXSxcbiAgICAgICAgICAgICAgICBzdG9wID0gZG9tYWluW2RvbWFpbi5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIHJldHVybiBzdGFydCA8IHN0b3AgPyBbc3RhcnQsIHN0b3BdIDogW3N0b3AsIHN0YXJ0XTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZVRpY2tzKHNjYWxlKSB7XG4gICAgICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgICAgICBkb21haW4sXG4gICAgICAgICAgICAgICAgdGlja3MgPSBbXTtcbiAgICAgICAgICAgIGlmIChzY2FsZS50aWNrcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZS50aWNrcy5hcHBseShzY2FsZSwgdGlja0FyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb21haW4gPSBzY2FsZS5kb21haW4oKTtcbiAgICAgICAgICAgIGZvciAoaSA9IE1hdGguY2VpbChkb21haW5bMF0pOyBpIDwgZG9tYWluWzFdOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aWNrcy5wdXNoKGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRpY2tzLmxlbmd0aCA+IDAgJiYgdGlja3NbMF0gPiAwKSB7XG4gICAgICAgICAgICAgICAgdGlja3MudW5zaGlmdCh0aWNrc1swXSAtICh0aWNrc1sxXSAtIHRpY2tzWzBdKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGlja3M7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gY29weVNjYWxlKCkge1xuICAgICAgICAgICAgdmFyIG5ld1NjYWxlID0gc2NhbGUuY29weSgpLFxuICAgICAgICAgICAgICAgIGRvbWFpbjtcbiAgICAgICAgICAgIGlmIChwYXJhbXMuaXNDYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgIGRvbWFpbiA9IHNjYWxlLmRvbWFpbigpO1xuICAgICAgICAgICAgICAgIG5ld1NjYWxlLmRvbWFpbihbZG9tYWluWzBdLCBkb21haW5bMV0gLSAxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3U2NhbGU7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gdGV4dEZvcm1hdHRlZCh2KSB7XG4gICAgICAgICAgICB2YXIgZm9ybWF0dGVkID0gdGlja0Zvcm1hdCA/IHRpY2tGb3JtYXQodikgOiB2O1xuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBmb3JtYXR0ZWQgIT09ICd1bmRlZmluZWQnID8gZm9ybWF0dGVkIDogJyc7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gZ2V0U2l6ZUZvcjFDaGFyKHRpY2spIHtcbiAgICAgICAgICAgIGlmICh0aWNrVGV4dENoYXJTaXplKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRpY2tUZXh0Q2hhclNpemU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc2l6ZSA9IHtcbiAgICAgICAgICAgICAgICBoOiAxMS41LFxuICAgICAgICAgICAgICAgIHc6IDUuNVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRpY2suc2VsZWN0KCd0ZXh0JykudGV4dCh0ZXh0Rm9ybWF0dGVkKS5lYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJveCA9IHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0Rm9ybWF0dGVkKGQpLFxuICAgICAgICAgICAgICAgICAgICBoID0gYm94LmhlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgdyA9IHRleHQgPyBib3gud2lkdGggLyB0ZXh0Lmxlbmd0aCA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBpZiAoaCAmJiB3KSB7XG4gICAgICAgICAgICAgICAgICAgIHNpemUuaCA9IGg7XG4gICAgICAgICAgICAgICAgICAgIHNpemUudyA9IHc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkudGV4dCgnJyk7XG4gICAgICAgICAgICB0aWNrVGV4dENoYXJTaXplID0gc2l6ZTtcbiAgICAgICAgICAgIHJldHVybiBzaXplO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHRyYW5zaXRpb25pc2Uoc2VsZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zLndpdGhvdXRUcmFuc2l0aW9uID8gc2VsZWN0aW9uIDogZDMudHJhbnNpdGlvbihzZWxlY3Rpb24pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGF4aXMoZykge1xuICAgICAgICAgICAgZy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZyA9IGF4aXMuZyA9IGQzLnNlbGVjdCh0aGlzKTtcblxuICAgICAgICAgICAgICAgIHZhciBzY2FsZTAgPSB0aGlzLl9fY2hhcnRfXyB8fCBzY2FsZSxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGUxID0gdGhpcy5fX2NoYXJ0X18gPSBjb3B5U2NhbGUoKTtcblxuICAgICAgICAgICAgICAgIHZhciB0aWNrcyA9IHRpY2tWYWx1ZXMgPyB0aWNrVmFsdWVzIDogZ2VuZXJhdGVUaWNrcyhzY2FsZTEpLFxuICAgICAgICAgICAgICAgICAgICB0aWNrID0gZy5zZWxlY3RBbGwoXCIudGlja1wiKS5kYXRhKHRpY2tzLCBzY2FsZTEpLFxuICAgICAgICAgICAgICAgICAgICB0aWNrRW50ZXIgPSB0aWNrLmVudGVyKCkuaW5zZXJ0KFwiZ1wiLCBcIi5kb21haW5cIikuYXR0cihcImNsYXNzXCIsIFwidGlja1wiKS5zdHlsZShcIm9wYWNpdHlcIiwgMWUtNiksXG5cbiAgICAgICAgICAgICAgICAvLyBNRU1POiBObyBleGl0IHRyYW5zaXRpb24uIFRoZSByZWFzb24gaXMgdGhpcyB0cmFuc2l0aW9uIGFmZmVjdHMgbWF4IHRpY2sgd2lkdGggY2FsY3VsYXRpb24gYmVjYXVzZSBvbGQgdGljayB3aWxsIGJlIGluY2x1ZGVkIGluIHRoZSB0aWNrcy5cbiAgICAgICAgICAgICAgICB0aWNrRXhpdCA9IHRpY2suZXhpdCgpLnJlbW92ZSgpLFxuICAgICAgICAgICAgICAgICAgICB0aWNrVXBkYXRlID0gdHJhbnNpdGlvbmlzZSh0aWNrKS5zdHlsZShcIm9wYWNpdHlcIiwgMSksXG4gICAgICAgICAgICAgICAgICAgIHRpY2tUcmFuc2Zvcm0sXG4gICAgICAgICAgICAgICAgICAgIHRpY2tYLFxuICAgICAgICAgICAgICAgICAgICB0aWNrWTtcblxuICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IHNjYWxlLnJhbmdlRXh0ZW50ID8gc2NhbGUucmFuZ2VFeHRlbnQoKSA6IHNjYWxlRXh0ZW50KHNjYWxlLnJhbmdlKCkpLFxuICAgICAgICAgICAgICAgICAgICBwYXRoID0gZy5zZWxlY3RBbGwoXCIuZG9tYWluXCIpLmRhdGEoWzBdKSxcbiAgICAgICAgICAgICAgICAgICAgcGF0aFVwZGF0ZSA9IChwYXRoLmVudGVyKCkuYXBwZW5kKFwicGF0aFwiKS5hdHRyKFwiY2xhc3NcIiwgXCJkb21haW5cIiksIHRyYW5zaXRpb25pc2UocGF0aCkpO1xuICAgICAgICAgICAgICAgIHRpY2tFbnRlci5hcHBlbmQoXCJsaW5lXCIpO1xuICAgICAgICAgICAgICAgIHRpY2tFbnRlci5hcHBlbmQoXCJ0ZXh0XCIpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGxpbmVFbnRlciA9IHRpY2tFbnRlci5zZWxlY3QoXCJsaW5lXCIpLFxuICAgICAgICAgICAgICAgICAgICBsaW5lVXBkYXRlID0gdGlja1VwZGF0ZS5zZWxlY3QoXCJsaW5lXCIpLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0RW50ZXIgPSB0aWNrRW50ZXIuc2VsZWN0KFwidGV4dFwiKSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dFVwZGF0ZSA9IHRpY2tVcGRhdGUuc2VsZWN0KFwidGV4dFwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChwYXJhbXMuaXNDYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgICAgICB0aWNrT2Zmc2V0ID0gTWF0aC5jZWlsKChzY2FsZTEoMSkgLSBzY2FsZTEoMCkpIC8gMik7XG4gICAgICAgICAgICAgICAgICAgIHRpY2tYID0gdGlja0NlbnRlcmVkID8gMCA6IHRpY2tPZmZzZXQ7XG4gICAgICAgICAgICAgICAgICAgIHRpY2tZID0gdGlja0NlbnRlcmVkID8gdGlja09mZnNldCA6IDA7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGlja09mZnNldCA9IHRpY2tYID0gMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdGV4dCxcbiAgICAgICAgICAgICAgICAgICAgdHNwYW4sXG4gICAgICAgICAgICAgICAgICAgIHNpemVGb3IxQ2hhciA9IGdldFNpemVGb3IxQ2hhcihnLnNlbGVjdCgnLnRpY2snKSksXG4gICAgICAgICAgICAgICAgICAgIGNvdW50cyA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciB0aWNrTGVuZ3RoID0gTWF0aC5tYXgoaW5uZXJUaWNrU2l6ZSwgMCkgKyB0aWNrUGFkZGluZyxcbiAgICAgICAgICAgICAgICAgICAgaXNWZXJ0aWNhbCA9IG9yaWVudCA9PT0gJ2xlZnQnIHx8IG9yaWVudCA9PT0gJ3JpZ2h0JztcblxuICAgICAgICAgICAgICAgIC8vIHRoaXMgc2hvdWxkIGJlIGNhbGxlZCBvbmx5IHdoZW4gY2F0ZWdvcnkgYXhpc1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNwbGl0VGlja1RleHQoZCwgbWF4V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRpY2tUZXh0ID0gdGV4dEZvcm1hdHRlZChkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGFjZUluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFdpZHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXR0ZWQgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHRpY2tUZXh0KSA9PT0gXCJbb2JqZWN0IEFycmF5XVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGlja1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIW1heFdpZHRoIHx8IG1heFdpZHRoIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoID0gaXNWZXJ0aWNhbCA/IDk1IDogcGFyYW1zLmlzQ2F0ZWdvcnkgPyBNYXRoLmNlaWwoc2NhbGUxKHRpY2tzWzFdKSAtIHNjYWxlMSh0aWNrc1swXSkpIC0gMTIgOiAxMTA7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBzcGxpdChzcGxpdHRlZCwgdGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2VJbmRleCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0LmNoYXJBdChpKSA9PT0gJyAnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYWNlSW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJ0ZXh0ID0gdGV4dC5zdWJzdHIoMCwgaSArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRXaWR0aCA9IHNpemVGb3IxQ2hhci53ICogc3VidGV4dC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGV4dCB3aWR0aCBnZXRzIG92ZXIgdGljayB3aWR0aCwgc3BsaXQgYnkgc3BhY2UgaW5kZXggb3IgY3JyZW50IGluZGV4XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1heFdpZHRoIDwgdGV4dFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzcGxpdChzcGxpdHRlZC5jb25jYXQodGV4dC5zdWJzdHIoMCwgc3BhY2VJbmRleCA/IHNwYWNlSW5kZXggOiBpKSksIHRleHQuc2xpY2Uoc3BhY2VJbmRleCA/IHNwYWNlSW5kZXggKyAxIDogaSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzcGxpdHRlZC5jb25jYXQodGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3BsaXQoc3BsaXR0ZWQsIHRpY2tUZXh0ICsgXCJcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdHNwYW5EeShkLCBpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkeSA9IHNpemVGb3IxQ2hhci5oO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9yaWVudCA9PT0gJ2xlZnQnIHx8IG9yaWVudCA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0gLSgoY291bnRzW2QuaW5kZXhdIC0gMSkgKiAoc2l6ZUZvcjFDaGFyLmggLyAyKSAtIDMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeSA9IFwiLjcxZW1cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZHk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdGlja1NpemUoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGlja1Bvc2l0aW9uID0gc2NhbGUoZCkgKyAodGlja0NlbnRlcmVkID8gMCA6IHRpY2tPZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFuZ2VbMF0gPCB0aWNrUG9zaXRpb24gJiYgdGlja1Bvc2l0aW9uIDwgcmFuZ2VbMV0gPyBpbm5lclRpY2tTaXplIDogMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0ZXh0ID0gdGljay5zZWxlY3QoXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgICAgIHRzcGFuID0gdGV4dC5zZWxlY3RBbGwoJ3RzcGFuJykuZGF0YShmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3BsaXR0ZWQgPSBwYXJhbXMudGlja011bHRpbGluZSA/IHNwbGl0VGlja1RleHQoZCwgcGFyYW1zLnRpY2tXaWR0aCkgOiBbXS5jb25jYXQodGV4dEZvcm1hdHRlZChkKSk7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50c1tpXSA9IHNwbGl0dGVkLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNwbGl0dGVkLm1hcChmdW5jdGlvbiAocykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgaW5kZXg6IGksIHNwbGl0dGVkOiBzIH07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRzcGFuLmVudGVyKCkuYXBwZW5kKCd0c3BhbicpO1xuICAgICAgICAgICAgICAgIHRzcGFuLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0c3Bhbi50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnNwbGl0dGVkO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJvdGF0ZSA9IHBhcmFtcy50aWNrVGV4dFJvdGF0ZTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHRleHRBbmNob3JGb3JUZXh0KHJvdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJvdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdtaWRkbGUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByb3RhdGUgPiAwID8gXCJzdGFydFwiIDogXCJlbmRcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdGV4dFRyYW5zZm9ybShyb3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyb3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJyb3RhdGUoXCIgKyByb3RhdGUgKyBcIilcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZHhGb3JUZXh0KHJvdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJvdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDggKiBNYXRoLnNpbihNYXRoLlBJICogKHJvdGF0ZSAvIDE4MCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiB5Rm9yVGV4dChyb3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyb3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aWNrTGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxMS41IC0gMi41ICogKHJvdGF0ZSAvIDE1KSAqIChyb3RhdGUgPiAwID8gMSA6IC0xKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG9yaWVudCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYm90dG9tXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja1RyYW5zZm9ybSA9IGF4aXNYO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVFbnRlci5hdHRyKFwieTJcIiwgaW5uZXJUaWNrU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEVudGVyLmF0dHIoXCJ5XCIsIHRpY2tMZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVVcGRhdGUuYXR0cihcIngxXCIsIHRpY2tYKS5hdHRyKFwieDJcIiwgdGlja1gpLmF0dHIoXCJ5MlwiLCB0aWNrU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFVwZGF0ZS5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCB5Rm9yVGV4dChyb3RhdGUpKS5zdHlsZShcInRleHQtYW5jaG9yXCIsIHRleHRBbmNob3JGb3JUZXh0KHJvdGF0ZSkpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgdGV4dFRyYW5zZm9ybShyb3RhdGUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0c3Bhbi5hdHRyKCd4JywgMCkuYXR0cihcImR5XCIsIHRzcGFuRHkpLmF0dHIoJ2R4JywgZHhGb3JUZXh0KHJvdGF0ZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhVcGRhdGUuYXR0cihcImRcIiwgXCJNXCIgKyByYW5nZVswXSArIFwiLFwiICsgb3V0ZXJUaWNrU2l6ZSArIFwiVjBIXCIgKyByYW5nZVsxXSArIFwiVlwiICsgb3V0ZXJUaWNrU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ0b3BcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiByb3RhdGVkIHRpY2sgdGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tUcmFuc2Zvcm0gPSBheGlzWDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lRW50ZXIuYXR0cihcInkyXCIsIC1pbm5lclRpY2tTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0RW50ZXIuYXR0cihcInlcIiwgLXRpY2tMZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVVcGRhdGUuYXR0cihcIngyXCIsIDApLmF0dHIoXCJ5MlwiLCAtaW5uZXJUaWNrU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFVwZGF0ZS5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCAtdGlja0xlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRzcGFuLmF0dHIoJ3gnLCAwKS5hdHRyKFwiZHlcIiwgXCIwZW1cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aFVwZGF0ZS5hdHRyKFwiZFwiLCBcIk1cIiArIHJhbmdlWzBdICsgXCIsXCIgKyAtb3V0ZXJUaWNrU2l6ZSArIFwiVjBIXCIgKyByYW5nZVsxXSArIFwiVlwiICsgLW91dGVyVGlja1NpemUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tUcmFuc2Zvcm0gPSBheGlzWTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lRW50ZXIuYXR0cihcIngyXCIsIC1pbm5lclRpY2tTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0RW50ZXIuYXR0cihcInhcIiwgLXRpY2tMZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVVcGRhdGUuYXR0cihcIngyXCIsIC1pbm5lclRpY2tTaXplKS5hdHRyKFwieTFcIiwgdGlja1kpLmF0dHIoXCJ5MlwiLCB0aWNrWSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFVwZGF0ZS5hdHRyKFwieFwiLCAtdGlja0xlbmd0aCkuYXR0cihcInlcIiwgdGlja09mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRzcGFuLmF0dHIoJ3gnLCAtdGlja0xlbmd0aCkuYXR0cihcImR5XCIsIHRzcGFuRHkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhVcGRhdGUuYXR0cihcImRcIiwgXCJNXCIgKyAtb3V0ZXJUaWNrU2l6ZSArIFwiLFwiICsgcmFuZ2VbMF0gKyBcIkgwVlwiICsgcmFuZ2VbMV0gKyBcIkhcIiArIC1vdXRlclRpY2tTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja1RyYW5zZm9ybSA9IGF4aXNZO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVFbnRlci5hdHRyKFwieDJcIiwgaW5uZXJUaWNrU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEVudGVyLmF0dHIoXCJ4XCIsIHRpY2tMZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVVcGRhdGUuYXR0cihcIngyXCIsIGlubmVyVGlja1NpemUpLmF0dHIoXCJ5MlwiLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0VXBkYXRlLmF0dHIoXCJ4XCIsIHRpY2tMZW5ndGgpLmF0dHIoXCJ5XCIsIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcInN0YXJ0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRzcGFuLmF0dHIoJ3gnLCB0aWNrTGVuZ3RoKS5hdHRyKFwiZHlcIiwgdHNwYW5EeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aFVwZGF0ZS5hdHRyKFwiZFwiLCBcIk1cIiArIG91dGVyVGlja1NpemUgKyBcIixcIiArIHJhbmdlWzBdICsgXCJIMFZcIiArIHJhbmdlWzFdICsgXCJIXCIgKyBvdXRlclRpY2tTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNjYWxlMS5yYW5nZUJhbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBzY2FsZTEsXG4gICAgICAgICAgICAgICAgICAgICAgICBkeCA9IHgucmFuZ2VCYW5kKCkgLyAyO1xuICAgICAgICAgICAgICAgICAgICBzY2FsZTAgPSBzY2FsZTEgPSBmdW5jdGlvbiBzY2FsZTEoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHgoZCkgKyBkeDtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjYWxlMC5yYW5nZUJhbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NhbGUwID0gc2NhbGUxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRpY2tFeGl0LmNhbGwodGlja1RyYW5zZm9ybSwgc2NhbGUxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGlja0VudGVyLmNhbGwodGlja1RyYW5zZm9ybSwgc2NhbGUwKTtcbiAgICAgICAgICAgICAgICB0aWNrVXBkYXRlLmNhbGwodGlja1RyYW5zZm9ybSwgc2NhbGUxKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGF4aXMuc2NhbGUgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2NhbGUgPSB4O1xuICAgICAgICAgICAgcmV0dXJuIGF4aXM7XG4gICAgICAgIH07XG4gICAgICAgIGF4aXMub3JpZW50ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcmllbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcmllbnQgPSB4IGluIHsgdG9wOiAxLCByaWdodDogMSwgYm90dG9tOiAxLCBsZWZ0OiAxIH0gPyB4ICsgXCJcIiA6IFwiYm90dG9tXCI7XG4gICAgICAgICAgICByZXR1cm4gYXhpcztcbiAgICAgICAgfTtcbiAgICAgICAgYXhpcy50aWNrRm9ybWF0ID0gZnVuY3Rpb24gKGZvcm1hdCkge1xuICAgICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRpY2tGb3JtYXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aWNrRm9ybWF0ID0gZm9ybWF0O1xuICAgICAgICAgICAgcmV0dXJuIGF4aXM7XG4gICAgICAgIH07XG4gICAgICAgIGF4aXMudGlja0NlbnRlcmVkID0gZnVuY3Rpb24gKGlzQ2VudGVyZWQpIHtcbiAgICAgICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aWNrQ2VudGVyZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aWNrQ2VudGVyZWQgPSBpc0NlbnRlcmVkO1xuICAgICAgICAgICAgcmV0dXJuIGF4aXM7XG4gICAgICAgIH07XG4gICAgICAgIGF4aXMudGlja09mZnNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aWNrT2Zmc2V0O1xuICAgICAgICB9O1xuICAgICAgICBheGlzLnRpY2tJbnRlcnZhbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBpbnRlcnZhbCwgbGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHBhcmFtcy5pc0NhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgaW50ZXJ2YWwgPSB0aWNrT2Zmc2V0ICogMjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGVuZ3RoID0gYXhpcy5nLnNlbGVjdCgncGF0aC5kb21haW4nKS5ub2RlKCkuZ2V0VG90YWxMZW5ndGgoKSAtIG91dGVyVGlja1NpemUgKiAyO1xuICAgICAgICAgICAgICAgIGludGVydmFsID0gbGVuZ3RoIC8gYXhpcy5nLnNlbGVjdEFsbCgnbGluZScpLnNpemUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpbnRlcnZhbCA9PT0gSW5maW5pdHkgPyAwIDogaW50ZXJ2YWw7XG4gICAgICAgIH07XG4gICAgICAgIGF4aXMudGlja3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGlja0FyZ3VtZW50cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRpY2tBcmd1bWVudHMgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICByZXR1cm4gYXhpcztcbiAgICAgICAgfTtcbiAgICAgICAgYXhpcy50aWNrQ3VsbGluZyA9IGZ1bmN0aW9uIChjdWxsaW5nKSB7XG4gICAgICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGlja0N1bGxpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aWNrQ3VsbGluZyA9IGN1bGxpbmc7XG4gICAgICAgICAgICByZXR1cm4gYXhpcztcbiAgICAgICAgfTtcbiAgICAgICAgYXhpcy50aWNrVmFsdWVzID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgeCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRpY2tWYWx1ZXMgPSBmdW5jdGlvbiB0aWNrVmFsdWVzKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geChzY2FsZS5kb21haW4oKSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aWNrVmFsdWVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aWNrVmFsdWVzID0geDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBheGlzO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gYXhpcztcbiAgICB9XG5cbiAgICBjM19jaGFydF9pbnRlcm5hbF9mbi5pc1NhZmFyaSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHVhID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgICAgIHJldHVybiB1YS5pbmRleE9mKCdTYWZhcmknKSA+PSAwICYmIHVhLmluZGV4T2YoJ0Nocm9tZScpIDwgMDtcbiAgICB9O1xuICAgIGMzX2NoYXJ0X2ludGVybmFsX2ZuLmlzQ2hyb21lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgICAgICAgcmV0dXJuIHVhLmluZGV4T2YoJ0Nocm9tZScpID49IDA7XG4gICAgfTtcblxuICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cblxuICAgIC8vIFBoYW50b21KUyBkb2Vzbid0IGhhdmUgc3VwcG9ydCBmb3IgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQsIHdoaWNoIGhhcyBjYXVzZWQgY29uZnVzaW9uLiBVc2VcbiAgICAvLyB0aGlzIHBvbHlmaWxsIHRvIGF2b2lkIHRoZSBjb25mdXNpb24uXG4gICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRnVuY3Rpb24vYmluZCNQb2x5ZmlsbFxuXG4gICAgaWYgKCFGdW5jdGlvbi5wcm90b3R5cGUuYmluZCkge1xuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChvVGhpcykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgLy8gY2xvc2VzdCB0aGluZyBwb3NzaWJsZSB0byB0aGUgRUNNQVNjcmlwdCA1XG4gICAgICAgICAgICAgICAgLy8gaW50ZXJuYWwgSXNDYWxsYWJsZSBmdW5jdGlvblxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Z1bmN0aW9uLnByb3RvdHlwZS5iaW5kIC0gd2hhdCBpcyB0cnlpbmcgdG8gYmUgYm91bmQgaXMgbm90IGNhbGxhYmxlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBhQXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksXG4gICAgICAgICAgICAgICAgZlRvQmluZCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZk5PUCA9IGZ1bmN0aW9uIGZOT1AoKSB7fSxcbiAgICAgICAgICAgICAgICBmQm91bmQgPSBmdW5jdGlvbiBmQm91bmQoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZUb0JpbmQuYXBwbHkodGhpcyBpbnN0YW5jZW9mIGZOT1AgPyB0aGlzIDogb1RoaXMsIGFBcmdzLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBmTk9QLnByb3RvdHlwZSA9IHRoaXMucHJvdG90eXBlO1xuICAgICAgICAgICAgZkJvdW5kLnByb3RvdHlwZSA9IG5ldyBmTk9QKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBmQm91bmQ7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLy9TVkdQYXRoU2VnIEFQSSBwb2x5ZmlsbFxuICAgIC8vaHR0cHM6Ly9naXRodWIuY29tL3Byb2dlcnMvcGF0aHNlZ1xuICAgIC8vXG4gICAgLy9UaGlzIGlzIGEgZHJvcC1pbiByZXBsYWNlbWVudCBmb3IgdGhlIFNWR1BhdGhTZWcgYW5kIFNWR1BhdGhTZWdMaXN0IEFQSXMgdGhhdCB3ZXJlIHJlbW92ZWQgZnJvbVxuICAgIC8vU1ZHMiAoaHR0cHM6Ly9saXN0cy53My5vcmcvQXJjaGl2ZXMvUHVibGljL3d3dy1zdmcvMjAxNUp1bi8wMDQ0Lmh0bWwpLCBpbmNsdWRpbmcgdGhlIGxhdGVzdCBzcGVjXG4gICAgLy9jaGFuZ2VzIHdoaWNoIHdlcmUgaW1wbGVtZW50ZWQgaW4gRmlyZWZveCA0MyBhbmQgQ2hyb21lIDQ2LlxuICAgIC8vQ2hyb21lIDQ4IHJlbW92ZXMgdGhlc2UgQVBJcywgc28gdGhpcyBwb2x5ZmlsbCBpcyByZXF1aXJlZC5cblxuICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGlmICghKFwiU1ZHUGF0aFNlZ1wiIGluIHdpbmRvdykpIHtcbiAgICAgICAgICAgIC8vIFNwZWM6IGh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL3NpbmdsZS1wYWdlLmh0bWwjcGF0aHMtSW50ZXJmYWNlU1ZHUGF0aFNlZ1xuICAgICAgICAgICAgd2luZG93LlNWR1BhdGhTZWcgPSBmdW5jdGlvbiAodHlwZSwgdHlwZUFzTGV0dGVyLCBvd25pbmdQYXRoU2VnTGlzdCkge1xuICAgICAgICAgICAgICAgIHRoaXMucGF0aFNlZ1R5cGUgPSB0eXBlO1xuICAgICAgICAgICAgICAgIHRoaXMucGF0aFNlZ1R5cGVBc0xldHRlciA9IHR5cGVBc0xldHRlcjtcbiAgICAgICAgICAgICAgICB0aGlzLl9vd25pbmdQYXRoU2VnTGlzdCA9IG93bmluZ1BhdGhTZWdMaXN0O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgU1ZHUGF0aFNlZy5QQVRIU0VHX1VOS05PV04gPSAwO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZy5QQVRIU0VHX0NMT1NFUEFUSCA9IDE7XG4gICAgICAgICAgICBTVkdQYXRoU2VnLlBBVEhTRUdfTU9WRVRPX0FCUyA9IDI7XG4gICAgICAgICAgICBTVkdQYXRoU2VnLlBBVEhTRUdfTU9WRVRPX1JFTCA9IDM7XG4gICAgICAgICAgICBTVkdQYXRoU2VnLlBBVEhTRUdfTElORVRPX0FCUyA9IDQ7XG4gICAgICAgICAgICBTVkdQYXRoU2VnLlBBVEhTRUdfTElORVRPX1JFTCA9IDU7XG4gICAgICAgICAgICBTVkdQYXRoU2VnLlBBVEhTRUdfQ1VSVkVUT19DVUJJQ19BQlMgPSA2O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfUkVMID0gNztcbiAgICAgICAgICAgIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19BQlMgPSA4O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fUVVBRFJBVElDX1JFTCA9IDk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnLlBBVEhTRUdfQVJDX0FCUyA9IDEwO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZy5QQVRIU0VHX0FSQ19SRUwgPSAxMTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fSE9SSVpPTlRBTF9BQlMgPSAxMjtcbiAgICAgICAgICAgIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fSE9SSVpPTlRBTF9SRUwgPSAxMztcbiAgICAgICAgICAgIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fVkVSVElDQUxfQUJTID0gMTQ7XG4gICAgICAgICAgICBTVkdQYXRoU2VnLlBBVEhTRUdfTElORVRPX1ZFUlRJQ0FMX1JFTCA9IDE1O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfU01PT1RIX0FCUyA9IDE2O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfU01PT1RIX1JFTCA9IDE3O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fUVVBRFJBVElDX1NNT09USF9BQlMgPSAxODtcbiAgICAgICAgICAgIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19TTU9PVEhfUkVMID0gMTk7XG5cbiAgICAgICAgICAgIC8vIE5vdGlmeSBvd25pbmcgUGF0aFNlZ0xpc3Qgb24gYW55IGNoYW5nZXMgc28gdGhleSBjYW4gYmUgc3luY2hyb25pemVkIGJhY2sgdG8gdGhlIHBhdGggZWxlbWVudC5cbiAgICAgICAgICAgIFNWR1BhdGhTZWcucHJvdG90eXBlLl9zZWdtZW50Q2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3duaW5nUGF0aFNlZ0xpc3QpIHRoaXMuX293bmluZ1BhdGhTZWdMaXN0LnNlZ21lbnRDaGFuZ2VkKHRoaXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgd2luZG93LlNWR1BhdGhTZWdDbG9zZVBhdGggPSBmdW5jdGlvbiAob3duaW5nUGF0aFNlZ0xpc3QpIHtcbiAgICAgICAgICAgICAgICBTVkdQYXRoU2VnLmNhbGwodGhpcywgU1ZHUGF0aFNlZy5QQVRIU0VHX0NMT1NFUEFUSCwgXCJ6XCIsIG93bmluZ1BhdGhTZWdMaXN0KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ2xvc2VQYXRoLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU1ZHUGF0aFNlZy5wcm90b3R5cGUpO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0Nsb3NlUGF0aC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiW29iamVjdCBTVkdQYXRoU2VnQ2xvc2VQYXRoXVwiO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDbG9zZVBhdGgucHJvdG90eXBlLl9hc1BhdGhTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFNlZ1R5cGVBc0xldHRlcjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ2xvc2VQYXRoLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDbG9zZVBhdGgodW5kZWZpbmVkKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnTW92ZXRvQWJzID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5KSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19NT1ZFVE9fQUJTLCBcIk1cIiwgb3duaW5nUGF0aFNlZ0xpc3QpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O1xuICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdNb3ZldG9BYnMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnTW92ZXRvQWJzLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IFNWR1BhdGhTZWdNb3ZldG9BYnNdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ01vdmV0b0Ficy5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl94ICsgXCIgXCIgKyB0aGlzLl95O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdNb3ZldG9BYnMucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ01vdmV0b0Ficyh1bmRlZmluZWQsIHRoaXMuX3gsIHRoaXMuX3kpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnTW92ZXRvQWJzLnByb3RvdHlwZSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdNb3ZldG9BYnMucHJvdG90eXBlLCBcInlcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95ID0geTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnTW92ZXRvUmVsID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5KSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19NT1ZFVE9fUkVMLCBcIm1cIiwgb3duaW5nUGF0aFNlZ0xpc3QpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O1xuICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdNb3ZldG9SZWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnTW92ZXRvUmVsLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IFNWR1BhdGhTZWdNb3ZldG9SZWxdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ01vdmV0b1JlbC5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl94ICsgXCIgXCIgKyB0aGlzLl95O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdNb3ZldG9SZWwucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ01vdmV0b1JlbCh1bmRlZmluZWQsIHRoaXMuX3gsIHRoaXMuX3kpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnTW92ZXRvUmVsLnByb3RvdHlwZSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdNb3ZldG9SZWwucHJvdG90eXBlLCBcInlcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95ID0geTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnTGluZXRvQWJzID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5KSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fQUJTLCBcIkxcIiwgb3duaW5nUGF0aFNlZ0xpc3QpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O1xuICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9BYnMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvQWJzLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IFNWR1BhdGhTZWdMaW5ldG9BYnNdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpbmV0b0Ficy5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl94ICsgXCIgXCIgKyB0aGlzLl95O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9BYnMucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b0Ficyh1bmRlZmluZWQsIHRoaXMuX3gsIHRoaXMuX3kpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnTGluZXRvQWJzLnByb3RvdHlwZSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdMaW5ldG9BYnMucHJvdG90eXBlLCBcInlcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95ID0geTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnTGluZXRvUmVsID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5KSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fUkVMLCBcImxcIiwgb3duaW5nUGF0aFNlZ0xpc3QpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O1xuICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9SZWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvUmVsLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IFNWR1BhdGhTZWdMaW5ldG9SZWxdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpbmV0b1JlbC5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl94ICsgXCIgXCIgKyB0aGlzLl95O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9SZWwucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b1JlbCh1bmRlZmluZWQsIHRoaXMuX3gsIHRoaXMuX3kpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnTGluZXRvUmVsLnByb3RvdHlwZSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdMaW5ldG9SZWwucHJvdG90eXBlLCBcInlcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95ID0geTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnQ3VydmV0b0N1YmljQWJzID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5LCB4MSwgeTEsIHgyLCB5Mikge1xuICAgICAgICAgICAgICAgIFNWR1BhdGhTZWcuY2FsbCh0aGlzLCBTVkdQYXRoU2VnLlBBVEhTRUdfQ1VSVkVUT19DVUJJQ19BQlMsIFwiQ1wiLCBvd25pbmdQYXRoU2VnTGlzdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7XG4gICAgICAgICAgICAgICAgdGhpcy5feSA9IHk7XG4gICAgICAgICAgICAgICAgdGhpcy5feDEgPSB4MTtcbiAgICAgICAgICAgICAgICB0aGlzLl95MSA9IHkxO1xuICAgICAgICAgICAgICAgIHRoaXMuX3gyID0geDI7XG4gICAgICAgICAgICAgICAgdGhpcy5feTIgPSB5MjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b0N1YmljQWJzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU1ZHUGF0aFNlZy5wcm90b3R5cGUpO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY0Ficy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiW29iamVjdCBTVkdQYXRoU2VnQ3VydmV0b0N1YmljQWJzXVwiO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNBYnMucHJvdG90eXBlLl9hc1BhdGhTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFNlZ1R5cGVBc0xldHRlciArIFwiIFwiICsgdGhpcy5feDEgKyBcIiBcIiArIHRoaXMuX3kxICsgXCIgXCIgKyB0aGlzLl94MiArIFwiIFwiICsgdGhpcy5feTIgKyBcIiBcIiArIHRoaXMuX3ggKyBcIiBcIiArIHRoaXMuX3k7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY0Ficy5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b0N1YmljQWJzKHVuZGVmaW5lZCwgdGhpcy5feCwgdGhpcy5feSwgdGhpcy5feDEsIHRoaXMuX3kxLCB0aGlzLl94MiwgdGhpcy5feTIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b0N1YmljQWJzLnByb3RvdHlwZSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNBYnMucHJvdG90eXBlLCBcInlcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95ID0geTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY0Ficy5wcm90b3R5cGUsIFwieDFcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3gxO1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3gxID0geDE7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNBYnMucHJvdG90eXBlLCBcInkxXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl95MTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh5MSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95MSA9IHkxO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b0N1YmljQWJzLnByb3RvdHlwZSwgXCJ4MlwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feDI7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeDIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feDIgPSB4Mjt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY0Ficy5wcm90b3R5cGUsIFwieTJcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3kyO1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHkyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3kyID0geTI7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuXG4gICAgICAgICAgICB3aW5kb3cuU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1JlbCA9IGZ1bmN0aW9uIChvd25pbmdQYXRoU2VnTGlzdCwgeCwgeSwgeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgICAgICAgICBTVkdQYXRoU2VnLmNhbGwodGhpcywgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfUkVMLCBcImNcIiwgb3duaW5nUGF0aFNlZ0xpc3QpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O1xuICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O1xuICAgICAgICAgICAgICAgIHRoaXMuX3gxID0geDE7XG4gICAgICAgICAgICAgICAgdGhpcy5feTEgPSB5MTtcbiAgICAgICAgICAgICAgICB0aGlzLl94MiA9IHgyO1xuICAgICAgICAgICAgICAgIHRoaXMuX3kyID0geTI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1JlbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNWR1BhdGhTZWcucHJvdG90eXBlKTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNSZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIltvYmplY3QgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1JlbF1cIjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b0N1YmljUmVsLnByb3RvdHlwZS5fYXNQYXRoU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhdGhTZWdUeXBlQXNMZXR0ZXIgKyBcIiBcIiArIHRoaXMuX3gxICsgXCIgXCIgKyB0aGlzLl95MSArIFwiIFwiICsgdGhpcy5feDIgKyBcIiBcIiArIHRoaXMuX3kyICsgXCIgXCIgKyB0aGlzLl94ICsgXCIgXCIgKyB0aGlzLl95O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNSZWwucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1JlbCh1bmRlZmluZWQsIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3gxLCB0aGlzLl95MSwgdGhpcy5feDIsIHRoaXMuX3kyKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1JlbC5wcm90b3R5cGUsIFwieFwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feDtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b0N1YmljUmVsLnByb3RvdHlwZSwgXCJ5XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl95O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feSA9IHk7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNSZWwucHJvdG90eXBlLCBcIngxXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94MTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh4MSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl94MSA9IHgxO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b0N1YmljUmVsLnByb3RvdHlwZSwgXCJ5MVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feTE7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feTEgPSB5MTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1JlbC5wcm90b3R5cGUsIFwieDJcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3gyO1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3gyID0geDI7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNSZWwucHJvdG90eXBlLCBcInkyXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl95MjtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh5Mikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95MiA9IHkyO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgd2luZG93LlNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljQWJzID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5LCB4MSwgeTEpIHtcbiAgICAgICAgICAgICAgICBTVkdQYXRoU2VnLmNhbGwodGhpcywgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fUVVBRFJBVElDX0FCUywgXCJRXCIsIG93bmluZ1BhdGhTZWdMaXN0KTtcbiAgICAgICAgICAgICAgICB0aGlzLl94ID0geDtcbiAgICAgICAgICAgICAgICB0aGlzLl95ID0geTtcbiAgICAgICAgICAgICAgICB0aGlzLl94MSA9IHgxO1xuICAgICAgICAgICAgICAgIHRoaXMuX3kxID0geTE7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNBYnMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY0Ficy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiW29iamVjdCBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY0Fic11cIjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY0Ficy5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl94MSArIFwiIFwiICsgdGhpcy5feTEgKyBcIiBcIiArIHRoaXMuX3ggKyBcIiBcIiArIHRoaXMuX3k7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNBYnMucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNBYnModW5kZWZpbmVkLCB0aGlzLl94LCB0aGlzLl95LCB0aGlzLl94MSwgdGhpcy5feTEpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY0Ficy5wcm90b3R5cGUsIFwieFwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feDtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY0Ficy5wcm90b3R5cGUsIFwieVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY0Ficy5wcm90b3R5cGUsIFwieDFcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3gxO1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3gxID0geDE7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljQWJzLnByb3RvdHlwZSwgXCJ5MVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feTE7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feTEgPSB5MTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1JlbCA9IGZ1bmN0aW9uIChvd25pbmdQYXRoU2VnTGlzdCwgeCwgeSwgeDEsIHkxKSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19SRUwsIFwicVwiLCBvd25pbmdQYXRoU2VnTGlzdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7XG4gICAgICAgICAgICAgICAgdGhpcy5feSA9IHk7XG4gICAgICAgICAgICAgICAgdGhpcy5feDEgPSB4MTtcbiAgICAgICAgICAgICAgICB0aGlzLl95MSA9IHkxO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljUmVsLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU1ZHUGF0aFNlZy5wcm90b3R5cGUpO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNSZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIltvYmplY3QgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNSZWxdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNSZWwucHJvdG90eXBlLl9hc1BhdGhTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFNlZ1R5cGVBc0xldHRlciArIFwiIFwiICsgdGhpcy5feDEgKyBcIiBcIiArIHRoaXMuX3kxICsgXCIgXCIgKyB0aGlzLl94ICsgXCIgXCIgKyB0aGlzLl95O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljUmVsLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljUmVsKHVuZGVmaW5lZCwgdGhpcy5feCwgdGhpcy5feSwgdGhpcy5feDEsIHRoaXMuX3kxKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNSZWwucHJvdG90eXBlLCBcInhcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3g7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl94ID0geDt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNSZWwucHJvdG90eXBlLCBcInlcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95ID0geTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNSZWwucHJvdG90eXBlLCBcIngxXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94MTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh4MSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl94MSA9IHgxO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1JlbC5wcm90b3R5cGUsIFwieTFcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3kxO1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHkxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3kxID0geTE7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuXG4gICAgICAgICAgICB3aW5kb3cuU1ZHUGF0aFNlZ0FyY0FicyA9IGZ1bmN0aW9uIChvd25pbmdQYXRoU2VnTGlzdCwgeCwgeSwgcjEsIHIyLCBhbmdsZSwgbGFyZ2VBcmNGbGFnLCBzd2VlcEZsYWcpIHtcbiAgICAgICAgICAgICAgICBTVkdQYXRoU2VnLmNhbGwodGhpcywgU1ZHUGF0aFNlZy5QQVRIU0VHX0FSQ19BQlMsIFwiQVwiLCBvd25pbmdQYXRoU2VnTGlzdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7XG4gICAgICAgICAgICAgICAgdGhpcy5feSA9IHk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcjEgPSByMTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yMiA9IHIyO1xuICAgICAgICAgICAgICAgIHRoaXMuX2FuZ2xlID0gYW5nbGU7XG4gICAgICAgICAgICAgICAgdGhpcy5fbGFyZ2VBcmNGbGFnID0gbGFyZ2VBcmNGbGFnO1xuICAgICAgICAgICAgICAgIHRoaXMuX3N3ZWVwRmxhZyA9IHN3ZWVwRmxhZztcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQXJjQWJzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU1ZHUGF0aFNlZy5wcm90b3R5cGUpO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0FyY0Ficy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiW29iamVjdCBTVkdQYXRoU2VnQXJjQWJzXVwiO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdBcmNBYnMucHJvdG90eXBlLl9hc1BhdGhTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFNlZ1R5cGVBc0xldHRlciArIFwiIFwiICsgdGhpcy5fcjEgKyBcIiBcIiArIHRoaXMuX3IyICsgXCIgXCIgKyB0aGlzLl9hbmdsZSArIFwiIFwiICsgKHRoaXMuX2xhcmdlQXJjRmxhZyA/IFwiMVwiIDogXCIwXCIpICsgXCIgXCIgKyAodGhpcy5fc3dlZXBGbGFnID8gXCIxXCIgOiBcIjBcIikgKyBcIiBcIiArIHRoaXMuX3ggKyBcIiBcIiArIHRoaXMuX3k7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0FyY0Ficy5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQXJjQWJzKHVuZGVmaW5lZCwgdGhpcy5feCwgdGhpcy5feSwgdGhpcy5fcjEsIHRoaXMuX3IyLCB0aGlzLl9hbmdsZSwgdGhpcy5fbGFyZ2VBcmNGbGFnLCB0aGlzLl9zd2VlcEZsYWcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQXJjQWJzLnByb3RvdHlwZSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdBcmNBYnMucHJvdG90eXBlLCBcInlcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95ID0geTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0FyY0Ficy5wcm90b3R5cGUsIFwicjFcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3IxO1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHIxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3IxID0gcjE7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdBcmNBYnMucHJvdG90eXBlLCBcInIyXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yMjtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldChyMikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yMiA9IHIyO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQXJjQWJzLnByb3RvdHlwZSwgXCJhbmdsZVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYW5nbGU7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoYW5nbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5nbGUgPSBhbmdsZTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0FyY0Ficy5wcm90b3R5cGUsIFwibGFyZ2VBcmNGbGFnXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXJnZUFyY0ZsYWc7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQobGFyZ2VBcmNGbGFnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhcmdlQXJjRmxhZyA9IGxhcmdlQXJjRmxhZzt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0FyY0Ficy5wcm90b3R5cGUsIFwic3dlZXBGbGFnXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zd2VlcEZsYWc7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoc3dlZXBGbGFnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3N3ZWVwRmxhZyA9IHN3ZWVwRmxhZzt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnQXJjUmVsID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5LCByMSwgcjIsIGFuZ2xlLCBsYXJnZUFyY0ZsYWcsIHN3ZWVwRmxhZykge1xuICAgICAgICAgICAgICAgIFNWR1BhdGhTZWcuY2FsbCh0aGlzLCBTVkdQYXRoU2VnLlBBVEhTRUdfQVJDX1JFTCwgXCJhXCIsIG93bmluZ1BhdGhTZWdMaXN0KTtcbiAgICAgICAgICAgICAgICB0aGlzLl94ID0geDtcbiAgICAgICAgICAgICAgICB0aGlzLl95ID0geTtcbiAgICAgICAgICAgICAgICB0aGlzLl9yMSA9IHIxO1xuICAgICAgICAgICAgICAgIHRoaXMuX3IyID0gcjI7XG4gICAgICAgICAgICAgICAgdGhpcy5fYW5nbGUgPSBhbmdsZTtcbiAgICAgICAgICAgICAgICB0aGlzLl9sYXJnZUFyY0ZsYWcgPSBsYXJnZUFyY0ZsYWc7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3dlZXBGbGFnID0gc3dlZXBGbGFnO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdBcmNSZWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnQXJjUmVsLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IFNWR1BhdGhTZWdBcmNSZWxdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0FyY1JlbC5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl9yMSArIFwiIFwiICsgdGhpcy5fcjIgKyBcIiBcIiArIHRoaXMuX2FuZ2xlICsgXCIgXCIgKyAodGhpcy5fbGFyZ2VBcmNGbGFnID8gXCIxXCIgOiBcIjBcIikgKyBcIiBcIiArICh0aGlzLl9zd2VlcEZsYWcgPyBcIjFcIiA6IFwiMFwiKSArIFwiIFwiICsgdGhpcy5feCArIFwiIFwiICsgdGhpcy5feTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQXJjUmVsLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdBcmNSZWwodW5kZWZpbmVkLCB0aGlzLl94LCB0aGlzLl95LCB0aGlzLl9yMSwgdGhpcy5fcjIsIHRoaXMuX2FuZ2xlLCB0aGlzLl9sYXJnZUFyY0ZsYWcsIHRoaXMuX3N3ZWVwRmxhZyk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdBcmNSZWwucHJvdG90eXBlLCBcInhcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3g7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl94ID0geDt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0FyY1JlbC5wcm90b3R5cGUsIFwieVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQXJjUmVsLnByb3RvdHlwZSwgXCJyMVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcjE7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQocjEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcjEgPSByMTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0FyY1JlbC5wcm90b3R5cGUsIFwicjJcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3IyO1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHIyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3IyID0gcjI7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdBcmNSZWwucHJvdG90eXBlLCBcImFuZ2xlXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbmdsZTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldChhbmdsZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmdsZSA9IGFuZ2xlO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQXJjUmVsLnByb3RvdHlwZSwgXCJsYXJnZUFyY0ZsYWdcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xhcmdlQXJjRmxhZztcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldChsYXJnZUFyY0ZsYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFyZ2VBcmNGbGFnID0gbGFyZ2VBcmNGbGFnO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQXJjUmVsLnByb3RvdHlwZSwgXCJzd2VlcEZsYWdcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N3ZWVwRmxhZztcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldChzd2VlcEZsYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3dlZXBGbGFnID0gc3dlZXBGbGFnO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgd2luZG93LlNWR1BhdGhTZWdMaW5ldG9Ib3Jpem9udGFsQWJzID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4KSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fSE9SSVpPTlRBTF9BQlMsIFwiSFwiLCBvd25pbmdQYXRoU2VnTGlzdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxBYnMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvSG9yaXpvbnRhbEFicy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiW29iamVjdCBTVkdQYXRoU2VnTGluZXRvSG9yaXpvbnRhbEFic11cIjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvSG9yaXpvbnRhbEFicy5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl94O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9Ib3Jpem9udGFsQWJzLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdMaW5ldG9Ib3Jpem9udGFsQWJzKHVuZGVmaW5lZCwgdGhpcy5feCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdMaW5ldG9Ib3Jpem9udGFsQWJzLnByb3RvdHlwZSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuXG4gICAgICAgICAgICB3aW5kb3cuU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxSZWwgPSBmdW5jdGlvbiAob3duaW5nUGF0aFNlZ0xpc3QsIHgpIHtcbiAgICAgICAgICAgICAgICBTVkdQYXRoU2VnLmNhbGwodGhpcywgU1ZHUGF0aFNlZy5QQVRIU0VHX0xJTkVUT19IT1JJWk9OVEFMX1JFTCwgXCJoXCIsIG93bmluZ1BhdGhTZWdMaXN0KTtcbiAgICAgICAgICAgICAgICB0aGlzLl94ID0geDtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvSG9yaXpvbnRhbFJlbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNWR1BhdGhTZWcucHJvdG90eXBlKTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9Ib3Jpem9udGFsUmVsLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IFNWR1BhdGhTZWdMaW5ldG9Ib3Jpem9udGFsUmVsXVwiO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9Ib3Jpem9udGFsUmVsLnByb3RvdHlwZS5fYXNQYXRoU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhdGhTZWdUeXBlQXNMZXR0ZXIgKyBcIiBcIiArIHRoaXMuX3g7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxSZWwucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxSZWwodW5kZWZpbmVkLCB0aGlzLl94KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxSZWwucHJvdG90eXBlLCBcInhcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3g7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl94ID0geDt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnTGluZXRvVmVydGljYWxBYnMgPSBmdW5jdGlvbiAob3duaW5nUGF0aFNlZ0xpc3QsIHkpIHtcbiAgICAgICAgICAgICAgICBTVkdQYXRoU2VnLmNhbGwodGhpcywgU1ZHUGF0aFNlZy5QQVRIU0VHX0xJTkVUT19WRVJUSUNBTF9BQlMsIFwiVlwiLCBvd25pbmdQYXRoU2VnTGlzdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5feSA9IHk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpbmV0b1ZlcnRpY2FsQWJzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU1ZHUGF0aFNlZy5wcm90b3R5cGUpO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpbmV0b1ZlcnRpY2FsQWJzLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IFNWR1BhdGhTZWdMaW5ldG9WZXJ0aWNhbEFic11cIjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvVmVydGljYWxBYnMucHJvdG90eXBlLl9hc1BhdGhTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFNlZ1R5cGVBc0xldHRlciArIFwiIFwiICsgdGhpcy5feTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvVmVydGljYWxBYnMucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b1ZlcnRpY2FsQWJzKHVuZGVmaW5lZCwgdGhpcy5feSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdMaW5ldG9WZXJ0aWNhbEFicy5wcm90b3R5cGUsIFwieVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgd2luZG93LlNWR1BhdGhTZWdMaW5ldG9WZXJ0aWNhbFJlbCA9IGZ1bmN0aW9uIChvd25pbmdQYXRoU2VnTGlzdCwgeSkge1xuICAgICAgICAgICAgICAgIFNWR1BhdGhTZWcuY2FsbCh0aGlzLCBTVkdQYXRoU2VnLlBBVEhTRUdfTElORVRPX1ZFUlRJQ0FMX1JFTCwgXCJ2XCIsIG93bmluZ1BhdGhTZWdMaXN0KTtcbiAgICAgICAgICAgICAgICB0aGlzLl95ID0geTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvVmVydGljYWxSZWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnTGluZXRvVmVydGljYWxSZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIltvYmplY3QgU1ZHUGF0aFNlZ0xpbmV0b1ZlcnRpY2FsUmVsXVwiO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9WZXJ0aWNhbFJlbC5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl95O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaW5ldG9WZXJ0aWNhbFJlbC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnTGluZXRvVmVydGljYWxSZWwodW5kZWZpbmVkLCB0aGlzLl95KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0xpbmV0b1ZlcnRpY2FsUmVsLnByb3RvdHlwZSwgXCJ5XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl95O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feSA9IHk7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuXG4gICAgICAgICAgICB3aW5kb3cuU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aEFicyA9IGZ1bmN0aW9uIChvd25pbmdQYXRoU2VnTGlzdCwgeCwgeSwgeDIsIHkyKSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX0NVQklDX1NNT09USF9BQlMsIFwiU1wiLCBvd25pbmdQYXRoU2VnTGlzdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7XG4gICAgICAgICAgICAgICAgdGhpcy5feSA9IHk7XG4gICAgICAgICAgICAgICAgdGhpcy5feDIgPSB4MjtcbiAgICAgICAgICAgICAgICB0aGlzLl95MiA9IHkyO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhBYnMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTVkdQYXRoU2VnLnByb3RvdHlwZSk7XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoQWJzLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJbb2JqZWN0IFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhBYnNdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aEFicy5wcm90b3R5cGUuX2FzUGF0aFN0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnVHlwZUFzTGV0dGVyICsgXCIgXCIgKyB0aGlzLl94MiArIFwiIFwiICsgdGhpcy5feTIgKyBcIiBcIiArIHRoaXMuX3ggKyBcIiBcIiArIHRoaXMuX3k7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aEFicy5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoQWJzKHVuZGVmaW5lZCwgdGhpcy5feCwgdGhpcy5feSwgdGhpcy5feDIsIHRoaXMuX3kyKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aEFicy5wcm90b3R5cGUsIFwieFwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feDtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoQWJzLnByb3RvdHlwZSwgXCJ5XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl95O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feSA9IHk7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhBYnMucHJvdG90eXBlLCBcIngyXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94MjtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh4Mikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl94MiA9IHgyO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoQWJzLnByb3RvdHlwZSwgXCJ5MlwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feTI7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeTIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feTIgPSB5Mjt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5TVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoUmVsID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5LCB4MiwgeTIpIHtcbiAgICAgICAgICAgICAgICBTVkdQYXRoU2VnLmNhbGwodGhpcywgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfU01PT1RIX1JFTCwgXCJzXCIsIG93bmluZ1BhdGhTZWdMaXN0KTtcbiAgICAgICAgICAgICAgICB0aGlzLl94ID0geDtcbiAgICAgICAgICAgICAgICB0aGlzLl95ID0geTtcbiAgICAgICAgICAgICAgICB0aGlzLl94MiA9IHgyO1xuICAgICAgICAgICAgICAgIHRoaXMuX3kyID0geTI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aFJlbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNWR1BhdGhTZWcucHJvdG90eXBlKTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhSZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIltvYmplY3QgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aFJlbF1cIjtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoUmVsLnByb3RvdHlwZS5fYXNQYXRoU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhdGhTZWdUeXBlQXNMZXR0ZXIgKyBcIiBcIiArIHRoaXMuX3gyICsgXCIgXCIgKyB0aGlzLl95MiArIFwiIFwiICsgdGhpcy5feCArIFwiIFwiICsgdGhpcy5feTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoUmVsLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhSZWwodW5kZWZpbmVkLCB0aGlzLl94LCB0aGlzLl95LCB0aGlzLl94MiwgdGhpcy5feTIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoUmVsLnByb3RvdHlwZSwgXCJ4XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhSZWwucHJvdG90eXBlLCBcInlcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3k7XG4gICAgICAgICAgICAgICAgfSwgc2V0OiBmdW5jdGlvbiBzZXQoeSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95ID0geTt0aGlzLl9zZWdtZW50Q2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aFJlbC5wcm90b3R5cGUsIFwieDJcIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3gyO1xuICAgICAgICAgICAgICAgIH0sIHNldDogZnVuY3Rpb24gc2V0KHgyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3gyID0geDI7dGhpcy5fc2VnbWVudENoYW5nZWQoKTtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhSZWwucHJvdG90eXBlLCBcInkyXCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl95MjtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh5Mikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl95MiA9IHkyO3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgd2luZG93LlNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljU21vb3RoQWJzID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5KSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19TTU9PVEhfQUJTLCBcIlRcIiwgb3duaW5nUGF0aFNlZ0xpc3QpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O1xuICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljU21vb3RoQWJzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU1ZHUGF0aFNlZy5wcm90b3R5cGUpO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNTbW9vdGhBYnMucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIltvYmplY3QgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNTbW9vdGhBYnNdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNTbW9vdGhBYnMucHJvdG90eXBlLl9hc1BhdGhTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFNlZ1R5cGVBc0xldHRlciArIFwiIFwiICsgdGhpcy5feCArIFwiIFwiICsgdGhpcy5feTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aEFicy5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aEFicyh1bmRlZmluZWQsIHRoaXMuX3gsIHRoaXMuX3kpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aEFicy5wcm90b3R5cGUsIFwieFwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feDtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aEFicy5wcm90b3R5cGUsIFwieVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgd2luZG93LlNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljU21vb3RoUmVsID0gZnVuY3Rpb24gKG93bmluZ1BhdGhTZWdMaXN0LCB4LCB5KSB7XG4gICAgICAgICAgICAgICAgU1ZHUGF0aFNlZy5jYWxsKHRoaXMsIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19TTU9PVEhfUkVMLCBcInRcIiwgb3duaW5nUGF0aFNlZ0xpc3QpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O1xuICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljU21vb3RoUmVsLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU1ZHUGF0aFNlZy5wcm90b3R5cGUpO1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNTbW9vdGhSZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIltvYmplY3QgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNTbW9vdGhSZWxdXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNTbW9vdGhSZWwucHJvdG90eXBlLl9hc1BhdGhTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFNlZ1R5cGVBc0xldHRlciArIFwiIFwiICsgdGhpcy5feCArIFwiIFwiICsgdGhpcy5feTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aFJlbC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aFJlbCh1bmRlZmluZWQsIHRoaXMuX3gsIHRoaXMuX3kpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aFJlbC5wcm90b3R5cGUsIFwieFwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feDtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ggPSB4O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aFJlbC5wcm90b3R5cGUsIFwieVwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feTtcbiAgICAgICAgICAgICAgICB9LCBzZXQ6IGZ1bmN0aW9uIHNldCh5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3kgPSB5O3RoaXMuX3NlZ21lbnRDaGFuZ2VkKCk7XG4gICAgICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgLy8gQWRkIGNyZWF0ZVNWR1BhdGhTZWcqIGZ1bmN0aW9ucyB0byBTVkdQYXRoRWxlbWVudC5cbiAgICAgICAgICAgIC8vIFNwZWM6IGh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL3NpbmdsZS1wYWdlLmh0bWwjcGF0aHMtSW50ZXJmYWNlU1ZHUGF0aEVsZW1lbnQuXG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ0Nsb3NlUGF0aCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDbG9zZVBhdGgodW5kZWZpbmVkKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ01vdmV0b0FicyA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnTW92ZXRvQWJzKHVuZGVmaW5lZCwgeCwgeSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVNWR1BhdGhTZWdNb3ZldG9SZWwgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ01vdmV0b1JlbCh1bmRlZmluZWQsIHgsIHkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTVkdQYXRoU2VnTGluZXRvQWJzID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdMaW5ldG9BYnModW5kZWZpbmVkLCB4LCB5KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ0xpbmV0b1JlbCA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnTGluZXRvUmVsKHVuZGVmaW5lZCwgeCwgeSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNBYnMgPSBmdW5jdGlvbiAoeCwgeSwgeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNBYnModW5kZWZpbmVkLCB4LCB5LCB4MSwgeTEsIHgyLCB5Mik7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNSZWwgPSBmdW5jdGlvbiAoeCwgeSwgeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNSZWwodW5kZWZpbmVkLCB4LCB5LCB4MSwgeTEsIHgyLCB5Mik7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljQWJzID0gZnVuY3Rpb24gKHgsIHksIHgxLCB5MSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNBYnModW5kZWZpbmVkLCB4LCB5LCB4MSwgeTEpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1JlbCA9IGZ1bmN0aW9uICh4LCB5LCB4MSwgeTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljUmVsKHVuZGVmaW5lZCwgeCwgeSwgeDEsIHkxKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ0FyY0FicyA9IGZ1bmN0aW9uICh4LCB5LCByMSwgcjIsIGFuZ2xlLCBsYXJnZUFyY0ZsYWcsIHN3ZWVwRmxhZykge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0FyY0Ficyh1bmRlZmluZWQsIHgsIHksIHIxLCByMiwgYW5nbGUsIGxhcmdlQXJjRmxhZywgc3dlZXBGbGFnKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ0FyY1JlbCA9IGZ1bmN0aW9uICh4LCB5LCByMSwgcjIsIGFuZ2xlLCBsYXJnZUFyY0ZsYWcsIHN3ZWVwRmxhZykge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0FyY1JlbCh1bmRlZmluZWQsIHgsIHksIHIxLCByMiwgYW5nbGUsIGxhcmdlQXJjRmxhZywgc3dlZXBGbGFnKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxBYnMgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxBYnModW5kZWZpbmVkLCB4KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxSZWwgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b0hvcml6b250YWxSZWwodW5kZWZpbmVkLCB4KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ0xpbmV0b1ZlcnRpY2FsQWJzID0gZnVuY3Rpb24gKHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdMaW5ldG9WZXJ0aWNhbEFicyh1bmRlZmluZWQsIHkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTVkdQYXRoU2VnTGluZXRvVmVydGljYWxSZWwgPSBmdW5jdGlvbiAoeSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b1ZlcnRpY2FsUmVsKHVuZGVmaW5lZCwgeSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgU1ZHUGF0aEVsZW1lbnQucHJvdG90eXBlLmNyZWF0ZVNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhBYnMgPSBmdW5jdGlvbiAoeCwgeSwgeDIsIHkyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b0N1YmljU21vb3RoQWJzKHVuZGVmaW5lZCwgeCwgeSwgeDIsIHkyKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBTVkdQYXRoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aFJlbCA9IGZ1bmN0aW9uICh4LCB5LCB4MiwgeTIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhSZWwodW5kZWZpbmVkLCB4LCB5LCB4MiwgeTIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aEFicyA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aEFicyh1bmRlZmluZWQsIHgsIHkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFNWR1BhdGhFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aFJlbCA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1Ntb290aFJlbCh1bmRlZmluZWQsIHgsIHkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghKFwiU1ZHUGF0aFNlZ0xpc3RcIiBpbiB3aW5kb3cpKSB7XG4gICAgICAgICAgICAvLyBTcGVjOiBodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9zaW5nbGUtcGFnZS5odG1sI3BhdGhzLUludGVyZmFjZVNWR1BhdGhTZWdMaXN0XG4gICAgICAgICAgICB3aW5kb3cuU1ZHUGF0aFNlZ0xpc3QgPSBmdW5jdGlvbiAocGF0aEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXRoRWxlbWVudCA9IHBhdGhFbGVtZW50O1xuICAgICAgICAgICAgICAgIHRoaXMuX2xpc3QgPSB0aGlzLl9wYXJzZVBhdGgodGhpcy5fcGF0aEVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZFwiKSk7XG5cbiAgICAgICAgICAgICAgICAvLyBVc2UgYSBNdXRhdGlvbk9ic2VydmVyIHRvIGNhdGNoIGNoYW5nZXMgdG8gdGhlIHBhdGgncyBcImRcIiBhdHRyaWJ1dGUuXG4gICAgICAgICAgICAgICAgdGhpcy5fbXV0YXRpb25PYnNlcnZlckNvbmZpZyA9IHsgXCJhdHRyaWJ1dGVzXCI6IHRydWUsIFwiYXR0cmlidXRlRmlsdGVyXCI6IFtcImRcIl0gfTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXRoRWxlbWVudE11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcih0aGlzLl91cGRhdGVMaXN0RnJvbVBhdGhNdXRhdGlvbnMuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGF0aEVsZW1lbnRNdXRhdGlvbk9ic2VydmVyLm9ic2VydmUodGhpcy5fcGF0aEVsZW1lbnQsIHRoaXMuX211dGF0aW9uT2JzZXJ2ZXJDb25maWcpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhTZWdMaXN0LnByb3RvdHlwZSwgXCJudW1iZXJPZkl0ZW1zXCIsIHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tQYXRoU3luY2hyb25pemVkVG9MaXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9saXN0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBBZGQgdGhlIHBhdGhTZWdMaXN0IGFjY2Vzc29ycyB0byBTVkdQYXRoRWxlbWVudC5cbiAgICAgICAgICAgIC8vIFNwZWM6IGh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL3NpbmdsZS1wYWdlLmh0bWwjcGF0aHMtSW50ZXJmYWNlU1ZHQW5pbWF0ZWRQYXRoRGF0YVxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhFbGVtZW50LnByb3RvdHlwZSwgXCJwYXRoU2VnTGlzdFwiLCB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcGF0aFNlZ0xpc3QpIHRoaXMuX3BhdGhTZWdMaXN0ID0gbmV3IFNWR1BhdGhTZWdMaXN0KHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGF0aFNlZ0xpc3Q7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIEZJWE1FOiBUaGUgZm9sbG93aW5nIGFyZSBub3QgaW1wbGVtZW50ZWQgYW5kIHNpbXBseSByZXR1cm4gU1ZHUGF0aEVsZW1lbnQucGF0aFNlZ0xpc3QuXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aEVsZW1lbnQucHJvdG90eXBlLCBcIm5vcm1hbGl6ZWRQYXRoU2VnTGlzdFwiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoU2VnTGlzdDtcbiAgICAgICAgICAgICAgICB9LCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNWR1BhdGhFbGVtZW50LnByb3RvdHlwZSwgXCJhbmltYXRlZFBhdGhTZWdMaXN0XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhdGhTZWdMaXN0O1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU1ZHUGF0aEVsZW1lbnQucHJvdG90eXBlLCBcImFuaW1hdGVkTm9ybWFsaXplZFBhdGhTZWdMaXN0XCIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhdGhTZWdMaXN0O1xuICAgICAgICAgICAgICAgIH0sIGVudW1lcmFibGU6IHRydWUgfSk7XG5cbiAgICAgICAgICAgIC8vIFByb2Nlc3MgYW55IHBlbmRpbmcgbXV0YXRpb25zIHRvIHRoZSBwYXRoIGVsZW1lbnQgYW5kIHVwZGF0ZSB0aGUgbGlzdCBhcyBuZWVkZWQuXG4gICAgICAgICAgICAvLyBUaGlzIHNob3VsZCBiZSB0aGUgZmlyc3QgY2FsbCBvZiBhbGwgcHVibGljIGZ1bmN0aW9ucyBhbmQgaXMgbmVlZGVkIGJlY2F1c2VcbiAgICAgICAgICAgIC8vIE11dGF0aW9uT2JzZXJ2ZXJzIGFyZSBub3Qgc3luY2hyb25vdXMgc28gd2UgY2FuIGhhdmUgcGVuZGluZyBhc3luY2hyb25vdXMgbXV0YXRpb25zLlxuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpc3QucHJvdG90eXBlLl9jaGVja1BhdGhTeW5jaHJvbml6ZWRUb0xpc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlTGlzdEZyb21QYXRoTXV0YXRpb25zKHRoaXMuX3BhdGhFbGVtZW50TXV0YXRpb25PYnNlcnZlci50YWtlUmVjb3JkcygpKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaXN0LnByb3RvdHlwZS5fdXBkYXRlTGlzdEZyb21QYXRoTXV0YXRpb25zID0gZnVuY3Rpb24gKG11dGF0aW9uUmVjb3Jkcykge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcGF0aEVsZW1lbnQpIHJldHVybjtcbiAgICAgICAgICAgICAgICB2YXIgaGFzUGF0aE11dGF0aW9ucyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG11dGF0aW9uUmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChyZWNvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZC5hdHRyaWJ1dGVOYW1lID09IFwiZFwiKSBoYXNQYXRoTXV0YXRpb25zID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoaGFzUGF0aE11dGF0aW9ucykgdGhpcy5fbGlzdCA9IHRoaXMuX3BhcnNlUGF0aCh0aGlzLl9wYXRoRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJkXCIpKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIFNlcmlhbGl6ZSB0aGUgbGlzdCBhbmQgdXBkYXRlIHRoZSBwYXRoJ3MgJ2QnIGF0dHJpYnV0ZS5cbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaXN0LnByb3RvdHlwZS5fd3JpdGVMaXN0VG9QYXRoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhdGhFbGVtZW50TXV0YXRpb25PYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGF0aEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZFwiLCBTVkdQYXRoU2VnTGlzdC5fcGF0aFNlZ0FycmF5QXNTdHJpbmcodGhpcy5fbGlzdCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3BhdGhFbGVtZW50TXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKHRoaXMuX3BhdGhFbGVtZW50LCB0aGlzLl9tdXRhdGlvbk9ic2VydmVyQ29uZmlnKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIFdoZW4gYSBwYXRoIHNlZ21lbnQgY2hhbmdlcyB0aGUgbGlzdCBuZWVkcyB0byBiZSBzeW5jaHJvbml6ZWQgYmFjayB0byB0aGUgcGF0aCBlbGVtZW50LlxuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpc3QucHJvdG90eXBlLnNlZ21lbnRDaGFuZ2VkID0gZnVuY3Rpb24gKHBhdGhTZWcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl93cml0ZUxpc3RUb1BhdGgoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaXN0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1BhdGhTeW5jaHJvbml6ZWRUb0xpc3QoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2xpc3QuZm9yRWFjaChmdW5jdGlvbiAocGF0aFNlZykge1xuICAgICAgICAgICAgICAgICAgICBwYXRoU2VnLl9vd25pbmdQYXRoU2VnTGlzdCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbGlzdCA9IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuX3dyaXRlTGlzdFRvUGF0aCgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpc3QucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAobmV3SXRlbSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrUGF0aFN5bmNocm9uaXplZFRvTGlzdCgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fbGlzdCA9IFtuZXdJdGVtXTtcbiAgICAgICAgICAgICAgICBuZXdJdGVtLl9vd25pbmdQYXRoU2VnTGlzdCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdGhpcy5fd3JpdGVMaXN0VG9QYXRoKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld0l0ZW07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBTVkdQYXRoU2VnTGlzdC5wcm90b3R5cGUuX2NoZWNrVmFsaWRJbmRleCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgICAgICAgIGlmIChpc05hTihpbmRleCkgfHwgaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMubnVtYmVyT2ZJdGVtcykgdGhyb3cgXCJJTkRFWF9TSVpFX0VSUlwiO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpc3QucHJvdG90eXBlLmdldEl0ZW0gPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1BhdGhTeW5jaHJvbml6ZWRUb0xpc3QoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrVmFsaWRJbmRleChpbmRleCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpc3RbaW5kZXhdO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgU1ZHUGF0aFNlZ0xpc3QucHJvdG90eXBlLmluc2VydEl0ZW1CZWZvcmUgPSBmdW5jdGlvbiAobmV3SXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1BhdGhTeW5jaHJvbml6ZWRUb0xpc3QoKTtcblxuICAgICAgICAgICAgICAgIC8vIFNwZWM6IElmIHRoZSBpbmRleCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gbnVtYmVyT2ZJdGVtcywgdGhlbiB0aGUgbmV3IGl0ZW0gaXMgYXBwZW5kZWQgdG8gdGhlIGVuZCBvZiB0aGUgbGlzdC5cbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiB0aGlzLm51bWJlck9mSXRlbXMpIGluZGV4ID0gdGhpcy5udW1iZXJPZkl0ZW1zO1xuICAgICAgICAgICAgICAgIGlmIChuZXdJdGVtLl9vd25pbmdQYXRoU2VnTGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTVkcyIHNwZWMgc2F5cyB0byBtYWtlIGEgY29weS5cbiAgICAgICAgICAgICAgICAgICAgbmV3SXRlbSA9IG5ld0l0ZW0uY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fbGlzdC5zcGxpY2UoaW5kZXgsIDAsIG5ld0l0ZW0pO1xuICAgICAgICAgICAgICAgIG5ld0l0ZW0uX293bmluZ1BhdGhTZWdMaXN0ID0gdGhpcztcbiAgICAgICAgICAgICAgICB0aGlzLl93cml0ZUxpc3RUb1BhdGgoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3SXRlbTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaXN0LnByb3RvdHlwZS5yZXBsYWNlSXRlbSA9IGZ1bmN0aW9uIChuZXdJdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrUGF0aFN5bmNocm9uaXplZFRvTGlzdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG5ld0l0ZW0uX293bmluZ1BhdGhTZWdMaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNWRzIgc3BlYyBzYXlzIHRvIG1ha2UgYSBjb3B5LlxuICAgICAgICAgICAgICAgICAgICBuZXdJdGVtID0gbmV3SXRlbS5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1ZhbGlkSW5kZXgoaW5kZXgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RbaW5kZXhdID0gbmV3SXRlbTtcbiAgICAgICAgICAgICAgICBuZXdJdGVtLl9vd25pbmdQYXRoU2VnTGlzdCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdGhpcy5fd3JpdGVMaXN0VG9QYXRoKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld0l0ZW07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBTVkdQYXRoU2VnTGlzdC5wcm90b3R5cGUucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrUGF0aFN5bmNocm9uaXplZFRvTGlzdCgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tWYWxpZEluZGV4KGluZGV4KTtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMuX2xpc3RbaW5kZXhdO1xuICAgICAgICAgICAgICAgIHRoaXMuX2xpc3Quc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB0aGlzLl93cml0ZUxpc3RUb1BhdGgoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFNWR1BhdGhTZWdMaXN0LnByb3RvdHlwZS5hcHBlbmRJdGVtID0gZnVuY3Rpb24gKG5ld0l0ZW0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1BhdGhTeW5jaHJvbml6ZWRUb0xpc3QoKTtcblxuICAgICAgICAgICAgICAgIGlmIChuZXdJdGVtLl9vd25pbmdQYXRoU2VnTGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTVkcyIHNwZWMgc2F5cyB0byBtYWtlIGEgY29weS5cbiAgICAgICAgICAgICAgICAgICAgbmV3SXRlbSA9IG5ld0l0ZW0uY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fbGlzdC5wdXNoKG5ld0l0ZW0pO1xuICAgICAgICAgICAgICAgIG5ld0l0ZW0uX293bmluZ1BhdGhTZWdMaXN0ID0gdGhpcztcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBPcHRpbWl6ZSB0aGlzIHRvIGp1c3QgYXBwZW5kIHRvIHRoZSBleGlzdGluZyBhdHRyaWJ1dGUuXG4gICAgICAgICAgICAgICAgdGhpcy5fd3JpdGVMaXN0VG9QYXRoKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld0l0ZW07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBTVkdQYXRoU2VnTGlzdC5fcGF0aFNlZ0FycmF5QXNTdHJpbmcgPSBmdW5jdGlvbiAocGF0aFNlZ0FycmF5KSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0cmluZyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgdmFyIGZpcnN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBwYXRoU2VnQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAocGF0aFNlZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0gcGF0aFNlZy5fYXNQYXRoU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0gXCIgXCIgKyBwYXRoU2VnLl9hc1BhdGhTdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmc7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBUaGlzIGNsb3NlbHkgZm9sbG93cyBTVkdQYXRoUGFyc2VyOjpwYXJzZVBhdGggZnJvbSBTb3VyY2UvY29yZS9zdmcvU1ZHUGF0aFBhcnNlci5jcHAuXG4gICAgICAgICAgICBTVkdQYXRoU2VnTGlzdC5wcm90b3R5cGUuX3BhcnNlUGF0aCA9IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXN0cmluZyB8fCBzdHJpbmcubGVuZ3RoID09IDApIHJldHVybiBbXTtcblxuICAgICAgICAgICAgICAgIHZhciBvd25pbmdQYXRoU2VnTGlzdCA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICB2YXIgQnVpbGRlciA9IGZ1bmN0aW9uIEJ1aWxkZXIoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGF0aFNlZ0xpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgQnVpbGRlci5wcm90b3R5cGUuYXBwZW5kU2VnbWVudCA9IGZ1bmN0aW9uIChwYXRoU2VnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGF0aFNlZ0xpc3QucHVzaChwYXRoU2VnKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIFNvdXJjZSA9IGZ1bmN0aW9uIFNvdXJjZShzdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RyaW5nID0gc3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50SW5kZXggPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbmRJbmRleCA9IHRoaXMuX3N0cmluZy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByZXZpb3VzQ29tbWFuZCA9IFNWR1BhdGhTZWcuUEFUSFNFR19VTktOT1dOO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NraXBPcHRpb25hbFNwYWNlcygpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBTb3VyY2UucHJvdG90eXBlLl9pc0N1cnJlbnRTcGFjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoYXJhY3RlciA9IHRoaXMuX3N0cmluZ1t0aGlzLl9jdXJyZW50SW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hhcmFjdGVyIDw9IFwiIFwiICYmIChjaGFyYWN0ZXIgPT0gXCIgXCIgfHwgY2hhcmFjdGVyID09IFwiXFxuXCIgfHwgY2hhcmFjdGVyID09IFwiXFx0XCIgfHwgY2hhcmFjdGVyID09IFwiXFxyXCIgfHwgY2hhcmFjdGVyID09IFwiXFxmXCIpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBTb3VyY2UucHJvdG90eXBlLl9za2lwT3B0aW9uYWxTcGFjZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLl9jdXJyZW50SW5kZXggPCB0aGlzLl9lbmRJbmRleCAmJiB0aGlzLl9pc0N1cnJlbnRTcGFjZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgfXJldHVybiB0aGlzLl9jdXJyZW50SW5kZXggPCB0aGlzLl9lbmRJbmRleDtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgU291cmNlLnByb3RvdHlwZS5fc2tpcE9wdGlvbmFsU3BhY2VzT3JEZWxpbWl0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50SW5kZXggPCB0aGlzLl9lbmRJbmRleCAmJiAhdGhpcy5faXNDdXJyZW50U3BhY2UoKSAmJiB0aGlzLl9zdHJpbmcuY2hhckF0KHRoaXMuX2N1cnJlbnRJbmRleCkgIT0gXCIsXCIpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NraXBPcHRpb25hbFNwYWNlcygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudEluZGV4IDwgdGhpcy5fZW5kSW5kZXggJiYgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXgpID09IFwiLFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2tpcE9wdGlvbmFsU3BhY2VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRJbmRleCA8IHRoaXMuX2VuZEluZGV4O1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBTb3VyY2UucHJvdG90eXBlLmhhc01vcmVEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEluZGV4IDwgdGhpcy5fZW5kSW5kZXg7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIFNvdXJjZS5wcm90b3R5cGUucGVla1NlZ21lbnRUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbG9va2FoZWFkID0gdGhpcy5fc3RyaW5nW3RoaXMuX2N1cnJlbnRJbmRleF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXRoU2VnVHlwZUZyb21DaGFyKGxvb2thaGVhZCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIFNvdXJjZS5wcm90b3R5cGUuX3BhdGhTZWdUeXBlRnJvbUNoYXIgPSBmdW5jdGlvbiAobG9va2FoZWFkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobG9va2FoZWFkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiWlwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInpcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX0NMT1NFUEFUSDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJNXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR1BhdGhTZWcuUEFUSFNFR19NT1ZFVE9fQUJTO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1cIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX01PVkVUT19SRUw7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTVkdQYXRoU2VnLlBBVEhTRUdfTElORVRPX0FCUztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJsXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fUkVMO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfQUJTO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfUkVMO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlFcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fUVVBRFJBVElDX0FCUztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJxXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19SRUw7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTVkdQYXRoU2VnLlBBVEhTRUdfQVJDX0FCUztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR1BhdGhTZWcuUEFUSFNFR19BUkNfUkVMO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkhcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX0xJTkVUT19IT1JJWk9OVEFMX0FCUztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJoXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fSE9SSVpPTlRBTF9SRUw7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVlwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTVkdQYXRoU2VnLlBBVEhTRUdfTElORVRPX1ZFUlRJQ0FMX0FCUztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ2XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fVkVSVElDQUxfUkVMO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfU01PT1RIX0FCUztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX0NVQklDX1NNT09USF9SRUw7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTVkdQYXRoU2VnLlBBVEhTRUdfQ1VSVkVUT19RVUFEUkFUSUNfU01PT1RIX0FCUztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJ0XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19TTU9PVEhfUkVMO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX1VOS05PV047XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgU291cmNlLnByb3RvdHlwZS5fbmV4dENvbW1hbmRIZWxwZXIgPSBmdW5jdGlvbiAobG9va2FoZWFkLCBwcmV2aW91c0NvbW1hbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHJlbWFpbmluZyBjb29yZGluYXRlcyBpbiB0aGUgY3VycmVudCBjb21tYW5kLlxuICAgICAgICAgICAgICAgICAgICBpZiAoKGxvb2thaGVhZCA9PSBcIitcIiB8fCBsb29rYWhlYWQgPT0gXCItXCIgfHwgbG9va2FoZWFkID09IFwiLlwiIHx8IGxvb2thaGVhZCA+PSBcIjBcIiAmJiBsb29rYWhlYWQgPD0gXCI5XCIpICYmIHByZXZpb3VzQ29tbWFuZCAhPSBTVkdQYXRoU2VnLlBBVEhTRUdfQ0xPU0VQQVRIKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNDb21tYW5kID09IFNWR1BhdGhTZWcuUEFUSFNFR19NT1ZFVE9fQUJTKSByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX0xJTkVUT19BQlM7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNDb21tYW5kID09IFNWR1BhdGhTZWcuUEFUSFNFR19NT1ZFVE9fUkVMKSByZXR1cm4gU1ZHUGF0aFNlZy5QQVRIU0VHX0xJTkVUT19SRUw7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJldmlvdXNDb21tYW5kO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTVkdQYXRoU2VnLlBBVEhTRUdfVU5LTk9XTjtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgU291cmNlLnByb3RvdHlwZS5pbml0aWFsQ29tbWFuZElzTW92ZVRvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcGF0aCBpcyBlbXB0eSBpdCBpcyBzdGlsbCB2YWxpZCwgc28gcmV0dXJuIHRydWUuXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5oYXNNb3JlRGF0YSgpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1hbmQgPSB0aGlzLnBlZWtTZWdtZW50VHlwZSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBQYXRoIG11c3Qgc3RhcnQgd2l0aCBtb3ZlVG8uXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21tYW5kID09IFNWR1BhdGhTZWcuUEFUSFNFR19NT1ZFVE9fQUJTIHx8IGNvbW1hbmQgPT0gU1ZHUGF0aFNlZy5QQVRIU0VHX01PVkVUT19SRUw7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIFBhcnNlIGEgbnVtYmVyIGZyb20gYW4gU1ZHIHBhdGguIFRoaXMgdmVyeSBjbG9zZWx5IGZvbGxvd3MgZ2VuZXJpY1BhcnNlTnVtYmVyKC4uLikgZnJvbSBTb3VyY2UvY29yZS9zdmcvU1ZHUGFyc2VyVXRpbGl0aWVzLmNwcC5cbiAgICAgICAgICAgICAgICAvLyBTcGVjOiBodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9zaW5nbGUtcGFnZS5odG1sI3BhdGhzLVBhdGhEYXRhQk5GXG4gICAgICAgICAgICAgICAgU291cmNlLnByb3RvdHlwZS5fcGFyc2VOdW1iZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBleHBvbmVudCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnRlZ2VyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZyYWMgPSAxO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGVjaW1hbCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzaWduID0gMTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cHNpZ24gPSAxO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydEluZGV4ID0gdGhpcy5fY3VycmVudEluZGV4O1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NraXBPcHRpb25hbFNwYWNlcygpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlYWQgdGhlIHNpZ24uXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50SW5kZXggPCB0aGlzLl9lbmRJbmRleCAmJiB0aGlzLl9zdHJpbmcuY2hhckF0KHRoaXMuX2N1cnJlbnRJbmRleCkgPT0gXCIrXCIpIHRoaXMuX2N1cnJlbnRJbmRleCsrO2Vsc2UgaWYgKHRoaXMuX2N1cnJlbnRJbmRleCA8IHRoaXMuX2VuZEluZGV4ICYmIHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KSA9PSBcIi1cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWduID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudEluZGV4ID09IHRoaXMuX2VuZEluZGV4IHx8ICh0aGlzLl9zdHJpbmcuY2hhckF0KHRoaXMuX2N1cnJlbnRJbmRleCkgPCBcIjBcIiB8fCB0aGlzLl9zdHJpbmcuY2hhckF0KHRoaXMuX2N1cnJlbnRJbmRleCkgPiBcIjlcIikgJiYgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXgpICE9IFwiLlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGZpcnN0IGNoYXJhY3RlciBvZiBhIG51bWJlciBtdXN0IGJlIG9uZSBvZiBbMC05Ky0uXS5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCB0aGUgaW50ZWdlciBwYXJ0LCBidWlsZCByaWdodC10by1sZWZ0LlxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRJbnRQYXJ0SW5kZXggPSB0aGlzLl9jdXJyZW50SW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLl9jdXJyZW50SW5kZXggPCB0aGlzLl9lbmRJbmRleCAmJiB0aGlzLl9zdHJpbmcuY2hhckF0KHRoaXMuX2N1cnJlbnRJbmRleCkgPj0gXCIwXCIgJiYgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXgpIDw9IFwiOVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgfSAvLyBBZHZhbmNlIHRvIGZpcnN0IG5vbi1kaWdpdC5cblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudEluZGV4ICE9IHN0YXJ0SW50UGFydEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2NhbkludFBhcnRJbmRleCA9IHRoaXMuX2N1cnJlbnRJbmRleCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXVsdGlwbGllciA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc2NhbkludFBhcnRJbmRleCA+PSBzdGFydEludFBhcnRJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVnZXIgKz0gbXVsdGlwbGllciAqICh0aGlzLl9zdHJpbmcuY2hhckF0KHNjYW5JbnRQYXJ0SW5kZXgtLSkgLSBcIjBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGllciAqPSAxMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlYWQgdGhlIGRlY2ltYWxzLlxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudEluZGV4IDwgdGhpcy5fZW5kSW5kZXggJiYgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXgpID09IFwiLlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50SW5kZXgrKztcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgbXVzdCBiZSBhIGxlYXN0IG9uZSBkaWdpdCBmb2xsb3dpbmcgdGhlIC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50SW5kZXggPj0gdGhpcy5fZW5kSW5kZXggfHwgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXgpIDwgXCIwXCIgfHwgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXgpID4gXCI5XCIpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAodGhpcy5fY3VycmVudEluZGV4IDwgdGhpcy5fZW5kSW5kZXggJiYgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXgpID49IFwiMFwiICYmIHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KSA8PSBcIjlcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2ltYWwgKz0gKHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KyspIC0gXCIwXCIpICogKGZyYWMgKj0gMC4xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlYWQgdGhlIGV4cG9uZW50IHBhcnQuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50SW5kZXggIT0gc3RhcnRJbmRleCAmJiB0aGlzLl9jdXJyZW50SW5kZXggKyAxIDwgdGhpcy5fZW5kSW5kZXggJiYgKHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KSA9PSBcImVcIiB8fCB0aGlzLl9zdHJpbmcuY2hhckF0KHRoaXMuX2N1cnJlbnRJbmRleCkgPT0gXCJFXCIpICYmIHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4ICsgMSkgIT0gXCJ4XCIgJiYgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXggKyAxKSAhPSBcIm1cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEluZGV4Kys7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlYWQgdGhlIHNpZ24gb2YgdGhlIGV4cG9uZW50LlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KSA9PSBcIitcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9zdHJpbmcuY2hhckF0KHRoaXMuX2N1cnJlbnRJbmRleCkgPT0gXCItXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBzaWduID0gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZXJlIG11c3QgYmUgYW4gZXhwb25lbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudEluZGV4ID49IHRoaXMuX2VuZEluZGV4IHx8IHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KSA8IFwiMFwiIHx8IHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KSA+IFwiOVwiKSByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAodGhpcy5fY3VycmVudEluZGV4IDwgdGhpcy5fZW5kSW5kZXggJiYgdGhpcy5fc3RyaW5nLmNoYXJBdCh0aGlzLl9jdXJyZW50SW5kZXgpID49IFwiMFwiICYmIHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KSA8PSBcIjlcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9uZW50ICo9IDEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9uZW50ICs9IHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KSAtIFwiMFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG51bWJlciA9IGludGVnZXIgKyBkZWNpbWFsO1xuICAgICAgICAgICAgICAgICAgICBudW1iZXIgKj0gc2lnbjtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhwb25lbnQpIG51bWJlciAqPSBNYXRoLnBvdygxMCwgZXhwc2lnbiAqIGV4cG9uZW50KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnRJbmRleCA9PSB0aGlzLl9jdXJyZW50SW5kZXgpIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2tpcE9wdGlvbmFsU3BhY2VzT3JEZWxpbWl0ZXIoKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBTb3VyY2UucHJvdG90eXBlLl9wYXJzZUFyY0ZsYWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50SW5kZXggPj0gdGhpcy5fZW5kSW5kZXgpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmbGFnID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmbGFnQ2hhciA9IHRoaXMuX3N0cmluZy5jaGFyQXQodGhpcy5fY3VycmVudEluZGV4KyspO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZ0NoYXIgPT0gXCIwXCIpIGZsYWcgPSBmYWxzZTtlbHNlIGlmIChmbGFnQ2hhciA9PSBcIjFcIikgZmxhZyA9IHRydWU7ZWxzZSByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NraXBPcHRpb25hbFNwYWNlc09yRGVsaW1pdGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmbGFnO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBTb3VyY2UucHJvdG90eXBlLnBhcnNlU2VnbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxvb2thaGVhZCA9IHRoaXMuX3N0cmluZ1t0aGlzLl9jdXJyZW50SW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29tbWFuZCA9IHRoaXMuX3BhdGhTZWdUeXBlRnJvbUNoYXIobG9va2FoZWFkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbW1hbmQgPT0gU1ZHUGF0aFNlZy5QQVRIU0VHX1VOS05PV04pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBvc3NpYmx5IGFuIGltcGxpY2l0IGNvbW1hbmQuIE5vdCBhbGxvd2VkIGlmIHRoaXMgaXMgdGhlIGZpcnN0IGNvbW1hbmQuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcHJldmlvdXNDb21tYW5kID09IFNWR1BhdGhTZWcuUEFUSFNFR19VTktOT1dOKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSB0aGlzLl9uZXh0Q29tbWFuZEhlbHBlcihsb29rYWhlYWQsIHRoaXMuX3ByZXZpb3VzQ29tbWFuZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tbWFuZCA9PSBTVkdQYXRoU2VnLlBBVEhTRUdfVU5LTk9XTikgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByZXZpb3VzQ29tbWFuZCA9IGNvbW1hbmQ7XG5cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjb21tYW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19NT1ZFVE9fUkVMOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ01vdmV0b1JlbChvd25pbmdQYXRoU2VnTGlzdCwgdGhpcy5fcGFyc2VOdW1iZXIoKSwgdGhpcy5fcGFyc2VOdW1iZXIoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19NT1ZFVE9fQUJTOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ01vdmV0b0Ficyhvd25pbmdQYXRoU2VnTGlzdCwgdGhpcy5fcGFyc2VOdW1iZXIoKSwgdGhpcy5fcGFyc2VOdW1iZXIoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fUkVMOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b1JlbChvd25pbmdQYXRoU2VnTGlzdCwgdGhpcy5fcGFyc2VOdW1iZXIoKSwgdGhpcy5fcGFyc2VOdW1iZXIoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fQUJTOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b0Ficyhvd25pbmdQYXRoU2VnTGlzdCwgdGhpcy5fcGFyc2VOdW1iZXIoKSwgdGhpcy5fcGFyc2VOdW1iZXIoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fSE9SSVpPTlRBTF9SRUw6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnTGluZXRvSG9yaXpvbnRhbFJlbChvd25pbmdQYXRoU2VnTGlzdCwgdGhpcy5fcGFyc2VOdW1iZXIoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fSE9SSVpPTlRBTF9BQlM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnTGluZXRvSG9yaXpvbnRhbEFicyhvd25pbmdQYXRoU2VnTGlzdCwgdGhpcy5fcGFyc2VOdW1iZXIoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19MSU5FVE9fVkVSVElDQUxfUkVMOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0xpbmV0b1ZlcnRpY2FsUmVsKG93bmluZ1BhdGhTZWdMaXN0LCB0aGlzLl9wYXJzZU51bWJlcigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgU1ZHUGF0aFNlZy5QQVRIU0VHX0xJTkVUT19WRVJUSUNBTF9BQlM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnTGluZXRvVmVydGljYWxBYnMob3duaW5nUGF0aFNlZ0xpc3QsIHRoaXMuX3BhcnNlTnVtYmVyKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTVkdQYXRoU2VnLlBBVEhTRUdfQ0xPU0VQQVRIOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NraXBPcHRpb25hbFNwYWNlcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0Nsb3NlUGF0aChvd25pbmdQYXRoU2VnTGlzdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX0NVQklDX1JFTDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzID0geyB4MTogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeTE6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHgyOiB0aGlzLl9wYXJzZU51bWJlcigpLCB5MjogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeDogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeTogdGhpcy5fcGFyc2VOdW1iZXIoKSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1JlbChvd25pbmdQYXRoU2VnTGlzdCwgcG9pbnRzLngsIHBvaW50cy55LCBwb2ludHMueDEsIHBvaW50cy55MSwgcG9pbnRzLngyLCBwb2ludHMueTIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTVkdQYXRoU2VnLlBBVEhTRUdfQ1VSVkVUT19DVUJJQ19BQlM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50cyA9IHsgeDE6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHkxOiB0aGlzLl9wYXJzZU51bWJlcigpLCB4MjogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeTI6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHg6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHk6IHRoaXMuX3BhcnNlTnVtYmVyKCkgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNBYnMob3duaW5nUGF0aFNlZ0xpc3QsIHBvaW50cy54LCBwb2ludHMueSwgcG9pbnRzLngxLCBwb2ludHMueTEsIHBvaW50cy54MiwgcG9pbnRzLnkyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgU1ZHUGF0aFNlZy5QQVRIU0VHX0NVUlZFVE9fQ1VCSUNfU01PT1RIX1JFTDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzID0geyB4MjogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeTI6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHg6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHk6IHRoaXMuX3BhcnNlTnVtYmVyKCkgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvQ3ViaWNTbW9vdGhSZWwob3duaW5nUGF0aFNlZ0xpc3QsIHBvaW50cy54LCBwb2ludHMueSwgcG9pbnRzLngyLCBwb2ludHMueTIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTVkdQYXRoU2VnLlBBVEhTRUdfQ1VSVkVUT19DVUJJQ19TTU9PVEhfQUJTOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSB7IHgyOiB0aGlzLl9wYXJzZU51bWJlcigpLCB5MjogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeDogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeTogdGhpcy5fcGFyc2VOdW1iZXIoKSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0N1cnZldG9DdWJpY1Ntb290aEFicyhvd25pbmdQYXRoU2VnTGlzdCwgcG9pbnRzLngsIHBvaW50cy55LCBwb2ludHMueDIsIHBvaW50cy55Mik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19SRUw6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50cyA9IHsgeDE6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHkxOiB0aGlzLl9wYXJzZU51bWJlcigpLCB4OiB0aGlzLl9wYXJzZU51bWJlcigpLCB5OiB0aGlzLl9wYXJzZU51bWJlcigpIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY1JlbChvd25pbmdQYXRoU2VnTGlzdCwgcG9pbnRzLngsIHBvaW50cy55LCBwb2ludHMueDEsIHBvaW50cy55MSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19BQlM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50cyA9IHsgeDE6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHkxOiB0aGlzLl9wYXJzZU51bWJlcigpLCB4OiB0aGlzLl9wYXJzZU51bWJlcigpLCB5OiB0aGlzLl9wYXJzZU51bWJlcigpIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTVkdQYXRoU2VnQ3VydmV0b1F1YWRyYXRpY0Ficyhvd25pbmdQYXRoU2VnTGlzdCwgcG9pbnRzLngsIHBvaW50cy55LCBwb2ludHMueDEsIHBvaW50cy55MSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNWR1BhdGhTZWcuUEFUSFNFR19DVVJWRVRPX1FVQURSQVRJQ19TTU9PVEhfUkVMOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0N1cnZldG9RdWFkcmF0aWNTbW9vdGhSZWwob3duaW5nUGF0aFNlZ0xpc3QsIHRoaXMuX3BhcnNlTnVtYmVyKCksIHRoaXMuX3BhcnNlTnVtYmVyKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTVkdQYXRoU2VnLlBBVEhTRUdfQ1VSVkVUT19RVUFEUkFUSUNfU01PT1RIX0FCUzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdDdXJ2ZXRvUXVhZHJhdGljU21vb3RoQWJzKG93bmluZ1BhdGhTZWdMaXN0LCB0aGlzLl9wYXJzZU51bWJlcigpLCB0aGlzLl9wYXJzZU51bWJlcigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgU1ZHUGF0aFNlZy5QQVRIU0VHX0FSQ19SRUw6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50cyA9IHsgeDE6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHkxOiB0aGlzLl9wYXJzZU51bWJlcigpLCBhcmNBbmdsZTogdGhpcy5fcGFyc2VOdW1iZXIoKSwgYXJjTGFyZ2U6IHRoaXMuX3BhcnNlQXJjRmxhZygpLCBhcmNTd2VlcDogdGhpcy5fcGFyc2VBcmNGbGFnKCksIHg6IHRoaXMuX3BhcnNlTnVtYmVyKCksIHk6IHRoaXMuX3BhcnNlTnVtYmVyKCkgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNWR1BhdGhTZWdBcmNSZWwob3duaW5nUGF0aFNlZ0xpc3QsIHBvaW50cy54LCBwb2ludHMueSwgcG9pbnRzLngxLCBwb2ludHMueTEsIHBvaW50cy5hcmNBbmdsZSwgcG9pbnRzLmFyY0xhcmdlLCBwb2ludHMuYXJjU3dlZXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTVkdQYXRoU2VnLlBBVEhTRUdfQVJDX0FCUzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzID0geyB4MTogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeTE6IHRoaXMuX3BhcnNlTnVtYmVyKCksIGFyY0FuZ2xlOiB0aGlzLl9wYXJzZU51bWJlcigpLCBhcmNMYXJnZTogdGhpcy5fcGFyc2VBcmNGbGFnKCksIGFyY1N3ZWVwOiB0aGlzLl9wYXJzZUFyY0ZsYWcoKSwgeDogdGhpcy5fcGFyc2VOdW1iZXIoKSwgeTogdGhpcy5fcGFyc2VOdW1iZXIoKSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU1ZHUGF0aFNlZ0FyY0Ficyhvd25pbmdQYXRoU2VnTGlzdCwgcG9pbnRzLngsIHBvaW50cy55LCBwb2ludHMueDEsIHBvaW50cy55MSwgcG9pbnRzLmFyY0FuZ2xlLCBwb2ludHMuYXJjTGFyZ2UsIHBvaW50cy5hcmNTd2VlcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFwiVW5rbm93biBwYXRoIHNlZyB0eXBlLlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBidWlsZGVyID0gbmV3IEJ1aWxkZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gbmV3IFNvdXJjZShzdHJpbmcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFzb3VyY2UuaW5pdGlhbENvbW1hbmRJc01vdmVUbygpKSByZXR1cm4gW107XG4gICAgICAgICAgICAgICAgd2hpbGUgKHNvdXJjZS5oYXNNb3JlRGF0YSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXRoU2VnID0gc291cmNlLnBhcnNlU2VnbWVudCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXBhdGhTZWcpIHJldHVybiBbXTtcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5hcHBlbmRTZWdtZW50KHBhdGhTZWcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyLnBhdGhTZWdMaXN0O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0pKCk7XG5cbiAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoXCJjM1wiLCBbXCJkM1wiXSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGMzO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKCd1bmRlZmluZWQnICE9PSB0eXBlb2YgZXhwb3J0cyAmJiAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIG1vZHVsZSkge1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGMzO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHdpbmRvdy5jMyA9IGMzO1xuICAgIH1cbn0pKHdpbmRvdyk7IiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cbi8qXHJcbiAqIGpRdWVyeSBsaU1hcnF1ZWUgdiA0LjZcclxuICpcclxuICogQ29weXJpZ2h0IDIwMTMsIExpbm5payBZdXJhIHwgTEkgTUFTUyBDT0RFIHwgaHR0cDovL21hc3Njb2RlLnJ1XHJcbiAqIGh0dHA6Ly9tYXNzY29kZS5ydS9pbmRleC5waHAvazIvaXRlbS80NC1saW1hcnF1ZWVcclxuICogRnJlZSB0byB1c2VcclxuICpcclxuICogTGFzdCBVcGRhdGUgMjAuMTEuMjAxNFxyXG4gKi9cbihmdW5jdGlvbiAoJCkge1xuXHR2YXIgbWV0aG9kcyA9IHtcblx0XHRpbml0OiBmdW5jdGlvbiBpbml0KG9wdGlvbnMpIHtcblx0XHRcdHZhciBwID0ge1xuXHRcdFx0XHRkaXJlY3Rpb246ICdsZWZ0JywgLy/Qo9C60LDQt9GL0LLQsNC10YIg0L3QsNC/0YDQsNCy0LvQtdC90LjQtSDQtNCy0LjQttC10L3QuNGPINGB0L7QtNC10YDQttC40LzQvtCz0L4g0LrQvtC90YLQtdC50L3QtdGA0LAgKGxlZnQgfCByaWdodCB8IHVwIHwgZG93bilcblx0XHRcdFx0bG9vcDogLTEsIC8v0JfQsNC00LDQtdGCLCDRgdC60L7Qu9GM0LrQviDRgNCw0Lcg0LHRg9C00LXRgiDQv9GA0L7QutGA0YPRh9C40LLQsNGC0YzRgdGPINGB0L7QtNC10YDQttC40LzQvtC1LiBcIi0xXCIg0LTQu9GPINCx0LXRgdC60L7QvdC10YfQvdC+0LPQviDQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40Y8g0LTQstC40LbQtdC90LjRj1xuXHRcdFx0XHRzY3JvbGxkZWxheTogMCwgLy/QktC10LvQuNGH0LjQvdCwINC30LDQtNC10YDQttC60Lgg0LIg0LzQuNC70LvQuNGB0LXQutGD0L3QtNCw0YUg0LzQtdC20LTRgyDQtNCy0LjQttC10L3QuNGP0LzQuFxuXHRcdFx0XHRzY3JvbGxhbW91bnQ6IDUwLCAvL9Ch0LrQvtGA0L7RgdGC0Ywg0LTQstC40LbQtdC90LjRjyDQutC+0L3RgtC10L3RgtCwIChweC9zZWMpXG5cdFx0XHRcdGNpcmN1bGFyOiB0cnVlLCAvL9CV0YHQu9C4IFwidHJ1ZVwiIC0g0YHRgtGA0L7QutCwINC90LXQv9GA0LXRgNGL0LLQvdCw0Y8gXG5cdFx0XHRcdGRyYWc6IHRydWUsIC8v0JXRgdC70LggXCJ0cnVlXCIgLSDQstC60LvRjtGH0LXQvdC+INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40LUg0YHRgtGA0L7QutC4XG5cdFx0XHRcdHJ1bnNob3J0OiB0cnVlLCAvL9CV0YHQu9C4IFwidHJ1ZVwiIC0g0LrQvtGA0L7RgtC60LDRjyDRgdGC0YDQvtC60LAg0YLQvtC20LUgXCLQsdC10LPQsNC10YJcIiwgXCJmYWxzZVwiIC0g0YHRgtC+0LjRgiDQvdCwINC80LXRgdGC0LVcblx0XHRcdFx0aG92ZXJzdG9wOiB0cnVlLCAvL3RydWUgLSDRgdGC0YDQvtC60LAg0L7RgdGC0LDQvdCw0LLQu9C40LLQsNC10YLRgdGPINC/0YDQuCDQvdCw0LLQtdC00LXQvdC40Lgg0LrRg9GA0YHQvtGA0LAg0LzRi9GI0LgsIGZhbHNlIC0g0YHRgtGA0L7QutCwINC90LUg0L7RgdGC0LDQvdCw0LLQu9C40LLQsNC10YLRgdGPXG5cdFx0XHRcdGludmVydGhvdmVyOiBmYWxzZSwgLy9mYWxzZSAtINGB0YLQsNC90LTQsNGA0YLQvdC+0LUg0L/QvtCy0LXQtNC10L3QuNC1LiDQldGB0LvQuCBcInRydWVcIiAtINGB0YLRgNC+0LrQsCDQvdCw0YfQuNC90LDQtdGCINC00LLQuNC20LXQvdC40LUg0YLQvtC70YzQutC+INC/0YDQuCDQvdCw0LLQtdC00LXQvdC40Lgg0LrRg9GA0YHQvtGA0LBcblx0XHRcdFx0eG1sOiBmYWxzZSAvL9Cf0YPRgtGMINC6IHhtbCDRhNCw0LnQu9GDINGBINC90YPQttC90YvQvCDRgtC10LrRgdGC0L7QvFxuXHRcdFx0fTtcblx0XHRcdGlmIChvcHRpb25zKSB7XG5cdFx0XHRcdCQuZXh0ZW5kKHAsIG9wdGlvbnMpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0dmFyIGVudGVyRXZlbnQgPSAnbW91c2VlbnRlcic7XG5cdFx0XHRcdHZhciBsZWF2ZUV2ZW50ID0gJ21vdXNlbGVhdmUnO1xuXHRcdFx0XHRpZiAocC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdGVudGVyRXZlbnQgPSAnbW91c2VsZWF2ZSc7XG5cdFx0XHRcdFx0bGVhdmVFdmVudCA9ICdtb3VzZWVudGVyJztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBsb29wID0gcC5sb29wLFxuXHRcdFx0XHQgICAgc3RyV3JhcCA9ICQodGhpcykuYWRkQ2xhc3MoJ3N0cl93cmFwJykuZGF0YSh7IHNjcm9sbGFtb3VudDogcC5zY3JvbGxhbW91bnQgfSksXG5cdFx0XHRcdCAgICBmTW92ZSA9IGZhbHNlO1xuXG5cdFx0XHRcdHZhciBzdHJXcmFwU3R5bGUgPSBzdHJXcmFwLmF0dHIoJ3N0eWxlJyk7XG5cblx0XHRcdFx0aWYgKHN0cldyYXBTdHlsZSkge1xuXHRcdFx0XHRcdHZhciB3cmFwU3R5bGVBcnIgPSBzdHJXcmFwU3R5bGUuc3BsaXQoJzsnKTtcblx0XHRcdFx0XHR2YXIgc3RhcnRIZWlnaHQgPSBmYWxzZTtcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHdyYXBTdHlsZUFyci5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdFx0dmFyIHN0ciA9ICQudHJpbSh3cmFwU3R5bGVBcnJbaV0pO1xuXHRcdFx0XHRcdFx0dmFyIHRlc3RlZCA9IHN0ci5zZWFyY2goL15oZWlnaHQvZyk7XG5cdFx0XHRcdFx0XHRpZiAodGVzdGVkICE9IC0xKSB7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0SGVpZ2h0ID0gcGFyc2VGbG9hdChzdHJXcmFwLmNzcygnaGVpZ2h0JykpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBjb2RlID0gZnVuY3Rpb24gY29kZSgpIHtcblxuXHRcdFx0XHRcdHN0cldyYXAub2ZmKCdtb3VzZWxlYXZlJyk7XG5cdFx0XHRcdFx0c3RyV3JhcC5vZmYoJ21vdXNlZW50ZXInKTtcblx0XHRcdFx0XHRzdHJXcmFwLm9mZignbW91c2Vtb3ZlJyk7XG5cdFx0XHRcdFx0c3RyV3JhcC5vZmYoJ21vdXNlZG93bicpO1xuXHRcdFx0XHRcdHN0cldyYXAub2ZmKCdtb3VzZXVwJyk7XG5cblx0XHRcdFx0XHRpZiAoISQoJy5zdHJfbW92ZScsIHN0cldyYXApLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0c3RyV3JhcC53cmFwSW5uZXIoJCgnPGRpdj4nKS5hZGRDbGFzcygnc3RyX21vdmUnKSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dmFyIHN0ck1vdmUgPSAkKCcuc3RyX21vdmUnLCBzdHJXcmFwKS5hZGRDbGFzcygnc3RyX29yaWdpbicpLFxuXHRcdFx0XHRcdCAgICBzdHJNb3ZlQ2xvbmUgPSBzdHJNb3ZlLmNsb25lKCkucmVtb3ZlQ2xhc3MoJ3N0cl9vcmlnaW4nKS5hZGRDbGFzcygnc3RyX21vdmVfY2xvbmUnKSxcblx0XHRcdFx0XHQgICAgdGltZSA9IDA7XG5cblx0XHRcdFx0XHRpZiAoIXAuaG92ZXJzdG9wKSB7XG5cdFx0XHRcdFx0XHRzdHJXcmFwLmFkZENsYXNzKCdub1N0b3AnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR2YXIgY2lyY0Nsb25lSG9yID0gZnVuY3Rpb24gY2lyY0Nsb25lSG9yKCkge1xuXHRcdFx0XHRcdFx0c3RyTW92ZUNsb25lLmNsb25lKCkuY3NzKHtcblx0XHRcdFx0XHRcdFx0bGVmdDogJzEwMCUnLFxuXHRcdFx0XHRcdFx0XHRyaWdodDogJ2F1dG8nLFxuXHRcdFx0XHRcdFx0XHR3aWR0aDogc3RyTW92ZS53aWR0aCgpXG5cdFx0XHRcdFx0XHR9KS5hcHBlbmRUbyhzdHJNb3ZlKTtcblx0XHRcdFx0XHRcdHN0ck1vdmVDbG9uZS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRyaWdodDogJzEwMCUnLFxuXHRcdFx0XHRcdFx0XHRsZWZ0OiAnYXV0bycsXG5cdFx0XHRcdFx0XHRcdHdpZHRoOiBzdHJNb3ZlLndpZHRoKClcblx0XHRcdFx0XHRcdH0pLmFwcGVuZFRvKHN0ck1vdmUpO1xuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHR2YXIgY2lyY0Nsb25lVmVydCA9IGZ1bmN0aW9uIGNpcmNDbG9uZVZlcnQoKSB7XG5cdFx0XHRcdFx0XHRzdHJNb3ZlQ2xvbmUuY2xvbmUoKS5jc3Moe1xuXHRcdFx0XHRcdFx0XHR0b3A6ICcxMDAlJyxcblx0XHRcdFx0XHRcdFx0Ym90dG9tOiAnYXV0bycsXG5cdFx0XHRcdFx0XHRcdGhlaWdodDogc3RyTW92ZS5oZWlnaHQoKVxuXHRcdFx0XHRcdFx0fSkuYXBwZW5kVG8oc3RyTW92ZSk7XG5cdFx0XHRcdFx0XHRzdHJNb3ZlQ2xvbmUuY3NzKHtcblx0XHRcdFx0XHRcdFx0Ym90dG9tOiAnMTAwJScsXG5cdFx0XHRcdFx0XHRcdHRvcDogJ2F1dG8nLFxuXHRcdFx0XHRcdFx0XHRoZWlnaHQ6IHN0ck1vdmUuaGVpZ2h0KClcblx0XHRcdFx0XHRcdH0pLmFwcGVuZFRvKHN0ck1vdmUpO1xuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRpZiAocC5kaXJlY3Rpb24gPT0gJ2xlZnQnKSB7XG5cdFx0XHRcdFx0XHRzdHJXcmFwLmhlaWdodChzdHJNb3ZlLm91dGVySGVpZ2h0KCkpO1xuXHRcdFx0XHRcdFx0aWYgKHN0ck1vdmUud2lkdGgoKSA+IHN0cldyYXAud2lkdGgoKSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgbGVmdFBvcyA9IC1zdHJNb3ZlLndpZHRoKCk7XG5cblx0XHRcdFx0XHRcdFx0aWYgKHAuY2lyY3VsYXIpIHtcblxuXHRcdFx0XHRcdFx0XHRcdGlmICghcC54bWwpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGNpcmNDbG9uZUhvcigpO1xuXHRcdFx0XHRcdFx0XHRcdFx0bGVmdFBvcyA9IC0oc3RyTW92ZS53aWR0aCgpICsgKHN0ck1vdmUud2lkdGgoKSAtIHN0cldyYXAud2lkdGgoKSkpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRpZiAocC54bWwpIHtcblx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLmNzcyh7XG5cdFx0XHRcdFx0XHRcdFx0XHRsZWZ0OiBzdHJXcmFwLndpZHRoKClcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR2YXIgc3RyTW92ZUxlZnQgPSBzdHJXcmFwLndpZHRoKCksXG5cdFx0XHRcdFx0XHRcdCAgICBrMSA9IDAsXG5cdFx0XHRcdFx0XHRcdCAgICB0aW1lRnVuYzEgPSBmdW5jdGlvbiB0aW1lRnVuYzEoKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGZ1bGxTID0gTWF0aC5hYnMobGVmdFBvcyksXG5cdFx0XHRcdFx0XHRcdFx0ICAgIHRpbWUgPSBmdWxsUyAvIHN0cldyYXAuZGF0YSgnc2Nyb2xsYW1vdW50JykgKiAxMDAwO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChwYXJzZUZsb2F0KHN0ck1vdmUuY3NzKCdsZWZ0JykpICE9IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdGZ1bGxTID0gZnVsbFMgKyBzdHJXcmFwLndpZHRoKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aW1lID0gKGZ1bGxTIC0gKHN0cldyYXAud2lkdGgoKSAtIHBhcnNlRmxvYXQoc3RyTW92ZS5jc3MoJ2xlZnQnKSkpKSAvIHN0cldyYXAuZGF0YSgnc2Nyb2xsYW1vdW50JykgKiAxMDAwO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdGltZTtcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0ICAgIG1vdmVGdW5jSWQxID0gZmFsc2UsXG5cdFx0XHRcdFx0XHRcdCAgICBtb3ZlRnVuYzEgPSBmdW5jdGlvbiBtb3ZlRnVuYzEoKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGxvb3AgIT0gMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpLmFuaW1hdGUoe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRsZWZ0OiBsZWZ0UG9zXG5cdFx0XHRcdFx0XHRcdFx0XHR9LCB0aW1lRnVuYzEoKSwgJ2xpbmVhcicsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGxlZnQ6IHN0cldyYXAud2lkdGgoKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGxvb3AgPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRtb3ZlRnVuY0lkMSA9IHNldFRpbWVvdXQobW92ZUZ1bmMxLCBwLnNjcm9sbGRlbGF5KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsb29wLS07XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bW92ZUZ1bmNJZDEgPSBzZXRUaW1lb3V0KG1vdmVGdW5jMSwgcC5zY3JvbGxkZWxheSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0c3RyV3JhcC5kYXRhKHtcblx0XHRcdFx0XHRcdFx0XHRtb3ZlSWQ6IG1vdmVGdW5jSWQxLFxuXHRcdFx0XHRcdFx0XHRcdG1vdmVGOiBtb3ZlRnVuYzFcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdGlmICghcC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdG1vdmVGdW5jMSgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0aWYgKHAuaG92ZXJzdG9wKSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbihlbnRlckV2ZW50LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLmFkZENsYXNzKCdzdHJfYWN0aXZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRjbGVhclRpbWVvdXQobW92ZUZ1bmNJZDEpO1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdH0pLm9uKGxlYXZlRXZlbnQsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykucmVtb3ZlQ2xhc3MoJ3N0cl9hY3RpdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdG1vdmVGdW5jMSgpO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHAuZHJhZykge1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHAuaW52ZXJ0aG92ZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBkcmFnTGVmdDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGRpciA9IDE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBuZXdYO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgb2xkWCA9IGUuY2xpZW50WDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZUxlZnQgPSBzdHJNb3ZlLnBvc2l0aW9uKCkubGVmdDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0azEgPSBzdHJNb3ZlTGVmdCAtIChlLmNsaWVudFggLSBzdHJXcmFwLm9mZnNldCgpLmxlZnQpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub24oJ21vdXNlbW92ZScsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bmV3WCA9IGUuY2xpZW50WDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobmV3WCA+IG9sZFgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRpciA9IDE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRpciA9IC0xO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRvbGRYID0gbmV3WDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnTGVmdCA9IGsxICsgKGUuY2xpZW50WCAtIHN0cldyYXAub2Zmc2V0KCkubGVmdCk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoIXAuY2lyY3VsYXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChkcmFnTGVmdCA8IC1zdHJNb3ZlLndpZHRoKCkgJiYgZGlyIDwgMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnTGVmdCA9IHN0cldyYXAud2lkdGgoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZUxlZnQgPSBzdHJNb3ZlLnBvc2l0aW9uKCkubGVmdDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0azEgPSBzdHJNb3ZlTGVmdCAtIChlLmNsaWVudFggLSBzdHJXcmFwLm9mZnNldCgpLmxlZnQpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGRyYWdMZWZ0ID4gc3RyV3JhcC53aWR0aCgpICYmIGRpciA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ0xlZnQgPSAtc3RyTW92ZS53aWR0aCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlTGVmdCA9IHN0ck1vdmUucG9zaXRpb24oKS5sZWZ0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMSA9IHN0ck1vdmVMZWZ0IC0gKGUuY2xpZW50WCAtIHN0cldyYXAub2Zmc2V0KCkubGVmdCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChkcmFnTGVmdCA8IC1zdHJNb3ZlLndpZHRoKCkgJiYgZGlyIDwgMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnTGVmdCA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVMZWZ0ID0gc3RyTW92ZS5wb3NpdGlvbigpLmxlZnQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGsxID0gc3RyTW92ZUxlZnQgLSAoZS5jbGllbnRYIC0gc3RyV3JhcC5vZmZzZXQoKS5sZWZ0KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChkcmFnTGVmdCA+IDAgJiYgZGlyID4gMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnTGVmdCA9IC1zdHJNb3ZlLndpZHRoKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVMZWZ0ID0gc3RyTW92ZS5wb3NpdGlvbigpLmxlZnQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGsxID0gc3RyTW92ZUxlZnQgLSAoZS5jbGllbnRYIC0gc3RyV3JhcC5vZmZzZXQoKS5sZWZ0KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSkuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGxlZnQ6IGRyYWdMZWZ0XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0fSkub24oJ21vdXNldXAnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vZmYoJ21vdXNlbW92ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChwLmludmVydGhvdmVyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnRyaWdnZXIoJ21vdXNlZW50ZXInKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmTW92ZSA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0sIDUwKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdH0pLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGZNb3ZlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5hZGRDbGFzcygnbm9fZHJhZycpO1xuXHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGlmIChwLnJ1bnNob3J0KSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRcdFx0bGVmdDogc3RyV3JhcC53aWR0aCgpXG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHN0ck1vdmVMZWZ0ID0gc3RyV3JhcC53aWR0aCgpLFxuXHRcdFx0XHRcdFx0XHRcdCAgICBrMSA9IDAsXG5cdFx0XHRcdFx0XHRcdFx0ICAgIHRpbWVGdW5jID0gZnVuY3Rpb24gdGltZUZ1bmMoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aW1lID0gKHN0ck1vdmUud2lkdGgoKSArIHN0ck1vdmUucG9zaXRpb24oKS5sZWZ0KSAvIHN0cldyYXAuZGF0YSgnc2Nyb2xsYW1vdW50JykgKiAxMDAwO1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHRpbWU7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgbW92ZUZ1bmMgPSBmdW5jdGlvbiBtb3ZlRnVuYygpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBsZWZ0UG9zID0gLXN0ck1vdmUud2lkdGgoKTtcblx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmUuYW5pbWF0ZSh7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGxlZnQ6IGxlZnRQb3Ncblx0XHRcdFx0XHRcdFx0XHRcdH0sIHRpbWVGdW5jKCksICdsaW5lYXInLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsZWZ0OiBzdHJXcmFwLndpZHRoKClcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChsb29wID09IC0xKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChtb3ZlRnVuYywgcC5zY3JvbGxkZWxheSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bG9vcC0tO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQobW92ZUZ1bmMsIHAuc2Nyb2xsZGVsYXkpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRcdHN0cldyYXAuZGF0YSh7XG5cdFx0XHRcdFx0XHRcdFx0XHRtb3ZlRjogbW92ZUZ1bmNcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRpZiAoIXAuaW52ZXJ0aG92ZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdG1vdmVGdW5jKCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdGlmIChwLmhvdmVyc3RvcCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbihlbnRlckV2ZW50LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykuYWRkQ2xhc3MoJ3N0cl9hY3RpdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSkub24obGVhdmVFdmVudCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLnJlbW92ZUNsYXNzKCdzdHJfYWN0aXZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0bW92ZUZ1bmMoKTtcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAocC5kcmFnKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN0cldyYXAub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHAuaW52ZXJ0aG92ZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmUuc3RvcCh0cnVlKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZHJhZ0xlZnQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGRpciA9IDE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIG5ld1g7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIG9sZFggPSBlLmNsaWVudFg7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlTGVmdCA9IHN0ck1vdmUucG9zaXRpb24oKS5sZWZ0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGsxID0gc3RyTW92ZUxlZnQgLSAoZS5jbGllbnRYIC0gc3RyV3JhcC5vZmZzZXQoKS5sZWZ0KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLm9uKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdG5ld1ggPSBlLmNsaWVudFg7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobmV3WCA+IG9sZFgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZGlyID0gMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRpciA9IC0xO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0b2xkWCA9IG5ld1g7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnTGVmdCA9IGsxICsgKGUuY2xpZW50WCAtIHN0cldyYXAub2Zmc2V0KCkubGVmdCk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChkcmFnTGVmdCA8IC1zdHJNb3ZlLndpZHRoKCkgJiYgZGlyIDwgMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnTGVmdCA9IHN0cldyYXAud2lkdGgoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZUxlZnQgPSBzdHJNb3ZlLnBvc2l0aW9uKCkubGVmdDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0azEgPSBzdHJNb3ZlTGVmdCAtIChlLmNsaWVudFggLSBzdHJXcmFwLm9mZnNldCgpLmxlZnQpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGRyYWdMZWZ0ID4gc3RyV3JhcC53aWR0aCgpICYmIGRpciA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ0xlZnQgPSAtc3RyTW92ZS53aWR0aCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlTGVmdCA9IHN0ck1vdmUucG9zaXRpb24oKS5sZWZ0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMSA9IHN0ck1vdmVMZWZ0IC0gKGUuY2xpZW50WCAtIHN0cldyYXAub2Zmc2V0KCkubGVmdCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmUuc3RvcCh0cnVlKS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsZWZ0OiBkcmFnTGVmdFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSkub24oJ21vdXNldXAnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnRyaWdnZXIoJ21vdXNlZW50ZXInKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmTW92ZSA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSwgNTApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChmTW92ZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLmFkZENsYXNzKCdub19kcmFnJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLmFkZENsYXNzKCdzdHJfc3RhdGljJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRpZiAocC5kaXJlY3Rpb24gPT0gJ3JpZ2h0Jykge1xuXHRcdFx0XHRcdFx0c3RyV3JhcC5oZWlnaHQoc3RyTW92ZS5vdXRlckhlaWdodCgpKTtcblx0XHRcdFx0XHRcdHN0cldyYXAuYWRkQ2xhc3MoJ3N0cl9yaWdodCcpO1xuXHRcdFx0XHRcdFx0c3RyTW92ZS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRsZWZ0OiAtc3RyTW92ZS53aWR0aCgpLFxuXHRcdFx0XHRcdFx0XHRyaWdodDogJ2F1dG8nXG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0aWYgKHN0ck1vdmUud2lkdGgoKSA+IHN0cldyYXAud2lkdGgoKSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgbGVmdFBvcyA9IHN0cldyYXAud2lkdGgoKTtcblx0XHRcdFx0XHRcdFx0c3RyTW92ZS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRcdGxlZnQ6IDBcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdGlmIChwLmNpcmN1bGFyKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFwLnhtbCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2lyY0Nsb25lSG9yKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHQvL9Ce0L/RgNC10LTQtdC70Y/QtdC8INC60YDQsNC50L3RjtGOINGC0L7Rh9C60YNcblx0XHRcdFx0XHRcdFx0XHRcdGxlZnRQb3MgPSBzdHJNb3ZlLndpZHRoKCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0dmFyIGsyID0gMDtcblx0XHRcdFx0XHRcdFx0dGltZUZ1bmMgPSBmdW5jdGlvbiB0aW1lRnVuYygpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgZnVsbFMgPSBzdHJXcmFwLndpZHRoKCksXG5cdFx0XHRcdFx0XHRcdFx0ICAgIC8v0LrRgNCw0LnQvdGP0Y8g0YLQvtGH0LrQsFxuXHRcdFx0XHRcdFx0XHRcdHRpbWUgPSBmdWxsUyAvIHN0cldyYXAuZGF0YSgnc2Nyb2xsYW1vdW50JykgKiAxMDAwOyAvL9Cy0YDQtdC80Y9cblx0XHRcdFx0XHRcdFx0XHRpZiAocGFyc2VGbG9hdChzdHJNb3ZlLmNzcygnbGVmdCcpKSAhPSAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRmdWxsUyA9IHN0ck1vdmUud2lkdGgoKSArIHN0cldyYXAud2lkdGgoKTtcblx0XHRcdFx0XHRcdFx0XHRcdHRpbWUgPSAoZnVsbFMgLSAoc3RyTW92ZS53aWR0aCgpICsgcGFyc2VGbG9hdChzdHJNb3ZlLmNzcygnbGVmdCcpKSkpIC8gc3RyV3JhcC5kYXRhKCdzY3JvbGxhbW91bnQnKSAqIDEwMDA7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiB0aW1lO1xuXHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHR2YXIgbW92ZUZ1bmMgPSBmdW5jdGlvbiBtb3ZlRnVuYygpIHtcblxuXHRcdFx0XHRcdFx0XHRcdGlmIChsb29wICE9IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmUuYW5pbWF0ZSh7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGxlZnQ6IGxlZnRQb3Ncblx0XHRcdFx0XHRcdFx0XHRcdH0sIHRpbWVGdW5jKCksICdsaW5lYXInLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsZWZ0OiAtc3RyTW92ZS53aWR0aCgpXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobG9vcCA9PSAtMSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQobW92ZUZ1bmMsIHAuc2Nyb2xsZGVsYXkpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGxvb3AtLTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KG1vdmVGdW5jLCBwLnNjcm9sbGRlbGF5KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdHN0cldyYXAuZGF0YSh7XG5cdFx0XHRcdFx0XHRcdFx0bW92ZUY6IG1vdmVGdW5jXG5cdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdGlmICghcC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdG1vdmVGdW5jKCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0aWYgKHAuaG92ZXJzdG9wKSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbihlbnRlckV2ZW50LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLmFkZENsYXNzKCdzdHJfYWN0aXZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0fSkub24obGVhdmVFdmVudCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnc3RyX2FjdGl2ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vZmYoJ21vdXNlbW92ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0bW92ZUZ1bmMoKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRcdGlmIChwLmRyYWcpIHtcblxuXHRcdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHAuaW52ZXJ0aG92ZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGRyYWdMZWZ0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZGlyID0gMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIG5ld1g7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBvbGRYID0gZS5jbGllbnRYO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlTGVmdCA9IHN0ck1vdmUucG9zaXRpb24oKS5sZWZ0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVMZWZ0IC0gKGUuY2xpZW50WCAtIHN0cldyYXAub2Zmc2V0KCkubGVmdCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub24oJ21vdXNlbW92ZScsIGZ1bmN0aW9uIChlKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmTW92ZSA9IHRydWU7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRuZXdYID0gZS5jbGllbnRYO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChuZXdYID4gb2xkWCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZGlyID0gMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZGlyID0gLTE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG9sZFggPSBuZXdYO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRyYWdMZWZ0ID0gazIgKyAoZS5jbGllbnRYIC0gc3RyV3JhcC5vZmZzZXQoKS5sZWZ0KTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmICghcC5jaXJjdWxhcikge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ0xlZnQgPCAtc3RyTW92ZS53aWR0aCgpICYmIGRpciA8IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ0xlZnQgPSBzdHJXcmFwLndpZHRoKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVMZWZ0ID0gc3RyTW92ZS5wb3NpdGlvbigpLmxlZnQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGsyID0gc3RyTW92ZUxlZnQgLSAoZS5jbGllbnRYIC0gc3RyV3JhcC5vZmZzZXQoKS5sZWZ0KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChkcmFnTGVmdCA+IHN0cldyYXAud2lkdGgoKSAmJiBkaXIgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRyYWdMZWZ0ID0gLXN0ck1vdmUud2lkdGgoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZUxlZnQgPSBzdHJNb3ZlLnBvc2l0aW9uKCkubGVmdDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0azIgPSBzdHJNb3ZlTGVmdCAtIChlLmNsaWVudFggLSBzdHJXcmFwLm9mZnNldCgpLmxlZnQpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ0xlZnQgPCAtc3RyTW92ZS53aWR0aCgpICYmIGRpciA8IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ0xlZnQgPSAwO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlTGVmdCA9IHN0ck1vdmUucG9zaXRpb24oKS5sZWZ0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVMZWZ0IC0gKGUuY2xpZW50WCAtIHN0cldyYXAub2Zmc2V0KCkubGVmdCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ0xlZnQgPiAwICYmIGRpciA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ0xlZnQgPSAtc3RyTW92ZS53aWR0aCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlTGVmdCA9IHN0ck1vdmUucG9zaXRpb24oKS5sZWZ0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVMZWZ0IC0gKGUuY2xpZW50WCAtIHN0cldyYXAub2Zmc2V0KCkubGVmdCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpLmNzcyh7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsZWZ0OiBkcmFnTGVmdFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KS5vbignbW91c2V1cCcsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS50cmlnZ2VyKCdtb3VzZWVudGVyJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGZNb3ZlID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSwgNTApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZk1vdmUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLmFkZENsYXNzKCdub19kcmFnJyk7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdFx0XHRpZiAocC5ydW5zaG9ydCkge1xuXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGsyID0gMDtcblx0XHRcdFx0XHRcdFx0XHR2YXIgdGltZUZ1bmMgPSBmdW5jdGlvbiB0aW1lRnVuYygpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHRpbWUgPSAoc3RyV3JhcC53aWR0aCgpIC0gc3RyTW92ZS5wb3NpdGlvbigpLmxlZnQpIC8gc3RyV3JhcC5kYXRhKCdzY3JvbGxhbW91bnQnKSAqIDEwMDA7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gdGltZTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRcdHZhciBtb3ZlRnVuYyA9IGZ1bmN0aW9uIG1vdmVGdW5jKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGxlZnRQb3MgPSBzdHJXcmFwLndpZHRoKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLmFuaW1hdGUoe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRsZWZ0OiBsZWZ0UG9zXG5cdFx0XHRcdFx0XHRcdFx0XHR9LCB0aW1lRnVuYygpLCAnbGluZWFyJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLmNzcyh7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bGVmdDogLXN0ck1vdmUud2lkdGgoKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGxvb3AgPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KG1vdmVGdW5jLCBwLnNjcm9sbGRlbGF5KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsb29wLS07XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChtb3ZlRnVuYywgcC5zY3JvbGxkZWxheSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5kYXRhKHtcblx0XHRcdFx0XHRcdFx0XHRcdG1vdmVGOiBtb3ZlRnVuY1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFwLmludmVydGhvdmVyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRtb3ZlRnVuYygpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRpZiAocC5ob3ZlcnN0b3ApIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN0cldyYXAub24oZW50ZXJFdmVudCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLmFkZENsYXNzKCdzdHJfYWN0aXZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmUuc3RvcCh0cnVlKTtcblx0XHRcdFx0XHRcdFx0XHRcdH0pLm9uKGxlYXZlRXZlbnQsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnc3RyX2FjdGl2ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLm9mZignbW91c2Vtb3ZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdG1vdmVGdW5jKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHAuZHJhZykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChwLmludmVydGhvdmVyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGRyYWdMZWZ0O1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBkaXIgPSAxO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBuZXdYO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBvbGRYID0gZS5jbGllbnRYO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vZHJhZ1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZUxlZnQgPSBzdHJNb3ZlLnBvc2l0aW9uKCkubGVmdDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVMZWZ0IC0gKGUuY2xpZW50WCAtIHN0cldyYXAub2Zmc2V0KCkubGVmdCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vbignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGZNb3ZlID0gdHJ1ZTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRuZXdYID0gZS5jbGllbnRYO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKG5ld1ggPiBvbGRYKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRpciA9IDE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkaXIgPSAtMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdG9sZFggPSBuZXdYO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ0xlZnQgPSBrMiArIChlLmNsaWVudFggLSBzdHJXcmFwLm9mZnNldCgpLmxlZnQpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ0xlZnQgPCAtc3RyTW92ZS53aWR0aCgpICYmIGRpciA8IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ0xlZnQgPSBzdHJXcmFwLndpZHRoKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVMZWZ0ID0gc3RyTW92ZS5wb3NpdGlvbigpLmxlZnQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGsyID0gc3RyTW92ZUxlZnQgLSAoZS5jbGllbnRYIC0gc3RyV3JhcC5vZmZzZXQoKS5sZWZ0KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChkcmFnTGVmdCA+IHN0cldyYXAud2lkdGgoKSAmJiBkaXIgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRyYWdMZWZ0ID0gLXN0ck1vdmUud2lkdGgoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZUxlZnQgPSBzdHJNb3ZlLnBvc2l0aW9uKCkubGVmdDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0azIgPSBzdHJNb3ZlTGVmdCAtIChlLmNsaWVudFggLSBzdHJXcmFwLm9mZnNldCgpLmxlZnQpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSkuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0bGVmdDogZHJhZ0xlZnRcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pLm9uKCdtb3VzZXVwJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHAuaW52ZXJ0aG92ZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS50cmlnZ2VyKCdtb3VzZWVudGVyJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLm9mZignbW91c2Vtb3ZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0sIDUwKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZk1vdmUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5hZGRDbGFzcygnbm9fZHJhZycpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5hZGRDbGFzcygnc3RyX3N0YXRpYycpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0aWYgKHAuZGlyZWN0aW9uID09ICd1cCcpIHtcblx0XHRcdFx0XHRcdHN0cldyYXAuYWRkQ2xhc3MoJ3N0cl92ZXJ0aWNhbCcpO1xuXG5cdFx0XHRcdFx0XHRpZiAoc3RyTW92ZS5oZWlnaHQoKSA+IHN0cldyYXAuaGVpZ2h0KCkpIHtcblx0XHRcdFx0XHRcdFx0dmFyIHRvcFBvcyA9IC1zdHJNb3ZlLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0XHRpZiAocC5jaXJjdWxhcikge1xuXHRcdFx0XHRcdFx0XHRcdGlmICghcC54bWwpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGNpcmNDbG9uZVZlcnQoKTtcblx0XHRcdFx0XHRcdFx0XHRcdHRvcFBvcyA9IC0oc3RyTW92ZS5oZWlnaHQoKSArIChzdHJNb3ZlLmhlaWdodCgpIC0gc3RyV3JhcC5oZWlnaHQoKSkpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRpZiAocC54bWwpIHtcblx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLmNzcyh7XG5cdFx0XHRcdFx0XHRcdFx0XHR0b3A6IHN0cldyYXAuaGVpZ2h0KClcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR2YXIgazIgPSAwO1xuXHRcdFx0XHRcdFx0XHR0aW1lRnVuYyA9IGZ1bmN0aW9uIHRpbWVGdW5jKCkge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBmdWxsUyA9IE1hdGguYWJzKHRvcFBvcyksXG5cdFx0XHRcdFx0XHRcdFx0ICAgIHRpbWUgPSBmdWxsUyAvIHN0cldyYXAuZGF0YSgnc2Nyb2xsYW1vdW50JykgKiAxMDAwO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChwYXJzZUZsb2F0KHN0ck1vdmUuY3NzKCd0b3AnKSkgIT0gMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0ZnVsbFMgPSBmdWxsUyArIHN0cldyYXAuaGVpZ2h0KCk7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aW1lID0gKGZ1bGxTIC0gKHN0cldyYXAuaGVpZ2h0KCkgLSBwYXJzZUZsb2F0KHN0ck1vdmUuY3NzKCd0b3AnKSkpKSAvIHN0cldyYXAuZGF0YSgnc2Nyb2xsYW1vdW50JykgKiAxMDAwO1xuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiB0aW1lO1xuXHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHR2YXIgbW92ZUZ1bmMgPSBmdW5jdGlvbiBtb3ZlRnVuYygpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAobG9vcCAhPSAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLmFuaW1hdGUoe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0b3A6IHRvcFBvc1xuXHRcdFx0XHRcdFx0XHRcdFx0fSwgdGltZUZ1bmMoKSwgJ2xpbmVhcicsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRvcDogc3RyV3JhcC5oZWlnaHQoKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGxvb3AgPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KG1vdmVGdW5jLCBwLnNjcm9sbGRlbGF5KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsb29wLS07XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChtb3ZlRnVuYywgcC5zY3JvbGxkZWxheSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHRcdHN0cldyYXAuZGF0YSh7XG5cdFx0XHRcdFx0XHRcdFx0bW92ZUY6IG1vdmVGdW5jXG5cdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdGlmICghcC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdG1vdmVGdW5jKCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0aWYgKHAuaG92ZXJzdG9wKSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbihlbnRlckV2ZW50LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLmFkZENsYXNzKCdzdHJfYWN0aXZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0fSkub24obGVhdmVFdmVudCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnc3RyX2FjdGl2ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vZmYoJ21vdXNlbW92ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0bW92ZUZ1bmMoKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRcdGlmIChwLmRyYWcpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN0cldyYXAub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChwLmludmVydGhvdmVyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBkcmFnVG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZGlyID0gMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIG5ld1k7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBvbGRZID0gZS5jbGllbnRZO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVUb3AgLSAoZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3ApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLm9uKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bmV3WSA9IGUuY2xpZW50WTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobmV3WSA+IG9sZFkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRpciA9IDE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChuZXdZIDwgb2xkWSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkaXIgPSAtMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0b2xkWSA9IG5ld1k7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IGsyICsgZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3A7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoIXAuY2lyY3VsYXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChkcmFnVG9wIDwgLXN0ck1vdmUuaGVpZ2h0KCkgJiYgZGlyIDwgMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnVG9wID0gc3RyV3JhcC5oZWlnaHQoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZVRvcCA9IHN0ck1vdmUucG9zaXRpb24oKS50b3A7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGsyID0gc3RyTW92ZVRvcCAtIChlLmNsaWVudFkgLSBzdHJXcmFwLm9mZnNldCgpLnRvcCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ1RvcCA+IHN0cldyYXAuaGVpZ2h0KCkgJiYgZGlyID4gMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnVG9wID0gLXN0ck1vdmUuaGVpZ2h0KCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVUb3AgLSAoZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3ApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ1RvcCA8IC1zdHJNb3ZlLmhlaWdodCgpICYmIGRpciA8IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVUb3AgLSAoZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3ApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGRyYWdUb3AgPiAwICYmIGRpciA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IC1zdHJNb3ZlLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlVG9wID0gc3RyTW92ZS5wb3NpdGlvbigpLnRvcDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0azIgPSBzdHJNb3ZlVG9wIC0gKGUuY2xpZW50WSAtIHN0cldyYXAub2Zmc2V0KCkudG9wKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSkuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRvcDogZHJhZ1RvcFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vZHJhZ1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pLm9uKCdtb3VzZXVwJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChwLmludmVydGhvdmVyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnRyaWdnZXIoJ21vdXNlZW50ZXInKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vZmYoJ21vdXNlbW92ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9LCA1MCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChmTW92ZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN0cldyYXAuYWRkQ2xhc3MoJ25vX2RyYWcnKTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAocC5ydW5zaG9ydCkge1xuXHRcdFx0XHRcdFx0XHRcdHN0ck1vdmUuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdHRvcDogc3RyV3JhcC5oZWlnaHQoKVxuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdHZhciBrMiA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHRpbWVGdW5jID0gZnVuY3Rpb24gdGltZUZ1bmMoKSB7XG5cblx0XHRcdFx0XHRcdFx0XHRcdHRpbWUgPSAoc3RyTW92ZS5oZWlnaHQoKSArIHN0ck1vdmUucG9zaXRpb24oKS50b3ApIC8gc3RyV3JhcC5kYXRhKCdzY3JvbGxhbW91bnQnKSAqIDEwMDA7XG5cblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiB0aW1lO1xuXHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdFx0dmFyIG1vdmVGdW5jID0gZnVuY3Rpb24gbW92ZUZ1bmMoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgdG9wUG9zID0gLXN0ck1vdmUuaGVpZ2h0KCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLmFuaW1hdGUoe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0b3A6IHRvcFBvc1xuXHRcdFx0XHRcdFx0XHRcdFx0fSwgdGltZUZ1bmMoKSwgJ2xpbmVhcicsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRvcDogc3RyV3JhcC5oZWlnaHQoKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGxvb3AgPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KG1vdmVGdW5jLCBwLnNjcm9sbGRlbGF5KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsb29wLS07XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChtb3ZlRnVuYywgcC5zY3JvbGxkZWxheSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRcdHN0cldyYXAuZGF0YSh7XG5cdFx0XHRcdFx0XHRcdFx0XHRtb3ZlRjogbW92ZUZ1bmNcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRpZiAoIXAuaW52ZXJ0aG92ZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdG1vdmVGdW5jKCk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdGlmIChwLmhvdmVyc3RvcCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbihlbnRlckV2ZW50LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykuYWRkQ2xhc3MoJ3N0cl9hY3RpdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSkub24obGVhdmVFdmVudCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLnJlbW92ZUNsYXNzKCdzdHJfYWN0aXZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0bW92ZUZ1bmMoKTtcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAocC5kcmFnKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN0cldyYXAub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHAuaW52ZXJ0aG92ZXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmUuc3RvcCh0cnVlKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZHJhZ1RvcDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZGlyID0gMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgbmV3WTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgb2xkWSA9IGUuY2xpZW50WTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGsyID0gc3RyTW92ZVRvcCAtIChlLmNsaWVudFkgLSBzdHJXcmFwLm9mZnNldCgpLnRvcCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vbignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGUpIHtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdG5ld1kgPSBlLmNsaWVudFk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobmV3WSA+IG9sZFkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZGlyID0gMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChuZXdZIDwgb2xkWSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRpciA9IC0xO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRvbGRZID0gbmV3WTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRyYWdUb3AgPSBrMiArIGUuY2xpZW50WSAtIHN0cldyYXAub2Zmc2V0KCkudG9wO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ1RvcCA8IC1zdHJNb3ZlLmhlaWdodCgpICYmIGRpciA8IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IHN0cldyYXAuaGVpZ2h0KCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVUb3AgLSAoZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3ApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGRyYWdUb3AgPiBzdHJXcmFwLmhlaWdodCgpICYmIGRpciA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IC1zdHJNb3ZlLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlVG9wID0gc3RyTW92ZS5wb3NpdGlvbigpLnRvcDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0azIgPSBzdHJNb3ZlVG9wIC0gKGUuY2xpZW50WSAtIHN0cldyYXAub2Zmc2V0KCkudG9wKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vKmRyYWdcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpLmNzcyh7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRvcDogZHJhZ1RvcFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSkub24oJ21vdXNldXAnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnRyaWdnZXIoJ21vdXNlZW50ZXInKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmTW92ZSA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSwgNTApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChmTW92ZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLmFkZENsYXNzKCdub19kcmFnJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLmFkZENsYXNzKCdzdHJfc3RhdGljJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRpZiAocC5kaXJlY3Rpb24gPT0gJ2Rvd24nKSB7XG5cblx0XHRcdFx0XHRcdHN0cldyYXAuYWRkQ2xhc3MoJ3N0cl92ZXJ0aWNhbCcpLmFkZENsYXNzKCdzdHJfZG93bicpO1xuXHRcdFx0XHRcdFx0c3RyTW92ZS5jc3Moe1xuXHRcdFx0XHRcdFx0XHR0b3A6IC1zdHJNb3ZlLmhlaWdodCgpLFxuXHRcdFx0XHRcdFx0XHRib3R0b206ICdhdXRvJ1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRpZiAoc3RyTW92ZS5oZWlnaHQoKSA+IHN0cldyYXAuaGVpZ2h0KCkpIHtcblx0XHRcdFx0XHRcdFx0dmFyIHRvcFBvcyA9IHN0cldyYXAuaGVpZ2h0KCk7XG5cdFx0XHRcdFx0XHRcdGlmIChwLmNpcmN1bGFyKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFwLnhtbCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2lyY0Nsb25lVmVydCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0dG9wUG9zID0gc3RyTW92ZS5oZWlnaHQoKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0aWYgKHAueG1sKSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5jc3Moe1xuXHRcdFx0XHRcdFx0XHRcdFx0dG9wOiAtc3RyTW92ZS5oZWlnaHQoKVxuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHZhciBrMiA9IDA7XG5cdFx0XHRcdFx0XHRcdHRpbWVGdW5jID0gZnVuY3Rpb24gdGltZUZ1bmMoKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGZ1bGxTID0gc3RyV3JhcC5oZWlnaHQoKSxcblx0XHRcdFx0XHRcdFx0XHQgICAgLy/QutGA0LDQudC90Y/RjyDRgtC+0YfQutCwXG5cdFx0XHRcdFx0XHRcdFx0dGltZSA9IGZ1bGxTIC8gc3RyV3JhcC5kYXRhKCdzY3JvbGxhbW91bnQnKSAqIDEwMDA7IC8v0LLRgNC10LzRj1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHBhcnNlRmxvYXQoc3RyTW92ZS5jc3MoJ3RvcCcpKSAhPSAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRmdWxsUyA9IHN0ck1vdmUuaGVpZ2h0KCkgKyBzdHJXcmFwLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0dGltZSA9IChmdWxsUyAtIChzdHJNb3ZlLmhlaWdodCgpICsgcGFyc2VGbG9hdChzdHJNb3ZlLmNzcygndG9wJykpKSkgLyBzdHJXcmFwLmRhdGEoJ3Njcm9sbGFtb3VudCcpICogMTAwMDtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHRpbWU7XG5cdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdHZhciBtb3ZlRnVuYyA9IGZ1bmN0aW9uIG1vdmVGdW5jKCkge1xuXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGxvb3AgIT0gMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5hbmltYXRlKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dG9wOiB0b3BQb3Ncblx0XHRcdFx0XHRcdFx0XHRcdH0sIHRpbWVGdW5jKCksICdsaW5lYXInLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0b3A6IC1zdHJNb3ZlLmhlaWdodCgpXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobG9vcCA9PSAtMSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChtb3ZlRnVuYywgcC5zY3JvbGxkZWxheSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bG9vcC0tO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQobW92ZUZ1bmMsIHAuc2Nyb2xsZGVsYXkpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0c3RyV3JhcC5kYXRhKHtcblx0XHRcdFx0XHRcdFx0XHRtb3ZlRjogbW92ZUZ1bmNcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdGlmICghcC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdG1vdmVGdW5jKCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0aWYgKHAuaG92ZXJzdG9wKSB7XG5cdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbihlbnRlckV2ZW50LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLmFkZENsYXNzKCdzdHJfYWN0aXZlJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0fSkub24obGVhdmVFdmVudCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVDbGFzcygnc3RyX2FjdGl2ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vZmYoJ21vdXNlbW92ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0bW92ZUZ1bmMoKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRcdGlmIChwLmRyYWcpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN0cldyYXAub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChwLmludmVydGhvdmVyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBkcmFnVG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZGlyID0gMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIG5ld1k7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBvbGRZID0gZS5jbGllbnRZO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblxuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVUb3AgLSAoZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3ApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLm9uKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZSkge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0Ly9kcmFnXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0bmV3WSA9IGUuY2xpZW50WTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobmV3WSA+IG9sZFkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRpciA9IDE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChuZXdZIDwgb2xkWSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkaXIgPSAtMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0b2xkWSA9IG5ld1k7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IGsyICsgZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3A7XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoIXAuY2lyY3VsYXIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChkcmFnVG9wIDwgLXN0ck1vdmUuaGVpZ2h0KCkgJiYgZGlyIDwgMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnVG9wID0gc3RyV3JhcC5oZWlnaHQoKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZVRvcCA9IHN0ck1vdmUucG9zaXRpb24oKS50b3A7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGsyID0gc3RyTW92ZVRvcCAtIChlLmNsaWVudFkgLSBzdHJXcmFwLm9mZnNldCgpLnRvcCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ1RvcCA+IHN0cldyYXAuaGVpZ2h0KCkgJiYgZGlyID4gMCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRkcmFnVG9wID0gLXN0ck1vdmUuaGVpZ2h0KCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVUb3AgLSAoZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3ApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ1RvcCA8IC1zdHJNb3ZlLmhlaWdodCgpICYmIGRpciA8IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVUb3AgLSAoZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3ApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGRyYWdUb3AgPiAwICYmIGRpciA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IC1zdHJNb3ZlLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlVG9wID0gc3RyTW92ZS5wb3NpdGlvbigpLnRvcDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0azIgPSBzdHJNb3ZlVG9wIC0gKGUuY2xpZW50WSAtIHN0cldyYXAub2Zmc2V0KCkudG9wKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSkuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRvcDogZHJhZ1RvcFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vZHJhZ1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pLm9uKCdtb3VzZXVwJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChwLmludmVydGhvdmVyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnRyaWdnZXIoJ21vdXNlZW50ZXInKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vZmYoJ21vdXNlbW92ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9LCA1MCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChmTW92ZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN0cldyYXAuYWRkQ2xhc3MoJ25vX2RyYWcnKTtcblx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZiAocC5ydW5zaG9ydCkge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBrMiA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHRpbWVGdW5jID0gZnVuY3Rpb24gdGltZUZ1bmMoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aW1lID0gKHN0cldyYXAuaGVpZ2h0KCkgLSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wKSAvIHN0cldyYXAuZGF0YSgnc2Nyb2xsYW1vdW50JykgKiAxMDAwO1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHRpbWU7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgbW92ZUZ1bmMgPSBmdW5jdGlvbiBtb3ZlRnVuYygpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciB0b3BQb3MgPSBzdHJXcmFwLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5hbmltYXRlKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dG9wOiB0b3BQb3Ncblx0XHRcdFx0XHRcdFx0XHRcdH0sIHRpbWVGdW5jKCksICdsaW5lYXInLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykuY3NzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0b3A6IC1zdHJNb3ZlLmhlaWdodCgpXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobG9vcCA9PSAtMSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQobW92ZUZ1bmMsIHAuc2Nyb2xsZGVsYXkpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGxvb3AtLTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KG1vdmVGdW5jLCBwLnNjcm9sbGRlbGF5KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5kYXRhKHtcblx0XHRcdFx0XHRcdFx0XHRcdG1vdmVGOiBtb3ZlRnVuY1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdGlmICghcC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdFx0bW92ZUZ1bmMoKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHAuaG92ZXJzdG9wKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLm9uKGVudGVyRXZlbnQsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5hZGRDbGFzcygnc3RyX2FjdGl2ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnN0b3AodHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KS5vbihsZWF2ZUV2ZW50LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykucmVtb3ZlQ2xhc3MoJ3N0cl9hY3RpdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0JCh0aGlzKS5vZmYoJ21vdXNlbW92ZScpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRtb3ZlRnVuYygpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmIChwLmRyYWcpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyV3JhcC5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vZHJhZ1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBkcmFnVG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBkaXIgPSAxO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBuZXdZO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBvbGRZID0gZS5jbGllbnRZO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vZHJhZ1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZVRvcCA9IHN0ck1vdmUucG9zaXRpb24oKS50b3A7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0azIgPSBzdHJNb3ZlVG9wIC0gKGUuY2xpZW50WSAtIHN0cldyYXAub2Zmc2V0KCkudG9wKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLm9uKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0Zk1vdmUgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQvL2RyYWdcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdG5ld1kgPSBlLmNsaWVudFk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAobmV3WSA+IG9sZFkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZGlyID0gMTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChuZXdZIDwgb2xkWSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRpciA9IC0xO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRvbGRZID0gbmV3WTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGRyYWdUb3AgPSBrMiArIGUuY2xpZW50WSAtIHN0cldyYXAub2Zmc2V0KCkudG9wO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZHJhZ1RvcCA8IC1zdHJNb3ZlLmhlaWdodCgpICYmIGRpciA8IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IHN0cldyYXAuaGVpZ2h0KCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN0ck1vdmVUb3AgPSBzdHJNb3ZlLnBvc2l0aW9uKCkudG9wO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRrMiA9IHN0ck1vdmVUb3AgLSAoZS5jbGllbnRZIC0gc3RyV3JhcC5vZmZzZXQoKS50b3ApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGRyYWdUb3AgPiBzdHJXcmFwLmhlaWdodCgpICYmIGRpciA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZHJhZ1RvcCA9IC1zdHJNb3ZlLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlVG9wID0gc3RyTW92ZS5wb3NpdGlvbigpLnRvcDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0azIgPSBzdHJNb3ZlVG9wIC0gKGUuY2xpZW50WSAtIHN0cldyYXAub2Zmc2V0KCkudG9wKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdC8vKmRyYWdcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyTW92ZS5zdG9wKHRydWUpLmNzcyh7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRvcDogZHJhZ1RvcFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSkub24oJ21vdXNldXAnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAocC5pbnZlcnRob3Zlcikge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJNb3ZlLnRyaWdnZXIoJ21vdXNlZW50ZXInKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRmTW92ZSA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSwgNTApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChmTW92ZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLmFkZENsYXNzKCdub19kcmFnJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRzdHJXcmFwLmFkZENsYXNzKCdzdHJfc3RhdGljJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fTtcblx0XHRcdFx0aWYgKHAueG1sKSB7XG5cdFx0XHRcdFx0JC5hamF4KHtcblx0XHRcdFx0XHRcdHVybDogcC54bWwsXG5cdFx0XHRcdFx0XHRkYXRhVHlwZTogXCJ4bWxcIixcblx0XHRcdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3MoeG1sKSB7XG5cdFx0XHRcdFx0XHRcdHZhciB4bWxUZXh0RWwgPSAkKHhtbCkuZmluZCgndGV4dCcpO1xuXHRcdFx0XHRcdFx0XHR2YXIgeG1sVGV4dExlbmd0aCA9IHhtbFRleHRFbC5sZW5ndGg7XG5cdFx0XHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgeG1sVGV4dExlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHhtbEVsQWN0aXZlID0geG1sVGV4dEVsLmVxKGkpO1xuXHRcdFx0XHRcdFx0XHRcdHZhciB4bWxFbENvbnRlbnQgPSB4bWxFbEFjdGl2ZS50ZXh0KCk7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHhtbEl0ZW1FbCA9ICQoJzxzcGFuPicpLnRleHQoeG1sRWxDb250ZW50KS5hcHBlbmRUbyhzdHJXcmFwKTtcblxuXHRcdFx0XHRcdFx0XHRcdGlmIChwLmRpcmVjdGlvbiA9PSAnbGVmdCcgfHwgcC5kaXJlY3Rpb24gPT0gJ3JpZ2h0Jykge1xuXHRcdFx0XHRcdFx0XHRcdFx0eG1sSXRlbUVsLmNzcyh7IGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLCB0ZXh0QWxpZ246ICdyaWdodCcgfSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoaSA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0eG1sSXRlbUVsLmNzcyh7IHdpZHRoOiBzdHJXcmFwLndpZHRoKCkgKyB4bWxJdGVtRWwud2lkdGgoKSB9KTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHAuZGlyZWN0aW9uID09ICdkb3duJyB8fCBwLmRpcmVjdGlvbiA9PSAndXAnKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR4bWxJdGVtRWwuY3NzKHsgZGlzcGxheTogJ2Jsb2NrJywgdGV4dEFsaWduOiAnbGVmdCcgfSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoaSA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0eG1sSXRlbUVsLmNzcyh7IHBhZGRpbmdUb3A6IHN0cldyYXAuaGVpZ2h0KCkgfSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGNvZGUoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb2RlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0c3RyV3JhcC5kYXRhKHtcblx0XHRcdFx0XHRpbmk6IGNvZGUsXG5cdFx0XHRcdFx0c3RhcnRoZWlnaHQ6IHN0YXJ0SGVpZ2h0XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHR1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZSgpIHtcblx0XHRcdHZhciBlbCA9ICQodGhpcyk7XG5cdFx0XHR2YXIgc3RyX29yaWdpbiA9ICQoJy5zdHJfb3JpZ2luJywgZWwpO1xuXHRcdFx0dmFyIHN0cl9tb3ZlX2Nsb25lID0gJCgnLnN0cl9tb3ZlX2Nsb25lJywgZWwpO1xuXHRcdFx0c3RyX29yaWdpbi5zdG9wKHRydWUpO1xuXHRcdFx0c3RyX21vdmVfY2xvbmUucmVtb3ZlKCk7XG5cdFx0XHRlbC5kYXRhKCdpbmknKSgpO1xuXHRcdH0sXG5cdFx0ZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHtcblxuXHRcdFx0dmFyIGVsID0gJCh0aGlzKTtcblx0XHRcdHZhciBlbE1vdmUgPSAkKCcuc3RyX21vdmUnLCBlbCk7XG5cdFx0XHR2YXIgc3RhcnRIZWlnaHQgPSBlbC5kYXRhKCdzdGFydGhlaWdodCcpO1xuXG5cdFx0XHQkKCcuc3RyX21vdmVfY2xvbmUnLCBlbCkucmVtb3ZlKCk7XG5cdFx0XHRlbC5vZmYoJ21vdXNlZW50ZXInKTtcblx0XHRcdGVsLm9mZignbW91c2Vkb3duJyk7XG5cdFx0XHRlbC5vZmYoJ21vdXNldXAnKTtcblx0XHRcdGVsLm9mZignbW91c2VsZWF2ZScpO1xuXHRcdFx0ZWwub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdGVsLnJlbW92ZUNsYXNzKCdub1N0b3AnKS5yZW1vdmVDbGFzcygnc3RyX3ZlcnRpY2FsJykucmVtb3ZlQ2xhc3MoJ3N0cl9hY3RpdmUnKS5yZW1vdmVDbGFzcygnbm9fZHJhZycpLnJlbW92ZUNsYXNzKCdzdHJfc3RhdGljJykucmVtb3ZlQ2xhc3MoJ3N0cl9yaWdodCcpLnJlbW92ZUNsYXNzKCdzdHJfZG93bicpO1xuXG5cdFx0XHR2YXIgZWxTdHlsZSA9IGVsLmF0dHIoJ3N0eWxlJyk7XG5cdFx0XHRpZiAoZWxTdHlsZSkge1xuXHRcdFx0XHR2YXIgc3R5bGVBcnIgPSBlbFN0eWxlLnNwbGl0KCc7Jyk7XG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc3R5bGVBcnIubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHR2YXIgc3RyID0gJC50cmltKHN0eWxlQXJyW2ldKTtcblx0XHRcdFx0XHR2YXIgdGVzdGVkID0gc3RyLnNlYXJjaCgvXmhlaWdodC9nKTtcblx0XHRcdFx0XHRpZiAodGVzdGVkICE9IC0xKSB7XG5cdFx0XHRcdFx0XHRzdHlsZUFycltpXSA9ICcnO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHR2YXIgbmV3QXJyID0gc3R5bGVBcnIuam9pbignOycpO1xuXHRcdFx0XHR2YXIgbmV3U3R5bGUgPSBuZXdBcnIucmVwbGFjZSgvOysvZywgJzsnKTtcblxuXHRcdFx0XHRpZiAobmV3U3R5bGUgPT0gJzsnKSB7XG5cdFx0XHRcdFx0ZWwucmVtb3ZlQXR0cignc3R5bGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRlbC5hdHRyKCdzdHlsZScsIG5ld1N0eWxlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzdGFydEhlaWdodCkge1xuXHRcdFx0XHRcdGVsLmNzcyh7IGhlaWdodDogc3RhcnRIZWlnaHQgfSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGVsTW92ZS5zdG9wKHRydWUpO1xuXG5cdFx0XHRpZiAoZWxNb3ZlLmxlbmd0aCkge1xuXHRcdFx0XHR2YXIgY29udGV4dCA9IGVsTW92ZS5odG1sKCk7XG5cdFx0XHRcdGVsTW92ZS5yZW1vdmUoKTtcblx0XHRcdFx0ZWwuaHRtbChjb250ZXh0KTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHBhdXNlOiBmdW5jdGlvbiBwYXVzZSgpIHtcblx0XHRcdHZhciBlbCA9ICQodGhpcyk7XG5cdFx0XHR2YXIgZWxNb3ZlID0gJCgnLnN0cl9tb3ZlJywgZWwpO1xuXHRcdFx0ZWxNb3ZlLnN0b3AodHJ1ZSk7XG5cdFx0fSxcblx0XHRwbGF5OiBmdW5jdGlvbiBwbGF5KCkge1xuXHRcdFx0dmFyIGVsID0gJCh0aGlzKTtcblx0XHRcdCQodGhpcykub2ZmKCdtb3VzZW1vdmUnKTtcblx0XHRcdGVsLmRhdGEoJ21vdmVGJykoKTtcblx0XHR9XG5cblx0fTtcblx0JC5mbi5saU1hcnF1ZWUgPSBmdW5jdGlvbiAobWV0aG9kKSB7XG5cdFx0aWYgKG1ldGhvZHNbbWV0aG9kXSkge1xuXHRcdFx0cmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcblx0XHR9IGVsc2UgaWYgKCh0eXBlb2YgbWV0aG9kID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihtZXRob2QpKSA9PT0gJ29iamVjdCcgfHwgIW1ldGhvZCkge1xuXHRcdFx0cmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQkLmVycm9yKCfQnNC10YLQvtC0ICcgKyBtZXRob2QgKyAnINCyIGpRdWVyeS5saU1hcnF1ZWUg0L3QtSDRgdGD0YnQtdGB0YLQstGD0LXRgicpO1xuXHRcdH1cblx0fTtcbn0pKGpRdWVyeSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIVxuICogalFDbG91ZCBQbHVnaW4gZm9yIGpRdWVyeVxuICpcbiAqIFZlcnNpb24gMS4wLjRcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMSwgTHVjYSBPbmdhcm9cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cbiAqXG4gKiBEYXRlOiAyMDEzLTA1LTA5IDE4OjU0OjIyICswMjAwXG4qL1xuXG4oZnVuY3Rpb24gKCQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgJC5mbi5qUUNsb3VkID0gZnVuY3Rpb24gKHdvcmRfYXJyYXksIG9wdGlvbnMpIHtcbiAgICAvLyBSZWZlcmVuY2UgdG8gdGhlIGNvbnRhaW5lciBlbGVtZW50XG4gICAgdmFyICR0aGlzID0gdGhpcztcbiAgICAvLyBOYW1lc3BhY2Ugd29yZCBpZHMgdG8gYXZvaWQgY29sbGlzaW9ucyBiZXR3ZWVuIG11bHRpcGxlIGNsb3Vkc1xuICAgIHZhciBjbG91ZF9uYW1lc3BhY2UgPSAkdGhpcy5hdHRyKCdpZCcpIHx8IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApLnRvU3RyaW5nKDM2KTtcblxuICAgIC8vIERlZmF1bHQgb3B0aW9ucyB2YWx1ZVxuICAgIHZhciBkZWZhdWx0X29wdGlvbnMgPSB7XG4gICAgICB3aWR0aDogJHRoaXMud2lkdGgoKSxcbiAgICAgIGhlaWdodDogJHRoaXMuaGVpZ2h0KCksXG4gICAgICBjZW50ZXI6IHtcbiAgICAgICAgeDogKG9wdGlvbnMgJiYgb3B0aW9ucy53aWR0aCA/IG9wdGlvbnMud2lkdGggOiAkdGhpcy53aWR0aCgpKSAvIDIuMCxcbiAgICAgICAgeTogKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQgPyBvcHRpb25zLmhlaWdodCA6ICR0aGlzLmhlaWdodCgpKSAvIDIuMFxuICAgICAgfSxcbiAgICAgIGRlbGF5ZWRNb2RlOiB3b3JkX2FycmF5Lmxlbmd0aCA+IDUwLFxuICAgICAgc2hhcGU6IGZhbHNlLCAvLyBJdCBkZWZhdWx0cyB0byBlbGxpcHRpYyBzaGFwZVxuICAgICAgZW5jb2RlVVJJOiB0cnVlLFxuICAgICAgcmVtb3ZlT3ZlcmZsb3dpbmc6IHRydWVcbiAgICB9O1xuXG4gICAgb3B0aW9ucyA9ICQuZXh0ZW5kKGRlZmF1bHRfb3B0aW9ucywgb3B0aW9ucyB8fCB7fSk7XG5cbiAgICAvLyBBZGQgdGhlIFwianFjbG91ZFwiIGNsYXNzIHRvIHRoZSBjb250YWluZXIgZm9yIGVhc3kgQ1NTIHN0eWxpbmcsIHNldCBjb250YWluZXIgd2lkdGgvaGVpZ2h0XG4gICAgJHRoaXMuYWRkQ2xhc3MoXCJqcWNsb3VkXCIpLndpZHRoKG9wdGlvbnMud2lkdGgpLmhlaWdodChvcHRpb25zLmhlaWdodCk7XG5cbiAgICAvLyBDb250YWluZXIncyBDU1MgcG9zaXRpb24gY2Fubm90IGJlICdzdGF0aWMnXG4gICAgaWYgKCR0aGlzLmNzcyhcInBvc2l0aW9uXCIpID09PSBcInN0YXRpY1wiKSB7XG4gICAgICAkdGhpcy5jc3MoXCJwb3NpdGlvblwiLCBcInJlbGF0aXZlXCIpO1xuICAgIH1cblxuICAgIHZhciBkcmF3V29yZENsb3VkID0gZnVuY3Rpb24gZHJhd1dvcmRDbG91ZCgpIHtcbiAgICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byB0ZXN0IGlmIGFuIGVsZW1lbnQgb3ZlcmxhcHMgb3RoZXJzXG4gICAgICB2YXIgaGl0VGVzdCA9IGZ1bmN0aW9uIGhpdFRlc3QoZWxlbSwgb3RoZXJfZWxlbXMpIHtcbiAgICAgICAgLy8gUGFpcndpc2Ugb3ZlcmxhcCBkZXRlY3Rpb25cbiAgICAgICAgdmFyIG92ZXJsYXBwaW5nID0gZnVuY3Rpb24gb3ZlcmxhcHBpbmcoYSwgYikge1xuICAgICAgICAgIGlmIChNYXRoLmFicygyLjAgKiBhLm9mZnNldExlZnQgKyBhLm9mZnNldFdpZHRoIC0gMi4wICogYi5vZmZzZXRMZWZ0IC0gYi5vZmZzZXRXaWR0aCkgPCBhLm9mZnNldFdpZHRoICsgYi5vZmZzZXRXaWR0aCkge1xuICAgICAgICAgICAgaWYgKE1hdGguYWJzKDIuMCAqIGEub2Zmc2V0VG9wICsgYS5vZmZzZXRIZWlnaHQgLSAyLjAgKiBiLm9mZnNldFRvcCAtIGIub2Zmc2V0SGVpZ2h0KSA8IGEub2Zmc2V0SGVpZ2h0ICsgYi5vZmZzZXRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICAvLyBDaGVjayBlbGVtZW50cyBmb3Igb3ZlcmxhcCBvbmUgYnkgb25lLCBzdG9wIGFuZCByZXR1cm4gZmFsc2UgYXMgc29vbiBhcyBhbiBvdmVybGFwIGlzIGZvdW5kXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBvdGhlcl9lbGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChvdmVybGFwcGluZyhlbGVtLCBvdGhlcl9lbGVtc1tpXSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuXG4gICAgICAvLyBNYWtlIHN1cmUgZXZlcnkgd2VpZ2h0IGlzIGEgbnVtYmVyIGJlZm9yZSBzb3J0aW5nXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdvcmRfYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgd29yZF9hcnJheVtpXS53ZWlnaHQgPSBwYXJzZUZsb2F0KHdvcmRfYXJyYXlbaV0ud2VpZ2h0LCAxMCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNvcnQgd29yZF9hcnJheSBmcm9tIHRoZSB3b3JkIHdpdGggdGhlIGhpZ2hlc3Qgd2VpZ2h0IHRvIHRoZSBvbmUgd2l0aCB0aGUgbG93ZXN0XG4gICAgICB3b3JkX2FycmF5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgaWYgKGEud2VpZ2h0IDwgYi53ZWlnaHQpIHtcbiAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSBlbHNlIGlmIChhLndlaWdodCA+IGIud2VpZ2h0KSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdmFyIHN0ZXAgPSBvcHRpb25zLnNoYXBlID09PSBcInJlY3Rhbmd1bGFyXCIgPyAxOC4wIDogMi4wLFxuICAgICAgICAgIGFscmVhZHlfcGxhY2VkX3dvcmRzID0gW10sXG4gICAgICAgICAgYXNwZWN0X3JhdGlvID0gb3B0aW9ucy53aWR0aCAvIG9wdGlvbnMuaGVpZ2h0O1xuXG4gICAgICAvLyBGdW5jdGlvbiB0byBkcmF3IGEgd29yZCwgYnkgbW92aW5nIGl0IGluIHNwaXJhbCB1bnRpbCBpdCBmaW5kcyBhIHN1aXRhYmxlIGVtcHR5IHBsYWNlLiBUaGlzIHdpbGwgYmUgaXRlcmF0ZWQgb24gZWFjaCB3b3JkLlxuICAgICAgdmFyIGRyYXdPbmVXb3JkID0gZnVuY3Rpb24gZHJhd09uZVdvcmQoaW5kZXgsIHdvcmQpIHtcbiAgICAgICAgLy8gRGVmaW5lIHRoZSBJRCBhdHRyaWJ1dGUgb2YgdGhlIHNwYW4gdGhhdCB3aWxsIHdyYXAgdGhlIHdvcmQsIGFuZCB0aGUgYXNzb2NpYXRlZCBqUXVlcnkgc2VsZWN0b3Igc3RyaW5nXG4gICAgICAgIHZhciB3b3JkX2lkID0gY2xvdWRfbmFtZXNwYWNlICsgXCJfd29yZF9cIiArIGluZGV4LFxuICAgICAgICAgICAgd29yZF9zZWxlY3RvciA9IFwiI1wiICsgd29yZF9pZCxcbiAgICAgICAgICAgIGFuZ2xlID0gNi4yOCAqIE1hdGgucmFuZG9tKCksXG4gICAgICAgICAgICByYWRpdXMgPSAwLjAsXG5cblxuICAgICAgICAvLyBPbmx5IHVzZWQgaWYgb3B0aW9uLnNoYXBlID09ICdyZWN0YW5ndWxhcidcbiAgICAgICAgc3RlcHNfaW5fZGlyZWN0aW9uID0gMC4wLFxuICAgICAgICAgICAgcXVhcnRlcl90dXJucyA9IDAuMCxcbiAgICAgICAgICAgIHdlaWdodCA9IDUsXG4gICAgICAgICAgICBjdXN0b21fY2xhc3MgPSBcIlwiLFxuICAgICAgICAgICAgaW5uZXJfaHRtbCA9IFwiXCIsXG4gICAgICAgICAgICB3b3JkX3NwYW47XG5cbiAgICAgICAgLy8gRXh0ZW5kIHdvcmQgaHRtbCBvcHRpb25zIHdpdGggZGVmYXVsdHNcbiAgICAgICAgd29yZC5odG1sID0gJC5leHRlbmQod29yZC5odG1sLCB7IGlkOiB3b3JkX2lkIH0pO1xuXG4gICAgICAgIC8vIElmIGN1c3RvbSBjbGFzcyB3YXMgc3BlY2lmaWVkLCBwdXQgdGhlbSBpbnRvIGEgdmFyaWFibGUgYW5kIHJlbW92ZSBpdCBmcm9tIGh0bWwgYXR0cnMsIHRvIGF2b2lkIG92ZXJ3cml0aW5nIGNsYXNzZXMgc2V0IGJ5IGpRQ2xvdWRcbiAgICAgICAgaWYgKHdvcmQuaHRtbCAmJiB3b3JkLmh0bWxbXCJjbGFzc1wiXSkge1xuICAgICAgICAgIGN1c3RvbV9jbGFzcyA9IHdvcmQuaHRtbFtcImNsYXNzXCJdO1xuICAgICAgICAgIGRlbGV0ZSB3b3JkLmh0bWxbXCJjbGFzc1wiXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIG1pbih3ZWlnaHQpID4gbWF4KHdlaWdodCkgb3RoZXJ3aXNlIHVzZSBkZWZhdWx0XG4gICAgICAgIGlmICh3b3JkX2FycmF5WzBdLndlaWdodCA+IHdvcmRfYXJyYXlbd29yZF9hcnJheS5sZW5ndGggLSAxXS53ZWlnaHQpIHtcbiAgICAgICAgICAvLyBMaW5lYXJseSBtYXAgdGhlIG9yaWdpbmFsIHdlaWdodCB0byBhIGRpc2NyZXRlIHNjYWxlIGZyb20gMSB0byAxMFxuICAgICAgICAgIHdlaWdodCA9IE1hdGgucm91bmQoKHdvcmQud2VpZ2h0IC0gd29yZF9hcnJheVt3b3JkX2FycmF5Lmxlbmd0aCAtIDFdLndlaWdodCkgLyAod29yZF9hcnJheVswXS53ZWlnaHQgLSB3b3JkX2FycmF5W3dvcmRfYXJyYXkubGVuZ3RoIC0gMV0ud2VpZ2h0KSAqIDkuMCkgKyAxO1xuICAgICAgICB9XG4gICAgICAgIHdvcmRfc3BhbiA9ICQoJzxzcGFuPicpLmF0dHIod29yZC5odG1sKS5hZGRDbGFzcygndycgKyB3ZWlnaHQgKyBcIiBcIiArIGN1c3RvbV9jbGFzcyk7XG5cbiAgICAgICAgLy8gQXBwZW5kIGxpbmsgaWYgd29yZC51cmwgYXR0cmlidXRlIHdhcyBzZXRcbiAgICAgICAgaWYgKHdvcmQubGluaykge1xuICAgICAgICAgIC8vIElmIGxpbmsgaXMgYSBzdHJpbmcsIHRoZW4gdXNlIGl0IGFzIHRoZSBsaW5rIGhyZWZcbiAgICAgICAgICBpZiAodHlwZW9mIHdvcmQubGluayA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgd29yZC5saW5rID0geyBocmVmOiB3b3JkLmxpbmsgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBFeHRlbmQgbGluayBodG1sIG9wdGlvbnMgd2l0aCBkZWZhdWx0c1xuICAgICAgICAgIGlmIChvcHRpb25zLmVuY29kZVVSSSkge1xuICAgICAgICAgICAgd29yZC5saW5rID0gJC5leHRlbmQod29yZC5saW5rLCB7IGhyZWY6IGVuY29kZVVSSSh3b3JkLmxpbmsuaHJlZikucmVwbGFjZSgvJy9nLCBcIiUyN1wiKSB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpbm5lcl9odG1sID0gJCgnPGE+JykuYXR0cih3b3JkLmxpbmspLnRleHQod29yZC50ZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbm5lcl9odG1sID0gd29yZC50ZXh0O1xuICAgICAgICB9XG4gICAgICAgIHdvcmRfc3Bhbi5hcHBlbmQoaW5uZXJfaHRtbCk7XG5cbiAgICAgICAgLy8gQmluZCBoYW5kbGVycyB0byB3b3Jkc1xuICAgICAgICBpZiAoISF3b3JkLmhhbmRsZXJzKSB7XG4gICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiB3b3JkLmhhbmRsZXJzKSB7XG4gICAgICAgICAgICBpZiAod29yZC5oYW5kbGVycy5oYXNPd25Qcm9wZXJ0eShwcm9wKSAmJiB0eXBlb2Ygd29yZC5oYW5kbGVyc1twcm9wXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAkKHdvcmRfc3BhbikuYmluZChwcm9wLCB3b3JkLmhhbmRsZXJzW3Byb3BdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkdGhpcy5hcHBlbmQod29yZF9zcGFuKTtcblxuICAgICAgICB2YXIgd2lkdGggPSB3b3JkX3NwYW4ud2lkdGgoKSxcbiAgICAgICAgICAgIGhlaWdodCA9IHdvcmRfc3Bhbi5oZWlnaHQoKSxcbiAgICAgICAgICAgIGxlZnQgPSBvcHRpb25zLmNlbnRlci54IC0gd2lkdGggLyAyLjAsXG4gICAgICAgICAgICB0b3AgPSBvcHRpb25zLmNlbnRlci55IC0gaGVpZ2h0IC8gMi4wO1xuXG4gICAgICAgIC8vIFNhdmUgYSByZWZlcmVuY2UgdG8gdGhlIHN0eWxlIHByb3BlcnR5LCBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gICAgICAgIHZhciB3b3JkX3N0eWxlID0gd29yZF9zcGFuWzBdLnN0eWxlO1xuICAgICAgICB3b3JkX3N0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgICB3b3JkX3N0eWxlLmxlZnQgPSBsZWZ0ICsgXCJweFwiO1xuICAgICAgICB3b3JkX3N0eWxlLnRvcCA9IHRvcCArIFwicHhcIjtcblxuICAgICAgICB3aGlsZSAoaGl0VGVzdCh3b3JkX3NwYW5bMF0sIGFscmVhZHlfcGxhY2VkX3dvcmRzKSkge1xuICAgICAgICAgIC8vIG9wdGlvbiBzaGFwZSBpcyAncmVjdGFuZ3VsYXInIHNvIG1vdmUgdGhlIHdvcmQgaW4gYSByZWN0YW5ndWxhciBzcGlyYWxcbiAgICAgICAgICBpZiAob3B0aW9ucy5zaGFwZSA9PT0gXCJyZWN0YW5ndWxhclwiKSB7XG4gICAgICAgICAgICBzdGVwc19pbl9kaXJlY3Rpb24rKztcbiAgICAgICAgICAgIGlmIChzdGVwc19pbl9kaXJlY3Rpb24gKiBzdGVwID4gKDEgKyBNYXRoLmZsb29yKHF1YXJ0ZXJfdHVybnMgLyAyLjApKSAqIHN0ZXAgKiAocXVhcnRlcl90dXJucyAlIDQgJSAyID09PSAwID8gMSA6IGFzcGVjdF9yYXRpbykpIHtcbiAgICAgICAgICAgICAgc3RlcHNfaW5fZGlyZWN0aW9uID0gMC4wO1xuICAgICAgICAgICAgICBxdWFydGVyX3R1cm5zKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzd2l0Y2ggKHF1YXJ0ZXJfdHVybnMgJSA0KSB7XG4gICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICBsZWZ0ICs9IHN0ZXAgKiBhc3BlY3RfcmF0aW8gKyBNYXRoLnJhbmRvbSgpICogMi4wO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgdG9wIC09IHN0ZXAgKyBNYXRoLnJhbmRvbSgpICogMi4wO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgbGVmdCAtPSBzdGVwICogYXNwZWN0X3JhdGlvICsgTWF0aC5yYW5kb20oKSAqIDIuMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIHRvcCArPSBzdGVwICsgTWF0aC5yYW5kb20oKSAqIDIuMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRGVmYXVsdCBzZXR0aW5nczogZWxsaXB0aWMgc3BpcmFsIHNoYXBlXG4gICAgICAgICAgICByYWRpdXMgKz0gc3RlcDtcbiAgICAgICAgICAgIGFuZ2xlICs9IChpbmRleCAlIDIgPT09IDAgPyAxIDogLTEpICogc3RlcDtcblxuICAgICAgICAgICAgbGVmdCA9IG9wdGlvbnMuY2VudGVyLnggLSB3aWR0aCAvIDIuMCArIHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKSAqIGFzcGVjdF9yYXRpbztcbiAgICAgICAgICAgIHRvcCA9IG9wdGlvbnMuY2VudGVyLnkgKyByYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkgLSBoZWlnaHQgLyAyLjA7XG4gICAgICAgICAgfVxuICAgICAgICAgIHdvcmRfc3R5bGUubGVmdCA9IGxlZnQgKyBcInB4XCI7XG4gICAgICAgICAgd29yZF9zdHlsZS50b3AgPSB0b3AgKyBcInB4XCI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEb24ndCByZW5kZXIgd29yZCBpZiBwYXJ0IG9mIGl0IHdvdWxkIGJlIG91dHNpZGUgdGhlIGNvbnRhaW5lclxuICAgICAgICBpZiAob3B0aW9ucy5yZW1vdmVPdmVyZmxvd2luZyAmJiAobGVmdCA8IDAgfHwgdG9wIDwgMCB8fCBsZWZ0ICsgd2lkdGggPiBvcHRpb25zLndpZHRoIHx8IHRvcCArIGhlaWdodCA+IG9wdGlvbnMuaGVpZ2h0KSkge1xuICAgICAgICAgIHdvcmRfc3Bhbi5yZW1vdmUoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBhbHJlYWR5X3BsYWNlZF93b3Jkcy5wdXNoKHdvcmRfc3BhblswXSk7XG5cbiAgICAgICAgLy8gSW52b2tlIGNhbGxiYWNrIGlmIGV4aXN0aW5nXG4gICAgICAgIGlmICgkLmlzRnVuY3Rpb24od29yZC5hZnRlcldvcmRSZW5kZXIpKSB7XG4gICAgICAgICAgd29yZC5hZnRlcldvcmRSZW5kZXIuY2FsbCh3b3JkX3NwYW4pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB2YXIgZHJhd09uZVdvcmREZWxheWVkID0gZnVuY3Rpb24gZHJhd09uZVdvcmREZWxheWVkKGluZGV4KSB7XG4gICAgICAgIGluZGV4ID0gaW5kZXggfHwgMDtcbiAgICAgICAgaWYgKCEkdGhpcy5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgIC8vIGlmIG5vdCB2aXNpYmxlIHRoZW4gZG8gbm90IGF0dGVtcHQgdG8gZHJhd1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZHJhd09uZVdvcmREZWxheWVkKGluZGV4KTtcbiAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpbmRleCA8IHdvcmRfYXJyYXkubGVuZ3RoKSB7XG4gICAgICAgICAgZHJhd09uZVdvcmQoaW5kZXgsIHdvcmRfYXJyYXlbaW5kZXhdKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRyYXdPbmVXb3JkRGVsYXllZChpbmRleCArIDEpO1xuICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoJC5pc0Z1bmN0aW9uKG9wdGlvbnMuYWZ0ZXJDbG91ZFJlbmRlcikpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuYWZ0ZXJDbG91ZFJlbmRlci5jYWxsKCR0aGlzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIEl0ZXJhdGUgZHJhd09uZVdvcmQgb24gZXZlcnkgd29yZC4gVGhlIHdheSB0aGUgaXRlcmF0aW9uIGlzIGRvbmUgZGVwZW5kcyBvbiB0aGUgZHJhd2luZyBtb2RlIChkZWxheWVkTW9kZSBpcyB0cnVlIG9yIGZhbHNlKVxuICAgICAgaWYgKG9wdGlvbnMuZGVsYXllZE1vZGUpIHtcbiAgICAgICAgZHJhd09uZVdvcmREZWxheWVkKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkLmVhY2god29yZF9hcnJheSwgZHJhd09uZVdvcmQpO1xuICAgICAgICBpZiAoJC5pc0Z1bmN0aW9uKG9wdGlvbnMuYWZ0ZXJDbG91ZFJlbmRlcikpIHtcbiAgICAgICAgICBvcHRpb25zLmFmdGVyQ2xvdWRSZW5kZXIuY2FsbCgkdGhpcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gRGVsYXkgZXhlY3V0aW9uIHNvIHRoYXQgdGhlIGJyb3dzZXIgY2FuIHJlbmRlciB0aGUgcGFnZSBiZWZvcmUgdGhlIGNvbXB1dGF0aXZlbHkgaW50ZW5zaXZlIHdvcmQgY2xvdWQgZHJhd2luZ1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgZHJhd1dvcmRDbG91ZCgpO1xuICAgIH0sIDEwKTtcbiAgICByZXR1cm4gJHRoaXM7XG4gIH07XG59KShqUXVlcnkpOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdnbG9iYWw6bWFwczpHZW9NYXBHb29nbGVWaWV3JywgWydhc3luYyFodHRwOi8vbWFwcy5nb29nbGUuY29tL21hcHMvYXBpL2pzP3Y9My4yMiZrZXk9QUl6YVN5RDJXaHRXdnltVnZhU0ZUanF1Zkd0eEJnZEVhRFFicEV3J10sIGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiBNbi5WaWV3LmV4dGVuZCh7XG5cbiAgICAgICAgdGVtcGxhdGU6IGZhbHNlLFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcbiAgICAgICAgICAgIHRoaXMuJGVsLmNzcyh7IHBvc2l0aW9uOiAnYWJzb2x1dGUnLCB0b3A6IDAsIGxlZnQ6IDAsIGJvdHRvbTogMCwgcmlnaHQ6IDAsIG1hcmdpbjogJy0yMHB4JyB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkF0dGFjaDogZnVuY3Rpb24gb25BdHRhY2goKSB7XG5cbiAgICAgICAgICAgIHZhciB6b29tID0gdGhpcy5tb2RlbC5nZXQoXCJab29tXCIpLFxuICAgICAgICAgICAgICAgIGxhdCA9IHRoaXMubW9kZWwuZ2V0KFwiQ2VudGVyTGF0XCIpLFxuICAgICAgICAgICAgICAgIGxvbmcgPSB0aGlzLm1vZGVsLmdldChcIkNlbnRlckxvbmdcIiksXG4gICAgICAgICAgICAgICAgZmxhZyA9IHpvb20gJiYgbGF0ICYmIGxvbmcsXG4gICAgICAgICAgICAgICAgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpLFxuICAgICAgICAgICAgICAgIG1hcE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgY2VudGVyOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGxhdCB8fCA1NS43NiwgbG9uZyB8fCAzNy42NCksXG4gICAgICAgICAgICAgICAgem9vbTogem9vbSB8fCAxMCxcbiAgICAgICAgICAgICAgICBtYXBUeXBlSWQ6IGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5ST0FETUFQXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAodGhpcy5lbCwgbWFwT3B0aW9ucyk7XG5cbiAgICAgICAgICAgIC8vINC00LvRjyDRgdC+0YXRgNCw0L3QtdC90LjRjyDQv9C+0LfQuNGG0LjQuCDQuCDQvNCw0YHRiNGC0LDQsdCwXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldENlbnRlcigpIHtcblxuICAgICAgICAgICAgICAgIHZhciB6b29tID0gbWFwLmdldFpvb20oKSxcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyID0gbWFwLmdldENlbnRlcigpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmdldChcIlJlYWRPbmx5XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtID0gbmV3IEJhY2tib25lLk1vZGVsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubW9kZWwuZ2V0KCd0aXRsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMubW9kZWwuZ2V0KCd0eXBlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlkOiB0aGlzLm1vZGVsLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpc3VhbGl6YXRpb246IHRoaXMubW9kZWwuZ2V0KCdWaXN1YWxpemF0aW9uJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBDZW50ZXJMYXQ6IGNlbnRlci5sYXQoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIENlbnRlckxvbmc6IGNlbnRlci5sbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFpvb206IHpvb21cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIG0udXJsID0gJy9hcGkvd2lkZ2V0LycgKyB0aGlzLm1vZGVsLmlkICsgJy9zZXRzdGF0ZSc7XG4gICAgICAgICAgICAgICAgICAgIG0uc2F2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgXCJkcmFnZW5kXCIsIHNldENlbnRlci5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgXCJ6b29tX2NoYW5nZWRcIiwgc2V0Q2VudGVyLmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICB2YXIgc2hhcGUgPSB7XG4gICAgICAgICAgICAgICAgY29vcmRzOiBbMSwgMSwgMSwgMjAsIDE4LCAyMCwgMTgsIDFdLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdwb2x5J1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdygpO1xuICAgICAgICAgICAgdmFyIHdpZGdldE1vZGVsID0gdGhpcy5tb2RlbDtcblxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24gKG0pIHtcblxuICAgICAgICAgICAgICAgIGlmIChtLmdldCgnbGF0aXR1ZGUnKSAmJiBtLmdldCgnbG9uZ2l0dWRlJykpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IG0uZ2V0KCdtYXJrZXJ1cmwnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDE3LCAzMiksXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDMyKVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocGFyc2VGbG9hdChtLmdldCgnbGF0aXR1ZGUnKS5yZXBsYWNlKFwiLFwiLCBcIi5cIikpLCBwYXJzZUZsb2F0KG0uZ2V0KCdsb25naXR1ZGUnKS5yZXBsYWNlKFwiLFwiLCBcIi5cIikpKTtcblxuICAgICAgICAgICAgICAgICAgICBib3VuZHMuZXh0ZW5kKHBvc2l0aW9uKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IGltYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGU6IHNoYXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG0uZ2V0KCdkaXNwbGF5X25hbWUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogMVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsIGZ1bmN0aW9uIChtYXJrZXIsIGkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldE1vZGVsLnRyaWdnZXIoJ2NsaWNrOml0ZW0nLCBtKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChtLmdldCgnZGlzcGxheV9uYW1lJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3cub3BlbihtYXAsIG1hcmtlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KG1hcmtlcikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRoaXMpO1xuXG4gICAgICAgICAgICBpZiAoIWZsYWcpIG1hcC5maXRCb3VuZHMoYm91bmRzKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ2VqQ2hhcnRWaWV3JywgWydpMThuIW5scy9yZXNvdXJjZXMubWluJywgJ2dsb2JhbC5jaGFydHMuc2V0dGluZ3Ntb2RlbCcsICdSVSddLCBmdW5jdGlvbiAoUmVzb3VyY2VzLCBzdWJzZXRNb2RlbCkge1xuXG4gICAgcmV0dXJuIE1uLlZpZXcuZXh0ZW5kKHtcblxuICAgICAgICBjbGFzc05hbWU6ICdnLS1jaGFydCcsXG5cbiAgICAgICAgdGVtcGxhdGU6IF8udGVtcGxhdGUoJycpLFxuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3ViTW9kZWwgPSBuZXcgc3Vic2V0TW9kZWwoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdWJzZXQpIHRoaXMuc3ViTW9kZWwuc2V0KHRoaXMub3B0aW9ucy5zdWJzZXQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQmVmb3JlUmVuZGVyOiBmdW5jdGlvbiBvbkJlZm9yZVJlbmRlcigpIHtcblxuICAgICAgICAgICAgdGhpcy4kZWwuYXR0cignaWQnLCAoRGF0ZS5ub3coKS50b1N0cmluZygzNikgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgNSkpLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVuZGVyOiBmdW5jdGlvbiBvblJlbmRlcigpIHtcblxuICAgICAgICAgICAgdmFyIHNNb2RlbCA9IHRoaXMuc3ViTW9kZWw7XG5cbiAgICAgICAgICAgIHRoaXMuJGVsLmNzcygnZGlzcGxheScsICdpbmxpbmUtYmxvY2snKTtcblxuICAgICAgICAgICAgdGhpcy5fZ2V0Q29sb3IoKTtcblxuICAgICAgICAgICAgdGhpcy5lak9wdGlvbnMgPSB7XG5cbiAgICAgICAgICAgICAgICAvL0luaXRpYWxpemluZyBTZXJpZXNcbiAgICAgICAgICAgICAgICBzZXJpZXM6IHRoaXMubW9kZWwuZ2V0KCdmbG93JyksXG5cbiAgICAgICAgICAgICAgICBsb2FkOiBcImxvYWRUaGVtZVwiLFxuXG4gICAgICAgICAgICAgICAgLy9pc1Jlc3BvbnNpdmU6IHRydWUsIENvbnRyb2xzIHdoZXRoZXIgQ2hhcnQgaGFzIHRvIGJlIHJlc3BvbnNpdmUgd2hpbGUgcmVzaXppbmcuIC0g0LTQu9GPINC90LDRgSDQvdC1INC/0L7QtNGF0L7QtNC40YJcbiAgICAgICAgICAgICAgICBsb2NhbGU6IFJlc291cmNlcy5MYW5nLFxuXG4gICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogc01vZGVsLmdldCgnY2hhcnRUaXRsZScpIHx8IHRoaXMubW9kZWwuZ2V0KCduYW1lJykgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlVHJpbTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBzaXplOiB7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLm1vZGVsLmdldCgnd2lkdGgnKSxcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLm1vZGVsLmdldCgnaGVpZ2h0JylcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgLy9Jbml0aWFsaXppbmcgWm9vbWluZ1xuICAgICAgICAgICAgICAgIHpvb21pbmc6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAneCx5JyxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlTW91c2VXaGVlbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2Nyb2xsYmFyOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVEZWZlcnJlZFpvb206IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgbGVnZW5kOiB7XG4gICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHNNb2RlbC5nZXQoJ2xlZ2VuZFZpc2libGUnKSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHNNb2RlbC5nZXQoJ2xlZ2VuZFRpdGxlJylcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2Nyb2xsYmFyOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHNNb2RlbC5nZXQoJ2xlZ2VuZFBvc2l0aW9uJyksXG4gICAgICAgICAgICAgICAgICAgIHJvd0NvdW50OiBpc05hTihwYXJzZUludChzTW9kZWwuZ2V0KCdsZWdlbmRSb3dDb3VudCcpKSkgPyBudWxsIDogcGFyc2VJbnQoc01vZGVsLmdldCgnbGVnZW5kUm93Q291bnQnKSksXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IHNNb2RlbC5nZXQoJ2xlZ2VuZEJvcmRlckNvbG9yJyksXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogaXNOYU4ocGFyc2VJbnQoc01vZGVsLmdldCgnbGVnZW5kQm9yZGVyU2l6ZScpKSkgPyAxIDogcGFyc2VJbnQoc01vZGVsLmdldCgnbGVnZW5kQm9yZGVyU2l6ZScpKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGNoYXJ0Q2xpY2s6IGZ1bmN0aW9uIChhcmdzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyTWV0aG9kKCdjaGFydDpzZWxlY3RlZCcsIHRoaXMpO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCd0eXBlJykgPT09ICdwaWUnKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmVqT3B0aW9ucy5jb21tb25TZXJpZXNPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLm1vZGVsLmdldCgndHlwZScpLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVBbmltYXRpb246IHRydWUsXG5cbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogc01vZGVsLmdldCgndG9vbHRpcFZpc2libGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogc01vZGVsLmdldCgndG9vbHRpcEZvcm1hdCcpXG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnd2hpdGUnXG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgbWFya2VyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhTGFiZWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiBzTW9kZWwuZ2V0KCdkYXRhTGFiZWxWaXNpYmxlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGU6ICdub25lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0b3JMaW5lOiB7IHR5cGU6ICdiZXppZXInLCBjb2xvcjogJ2JsYWNrJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQ6IHsgc2l6ZTogJzE0cHgnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlQ29udHJhc3RDb2xvcjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsUG9zaXRpb246ICdvdXRzaWRlRXh0ZW5kZWQnLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVTbWFydExhYmVsczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmdsZTogMTQ1LFxuXG4gICAgICAgICAgICAgICAgICAgIHBpZUNvZWZmaWNpZW50OiBwYXJzZUZsb2F0KHNNb2RlbC5nZXQoJ3BpZVNpemUnKSksXG4gICAgICAgICAgICAgICAgICAgIC8vZXhwbG9kZUluZGV4OiBpc05hTihwYXJzZUludChzTW9kZWwuZ2V0KCdleHBsb2RlZEluZGV4JykpKSA/IG51bGwgOiBwYXJzZUludChzTW9kZWwuZ2V0KCdleHBsb2RlZEluZGV4JykpLFxuICAgICAgICAgICAgICAgICAgICBleHBsb2RlQWxsOiBzTW9kZWwuZ2V0KCdleHBsb2RlQWxsU2VnbWVudHMnKSxcbiAgICAgICAgICAgICAgICAgICAgZXhwbG9kZTogc01vZGVsLmdldCgnZXhwbG9kZU9uTW91c2VPdmVyJylcblxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZWpPcHRpb25zLnByaW1hcnlYQXhpcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogc01vZGVsLmdldCgncHJpbWFyeVhBeGlzVmlzaWJsZScpLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogeyB0ZXh0OiBzTW9kZWwuZ2V0KCdwcmltYXJ5WEF4aXNUaXRsZScpIH0sXG4gICAgICAgICAgICAgICAgICAgIG1ham9yR3JpZExpbmVzOiB7IHZpc2libGU6IHRydWUsIGNvbG9yOiBcIiNhOWE5YTlcIiwgb3BhY2l0eTogMC4xMiB9LFxuICAgICAgICAgICAgICAgICAgICBsYWJlbEludGVyc2VjdEFjdGlvbjogc01vZGVsLmdldCgncHJpbWFyeVhBeGlzbGFiZWxJbnRyc2VjdEFjdGlvbicpLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVR5cGU6IHRoaXMubW9kZWwuZ2V0KCd4QXhpc1R5cGUnKS50b0xvd2VyQ2FzZSgpXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vSW5pdGlhbGl6aW5nIFByaW1hcnkgWSBBeGlzXHRcbiAgICAgICAgICAgICAgICB0aGlzLmVqT3B0aW9ucy5wcmltYXJ5WUF4aXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIC8vcmFuZ2U6IHsgbWluOiAwLCBtYXg6IDgwLCBpbnRlcnZhbDogMjAgfSxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogc01vZGVsLmdldCgncHJpbWFyeVlBeGlzVmlzaWJsZScpLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogeyB0ZXh0OiBzTW9kZWwuZ2V0KCdwcmltYXJ5WUF4aXNUaXRsZScpIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vcmFuZ2U6IHRoaXMuZ2V0UmFuZ2UoKSxcbiAgICAgICAgICAgICAgICAgICAgbWFqb3JHcmlkTGluZXM6IHsgdmlzaWJsZTogdHJ1ZSwgY29sb3I6IFwiI2E5YTlhOVwiLCBvcGFjaXR5OiAwLjEyIH0sXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsSW50ZXJzZWN0QWN0aW9uOiBzTW9kZWwuZ2V0KCdwcmltYXJ5WUF4aXNsYWJlbEludHJzZWN0QWN0aW9uJyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlVHlwZTogdGhpcy5tb2RlbC5nZXQoJ3lBeGlzVHlwZScpLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy9Jbml0aWFsaXppbmcgQ29tbW9uIFByb3BlcnRpZXMgZm9yIGFsbCB0aGUgc2VyaWVzXG4gICAgICAgICAgICAgICAgdGhpcy5lak9wdGlvbnMuY29tbW9uU2VyaWVzT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5tb2RlbC5nZXQoJ3R5cGUnKSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlQW5pbWF0aW9uOiB0cnVlLFxuXG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHNNb2RlbC5nZXQoJ3Rvb2x0aXBWaXNpYmxlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHNNb2RlbC5nZXQoJ3Rvb2x0aXBGb3JtYXQnKVxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hhcGU6IHNNb2RlbC5nZXQoJ21hcmtlclNoYXBlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBzTW9kZWwuZ2V0KCdtYXJrZXJIZWlnaHQnKSwgd2lkdGg6IHNNb2RlbC5nZXQoJ21hcmtlcldpZHRoJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiBzTW9kZWwuZ2V0KCdtYXJrZXJWaXNpYmxlJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhTGFiZWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiBzTW9kZWwuZ2V0KCdkYXRhTGFiZWxPcGFjaXR5JyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFBvc2l0aW9uOiBzTW9kZWwuZ2V0KCdkYXRhTGFiZWxQb3NpdGlvbicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHNNb2RlbC5nZXQoJ2RhdGFMYWJlbFZpc2libGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbldpZHRoOiBwYXJzZUZsb2F0KHNNb2RlbC5nZXQoJ2NvbHVtbldpZHRoJykpLFxuXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBwYXJzZUludChzTW9kZWwuZ2V0KCdsaW5lV2lkdGgnKSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyM0MjY4IHZvbGtvdiDQtNC70Y8g0LPRgNCw0YTQuNC60L7Qsiwg0LrQvtGC0L7RgNGL0LUg0LfQsNC60YDQsNGI0LjQstCw0Y7RgiDQvtCx0LvQsNGB0YLQuCwg0L7QsdC70LDRgdGC0Lgg0YHQtNC10LvQsNGC0Ywg0L/QvtC70YPQv9GA0L7Qt9GA0LDRh9C90YvQvNC4XG4gICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3R5cGUnKS5pbmRleE9mKCdhcmVhJykgPj0gMCkgdGhpcy5lak9wdGlvbnMuY29tbW9uU2VyaWVzT3B0aW9ucy5vcGFjaXR5ID0gMC41O1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQXR0YWNoOiBmdW5jdGlvbiBvbkF0dGFjaCgpIHtcblxuICAgICAgICAgICAgdHJ5IHtcblxuICAgICAgICAgICAgICAgIHRoaXMuJGVsLmVqQ2hhcnQodGhpcy5lak9wdGlvbnMpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlLm1lc3NhZ2UsICdjaGFydCBuYW1lIC0gJyArIHRoaXMubW9kZWwuZ2V0KCd0eXBlJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9nZXRDb2xvcjogZnVuY3Rpb24gX2dldENvbG9yKCkge1xuXG4gICAgICAgICAgICB2YXIgcCA9IHRoaXMub3B0aW9ucy5wYWxldHRlO1xuICAgICAgICAgICAgdmFyIGNvbG9yc1ZhbHVlID0gcCA/IHAuV2lkZ2V0UGFyYW1WYWx1ZSA6IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgaWYgKGNvbG9yc1ZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2VyaWVzID0gdGhpcy5tb2RlbC5nZXQoJ2Zsb3cnKS5tYXAoZnVuY3Rpb24gKGVsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsLmZuSWQgJiYgZWwuZm5JZCAhPT0gLTEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBfLmZpbmRXaGVyZShjb2xvcnNWYWx1ZSwgeyAnb2JqZWN0X2lkJzogZWwuZWxJZCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8gJiYgby5jb2xvciAhPT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmlsbCA9IG8uY29sb3I7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5wb2ludHMubWFwKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZmlsbCA9IG8uY29sb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSBlbC5wb2ludHM7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLm1hcChwb2ludHMsIGZ1bmN0aW9uIChlbCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBfLmZpbmRXaGVyZShjb2xvcnNWYWx1ZSwgeyAnb2JqZWN0X2lkJzogZWwuZWxJZCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvICYmIG8uY29sb3IgIT09ICdub25lJykgZWwuZmlsbCA9IG8uY29sb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxuZGVmaW5lKCdnbG9iYWwuY2hhcnRzLnNldHRpbmdzbW9kZWwnLCBbXSwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdHM6IGZ1bmN0aW9uIGRlZmF1bHRzKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyog0JHQsNC30L7QstCw0Y8g0L3QsNGB0YLRgNC+0LnQutCwICovXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL9Cd0LDQuNC80LXQvdC+0LLQsNC90LjQtSDQs9GA0LDRhNC40LrQsFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJ0VGl0bGU6ICcnLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyog0J3QsNGB0YLRgNC+0LnQutCwINC/0L7QtNGB0LrQsNC30LrQuCAqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0J/QvtC60LDQt9Cw0YLRjCDQstGB0L/Qu9GL0LLQsNGO0YnRg9GOINC/0L7QtNGB0LrQsNC30LrRg1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2x0aXBWaXNpYmxlOiB0cnVlLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/QpNC+0YDQvNCw0YIg0LLRgdC/0LvRi9Cy0LDRjtGJ0LXQuSDQv9C+0LTRgdC60LDQt9C60LhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiAnI3Nlcmllcy5uYW1lIyA6ICNwb2ludC55IycsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQnNCw0YDQutC10YAg0LTQsNC90L3Ri9GFXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyVmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJTaGFwZTogJ2NpcmNsZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VySGVpZ2h0OiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJXaWR0aDogMTAsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQnNC10YLQutCwINC00LDQvdC90YvRhVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFMYWJlbFZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFMYWJlbFBvc2l0aW9uOiAndG9wJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhTGFiZWxPcGFjaXR5OiAwLjUsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiDQndCw0YHRgtGA0L7QudC60LAg0LvQtdCz0LXQvdC00YsgKi9cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINCf0L7QutCw0LfRi9Cy0LDRgtGMINC70LXQs9C10L3QtNGDXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVnZW5kVmlzaWJsZTogZmFsc2UsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQl9Cw0LPQvtC70L7QstC+0Log0LvQtdCz0LXQvdC00YtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWdlbmRUaXRsZTogJycsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQoNCw0YHQv9C+0LvQvtC20LXQvdC40LUg0LvQtdCz0LXQvdC00YtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWdlbmRQb3NpdGlvbjogJ0JvdHRvbScsIC8vIExlZnQsIFJpZ2h0LCBUb3AsIEJvdHRvbSAoZGVmYXVsdClcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINCa0L7Qu9C40YfQtdGB0YLQstC+INGA0Y/QtNC+0LIg0LIg0LvQtdCz0LXQvdC00LVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWdlbmRSb3dDb3VudDogbnVsbCwgLy8gTnVtYmVyIG9mIHJvd3MgdG8gYXJyYW5nZSB0aGUgbGVnZW5kIGl0ZW1zLlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0KLQvtC70YnQuNC90LAg0LPRgNCw0L3QuNGG0Ysg0LvQtdCz0LXQvdC00YtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWdlbmRCb3JkZXJTaXplOiAwLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gINCm0LLQtdGCINCz0YDQsNC90LjRhtGLINC70LXQs9C10L3QtNGLXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVnZW5kQm9yZGVyQ29sb3I6ICd0cmFuc3BhcmVudCcsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiDQndCw0YHRgtGA0L7QudC60LAg0L7RgdC10LkgKi9cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGV4Y2x1ZGUgcGllXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQn9C+0LrQsNC30YvQstCw0YLRjCDQvtGB0YwgWFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlYQXhpc1Zpc2libGU6IHRydWUsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAg0J3QsNC40LzQtdC90L7QstCw0L3QuNC1INC+0YHQuCBYXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeVhBeGlzVGl0bGU6ICcnLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0KDQsNGB0L/QvtC70L7QttC10L3QuNC1INC80LXRgtC+0Log0L3QsCDQvtGB0LggWFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlYQXhpc2xhYmVsSW50cnNlY3RBY3Rpb246ICdUcmltJyxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINCf0L7QutCw0LfRi9Cy0LDRgtGMINC+0YHRjCBZXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeVlBeGlzVmlzaWJsZTogdHJ1ZSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICDQndCw0LjQvNC10L3QvtCy0LDQvdC40LUg0L7RgdC4IFlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5WUF4aXNUaXRsZTogJycsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQoNCw0YHQv9C+0LvQvtC20LXQvdC40LUg0LzQtdGC0L7QuiDQvdCwINC+0YHQuCBZXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeVlBeGlzbGFiZWxJbnRyc2VjdEFjdGlvbjogJ1RyaW0nLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTm9uZVx0c3RyaW5nXHRubyBhY3Rpb24gd2lsbCBiZSBwZXJmb3JtIGluIGF4aXMgbGFiZWxzIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUm90YXRlOTBcdHN0cmluZ1x0RGlzcGxheXMgYXhpcyBsYWJlbHMgd2l0aCA5MCBkZWdyZWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJvdGF0ZTQ1XHRzdHJpbmdcdERpc3BsYXlzIGF4aXMgbGFiZWxzIHdpdGggNDUgZGVncmVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcmFwXHRzdHJpbmdcdEF4aXMgbGFiZWxzIHdpbGwgYmUgV3JhcFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JhcEJ5d29yZFx0c3RyaW5nXHRBeGlzIGxhYmVscyB3aWxsIGJlIFdyYXAgYnkgd29yZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJpbVx0c3RyaW5nXHRBeGlzIGxhYmVscyB3aWxsIGJlIHRyaW1tZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhpZGVcdHN0cmluZ1x0QXhpcyBsYWJlbHMgd2lsbCBiZSBoaWRlIHdoZW4gb3ZlcmxhcCB0byBvdGhlcnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE11bHRpcGxlUm93c1x0c3RyaW5nXHRBeGlzIGxhYmVscyB3aWxsIGRpc3BsYXkgdGhlIG5leHQgbGluZSB3aGVuIG92ZXJsYXAgdG8gb3RoZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiDQndCw0YHRgtGA0L7QudC60LAg0LrQvtC70L7QvdC+0LogKi9cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbHVtbiwgYmFyLCBzdGFja2luZ0NvbHVtbjEwMCwgc3RhY2tpbmdDb2x1bW4sIGJhclxuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL9Co0LjRgNC40L3QsCDQutC+0LvQvtC90LrQuFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbldpZHRoOiAwLjcsIC8v0JHRi9C70L4gMVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0KDQsNGB0YHQvtGC0Y/QvdC40LUg0LzQtdC20LTRgyDQutC+0LvQvtC90LrQsNC80LhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5TcGFjaW5nOiAwLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyog0JPRgNCw0YTQuNC6ICovXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsaW5lXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQqNC40YDQuNC90LAg0LvQuNC90LjQuFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogMixcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qINCd0LDRgdGC0YDQvtC50LrQsCDRgdC10LrRhtC40LkgKNC60YDRg9Cz0L7QstCw0Y8g0LTQuNCw0LPRgNCw0LzQvNCwKSAqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGllXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXJpZXMucGllQ29lZmZpY2llbnQgLSDQlNC40LDQvNC10YLRgCDQutGA0YPQs9CwIDAtMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpZVNpemU6IDAuOCxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINCY0L3QtNC10LrRgSDQvtGC0LTQtdC70LXQvdC90L7Qs9C+INGB0LXQs9C80LXQvdGC0LBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2V4cGxvZGVkSW5kZXg6IG51bGwsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDQntGC0LTQtdC70Y/RgtGMINCy0YHQtSDRgdC10LPQvNC10L3RgtGLXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwbG9kZUFsbFNlZ21lbnRzOiBmYWxzZSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlcmllcy5leHBsb2RlINC+0YLQtNC10LvRj9GC0Ywg0YHQtdCz0LzQtdC90YIg0L/RgNC4INC90LDQstC10LTQtdC90LjQuFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGxvZGVPbk1vdXNlT3ZlcjogZmFsc2UsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiDQndCw0YHRgtGA0L7QudC60Lgg0YbQstC10YLQvtCyICovXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvclNldHRpbmdzOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xufSk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5kZWZpbmUoJ3NlcnZpY2VzLmxpYnJhcnkubGlicmFyeVZpZXcnLCBbJ2kxOG4hbmxzL3Jlc291cmNlcy5taW4nLCAnZ2xvYmFsLnJlcXVlc3QucGFyYW0nLCAnZy90cmVlJywgJ2dsb2JhbC5ncmlkLmRhdGFJdGVtc1ZpZXcnXSwgZnVuY3Rpb24gKFJlc291cmNlcywgUGFyYW1WaWV3LCB0cmVlVmlldywgdGFibGVWaWV3KSB7XG5cbiAgICB2YXIgcXVlcnlNb2RlbCA9IG5ldyBCYWNrYm9uZS5Nb2RlbCgpO1xuXG4gICAgdmFyIHF1ZXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuXG4gICAgICAgIHVybDogJy9hcGkvUmVxdWVzdC9FeGVjdXRlVjI/cGFnZT0xJyxcbiAgICAgICAgc3luYzogZnVuY3Rpb24gc3luYyhtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIganNvbiA9IHF1ZXJ5TW9kZWw7XG4gICAgICAgICAgICBqc29uLnNldCgncGFnZScsIHRoaXMudXJsLnNwbGl0KCc/JylbMV0uc3BsaXQoJz0nKVsxXSk7XG4gICAgICAgICAgICBqc29uLnVybCA9IHRoaXMudXJsO1xuICAgICAgICAgICAgQmFja2JvbmUuQ29sbGVjdGlvbi5wcm90b3R5cGUuc3luYy5hcHBseSh0aGlzLCBbJ2NyZWF0ZScsIGpzb24sIG9wdGlvbnNdKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICB2YXIgcGFyYW1ldGVyc1ZpZXcgPSBNbi5Db2xsZWN0aW9uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNsYXNzTmFtZTogXCJwYXJhbXMtY29udGFpbmVyXCIsXG5cbiAgICAgICAgY2hpbGRWaWV3OiBQYXJhbVZpZXcsXG5cbiAgICAgICAgY2hpbGRWaWV3T3B0aW9uczogZnVuY3Rpb24gY2hpbGRWaWV3T3B0aW9ucygpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmlkOiB0aGlzLm9wdGlvbnMucmlkLFxuICAgICAgICAgICAgICAgIGRiYXNlOiB0aGlzLm9wdGlvbnMuZGJhc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW1wdHlWaWV3OiBNbi5WaWV3LmV4dGVuZCh7XG4gICAgICAgICAgICB0ZW1wbGF0ZTogXy50ZW1wbGF0ZShSZXNvdXJjZXMuTiksXG4gICAgICAgICAgICB0ZW1wbGF0ZUNvbnRleHQ6IHsgUmVzb3VyY2VzOiBSZXNvdXJjZXMgfVxuICAgICAgICB9KVxuXG4gICAgfSk7XG5cbiAgICByZXR1cm4gTW4uVmlldy5leHRlbmQoe1xuXG4gICAgICAgIGNsYXNzTmFtZTogJ3JlcXVlc3QtbGlicmFyeScsXG5cbiAgICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlc1snc2VydmljZXMtcmVxdWVzdC1saWJyYXJ5J10sXG4gICAgICAgIHRlbXBsYXRlQ29udGV4dDogeyBSZXNvdXJjZXM6IFJlc291cmNlcyB9LFxuXG4gICAgICAgIGV2ZW50czoge1xuXG4gICAgICAgICAgICBcImNsaWNrIC5ydW46bm90KFtkYXRhLWljb249J2ljb24tbG9hZGVyJ10pXCI6IGZ1bmN0aW9uIGNsaWNrUnVuTm90RGF0YUljb25JY29uTG9hZGVyKCkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy51aS5ydW4uYXR0cignZGF0YS1pY29uJywgJ2ljb24tbG9hZGVyJyk7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmdldENoaWxkVmlldygncGFyYW1zJykuY29sbGVjdGlvbi50b0pTT04oKTtcblxuICAgICAgICAgICAgICAgIHF1ZXJ5TW9kZWwuc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHBhcnNlSW50KHRoaXMucmVxdWVzdElEKSxcbiAgICAgICAgICAgICAgICAgICAgcGFyczogZGF0YVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSBuZXcgcXVlcnkoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NoaWxkVmlldygncmVzdWx0JywgbmV3IHRhYmxlVmlldyh7IGNvbGxlY3Rpb246IGNvbGxlY3Rpb24sIGhpZGVCdXR0b246IHRydWUgfSkpO1xuXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbi5mZXRjaCh7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVzZXQ6IHRydWUsXG5cbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnJ1bi5hdHRyKFwiZGF0YS1pY29uXCIsIFwiaWNvbi1uZXh0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDaGlsZFZpZXcoJ3Jlc3VsdCcpLmdldENoaWxkVmlldygndGFibGUnKS5nZXRDaGlsZFZpZXcoJ2JvZHknKS4kKCcuYnRuLWxpbmsnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoYywgeGhyKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0geGhyLnJlc3BvbnNlSlNPTiA/IHhoci5yZXNwb25zZUpTT04ubXNnIDogbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0pIHRoaXMuZ2V0Q2hpbGRWaWV3KCdyZXN1bHQnKS4kZWwuaHRtbCgnPGkgc3R5bGU9XCJjb2xvcjpyZWRcIj4nICsgUmVzb3VyY2VzLnJlciArICc6IDxici8+eyAnICsgbSArICcgfTwvaT4nKTtlbHNlIHRoaXMuZ2V0Q2hpbGRWaWV3KCdyZXN1bHQnKS4kZWwuaHRtbCgnPGkgc3R5bGU9XCJjb2xvcjpyZWRcIj4nICsgeGhyLnN0YXR1c1RleHQgKyAnPC9pPicpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVpLnJ1bi5hdHRyKFwiZGF0YS1pY29uXCIsIFwiaWNvbi1uZXh0XCIpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVpOiB7XG4gICAgICAgICAgICBydW46ICdidXR0b24ucnVuJyxcbiAgICAgICAgICAgIHJlc3VsdDogJy5yZXN1bHQnLFxuICAgICAgICAgICAgbWFpbjogJy5tYWluJ1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZ2lvbnM6IHtcbiAgICAgICAgICAgIHRyZWU6ICcubGVmdCcsXG4gICAgICAgICAgICBwYXJhbXM6IHsgZWw6ICcucGFyYW1zJywgcmVwbGFjZUVsZW1lbnQ6IHRydWUgfSxcbiAgICAgICAgICAgIHJlc3VsdDogeyBlbDogJ0B1aS5yZXN1bHQnLCByZXBsYWNlRWxlbWVudDogdHJ1ZSB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZW5kZXI6IGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuXG4gICAgICAgICAgICB0aGlzLnVpLnJ1bi5oaWRlKCk7XG5cbiAgICAgICAgICAgIHZhciBjb2xsZWN0aW9uID0gbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbGxlY3Rpb24udXJsID0gJy9hcGkvcmVxdWVzdCcgKyAodGhpcy5vcHRpb25zLndpZGdldFR5cGUgPyAnP3dpZGdldFR5cGU9JyArIHRoaXMub3B0aW9ucy53aWRnZXRUeXBlIDogJycpO1xuXG4gICAgICAgICAgICB0aGlzLnNob3dDaGlsZFZpZXcoJ3RyZWUnLCBuZXcgdHJlZVZpZXcoeyBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uLCBub2RlOiB7IGNoZWNrYm94OiBmYWxzZSB9IH0pKTtcblxuICAgICAgICAgICAgY29sbGVjdGlvbi5mZXRjaCh7IHJlc2V0OiB0cnVlIH0pO1xuXG4gICAgICAgICAgICAvL2lmICh0aGlzLm9wdGlvbnMuaXNEZW1vKSB7XG4gICAgICAgICAgICAvLyAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImlzRGVtb1wiKTtcbiAgICAgICAgICAgIC8vICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCd0cmVlJykuJGVsLnNob3dJbmRpY2F0b3IoKTtcbiAgICAgICAgICAgIC8vICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCd0cmVlJykuY29sbGVjdGlvbi5mZXRjaCh7IHJlc2V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgLy99XG4gICAgICAgICAgICAvL2Vsc2Uge1xuICAgICAgICAgICAgLy8gICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdhdXRob3Jpc2UnLCBuZXcgQXV0aG9yaXNlKTtcbiAgICAgICAgICAgIC8vICAgIHRoaXMuZ2V0Q2hpbGRWaWV3KCdhdXRob3Jpc2UnKS4kZWwuc2hvdygpO1xuICAgICAgICAgICAgLy8gICAgdGhpcy51aS5tYWluLmhpZGUoKTtcbiAgICAgICAgICAgIC8vfVxuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2hpbGR2aWV3Q29udGFpbmVyU2VsZWN0SXRlbTogZnVuY3Rpb24gb25DaGlsZHZpZXdDb250YWluZXJTZWxlY3RJdGVtKHYpIHtcblxuICAgICAgICAgICAgdmFyIHAgPSB2Lm1vZGVsLmdldCgncGFyYW1ldGVycycpIHx8IFtdO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5nZXRSZWdpb24oJ3Jlc3VsdCcpLmhhc1ZpZXcoKSkgdGhpcy5nZXRDaGlsZFZpZXcoJ3Jlc3VsdCcpLiRlbC5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICh2Lm1vZGVsLmdldCgnaXNkb2MnKSkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0SUQgPSB2Lm1vZGVsLmlkO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93Q2hpbGRWaWV3KCdwYXJhbXMnLCBuZXcgcGFyYW1ldGVyc1ZpZXcoeyBjb2xsZWN0aW9uOiBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbihwKSwgZGJhc2U6IHRoaXMub3B0aW9ucy5kYmFzZSB9KSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVpLnJ1bi5zaG93KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0UmVnaW9uKCdwYXJhbXMnKS5oYXNWaWV3KCkpIHRoaXMuZ2V0Q2hpbGRWaWV3KCdwYXJhbXMnKS5jb2xsZWN0aW9uLnJlc2V0KCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVpLnJ1bi5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25DaGlsZHZpZXdBdXRob3JpemVFbmQ6IGZ1bmN0aW9uIG9uQ2hpbGR2aWV3QXV0aG9yaXplRW5kKCkge1xuXG4gICAgICAgICAgICAvL3RoaXMuZ2V0Q2hpbGRWaWV3KCdhdXRob3Jpc2UnKS4kZWwuaGlkZSgpO1xuXG4gICAgICAgICAgICAvL2lmICh0aGlzLmdldFJlZ2lvbignYXV0aG9yaXNlJykuaGFzVmlldygpKVxuICAgICAgICAgICAgLy8gICAgJC5hamF4U2V0dGluZ3MuaGVhZGVycy5rZXkgPSAkLm1lcmdlVXJsUGFyYW0oJC5hamF4U2V0dGluZ3MudXJsLCB7IGRiOiAnZGInICsgdGhpcy5nZXRDaGlsZFZpZXcoJ2F1dGhvcmlzZScpLmNvbGxlY3Rpb24uYXQoMCkuaWQgfSk7XG5cbiAgICAgICAgICAgIC8vdGhpcy5nZXRDaGlsZFZpZXcoJ3RyZWUnKS4kZWwuc2hvd0luZGljYXRvcigpO1xuICAgICAgICAgICAgLy90aGlzLmdldENoaWxkVmlldygndHJlZScpLmNvbGxlY3Rpb24uZmV0Y2goeyByZXNldDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIC8vdGhpcy51aS5tYWluLnNob3coKTtcblxuICAgICAgICAgICAgLy90aGlzLnRyaWdnZXJNZXRob2QoJ2F1dGhvcmlzZTplbmQnKTtcblxuICAgICAgICB9XG5cbiAgICB9KTtcbn0pOyJdfQ==
