"use strict";require.config({paths:{"@":"@Services/library"}}),define(["app","access","i18n!nls/resources.min","global.view.headerView","library.mainView"],function(e,t,i,n,s){return{init:function(){e.access=t.data.Points,e.baseType=t.data.Kind,$.ajaxSetup({headers:{key:$.ajaxSettings.url}}),$(document).find("head>title").text(i.titleReqLib),$(".logo").on("click",function(){location.href=location.pathname}),(new(Mn.Application.extend({region:"main",onStart:function(){this.getRegion().show(new s),(new n).render()}}))).start()}}}),define("services.library.libraryView",["i18n!nls/resources.min","global.request.param","g/tree","global.grid.dataItemsView"],function(e,t,i,n){var s=new Backbone.Model,r=Backbone.Collection.extend({url:"/api/Request/ExecuteV2?page=1",sync:function(e,t,i){var n=s;n.set("page",this.url.split("?")[1].split("=")[1]),n.url=this.url,Backbone.Collection.prototype.sync.apply(this,["create",n,i])}}),o=Mn.CollectionView.extend({className:"params-container",childView:t,childViewOptions:function(){return{rid:this.options.rid,dbase:this.options.dbase}},emptyView:Mn.View.extend({template:_.template(e.N),templateContext:{Resources:e}})});return Mn.View.extend({className:"request-library",template:templates["services-request-library"],templateContext:{Resources:e},events:{"click .run:not([data-icon='icon-loader'])":function(){this.ui.run.attr("data-icon","icon-loader");var t=this.getChildView("params").collection.toJSON();s.set({id:parseInt(this.requestID),pars:t});var i=new r;this.showChildView("result",new n({collection:i,hideButton:!0})),i.fetch({reset:!0,success:function(){this.ui.run.attr("data-icon","icon-next"),this.getChildView("result").getChildView("table").getChildView("body").$(".btn-link").remove()}.bind(this),error:function(t,i){var n=i.responseJSON?i.responseJSON.msg:null;n?this.getChildView("result").$el.html('<i style="color:red">'+e.rer+": <br/>{ "+n+" }</i>"):this.getChildView("result").$el.html('<i style="color:red">'+i.statusText+"</i>"),this.ui.run.attr("data-icon","icon-next")}.bind(this)})}},ui:{run:"button.run",result:".result",main:".main"},regions:{tree:".left",params:{el:".params",replaceElement:!0},result:{el:"@ui.result",replaceElement:!0}},onRender:function(){this.ui.run.hide();var e=new Backbone.Collection;e.url="/api/request"+(this.options.widgetType?"?widgetType="+this.options.widgetType:""),this.showChildView("tree",new i({collection:e,node:{checkbox:!1}})),e.fetch({reset:!0})},onChildviewContainerSelectItem:function(e){var t=e.model.get("parameters")||[];this.getRegion("result").hasView()&&this.getChildView("result").$el.hide(),e.model.get("isdoc")?(this.requestID=e.model.id,this.showChildView("params",new o({collection:new Backbone.Collection(t),dbase:this.options.dbase})),this.ui.run.show()):(this.getRegion("params").hasView()&&this.getChildView("params").collection.reset(),this.ui.run.hide())},onChildviewAuthorizeEnd:function(){}})}),define("library.mainView",["services.library.libraryView"],function(e){return Mn.View.extend({className:"workbench",template:_.template('<div id="need"></div><div id="content"></div>'),regions:{need:{el:"#need",replaceElement:!0},content:{el:"#content",replaceElement:!0}},initialize:function(){Backbone.Radio.channel("Notify").reply("add:dialog",function(e){this.showChildView("need",e)}.bind(this))},onRender:function(){this.showChildView("content",new e({isDemo:!0}))}})});