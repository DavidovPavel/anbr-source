"use strict";require.config({paths:{"@":"@Inquiry"}}),define(["baseurl","access","i18n!nls/resources.min","global.view.headerView","config","tools:sidebar","main","global:collection:dictionary","block:project","block:object","block:check","global.radio.loader"],function(e,t,i,n,o,s,l,a,c,r,d){return{init:function(){$.ajaxSetup({headers:{key:$.ajaxSettings.url+"/wg-"+t.data.WGID}});var e=new s;e.render().$el.insertAfter($("body>header"));var h=Mn.Application.extend({channelName:"app",region:"main",radioEvents:{"start:check":function(e){this.currentChecks.add(e)}},initialize:function(){this.sidebar=e,this.projectBlock=new c({app:this}),this.objectBlock=new r,this.checkBlock=new d,this.currentChecks=new Backbone.Collection,this.Tasks=[],this.model=new Backbone.Model,this.model.on("change:id",function(e,t){t&&e.set({title:null,projectName:null})}),Backbone.Radio.channel("oM").reply("get:app",function(){return g})},onStart:function(){this.showView(new l),t.data.Mode||new m,(new n).render(),Backbone.history.start();var i="Intranet"===t.data.NetVersion?["foreverFrame","serverSentEvents","longPolling"]:["webSockets","foreverFrame","serverSentEvents","longPolling"],o=SJ.iwc.SignalR.getHubProxy("Ticker",{client:{updateRobot:function(e){this.getRegion().hasView()&&this.getView().getRegion("content").hasView()&&this.getView().getChildView("content")._updateStatistic&&this.getView().getChildView("content")._updateStatistic(e)}.bind(this),infoActiveChecks:function(t){if(console.log("Ticker::info active checks >> ",t.join("; ")),this.getRegion().hasView()&&this.getView().getRegion("content").hasView()){if(this.getView().getChildView("content")._addIcon&&this.getView().getChildView("content")._addIcon(t),!this.model.id)return;if(-1===t.indexOf(this.model.id)){var i=this.currentChecks.get(this.model.id);i&&this.currentChecks.remove(i)}else this.currentChecks.get(this.model.id)||this.currentChecks.add(this.model);if(t.length||this.currentChecks.reset(),this.getView().getChildView("content").isProof)if(this.currentChecks.get(this.model.id))try{e.getChildView("children").children.findByModel(e.collection.get("proof")).getChildView("children").children.findByIndex(1).$el.append($('<i class="loading"></i>'))}catch(e){}else e.$el.find(".loading").remove()}}.bind(this)}});SJ.iwc.SignalR.start({transport:i}).done(function(){o.server.startListening($.ajaxSettings.url),console.log("Ticker :: monitoring alerts init",[$.ajaxSettings.url,o]),o.server.pingConnect("done"),setInterval(function(){o.server.pingConnect("done")},3e4)})},getOptions:function(){var e=this;return new Promise(function(t){e.model.get("title")||e.model.get("projectName")?t():e.model.fetch({success:function(){t()}})})},getDataTasksInfo:function(t){return new Promise(function(n){require(["result:proof"],function(o){var s=new Backbone.Collection;s.url="/api/CheckRes/"+g.model.id,g.getView().getRegion("content").show(new o({model:g.model,collection:s})),s.fetch({reset:!0,success:function(){var o=s.map(function(e){var n=t+"/"+e.id;return e.set("data",JSON.parse(e.get("data"))),{id:e.id,path:n,name:"statistic",title:e.get("date")?new Date(e.get("date")).toLocaleString():i.all,children:[{id:"infos",title:i.info2,name:"infos",checkUid:e.get("uid"),path:n+"/infos"},{id:"facts",title:i.titleFacts,name:"facts",checkUid:e.get("uid"),path:n+"/facts"},{id:"docs",title:i.titleDocs,name:"docs",checkUid:e.get("uid"),path:n+"/docs"},{id:"reqs",title:i.info3,name:"requisits",checkUid:e.get("uid"),path:n+"/reqs"}]}},this),l=s.length>1?s.at(1).id:s.at(0).id;if(g.currentChecks.get(g.model.id)){var a=g.currentChecks.get(g.model.id).get("searchTasksInfo")||{checkId:l},c=_.findWhere(o,{id:a.checkId});if(!c){var r=t+"/"+a.checkId,d=_.chain(a.typesOfSearchTasks).map(function(e){return{title:e.m_Item2,id:e.m_Item1,status:"processing",state:"",details:""}}).value();c={id:a.checkId,path:r,uid:a.checkUid,title:(new Date).toLocaleString(),children:[{id:"infos",title:i.info2,name:"infos",path:r+"/infos"},{id:"facts",title:i.titleFacts,name:"facts",path:r+"/facts"},{id:"docs",title:i.titleDocs,name:"docs",path:r+"/docs"},{id:"reqs",title:i.info3,name:"requisits",path:r+"/reqs"}]},o.splice(1,0,c)}l=a.checkId,o.find(function(e){return e.id===l}).data=d,s.add(o)}e.collection.get("proof").set({children:o}),n(l)}})})})},getProofContent:function(t,i){var n=["proof",t],o=this.getView().getChildView("content").collection.get(t),s=e.getChildView("children").children.findByModel(e.collection.get("proof"));o&&($.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.headers.key,{checkuid:o.get("uid")}),i?(this.currentChecks.get(this.model.id)&&SJ.iwc.SignalR.getHubProxy("Ticker",{client:{}}).server.stopMonitoringTasks($.ajaxSettings.headers.key,this.model.id),n.push(i),require(["result:"+i],function(e){this.getView().getChildView("content").showChildView("content",new e({model:g.model}))}.bind(this))):(this.getView().getChildView("content")._showRobotsInfo(t),this.statisticCollection=new Backbone.Collection,this.statisticCollection.url="/api/InterestObj/TotalCheck/"+this.model.id,s.$("#"+t).append($('<i class="loading"></i>')),this.statisticCollection.fetch({reset:!0,success:function(e,i){var n=s.getChildView("children");n.children.findByModel(n.collection.get(t)).getChildView("children").children.each(function(e,t){e.model.set("count"," ( "+i[t]+" )")}),this.currentChecks.get(this.model.id)&&(SJ.iwc.SignalR.getHubProxy("Ticker",{client:{}}).server.startMonitoringTasks($.ajaxSettings.headers.key,this.model.id),console.log("Ticker::start monitoring tasks >> ",[$.ajaxSettings.headers.key,this.model.id])),s.$("#"+t+" i.loading").remove()}.bind(this)})),e.setCurrent(n))}}),u=Mn.AppRouter.extend({controller:{default:function(e){Backbone.history.navigate("projects/my",{trigger:!0})},projects:function(e){g.projectBlock.setModules(e),require([e],function(e){g.getView().getRegion("content").show(new e({collection:new Backbone.Collection,inquiry:g.projectBlock.model}))})},project:function(e,t){Backbone.history.navigate("projects/"+e+"/"+t+"/objects",{trigger:!0})},objects:function(t,n,o){g.attachedView&&g.attachedView.destroy(),$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.url,{prjid:n}),g.projectBlock.model.set({projectId:parseInt(n)}),g.projectBlock.resetModules(),g.getView().getRegion("content").hasView()&&Backbone.Radio.channel("loader").trigger("show",g.getView().getChildView("content").$el,{speed:"fast",overlay:!0}),g.projectBlock.getModel().then(function(){var s=g.getView(),l="projects/"+t+"/"+n,a={origin:"forms.inquiryView",resume:"notesView"},c=a[o]||"project:"+o;s.getChildView("crumbs").collection.reset([{path:"projects/"+t,title:i.ile},{path:l,title:g.projectBlock.model.get("projectName")}]),require([c],function(t){s.getRegion("content").show(new t({model:g.projectBlock.model,hideCancel:!0}));var n=[{id:"objects",className:"inuiry-objects",title:i.a},{id:"origin",className:"origin4",title:i.b},{id:"resume",className:"result",title:i.c}].map(function(e){return e.path=l+"/"+e.id,e});e.collection.reset(n),e.setCurrent([o])})})},addObject:function(e,t,n,o){$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.url,{prjid:e}),Backbone.trigger("message:modal"),a.done(function(s){if(s.length){Backbone.trigger("message:hide");var l=s.findWhere({DicCode:"BySAType"}).get("DicItems"),a=_.findWhere(l,{DicCodeItem:t.toUpperCase()}),c={Project_ID:e};n&&(c[n]=o),require(["forms/"+a.ID+"View","forms/"+a.ID+"Model"],function(e,t){g.attachedView=new e({model:new t(c),DicID:a.ID}),g.getRegion().attachHtml(g.attachedView.render())})}else Backbone.history.back(),Backbone.trigger("message:warning",{message:i.mbfe})},this)},editObject:function(e,t){$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.url,{prjid:e,id:t}),$.get("/api/interestObjects/input/id"+t).done(function(e){var t={10021:1002,10022:1003,10023:1004},i=t[e.typeid];require(["forms/"+i+"View","forms/"+i+"Model"],function(t,n){g.attachedView=new t({model:new n(e),DicID:i}),g.getRegion().attachHtml(g.attachedView.render())})})},toObject:function(e,t,i){Backbone.history.navigate(Backbone.history.fragment+"/reports",{trigger:!0})},object:function(t,n,s,l,a){g.attachedView&&g.attachedView.destroy(),$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.url,{prjid:n,id:s}),g.model.set({id:parseInt(s)}),g.model.url="/api/details/"+s+"?mode=1";var c=g.getView(),r="projects/"+t+"/"+n+"/objects/"+s,d={notes:"notesView",semnet:"global.semnet.layout"},h=a?d[a]||"result:"+a:"result:"+l;c.getChildView("tools").collection.reset(),e.collection.reset(),c.getRegion("content").hasView()&&Backbone.Radio.channel("loader").trigger("show",c.getChildView("content").$el,{speed:"fast",overlay:!0}),g.getOptions().then(function(){c.getChildView("crumbs").collection.reset([{path:"projects/"+t,title:i.ile},{path:"projects/"+t+"/"+g.model.get("projectId"),title:g.model.get("projectName")},{path:r,title:g.model.get("title")}]),require([h],function(t){c.getRegion("content").show(new t({model:g.model})),e.collection.reset(o.pages.result.sidebar(r)),e.setCurrent([l,a]),Backbone.Radio.channel("loader").trigger("hide")})})},proof:function(t,n,s){$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.url,{prjid:n,id:s}),g.model.set({id:parseInt(s),currentCheckId:null}),g.model.url="/api/details/"+s+"?mode=1";var l=g.getView(),a="projects/"+t+"/"+n+"/objects/"+s;l.getChildView("tools").collection.reset(),e.collection.reset(),l.getRegion("content").hasView()&&Backbone.Radio.channel("loader").trigger("show",l.getChildView("content").$el,{speed:"fast",overlay:!0}),g.getOptions().then(function(){l.getChildView("crumbs").collection.reset([{path:"projects/"+t,title:i.ile},{path:"projects/"+t+"/"+g.model.get("projectId"),title:g.model.get("projectName")},{path:a,title:g.model.get("title")}]),e.collection.reset(o.pages.result.sidebar(a)),e.setCurrent(["proof"]),g.getDataTasksInfo(a+"/proof").then(function(e){Backbone.history.navigate(Backbone.history.fragment+"/"+e,{trigger:!0})})})},check:function(t,n,s,l,a){$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.url,{prjid:n,id:s}),g.model.set({id:parseInt(s),currentCheckId:parseInt(l)}),g.model.url="/api/details/"+s+"?mode=1";var c=g.getView();c.getChildView("tools").collection.reset(),c.getRegion("content").hasView()&&Backbone.Radio.channel("loader").trigger("show",c.getChildView("content").$el,{speed:"fast",overlay:!0}),g.getOptions().then(function(){c.getChildView("crumbs").collection.reset([{path:t,title:i.ile},{path:t+"/"+n,title:g.model.get("projectName")},{path:t+"/"+n+"/objects/"+s,title:g.model.get("title")}]),c.getRegion("content").hasView()&&c.getChildView("content").isProof?g.getProofContent(parseInt(l),a):(e.collection.reset(o.pages.result.sidebar(t+"/"+n+"/objects/"+s)),e.setCurrent(["proof"]),g.getDataTasksInfo(t+"/"+n+"/objects/"+s+"/proof").then(function(){g.getProofContent(parseInt(l),a)})),Backbone.Radio.channel("loader").trigger("hide")})},source:function(t,n,s,l,a,c){$.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.url,{prjid:n,id:s}),g.model.set({id:parseInt(s),currentCheckId:parseInt(l),path:t+"/"+n+"/objects/"+s+"/proof"}),g.model.url="/api/details/"+s+"?mode=1";var r=g.getView();r.getChildView("tools").collection.reset(),e.collection.reset(),r.getRegion("content").hasView()&&Backbone.Radio.channel("loader").trigger("show",r.getChildView("content").$el,{speed:"fast",overlay:!0}),g.getOptions().then(function(){r.getChildView("crumbs").collection.reset([{path:t,title:i.ile},{path:t+"/"+n,title:g.model.get("projectName")},{path:t+"/"+n+"/objects/"+s,title:g.model.get("title")}]),require(["source:result"],function(i){r.getRegion("content").show(new i({model:g.model,mode:a,sourceId:c})),e.collection.reset(o.pages.source.sidebar(t+"/"+n+"/objects/"+s)),Backbone.Radio.channel("loader").trigger("hide")})})},print:function(e){require(["print"],function(t){g.getView().getRegion("content").show(new t({model:new Backbone.Model({id:e})}))})},original:function(t,i,n){require(["content:original"],function(o){e.close(),g.getView().getRegion("content").show(new o({id:i,objid:t,pid:n}))})}},appRoutes:{"":"default","projects/:page":"projects","projects/:page/:id":"project","projects/:page/:id/:obj":"objects","projects/:page/:id/objects/:oid":"toObject","projects/:page/:pid/objects/:oid/proof":"proof","(*path)/:pid/objects/:oid/proof/:cid":"check","(*path)/:pid/objects/:oid/proof/:cid/:page":"check","(*path)/:pid/objects/:oid/proof/:cid/:page/:sid":"source","projects/:page/:id/objects/:oid/:content":"object","projects/:page/:id/objects/:oid/:content/:last":"object","project/:id/add/:obj?:field=:value":"addObject","project/:id/add/:obj":"addObject","project/:id/edit/:objid":"editObject","print/:id":"print",":oid/original/:uid":"original",":oid/original/:uid/pid:pid":"original"}}),m=Backbone.View.extend({initialize:function(){var e=Backbone.Radio.channel("Notify");e.request("show:overlay");var t=e.request("once:dialog",{color:"red",header:{manage:[]},content:i.nt0,footer:[{id:"mod",title:i.bb1},{id:"cbd",title:i.bb0,className:"right nest-left"}]});this.listenTo(t,"footer:button:click",function(e){var t=location.pathname.split("/",3).join("/");"mod"===e.model.id&&(location.href="/"),"cbd"===e.model.id&&(location.href=t+"/account/login?returnUrl=inquiry")})}}),g=new h;new u,g.start()}}}),define("block:check",[],function(){return Mn.Object.extend({})}),define("block:object",[],function(){return Mn.Object.extend({})}),define("block:project",["i18n!nls/resources.min","model:project"],function(e,t){return Mn.Object.extend({initialize:function(){this.model=new t,this._getName(),this.model.on("change:projectId",function(e,t){t?e.set("projectName",null):this._getName()},this)},_getName:function(){var t=this;$.get("/api/Inquiry/SeqNumber/0").done(function(i){t.model.set("projectName",e.inquiry+" № "+i)})},getModel:function(){var e=this;return new Promise(function(t){e.model.get("projectName")?t():e.model.fetch({success:function(){t()}})})},setModules:function(e){this._tools(),this._sidebar(e),this._crumbs()},resetModules:function(){this.options.app.getView().getChildView("tools").collection.reset(),this.options.app.getView().getChildView("crumbs").collection.reset(),this.options.app.sidebar.collection.reset()},_sidebar:function(t){this.options.app.sidebar.collection.reset([{id:"my",path:"projects/my",className:"my-inquiry",title:e.myinq},{id:"all",path:"projects/all",className:"all-inquiry",title:e.allinq},{id:"find",path:"projects/find",className:"find-inquiry",title:e.serinq}]),this.options.app.sidebar.setCurrent([t])},_crumbs:function(){this.options.app.getView().getChildView("crumbs").collection.set([{path:"projects/my",title:e.ile}])},_tools:function(){this.options.app.getView().getChildView("tools").collection.reset()}})}),define("ContextMenuCollection",["i18n!nls/resources.min","baseurl"],function(e,t){var i=function(e,t){_.each(e,function(e){e.set("State",t.get("title")),$.get("/api/inquiry/SetState/"+e.id+"?state="+t.id+"&title="+t.get("title"))},this)};return new Backbone.Collection([{id:0,title:e.runagain,icon:"next","data-id":"EA932373-3647-471A-87C1-DDB56657FEBC",cmd:function(e){$.get("/api/interestObjects/input/id"+e[0].id).done(function(e){Backbone.trigger("start:check",e)})}},{id:1,title:e.addbasket,icon:"case","data-id":"B7787886-AF0E-4B5A-9061-49B182200B8C",cmd:function(e,t){Backbone.trigger("basket:add",_.pluck(e,"id"))}},{id:2,title:e.import,icon:"import","data-id":"",cmd:function(e){_.each(e,function(e){$.get("/api/object/import/"+e.id).done(function(e){Backbone.trigger("message:success",{message:e})})}),Backbone.Radio.channel("oM").trigger("hide:form")}},{id:3,title:e.chsta,icon:"status","data-id":"7460E56F-62BD-4C9D-A8E5-5B64373C5131",child:[{id:1,icon:"inwork",title:e.working,cmd:i},{id:2,icon:"finished",title:e.ff,cmd:i},{id:3,icon:"clock",title:e.tm,cmd:i},{id:4,icon:"archive",title:e.ar,cmd:i}]},{id:4,title:e.deleteItem,icon:"trash","data-id":"86056534-0DCB-48CF-B06D-3E8D23FD5001",cmd:function(t,i){Backbone.trigger("message:confirm",{title:e.alert,message:e.askyousure+"<br/>"+e.warndeleteobj,fx:function(){_.each(t,function(e){e.url="/api/inquiry/"+e.id,e.destroy()},this)},ctx:this})}}])}),define("model:object",[],function(){return Backbone.Model.extend({defautls:function(){},url:function(){return"/api/details/"+this.id+"?mode=1"}})}),define("model:project",["i18n!nls/resources.min"],function(e){return Backbone.Model.extend({idAttribute:"projectId",defaults:function(){return{projectId:null,projectName:"",projectCode:"",projectState:"",projectStatus:"",rubrics:null}},validate:function(e,t){var i=[];if($.trim(e.projectName)||i.push({name:"projectName"}),i.length)return i},test:function(e,t){return""===e||new RegExp(t).test(e)},url:function(){return"/api/inquiry/input/"+(this.id?this.id:"")}})}),define("radio:fragments",["i18n!nls/resources.min"],function(e){var t={icon:"icon-gear",title:e.ms,color:"green",toolbar:[{id:"add",icon:"add",className:"add disabled",tooltip:e.add},{id:"rename",icon:"rename",className:"rename disabled",tooltip:e.editItem},{id:"clear",icon:"trash",className:"trash disabled",tooltip:e.deleteItem},{id:"search",className:"search",template:'<span class="g-form--input input-data"><input type="text" name="search-name" value="" class="g-form--input" placeholder="Enter keyword"/><i class="search rtl-1" name="search"></i></span>'}],footer:[{id:"save",title:e.save,className:"right"},{id:"NeedCreateFact",title:e.addFact,className:"left",template:'<input name="<%- id %>" type="checkbox" id="<%- viewid +\'_\'+ id %>" class="g-form--checkbox"><label for="<%- viewid +\'_\'+ id %>"><%- title %></label>'}]};return new(Mn.Object.extend({channelName:"fM",radioEvents:{show:function(e){this.collection=new Backbone.Collection(e.get("Sections")),t.content=new editor({width:540,height:508,value:e.get("Html")}),t.sidebar=new treeView({collection:new Backbone.Collection,selected:this.collection.pluck("id")}),t.sidebar.collection.url="/api/rubrics/notesections/oid"+e.get("checkID"),t.sidebar.collection.fetch({reset:!0}),this.listenTo(t.sidebar,"click:select:input",function(e){if(e.options.parent)if(e.model.get("selected"))this.collection.add({id:e.model.id,title:e.model.get("title"),pid:e.options.model.get("parentid"),"parentТitle":e.options.parent?e.options.parent.get("title"):""});else{var t=this.collection.get(e.model.id);this.collection.remove(t)}});var i=Backbone.Radio.channel("Notify").request("once:dialog",t);this.listenTo(i,"footer:button:click",function(n){"save"===n.model.id&&(e.set({Sections:this.collection.toJSON(),Html:t.content.ejRTE.getHtml(),NeedCreateFact:!!n.model.collection.get("NeedCreateFact").get("selected")}),e.url="/api/CheckNotes?oid="+e.get("checkID"),e.isValid()?e.save({},{wait:!0,success:function(e,t){i.$el.hide(),_.each(t,function(e){Backbone.Radio.channel("fM").trigger("add:new:fragment",new Backbone.Model(e))})}.bind(this)}):i.getChildView("notify").showNotify(e.validationError.join("<br/>")))})}}}))}),define("radio:objectManager",["i18n!nls/resources.min","global.view.dialog"],function(e,t){return new(Mn.Object.extend({channelName:"oM",radioEvents:{"hide:form":function(){this.form&&this.form.destroy()}},radioRequests:{}}))}),define("config",["i18n!nls/resources.min"],function(e){return new(Mn.Object.extend({initialize:function(){this.pages={result:{sidebar:function(t){return[{id:"reports",title:e.c,className:"result"},{id:"proof",title:e.gp,className:"check"}].map(function(e){return e.path=t+"/"+e.id,e})}},source:{sidebar:function(){return[{id:"content",title:e.content,name:"content",children:[]},{id:"links",title:e.titleLinks,name:"source:links"}]}}}}}))}),define("main",["i18n!nls/resources.min","tools:crumbs","tools:top","g/ejRTEView","g/tree","radio:fragments"],function(e,t,i,n,o){return Mn.View.extend({className:"workbench",template:_.template('<div class="crumbs"></div><div class="g-toolbar"></div><div id="need"></div><div id="content"></div>'),regions:{crumbs:".crumbs",tools:".g-toolbar",content:{el:"#content",replaceElement:!0},need:{el:"#need",replaceElement:!0}},initialize:function(){Backbone.Radio.channel("Notify").reply("add:dialog",function(e){this.showChildView("need",e)}.bind(this))},onRender:function(){this.showChildView("crumbs",new t),this.showChildView("tools",new i)},childViewEvents:{"render:tools":function(e){this.getChildView("tools").collection.reset(e)},"render:crumbs":function(e){this.getChildView("crumbs").collection.set(e)},"tools:click:item":function(e){this.getChildView("content")[e.model.id]&&this.getChildView("content")[e.model.id](e),this.getChildView("content").hasRegion("content")&&this.getChildView("content").getChildView("content")[e.model.id]&&this.getChildView("content").getChildView("content")[e.model.id](e)}}})}),define("print",["i18n!nls/resources.min"],function(e){var t=Mn.View.extend({template:_.template('\n<div class ="note-head">\n        <% if(title.toLowerCase().indexOf(Resources.nt) !==-1) { %>\n        <span data-icon="icon-attention" color-icon="red"></span>\n        <% } %>\n        <span><%-title %></span>\n</div>\n<div class ="child-container">\n        <% _.each(collection, function(m) { %>\n        <div class ="note"><div class ="note-text"><%= m.Html %></div></div>\n        <% }) %>\n</div>\n<div class ="child"></div>'),templateContext:{Resources:e},regions:{child:{el:".child",replaceElement:!0}},onRender:function(){this.model.get("Childs")&&this.showChildView("child",new i({collection:new Backbone.Collection(this.model.get("Childs"))}))}}),i=Mn.CollectionView.extend({childView:t}),n=Mn.View.extend({tagName:"h3",template:_.template('<a href="javascript:print();"><span data-icon="icon-printer"></span><%- Resources.print %></a><%- Resources.ant %> "<%- title %>"'),templateContext:{Resources:e}});return Mn.View.extend({className:"wrap preview",template:_.template('<h3></h3><div class="list"></div>'),regions:{head:{el:"h3",replaceElement:!0},list:{el:".list",replaceElement:!0}},modelEvents:{sync:function(){this.showChildView("head",new n({model:this.model})),$(document).find("head>title").text(this.model.get("title")+" :: "+e.expnote)}},onRender:function(){this.model.url="/api/details/"+this.model.id+"?mode=1",this.model.fetch(),this.collection=new Backbone.Collection,this.collection.url="/api/CheckNotes/"+this.model.id,this.collection.fetch({reset:!0}),this.showChildView("list",new i({collection:this.collection}))}})}),define("forms/1002Model",["access","i18n!nls/resources.min"],function(e,t){return Backbone.Model.extend({url:function(){return"/api/object/"},defaults:function(){return{id:null,AutoExtractionIsActive:!1,typeid:e.data.Meta.SaTypes.Person,typeSystemName:"Person",RelationsDescriptionData:{Kind:0,Roles:{}},Rubrics:[],ProjectRole_ID:4,universalname_INTERN:"",selectedCountries:[],lname_INTERN:"",fname_INTERN:"",mname_INTERN:"",pname_INTERN:"",title_INTERN:"",searchSin_INTERN:!0,searchByInitials_INTERN:!0,birthDateUsingKind_INTERN:0,birthDateExact_INTERN:"",birthDateFrom_INTERN:"",birthDateTo_INTERN:"",age_INTERN:null,ageFromTo_INTERN:null,synonyms_INTERN:[],Robots:[],AttacheedFiles:{},pasSerial__ru_RU:"",pasNumber__ru_RU:"",pasDate__ru_RU:"",inn__ru_RU:"",ogrnip__ru_RU:"",inn__uk_UA:"",pasSerial__uk_UA:"",pasNumber__uk_UA:"",pasDate__uk_UA:"",pasSerial__kk_KZ:"",pasNumber__kk_KZ:"",pasDate__kk_KZ:"",inn__kk_KZ:"",inn__vi_VN:"",IdentityCard__ms_MY:"",Police__ms_MY:"",Army__ms_MY:"",PassportNo__ms_MY:"",TaxNumber__zh_CN:"",TaxNumber__zh_HK:"",TaxNumber__zh_TW:""}},validate:function(e,i){var n=[],o="^[\\d]+$";if($.trim(e.lname_INTERN)||n.push({name:"lname_INTERN"}),this.set("birthDateExact_INTERN",$.ToISO(e.birthDateExact_INTERN)),this.set("birthDateFrom_INTERN",$.ToISO(e.birthDateFrom_INTERN)),this.set("birthDateTo_INTERN",$.ToISO(e.birthDateTo_INTERN)),this.set("pasDate__ru_RU",$.ToISO(e.pasDate__ru_RU)),this.set("pasDate__uk_UA",$.ToISO(e.pasDate__uk_UA)),this.set("pasDate__kk_KZ",$.ToISO(e.pasDate__kk_KZ)),$.trim(e.ProjectRole_ID)||n.push({name:"ProjectRole_ID"}),e.selectedCountries?this.set("selectedCountries",_.flatten([e.selectedCountries])):n.push({name:"selectedCountries"}),e.ageFromTo_INTERN&&!e.age_INTERN&&n.push({name:"age_INTERN"}),this.test(e.age_INTERN,o)||this.set("age_INTERN",""),this.test(e.ageFromTo_INTERN,o)||this.set("ageFromTo_INTERN",""),this.test(e.pasSerial__ru_RU,o)||n.push({name:"pasSerial__ru_RU"}),this.test(e.pasNumber__ru_RU,o)||n.push({name:"pasNumber__ru_RU"}),e.pasSerial__ru_RU&&e.pasNumber__ru_RU&&this.set("pass",e.pasSerial__ru_RU+" "+e.pasNumber__ru_RU),this.test(e.inn__ru_RU,o)){if(10===e.inn__ru_RU.length){for(var s=e.inn__ru_RU.split(""),l=[2,4,10,3,5,9,4,6,8],a=0,c=0;c<l.length;c++)a+=l[c]*s[c];var r=11*parseInt(a/11),d=a-r;10===d&&(d=0),d!==s[9]&&n.push({text:t.errorInn,name:"inn__ru_RU"})}}else n.push({name:"inn__ru_RU"});if(this.test(e.ogrnip__ru_RU,o)){if($.trim(e.ogrnip__ru_RU)){var h=parseInt(e.ogrnip__ru_RU.substr(0,1));3===h||4===h||n.push({text:t.errorIgrul,name:"ogrnip__ru_RU"})}}else n.push({name:"ogrnip__ru_RU"});var u=$.trim(e.lname_INTERN+" "+e.fname_INTERN+" "+e.mname_INTERN);if(u&&this.set("title_INTERN",u),n.length)return n},test:function(e,t){return""===e||new RegExp(t).test(e)}})}),define("forms/1003Model",["access","i18n!nls/resources.min"],function(e,t){return Backbone.Model.extend({url:function(){return"/api/object/"},defaults:function(){return{id:null,AutoExtractionIsActive:!1,typeid:e.data.Meta.SaTypes.Organization,typeSystemName:"Organization",RelationsDescriptionData:{Kind:0,Roles:{}},Rubrics:[],ProjectRole_ID:4,selectedCountries:[],searchSin_INTERN:!0,synonyms_INTERN:[],title_INTERN:"",Robots:[],AttacheedFiles:{},inn__ru_RU:"",ogrn__ru_RU:"",okpo__ru_RU:"",address_INTERN:"",address__ru_RU:"",edrpou__uk_UA:"",inn__kk_KZ:"",rnn__kk_KZ:"",bin__kk_KZ:"",unp__bl_BL:"",inn__vi_VN:"",ogrn__vi_VN:"",RegistrationNumber__zh_CN:"",TaxID__zh_TW:"",RegistrationNumber__zh_TW:"",RegistrationNumber__zh_HK:""}},validate:function(e,i){var n=[],o="^[\\d]+$";if($.trim(e.ProjectRole_ID)||n.push({name:"ProjectRole_ID"}),e.selectedCountries?_.isString(e.selectedCountries)?this.set("selectedCountries",_.flatten([e.selectedCountries])):e.selectedCountries.length||n.push({name:"selectedCountries"}):n.push({name:"selectedCountries"}),$.trim(e.title_INTERN)||n.push({name:"title_INTERN"}),this.test(e.inn__ru_RU,o)||n.push({name:"inn__ru_RU"}),this.test(e.ogrn__ru_RU,o)){if(e.ogrn__ru_RU){var s=e.ogrn__ru_RU,l=13===s.length&&s.slice(12,13)===(s.slice(0,-1)%11+"").slice(-1);l||n.push({text:t.errorOgrn,name:"ogrn__ru_RU"})}}else n.push({name:"ogrn__ru_RU"});if(this.test(e.okpo__ru_RU,o)||n.push({name:"okpo__ru_RU"}),n.length)return n},test:function(e,t){return""===e||new RegExp(t).test(e)}})}),define("forms/FormView",["i18n!nls/resources.min","global.behaviors.input"],function(e,t){var i=Mn.View.extend({className:"grid--1-1",template:_.template('<div class="inputData"></div><div class="list-edit"></div>'),regions:{input:{el:".inputData",replaceElement:!0},list:{el:".list-edit",replaceElement:!0}},onRender:function(){this.showChildView("input",this.options.inputForm),this.showChildView("list",this.options.listView)}});return Mn.View.extend({tagName:"main",className:"wizzard",template:templates["form-container"],templateContext:{Resources:e},behaviors:{input:t},ui:{create:"button[name=create]",next:"button[name=next]",back:"button[name=back]"},regions:{content:{el:"div",replaceElement:!0}},addEvents:{},events:function(){return _.extend({},this.originalEvents,this.addEvents)},originalEvents:{"click .acc>legend":function(e){$(e.target).parent("fieldset").toggleClass("current").children(".row").slideToggle(200)},"input .check-key":function(e){var t=$.GetData(this.getChildView("content").$el);this.model.set(t),this.getChildView("content").getChildView("synonims").collection.reset()},"blur .check-blur":function(e){var t=$.GetData(this.getChildView("content").$el);this.model.set(t,{validate:!0})},"click @ui.create:not(.disabled)":function(e){this.model.url="/api/startTaskExpress/"+this.model.get("typeid")+"?start=0&sp=",this.model.id||this._send(!1)},"click @ui.next:not(.disabled)":function(){var e=this.master.get("step");e++,"Organization"===this.model.get("typeSystemName")&&-1===["ru-RU","kk-KZ"].indexOf(this.model.get("selectedCountries")[0])&&1===e&&(e=2),this.master.set("step",e)},"click @ui.back:not(.disabled)":function(){var e=this.master.get("step");e--,"Organization"===this.model.get("typeSystemName")&&-1===["ru-RU","kk-KZ"].indexOf(this.model.get("selectedCountries")[0])&&1===e&&(e=0),e>=0&&this.master.set("step",e)},"click button[name=cancel]":function(){this.destroy(),Backbone.history.history.back()}},onRender:function(){this._getPage(),this.model.id&&(this.ui.create.attr("style","display:none!important"),this.ui.next.removeClass("disabled"))},modelEvents:{change:function(){this.model.isValid()&&"string"!=typeof this.ui.create&&(this.ui.create.removeClass("disabled"),this.ui.next.removeClass("disabled"))},invalid:function(e,t){this._resetError(),this.ui.create.addClass("disabled"),this.ui.next.addClass("disabled"),_.each(t,function(e){"selectedCountries"===e.name?this.getChildView("content").getChildView("countries").$("select").addClass("error"):this.$("[name='"+e.name+"']").addClass("error")},this),setTimeout(this._resetError.bind(this),3e3)}},childViewEvents:{"collections:robors:selected":function(e){this.model.url="/api/startTaskExpress/"+this.model.get("typeid")+"?start=1&sp="+e.get("SearchPackUID"),this.ui.next.removeClass("disabled")}},_getPage:function(){var t=this.master.get("step"),i=this.master.get("pages"),n=i[t];if(t>i.length-1)return void this._send(!0);(0===t||this.model.isValid())&&this.showChildView("content",new n({model:this.model,DicID:this.options.DicID})),0===t?this.ui.back.addClass("disabled"):this.ui.back.removeClass("disabled"),t===i.length-1?this.ui.next.text(this.model.id?e.startSearch:e.c2s).addClass("disabled"):this.ui.next.text(e.next)},_send:function(t){if(t&&!this.getChildView("content").getChildView("robots").current)return void Backbone.trigger("message:warning",{message:e.errorselsources});this.model.isValid()&&(Backbone.trigger("message:modal",{title:e.wait2,message:t?e.message2:""}),this.model.save({},{wait:!0,success:function(e,i){Backbone.trigger("message:hide"),this.model.id||this.model.set("id",e.get("objectId")),t&&(e.set("searchTasksInfo",i),Backbone.Radio.channel("app").trigger("start:check",e),Backbone.history.navigate("projects/my/"+e.get("Project_ID")+"/objects/"+e.id+"/proof",{trigger:!0}))}.bind(this),error:function(){Backbone.trigger("message:hide")}}),this.destroy())},_resetError:function(){this.$("input").removeClass("error"),this.$("textarea").removeClass("error"),this.$("select").removeClass("error")},initAttach:function(){var t=_.map(this.model.get("AttacheedFiles"),function(e,t){return{FileName:t,FilePath:e}}),n=new Backbone.Collection(t),o=new UploadFileView({collection:n}),s=new EditListView({collection:n,titleAttribute:"FileName"}),l=new i({inputForm:o,listView:s});this.listenTo(s.collection,"update",function(){this.$(".amount-files").text(s.collection.length),this._saveFiles(n)}),this.listenTo(s,"list:item:save",function(e){this._saveFiles(n)}),this.listenTo(s,"list:item:clear",function(t){Backbone.trigger("message:confirm",{title:e.askyousure,message:"",fx:function(){t.model.collection.remove(t.model),this._saveFiles(n)},ctx:this})}),this.listenTo(s,"list:item:view",function(e){window.open(e.model.get("FilePath"))}),this.$(".amount-files").text(t.length),this.showChildView("filesArea",l)},_saveFiles:function(e){var t={};e.each(function(e){t[e.get("FileName")]=e.get("FilePath")}),this.model.set("AttacheedFiles",t)}})}),define("notesView",["i18n!nls/resources.min","g/ejRTEView","global.view.dropDown","projects:resultCollection"],function(e,t,i,n){var o=Backbone.Model.extend({defaults:{id:null,oid:null,NoteHtml:"",State:0,StateTitle:"",printUrl:"",pref:"GetResume?oid="},url:function(){
return"/Api/InquiryResume/"+this.get("pref")+this.get("oid")}}),s=Mn.CollectionView.extend({childView:Mn.View.extend({className:"note",template:templates["note-fragment"],ui:{text:".note-text",ep:".editing-note"},triggers:{"click .note-text":"note:edit:show"},events:{"click i[data-icon]":function(e){this[$(e.target).attr("data-icon").split("-")[1]]()}},modelEvents:{sync:function(){this.triggerMethod("model:sync")},destroy:function(){this.triggerMethod("model:sync")},"change:cdate":function(e,t){$.get("/api/CheckNotes/SetPos/"+this.options.oid+"/"+this.model.id+"/"+t).done(function(){e.collection.sort()})}},editor:function(){this.model.set("checkID",this.options.oid),Backbone.Radio.channel("fM").trigger("show",this.model)},anchor:function(){},up:function(){var e=this._index;if(0!==e){var t=this.model.collection.at(e-1);this.model.set("cdate",t.get("cdate")-6e8)}},down:function(){var e=this.model.collection.length-1,t=this._index;if(t!==e){var i=this.model.collection.at(t+1);this.model.set("cdate",i.get("cdate")+6e8)}},first:function(){if(0!==this._index){var e=this.model.collection.at(0);this.model.set("cdate",e.get("cdate")-6e8)}},last:function(){var e=this.model.collection.length-1;if(this._index!==e){var t=this.model.collection.at(e);this.model.set("cdate",t.get("cdate")+6e8)}},trash:function(){this.model.url="/api/CheckNotes/"+this.options.oid+"?uid="+this.model.id,this.model.destroy()}}),childViewOptions:function(){return{oid:this.options.oid}},childViewTriggers:{"model:sync":"note:model:sync","note:edit:show":"note:edit:show"}}),l=Mn.CollectionView.extend({childView:Mn.View.extend({template:templates["note-item"],templateContext:{Resources:e},regions:{notes:".notes-container",child:".child-container"},onRender:function(){var e=new Backbone.Collection(this.model.get("collection"));e.comparator=function(e){return e.get("cdate")},this.showChildView("notes",new s({collection:e,oid:this.options.oid})),this.model.get("Childs")&&this.showChildView("child",new l({collection:new Backbone.Collection(this.model.get("Childs")),oid:this.options.oid}))},onChildvewiNoteEditShow:function(){},childViewTriggers:{"note:edit:show":"note:edit:show","note:model:sync":"note:model:sync"}}),childViewOptions:function(){return{oid:this.options.oid}},childViewTriggers:{"note:edit:show":"note:edit:show","note:model:sync":"note:model:sync"}});return Mn.View.extend({className:"workbench--content",template:templates["notes-project"],templateContext:{Resources:e},regions:{notes:".notes",editor:".htmlEditor"},ui:{print:".explan-note>h3>a",notes:".explan-note"},initialize:function(){this.collection=new Backbone.Collection,this.model.has("title")&&(this.options.isAnal=!0,this.options.url=function(){return"/Api/CheckResume/"+this.get("pref")+this.get("oid")});var e=this.model.id||this.model.get("projectId");this.model=new o({oid:e,printUrl:"#/print/"+e}),this.options.url&&(this.model.url=this.options.url)},onAttach:function(){this.showChildView("editor",new t({height:.8*this.$el.height()})),this.model.fetch()},modelEvents:{"change:printUrl":function(e,t){this.ui.print.attr("href",t)},sync:function(t,o){o&&o.length&&this.model.set(o[0]),!this.model.get("NoteHtml")&&this.options.isAnal&&this.model.set("NoteHtml",e.noteTemplate),this.getChildView("editor").ejRTE.option("value",this.model.get("NoteHtml")),this.showChildView("notes",new l({collection:this.collection,oid:this.model.get("oid")}));var s=[{id:"_saveNotes",className:"save",title:e.save,side:"left"},{id:"_topChangeState",side:"right",isView:!0,view:i,options:{collection:n,current:this.model.get("State")}}];this.triggerMethod("render:tools",s),this.collection.url="/api/CheckNotes/"+this.model.get("oid"),this.collection.fetch({reset:!0})}},collectionEvents:{reset:function(){this.collection.length?this.ui.notes.show():this.ui.notes.hide()}},childViewEvents:{"note:model:sync":function(){this.collection.fetch({reset:!0})},"note:edit:show":function(e){this.getChildView("notes").children.each(function(e){e.getChildView("notes").children.each(function(e){e.ui.ep.hide(),e.ui.text.removeClass("note-editing")}),e.getRegion("child").hasView()&&e.getChildView("child").children.each(function(e){e.getChildView("notes").children.each(function(e){e.ui.ep.hide(),e.ui.text.removeClass("note-editing")})})}),e.ui.text.addClass("note-editing"),e.ui.ep.show()}},_topChangeState:function(e){var t=e.getChildView("vv").current;this.model.set({State:t.id,StateTitle:t.get("title")})},_saveNotes:function(e){this.model.set("pref","Add?oid="),this.model.save({NoteHtml:this.getChildView("editor").ejRTE.getHtml()})}})}),define("content:original",["i18n!nls/resources.min"],function(e){return Mn.View.extend({className:"workbench--content",template:_.template('<div id="content"></div>'),regions:{content:{el:"#content",replaceElement:!0}},initialize:function(){this.model=new Backbone.Model,this.model.url="/api/original/startconvert?id="+this.options.objid+(this.options.pid?"&pid="+this.options.pid:"")},onRender:function(){Backbone.trigger("message:modal"),this.$el.text(e.convert+", "+e.wait+"..."),this.model.fetch()},modelEvents:{error:function(){this.model.set("Status",500)},"change:Status":function(t,i){switch(i){case 0:this.counter=0,this.si=setInterval(function(){this.counter++,this.counter>50?(clearInterval(this.si),Backbone.trigger("message:hide"),this.$el.html('<div class="g-notice sad">'+e.timeended+"</div>")):$.get(this.model.get("ConvertedCheckLink")).done(function(e){this.model.set("Status",e)}.bind(this)).fail(function(){this.model.set("Status",500)})}.bind(this),3e3);break;case 200:clearInterval(this.si),Backbone.trigger("message:hide"),this.$el.find("iframe").size()?$.xhrAbortAll():this.$el.html('<iframe src="'+this.model.get("FileUrl")+"\" style='width:98%;height:99%;'></iframe>");var n={id:"link",url:this.model.get("FileOriginalUrl"),className:"export",title:this.model.has("OriginalFileName")?this.model.get("OriginalFileName"):e.dod,template:'<a toolbar-icon="export" href="<%= url %>" target="_blank"><i><%- title %></i></a>'};Backbone.Radio.channel("tools").request("get:tools").collection.reset(n);break;case 404:case 500:clearInterval(this.si),Backbone.trigger("message:hide"),this.$el.html('<div class="g-notice sad">'+e.ndso+'<br/><a href="'+this.model.get("FileOriginalUrl")+'">'+e.dod+"</a></div>")}}}})}),define("project:objects",["i18n!nls/resources.min","baseurl","global.grid.dataItemsView","global.view.dropDown"],function(e,t,i,n){var o=function(e,t){_.each(e,function(e){e.set("State",t.get("title")),$.get("/api/InterestObj/SetState/"+e.id+"?state="+t.id+"&title="+t.get("title"))},this)},s=new Backbone.Collection([{title:e.runagain,icon:"next","data-id":"EA932373-3647-471A-87C1-DDB56657FEBC",cmd:function(e){Backbone.history.navigate("project/"+this.options.projectId+"/edit/"+e[0].id,{trigger:!0})}},{title:e.addbasket,icon:"case","data-id":"B7787886-AF0E-4B5A-9061-49B182200B8C",cmd:function(e,t){Backbone.trigger("basket:add",_.pluck(e,"id"))}},{title:e.chsta,icon:"status","data-id":"7460E56F-62BD-4C9D-A8E5-5B64373C5131",child:[{id:1,icon:"inwork",title:e.working,cmd:o},{id:2,icon:"finished",title:e.ff,cmd:o},{id:3,icon:"clock",title:e.tm,cmd:o},{id:4,icon:"archive",title:e.ar,cmd:o}]},{title:e.deleteItem,icon:"trash","data-id":"86056534-0DCB-48CF-B06D-3E8D23FD5001",cmd:function(t,i){Backbone.trigger("message:confirm",{title:e.alert,message:e.askyousure+"<br/>"+e.warndeleteobj,fx:function(){_.each(t,function(e){e.url="/api/object/"+e.id,e.destroy()},this)},ctx:this})}}]),l=new Backbone.Collection([{id:0,icon:"icon-all",title:e.fva},{id:1,icon:"icon-inwork",title:e.working},{id:2,icon:"icon-finished",title:e.ff},{id:3,icon:"icon-clock",title:e.tm},{id:4,icon:"icon-archive",title:e.ar}]);return Mn.View.extend({className:"workbench--content",template:_.template("<div></div>"),regions:{list:{el:"div",replaceElement:!0}},initialize:function(){this.collection=new Backbone.Collection,this.collection.url=$.mergeUrlParam("/api/interestObjects",{onlyMeta:"",profileID:"",paramID:"",typeID:"",inputText:"",page:1})},onRender:function(){this.showChildView("list",new i({collection:this.collection,menuCollection:s,projectId:this.model.get("projectId")}))},onAttach:function(){var t=[{id:"_addPerson",className:"new-person",title:e.addPERSON},{id:"_addCompany",className:"new-org",title:e.addCOMPANY},{id:"_topChangeState",side:"right",isView:!0,view:n,options:{collection:l,current:0}}];this.triggerMethod("render:tools",t)},collectionEvents:{request:function(){Backbone.Radio.channel("loader").trigger("show",this.$el)},sync:function(){Backbone.Radio.channel("loader").trigger("hide")}},childViewEvents:{"row:col:trigger":function(t,i){var n=$(i.target).closest("td"),o=t.model;"status"===n.attr("data-name")&&o.get("dossier")&&Backbone.Radio.channel("Notify").request("once:dialog",{title:e.info,content:o.get("dossier")})}},_addIcon:function(e){if(this.getChildView("list").getChildView("table").getChildView("body")){var t=this.getChildView("list").getChildView("table").getChildView("body").children,i=$("<span class='icon-progress'><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>");t.each(function(t){-1===e.indexOf(parseInt(t.model.id))?t.$el.find(".icon-progress").remove():t.$el.find("td[data-name='status']").html(i.clone())},this)}},_addPerson:function(){Backbone.history.navigate("project/"+this.model.get("projectId")+"/add/person",{trigger:!0})},_addCompany:function(){Backbone.history.navigate("project/"+this.model.get("projectId")+"/add/company",{trigger:!0})},_topChangeState:function(e){var t=e.getChildView("vv").current.id;this.collection.url=$.mergeUrlParam(this.collection.url,{state:t}),Backbone.Radio.channel("loader").trigger("show",this.$el,{speed:"fast",overlay:!0}),this.collection.fetch({reset:!0})}})}),define("project:origin",["forms.inquiryView"],function(e){return Mn.View.extend({template:_.template("<div></div>"),regions:{form:"div"},onRender:function(){this.showChildView("form",new e),this.model.id&&this.getChildView("form").model.set("id",this.model.id)},initTools:function(){Backbone.Radio.channel("tools").request("get:tools").collection.reset()}})}),define("project",["i18n!nls/resources.min","model:project","project:objects","project:origin","project:resume"],function(e,t,i,n,o){return Mn.View.extend({className:"workbench--content",template:_.template('<div id="content"></div>'),regions:{content:{el:"#content",replaceElement:!0}},initialize:function(){this.model=new t,this.points=[],this.menu={"project:objects":i,"project:origin":n,"project:resume":o},Backbone.Radio.channel("side").reply("sidebar:click:item",function(e){var t=e.get("name");if(!this.points[t]){var i=this.menu[t];this.points[t]=new i({model:this.model})}this.getRegion("content").detachView(),this.getRegion("content").show(this.points[t]),this.points[t].initTools()}.bind(this))},onRender:function(){this.model.fetch()},modelEvents:{sync:function(){}}})}),define("project:resume",["i18n!nls/resources.min","global.view.dropDown","notesView"],function(e,t,i){var n=Backbone.Model.extend({defaults:{id:null,oid:null,NoteHtml:"",State:0,StateTitle:"",printUrl:"",pref:"GetResume?oid="},url:function(){return"/Api/InquiryResume/"+this.get("pref")+this.get("oid")}});new Backbone.Collection([{id:0,icon:"",title:e.stateResult},{id:1,icon:"icon-status--green",title:e.positive},{id:2,icon:"icon-status--yellow",title:e.doubts},{id:3,icon:"icon-status--red",title:e.negative},{id:4,icon:"icon-status--grey",title:e.di}]);return Mn.View.extend({className:"project-resume",template:_.template('<div id="notes"></div>'),regions:{notes:{el:"#notes",replaceElement:!0}},onRender:function(){this.showChildView("notes",new i({model:new n,collection:new Backbone.Collection})),this.model.id&&this.getChildView("notes").model.set("oid",this.model.id)},modelEvents:{sync:function(){this.getChildView("notes").model.set("oid",this.model.id)}}})}),define("projects",["i18n!nls/resources.min","projects:menuCollection","projects:statusCollection","global.view.dropDown","forms.inquiryView","global.grid.dataItemsView"],function(e,t,i,n,o,s){return Mn.View.extend({className:"workbench--content",template:_.template('<div id="add"></div><div id="find"></div><div id="list"></div>'),regions:{add:{el:"#add",replaceElement:!0},list:{el:"#list",replaceElement:!0},find:{el:"#find",replaceElement:!0}},onRender:function(){this.showChildView("add",new o({model:this.options.inquiry})),this.getChildView("add").$el.hide(),this.showChildView("list",new s({collection:this.collection,menuCollection:t,interceptLink:this.interceptLink}))},onAttach:function(){this.triggerMethod("render:tools",[{id:"_topShowNewProject",className:"new-inquiry",title:e.ni,side:"left"},{id:"_topChangeState",side:"right",isView:!0,view:n,options:{collection:i,current:0}}])},collectionEvents:{request:function(){Backbone.Radio.channel("loader").trigger("show",this.$el)},sync:function(){Backbone.Radio.channel("loader").trigger("hide")},error:function(){Backbone.Radio.channel("loader").trigger("hide")}},childViewEvents:{"back:list":function(){this.getChildView("add").$el.slideUp(350)},"row:col:trigger":function(t,i){var n=$(i.target).closest("td"),o=t.model;"status"===n.attr("data-name")&&o.get("dossier")&&Backbone.Radio.channel("Notify").request("once:dialog",{title:e.info,content:o.get("dossier")}),"title"===n.attr("data-name")&&this.options.interceptLink&&(i.preventDefault(),location.href=Backbone.history.fragment+"/"+o.id)},"click:link":function(e,t){this.interceptLink&&(t.preventDefault(),window.open($(t.target).attr("href")))},"action:from:menu":function(e){this.getChildView("add").model.set("projectId",parseInt(e.id)),this.getChildView("add").$el.slideDown(350)},"update:project:success":function(e){var t=this.getChildView("list").getChildView("table").getChildView("body").collection.get(e.id);t.set({title:e.get("projectName"),projectcode:e.get("projectCode"),rubrics:e.get("rel-rubric")}),this.getChildView("list").getChildView("table").getChildView("body").children.findByModel(t).render()},"change:collection":function(){this.getChildView("add")._clear(),this.getChildView("add").$el.slideUp(350)},"start:find":function(e){this.collection.url=$.mergeUrlParam(this.collection.url,e.toJSON()),this.collection.fetch({reset:!0})},"clear:find":function(){this.collection.length&&this.getChildView("list").getChildView("table").getChildView("body").collection.reset()}},_topShowNewProject:function(){this.getChildView("add").model.set({projectId:null}),this.getChildView("add").$el.slideToggle(350)},_topChangeState:function(e){var t=e.getChildView("vv").current.id;this.collection.url=$.mergeUrlParam(this.collection.url,{state:t}),this.collection.fetch({reset:!0})}})}),define("result:card",["i18n!nls/resources.min","global.grid.dataItemsView","syncfusion","RU"],function(e,t){var i=Backbone.Model.extend({idAttribute:"num",defaults:{num:0,data:[],href:"",links:[],caption:"",render:""}}),n=Mn.View.extend({getTemplate:function(){var e=_.template("");switch(this.model.get("propType")){case 1:e=_.template('<div class="g-form--input"><input type="text" value="<%- value %>" class="g-form--input filled" readonly="readonly"><label class="g-form--label"><%- displayName %></label></div>');break;case 2:e=_.template('<div class="g-form--input"><input type="text" value="<%- value %>" class="g-form--input filled"><label class="g-form--label"><%- displayName %></label></div>');break;case 3:e=_.template('<div class="g-form--input"><select name="<%- systemName %>" class="g-form--select" disabled=""></select><label class="g-form--label"><%- displayName %></label></div>')}return e},initialize:function(){this.collection=new Backbone.Collection},onBeforeRender:function(){this.$el.addClass(this.model.get("render")),3===this.model.get("propType")&&(this.collection.url="/api/ModelDicItems?dic="+this.model.get("dicID"),this.collection.fetch({reset:!0}))},collectionEvents:{reset:function(){3===this.model.get("propType")&&(this.collection.each(function(e){this.$("select").append($('<option value="'+e.id+'">'+e.get("title")+"</option>"))},this),this.$("select").val(this.model.get("value")))}},onRender:function(){2===this.model.get("propType")&&(this.$("input").ejDatePicker({width:"100%",height:"38px",value:isNaN(Date.parse(this.model.get("value")))?"":new Date(this.model.get("value")),locale:e.Lang,buttonText:e.Today,showPopupButton:!1,watermarkText:e.formatDate,enabled:!1,focusOut:function(e){this.$("input").data("ejDatePicker").hide()}.bind(this),select:function(e){this.model.set({value:$.ToISO(e.value)})}.bind(this)}),this.$("input").addClass("ejdatepicker"))}}),o=Mn.CollectionView.extend({className:"row",childView:n}),s=Mn.View.extend({className:"summary--plate",template:_.template('<h3 class="summary--plate-title"><%- caption %></h3><div class="row"></div>'),regions:{row:{el:".row",replaceElement:!0}},initialize:function(){this.collection=new Backbone.Collection(this.model.get("data"))},collectionEvents:{reset:function(){}},onRender:function(){var e=[];"commonInfo"===this.model.get("render")&&(e=[3,3,3,3,3,3,1]),this.collection.each(function(t,i){t.set("render",e[i]?"grid--1-"+e[i]:this.model.get("render"))},this),this.model.has("href")?(this.collection.url=this.model.get("href"),this.showChildView("row",new t({collection:this.collection})),this.collection.fetch({reset:!0})):this.showChildView("row",new o({collection:this.collection}))}}),l=Mn.View.extend({className:"summary--header",template:_.template('<div class="summary--logo"><img src="<%- img_src %>" alt=""></div><div class="summary--title"><%- title %></div><div class="clearfix"></div>')}),a=Mn.CollectionView.extend({className:"summary--content readonly",childView:s});return Mn.View.extend({className:"workbench--content summary--wrapper",template:_.template('<div id="header"></div><div id="content"></div>'),regions:{header:{el:"#header",replaceElement:!0},content:{el:"#content",replaceElement:!0}},initialize:function(){Backbone.Radio.channel("side").request("get:sidebar").setCurrent(["card","card"],!1),this.collection=new Backbone.Collection,this.collection.url="/api/object/card/"+this.model.id,this.collection.fetch({reset:!0})},collectionEvents:{reset:function(){var t=this.collection.at(0),n=(t.get("render"),t.get("items")),o=new Backbone.Collection(n,{model:i,comparator:"num"}),s=o.findWhere({render:"header"}),c=s.get("data");o.remove(s),this.showChildView("header",new l({model:new Backbone.Model({img_src:c[0].value,title:c[1].value})})),this.showChildView("content",new a({collection:o}));var r=[{id:"edit",template:'<span class="switch"><button class="g-form--switch" mode="off"></button><label>'+e.edit+"</label></span>"},{id:"save",className:"save",title:e.save}];this.triggerMethod("render:tools",r)}},edit:function(e){var t=e.$el.find(".g-form--switch"),i=t.attr("mode"),n=this.getChildView("content");"off"===i?(t.attr("mode","on"),n.$el.removeClass("readonly"),n.$("input:not(.e-datepicker)").removeAttr("readonly"),n.$("input.e-datepicker").ejDatePicker({enabled:!0}),n.$("select").removeAttr("disabled")):(t.attr("mode","off"),n.$el.addClass("readonly"),n.$("input:not(.e-datepicker)").attr("readonly","readonly"),n.$("input.e-datepicker").ejDatePicker({enabled:!1}),n.$("select").attr("disabled","disabled"))},save:function(){Backbone.trigger("message:warning",{message:"What?"})}})}),define("dossier",["i18n!nls/resources.min","bdid"],function(e,t){var i=Mn.CollectionView.extend({className:"articles",childView:Mn.View.extend({tagName:"article",template:_.template('<div class="dosier--article-title"><%- Title %></div><div class="dosier--article-content"><%= Content %></div>')})}),n=Mn.View.extend({tagName:"section",template:_.template('<div class="section-title hide-expand" id="<%- level %>_<%- num %>"><%- Title %> <% if(level>1){ %>(<span class="count-articles"><%- countArticles %></span>)<% } %></div><div id="articles"></div><div id="sections"></div>'),ui:{arr:"div.section-title",ca:".count-articles"},triggers:{"click @ui.arr":"click:item:main"},regions:{articles:{el:"#articles",replaceElement:!0},sections:{el:"#sections",replaceElement:!0}},onBeforeRender:function(){this.model.set("countArticles",this.model.get("Articles").length)},onRender:function(){var e=this.model.get("Articles");this.showChildView("articles",new i({collection:new Backbone.Collection(e)})),this.showChildView("sections",new s({collection:new Backbone.Collection(this.model.get("Sections")),level:this.model.get("level")+1})),e.length&&(this.triggerMethod("update:count:article",e.length),this.$(".section-title").removeClass("hide-expand"))},childViewTriggers:{"click:item:main":"click:item:main"},onChildviewUpdateCountArticle:function(e){this.model.set("countArticles",this.model.get("countArticles")+e)},modelEvents:{"change:countArticles":function(e,t){this.isRendered()&&(this.ui.ca.text(t),t&&this.$(".section-title").removeClass("hide-expand"))}}}),o=0,s=Mn.CollectionView.extend({className:"sections",childView:n,childViewOptions:function(e){e.set({level:this.options.level,num:o++})},onRender:function(){this.$el.addClass("level_"+this.options.level)},childViewTriggers:{"click:item:main":"click:item:main","update:count:article":"update:count:article"}}),l=0,a=Mn.View.extend({tagName:"li",template:_.template('<span><%- Title %></span><input type="checkbox" id="nav-<%- level %>-<%- num %>"><label for="nav-<%- level %>-<%- num %>"></label><ul></ul>'),ui:{arr:"input"},regions:{ul:{replaceElement:!0,el:"ul"}},triggers:{click:"click:item:side"},onRender:function(){this.showChildView("ul",new c({collection:new Backbone.Collection(this.model.get("Sections")),level:this.model.get("level")+1}))},childViewTriggers:{"click:item:side":"click:item:side"}}),c=Mn.CollectionView.extend({tagName:"ul",childView:a,childViewOptions:function(e){e.set({level:this.options.level,num:l++})},onRender:function(){this.$el.addClass("nav-level-"+this.options.level)},childViewTriggers:{"click:item:side":"click:item:side"}});return Mn.View.extend({className:"g-dosier hls",template:_.template('<div id="style"></div><aside class="g-dosier--sidebar"></aside><div class="g-dosier-wrapper"><div class="g-dosier--header"></div><main></main><div class="g-dosier--footer"></div><div id="script"></div></div>'),regions:{main:{el:"main",replaceElement:!0},side:"aside"},onRender:function(){var t=[{id:"_toggle",className:"legend",title:""},{id:"_xml_exp",className:"export",title:e.export+" XML",disabled:!0}];this.triggerMethod("render:tools",t),Backbone.trigger("message:modal",{title:e.wait2,message:""}),$.get("/api/WReports/"+this.model.id).done(function(e){Backbone.trigger("message:hide");var t=($(e).filter("script").html(),$(e));this.$("#script").html(t.filter("script")),this.$(".g-dosier--header").html($(wreportData.Header));var i=new Backbone.Collection(wreportData.Sections);this.showChildView("side",new c({collection:i,level:1})),this.showChildView("main",new s({collection:i,level:1})),this.$(".g-dosier--footer").html($(wreportData.Footer)),Backbone.Radio.channel("tools").request("get:tools").collection.get("_xml_exp").set("disabled",!1),setTimeout(this._pdf_exp_url.bind(this),1e3)}.bind(this))},childViewEvents:{"click:item:main":function(e){e.model.get("countArticles")&&(e.ui.arr.parent("section").toggleClass("expanded"),this.getChildView("side").$("#nav-"+e.model.get("level")+"-"+e.model.get("num")).prop("checked",e.ui.arr.parent("section").hasClass("expanded")))},"click:item:side":function(e){var t=this.getChildView("main").$("#"+e.model.get("level")+"_"+e.model.get("num"));if(!t.hasClass("hide-expand")){e.ui.arr.prop("checked",!e.ui.arr.prop("checked")),t.parent("section").toggleClass("expanded");var i=this.getChildView("main").$el.parent().scrollTop();this.getChildView("main").$el.parent().stop().animate({scrollTop:t.parent().position().top+i},500)}}},_toggle:function(){this.$el.toggleClass("hls")},_xml_exp:function(){var i=location.href;location.replace("/lang-"+e.Lang+"/db"+t+"/Reports/DataAsFile/"+this.model.id),location.replace(i)},_pdf_exp_url:function(){var t=this.getChildView("main").$el.parent().html(),i=new Backbone.Model;i.url="/api/WReports/Export/"+this.model.id,i.save({html:t,kind:0},{success:function(t){var i={id:"_pdf_exp",url:t.get("url"),className:"export",title:e.export+" PDF",template:'<a toolbar-icon="export" href="<%= url %>" target="_blank"><i><%- title %></i></a>'};Backbone.Radio.channel("tools").request("get:tools").collection.add(i)}})}})}),define("result/fragmentsView",["i18n!nls/resources.min","global.view.dropDown"],function(e,t){var i=Backbone.Model.extend({defaults:{id:null,SourceObject_ID:null,Html:"",HtmlOrig:"",Sections:[],NeedCreateFact:!1,Url:$.ajaxSettings.url},validate:function(t){var i=[];if(t.SourceObject_ID||i.push("SourceObject_ID"),t.Sections.length||i.push(e.rb+" "+e.notselected2+"."),i.length)return i}});return Mn.View.extend({className:"",tagName:"span",template:_.template('<i><%- Resources.ms2 %></i><div class="g-dropdown--menu"></div>'),templateContext:{Resources:e},regions:{dd:{el:".g-dropdown--menu",replaceElement:!0}},events:{"click div.g-dropdown--menu":function(e){e.stopPropagation()},"click i":function(){var e=this.model.get("title");$.trim(document.getSelection().toString())&&(e="<b>"+e+"</b><p>"+$.trim(document.getSelection().toString())+"</p>");var t=new i({Html:e,HtmlOrig:e,checkID:this.model.get("checkID"),SourceObject_ID:this.model.id});t.collection=this.collection,Backbone.Radio.channel("fM").trigger("show",t)}},initialize:function(){this.collection=new Backbone.Collection([],{model:i})},onChildviewDropdownClickCmd:function(e){var t=$(event.target).attr("class"),i=e.model.id,n=this.collection.get(i);n.set({checkID:this.model.get("checkID")}),"edit"===t&&Backbone.Radio.channel("fM").trigger("show",n),"clear"===t&&(e.model.collection.remove(e.model),n.url="/api/CheckNotes/"+this.model.get("checkID")+"?uid="+i,n.destroy())},onBeforeRender:function(){this.$el.attr("toolbar-icon","gear"),this.model.id&&this.model.has("checkID")&&(this.collection.url="/api/CheckNotes/GetFor/"+this.model.get("checkID")+"?id="+this.model.id,this.collection.fetch({reset:!0}))},modelEvents:{"change:id":function(){this.collection.url="/api/CheckNotes/GetFor/"+this.model.get("checkID")+"?id="+this.model.id,this.collection.fetch({reset:!0})}},collectionEvents:{add:function(){this.getRegion("dd").hasView()?this.getChildView("dd").collection.reset(this.parse()):this.showChildView("dd",new t({collection:new Backbone.Collection(this.parse())}))},remove:function(){this.collection.length||(this.getRegion("dd").empty(),Backbone.Radio.channel("fM").trigger("remove:item",this.model.id))},reset:function(){this.collection.length?this.showChildView("dd",new t({collection:new Backbone.Collection(this.parse())})):this.getRegion("dd").hasView()&&this.getRegion("dd").empty()}},parse:function(){return this.collection.map(function(e){return{id:e.id,title:_.chain(e.get("Sections")).map(function(e){return e.title}).value().join("-")+" : "+e.get("Html").substr(0,10)+"...",cmd:["edit","clear"]}})}})}),define("result:proof",["i18n!nls/resources.min","c/SimpleTableView"],function(e,t){return Mn.View.extend({isProof:!0,className:"workbench--content",template:_.template("<div></div>"),regions:{content:{el:"div",replaceElement:!0}},_showRobotsInfo:function(i){var n=this.collection.get(i);n&&this.showChildView("content",new t({collection:new Backbone.Collection(n.get("data")),rowTemplate:"<td><%- title %></td>\n                     <td>\n                        <span class=\"font-icon font-icon-<%- status %>\"></span>\n                     </td>\n                     <td>\n                        <%-state %>\n                        <%= details?'<br/>[<i>'+details+'</i>]': '' %>\n                     </td>",head:new Backbone.Collection([{id:0,title:e.title,width:"65%"},{id:1,title:e.status,width:"10%"},{id:2,title:e.execution,width:"25%"}])}))},_updateStatistic:function(e){if(this.model.id===e.objID){if(!this.getRegion("content").hasView())return;var t=this.getChildView("content").collection.get(e.id);if(t){t.set(e);this.collection.length,this.collection.where({status:"invalid"}).length,this.collection.where({status:"complited"}).length}}}})}),define("result:dossier",["dossier"],function(e){return Mn.View.extend({className:"workbench--content",template:_.template("<div></div>"),regions:{content:{el:"div",replaceElement:!0}},onRender:function(){this.getRegion("content").show(new e(this.options))},childViewTriggers:{"render:tools":"render:tools"}})}),define("sqlreports",["report_url"],function(e){return Mn.View.extend({template:_.template('<div style="height: 2100px; "><iframe src="<%= report_url %>" style="border: 0;width:100%;height: 99%" id="SqlRepFrame"></iframe></div>'),templateContext:function(){return{report_url:e+"?pid="+this.model.id}},onBeforeRender:function(){Backbone.Radio.channel("tools").request("get:tools").collection.reset()},onAttach:function(){Backbone.Radio.channel("loader").trigger("hide")}})}),define("rawresults",[],function(){return Mn.View.extend({template:!1,initialize:function(){var e=Backbone.Radio.channel("side").request("get:sidebar"),t=e.collection.get("check"),i=e.getChildView("children").children.findByModel(t).getChildView("children"),n=i.collection.get(this.options.checkId),o=i.children.findByModel(n);$.get("/api/InterestObj/TotalCheck/"+this.model.id).done(function(e){o.getChildView("children").children.each(function(t,i){"statistic"!==t.model.id&&t.model.set("count"," ("+e[i-1]+")")})}.bind(this)),Backbone.Radio.channel("side").request("get:sidebar").setCurrent(["check",this.options.checkId,"statistic"])}})}),define("content:result",["i18n!nls/resources.min","global.view.dialog"],function(e,t){return Mn.View.extend({className:"workbench--content",template:_.template('<div id="content"></div>'),templateContext:{Resources:e},regions:{content:"#content"},initialize:function(){var e=Backbone.Radio.channel("side").request("get:sidebar");Backbone.Radio.channel("side").reply("sidebar:click:item",function(t){require([t.get("name")],function(i){if(t.has("checkUid")&&($.ajaxSettings.headers.key=$.mergeUrlParam($.ajaxSettings.headers.key,{checkuid:t.get("checkUid")}),this.options.checkId=t.id),t.has("options")&&(this.options=Object.assign(this.options,t.get("options"))),this.getRegion("content").show(new i(this.options)),"statistic"===t.get("name")){var n=this.model.id;SJ.iwc.SignalR.getHubProxy("Ticker",{client:{}}).server.startMonitoringTasks($.ajaxSettings.headers.key,n),console.log("SR > StartMonitoringTasks",n);if(Backbone.Radio.channel("oM").request("get:app").currentChecks.get(n)){var o=e.collection.get("check").get("children")[1];e.$el.find("#"+o.id+">span").append($('<i class="loading"></i>'))}}}.bind(this))}.bind(this))},onRender:function(){var e=Backbone.Radio.channel("oM").request("get:app").currentChecks;e.get(this.model.id)?(this.model.set("searchTasksInfo",e.get(this.model.id).get("searchTasksInfo")),Backbone.Radio.channel("side").request("get:sidebar").setCurrent(["check"])):Backbone.Radio.channel("side").request("get:sidebar").setCurrent(["result"])},modelEvents:{"change:id":function(e,t){t&&(this.model.url="/api/details/"+this.model.id+"?mode=1",this.model.fetch())},sync:function(){Backbone.Radio.channel("loader").trigger("hide"),Backbone.Radio.channel("crumbs").request("add:new:crumb",[{id:0,title:e.ile},{id:1,path:this.model.get("projectId"),title:this.model.get("projectName")},{id:2,path:this.model.id,title:this.model.get("title")}])}},childViewEvents:{"show:content":function(e){require([e],function(e){this.getRegion("content").show(new e(this.options))}.bind(this))}}})}),define("source:content",["baseurl","app","i18n!nls/resources.min","global.view.dropDown","result/fragmentsView","dist/video-js/video"],function(e,t,i,n,o){Backbone.Model.extend({idAttribute:"uid",defaults:{uid:"",Object_ID:"",Display_Name:"",SystemTypeName:"",
TextSource:"",Author:"",MassMedia:"","URL_источника":"",MediaUrl:"",PlayingAt:"",PlayingUntil:""}});return Mn.CollectionView.extend({childView:Mn.View.extend({template:templates["content-item-source"],ui:{rubrs:"#link-rubrics",title:"h3",text:".format"},initialize:function(){this.hideToolbar=this.options.hideToolbar||!1,Backbone.Radio.channel("tools").reply("tools:click:item",function(e){"function"==typeof this[e.model.id]&&this[e.model.id](e.model.get("value"))}.bind(this)),Backbone.Radio.channel("crumbs").request("add:new:crumb",[{id:3,path:"path",title:this.model.get("display_name")}],{remove:!1})},onRender:function(){var e=this.model.get("contentcollection_rubrics");$.trim(e)&&this.ui.rubrs.html(i.linkToRubricTitle+": <span>"+e+"</span>"),this.model.get("massmedia")&&this.model.get("url_источника")&&this.$(".media").append('<a class="link" href="'+this.model.get("url_источника")+'" target="_blank">'+this.model.get("massmedia")+"&nbsp;&raquo;</a>"),this.hideToolbar||this._initTools()},modelEvents:{"change:textsource":function(e,t){this.ui.text.html(t)},"change:links":function(){this._initTools()}},_initTools:function(){var t=this.model.get("links"),o=this.model.get("uid"),s=this.model.get("object_id"),l=new Backbone.Collection([{id:0,title:i.originaldoc},{id:s+"/original/"+o,title:i.opennewtab,icon:"open-link",fn:function(){window.open("#"+s+"/original/"+o)}},{id:e+"/files/OriginalDoc/"+s,title:i.savetodisc,icon:"save-document",fn:function(){window.open(e+"/files/OriginalDoc/"+s,"_self")}}]),a={translate:{className:"lang"},toOriginal:{className:"lang"},showOriginalDoc:{className:"doc",view:n,side:"right",options:{collection:l}},shortText:{className:"doc"}};this.tools=t.map(function(e){var t={id:e.id,title:e.prompt,value:{href:e.href,verb:e.verb}};return Object.assign(t,a[e.id])}),Backbone.Radio.channel("tools").request("get:tools").collection.reset(this.tools)},translate:function(e){this._send(e)},toOriginal:function(e){this._send(e)},shortText:function(e){this._send(e)},_send:function(e){Backbone.Radio.channel("loader").trigger("show",this.ui.text),$.ajax({url:e.href,method:e.verb}).done(function(e){_.has(e,"version")&&(e=e.items[0]),this.model.set({links:e.links,textsource:_.findWhere(e.data,{systemName:"textsource"}).value}),Backbone.Radio.channel("loader").trigger("hide")}.bind(this))}}),childViewOptions:function(){return{hideToolbar:this.options.hideToolbar,checkid:this.model.id}}})}),define("source:links",["i18n!nls/resources.min","c/SimpleTableView"],function(e,t){return Mn.View.extend({template:_.template("<div></div>"),regions:{table:{el:"div",replaceElement:!0}},initialize:function(){this.collection=new Backbone.Collection,this.collection.url="/api/Docs/LinkedFactsAndObjects/"+this.model.id},onRender:function(){Backbone.Radio.channel("tools").request("get:tools").collection.reset(),this.showChildView("table",new t({collection:this.collection,rowTemplate:"<td><%- title %></td><td><%- type %></td>",head:new Backbone.Collection([{id:0,title:e.title},{id:1,title:e.type}])})),this.collection.fetch({reset:!0})}})}),define("source:result",["i18n!nls/resources.min","source:content","source:links"],function(e,t,i){return Mn.View.extend({className:"workbench--content",template:_.template('<div id="content"></div>'),regions:{content:{el:"#content",replaceElement:!0}},childViewTriggers:{"call:back:tools:button":"call:back:tools:button"},initialize:function(){switch(this.collection=new Backbone.Collection([],{model:Backbone.Model.extend({idAttribute:"uid"})}),this.options.mode){case"facts":this.collection.url="/api/facts/InSources/"+this.options.sourceId+"?originoid="+this.model.id;break;case"docs":case"infos":this.collection.url="/api/details/ContentV2/"+this.options.sourceId+"?originoid="+this.model.id}Backbone.Radio.channel("side").reply("sidebar:click:item",function(e){this.options.model=this.model,"content"===e.get("name")&&e.get("children").length&&(Backbone.Radio.channel("side").request("get:sidebar").setCurrent(["content",e.get("children")[0].id]),this.showChildView("content",new t({model:this.model,collection:this.collection}))),"source:links"===e.get("name")&&(this.showChildView("content",new i({model:this.model})),Backbone.Radio.channel("side").request("get:sidebar").setCurrent(["links"]))}.bind(this))},onRender:function(){this.collection.fetch({reset:!0})},collectionEvents:{update:function(i,n){var o=[];if(n.add&&(_.each(n.changes.added,function(t,i){o.push({id:t.id,title:e.source+" - "+(i+1),name:"source:content"})}),o.length)){var s=Backbone.Radio.channel("side").request("get:sidebar").collection.get("content");s&&(s.set({expanded:!0,children:o}),Backbone.Radio.channel("side").request("get:sidebar").setCurrent(["content",o[0].id]),this.showChildView("content",new t({model:this.model,collection:this.collection})))}},reset:function(){var e=this.collection.at(0).get("items");this.collection.set([]),_.each(e,function(e,t){var i=_.chain(e.data).map(function(e){return[e.systemName,e.value]}).object().value();i.links=e.links,this.collection.add(i)},this)}}})}),define("tools:crumbs",["baseurl","i18n!nls/resources.min"],function(e,t){new(Mn.Object.extend({channelName:"crumbs"}));var i=Backbone.Radio.channel("crumbs"),n=Backbone.Model.extend({idAttribute:"path",defaults:{title:"",path:null}});return Mn.CollectionView.extend({tagName:"ul",childView:Mn.View.extend({tagName:"li",template:_.template("<span><%- title %></span>"),triggers:{click:"click:item"},modelEvents:{change:function(){this.render()}}}),initialize:function(){this.collection=new Backbone.Collection([],{model:n}),i.reply("add:new:crumb",function(e,t){this.collection.set(e,t)}.bind(this)),i.reply("add:crumb",function(e){this.collection.add(e)}.bind(this)),i.reply("reset:crumb",function(e){this.collection.reset(e)}.bind(this))},onChildviewClickItem:function(e){Backbone.history.navigate(e.model.get("path"),{trigger:!0})}})}),define("tools:sidebar",["i18n!nls/resources.min","access"],function(e,t){new(Mn.Object.extend({channelName:"side"}));var i=Backbone.Radio.channel("side"),n=Mn.CollectionView.extend({tagName:"ul",childView:Mn.View.extend({tagName:"li",template:_.template('<span title="<%- title %>" class="<%- active?"active":"" %> <%- className || id %>"><%= title %><span id="cu"><%- count %></span></span><i class="toggler"></i><ul></ul>'),ui:{toggler:"i:first.toggler"},triggers:{"click span":"click:item"},regions:{children:{el:"ul",replaceElement:!0}},events:{"click @ui.toggler":function(){this.model.set("expanded",!this.model.get("expanded")),this.model.get("expanded")&&this.triggerMethod("click:item",this)}},childViewTriggers:{"click:item":"click:item"},onBeforeRender:function(){this.model.has("className")||this.model.set("className","")},onRender:function(){if(!t.data.IsDev&&this.model.has("inDev"))return void this.$el.hide();this.ui.toggler.hide(),this.$el.attr("id",this.model.id),this.model.has("children")&&(this.ui.toggler.show(),this.showChildView("children",new n({collection:new Backbone.Collection(this.model.get("children"))})),this.model.has("expanded")&&this.$el.addClass("expanded"))},modelEvents:{"change:expanded":function(e,t){t?this.$el.addClass("expanded"):this.$el.removeClass("expanded"),this.triggerMethod("model:expanded",e,t)},"change:children":function(e,t){this.showChildView("children",new n({collection:new Backbone.Collection(t)}))},"change:count":function(e,t){this.$("#cu").text(t)}}}),childViewOptions:function(e){e.has("active")||e.set("active",!1),e.has("count")||e.set("count","")},onChildviewModelExpanded:function(e,t){if(t){var i=this.collection.find(function(t){return t.get("expanded")&&t.id!==e.id});i&&i.set("expanded",!1)}},childViewTriggers:{"click:item":"child:click:item"},onChildviewClickItem:function(e){this.triggerMethod("click:item",e)}});return Mn.View.extend({tagName:"aside",className:"g-sidebar--left expanded",template:_.template('<div class="control" title="<%- Resources.show %> / <%- Resources.close %>"><i></i></div><div id="list"></div>'),templateContext:{Resources:e},regions:{children:{el:"#list",replaceElement:!0}},initialize:function(){this.current=[],this.collection=new Backbone.Collection,i.reply("get:sidebar",function(){return this}.bind(this))},onBeforeRender:function(){$("body").addClass("hls ls-on")},onRender:function(){this.showChildView("children",new n({collection:this.collection}))},events:{"click .control":function(){this.$el.toggleClass("expanded",function(){$(this).hasClass("expanded")?$("body").addClass("ls-on"):$("body").removeClass("ls-on")})}},toggleExpanded:function(){this.$el.toggleClass("expanded",function(){$(this).hasClass("expanded")?$("body").addClass("ls-on"):$("body").removeClass("ls-on")})},req:function(e,t,i){if(this.current.length&&this.current[e]!==i[e]){var n=this.current[e],o=0===e?this.collection.get(n):t.getChildView("children").collection.get(n);o.set("expanded",!1)}this.current.length<e&&this.req(e++,t.getChildView("children").children.findByModel(o),i)},setCurrent:function(e,t){this.current=e;var i=this.collection.get(e[0]),n=this.getChildView("children").children.findByModel(i);if(i.has("children")){var o=i.get("children");i.set("expanded",!0),_.each(e,function(t,i){var s=_.find(o,function(t){return t.id===e[i+1]});if(s){var l=n.getChildView("children").collection.get(e[i+1]);l.set("expanded",!0),n=n.getChildView("children").children.findByModel(l),s.children&&(o=s.children)}})}else{n.model.set("expanded",!0);var s=n.model.collection.find(function(e){return e.get("expanded")&&e.id!==n.model.id});s&&s.set("expanded",!1)}this.current[this.current.length-1]=n.model.get("name"),this.getChildView("children").children.each(function(e){e.$("span").removeClass("active")}),n.$("span:first").toggleClass("active")},childViewEvents:{"child:click:item":"onClickItem"},onClickItem:function(e,t){e.model.has("path")&&Backbone.history.navigate(e.model.get("path"),{trigger:!0}),i.request("sidebar:click:item",e.model)},open:function(){this.$el.addClass("expanded",function(){$("body").addClass("ls-on")})},close:function(){this.$el.removeClass("expanded",function(){$("body").removeClass("ls-on")})}})}),define("tools:top",["i18n!nls/resources.min"],function(e){new(Mn.Object.extend({channelName:"tools"}));var t=Backbone.Radio.channel("tools");return Mn.CollectionView.extend({tagName:"ul",initialize:function(){this.collection=new Backbone.Collection,t.reply("get:tools",function(){return this}.bind(this))},childView:Mn.View.extend({tagName:"li",getTemplate:function(){return this.model.has("isView")?_.template("<span></span>"):this.model.has("template")?_.template(this.model.get("template")):_.template('<span toolbar-icon="<%- className %>"><i><%- title %></i></span>')},templateContext:{Resources:e},triggers:{"click span:not(.disabled)":"tools:click:item"},modelEvents:{change:function(){this.render()}},onToolsClickItem:function(e){Backbone.Radio.channel("tools").request("tools:click:item",e)},onRender:function(){if(this.model.has("disabled")&&this.model.get("disabled")?(this.$el.attr("disabled",!0),this.$el.addClass("disabled")):(this.$el.attr("disabled",!1),this.$el.removeClass("disabled")),"right"===this.model.get("side")&&this.$el.addClass("right"),this.model.has("tooltip")&&(this.$("i").attr("tooltip",this.model.get("tooltip").title),this.$("i").attr("flow",this.model.get("tooltip").flow)),this.model.get("view")){var e=this.model.get("view");this.addRegion("vv",{el:"span",replaceElement:!0}).show(new e(this.model.get("options")))}},childViewEvents:{"dropdown:select":function(e,t){this.triggerMethod("tools:click:item",this)}}}),childViewTriggers:{"tools:click:item":"tools:click:item"}})}),define("create.check.checkView",["i18n!nls/resources.min","global.grid.dataItemsView","ContextMenuCollection"],function(e,t,i){return Mn.View.extend({className:"main-container",template:templates["check-page-c"],templateContext:{Resources:e},regions:{match:".matchesList"},events:{"click input":function(e){var t=$(e.target);this.model.set(t.attr("name"),t.prop("checked"))}},onRender:function(){if(this.model.isValid()){var e=this.model,n=Backbone.Collection.extend({url:"/api/interestObjects/"+this.model.get("typeid")+"?page=1",sync:function(t,i,n){e.url=this.url,Backbone.Collection.prototype.sync.apply(this,["create",e,n])}}),o=[0,3];i.each(function(e){-1!==o.indexOf(e&&e.id)&&i.remove(e)});var s=new n;this.showChildView("match",new t({collection:s,menuCollection:i})),Backbone.Radio.channel("loader").trigger("show",this.getChildView("match").$el),s.fetch({reset:!0,success:function(){Backbone.Radio.channel("loader").trigger("hide")},error:function(){Backbone.Radio.channel("loader").trigger("hide")}})}},childViewEvents:{"click:link":function(e,t){t.preventDefault(),window.open("#"+e.model.get("project_id")+"/"+e.model.id+"/")},"row:col:trigger":function(t,i){"status"===$(i.target).closest("td").attr("data-name")&&t.get("dossier")&&Backbone.Radio.channel("Notify").request("once:dialog",{title:e.info,content:t.get("dossier")})}}})}),define("c/forms/countriesView",["i18n!nls/resources.min"],function(e){var t=Backbone.Collection.extend({model:Backbone.Model.extend({idAttribute:"ID",defaults:{DicCode:"",DicType:0,ID:null,Importance:null,Title:""}}),url:"/api/sources/types"}),i=Mn.CollectionView.extend({tagName:"select",initialize:function(){this.collection=new t},childView:Mn.View.extend({tagName:"option",template:_.template("<%- Title %>"),onRender:function(){this.$el.attr("value",this.model.get("DicCodeItem"))}}),triggers:{change:"select:country"}});return Mn.View.extend({template:templates["countries-select"],templateContext:{Resources:e},regions:{select:{el:"select",replaceElement:!0}},initialize:function(){this.collection=new t},onRender:function(){this.showChildView("select",new i),Backbone.Radio.channel("loader").trigger("show",this.$el,{size:"l"}),this.collection.fetch({reset:!0})},collectionEvents:{reset:function(){Backbone.Radio.channel("loader").trigger("hide");var t=this.collection.findWhere({DicCode:"ByCountry"}),i=this.model.get("selectedCountries");this.getChildView("select").collection.set(t.get("DicItems")),this.getChildView("select").collection.add({DicCodeItem:"",Title:"..."},{at:0}),i&&i.length?this.getChildView("select").$el.val(i[0]):this.getChildView("select").$el.val([e.Lang]),this._showField(this.getChildView("select"))}},childViewEvents:{"select:country":"_showField"},_showField:function(e){this.$(".countries>div").hide();var t=e.$el.val();$.trim(t)?(this.$("#"+t).show(),this.model.set("selectedCountries",[t])):this.model.set("selectedCountries",[])}})}),define("forms/rolesView",[],function(){return Mn.CollectionView.extend({tagName:"select",childView:Mn.View.extend({tagName:"option",template:_.template("<%- ProjectRoleName %>")}),initialize:function(){this.collection=new Backbone.Collection,this.collection.url="/api/InquiryRoles",this.collection.fetch({reset:!0})},triggers:{change:"change:role"},onRender:function(){var e=this.model.get("ProjectRole_ID");this.children.each(function(t){t.model.get("ID")===e&&t.$el.prop("selected",!0)})}})}),define("create.searchSources.robots",["i18n!nls/resources.min","global.view.dialog","services.sources.mainView"],function(e,t,i){var n=Mn.CollectionView.extend({className:"row",emptyView:Mn.View.extend({template:_.template(e.N),templateContext:{Resources:e}}),childViewOptions:function(e){return e.has("selected")||e.set("selected",!1),{DicID:this.options.DicID}},childView:Mn.View.extend({className:"grid--1-3",template:templates["set-types-robots"],templateContext:{Resources:e},triggers:{click:"click:item","click span[data-icon=icon-eye]":"list:item:view","click span[data-icon=icon-trash]":"list:item:clear"},events:{"click h4":function(e){e.stopPropagation(),$(e.target).prop("contenteditable",!0)},"click span[data-icon=icon-round-check]":function(e){e.stopPropagation(),$.trim(this.$("h4").text())&&(this.model.get("SearchPackUID")?this.model.save("SearchPackName",this.$("h4").text()):(this.model.set("SearchPackName",this.$("h4").text()),this.triggerMethod("list:item:view",this)),this.$("h4").prop("contenteditable",!1))}},modelEvents:{"change:selected":function(){this.render()},"change:SourcesCount":function(){this.render()}}}),childViewTriggers:{"click:item":"click:item","list:item:view":"list:item:view","list:item:clear":"list:item:clear"}});return Mn.View.extend({className:"g-form--wizard",template:templates["robots-collection"],templateContext:{Resources:e},events:{"click #add-collection":function(){var e=new Backbone.Model({SearchPackName:"",SearchPackUID:null,BySaType:this.options.DicID,SelectedCountries:this.model.get("selectedCountries"),Sum:0,SourcesCount:0,IsSystem:!1});this.getChildView("custom").collection.add(e),e.on("change:SearchPackUID",function(e,t){this.current=e,$.cookie("anbr.check."+this.model.get("typeid")+".sourceid",t),this.collection.fetch({reset:!0})},this)}},regions:{system:{el:"#system",replaceElement:!0},custom:{el:"#custom",replaceElement:!0},dialog:".dialog"},onRender:function(){Backbone.Radio.channel("loader").trigger("show",this.$el),this.collection.fetch({reset:!0})},collectionEvents:{sync:function(){Backbone.Radio.channel("loader").trigger("hide");var e=this.collection.groupBy("IsSystem");this.showChildView("system",new n({collection:new Backbone.Collection(e.true||[])})),this.showChildView("custom",new n({DicID:this.options.DicID,collection:new Backbone.Collection(e.false||[])}));var t=$.cookie("anbr.check."+this.model.get("typeid")+".sourceid");this.current=t&&this.collection.get(t)?this.collection.get(t):this.collection.at(0),this.current&&(this.current.set("selected",!0),this.triggerMethod("collections:robors:selected",this.current))}},childViewEvents:{"click:item":function(e){e.model.get("SearchPackUID")&&(this.current&&this.current.set("selected",!1),e.model.set("selected",!0),this.current=e.model,$.cookie("anbr.check."+this.model.get("typeid")+".sourceid",e.model.id),this.triggerMethod("collections:robors:selected",this.current))},"list:item:view":function(n){n.model.has("SelectedCountries")||n.model.set("SelectedCountries",this.model.get("selectedCountries"));var o=new t({size:"full",header:{manage:[{id:"close"}]},content:new i({model:n.model,DicID:this.options.DicID}),title:e.selSourcesTitle,footer:new Backbone.Collection([{id:"back",title:e.toform},{id:"start",title:e.saveCollRobots,className:"next right"}])});this.listenTo(o,"footer:button:click",function(e){switch(e.model.id){case"back":o.close();break;case"start":this._saveCollection(o)}}),this.showChildView("dialog",o)},"list:item:clear":function(t){Backbone.trigger("message:confirm",{title:e.askyousure,message:$.Format(e.wdostr," ["+t.model.get("SearchPackName")+"] "),fx:function(){t.model.destroy(),this.current&&this.current.get("SearchPackUID")===t.model.get("SearchPackUID")&&($.cookie("anbr.check."+this.model.get("typeid")+".sourceid",null),this.current=null)},ctx:this})}},_saveCollection:function(t){var i=[],n=0,o=t.getChildView("content").collection;o.each(function(e){i.push(e.id),n+=e.get("price")});var s=t.getChildView("content").model,l={method:"POST",url:"/api/sources/persisted",data:{Sources:i,BySATypeSelectedValue:s.get("BySaType"),SearchPackUID:s.get("SearchPackUID"),SearchPackName:s.get("SearchPackName")}};if(!i.length)return Backbone.trigger("message:warning",{title:e.alert,message:e.errorsavecoll}),null;$.ajax(l).done(function(e){s.get("SearchPackUID")||s.set("SearchPackUID",e),s.set({SourcesCount:o.length,Sum:n}),this.triggerMethod("save:robots:collection",l),t.close()}.bind(this))}})}),define("forms/sinonimView",["i18n!nls/resources.min"],function(e){var t=Backbone.Model.extend({url:"/api/synonyms",sync:function(e,t,i){Backbone.Model.prototype.sync.apply(this,["create",t,i])}}),i=Mn.CollectionView.extend({className:"results readonly",childView:Mn.View.extend({tagName:"span",className:"g-form--input nested",template:_.template('<input type="text" value="" readonly="readonly" class="g-form--input filled" placeholder="<%- id %>"><i class="clear permanent rtl-1"></i>'),events:{"click .clear":function(){this.model.collection.remove(this.model)}}})});return Mn.View.extend({tagName:"fieldset",className:"g-form--fieldset acc",template:templates["synonims-template"],templateContext:{Resources:e},ui:{data:"#synonim"},regions:{list:{el:".results",replaceElement:!0}},events:{"click .synonimus-link":function(e){this.getRegion("list").$el.slideDown()},"click .hideSyn":function(){this.ui.data.val(""),this.getRegion("list").$el.slideUp()},"click .add":function(){this.ui.data.removeClass("error"),this.add(this.ui.data.val())},"keyup input#synonim":function(e){13===e.keyCode&&this.add(this.ui.data.val())}},add:function(e){$.trim(e)?(this.collection.add(new Backbone.Model({id:e})),this.ui.data.val("")):this.ui.data.addClass("error")},initialize:function(){this.collection=new Backbone.Collection,this.sendModel=new t,this.sendModel.on("sync",function(e,t){this.collection.add(t.map(function(e){return{id:e}}))},this)},onRender:function(){this.showChildView("list",new i({collection:this.collection})),this.model.get("synonyms_INTERN")&&this.collection.set(_.map(this.model.get("synonyms_INTERN"),function(e){return{id:e}}))},modelEvents:{"change:title_INTERN":function(e,t){$.trim(t)?this.sendModel.save(e.toJSON()):this.collection.reset()}},collectionEvents:{update:function(){this.model.set("synonyms_INTERN",this.collection.pluck("id"))}}})}),define("forms/1003View",["i18n!nls/resources.min","forms/FormView","forms/rolesView","forms/sinonimView","c/forms/countriesView","create.check.checkView","create.searchSources.robots"],function(e,t,i,n,o,s,l){var a=Mn.View.extend({className:"main-container",template:templates["company-page-a"],templateContext:{Resources:e},ui:{any:".any-info"},regions:{countries:{el:"#select-countries",replaceElement:!0},synonims:{el:"#synonimus-panel",replaceElement:!0},roles:{el:"#projectRoleID",replaceElement:!0}},events:{"input @ui.any":function(e){var t=this.ui.any.val().split(","),i={};Array.from(t,function(e){i[$.trim(e)]=0}),this.model.set("RelationsDescriptionData",{Kind:0,Roles:i})}},onRender:function(){this.showChildView("countries",new o({model:this.model})),this.showChildView("synonims",new n({model:this.model})),this.showChildView("roles",new i({model:this.model})),this.ui.any.val(_.keys(this.model.get("RelationsDescriptionData").Roles).join(","))},onBeforeDestroy:function(){this.model.set($.GetData(this.$el))},modelEvents:{"change:ProjectRole_ID":function(e,t){t?e.isValid():this.model.trigger("invalid",this.model,[{name:"ProjectRole_ID"}])},"change:selectedCountries":function(e,t){t?(_.isString(t)&&e.set("selectedCountries",[t]),t.length?e.isValid():this.model.trigger("invalid",this.model,[{name:"selectedCountries"}])):this.model.trigger("invalid",this.model,[{name:"selectedCountries"}])}}}),c=Mn.View.extend({className:"main-container",template:templates["company-page-b"],templateContext:{Resources:e},ui:{loader:"#egrul-process-loader"},regions:{egrulResult:{el:"#egrul-result",replaceElement:!0}},events:{"click #check-UGRL":function(){var e=SJ.iwc.WindowMonitor.getThisWindowId();this.model.url="/api/interestObjects/10022/addInfo/0?wnd="+e,this.model.set($.GetData(this.$el)),this.model.isValid()&&(this.ui.loader.show(),this.model.save({},{success:function(e,t){Backbone.Radio.channel("oM").request("get:app").Tasks.push(t.taskUID)},error:function(){this.ui.loader.hide()}.bind(this)}))},"click .accept":function(){this.getChildView("egrulResult").collection.each(function(e){this.$("input[name='"+e.get("title")+"']").val(e.get("value")),this.model.has(e.get("title"))&&this.model.set(e.get("title"),e.get("value"))},this)}},initialize:function(){Backbone.Radio.channel("Ale").reply("get:transfer:data",function(e){var t=e.data;if(-1===e.kind)this.showChildView("egrulResult",new d({collection:new Backbone.Collection([{id:-1,value:t}])}));else{var i=JSON.parse(t),n=i.item,o=i.map,s=i.aliases,l=_.map(_.keys(o),function(e){return{id:s[e],title:o[e],value:n[e]}});this.showChildView("egrulResult",new d({collection:new Backbone.Collection(l)})),this.$(".accept").show(),this.$("#egrul-check").addClass("current").children(".row").slideDown(200)}this.ui.loader.hide()},this)},onRender:function(){var e=this.model.get("selectedCountries")[0];this.$("#check-UGRL").prop("disabled",-1===["ru-RU","kk-KZ"].indexOf(e))}}),r=Mn.View.extend({className:"main-container",template:templates["robots-page-d"],templateContext:{Resources:e},regions:{robots:{el:"#robots",replaceElement:!0}},initialize:function(){this.collection=new Backbone.Collection,this.collection.model=Backbone.Model.extend({idAttribute:"SearchPackUID"}),this.collection.url="/api/sources/searchpacks/"+this.options.DicID},onRender:function(){this.showChildView("robots",new l({collection:this.collection,model:this.model,DicID:this.options.DicID}))},childViewTriggers:{"collections:robors:selected":"collections:robors:selected"}}),d=Mn.CollectionView.extend({tagName:"table",childView:Mn.View.extend({tagName:"tr",template:_.template("<td><%- id %></td><td><%- value %></td>")})});return t.extend({initialize:function(e){this.master=new Backbone.Model({step:0,pages:[a,c,s,r]}),this.master.on("change",this._getPage,this)}})}),define("forms.inquiryView",["i18n!nls/resources.min","global.request.param","global.behaviors.input"],function(e,t,i){return Mn.View.extend({className:"g-form--new-check",behaviors:{input:i},template:templates["inquiry-form"],templateContext:{Resources:e},ui:{name:'input[name="projectName"]',save:'button[name="save"]'},regions:{rub:".rubric-param"},triggers:{'click button[name="cancel"]':"back:list"},events:{"input input":function(e){$(e.target).removeClass("error")},"click @ui.save":function(){this.model.set($.GetData(this.$el)),this.model.set("Rubrics",this.getChildView("rub").collection.toJSON());var e=!this.model.id;this.model.isValid()&&(this.$("input").removeClass("error"),this.model.save({},{wait:!0,success:function(t,i){e?Backbone.history.navigate("#projects/my/"+t.id,{trigger:!0}):this.triggerMethod("update:project:success",this.model)}.bind(this)}))},"click .clear-form":function(){this._clear()}},onRender:function(){this.options.readOnly&&(this.$el.addClass("readonly"),this.$(".inquiry-form--options span").hide(),this.$(".inquiry-form--controls .row div").hide()),this.options.hideCancel&&this.$("button[name=cancel]").hide(),this.showChildView("rub",new t({attributes:{Caption:e.relRubrics,Name:"rel-rubric",ParametrType:"Rubric",url:"/api/Rubric/ForProjects",Params:{openLevel:2},DisplayValue:_.pluck(this.model.get("Rubrics"),"title").join(","),Value:_.pluck(this.model.get("Rubrics"),"id")},collection:new Backbone.Collection(this.model.get("Rubrics"))}))},modelEvents:{"change:projectId":function(e,t){},"change:projectName":function(e,t){$.trim(t)&&this.ui.name.val(t).addClass("filled")},invalid:function(e,t){var i=this;t&&t.forEach(function(e){i.$("[name='"+e.name+"']").addClass("error")})},sync:"render"},_clear:function(){this.model.set(this.model.defaults()),this.$("input[name='projectCode']").removeClass("filled").val(""),this.getChildView("rub").collection.reset(),this.getChildView("rub").model.set({DisplayValue:"",Value:[]})}})}),define("forms/1002View",["i18n!nls/resources.min","forms/FormView","forms/rolesView","forms/sinonimView","c/forms/countriesView","create.check.checkView","create.searchSources.robots","RU"],function(e,t,i,n,o,s,l){var a=Mn.View.extend({className:"main-container",template:templates["person-page-a"],templateContext:{Resources:e},ui:{any:".any-info"},regions:{countries:{el:"#select-countries",replaceElement:!0},synonims:{el:"#synonimus-panel",replaceElement:!0},roles:{el:"#projectRoleID",replaceElement:!0}},events:{"input @ui.any":function(e){var t=this.ui.any.val().split(","),i={};Array.from(t,function(e){i[$.trim(e)]=0}),this.model.set("RelationsDescriptionData",{Kind:0,Roles:i})}},onBeforeDestroy:function(){this.model.set($.GetData(this.$el))},onRender:function(){this.showChildView("countries",new o({model:this.model})),this.showChildView("synonims",new n({model:this.model})),this.showChildView("roles",new i({model:this.model})),this.ui.any.val(_.keys(this.model.get("RelationsDescriptionData").Roles).join(","));var t=this.model.get("birthDateExact_INTERN")?new Date(this.model.get("birthDateExact_INTERN")):"";this.$("input[name='birthDateExact_INTERN']").ejDatePicker({value:t,height:36,locale:e.Lang,buttonText:e.Today,showPopupButton:!1,watermarkText:e.formatDate,startLevel:ej.DatePicker.Level.Decade,focusOut:function(e){}.bind(this)});var s=this.model.get("birthDateFrom_INTERN")?new Date(this.model.get("birthDateFrom_INTERN")):"";this.$("input[name='birthDateFrom_INTERN']").ejDatePicker({value:s,htmlAttributes:{style:"display:inline-block; height:36px; width:100px"},locale:e.Lang,buttonText:e.Today,showPopupButton:!1,watermarkText:e.formatDate,startLevel:ej.DatePicker.Level.Decade,focusOut:function(e){}.bind(this)});var l=this.model.get("birthDateTo_INTERN")?new Date(this.model.get("birthDateTo_INTERN")):"";this.$("input[name='birthDateTo_INTERN']").ejDatePicker({value:l,htmlAttributes:{style:"display:inline-block; height:36px; width:100px"},locale:e.Lang,buttonText:e.Today,showPopupButton:!1,watermarkText:e.formatDate,startLevel:ej.DatePicker.Level.Decade,focusOut:function(e){}.bind(this)});var a=this.model.get("pasDate__ru_RU")?new Date(this.model.get("pasDate__ru_RU")):"";this.$("input[name='pasDate__ru_RU']").ejDatePicker({value:a,height:36,locale:e.Lang,buttonText:e.Today,showPopupButton:!1,watermarkText:e.formatDate,startLevel:ej.DatePicker.Level.Decade,width:168});var c=this.model.get("pasDate__uk_UA")?new Date(this.model.get("pasDate__uk_UA")):"";this.$("input[name='pasDate__uk_UA']").ejDatePicker({value:c,height:36,locale:e.Lang,buttonText:e.Today,showPopupButton:!1,watermarkText:e.formatDate,startLevel:ej.DatePicker.Level.Decade});var r=this.model.get("pasDate__kk_KZ")?new Date(this.model.get("pasDate__kk_KZ")):"";this.$("input[name='pasDate__kk_KZ']").ejDatePicker({value:r,height:36,locale:e.Lang,buttonText:e.Today,showPopupButton:!1,watermarkText:e.formatDate,startLevel:ej.DatePicker.Level.Decade})},modelEvents:{"change:lname_INTERN":"_setTitle","change:fname_INTERN":"_setTitle","change:mname_INTERN":"_setTitle","change:ProjectRole_ID":function(e,t){t?e.isValid():this.model.trigger("invalid",this.model,[{name:"ProjectRole_ID"}])},"change:selectedCountries":function(e,t){t?(_.isString(t)&&e.set("selectedCountries",[t]),t.length?e.isValid():this.model.trigger("invalid",this.model,[{name:"selectedCountries"}])):this.model.trigger("invalid",this.model,[{name:"selectedCountries"}])}},_setTitle:function(){this.model.set("title_INTERN",$.trim(this.model.get("lname_INTERN")+" "+this.model.get("fname_INTERN")+" "+this.model.get("mname_INTERN")))}}),c=Mn.View.extend({className:"main-container",template:templates["robots-page-d"],templateContext:{Resources:e},regions:{robots:{el:"#robots",replaceElement:!0}},initialize:function(){this.collection=new Backbone.Collection,this.collection.model=Backbone.Model.extend({idAttribute:"SearchPackUID"}),this.collection.url="/api/sources/searchpacks/"+this.options.DicID},onRender:function(){this.showChildView("robots",new l({collection:this.collection,model:this.model,DicID:this.options.DicID}))},childViewTriggers:{"collections:robors:selected":"collections:robors:selected"}});return t.extend({initialize:function(){this.master=new Backbone.Model({step:0,pages:[a,s,c]}),this.master.on("change",this._getPage,this)}})}),define("projects:menuCollection",["i18n!nls/resources.min"],function(e){var t=function(e,t){_.each(e,function(e){e.set("State",t.get("title")),$.get("/api/inquiry/SetState/"+e.id+"?state="+t.id+"&title="+t.get("title"))},this)};return new Backbone.Collection([{icon:"change",title:e.editItem,cmd:function(e){this.triggerMethod("action:from:menu",e[0])}},{icon:"status",title:e.chsta,"data-id":"7460E56F-62BD-4C9D-A8E5-5B64373C5131",child:[{id:1,icon:"inwork",
title:e.working,cmd:t},{id:2,icon:"finished",title:e.ff,cmd:t},{id:3,icon:"clock",title:e.tm,cmd:t},{id:4,icon:"archive",title:e.ar,cmd:t}]},{icon:"trash",title:e.deleteItem,"data-id":"86056534-0DCB-48CF-B06D-3E8D23FD5001",cmd:function(t){Backbone.trigger("message:confirm",{title:e.alert,message:e.askyousure+"<br/>"+e.warndeleteobj,fx:function(){_.each(t,function(e){e.url="/api/inquiry/"+e.id,e.destroy()},this)},ctx:this})}}])}),define("projects:resultCollection",["i18n!nls/resources.min"],function(e){return new Backbone.Collection([{id:0,icon:"",title:e.stateResult},{id:1,icon:"icon-status--green",title:e.positive},{id:2,icon:"icon-status--yellow",title:e.doubts},{id:3,icon:"icon-status--red",title:e.negative},{id:4,icon:"icon-status--grey",title:e.di}])}),define("projects:statusCollection",["i18n!nls/resources.min"],function(e){return new Backbone.Collection([{id:0,icon:"icon-all",title:e.fva},{id:1,icon:"icon-inwork",title:e.working},{id:2,icon:"icon-finished",title:e.ff},{id:3,icon:"icon-clock",title:e.tm},{id:4,icon:"icon-archive",title:e.ar}])}),define("all",["i18n!nls/resources.min","projects"],function(e,t){return t.extend({initialize:function(){this.collection.url=$.mergeUrlParam("/api/inquiry/",{me:0,state:0,page:1})}})}),define("find",["i18n!nls/resources.min","projects","global.behaviors.input","global.request.param","global.view.dropDown","projects:statusCollection","projects:resultCollection","RU"],function(e,t,i,n,o,s,l){var a=Backbone.Model.extend({defaults:function(){return{inputText:"",onlyMeta:null,profileID:null,paramID:null,typeID:null,ds:null,de:null,rubid:null,result:0,state:0,page:1,executor:""}},validate:function(e){var t=Object.keys(e).filter(function(t){return $.trim(e[t])&&0!==e[t]&&"page"!==t});if(!t.length)return t}}),c=Mn.View.extend({className:"form--search-inquiry",behaviors:{input:i},template:templates["find-inquiry"],templateContext:{Resources:e},ui:{start:'button[name="start-search"]',text:"#inputText",exec:"#input-exec"},regions:{rub:".rubric-param",result:{el:"#results",replaceElement:!0},status:{el:"#status",replaceElement:!0}},events:{"input input":function(e){$(e.target).removeClass("error")},"click button[name='clear-form']":function(){this.$("input").val(""),this.getChildView("rub").model.set({DisplayValue:"",Value:""}),this.getChildView("rub").collection.reset(),this.$("#datepickerFrom").ejDateTimePicker({value:null}),this.$("#datepickerTo").ejDateTimePicker({value:null}),this.getChildView("status").setCurrent(0),this.getChildView("result").setCurrent(0);var e=this.model.defaults();this.model.set(e,{validate:!1}),this.triggerMethod("clear:find")},"click @ui.start":function(){this.model.set({inputText:$.trim(this.ui.text.val()),executor:$.trim(this.ui.exec.val()),ds:this.$("#datepickerFrom").data("ejDateTimePicker").getValue()?this.$("#datepickerFrom").data("ejDateTimePicker")._datetimeValue.toISOString():null,de:this.$("#datepickerTo").data("ejDateTimePicker").getValue()?this.$("#datepickerTo").data("ejDateTimePicker")._datetimeValue.toISOString():null,rubid:this.getChildView("rub").collection.length?this.getChildView("rub").collection.pluck("id"):null}),this.model.isValid()?this.triggerMethod("start:find",this.model):Backbone.trigger("message:warning",{message:e.isEmpty})}},onRender:function(){this.showChildView("rub",new n({attributes:{Caption:e.relRubrics,Name:"rel-rubric",ParametrType:"Rubric",url:"/api/Rubric/ForProjects",Params:{openLevel:2},Value:[]},collection:new Backbone.Collection})),this.showChildView("status",new o({collection:s,current:0,name:"status"})),this.showChildView("result",new o({collection:l,current:0,name:"result"})),this.$("#datepickerFrom").ejDateTimePicker({locale:e.Lang,buttonText:e.Today}),this.$("#datepickerTo").ejDateTimePicker({locale:e.Lang,buttonText:e.Today})},modelEvents:{invalid:function(e,t){var i=this;t.forEach(function(e){i.$("[name='"+e.name+"']").addClass("error")})}},childViewEvents:{"dropdown:select":function(e,t){"result"===t&&this.model.set("result",e.id),"status"===t&&this.model.set("state",e.id)}}});return t.extend({initialize:function(){this.collection.url="/api/inquiry/search/",this.interceptLink=!0},onAttach:function(){this.getChildView("list").options.menuCollection.findWhere({icon:"change"}).set({cmd:function(e){window.open(location.pathname+"#projects/all/"+e[0].id+"/origin")}}),this.showChildView("find",new c({model:new a}))}})}),define("my",["i18n!nls/resources.min","projects"],function(e,t){return t.extend({initialize:function(){this.collection.url=$.mergeUrlParam("/api/inquiry/",{me:1,state:0,page:1})}})}),define("result.docs.add",["i18n!nls/resources.min","g/tree","g/ejRTEView"],function(e,t,i){return Mn.View.extend({template:templates["dialog-creating-document"],templateContext:{Resources:e},events:{"click .nav a":function(e){e.preventDefault();var t=$(e.target);t.closest("li").addClass("active").siblings().removeClass("active"),this.$(".tabs>div").hide(),this.$(t.attr("href")).show(),this.tabActive=t.attr("href")}},initialize:function(){this.tabActive="#doc3"},regions:{editor:".htmlEditor",tree:".loadTree"},onRender:function(){this.showChildView("tree",new t({collection:new Backbone.Collection,node:{checkbox:!1},branch:{pid:parseInt(this.model.get("branch").id)}})),this.getChildView("tree").collection.url="/api/Tree",this.getChildView("tree").collection.fetch({reset:!0,success:function(){}}),this.$("#fileToUpload").change(function(){if(this.$("#fileToUpload").val()){var e=this.$("#fileToUpload").val().split("\\"),t=e[e.length-1];this.$(".title").val(t),this.model.set("Display_Name",t)}}.bind(this)),this.$(".smi").autocomplete({select:function(e,t){this.model.set("MassMedia",t.item.value)}.bind(this),source:function(e,t){t($.GenQuery(e,t,"MassMedia"))}}),this.$(".author").autocomplete({select:function(e,t){this.model.set("Author",t.item.value)}.bind(this),source:function(e,t){t($.GenQuery(e,t,"Author"))}}),require(["RU"],function(){this.$(".datepicker").ejDatePicker({locale:e.Lang,buttonText:e.Today})}.bind(this))},onAttach:function(){this.showChildView("editor",new i)},modelEvents:{sync:function(){this.triggerMethod("document:created")}},mark:function(){_.each(this.model.validationError,function(e){this.$('input[name="'+e.name+'"]').css({"border-color":"red"})},this)},clear:function(){this.$("input").css("border-color",""),this.$(".bar").width(0),this.$(".percent").html("0%"),this.$("#status").empty()},save:function(e){"#doc2"===this.tabActive?this.saveTxt(e):this.saveFile(e)},saveTxt:function(e){this.model.set({Display_Name:this.$(".title").val(),title:this.$(".title").val(),pdate:$.ToISO(this.$(".datepicker").data("ejDatePicker").getValue()),content:this.getChildView("editor").ejRTE.getHtml(),smi:this.model.get("MassMedia")||this.$(".smi").val(),author:this.model.get("Author")||this.$(".author").val(),IsMedia:this.$("input[name='IsMedia']").is(":checked")}),this.model.isValid()?(e.$el.addClass("disabled"),this.model.save()):this.mark()},saveFile:function(e){if(this.model.isValid()){this.$("input").css("border-color","");var t=this.$(".bar"),i=this.$(".percent"),n=this.$("#status");n.empty(),t.width(0),i.html("0%"),this.$("#uploadFile input[name=title]").val(this.$(".title").val()),this.$("#uploadFile input[name=typeid]").val(this.model.get("typeid")),this.$("#uploadFile input[name=smi]").val(this.model.get("MassMedia")||this.$(".smi").val()),this.$("#uploadFile input[name=author]").val(this.model.get("Author")||this.$(".author").val()),this.$("#uploadFile input[name=pdate]").val($.ToISO(this.$(".datepicker").data("ejDatePicker").getValue())),this.$("#uploadFile input[name=rubricid]").val(this.model.get("rubricid")),this.$("#uploadFile").ajaxSubmit({beforeSend:function(){n.empty();t.width("0%"),i.html("0%")},uploadProgress:function(e,n,o,s){var l=s+"%";t.width(l),i.html(l)},success:function(){t.width("100%"),i.html("100%")},complete:function(e){-1===e.responseText.indexOf("Ошибка")?(this.$("#fileToUpload").val(""),n.html("<b style='color:red'>Данные успешно отправлены</b>"),this.clear(),this.trigger("document:created")):n.html(e.responseText),t.width(0),i.html("0%")}.bind(this)})}else this.mark()}})}),define("result.docs.model",[],function(e){return Backbone.Model.extend({url:function(){return"/api/object/"},defaults:function(){return{id:null,branch:{parentid:"10002",id:"10006"},typeid:10006,linkid:0,linktoid:null,rubricid:null,Display_Name:"",TextSource:"",MassMedia:"",Author:"","Дата_публикации":""}},validate:function(e,t){var i=[];if($.trim(e.Display_Name)||i.push({name:"Display_Name"}),i.length)return i},test:function(e,t){return""==e||new RegExp(t).test(e)}})}),define("result.fact.add",["i18n!nls/resources.min","g/tree","c/SimpleTableView"],function(e,t,i){var n=Mn.CollectionView.extend({childView:Mn.View.extend({template:_.template('<input type="radio" name="mychoice" />&nbsp;<label for="mychoice"><%- title %></label>'),events:{"click input[type=radio]":function(){this.triggerMethod("click:link",this.model.id)}}}),onRender:function(){if(this.collection.length){var e=this.children.findByIndex(this.collection.length-1);e.$('input[type="radio"]').get(0).checked=!0,this.triggerMethod("click:link",e.model.id)}},collectionEvents:{request:function(){Backbone.Radio.channel("loader").trigger("show",this.$el)},reset:function(){Backbone.Radio.channel("loader").trigger("hide")}}});return Mn.View.extend({template:templates["dialog-creating-fact"],templateContext:{Resources:e},regions:{links:".link-list",list:".search-result",tree:".load-tree"},modelEvents:{sync:function(){this.clear(),this.trigger("fact:created")}},onRender:function(){this.showChildView("tree",new t({collection:new Backbone.Collection,node:{checkbox:!1},branch:{pid:parseInt(this.model.get("branch").id)}})),this.getChildView("tree").collection.url="/api/Tree",this.getChildView("tree").collection.fetch({reset:!0,success:function(){}}),this.showChildView("links",new n({collection:new Backbone.Collection})),this.showChildView("list",new i({collection:new Backbone.Collection,rowTemplate:"<td><%- title %></td><td><%- type %></td>",head:new Backbone.Collection([{id:0,title:e.title,width:"70%"},{id:1,title:e.type}])}))},save:function(e){this.model.set({title:this.$("input[name='title']").val()});var t=this.model.toJSON();this.$("#link2obj").is(":checked")||(delete t.linkid,delete t.linktoid),this.model.isValid()?(e.$el.addClass("disabled"),this.model.save(t)):this.mark()},search:function(){if(this.model.set({title:this.$("input[name='title']").val()}),this.model.isValid()){var e={text:this.$("input[name='title']").val(),typeid:this.model.get("typeid")};this.getChildView("list").collection.url="/api/List/?"+$.param(e),Backbone.Radio.channel("loader").trigger("show",this.getChildView("list").$el),this.getChildView("list").collection.fetch({reset:!0,success:function(){Backbone.Radio.channel("loader").trigger("hide")}})}else this.mark()},mark:function(){_.each(this.model.validationError,function(e){this.$('input[name="'+e.name+'"]').css({"border-color":"red"})},this)},clear:function(){this.$("input[name='title']").val(),this.$("input").css({"border-color":""}),this.getChildView("list").collection.reset()},getLinksType:function(e){this.model.set({typeid:e.id,linkid:null}),this.$(".titleType").text(e.get("title")),this.getChildView("links").collection.url="/api/Links/fortype/?typeid="+e.id+"&objid="+this.model.get("linktoid"),this.getChildView("links").collection.fetch({reset:!0})},onChildviewClickLink:function(e){this.model.set("linkid",e)}})}),define("result.fact.model",[],function(e){return Backbone.Model.extend({url:function(){return"/api/object/"},defaults:function(){return{id:null,branch:{parentid:"10016",id:"40732"},title:"",typeid:40732,linkid:0,linktoid:null,rubricid:""}},validate:function(e,t){var i=[];if($.trim(e.title)||i.push({name:"title"}),i.length)return i},test:function(e,t){return""===e||new RegExp(t).test(e)}})}),define("menu",["i18n!nls/resources.min","baseurl","global.view.dropDown"],function(e,t){return new Backbone.Collection([{title:e.information,icon:"info",status:"disabled"},{title:e.addbasket,icon:"case","data-id":"B7787886-AF0E-4B5A-9061-49B182200B8C",cmd:function(e,t){Backbone.trigger("basket:add",_.pluck(e,"id"))}},{title:e.fbys,icon:"filter","data-id":"C9AB5E2B-2C29-4E22-82CA-CE3FCBE6F8FC",cmd:function(e,t){}},{title:e.addf,icon:"selection","data-id":"C9AB5E2B-2C29-4E22-82CA-CE3FCBE6F8FC",cmd:function(e,t){var i=e[0];Backbone.Radio.channel("fM").trigger("show",new Backbone.Model({id:i.id,checkID:i.get("originoid"),title:i.get("title"),Html:i.get("title")}))}},{title:e.deleteItem,icon:"trash","data-id":"86056534-0DCB-48CF-B06D-3E8D23FD5001",cmd:function(t,i){Backbone.trigger("message:confirm",{title:e.alert,message:e.askyousure+"<br/>"+e.warndeleteobj,fx:function(){_.each(t,function(e){e.url="/api/object/"+e.id,e.destroy()},this)},ctx:this})}},{title:e.toanal,icon:"analyst",classButton:"external",cmd:function(e){var i=t+"#3|Tree/0/1/"+e[0].id+"/0/0";window.open(i)}}])}),define("rowView",["i18n!nls/resources.min","c/SimpleTableView","result/fragmentsView","source:content","menu"],function(e,t,i,n,o){return Mn.View.extend({isProof:!0,template:_.template("<div></div>"),regions:{table:{el:"div",replaceElement:!0}},toolsInit:function(){this.menuCollection=o},onRender:function(){this.showChildView("table",new t({collection:this.collection,rowTemplate:this.rowTemplate,head:this.head,menuCollection:o}))},onAttach:function(){this.collection.fetch({reset:!0})},collectionEvents:{request:function(){Backbone.Radio.channel("loader").trigger("show",this.$el)},reset:function(){_.each(this.model.get("hasFragments"),function(e){var t=this.collection.get(e);t&&t.set("description",!0)},this),Backbone.Radio.channel("loader").trigger("hide")}},onChildviewPageSelect:function(e){this.collection.url=$.mergeUrlParam(this.collection.url,{page:e}),this.collection.fetch({reset:!0})},onChildviewClickRowTable:function(t){var n=Backbone.Radio.channel("tools").request("get:tools"),o=n.collection.get("fragments");o?n.children.findByModel(o).getChildView("vv").model.set({id:t.model.id,checkID:this.model.id,title:t.model.get("title")}):n.collection.add([{id:"fragments",className:"select-text",title:e.ms2,view:i,options:{model:new Backbone.Model({id:t.model.id,checkID:this.model.id,title:t.model.get("title")})}}])},onChildviewTableRowCmd:function(e){var t=new n({hideToolbar:!0,model:e.model,collection:new Backbone.Collection([],{model:Backbone.Model.extend({idAttribute:"uid"})})}),i=new Backbone.Collection;i.url="/api/details/ContentV2/"+e.model.id+"?originoid="+e.model.get("originoid"),Backbone.Radio.channel("Notify").request("once:dialog",{icon:"icon-folder",color:"blue",title:e.model.get("title"),content:t,toolbar:[],footer:[]}),Backbone.Radio.channel("loader").trigger("show",t.$el),i.fetch({success:function(e){var i=e.at(0),n=i.get("items");e.set([]),_.each(n,function(e,i){var n=_.chain(e.data).map(function(e){return[e.systemName,e.value]}).object().value();n.links=e.links,t.collection.add(n)}),Backbone.Radio.channel("loader").trigger("hide")}})}})}),define("result:infos",["i18n!nls/resources.min","rowView"],function(e,t){return t.extend({initialize:function(){this.collection=new Backbone.Collection,this.collection.url="/api/Docs/InfoDB/"+this.model.id+"?page=1",this.toolsInit(),this.rowTemplate="\n                <td>\n                    <% if(description){ %><span data-icon='icon-selection' class='right'></span><% } %>\n                    <% if(size){ %><a href='#"+Backbone.history.fragment+"/<%- id %>' class='link'><%= title %></a>\n                    <% } else { %><%= title %><% } %>\n                </td>\n                <td><%-source %></td>\n                <td class ='controls'>\n                    <button class ='g-form--context menu'><i></i></button>\n                    <% if(size) { %><button type='button' class ='g-form--context viewer' data-cmd='viewer'><span data-icon='icon-eye'></span></button><% } %>\n                </td>",this.head=new Backbone.Collection([{id:0,title:e.titlehead},{id:1,title:e.source,width:"25%"},{id:2,title:"",width:"65px"}])},onBeforeRender:function(){Backbone.Radio.channel("tools").request("get:tools").collection.reset()}})}),define("result:facts",["i18n!nls/resources.min","rowView","result.fact.model","result.fact.add"],function(e,t,i,n){return t.extend({initialize:function(){this.collection=new Backbone.Collection,this.collection.url="/api/facts/"+this.model.id+"?page=1",this.toolsInit(),this.head=new Backbone.Collection([{id:0,title:e.title,width:"60%"},{id:1,title:e.type},{id:2,title:e.source},{id:3,title:"",width:"65px"}]),this.rowTemplate="\n                <td>\n                    <% if(description){ %><span data-icon='icon-selection' class='right'></span><% } %>\n                    <% if(linkToSourceID) { %>\n                    <a href='#"+Backbone.history.fragment+"/<%- id %>' class='link'><%= title %></a>\n                    <% } else { %>\n                    <%= title %>\n                    <% } %>\n                </td>\n                <td><%- type %></td>\n                <td><%-source %></td>\n                <td class ='controls'>\n                    <button class ='g-form--context menu'><i></i></button>\n                    <% if(linkToSourceID) { %><button type='button' class='g-form--context viewer' data-cmd='viewer'><span data-icon='icon-eye'></span></button><% } %>\n                </td>"},onBeforeRender:function(){},add:function(){var t=new n({model:new i({linktoid:this.model.id,title:this.model.get("title")})}),o=Backbone.Radio.channel("Notify").request("once:dialog",{title:e.addFact,content:t,footer:[{id:"cancel",title:e.cancel},{id:"save",title:e.save,className:"right blue nest-right"},{id:"search",title:e.search,className:"right nest-right"},{id:"clear",title:e.clear,className:"right"}]});this.listenTo(t,"fact:created",function(){o.$el.hide(),this.collection.fetch({reset:!0})},this),this.listenTo(o,"controls:button:click",function(e){switch(e.model.id){case"cancel":o.$el.hide()}})}})}),define("result:docs",["i18n!nls/resources.min","rowView","result.docs.add","result.docs.model"],function(e,t,i,n){return t.extend({initialize:function(){this.collection=new Backbone.Collection,this.collection.url="/api/Docs/"+this.model.id+"?page=1",this.toolsInit(),this.head=new Backbone.Collection([{id:0,title:e.titlehead,width:"60%",subTemplate:'<input type="checkbox" class="g-form--checkbox" id="docs-inp-head"><label for="docs-inp-head" style="color:#fff;"><%- title %></label>'},{id:2,title:e.source},{id:1,title:e.size+" (Kb)"},{id:3,title:"",width:"65px"}]),this.rowTemplate="\n                <td>\n                    <% if(description) { %>\n                    <span data-icon='icon-selection' class ='right'></span>\n                    <% } %>\n                    <input type='checkbox' class='g-form--checkbox' id='cbx-<%= id %>' /><label for='cbx-<%= id %>'>\n                     <% if(size) { %>\n                     <a href='#"+Backbone.history.fragment+"/<%- id %>' class='link'><%= title %></a>\n                     <% } else { %>\n                     <%= title %>\n                     <% } %>\n                     </label>\n                 </td>\n                 <td><%-source %></td>\n                 <td><%-size %></td>\n                 <td class ='controls'>\n                    <button class ='g-form--context menu'><i></i></button>\n                    <% if(size) { %>\n                    <button type='button' class ='g-form--context viewer' data-cmd='viewer'><span data-icon='icon-eye'></span></button>\n                    <% } %>\n                 </td>"},onBeforeRender:function(){},run:function(){var t={MainObject:this.model.id,Sources:function(){return _.chain(this.collection.where({checked:!0})).pluck("id").value()}.bind(this)()};if(!t.Sources.length)return void Backbone.trigger("message:warning",{message:e.ma});Backbone.trigger("message:confirm",{title:e.confirm,message:e.runAutoSelect+"?",titleExec:e.run,fx:function(){$.ajax({type:"POST",url:"/api/docs/StartAutoExtracting",contentType:"application/json; charset=utf-8",data:JSON.stringify(t)}).always(function(){Backbone.trigger("message:success",{title:e.alert,message:e.autoselect+" "+e.ff})})},ctx:this})},add:function(){var t=new i({model:new n({linktoid:this.model.id,title:this.model.get("title"),linktoupload:location.pathname+"/files/newdoc/"})}),o=Backbone.Radio.channel("Notify").request("once:dialog",{color:"blue",title:e.addDoc,content:t,controls:[{id:"cancel",title:e.cancel},{id:"save",title:e.save,className:"right blue nest-right"},{id:"clear",title:e.clear,className:"right"}],toolbar:[]});this.listenTo(t,"document:created",function(){o.$el.hide(),this.collection.fetch({reset:!0})}),this.listenTo(o,"controls:button:click",function(e){switch(e.model.id){case"cancel":o.$el.hide()}})}})}),define("result:reqs",["i18n!nls/resources.min","rowView"],function(e,t){return t.extend({initialize:function(){this.collection=new Backbone.Collection,this.collection.url="/api/requisit/"+this.model.id+"?page=1",this.toolsInit(),this.head=new Backbone.Collection([{id:0,title:e.title,width:"60%"},{id:1,title:e.type},{id:2,title:e.source},{id:3,title:"",width:"65px"}]),this.rowTemplate="\n                <td>\n                    <% if(description){ %>\n                    <span data-icon='icon-selection' class='right'></span>\n                    <% } %>\n                    <%= title %>\n                </td>\n                <td><%- type %></td>\n                <td><%- source %></td>\n                <td class='controls'>\n                    <button class='g-form--context menu'><i></i></button>\n                </td>"},onBeforeRender:function(){Backbone.Radio.channel("tools").request("get:tools").collection.reset()}})}),define("proof:statistic",["i18n!nls/resources.min","c/SimpleTableView"],function(e,t){return Mn.View.extend({template:_.template('<div class="content-table"></div>'),regions:{list:".content-table"},initialize:function(){var e=Backbone.Radio.channel("side").request("get:sidebar"),t=e.collection.get("check"),i=e.getChildView("children").children.findByModel(t).getChildView("children"),n=i.collection.get(this.options.checkId),o=i.children.findByModel(n);$.get("/api/InterestObj/TotalCheck/"+this.model.id).done(function(e){o.getChildView("children").children.each(function(t,i){"statistic"!==t.model.id&&t.model.set("count"," ("+e[i-1]+")")})}.bind(this)),Backbone.Radio.channel("side").request("get:sidebar").setCurrent(["check",this.options.checkId,"statistic"]),this.checkID=parseInt(this.model.id),this.model=new Backbone.Model},onBeforeRender:function(){},onRender:function(){var i=new Backbone.Collection([{id:0,title:e.title,width:"65%"},{id:1,title:e.status,width:"10%"},{id:2,title:e.execution,width:"25%"}]);this.showChildView("list",new t({collection:this.collection,rowTemplate:'<td><%- title %></td><td><span class="font-icon font-icon-<%- status %>"></span></td><td><%- state %><%= details?"<br/>[<i> "+details+" </i>]":"" %></td>',head:i}))},updateStatistic:function(e){if(this.checkID===e.objID){var t=this.collection.get(e.id);if(t){t.set(e);var i=this.collection.length,n=this.collection.where({status:"invalid"}).length,o=this.collection.where({status:"complited"}).length;this.model.set({all:i,error:n,final:o,working:i-(o+n)})}}},modelEvents:{change:function(e){console.log("SR > UpdateRobots",{all:e.get("all"),error:e.get("error"),finish:e.get("final"),works:e.get("working")})}},childViewTriggers:{"click:table:row:imput":"click:table:row:imput"}})}),define("result:origin",["i18n!nls/resources.min","global.view.dropDown","global.files.attachFile","forms/1002Model","forms/1003Model"],function(e,t,i,n,o){var s=Backbone.Collection.extend({model:Backbone.Model.extend({idAttribute:"ID",defaults:{title:""}}),url:"/api/InquiryRoles"}),l=Mn.CollectionView.extend({childView:Mn.View.extend({className:"item",template:_.template('<%- title %><span data-icon="icon-close-l"></span>'),events:{"click span[data-icon=icon-close-l]":function(){this.model.collection.remove(this.model)}}}),collectionEvents:{remove:function(e){$.ajax("/api/objectroles/"+e.id+"?oid="+this.options.objModel.id,{type:"DELETE"}).done(function(){delete this.options.objModel.get("RelationsDescriptionData").Roles[e.get("title")]}.bind(this))}}});Mn.CollectionView.extend({childView:Mn.View.extend({tagName:"span",template:_.template('<a href="<%- FilePath %>" target="_blank" class="view link"><span data-icon="icon-file"></span><%- FileName %></a><span class="clear-file" data-icon="icon-close-l"></span></span>'),events:{"click .clear-file":function(){this.model.collection.remove(this.model)}}})});return Mn.View.extend({className:"workbench--content",getTemplate:function(){return 10021===this.model.get("typeid")?templates["person-card-origin"]:10022===this.model.get("typeid")?templates["company-card-origin"]:void 0},templateContext:{Resources:e},regions:{roles:".sys-role-interface",relations:".list-sources"},ui:{role:"#add-role"},events:{"click .add-btn":function(){if($.trim(this.ui.role.val())){this.ui.role.css("border-color","");var e=this.ui.role.val(),t=new Backbone.Model(this.model.get("RelationsDescriptionData")),i=new Backbone.Model(this.model.get("RelationsDescriptionData").Roles);i.set(e,0),t.set("Roles",i.toJSON()),t.url="/api/ObjectRoles?mid="+this.model.get("projectId")+"&oid="+this.model.id,t.save({},{success:function(e,t){this.model.set("RelationsDescriptionData",t),this.ui.role.val("")}.bind(this)})}else this.ui.role.css("border-color","red"),setTimeout(function(){this.ui.role.val("").css("border-color","")}.bind(this),3e3)},"click .extcode-block .link":function(t){this.$(".extcode-block .code").slideDown(),$.get("/api/Interactive/GetCodeForExternalSASys/"+this.model.id).done(function(t){this.$(".extcode-block textarea").text(t),this.$("#linkGsearch").attr("href","abscp:lang-"+e.Lang+"/gs/search/"+window.btoa(encodeURIComponent(t))),this.$("#linkEsearch").attr("href","abscp:lang-"+e.Lang+"/ts/search/"+window.btoa(encodeURIComponent(t)))}.bind(this))},"click .extcode-block .icon-close":function(e){this.$(".extcode-block .code").slideUp()},"click .copy-to-clipboard":function(){this.$(".extcode-block textarea").select(),document.execCommand("copy")}},initialize:function(){10021===this.model.get("typeid")&&(this.model=new n({id:this.model.id})),10022===this.model.get("typeid")&&(this.model=new o({id:this.model.id})),this.model.url="/api/interestObjects/input/id"+this.model.id},onRender:function(){this.model.fetch()},modelEvents:{sync:function(){var e=new s;e.on("reset",function(e){e.map(function(e){e.set("title",e.get("ProjectRoleName"))}),this.showChildView("roles",new t({collection:e})),this.getChildView("roles").setCurrent(this.model.get("ProjectRole_ID"))}.bind(this)),e.fetch({reset:!0});var i=new Backbone.Collection(_.map(this.model.get("RelationsDescriptionData").Roles,function(e,t){return{title:t,id:e}}));this.showChildView("relations",new l({collection:i,objModel:this.model})),this.$("#"+this.model.get("selectedCountries")[0]).show(),this.triggerMethod("render:tools",[])},"change:RelationsDescriptionData":function(e,t){var i=_.map(t.Roles,function(e,t){return{title:t,id:e}});this.getChildView("relations").collection.reset(i)},"change:projectRoleId":function(e,t){$.get("/Api/InquiryObjects/SetRole/"+t+"?oid="+this.model.id)}},onChildviewDropdownSelect:function(e){this.model.set("projectRoleId",e.id)}})}),define("result:reports",["i18n!nls/resources.min","baseurl","c/SimpleTableView"],function(e,t,i){var n=Backbone.Model.extend({idAttribute:"ObjID",defaults:function(){return{main:!1,reports:{},extracts:{},semSchema:!1,analystNote:!1,Email:null,Action:0}},url:"/api/Report/UploadReportsArchived",sync:function(e,t,i){Backbone.Model.prototype.sync.apply(this,["create",t,i])},validate:function(t){var i=[],n=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(t.main||Object.keys(t.reports).length||Object.keys(t.extracts).length||t.semSchema||t.analystNote||i.push(e.noselect),!t.Action||$.trim(t.Email)&&this.test(t.Email,n)||i.push(e.errorEmail),i.length)return i.join("<br/>")},test:function(e,t){return""===e||new RegExp(t).test(e)}});return Mn.View.extend({className:"workbench--content",template:templates["reports-template"],templateContext:{Resources:e},ui:{h5r:".reports>h4",h5e:".extracts>h4"},events:{"click .link":function(e){var t=$(e.target).attr("data-module");this.triggerMethod("show:content",t),Backbone.history.navigate(this.path+"/"+t,{trigger:!0})},"click input.check":function(e){var t=$(e.target),i=t.attr("id"),n=t.prop("checked");this.postModel.set(i,n)}},initialize:function(){this.path=Backbone.history.fragment,this.postModel=new n({ObjID:this.model.id})},regions:{reports:{el:"#list-reports",replaceElement:!0},extracts:{el:"#list-extracts",replaceElement:!0}},onBeforeRender:function(){},onRender:function(){var n=Backbone.history.fragment;this.showChildView("reports",new i({collection:new Backbone.Collection,rowOptions:{baseurl:t,originoid:this.model.id},rowTemplate:'\n                    <td>\n                        <input type="checkbox" id="cbx<%- id %>" class ="g-form--checkbox">\n                        <label for="cbx<%- id %>">\n                            <a href="<%- baseurl %>/SqlRepPage.aspx?rid=<%- id %>&pid=<%- originoid %>" target="_blank" class="link"><%= title %></a>\n                        </label>\n                    </td>'})),this.showChildView("extracts",new i({collection:new Backbone.Collection,rowOptions:{baseurl:t,originoid:this.model.id},rowTemplate:'<td><input type="checkbox" id="cbx<%- id %>" class="g-form--checkbox"><label for="cbx<%- id %>"><% if(size){ %><a href="#'+n+'doc/<%- id %>" class="link"><%- title %> (<%- source %>)</a><% }else{ %><span><%- title %> (<%- source %>)</span><% } %></label></td>'})),this.getChildView("reports").collection.url="/api/report/"+this.model.id,this.getChildView("extracts").collection.url="/api/Docs/InfoDB/"+this.model.id+"?page=1&od=1",this.getChildView("reports").collection.fetch({reset:!0,success:function(){this.getRegion("extracts").hasView()&&this.getChildView("extracts").collection.fetch({reset:!0,success:function(){this.triggerMethod("render:tools",[{id:"_download",className:"doc",title:e.download,tooltip:{title:e.createReport,flow:"right"}},{id:"_sendMail",side:"right",template:'<span class="g-form--input send-report"><label style="top:12px;left:-70px"><%= Resources.sendon %>:</label>&nbsp;<input type="text" value="" class="g-form--input" /><i class="rtl-1 send" data-icon="icon-send" title="<%= Resources.sendReport %>"></i></span>'}])}.bind(this)})}.bind(this)})},onChildviewPageSelect:function(e,t){t.url=$.mergeUrlParam(t.url,{page:e}),t.fetch({reset:!0})},_download:function(e){this.postModel.set({Action:0,Email:null}),this._sendToMadeArchive()},_sendMail:function(e){var t=e.$el.find("input").val();$.trim(t)&&(this.postModel.set({Action:1,Email:t}),this._sendToMadeArchive(),e.$el.find("input").val(""))},_sendToMadeArchive:function(){_.each({reports:"reports",extracts:"extracts"},function(e,t){this.getChildView(t).getChildView("body").children.each(function(t){t.$("input[type=checkbox]").prop("checked")&&(this.postModel.get(e)[t.model.id]=t.model.get("title"))},this)},this),this.postModel.isValid()?this.postModel.save({},{success:function(e,t){Backbone.trigger("message:success",{message:t}),this.postModel.set(this.postModel.defaults()),this.$("input.check").each(function(){$(this).prop("checked",!1)}),_.each({reports:"reports",extracts:"extracts"},function(e,t){this.getChildView(t).getChildView("body").children.each(function(e){e.$("input[type=checkbox]").prop("checked",!1)},this)},this)}.bind(this)}):Backbone.trigger("message:warning",{message:this.postModel.validationError})}})})
;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(i))}function i(t){var i=t.target,n=e(i);if(!n.is("[type=submit],[type=image]")){var o=n.closest("[type=submit]");if(0===o.length)return;i=o[0]}var s=this;if(s.clk=i,"image"==i.type)if(void 0!==t.offsetX)s.clk_x=t.offsetX,s.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var l=n.offset();s.clk_x=t.pageX-l.left,s.clk_y=t.pageY-l.top}else s.clk_x=t.pageX-i.offsetLeft,s.clk_y=t.pageY-i.offsetTop;setTimeout(function(){s.clk=s.clk_x=s.clk_y=null},100)}function n(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var o={};o.fileapi=void 0!==e("<input type='file'/>").get(0).files,o.formdata=void 0!==window.FormData;var s=!!e.fn.prop;e.fn.attr2=function(){if(!s)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function i(i){var n,o,s=e.param(i,t.traditional).split("&"),l=s.length,a=[];for(n=0;l>n;n++)s[n]=s[n].replace(/\+/g," "),o=s[n].split("="),a.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return a}function l(i){function o(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(e){n("cannot get iframe.contentWindow document: "+e)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(i){n("cannot get iframe.contentDocument: "+i),t=e.document}return t}function l(){function t(){try{var e=o(w).readyState;n("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(e){n("Server abort: ",e," (",e.name,")"),c(R),x&&clearTimeout(x),x=void 0}}var i=d.attr2("target"),s=d.attr2("action");y.setAttribute("target",p),a||y.setAttribute("method","POST"),s!=u.url&&y.setAttribute("action",u.url),u.skipEncodingOverride||a&&!/post/i.test(a)||d.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),u.timeout&&(x=setTimeout(function(){C=!0,c(_)},u.timeout));var l=[];try{if(u.extraData)for(var r in u.extraData)u.extraData.hasOwnProperty(r)&&(e.isPlainObject(u.extraData[r])&&u.extraData[r].hasOwnProperty("name")&&u.extraData[r].hasOwnProperty("value")?l.push(e('<input type="hidden" name="'+u.extraData[r].name+'">').val(u.extraData[r].value).appendTo(y)[0]):l.push(e('<input type="hidden" name="'+r+'">').val(u.extraData[r]).appendTo(y)[0]));u.iframeTarget||(f.appendTo("body"),w.attachEvent?w.attachEvent("onload",c):w.addEventListener("load",c,!1)),setTimeout(t,15);try{y.submit()}catch(e){var h=document.createElement("form").submit;h.apply(y)}}finally{y.setAttribute("action",s),i?y.setAttribute("target",i):d.removeAttr("target"),e(l).remove()}}function c(t){if(!b.aborted&&!j){if(N=o(w),N||(n("cannot access response document"),t=R),t===_&&b)return b.abort("timeout"),void V.reject(b,"timeout");if(t==R&&b)return b.abort("server abort"),void V.reject(b,"error","server abort");if(N&&N.location.href!=u.iframeSrc||C){w.detachEvent?w.detachEvent("onload",c):w.removeEventListener("load",c,!1);var i,s="success";try{if(C)throw"timeout";var l="xml"==u.dataType||N.XMLDocument||e.isXMLDoc(N);if(n("isXml="+l),!l&&window.opera&&(null===N.body||!N.body.innerHTML)&&--D)return n("requeing onLoad callback, DOM not available"),void setTimeout(c,250);var a=N.body?N.body:N.documentElement;b.responseText=a?a.innerHTML:null,b.responseXML=N.XMLDocument?N.XMLDocument:N,l&&(u.dataType="xml"),b.getResponseHeader=function(e){return{"content-type":u.dataType}[e]},a&&(b.status=Number(a.getAttribute("status"))||b.status,b.statusText=a.getAttribute("statusText")||b.statusText);var r=(u.dataType||"").toLowerCase(),d=/(json|script|text)/.test(r);if(d||u.textarea){var h=N.getElementsByTagName("textarea")[0];if(h)b.responseText=h.value,b.status=Number(h.getAttribute("status"))||b.status,b.statusText=h.getAttribute("statusText")||b.statusText;else if(d){var g=N.getElementsByTagName("pre")[0],p=N.getElementsByTagName("body")[0];g?b.responseText=g.textContent?g.textContent:g.innerText:p&&(b.responseText=p.textContent?p.textContent:p.innerText)}}else"xml"==r&&!b.responseXML&&b.responseText&&(b.responseXML=M(b.responseText));try{T=S(b,r,u)}catch(e){s="parsererror",b.error=i=e||s}}catch(e){n("error caught: ",e),s="error",b.error=i=e||s}b.aborted&&(n("upload aborted"),s=null),b.status&&(s=b.status>=200&&300>b.status||304===b.status?"success":"error"),"success"===s?(u.success&&u.success.call(u.context,T,"success",b),V.resolve(b.responseText,"success",b),m&&e.event.trigger("ajaxSuccess",[b,u])):s&&(void 0===i&&(i=b.statusText),u.error&&u.error.call(u.context,b,s,i),V.reject(b,"error",i),m&&e.event.trigger("ajaxError",[b,u,i])),m&&e.event.trigger("ajaxComplete",[b,u]),m&&!--e.active&&e.event.trigger("ajaxStop"),u.complete&&u.complete.call(u.context,b,s),j=!0,u.timeout&&clearTimeout(x),setTimeout(function(){u.iframeTarget||f.remove(),b.responseXML=null},100)}}}var r,h,u,m,p,f,w,b,v,k,C,x,y=d[0],V=e.Deferred();if(i)for(h=0;g.length>h;h++)r=e(g[h]),s?r.prop("disabled",!1):r.removeAttr("disabled");if(u=e.extend(!0,{},e.ajaxSettings,t),u.context=u.context||u,p="jqFormIO"+(new Date).getTime(),u.iframeTarget?(f=e(u.iframeTarget),k=f.attr2("name"),k?p=k:f.attr2("name",p)):(f=e('<iframe name="'+p+'" src="'+u.iframeSrc+'" />'),f.css({position:"absolute",top:"-1000px",left:"-1000px"})),w=f[0],b={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var i="timeout"===t?"timeout":"aborted";n("aborting upload... "+i),this.aborted=1;try{w.contentWindow.document.execCommand&&w.contentWindow.document.execCommand("Stop")}catch(e){}f.attr("src",u.iframeSrc),b.error=i,u.error&&u.error.call(u.context,b,i,t),m&&e.event.trigger("ajaxError",[b,u,i]),u.complete&&u.complete.call(u.context,b,i)}},m=u.global,m&&0==e.active++&&e.event.trigger("ajaxStart"),m&&e.event.trigger("ajaxSend",[b,u]),u.beforeSend&&!1===u.beforeSend.call(u.context,b,u))return u.global&&e.active--,V.reject(),V;if(b.aborted)return V.reject(),V;(v=y.clk)&&(k=v.name)&&!v.disabled&&(u.extraData=u.extraData||{},u.extraData[k]=v.value,"image"==v.type&&(u.extraData[k+".x"]=y.clk_x,u.extraData[k+".y"]=y.clk_y));var _=1,R=2,$=e("meta[name=csrf-token]").attr("content"),B=e("meta[name=csrf-param]").attr("content");B&&$&&(u.extraData=u.extraData||{},u.extraData[B]=$),u.forceSync?l():setTimeout(l,10);var T,N,j,D=50,M=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},I=e.parseJSON||function(e){return window.eval("("+e+")")},S=function(t,i,n){var o=t.getResponseHeader("content-type")||"",s="xml"===i||!i&&o.indexOf("xml")>=0,l=s?t.responseXML:t.responseText;return s&&"parsererror"===l.documentElement.nodeName&&e.error&&e.error("parsererror"),n&&n.dataFilter&&(l=n.dataFilter(l,i)),"string"==typeof l&&("json"===i||!i&&o.indexOf("json")>=0?l=I(l):("script"===i||!i&&o.indexOf("javascript")>=0)&&e.globalEval(l)),l};return V}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var a,c,r,d=this;"function"==typeof t&&(t={success:t}),a=t.type||this.attr2("method"),c=t.url||this.attr2("action"),r="string"==typeof c?e.trim(c):"",r=r||window.location.href||"",r&&(r=(r.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:r,success:e.ajaxSettings.success,type:a||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var h={};if(this.trigger("form-pre-serialize",[this,t,h]),h.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&!1===t.beforeSerialize(this,t))return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var u=t.traditional;void 0===u&&(u=e.ajaxSettings.traditional);var m,g=[],p=this.formToArray(t.semantic,g);if(t.data&&(t.extraData=t.data,m=e.param(t.data,u)),t.beforeSubmit&&!1===t.beforeSubmit(p,this,t))return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[p,this,t,h]),h.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var f=e.param(p,u);m&&(f=f?f+"&"+m:m),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+f,t.data=null):t.data=f;var w=[];if(t.resetForm&&w.push(function(){d.resetForm()}),t.clearForm&&w.push(function(){d.clearForm(t.includeHidden)}),!t.dataType&&t.target){var b=t.success||function(){};w.push(function(i){var n=t.replaceTarget?"replaceWith":"html";e(t.target)[n](i).each(b,arguments)})}else t.success&&w.push(t.success);if(t.success=function(e,i,n){for(var o=t.context||this,s=0,l=w.length;l>s;s++)w[s].apply(o,[e,i,n||d,d])},t.error){var v=t.error;t.error=function(e,i,n){var o=t.context||this;v.apply(o,[e,i,n,d])}}if(t.complete){var k=t.complete;t.complete=function(e,i){var n=t.context||this;k.apply(n,[e,i,d])}}var C=e('input[type=file]:enabled[value!=""]',this),x=C.length>0,y="multipart/form-data",V=d.attr("enctype")==y||d.attr("encoding")==y,_=o.fileapi&&o.formdata;n("fileAPI :"+_);var R,$=(x||V)&&!_;!1!==t.iframe&&(t.iframe||$)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){R=l(p)}):R=l(p):R=(x||V)&&_?function(n){for(var o=new FormData,s=0;n.length>s;s++)o.append(n[s].name,n[s].value);if(t.extraData){var l=i(t.extraData);for(s=0;l.length>s;s++)l[s]&&o.append(l[s][0],l[s][1])}t.data=null;var c=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:a||"POST"});t.uploadProgress&&(c.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var i=0,n=e.loaded||e.position,o=e.total;e.lengthComputable&&(i=Math.ceil(n/o*100)),t.uploadProgress(e,n,o,i)},!1),e}),c.data=null;var r=c.beforeSend;return c.beforeSend=function(e,t){t.data=o,r&&r.call(this,e,t)},e.ajax(c)}(p):e.ajax(t),d.removeData("jqxhr").data("jqxhr",R);for(var B=0;g.length>B;B++)g[B]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(o){if(o=o||{},o.delegation=o.delegation&&e.isFunction(e.fn.on),!o.delegation&&0===this.length){var s={s:this.selector,c:this.context};return!e.isReady&&s.s?(n("DOM not ready, queuing ajaxForm"),e(function(){e(s.s,s.c).ajaxForm(o)}),this):(n("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return o.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,o,t).on("click.form-plugin",this.selector,o,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",o,t).bind("click.form-plugin",o,i)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,i){var n=[];if(0===this.length)return n;var s=this[0],l=t?s.getElementsByTagName("*"):s.elements;if(!l)return n;var a,c,r,d,h,u,m;for(a=0,u=l.length;u>a;a++)if(h=l[a],(r=h.name)&&!h.disabled)if(t&&s.clk&&"image"==h.type)s.clk==h&&(n.push({name:r,value:e(h).val(),type:h.type}),n.push({name:r+".x",value:s.clk_x},{name:r+".y",value:s.clk_y}));else if((d=e.fieldValue(h,!0))&&d.constructor==Array)for(i&&i.push(h),c=0,m=d.length;m>c;c++)n.push({name:r,value:d[c]});else if(o.fileapi&&"file"==h.type){i&&i.push(h);var g=h.files;if(g.length)for(c=0;g.length>c;c++)n.push({name:r,value:g[c],type:h.type});else n.push({name:r,value:"",type:h.type})}else null!==d&&void 0!==d&&(i&&i.push(h),n.push({name:r,value:d,type:h.type,required:h.required}));if(!t&&s.clk){var p=e(s.clk),f=p[0];(r=f.name)&&!f.disabled&&"image"==f.type&&(n.push({name:r,value:p.val()}),n.push({name:r+".x",value:s.clk_x},{name:r+".y",value:s.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var n=this.name;if(n){var o=e.fieldValue(this,t);if(o&&o.constructor==Array)for(var s=0,l=o.length;l>s;s++)i.push({name:n,value:o[s]});else null!==o&&void 0!==o&&i.push({name:this.name,value:o})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],n=0,o=this.length;o>n;n++){var s=this[n],l=e.fieldValue(s,t);null===l||void 0===l||l.constructor==Array&&!l.length||(l.constructor==Array?e.merge(i,l):i.push(l))}return i},e.fieldValue=function(t,i){var n=t.name,o=t.type,s=t.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||t.disabled||"reset"==o||"button"==o||("checkbox"==o||"radio"==o)&&!t.checked||("submit"==o||"image"==o)&&t.form&&t.form.clk!=t||"select"==s&&-1==t.selectedIndex))return null;if("select"==s){var l=t.selectedIndex;if(0>l)return null;for(var a=[],c=t.options,r="select-one"==o,d=r?l+1:c.length,h=r?l:0;d>h;h++){var u=c[h];if(u.selected){var m=u.value;if(m||(m=u.attributes&&u.attributes.value&&!u.attributes.value.specified?u.text:u.value),r)return m;a.push(m)}}return a}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,o=this.tagName.toLowerCase();i.test(n)||"textarea"==o?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==o?this.selectedIndex=-1:"file"==n?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(!0===t&&/hidden/.test(n)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==_typeof(this.reset)&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var n=e(this).parent("select");t&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery),function(e){var t={mode:null,min:0,max:100,val:33,colorMain:"#b0d2c8",colorFiller:"#3bb54c",colorStick:"#3bb54c",rotateFrom:0,rotateTo:166,rotateFrom1:7.3,rotateTo1:172.7,anim:"all 1s"};e.fn.gtkMeter=function(i){var n=e.extend({},t,i);return this.each(function(){var t,i=e(this).data("meter-min"),o=e(this).data("meter-max"),s=e(this).data("meter-val");(void 0==i||""==i)&&(i=n.min),(void 0==o||""==o)&&(o=n.max),(void 0==s||""==s)&&(s=n.val),t=e.fn.gtkMeter.mathmeter(i,o,s,n),e.fn.gtkMeter.svg(e(this)),e.fn.gtkMeter.stylize(e(this),t,n)})},e.fn.gtkMeter.mathmeter=function(e,t,i,n){var o=i/(t/100),s={};return s.one=(n.rotateTo-n.rotateFrom)/100*o,s.two=(n.rotateTo1-n.rotateFrom1)/100*o,s.two=s.two+6.6,s},e.fn.gtkMeter.svg=function(e){return e.find("svg.gtk-meter").length>0?e:e.append('<svg class="gtk-meter" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 93 41"><path class="gtk-meter-main" d="M46.5,0C20.8,0,0,20.8,0,46.5C0,72.2,20.8,93,46.5,93S93,72.2,93,46.5C93,20.8,72.2,0,46.5,0z M46.5,87C24.1,87,6,68.9,6,46.5C6,24.1,24.1,6,46.5,6S87,24.1,87,46.5C87,68.9,68.9,87,46.5,87z"/><path class="gtk-meter-filler" style="-webkit-transform: rotate(0deg); -ms-transform: rotate(0deg); transform: rotate(0deg);" d="M40.8,92.7c25.5,3.1,48.7-15,51.8-40.5l-6-0.7c-2.7,22.2-22.9,38-45.1,35.3S3.6,63.8,6.3,41.6l-6-0.7C-2.8,66.3,15.4,89.5,40.8,92.7z"/><g class="gtk-meter-stick"><rect fill="none" x="46.5" y="46.2" width="41.8" height="0.7"/><polygon points="5.5,46.2 46.5,45.2 46.5,47.9 5.5,46.8 "/></g></svg>')},e.fn.gtkMeter.stylize=function(e,t,i){var n=" -webkit-transition: "+i.anim+"; -moz-transition: "+i.anim+"; -o-transition: "+i.anim+"; transition: "+i.anim+"; ",o=" -webkit-transform: rotate("+t.one+"deg); -ms-transform: rotate("+t.one+"deg); transform: rotate("+t.one+"deg); ",s=" -webkit-transform: rotate("+t.two+"deg); -ms-transform: rotate("+t.two+"deg); transform: rotate("+t.two+"deg); ";return e.find(".gtk-meter-main").attr("fill",i.colorMain),e.find(".gtk-meter-filler").attr("fill",i.colorFiller).attr("style",n+" transform-origin: 51.8% 10.3%; "+o),e.find(".gtk-meter-stick").attr("fill",i.colorStick).attr("style",n+" transform-origin: 50% 50%; "+s),e},e(function(){})}(window.jQuery||window.Zepto),define("storage",["i18n!nls/resources.min"],function(e){return new(Backbone.Model.extend({defaults:{Trees:{},Players:[],ConnectUrl:""},initialize:function(){this.Current=null,Backbone.on("storage:addTree",this.addTree,this),Backbone.on("storage:addPlayer",this.addPlayer,this),Backbone.on("storage:clearPlayers",this.clearPlayers,this),Backbone.on("storage:check-add",this.addChecking,this),Backbone.on("storage:check-clear",this.clearChecking,this),Backbone.on("storage:temp-object",this.setCurrent,this)},setCurrent:function(e){this.Current=e},clearChecking:function(e){var t=this.checkCollection.get(e);this.checkCollection.remove(t)},addChecking:function(e){this.checkCollection||(this.checkCollection=new Backbone.Collection),this.checkCollection.add(e)},getTree:function(e,t,i,n){return new Promise(function(o,s){var l=this.get("Trees");if(!l[e]||t){var a=this.getModelForTree(e);require(["g/tree/TreeView"],function(t){var s=n||{};s.model=a,s.api=function(){return"/api/"+e+(i||"")},s.markCurrent=!0,l[e]=new t(s),this.set("Trees",l),o(l[e])}.bind(this))}else l[e].operation=this.getModelForTree(e).get("present").operation,o(l[e])}.bind(this))},getModelForTree:function(e){if($.trim(e))return this.buts||this.getButs(),new Backbone.Model(_.findWhere(this.buts,{id:e}))},getButs:function(){var t=e.QueryButtonsData,i=[];return _.each(t,function(e){i.push(e);var t=e.addButtons;t&&(i=_.union(i,t))},this),this.buts=i,i},addPlayer:function(e,t){this.get("Players").push(e)},clearPlayers:function(){var e=this.get("Players");_.each(e,function(e){e.pause(),e.src="",e.load(),e={}},this)}}))}),define("global.files.attachFile",["i18n!nls/resources.min"],function(e){return Backbone.View.extend({events:{"click .clear":"clear","change #uploadFile input":"onchangefile"},onchangefile:function(e){var t=e.target.value;if(e.target.previousSibling.innerHTML=t,$.trim(t)){var i=t.split("\\"),n=i[i.length-1];this.collection.get(n)||this.$("#uploadFile").submit()}},valid:function(){this.$("#uploadFile").css("border-color","");var e=this.$("#fileToUpload").val();if($.trim(e)){var t=e.split("\\"),i=t[t.length-1];this.collection.get(i)||this.$("#uploadFile").submit()}else this.$("#uploadFile").css("border-color","red")},clear:function(e){var t=$(e.target).closest("div").attr("data-name"),i=this.collection.get(t);this.collection.remove(i),this.setModel()},initialize:function(e){this.collection=new Backbone.Collection,this.collection.model=Backbone.Model.extend({idAttribute:"FileName"}),this.collection.on("add",this.change,this),this.collection.on("remove",this.change,this),this.collection.on("reset",this.list,this)},render:function(){this.$el.html(_.template('<span class="dropdown-menu_arrow"></span><span class="dropdown-menu_close hide-attach-manage"><span class="icon-close" data-icon="icon-close-l"></span></span><div class="menu-info-message"><div class="form-group"><label for="add-files"><%= Resources.addfiles %></label><div id="uploadFileBlock" data-id="CE669C9B-4E43-4E24-B968-D97679A5A1A0"><form id="uploadFile" method="post" enctype="multipart/form-data"><label class ="uploadbutton"><div class="button blue"><span data-icon="icon-import"></span></div><div class="button"><span data-icon="icon-folder"></span></div><div class ="input"><%= Resources.selFile %></div><input type="file" name="fileToUpload" id="fileToUpload" /></label></form><div class="percent">0%</div><div class="progress"><div class="bar"></div></div></div></div></div><div class="list-cmd-panel"></div>')({Resources:e})),this.$("#uploadFileBlock").show(),this.$("#uploadFile").attr("action","/api/common/upload/?st=1");var t=this.$(".bar"),i=this.$(".percent");return t.width(0),i.html("0%"),this.$("#fileToUpload").val(""),this.$("#uploadFile").ajaxForm({beforeSend:function(){t.width("0%"),i.html("0%")},uploadProgress:function(e,n,o,s){var l=s+"%";t.width(l),i.html(l)},success:function(){t.width("100%"),i.html("100%")},complete:function(e){var n=this.$("#fileToUpload").val().split("\\"),o=n[n.length-1];_.map(e.responseJSON,function(e){this.collection.add({FileName:o,FilePath:e})},this),this.setModel(),this.$("#fileToUpload").val(""),this.$("#fileToUpload").prev(".input").text(""),setTimeout(function(){t.width(0),i.html("0%")},1e3)}.bind(this)}),this},setModel:function(){return this.output={},this.collection.each(function(e){this.output[e.get("FileName")]=e.get("FilePath")},this),this.model&&this.model.set("AttacheedFiles",this.output),this},change:function(){this.list(),this.trigger("change:collection")},list:function(){this.$(".list-cmd-panel").empty(),this.collection.each(function(e){this.$(".list-cmd-panel").append(_.template("<div data-name='<%= FileName %>'><span><%= FileName %></span><span class='cmd'><a href='<%= FilePath %>' target='_blank' class='view'><span data-icon='icon-eye'></span></a><button type='button' class='clear'><span data-icon='icon-close-l'></span></button></span></div>")(e.toJSON()))},this)}})}),define("visualization",["i18n!nls/resources.min"],function(e){return Mn.Object.extend({initialize:function(){this.content=this.options.content,this.model=this.options.model,this.activeEvent="hand",this.zoomInit(),this.zoomSet(),this.initSelectedArea()},Transform:function(){d3.zoomTransform(this.zoomSelection.node()),this.activeEvent;this.contextMenuInit(),this.zoomSet()},active:function(e){switch(this.activeEvent=e.split("--")[1],this.content.removeClass("hand-mode"),this.content.removeClass("editor-mode"),this.content.removeClass("zoom-mode"),this.activeEvent){case"zoom":case"zoomout":case"zoomin":case"zoomfit":this.content.addClass("zoom-mode"),d3.select(this.content.get(0)).on("mousedown",null);break;case"hand":this.content.addClass("hand-mode");break;case"editor":this.content.addClass("editor-mode"),this.initSelectedArea()}},contextMenuInit:function(){},zoomInit:function(){this.zoom=d3.zoom().filter(function(){var e=!0;return"zoom"!==this.activeEvent&&"zoomout"!==this.activeEvent&&"zoomin"!==this.activeEvent||"mousedown"!==d3.event.type||(e=!1),"editor"===this.activeEvent&&(e=!1),e}.bind(this)).scaleExtent([.125,6]).on("start",function(){"hand"===this.activeEvent&&this.content.addClass("hold")}.bind(this)).on("zoom",function(){var e=d3.event.transform;this.firstElementChild.setAttribute("transform","translate("+e.x+","+e.y+") scale("+e.k+")")}).on("end",function(){"hand"===this.activeEvent&&this.content.removeClass("hold")}.bind(this))},zoomSet:function(){this.zoomSelection=d3.select(this.content.find("svg").get(0)).call(this.zoom).on("dblclick.zoom",null)},initSelectedArea:function(){var e=this.contextMenu,t=d3.select(this.content.get(0)),i=this;t.on("mousedown",function(){var n=$(d3.event.target);if(n.hasClass("item")&&n.attr("data-cmd"))switch(n.attr("data-cmd")){case"more":var o=this.contextMenu.current.id;if(o){var s=Backbone.Model.extend({default:function(){return{id:null,title:"",html:"",text:""}},url:function(){return"/api/Details/"+this.id}});new s({id:o})}break;case"check":$.get("/api/interestObjects/input/id"+this.contextMenu.current.id).done(function(e){Backbone.history.navigate("project/"+this.options.projectId+"/edit/"+models[0].id,{trigger:!0})})}if(e.hide(),d3.event.stopPropagation(),d3.event.preventDefault(),"zoom"===i.activeEvent&&1===d3.event.which){var l=d3.mouse(this.zoomSelection.node());this.content.find(".selected-area").remove();var a=$("<div class='selected-area' style='position:absolute;border:dashed 2px #333;z-index:1000;width:1px;height:1px;'></div>");a.css({top:l[1]+"px",left:l[0]+"px"}),this.content.prepend(a),t.on("mousemove",function(){var e=d3.mouse(t.node()),i=l[0],n=l[1],o=e[0]-i,s=e[1]-n;a.css({top:l[1]+"px",left:l[0]+"px",width:o+"px",height:s+"px"})}).on("mouseup",function(){d3.event.stopPropagation(),t.on("mousemove",null).on("mouseup",null),this.content.find(".selected-area").remove();var e=d3.mouse(this.zoomSelection.node());this.zoomIn(l,e)}.bind(this))}}.bind(this))},zoomIn:function(e,t){var i=this.content.parent("div"),n=[t[0]-e[0],t[1]-e[1]],o=[i.width(),i.height()],s=o[0]/o[1],l=n[0]/n[1];if(!(n[0]<50||n[1]<50)){n[0]=n[0]<80?80:n[0],n[1]=n[1]<80?80:n[1],l>1?n[1]=n[0]/s:n[0]=n[1]*s;var a=o[0]/n[0],c=o[1]/n[1],r=(a+c)/2;console.log(e,t),console.log(d3.zoomTransform(this.zoomSelection.node())),console.log(r);var d=d3.zoomTransform(this.zoomSelection.node());r*d.k>6&&(r=6/d.k),d.k=r*d.k,d.x=r*d.x-e[0]*r,d.y=r*d.y-e[1]*r,this.zoom.transform(this.zoomSelection,d),console.log(d3.zoomTransform(this.zoomSelection.node()))}}})}),define("global.semnet.layout",["i18n!nls/resources.min","global.view.dropDown","visualization","baseurl","g/tree","c/ContextMenuView"],function(e,t,i,n,o,s){var l=new Backbone.Collection([{id:"_runTask",title:e.runagain,icon:"next",child:[{id:"_runTaskPerson",title:e.person},{id:"_runTaskOrganization",title:e.company}]}]);e.hashurl="abscp:lang-"+e.Lang+"/analyst/sndesign/"+window.btoa(encodeURIComponent(location.href));var a=new Backbone.Collection([{title:e.snl1,id:0},{title:e.snl2,id:1},{title:e.snl3,id:2},{title:e.snl4,id:3},{title:e.snl5,id:4},{title:e.snl6,id:5},{title:e.snl7,id:6}]),c=new Backbone.Collection([{title:e.ss1,id:0},{title:e.ss2,id:1},{title:e.ss3,id:2}]),r=new Backbone.Collection([{title:"level 1",id:1},{title:"level 2",id:2},{title:"level 3",id:3}]),d=Backbone.Model.extend({idAttribute:"snid",defaults:{snid:-1,title:"",subtitle:"",width:0,height:0,html:""}}),h=Backbone.Collection.extend({model:d}),u=Mn.View.extend({tagName:"li",getTemplate:function(){return"add"===this.model.id?(this.$el.addClass("controls"),_.template('<span class="semantic-tabs--add"></span>')):"set"===this.model.id?(this.$el.addClass("controls"),_.template('<span class="semantic-tabs--settings"></span>')):_.template("<span class=\"semTab <%- snid===-1?'default':'' %>\"><%- title %><% if(snid!==-1){ %><i></i><% } %></span>")},triggers:{"click:not(.controls)":"click:view"},events:{"click .semantic-tabs--settings":function(){this.$el.closest(".semantic-tabs").toggleClass("edit-mode")},"click .semantic-tabs--add":function(){Backbone.trigger("message:warning",{title:e.alert,message:"in developing"})},"click i":function(){Backbone.trigger("message:confirm",{title:e.alert,message:e.askyousure+"<br/>"+e.wdostr.replace("{0}","["+this.model.get("title")+"]"),fx:function(){Backbone.trigger("message:warning",{title:e.alert,message:"in developing"})},ctx:this})}}}),m=(Mn.CollectionView.extend({tagName:"ul",childView:u,setActive:function(e){this._activeModel=e,this.children.each(function(e){e.$el.removeClass("active")});var t=this.children.findByModel(e);t&&t.$el.addClass("active")},getActive:function(){return this._activeModel},initialize:function(){this.collection.comparator="position"},onBeforeRender:function(){this.collection.add([new d({snid:"add",position:0}),new d({snid:"set",position:this.collection.length+2})])},childViewOptions:function(e,t){e.has("position")||e.set("position",t-1)},onAttach:function(){this.collection.sort()}}),Backbone.Model.extend({defaults:function(){return{Resources:e,layout:0,level:2,astree:0,filter:[],eparam:[0,0,0]}}})),g=(Mn.CollectionView.extend({className:"g-form--filter",childView:Mn.View.extend({tagName:"span",template:_.template("<%- title %>"),triggers:{click:"click:item"}}),onChildviewClickItem:function(e){this.collection.remove(e.model)},collectionEvents:{reset:function(){this.triggerMethod("change:types:collection")},update:function(){this.triggerMethod("change:types:collection")}}}),Mn.View.extend({template:"#semantic-scheme-tools",className:"semantic-sidebar",regions:{ddlevel:"#level",ddtree:"#astree",ddlayout:"#layout",typesBlock:{el:".g-form--filter",replaceElement:!0}},triggers:{"click input[name=reload]":"sem:reload","click input[name=export]":"sem:export"},events:{"click input[name=clear]":function(e){this.getChildView("typesBlock").collection.reset()},"click input[name=objects]":function(t){var i=new Backbone.Collection;i.url="/api/Type";var n={title:e.selectTree,controls:[],view:new o({collection:i,node:{checkbox:!1,levelOpen:3}})};i.fetch({reset:!0});var s=Backbone.Radio.channel("Notify").request("once:dialog",n);this.listenTo(n.view,"container:select:item",function(e){this.getChildView("typesBlock").collection.add(e.model),s.$el.hide()})},"click input[type=checkbox]":function(e){var t=$(e.target),i=["id1","id2","id3"];this.model.get("eparam")[i.indexOf(t.attr("id"))]=t.is(":checked")?1:0,this.model.trigger("change")},"click #tools-hamburger":function(e){var t=$(e.target).closest("div");t.toggleClass("active").parent(".semantic-sidebar").toggleClass("active"),this.triggerMethod("click:tools:hamburger",t.hasClass("active"))},"click #editmode":function(e){$(e.target).toggleClass("enabled"),this.triggerMethod("switch:edit:mode",$(e.target).hasClass("enabled")),$(e.target).hasClass("enabled")?(this.$(".semantic--tool-viewmode").hide(),this.$(".semantic--tool-viewmode.edit").show()):(this.$(".semantic--tool-viewmode").show(),this.$(".semantic--tool-viewmode.edit").hide())},"click .semantic-tools span":function(e){this.$(".semantic-tools span").removeClass("active"),$(e.target).toggleClass("active"),this.triggerMethod("click:tools:bar",e)}},onRender:function(){this.showChildView("ddlayout",new t({collection:a,current:this.model.get("layout"),name:"layout"})),this.showChildView("ddtree",new t({collection:c,current:this.model.get("astree"),name:"astree"})),this.showChildView("ddlevel",new t({collection:r,current:this.model.get("level"),name:"level"}))},onChildviewDropdownSelect:function(e,t){this.model.set(t,e.id)},onChildviewChangeTypesCollection:function(){this.model.set("filter",this.getChildView("typesBlock").collection.pluck("id"))}})),p=Mn.View.extend({className:"semantic-board",template:_.template('<div class="inner"><div id="context-menu"></div><div class="svg-content"><%= html %></div></div>'),regions:{cmenu:"#context-menu"},events:{"contextmenu g[data-objectid]":function(e){var t=this;e.preventDefault();var i=$(e.target),n=i.closest("g").data("objectid");if(this.getRegion("cmenu").$el.hide(),parseInt(n)){this.selectedObject={id:n,title:$.trim(i.text())},this.getRegion("cmenu").$el.css({left:event.layerX,top:event.layerY});var o=setTimeout(function(){t.getRegion("cmenu").$el.slideDown()},100);this.getRegion("cmenu").$el.on("mouseenter",function(){clearTimeout(o)}),this.getRegion("cmenu").$el.on("mouseleave",function(){o=setTimeout(function(){t.getRegion("cmenu").$el.slideUp()},300)})}},"mousedown g[data-objectid]":function(e){}},initialize:function(){this.listenTo(this.options.request,"change",this.getContent)},onRender:function(){this.showChildView("cmenu",new s({collection:l})),this.getContent()},modelEvents:{sync:function(){parseInt(this.model.get("width"))>this.$el.width()&&this.$(".svg-content").css({width:this.model.get("width")}),parseInt(this.model.get("height"))>this.$el.height()&&this.$(".svg-content").css({height:this.model.get("height")});var e='<svg width="100%" height="100%"><g id="main" transform="translate(0,0) scale(1)">'+$(this.model.get("html")).html()+"</g></svg>";this.$(".svg-content").html(e),this.Visualization?this.Visualization.Transform():(this.Visualization=new i({content:this.$(".svg-content"),model:this.model}),
this.setVisualization("semantic-tools--hand"))},error:function(){}},childViewEvents:{"menu:click:item":function(e){this.getRegion("cmenu").$el.hide();var t=e.model.id;this.selectedObject&&("_runTaskPerson"===t&&Backbone.history.navigate("project/"+this.options.projectId+"/add/PERSON?lname_INTERN="+this.selectedObject.title,{trigger:!0}),"_runTaskOrganization"===t&&Backbone.history.navigate("project/"+this.options.projectId+"/add/COMPANY?title_INTERN="+this.selectedObject.title,{trigger:!0}))}},switchMode:function(e){this.$(".svg-content").toggleClass("edit-mode")},setVisualization:function(e){this.Visualization.active(e)},getContent:function(){var e=this.options.request.toJSON();delete e.Resources,this.model.url="/api/SemNet/"+this.model.get("id")+"/?semnetid="+this.model.id+"&"+$.param(e),this.model.fetch()}});return Mn.View.extend({template:"#semantic-scheme-wrapper",events:{"click .semantic-tabs .control":function(){this.$(".semantic-tabs").toggleClass("active"),this.$(".semantic-tabs").hasClass("active")?this.getChildView("svgContent").$el.animate({height:"-=44"},150):this.getChildView("svgContent").$el.animate({height:"+=44"},150)},"click #sfs":function(){this.$("section").toggleClass("fullscreen"),this.fitSize()}},regions:{svgContent:{el:"#svg-content",replaceElement:!0},toolsBar:{el:"#tools-bar",replaceElement:!0}},initialize:function(){Backbone.on("window:resizeend",this.fitSize,this),this.request=new m},fitSize:function(){var e=$(window).height()-this.$("section").offset().top;this.$(".semantic-wrapper").css({height:e});var t=e-26,i=this.getChildView("svgContent");i.$el.css({height:t}),i.$(".svg-content").css({height:t}),parseInt(i.model.get("height"))>i.$el.height()&&i.$(".svg-content").css({height:i.model.get("height")})},onBeforeRender:function(){$("#form-svg2png").get(0)||$("body").append($('<form action="'+n+'/Svg" id="form-svg2png" class="svgToPng" method="post" name="svgToPng" target="_blank"><input id="data" name="data" type="hidden" value="" /></form>'))},onRender:function(){this.model.url="/api/SemNet/UserSNMeta/"+this.model.id,this.model.fetch()},viewLayout:function(e){this.showChildView("toolsBar",new g({model:this.request})),this.showChildView("svgContent",new p({model:e,request:this.request,projectId:this.model.get("projectId")})),this.fitSize()},modelEvents:{sync:function(e){var t=new h(e.get("Tabs"));this.viewLayout(t.get(-1))}},onChildviewClickView:function(e){e.model&&this.viewLayout(e.model)},onChildviewSwitchEditMode:function(e){this.getChildView("svgContent").switchMode(e)},onChildviewClickToolsBar:function(e){this.getChildView("svgContent").setVisualization($(e.target).attr("class").split(" ")[0])},onChildviewClickToolsHamburger:function(e){},onChildviewSemReload:function(){this.request.set(this.request.defaults());var e=this.getChildView("svgContent").model;this.viewLayout(e)},onChildviewSemExport:function(){var e=this.getChildView("svgContent").$(".svg-content").get(0).outerHTML,t=document.forms.svgToPng;require(["dist/base64"],function(i){t.data.value=encodeURIComponent(i.encode(e)),t.submit()})}})}),define("filtersSourcesView",["i18n!nls/resources.min","global:collection:dictionary"],function(e,t){var i=Mn.CollectionView.extend({className:"list-group",tagName:"ul",childView:Mn.View.extend({tagName:"li",className:"btn-link-filter",template:_.template("<%- Title %>"),triggers:{click:"filter:send"},onFilterSend:function(){this.model.set("on",!this.model.get("on")),this.$el.toggleClass("active")},onRender:function(){this.model.get("on")?this.$el.addClass("active"):this.$el.removeClass("active")}}),childViewOptions:function(e){e.set("on",-1!==this.options.current.indexOf(e.get("DicCodeItem"))),e.get("on")&&this.triggerMethod("filter:send",{model:e})},childViewTriggers:{"filter:send":"filter:send"}}),n=Mn.CollectionView.extend({className:"filter-list source-collection",tagName:"ul",childView:Mn.View.extend({tagName:"li",className:"btn-link-coll",template:_.template('<% if(!IsSystem && SearchPackUID) {%><i data-icon="icon-close-xs"></i><% } %><span class="radio-button <% if(active){%>checked<%}%>"><span></span></span><span class="title"><%- SearchPackName %></span>'),modelEvents:{"change:active":function(){this.render()}},triggers:{'click i[data-icon="icon-close-xs"]':"filter:destroy:set",click:"filter:change:set"},onFilterChangeSet:function(){var e=this.model.collection.findWhere({active:!0});e&&e.set("active",!1),this.model.set("active",!0)},onFilterDestroySet:function(){Backbone.trigger("message:confirm",{title:e.sure,message:"",fx:function(){this.model.destroy()},ctx:this})},onRender:function(){this.model.get("active")?this.$el.addClass("active"):this.$el.removeClass("active")}}),childViewOptions:function(e){e.id===this.model.id?e.set("active",!0):e.set("active",!1)},childViewTriggers:{"filter:change:set":"filter:change:set","filter:destroy:set":"filter:destroy:set"}}),o=Mn.View.extend({template:templates["filters-selections-sources"],templateContext:{R:e},regions:{system:{el:".IsSystem",replaceElement:!0},custom:{el:".Custom",replaceElement:!0}},onRender:function(){var e=this.model.collection.groupBy("IsSystem");e.true&&this.showChildView("system",new n({collection:new Backbone.Collection(e.true),model:this.model})),e.false&&this.showChildView("custom",new n({collection:new Backbone.Collection(e.false),model:this.model}))},childViewTriggers:{"filter:destroy:set":"filter:destroy:set","filter:change:set":"filter:change:set"}});return Mn.View.extend({template:templates["filter-sources"],templateContext:{R:e},regions:{selections:"#selections",ByPayment:{el:"#ByPayment",replaceElement:!0},ByStatus:{el:"#ByStatus",replaceElement:!0},ByCountry:{el:"#ByCountry",replaceElement:!0},BySrcKind:{el:"#BySrcKind",replaceElement:!0},ByInfo:{el:"#ByInfo",replaceElement:!0}},events:{"click .btn-collapse":function(e){var t=$(e.target).next("div.collapse");t.is(".on")?t.removeClass("on").slideUp():t.addClass("on").slideDown()},"click .btn-link-clear":function(){var e=this.getRegions();_.each(e,function(e){var t=e.currentView;t&&t.collection&&t.collection.each(function(e){e.get("on")&&(e.set("on",!1),t.children.findByModel(e).render())})}),this.triggerMethod("filter:send",{})}},onRender:function(){this.model.collection&&this.showChildView("selections",new o({model:this.model})),t.done(function(e){e.each(function(e){this.hasRegion(e.get("DicCode"))&&this.showChildView(e.get("DicCode"),new i({collection:new Backbone.Collection(e.get("DicItems")),current:this.model.get("SelectedCountries")||[]}))},this)},this)},childViewTriggers:{"filter:destroy:set":"filter:destroy:set","filter:change:set":"filter:change:set","filter:send":"filter:send"}})}),define("listSourcesView",["i18n!nls/resources.min","c/SimpleTableView","global.behaviors.input","global.view.dialog"],function(e,t,i,n){var o=Backbone.Collection.extend({model:Backbone.Model.extend({defaults:{id:null,title:"",property:[],description:"",price:0,currency:""}}),url:function(){return"/api/sources"}}),s=Mn.View.extend({template:"#source-info-template",templateContext:{Resources:e}});return Mn.View.extend({template:templates["list-sources"],templateContext:{Resources:e},behaviors:{input:i},ui:{searchText:"#search-text",amountAll:".amount-all",amountSel:".amount-selected"},regions:{all:"#all-list",selected:"#selected-list",win:"#info-window"},events:{"keypress @ui.searchText":function(e){13===e.keyCode&&$.trim(this.ui.searchText.val())&&this.triggerMethod("filter:send",this)},"click #input-search .search":function(e){this.triggerMethod("filter:send",this)},"click .all":function(e){$(e.target).addClass("active"),this.$(".sel").removeClass("active"),this.getChildView("all").$("input ~ label").removeClass("disabled"),this.getRegion("all").$el.show(),this.getRegion("selected").$el.hide()},"click .sel:not(.active)":function(e){$(e.target).addClass("active"),this.$(".all").removeClass("active"),this.triggerMethod("show:selected:robots"),this.getRegion("all").$el.hide(),this.getRegion("selected").$el.show()}},initialize:function(){this.collection=new o},onRender:function(){var i=[{id:0,title:e.title,width:"80%",subTemplate:'<input type="checkbox" id="ch-all" class="g-form--checkbox"><label for="ch-all" style="color:#fff;"><%- title %></label>'},{id:1,title:e.price,width:"20%"}],n=[{id:0,title:e.title,width:"80%"},{id:1,title:e.price,width:"20%"}];this.showChildView("all",new t({collection:this.collection,head:new Backbone.Collection(i),rowTemplate:'<td><input type="checkbox" id="ch-<%- id %>" class="g-form--checkbox"><label for="ch-<%- id %>"><%- title %>&nbsp;<span data-cmd="info" data-icon="icon-info"></span></label></td><td><%- price?price:Resources.freeTitle %></td>'})),this.showChildView("selected",new t({collection:new Backbone.Collection,head:new Backbone.Collection(n),rowTemplate:'<td><span data-icon="icon-trash" data-cmd="clear"></span>&nbsp;<%- title %>&nbsp;<span data-cmd="info" data-icon="icon-info"></span></td><td><%- price?price:Resources.freeTitle %></td>'}))},childViewEvents:{"change:input:row":function(e){e.model.set("checked",$(event.target).prop("checked"))},"table:row:cmd":function(t,i){"clear"===$(i.target).data("cmd")&&(t.model.set("checked",!1),this.getChildView("selected").collection.remove(t.model),this.ui.amountSel.text(this.getChildView("selected").collection.length)),"info"===$(i.target).data("cmd")&&this.showChildView("win",new n({title:e.information,content:new s({model:t.model})}))}},collectionEvents:{reset:function(){this.ui.amountAll.text(this.collection.length)}},onChildviewTableRowModelChanged:function(e){this.triggerMethod("list:changed",e)}})}),define("services.sources.mainView",["i18n!nls/resources.min","filtersSourcesView","listSourcesView"],function(e,t,i){return Mn.View.extend({template:templates["search-sources"],templateContext:{Resources:e},events:{"click .toform:not(.disabled)":"toform","click @ui.start:not(.disabled)":"start"},ui:{snum:"#selected-num",samount:"#select-amount",balance:"#balance",start:".start",meter:"#source-select-meter"},initialize:function(){this.collection=new Backbone.Collection,this.collection.url="/api/sources/persisted/"+this.model.id,this.paramCollection=new Backbone.Collection},regions:{filters:"#Filters",list:"#ListTemplate"},onBeforeRender:function(){$.get("/api/search/balance").done(function(e){this.ui.balance.text(e.toFixed(2)),this.ui.meter.attr("data-meter-max",e).gtkMeter()}.bind(this))},onRender:function(){this.showChildView("list",new i),this.showChildView("filters",new t({model:this.model})),this.model.id&&(Backbone.Radio.channel("loader").trigger("show",this.$el),this.collection.fetch({reset:!0}))},collectionEvents:{reset:function(){Backbone.Radio.channel("loader").trigger("hide"),this.getChildView("list").collection.each(function(e){e.set("checked",!!this.collection.get(e))},this),this.getChildView("list").getChildView("selected").collection.reset(this.collection.models)}},childViewEvents:{"filter:send":function(e){var t=e.model;t?t.get("on")?this.paramCollection.add(t):this.paramCollection.remove(t):this.paramCollection.reset();var i={DicItems:this.paramCollection.pluck("ID"),SearchText:this.getChildView("list").ui.searchText.val()};i.DicItems.push(this.options.DicID),Backbone.Radio.channel("loader").trigger("show",this.$el),$.post("/api/sources/filterby",i).done(function(e){Backbone.Radio.channel("loader").trigger("hide"),this.getChildView("list").collection.reset(e),this.getChildView("list").collection.each(function(e){e.set("checked",!!this.collection.get(e))},this)}.bind(this))},"filter:change:set":function(e){var t=e.model.id;t?(Backbone.Radio.channel("loader").trigger("show",this.$el),this.collection.url="/api/sources/persisted/"+t,this.collection.fetch({reset:!0})):this.collection.reset()},"filter:destroy:set":function(){this.collection.reset()}},onChildviewShowSelectedRobots:function(){this.getChildView("list").getChildView("selected").collection.reset(this.collection.models)},onChildviewListChanged:function(e){e.get("checked")?this.collection.add(e):this.collection.remove(e);var t=0,i=this.collection.length;this.collection.each(function(e){t+=e.get("price")}),this.getChildView("list").ui.amountSel.text(i),i?this.ui.start.removeClass("disabled"):this.ui.start.addClass("disabled"),this.ui.snum.text(i),this.ui.samount.text(t.toFixed(2)),parseFloat(this.ui.balance.text())>0&&this.ui.meter.data("meter-val",t).gtkMeter("update")}})});