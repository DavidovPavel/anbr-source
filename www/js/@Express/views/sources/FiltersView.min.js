define(["i18n!nls/resources","@Analyst/collections/DictionaryCollection"],function(n,t){"use strict";var i='<div class="filter-title"><span class="btn-link-clear" role="button"><svg class="icon icon-filter-cross"><use xlink:href="#icon-filter-cross"><\/use><\/svg><%= R.cancelFilter %><\/span><\/div><span class="btn-collapse" role="button" data-toggle="collapse" href="#filterCollection" aria-expanded="true" aria-controls="filterCollection"><%= R.collectionSources %> <svg class="icon icon-collapse"><use xlink:href="#icon-collapse"><\/use><\/svg><\/span><div id="filterCollection" class="panel-collapse collapse in"><div class="filter-list source-collection IsSystem"><\/div><div class="filter-list source-collection Custom"><\/div><\/div><div class="filter-list"><span class="btn-collapse" role="button" data-toggle="collapse" href="#filterCategory" aria-expanded="true" aria-controls="filterCategory"><%= R.category %> <svg class="icon icon-collapse"><use xlink:href="#icon-collapse"><\/use><\/svg><\/span><div id="filterCategory" class="panel-collapse collapse in"><div class="list-group ByPayment ByStatus"><\/div><\/div><span class="btn-collapse" role="button" data-toggle="collapse" href="#filterCountry" aria-expanded="true" aria-controls="filterCountry"><%= R.selectCountry %> <svg class="icon icon-collapse"><use xlink:href="#icon-collapse"><\/use><\/svg><\/span><div id="filterCountry" class="panel-collapse collapse in"><div class="list-group ByCountry"><\/div><\/div><span class="btn-collapse" role="button" data-toggle="collapse" href="#filterSources" aria-expanded="true" aria-controls="filterSources"><%= R.byTypeSurce %> <svg class="icon icon-collapse"><use xlink:href="#icon-collapse"><\/use><\/svg><\/span><div id="filterSources" class="collapse in"><div class="list-group BySrcKind"><\/div><\/div><span class="btn-collapse" role="button" data-toggle="collapse" href="#filterKind" aria-expanded="true" aria-controls="filterKind"><%= R.byInfo %> <svg class="icon icon-collapse"><use xlink:href="#icon-collapse"><\/use><\/svg><\/span><div id="filterKind" class="collapse in"><div class="list-group ByInfo"><\/div><\/div><\/div>',r='<span id="<%= ID %>" data-code="<%= DicCodeItem %>" class="btn-link-filter" role="button"><svg class="icon icon-circle-plus"><use xlink:href="#icon-circle-plus"><\/use><\/svg><%= Title %><\/span>',u=Backbone.Model.extend({defaults:{id:null,check:!1}}),f=Backbone.Collection.extend({model:u});return Backbone.View.extend({events:{"click .btn-link-filter":"active","click .btn-collapse":"collapse","click .btn-link-clear":"clear","click .btn-link-coll":"getCollection","click .icon-close":"deleteItem"},deleteItem:function(n){if(n.stopPropagation(),this.$(".Custom>span.btn-link-coll").size()>1){var t=$(n.target).closest("span"),r=t.attr("id"),i=this.model.collection,u=i.get(r);u.destroy();this.model.collection=i;t.remove();this.getCollection(this.$(".Custom>span.btn-link-coll").get(0))}},getCollection:function(n){var t,i;this.$(".source-collection span[id='']").remove();this.$(".source-collection span.active").each(function(){$(this).removeClass("active").find(".radio-button").removeClass("checked")});t=$(n.target).closest("span.btn-link-coll");t.addClass("active").find(".radio-button").addClass("checked");i=this.model.collection;this.model=i.get(t.attr("id"))||i.findWhere({SearchPackUID:null});this.trigger("listsources:changecollection",this.model)},clear:function(){var n=this.collection;this.$(".btn-link-filter").each(function(){$(this).removeClass("active").find("svg").attr("class","icon icon-circle-plus").find("use").attr("xlink:href","#icon-circle-plus");var t=n.get(parseInt($(this).attr("id")));n.remove(t,{silent:!0})});this.send()},collapse:function(n){var t=$(n.target).closest(".btn-collapse");t.is(".collapsed")?(t.removeClass("collapsed"),t.next("div.collapse").slideDown()):(t.addClass("collapsed"),t.next("div.collapse").slideUp())},active:function(n){this.mark($(n.target).closest("span"))},initCountry:function(n){var t=this.$("span[data-code='"+n+"']");return t.addClass("active").find("svg").attr("class","icon icon-circle-check").find("use").attr("xlink:href","#icon-circle-check"),this.collection.add({id:parseInt(t.attr("id"))}),this},mark:function(n){if(n.is(".active")){n.removeClass("active").find("svg").attr("class","icon icon-circle-plus").find("use").attr("xlink:href","#icon-circle-plus");var t=this.collection.get(parseInt(n.attr("id")));this.collection.remove(t)}else n.addClass("active").find("svg").attr("class","icon icon-circle-check").find("use").attr("xlink:href","#icon-circle-check"),this.collection.add({id:parseInt(n.attr("id"))})},send:function(){this.setTout&&(clearTimeout(this.setTout),this.setTout=0);var n=this;return this.setTout=setTimeout(function(){var t=n.collection.pluck("id");n.trigger("listsources:send",{DicItems:t,SearchText:""})},300),this},initialize:function(){this.collection=new f;this.collection.on("add",this.send,this);this.collection.on("remove",this.send,this)},render:function(){return this.$el.html(_.template(i)({R:n})),t.done(function(n){n.each(function(n){var t=this.$("."+n.get("DicCode"));_.each(n.get("DicItems"),function(n){t.append(_.template(r)(n))},this)},this)},this),this},initCollection:function(n){this.$("#filterCollection .IsSystem").empty();this.$("#filterCollection .Custom").empty();this.model=n;var t=n.collection.groupBy("IsSystem");return _.each(t,function(t,i){var r=i==="true";_.each(t,function(t){t.set("active",t.id==n.id);this.$("#filterCollection "+(r?".IsSystem":".Custom")).append(_.template(`<span id="<%= SearchPackUID %>" class="btn-link-coll <% if(active){%>active<%}%>" role="button">
                        <% if(!IsSystem && SearchPackUID) {%><svg class="icon icon-close"><use xlink:href="#icon-close"/></svg><% } %>
                        <span class="radio-button <% if(active){%>checked<%}%>"><span></span></span>
                        <span class ="title"><%= SearchPackName %></span></span>`)(t.toJSON()))},this)},this),this}})});