define(["i18n!nls/resources","@/models/forms/CompanyModel","@/views/forms/FormView","text!@/templates/forms/Company.html","storage"],function(n,t,i,r,u){"use strict";return i.extend({el:$("#Company"),addEvents:{"click .checkUGRL":"checkEgrul","blur input[name='title_INTERN']":"blur"},show:function(){this.$(".dropdown-menu").show()},blur:function(){this.markError();this.model.set($.GetData(this.$el))},checkEgrul:function(){require(["signalR"],()=>require(["/signalr/hubs"],()=>require(["/scripts/IWC-SignalR-master/signalr-patch.js","/scripts/IWC-SignalR-master/iwc-signalr.js"],()=>{let t=SJ.iwc.WindowMonitor.getThisWindowId();this.model.url=`/api/interestObjects/10022/addInfo/0?wnd=${t}`;this.model.set("id",null);this.model.set($.GetData(this.$el));this.model.isValid()&&(this.model.id===0&&this.model.set("id",null),this.model.save(),console.log("Отправлен запрос на проверку ЕГРЮЛ",{model:this.model.toJSON()}),Backbone.trigger("message:modal",{title:n.wait2,message:n.send2,cancelBtn:!0}),this.$(".egrul").removeClass("open"))})))},synBeh:function(){this.model.set({searchSin_INTERN:this.$("input[name='searchSin_INTERN']").get(0).checked},{validate:!0})},getSynonims:function(){this.model.isValid()?(this.markError(),this.SinPanel.fetch(),this.$("input[name='searchSin_INTERN']").get(0).checked?this.SinPanel.show():this.SinPanel.hide()):this.SinPanel.hide()},fill:function(n){Backbone.trigger("message:hide");n=JSON.parse(n);this.$("input[name='title_INTERN']").val(n.item.Name.replace("\\",""));this.$("input[name='inn__ru_RU']").val(n.item.Inn);this.$("input[name='ogrn__ru_RU']").val(n.item.Ogrn)},initialize:function(){Backbone.on("transferdata:kind",this.fill,this);Backbone.on("showalert:newmessage",function(){Backbone.trigger("message:hide")},this);Backbone.on("alerts:send-egrul",function(){Backbone.trigger("message:modal",{title:n.wait2,message:n.send3,cancelBtn:!0})},this);this.model=new t;this.model.on("invalid",this.markError,this);this.model.on("change:title_INTERN",this.getSynonims,this);this.model.on("change:searchSin_INTERN",this.getSynonims,this)},render:function(){var t,i;return u.Current&&(this.model.set(u.Current,{silent:!0}),u.Current=null),t=this.model.toJSON(),t.title_INTERN=this.model.escape("title_INTERN"),t.Resources=n,this.$el.html(_.template(r)(t)),this.addSyn().setElement(this.$("#sinManage")).render(),this.getCountry(),i=this.model.get("selectedCountries"),Array.from(i,n=>this.viewCountry(n.replace("_","-"))),this.getCollectionSource(),this.initAttach(),this}})});