define(["i18n!nls/resources","@/models/forms/PersonModel","@/views/forms/FormView","text!@Express/templates/forms/Person.html","storage"],function(n,t,i,r,u){"use strict";return i.extend({el:$("#Person"),addEvents:{"click .checkExternalDB":"checkExtDB","click .checkINN":"checkInn","blur input[name='lname_INTERN']":"blur","blur input[name='fname_INTERN']":"blur","blur input[name='mname_INTERN']":"blur","blur input[name='age_INTERN']":"blurDate","blur input[name='ageFromTo_INTERN']":"blurDate","blur input[name='birthDateFrom_INTERN']":"blurDate","blur input[name='birthDateTo_INTERN']":"blurDate"},checkExtDB:function(){Backbone.trigger("message:success",{title:n.information,message:n.under})},blurDate:function(n){var t=$(n.target).closest("div"),r=t.attr("role"),i=!1;t.find("input[type='text']").each(function(){$.trim($(this).val())&&(i=!0)});this.chooseDateKind(i,r)},chooseDateKind:function(n,t){if(n){this.$(".row-mini").find(".field-group[role!='"+t+"']").each(function(){$(this).closest("div.form-group").addClass("disabled");$(this).find("input[type='text']").attr("disabled","disabled")});this.model.set("birthDateUsingKind_INTERN",["","a","b","c"].indexOf(t))}else this.$(".row-mini").find(".field-group[role!='"+t+"']").each(function(){$(this).closest("div.form-group").removeClass("disabled");$(this).find("input[type='text']").removeAttr("disabled")})},blur:function(){this.model.set($.GetData(this.$el));var n=$.trim(this.model.get("lname_INTERN")+" "+this.model.get("fname_INTERN")+" "+this.model.get("mname_INTERN"));this.model.set("title_INTERN",n);this.model.isValid()&&this.$("button[name=start]").removeClass("disabled")},synBeh:function(){this.model.set({searchSin_INTERN:this.$("input[name='searchSin_INTERN']").get(0).checked})},getSynonims:function(){this.model.isValid()?(this.markError(),this.model.get("searchSin_INTERN")&&this.SinPanel.fetch(),this.$("input[name='searchSin_INTERN']").get(0).checked?this.SinPanel.show():this.SinPanel.hide()):this.SinPanel.hide()},checkInn:function(){},initialize:function(){this.model=new t;this.model.on("invalid",this.markError,this);this.model.on("change:title_INTERN",this.getSynonims,this);this.model.on("change:searchSin_INTERN",this.getSynonims,this)},render:function(){u.Current&&(this.model.set(u.Current,{silent:!0}),u.Current=null);var t=this.model.toJSON(),i=this.model.get("selectedCountries");return t.Resources=n,this.$el.html(_.template(r)(t)),this.addSyn().setElement(this.$("#sinManage")).render(),this.getCountry(),Array.from(i,n=>this.viewCountry(n.replace("_","-"))),require(["RU"],()=>{let t=u.Current?u.Current.birthDateExact_INTERN?new Date(u.Current.birthDateExact_INTERN):"":"";this.$("input[name='birthDateExact_INTERN']").ejDatePicker({value:t,locale:n.Lang,buttonText:n.Today,showPopupButton:!1,watermarkText:n.formatDate,focusOut:n=>this.chooseDateKind.call(this,n.model.value,"a")});let i=u.Current?u.Current.pasDate__ru_RU?new Date(u.Current.pasDate__ru_RU):"":"";this.$("input[name='pasDate__ru_RU']").ejDatePicker({value:i,locale:n.Lang,buttonText:n.Today,showPopupButton:!1,watermarkText:n.formatDate,startLevel:ej.DatePicker.Level.Decade,width:168});let r=u.Current?u.Current.pasDate__uk_UA?new Date(u.Current.pasDate__uk_UA):"":"";this.$("input[name='pasDate__uk_UA']").ejDatePicker({value:r,locale:n.Lang,buttonText:n.Today,showPopupButton:!1,watermarkText:n.formatDate,startLevel:ej.DatePicker.Level.Decade});let f=u.Current?u.Current.pasDate__kk_KZ?new Date(u.Current.pasDate__kk_KZ):"":"";this.$("input[name='pasDate__kk_KZ']").ejDatePicker({value:f,locale:n.Lang,buttonText:n.Today,showPopupButton:!1,watermarkText:n.formatDate,startLevel:ej.DatePicker.Level.Decade})}),this.getCollectionSource(),this.initAttach(),this}})});