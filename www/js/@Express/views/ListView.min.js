define(["app","i18n!nls/resources","baseurl"],function(n,t,i){"use strict";var r='<table class="table table-hover List"><thead><tr><\/tr><\/thead><tbody><\/tbody><tfoot><tr><td colspan="6"><div class="my-checks-menu dropdown-list-menu"><\/div><\/td><\/tr><\/tfoot><\/table><div class="paging-box"><div class="paginator" id="pagination"><\/div><div class="paginator_pages"><%= Resources.Pages2 %>: <span>0<\/span><\/div><\/div>',u='<ul class="dropdown-menu"><li class="cmd_play" data-id="EA932373-3647-471A-87C1-DDB56657FEBC"><span role="button"><span class="button-icon"><svg class="icon icon-play-s"><use xlink:href="#icon-play-s" /><\/svg><\/span><span><%= Resources.runagain %><\/span><\/span><\/li>'+'<li class="cmd_case" data-id="B7787886-AF0E-4B5A-9061-49B182200B8C"><span role="button"><span class="button-icon"><svg class="icon icon-case-s"><use xlink:href="#icon-case-s" /><\/svg><\/span><span><%= Resources.addbasket %><\/span><\/span><\/li>'+'<li class="cmd_trash" data-id="86056534-0DCB-48CF-B06D-3E8D23FD5001"><span role="button"><span class="button-icon"><svg class="icon icon-trash-s"><use xlink:href="#icon-trash-s" /><\/svg><\/span><span><%= Resources.deleteItem %><\/span><\/span><\/li>'+'<li class="cmd_analyst"><a href="/" target="_blank" class="external"><span class="button-icon"><svg class="icon icon-analyst"><use xlink:href="#icon-analyst" /><\/svg><\/span><span><%= Resources.toanal %><\/span><\/a><\/li>'+'<li class="cmd_gs" data-id=""><span role="button" class="external disabled"><span class="button-icon"><svg class="icon icon-gs"><use xlink:href="#icon-gs" /><\/svg><\/span><span><%= Resources.togs %><\/span><\/span><\/li><\/ul>',f=Backbone.Model.extend({idAttribute:"Object_ID"}),e=Backbone.View.extend({events:{"click li":"exec"},exec:function(n){var t=$(n.target).closest("li"),r=t.attr("class"),i=t.attr("data-id");$.trim(i)&&(this.selected.length||this.selected.push(parseInt(this.model.id)),Backbone.trigger("message:exec",{sid:i,fx:this[r],ctx:this,amount:this.selected.length}));this.$("ul").hide()},cmd_play:function(){$.get("/api/interestObjects/input/id"+this.model.id).done(function(t){Backbone.trigger("storage:temp-object",t);n.Select.set({query:{10021:"Person",10022:"Company"}[t.typeid]});n.navigate(n.Select.fullpath(),{trigger:!0})})},cmd_case:function(){Backbone.trigger("basket:add",this.selected)},cmd_trash:function(){var n=0,t=this;_.each(this.selected,function(i){this.model.url=function(){return"/api/object/"+i};this.model.destroy({success:function(){n++;n==t.selected.length&&(t.trigger("deleted"),Backbone.trigger("change:total"))}})},this)},analyst:function(){this.$("ul").hide()},gs:function(){},render:function(){return this.$el.html(_.template(u)({Resources:t})),this},show:function(n){var u=i+"#3|Tree/0/1/"+this.model.id+"/0/0",t,r;this.$(".cmd_analyst a").attr("href",u);this.$("ul").clearQueue();this.$("button").removeClass("active");t=$(n.target).is("button")?$(n.target):$(n.target).closest("button");r=t.offset();t.toggleClass("active");this.$("ul").show();this.$el.css({position:"fixed",top:r.top+"px",left:r.left+"px",marginTop:-this.$("ul").height()-2,marginLeft:t.width()/2})}});return Backbone.View.extend({events:{"mouseleave tr":"hideMenu","mouseenter .my-checks-menu":"clearHide","click button.btn-link":"showKit","click td span":"todetail"},todetail:function(n){n.stopPropagation();var t=$(n.target).closest("tr").attr("data-id")},clearHide:function(){this.$(".my-checks-menu ul").clearQueue()},hideMenu:function(n){var t=$(n.target).closest("tr").attr("data-id");this.$(".my-checks-menu ul").is(":visible")&&t&&this.$(".my-checks-menu ul").delay(1e3).hide(100)},showKit:function(n){n.stopPropagation();var t=$(n.target).closest("tr").attr("data-id");t&&(this.kit.model=this.items.get(t),this.kit.selected=this.data,this.kit.show(n),this.$("tr[data-id='"+t+"']").addClass("ui-selected"))},fetch:function(){return this.$el.showIndicator(),this.collection.url&&(this.collection.url=n.addParams({page:this.newPage},this.collection.url),this.collection.fetch({reset:!0,error:()=>this.$el.hideIndicator()})),this.operation&&(this.operation.params.url=n.addParams({page:this.newPage},this.operation.params.url),$.ajax(this.operation.params).done(n=>this.render(n)).always(()=>this.$el.hideIndicator())),this},initialize:function(n){this.operation=n.operation;this.collection=new Backbone.Collection;this.collection.on("reset",this.render,this);this.items=new Backbone.Collection;this.items.model=f},paginatorInit:function(n,t){this.Paginator=new Paginator(this.paginatorSelector,n,t.pageSize,t.currentPage);this.bindpage()},render:function(i){var c,f,o;this.$(".info").hide();this.kit||(this.$el.html(_.template(r)({Resources:t})),this.kit=new e({el:this.$(".my-checks-menu")}).render(),this.listenTo(this.kit,"deleted",this.fetch),this.paginatorSelector="pagination"+this.cid,this.$("#pagination").attr("id",this.paginatorSelector));this.$el.hideIndicator();var h=i.models?i.models[0].get("items"):i.items,s=i.models?i.models[0].get("head"):i.head,u=i.models?i.models[0].get("pagination"):i.pagination,l=["Display_Name","CreatedDate","TypeName"];return this.paging=u,s=_.sortBy(s,function(n){return l.indexOf(n.systemName)}),h.length?(c=n.prepare(h),this.addHeader(s),this.items.reset(c),this.items.length&&this.items.each(this.addOne,this),f=Math.ceil(u.totalItems/u.pageSize),f>1&&(require(["/js/libs/paginator3000.min.js"],this.paginatorInit.bind(this,f,u)),this.$(".paginator_pages span").text(f),this.$(".paging-box").show()),this.selectableInit(),this.$("table").show(),u.totalItems<=u.pageSize?this.$(".paging-box").hide():this.$(".paging-box").show()):(u.currentPage>1?(this.newPage=u.currentPage-1,this.fetch()):(this.$("table").hide(),this.$(".paging-box").hide()),o=this.$(".info"),o.get(0)||(this.$el.append("<div class='info'><\/div>"),o=this.$(".info")),o.show().text(t.nodata)),this.callback&&this.callback.call(this.context,this),this},selectableInit:function(){var n=this;this.data=[];this.$("tbody").selectable({cancel:"a, button.btn-link",stop:function(){n.data=[];var t=$(this).find("tr.ui-selected");t.each(function(){var t=$(this).attr("data-id");n.data.indexOf(t)==-1&&n.data.push(parseInt(t))});n.trigger("selectable:stop",n.data)}})},bindpage:function(){var t=this;this.$("#"+this.paginatorSelector+" a").each(function(){$(this).on("click",function(i){i.preventDefault();n.Select.set("page",$(this).text());n.navigate(n.Select.fullpath());t.trigger("to:page",$(this).text())})})},addHeader:function(n){this.$("table.List>thead>tr").empty();this.$("table.List>tbody").empty();var i="<tr data-id='<%= Object_ID %>'><td><%= Num %><\/td>",r={Display_Name:t.title,CreatedDate:t.date,TypeName:t.type};this.$("table.List>thead>tr").append($("<th>â„–<\/th>"));_.each(n,function(n){n.isVisible&&(i+=n.systemName=="Display_Name"?"<td><a href='#id=<%= Object_ID %>' target='_blank'><%= "+n.systemName+" %><\/a><\/td>":"<td><%= "+n.systemName+" %><\/td>",this.$("table.List>thead>tr").append($("<th>"+(n.displayName||r[n.systemName])+"<\/th>")))},this);this.$("table.List>thead>tr").append("<th>"+t.status+"<\/th><th>&nbsp;<\/th>");i+='<td><svg class="icon icon-<%= Status %>"><use xlink:href="#icon-<%= Status %>"/><\/svg><\/td><td class="controls"><button type="button" class="btn-link"><svg class="icon icon-burger-menu"><use xlink:href="#icon-burger-menu"/><\/svg><\/button><\/td>';this.itemTemplate=i},addOne:function(n,t){var i=parseInt(this.paging.currentPage)*this.paging.pageSize-this.paging.pageSize+1;n.set({Num:t+i,Status:"check"});this.$("table.List>tbody").append(_.template(this.itemTemplate)(n.toJSON()))},done:function(n,t){this.callback=n;this.context=t||this}})});